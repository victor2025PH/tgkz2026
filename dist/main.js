import {
  authGuard
} from "./chunk-NO5LBIL7.js";
import {
  AiCenterViewComponent
} from "./chunk-5CO7DVEZ.js";
import {
  AutoGroupService,
  MultiRoleViewComponent
} from "./chunk-TLIZDMVS.js";
import {
  AIProviderService,
  DynamicScriptEngineService
} from "./chunk-UU2EWNBQ.js";
import {
  AnalyticsViewComponent
} from "./chunk-3RTE2EOW.js";
import {
  ConfirmDialogService,
  MonitoringViewComponent
} from "./chunk-ZZLJQCGC.js";
import {
  WalletViewComponent
} from "./chunk-LZVGK4P7.js";
import {
  WalletService
} from "./chunk-2RAHAZHZ.js";
import {
  AuthEventsService,
  AuthService
} from "./chunk-PBTZGQFB.js";
import "./chunk-HOUP2MV6.js";
import {
  LicenseClientService
} from "./chunk-SDTPNQBR.js";
import {
  DashboardViewComponent
} from "./chunk-YVYGB633.js";
import {
  MarketingAnalyticsService
} from "./chunk-UNP75L76.js";
import {
  AccountsViewComponent
} from "./chunk-EWS75HUW.js";
import {
  SettingsViewComponent
} from "./chunk-EJYUK2AX.js";
import {
  LeadsViewComponent
} from "./chunk-PJPQGSWD.js";
import {
  AutomationViewComponent
} from "./chunk-ROVTI3H2.js";
import "./chunk-XBRFXE36.js";
import {
  ResourceDiscoveryViewComponent,
  SearchDiscoveryComponent
} from "./chunk-DHKB3XNK.js";
import {
  AUTO_STYLE,
  AiChatService,
  AnimationConfigService,
  AnimationGroupPlayer,
  AnimationMetadataType,
  AppFacadeService,
  BackupService,
  CampaignManagementService,
  DialogService,
  ExportService,
  GroupManagementService,
  LeadManagementService,
  MessageQueueService,
  NavigationService,
  NoopAnimationPlayer,
  RagService,
  ResourceService,
  SchedulerService,
  SettingsService,
  TemplateManagementService,
  VectorMemoryService,
  sequence,
  style,
  ɵPRE_STYLE
} from "./chunk-P5NRPJO6.js";
import {
  AICenterService
} from "./chunk-RUWU7PL6.js";
import {
  BrowserModule,
  DomRendererFactory2,
  Router,
  RouterOutlet,
  bootstrapApplication,
  provideHttpClient,
  provideRouter
} from "./chunk-T45T4QAG.js";
import {
  DEFAULT_TAGS,
  STATUS_OPTIONS,
  UnifiedContactsService
} from "./chunk-UTR72ISQ.js";
import "./chunk-5TVIREIP.js";
import {
  MonitoringManagementService
} from "./chunk-AWDF3A3Y.js";
import {
  NavBridgeService,
  NavShortcutsService,
  UnifiedNavService
} from "./chunk-6KLKCFSW.js";
import {
  ElectronIpcService
} from "./chunk-RRYKY32A.js";
import {
  CheckboxControlValueAccessor,
  DefaultValueAccessor,
  FormsModule,
  MaxLengthValidator,
  MaxValidator,
  MinLengthValidator,
  MinValidator,
  NgControlStatus,
  NgControlStatusGroup,
  NgForm,
  NgModel,
  NgSelectOption,
  NumberValueAccessor,
  RadioControlValueAccessor,
  RequiredValidator,
  SelectControlValueAccessor,
  ɵNgNoValidate,
  ɵNgSelectMultipleOption
} from "./chunk-AF6KAQ3H.js";
import {
  I18nService,
  SUPPORTED_LOCALES
} from "./chunk-ZTUGHWSQ.js";
import {
  CommonModule,
  DatePipe,
  DecimalPipe,
  NgIf,
  SlicePipe
} from "./chunk-BTHEVO76.js";
import {
  MembershipService,
  ToastService
} from "./chunk-ORLIRJMO.js";
import {
  ANIMATION_MODULE_TYPE,
  ChangeDetectionStrategy,
  ChangeDetectorRef,
  Component,
  DOCUMENT,
  EventEmitter,
  HostListener,
  Inject,
  Injectable,
  Injector,
  Input,
  NgModule,
  NgZone,
  Output,
  RendererFactory2,
  RuntimeError,
  Subject,
  ViewChild,
  __objRest,
  __spreadProps,
  __spreadValues,
  computed,
  distinctUntilChanged,
  effect,
  fromEvent,
  inject,
  input,
  map,
  merge,
  output,
  performanceMarkFeature,
  provideZonelessChangeDetection,
  setClassMetadata,
  signal,
  startWith,
  ɵsetClassDebugInfo,
  ɵɵProvidersFeature,
  ɵɵadvance,
  ɵɵattribute,
  ɵɵclassMap,
  ɵɵclassProp,
  ɵɵcomponentInstance,
  ɵɵconditional,
  ɵɵconditionalCreate,
  ɵɵdeclareLet,
  ɵɵdefineComponent,
  ɵɵdefineInjectable,
  ɵɵdefineInjector,
  ɵɵdefineNgModule,
  ɵɵdomElement,
  ɵɵdomElementEnd,
  ɵɵdomElementStart,
  ɵɵdomListener,
  ɵɵdomProperty,
  ɵɵelement,
  ɵɵelementEnd,
  ɵɵelementStart,
  ɵɵgetCurrentView,
  ɵɵinject,
  ɵɵlistener,
  ɵɵloadQuery,
  ɵɵnamespaceHTML,
  ɵɵnamespaceSVG,
  ɵɵnextContext,
  ɵɵpipe,
  ɵɵpipeBind1,
  ɵɵpipeBind2,
  ɵɵpipeBind3,
  ɵɵproperty,
  ɵɵpureFunction0,
  ɵɵqueryRefresh,
  ɵɵreadContextLet,
  ɵɵrepeater,
  ɵɵrepeaterCreate,
  ɵɵrepeaterTrackByIdentity,
  ɵɵrepeaterTrackByIndex,
  ɵɵresetView,
  ɵɵresolveDocument,
  ɵɵresolveWindow,
  ɵɵrestoreView,
  ɵɵsanitizeUrl,
  ɵɵstoreLet,
  ɵɵstyleProp,
  ɵɵtemplate,
  ɵɵtext,
  ɵɵtextInterpolate,
  ɵɵtextInterpolate1,
  ɵɵtextInterpolate2,
  ɵɵtextInterpolate3,
  ɵɵtwoWayBindingSet,
  ɵɵtwoWayListener,
  ɵɵtwoWayProperty,
  ɵɵviewQuery
} from "./chunk-K4KD4A2Z.js";

// node_modules/@angular/animations/fesm2022/_util-chunk.mjs
var LINE_START = "\n - ";
function invalidTimingValue(exp) {
  return new RuntimeError(3e3, ngDevMode && `The provided timing value "${exp}" is invalid.`);
}
function negativeStepValue() {
  return new RuntimeError(3100, ngDevMode && "Duration values below 0 are not allowed for this animation step.");
}
function negativeDelayValue() {
  return new RuntimeError(3101, ngDevMode && "Delay values below 0 are not allowed for this animation step.");
}
function invalidStyleParams(varName) {
  return new RuntimeError(3001, ngDevMode && `Unable to resolve the local animation param ${varName} in the given list of values`);
}
function invalidParamValue(varName) {
  return new RuntimeError(3003, ngDevMode && `Please provide a value for the animation param ${varName}`);
}
function invalidNodeType(nodeType) {
  return new RuntimeError(3004, ngDevMode && `Unable to resolve animation metadata node #${nodeType}`);
}
function invalidCssUnitValue(userProvidedProperty, value) {
  return new RuntimeError(3005, ngDevMode && `Please provide a CSS unit value for ${userProvidedProperty}:${value}`);
}
function invalidTrigger() {
  return new RuntimeError(3006, ngDevMode && "animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))");
}
function invalidDefinition() {
  return new RuntimeError(3007, ngDevMode && "only state() and transition() definitions can sit inside of a trigger()");
}
function invalidState(metadataName, missingSubs) {
  return new RuntimeError(3008, ngDevMode && `state("${metadataName}", ...) must define default values for all the following style substitutions: ${missingSubs.join(", ")}`);
}
function invalidStyleValue(value) {
  return new RuntimeError(3002, ngDevMode && `The provided style string value ${value} is not allowed.`);
}
function invalidParallelAnimation(prop, firstStart, firstEnd, secondStart, secondEnd) {
  return new RuntimeError(3010, ngDevMode && `The CSS property "${prop}" that exists between the times of "${firstStart}ms" and "${firstEnd}ms" is also being animated in a parallel animation between the times of "${secondStart}ms" and "${secondEnd}ms"`);
}
function invalidKeyframes() {
  return new RuntimeError(3011, ngDevMode && `keyframes() must be placed inside of a call to animate()`);
}
function invalidOffset() {
  return new RuntimeError(3012, ngDevMode && `Please ensure that all keyframe offsets are between 0 and 1`);
}
function keyframeOffsetsOutOfOrder() {
  return new RuntimeError(3200, ngDevMode && `Please ensure that all keyframe offsets are in order`);
}
function keyframesMissingOffsets() {
  return new RuntimeError(3202, ngDevMode && `Not all style() steps within the declared keyframes() contain offsets`);
}
function invalidStagger() {
  return new RuntimeError(3013, ngDevMode && `stagger() can only be used inside of query()`);
}
function invalidQuery(selector) {
  return new RuntimeError(3014, ngDevMode && `\`query("${selector}")\` returned zero elements. (Use \`query("${selector}", { optional: true })\` if you wish to allow this.)`);
}
function invalidExpression(expr) {
  return new RuntimeError(3015, ngDevMode && `The provided transition expression "${expr}" is not supported`);
}
function invalidTransitionAlias(alias) {
  return new RuntimeError(3016, ngDevMode && `The transition alias value "${alias}" is not supported`);
}
function triggerBuildFailed(name, errors) {
  return new RuntimeError(3404, ngDevMode && `The animation trigger "${name}" has failed to build due to the following errors:
 - ${errors.map((err) => err.message).join("\n - ")}`);
}
function animationFailed(errors) {
  return new RuntimeError(3502, ngDevMode && `Unable to animate due to the following errors:${LINE_START}${errors.map((err) => err.message).join(LINE_START)}`);
}
function registerFailed(errors) {
  return new RuntimeError(3503, ngDevMode && `Unable to build the animation due to the following errors: ${errors.map((err) => err.message).join("\n")}`);
}
function missingOrDestroyedAnimation() {
  return new RuntimeError(3300, ngDevMode && "The requested animation doesn't exist or has already been destroyed");
}
function createAnimationFailed(errors) {
  return new RuntimeError(3504, ngDevMode && `Unable to create the animation due to the following errors:${errors.map((err) => err.message).join("\n")}`);
}
function missingPlayer(id) {
  return new RuntimeError(3301, ngDevMode && `Unable to find the timeline player referenced by ${id}`);
}
function missingTrigger(phase, name) {
  return new RuntimeError(3302, ngDevMode && `Unable to listen on the animation trigger event "${phase}" because the animation trigger "${name}" doesn't exist!`);
}
function missingEvent(name) {
  return new RuntimeError(3303, ngDevMode && `Unable to listen on the animation trigger "${name}" because the provided event is undefined!`);
}
function unsupportedTriggerEvent(phase, name) {
  return new RuntimeError(3400, ngDevMode && `The provided animation trigger event "${phase}" for the animation trigger "${name}" is not supported!`);
}
function unregisteredTrigger(name) {
  return new RuntimeError(3401, ngDevMode && `The provided animation trigger "${name}" has not been registered!`);
}
function triggerTransitionsFailed(errors) {
  return new RuntimeError(3402, ngDevMode && `Unable to process animations due to the following failed trigger transitions
 ${errors.map((err) => err.message).join("\n")}`);
}
function transitionFailed(name, errors) {
  return new RuntimeError(3505, ngDevMode && `@${name} has failed due to:
 ${errors.map((err) => err.message).join("\n- ")}`);
}
var ANIMATABLE_PROP_SET = /* @__PURE__ */ new Set(["-moz-outline-radius", "-moz-outline-radius-bottomleft", "-moz-outline-radius-bottomright", "-moz-outline-radius-topleft", "-moz-outline-radius-topright", "-ms-grid-columns", "-ms-grid-rows", "-webkit-line-clamp", "-webkit-text-fill-color", "-webkit-text-stroke", "-webkit-text-stroke-color", "accent-color", "all", "backdrop-filter", "background", "background-color", "background-position", "background-size", "block-size", "border", "border-block-end", "border-block-end-color", "border-block-end-width", "border-block-start", "border-block-start-color", "border-block-start-width", "border-bottom", "border-bottom-color", "border-bottom-left-radius", "border-bottom-right-radius", "border-bottom-width", "border-color", "border-end-end-radius", "border-end-start-radius", "border-image-outset", "border-image-slice", "border-image-width", "border-inline-end", "border-inline-end-color", "border-inline-end-width", "border-inline-start", "border-inline-start-color", "border-inline-start-width", "border-left", "border-left-color", "border-left-width", "border-radius", "border-right", "border-right-color", "border-right-width", "border-start-end-radius", "border-start-start-radius", "border-top", "border-top-color", "border-top-left-radius", "border-top-right-radius", "border-top-width", "border-width", "bottom", "box-shadow", "caret-color", "clip", "clip-path", "color", "column-count", "column-gap", "column-rule", "column-rule-color", "column-rule-width", "column-width", "columns", "filter", "flex", "flex-basis", "flex-grow", "flex-shrink", "font", "font-size", "font-size-adjust", "font-stretch", "font-variation-settings", "font-weight", "gap", "grid-column-gap", "grid-gap", "grid-row-gap", "grid-template-columns", "grid-template-rows", "height", "inline-size", "input-security", "inset", "inset-block", "inset-block-end", "inset-block-start", "inset-inline", "inset-inline-end", "inset-inline-start", "left", "letter-spacing", "line-clamp", "line-height", "margin", "margin-block-end", "margin-block-start", "margin-bottom", "margin-inline-end", "margin-inline-start", "margin-left", "margin-right", "margin-top", "mask", "mask-border", "mask-position", "mask-size", "max-block-size", "max-height", "max-inline-size", "max-lines", "max-width", "min-block-size", "min-height", "min-inline-size", "min-width", "object-position", "offset", "offset-anchor", "offset-distance", "offset-path", "offset-position", "offset-rotate", "opacity", "order", "outline", "outline-color", "outline-offset", "outline-width", "padding", "padding-block-end", "padding-block-start", "padding-bottom", "padding-inline-end", "padding-inline-start", "padding-left", "padding-right", "padding-top", "perspective", "perspective-origin", "right", "rotate", "row-gap", "scale", "scroll-margin", "scroll-margin-block", "scroll-margin-block-end", "scroll-margin-block-start", "scroll-margin-bottom", "scroll-margin-inline", "scroll-margin-inline-end", "scroll-margin-inline-start", "scroll-margin-left", "scroll-margin-right", "scroll-margin-top", "scroll-padding", "scroll-padding-block", "scroll-padding-block-end", "scroll-padding-block-start", "scroll-padding-bottom", "scroll-padding-inline", "scroll-padding-inline-end", "scroll-padding-inline-start", "scroll-padding-left", "scroll-padding-right", "scroll-padding-top", "scroll-snap-coordinate", "scroll-snap-destination", "scrollbar-color", "shape-image-threshold", "shape-margin", "shape-outside", "tab-size", "text-decoration", "text-decoration-color", "text-decoration-thickness", "text-emphasis", "text-emphasis-color", "text-indent", "text-shadow", "text-underline-offset", "top", "transform", "transform-origin", "translate", "vertical-align", "visibility", "width", "word-spacing", "z-index", "zoom"]);
function optimizeGroupPlayer(players) {
  switch (players.length) {
    case 0:
      return new NoopAnimationPlayer();
    case 1:
      return players[0];
    default:
      return new AnimationGroupPlayer(players);
  }
}
function normalizeKeyframes$1(normalizer, keyframes, preStyles = /* @__PURE__ */ new Map(), postStyles = /* @__PURE__ */ new Map()) {
  const errors = [];
  const normalizedKeyframes = [];
  let previousOffset = -1;
  let previousKeyframe = null;
  keyframes.forEach((kf) => {
    const offset = kf.get("offset");
    const isSameOffset = offset == previousOffset;
    const normalizedKeyframe = isSameOffset && previousKeyframe || /* @__PURE__ */ new Map();
    kf.forEach((val, prop) => {
      let normalizedProp = prop;
      let normalizedValue = val;
      if (prop !== "offset") {
        normalizedProp = normalizer.normalizePropertyName(normalizedProp, errors);
        switch (normalizedValue) {
          case \u0275PRE_STYLE:
            normalizedValue = preStyles.get(prop);
            break;
          case AUTO_STYLE:
            normalizedValue = postStyles.get(prop);
            break;
          default:
            normalizedValue = normalizer.normalizeStyleValue(prop, normalizedProp, normalizedValue, errors);
            break;
        }
      }
      normalizedKeyframe.set(normalizedProp, normalizedValue);
    });
    if (!isSameOffset) {
      normalizedKeyframes.push(normalizedKeyframe);
    }
    previousKeyframe = normalizedKeyframe;
    previousOffset = offset;
  });
  if (errors.length) {
    throw animationFailed(errors);
  }
  return normalizedKeyframes;
}
function listenOnPlayer(player, eventName, event, callback) {
  switch (eventName) {
    case "start":
      player.onStart(() => callback(event && copyAnimationEvent(event, "start", player)));
      break;
    case "done":
      player.onDone(() => callback(event && copyAnimationEvent(event, "done", player)));
      break;
    case "destroy":
      player.onDestroy(() => callback(event && copyAnimationEvent(event, "destroy", player)));
      break;
  }
}
function copyAnimationEvent(e, phaseName, player) {
  const totalTime = player.totalTime;
  const disabled = player.disabled ? true : false;
  const event = makeAnimationEvent(e.element, e.triggerName, e.fromState, e.toState, phaseName || e.phaseName, totalTime == void 0 ? e.totalTime : totalTime, disabled);
  const data = e["_data"];
  if (data != null) {
    event["_data"] = data;
  }
  return event;
}
function makeAnimationEvent(element, triggerName, fromState, toState, phaseName = "", totalTime = 0, disabled) {
  return {
    element,
    triggerName,
    fromState,
    toState,
    phaseName,
    totalTime,
    disabled: !!disabled
  };
}
function getOrSetDefaultValue(map2, key, defaultValue) {
  let value = map2.get(key);
  if (!value) {
    map2.set(key, value = defaultValue);
  }
  return value;
}
function parseTimelineCommand(command) {
  const separatorPos = command.indexOf(":");
  const id = command.substring(1, separatorPos);
  const action = command.slice(separatorPos + 1);
  return [id, action];
}
var documentElement = /* @__PURE__ */ (() => typeof document === "undefined" ? null : document.documentElement)();
function getParentElement(element) {
  const parent = element.parentNode || element.host || null;
  if (parent === documentElement) {
    return null;
  }
  return parent;
}
function containsVendorPrefix(prop) {
  return prop.substring(1, 6) == "ebkit";
}
var _CACHED_BODY = null;
var _IS_WEBKIT = false;
function validateStyleProperty(prop) {
  if (!_CACHED_BODY) {
    _CACHED_BODY = getBodyNode() || {};
    _IS_WEBKIT = _CACHED_BODY.style ? "WebkitAppearance" in _CACHED_BODY.style : false;
  }
  let result = true;
  if (_CACHED_BODY.style && !containsVendorPrefix(prop)) {
    result = prop in _CACHED_BODY.style;
    if (!result && _IS_WEBKIT) {
      const camelProp = "Webkit" + prop.charAt(0).toUpperCase() + prop.slice(1);
      result = camelProp in _CACHED_BODY.style;
    }
  }
  return result;
}
function validateWebAnimatableStyleProperty(prop) {
  return ANIMATABLE_PROP_SET.has(prop);
}
function getBodyNode() {
  if (typeof document != "undefined") {
    return document.body;
  }
  return null;
}
function containsElement(elm1, elm2) {
  while (elm2) {
    if (elm2 === elm1) {
      return true;
    }
    elm2 = getParentElement(elm2);
  }
  return false;
}
function invokeQuery(element, selector, multi) {
  if (multi) {
    return Array.from(element.querySelectorAll(selector));
  }
  const elem = element.querySelector(selector);
  return elem ? [elem] : [];
}
var ONE_SECOND = 1e3;
var SUBSTITUTION_EXPR_START = "{{";
var SUBSTITUTION_EXPR_END = "}}";
var ENTER_CLASSNAME = "ng-enter";
var LEAVE_CLASSNAME = "ng-leave";
var NG_TRIGGER_CLASSNAME = "ng-trigger";
var NG_TRIGGER_SELECTOR = ".ng-trigger";
var NG_ANIMATING_CLASSNAME = "ng-animating";
var NG_ANIMATING_SELECTOR = ".ng-animating";
function resolveTimingValue(value) {
  if (typeof value == "number") return value;
  const matches = value.match(/^(-?[\.\d]+)(m?s)/);
  if (!matches || matches.length < 2) return 0;
  return _convertTimeValueToMS(parseFloat(matches[1]), matches[2]);
}
function _convertTimeValueToMS(value, unit) {
  switch (unit) {
    case "s":
      return value * ONE_SECOND;
    default:
      return value;
  }
}
function resolveTiming(timings, errors, allowNegativeValues) {
  return timings.hasOwnProperty("duration") ? timings : parseTimeExpression(timings, errors, allowNegativeValues);
}
var PARSE_TIME_EXPRESSION_REGEX = /^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i;
function parseTimeExpression(exp, errors, allowNegativeValues) {
  let duration;
  let delay = 0;
  let easing = "";
  if (typeof exp === "string") {
    const matches = exp.match(PARSE_TIME_EXPRESSION_REGEX);
    if (matches === null) {
      errors.push(invalidTimingValue(exp));
      return {
        duration: 0,
        delay: 0,
        easing: ""
      };
    }
    duration = _convertTimeValueToMS(parseFloat(matches[1]), matches[2]);
    const delayMatch = matches[3];
    if (delayMatch != null) {
      delay = _convertTimeValueToMS(parseFloat(delayMatch), matches[4]);
    }
    const easingVal = matches[5];
    if (easingVal) {
      easing = easingVal;
    }
  } else {
    duration = exp;
  }
  if (!allowNegativeValues) {
    let containsErrors = false;
    let startIndex = errors.length;
    if (duration < 0) {
      errors.push(negativeStepValue());
      containsErrors = true;
    }
    if (delay < 0) {
      errors.push(negativeDelayValue());
      containsErrors = true;
    }
    if (containsErrors) {
      errors.splice(startIndex, 0, invalidTimingValue(exp));
    }
  }
  return {
    duration,
    delay,
    easing
  };
}
function normalizeKeyframes(keyframes) {
  if (!keyframes.length) {
    return [];
  }
  if (keyframes[0] instanceof Map) {
    return keyframes;
  }
  return keyframes.map((kf) => new Map(Object.entries(kf)));
}
function setStyles(element, styles, formerStyles) {
  styles.forEach((val, prop) => {
    const camelProp = dashCaseToCamelCase(prop);
    if (formerStyles && !formerStyles.has(prop)) {
      formerStyles.set(prop, element.style[camelProp]);
    }
    element.style[camelProp] = val;
  });
}
function eraseStyles(element, styles) {
  styles.forEach((_, prop) => {
    const camelProp = dashCaseToCamelCase(prop);
    element.style[camelProp] = "";
  });
}
function normalizeAnimationEntry(steps) {
  if (Array.isArray(steps)) {
    if (steps.length == 1) return steps[0];
    return sequence(steps);
  }
  return steps;
}
function validateStyleParams(value, options, errors) {
  const params = options.params || {};
  const matches = extractStyleParams(value);
  if (matches.length) {
    matches.forEach((varName) => {
      if (!params.hasOwnProperty(varName)) {
        errors.push(invalidStyleParams(varName));
      }
    });
  }
}
var PARAM_REGEX = /* @__PURE__ */ new RegExp(`${SUBSTITUTION_EXPR_START}\\s*(.+?)\\s*${SUBSTITUTION_EXPR_END}`, "g");
function extractStyleParams(value) {
  let params = [];
  if (typeof value === "string") {
    let match;
    while (match = PARAM_REGEX.exec(value)) {
      params.push(match[1]);
    }
    PARAM_REGEX.lastIndex = 0;
  }
  return params;
}
function interpolateParams(value, params, errors) {
  const original = `${value}`;
  const str = original.replace(PARAM_REGEX, (_, varName) => {
    let localVal = params[varName];
    if (localVal == null) {
      errors.push(invalidParamValue(varName));
      localVal = "";
    }
    return localVal.toString();
  });
  return str == original ? value : str;
}
var DASH_CASE_REGEXP = /-+([a-z0-9])/g;
function dashCaseToCamelCase(input2) {
  return input2.replace(DASH_CASE_REGEXP, (...m) => m[1].toUpperCase());
}
function camelCaseToDashCase(input2) {
  return input2.replace(/([a-z])([A-Z])/g, "$1-$2").toLowerCase();
}
function allowPreviousPlayerStylesMerge(duration, delay) {
  return duration === 0 || delay === 0;
}
function balancePreviousStylesIntoKeyframes(element, keyframes, previousStyles) {
  if (previousStyles.size && keyframes.length) {
    let startingKeyframe = keyframes[0];
    let missingStyleProps = [];
    previousStyles.forEach((val, prop) => {
      if (!startingKeyframe.has(prop)) {
        missingStyleProps.push(prop);
      }
      startingKeyframe.set(prop, val);
    });
    if (missingStyleProps.length) {
      for (let i = 1; i < keyframes.length; i++) {
        let kf = keyframes[i];
        missingStyleProps.forEach((prop) => kf.set(prop, computeStyle(element, prop)));
      }
    }
  }
  return keyframes;
}
function visitDslNode(visitor, node, context) {
  switch (node.type) {
    case AnimationMetadataType.Trigger:
      return visitor.visitTrigger(node, context);
    case AnimationMetadataType.State:
      return visitor.visitState(node, context);
    case AnimationMetadataType.Transition:
      return visitor.visitTransition(node, context);
    case AnimationMetadataType.Sequence:
      return visitor.visitSequence(node, context);
    case AnimationMetadataType.Group:
      return visitor.visitGroup(node, context);
    case AnimationMetadataType.Animate:
      return visitor.visitAnimate(node, context);
    case AnimationMetadataType.Keyframes:
      return visitor.visitKeyframes(node, context);
    case AnimationMetadataType.Style:
      return visitor.visitStyle(node, context);
    case AnimationMetadataType.Reference:
      return visitor.visitReference(node, context);
    case AnimationMetadataType.AnimateChild:
      return visitor.visitAnimateChild(node, context);
    case AnimationMetadataType.AnimateRef:
      return visitor.visitAnimateRef(node, context);
    case AnimationMetadataType.Query:
      return visitor.visitQuery(node, context);
    case AnimationMetadataType.Stagger:
      return visitor.visitStagger(node, context);
    default:
      throw invalidNodeType(node.type);
  }
}
function computeStyle(element, prop) {
  return window.getComputedStyle(element)[prop];
}

// node_modules/@angular/animations/fesm2022/browser.mjs
var NoopAnimationDriver = class _NoopAnimationDriver {
  validateStyleProperty(prop) {
    return validateStyleProperty(prop);
  }
  containsElement(elm1, elm2) {
    return containsElement(elm1, elm2);
  }
  getParentElement(element) {
    return getParentElement(element);
  }
  query(element, selector, multi) {
    return invokeQuery(element, selector, multi);
  }
  computeStyle(element, prop, defaultValue) {
    return defaultValue || "";
  }
  animate(element, keyframes, duration, delay, easing, previousPlayers = [], scrubberAccessRequested) {
    return new NoopAnimationPlayer(duration, delay);
  }
  static \u0275fac = function NoopAnimationDriver_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _NoopAnimationDriver)();
  };
  static \u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({
    token: _NoopAnimationDriver,
    factory: _NoopAnimationDriver.\u0275fac
  });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(NoopAnimationDriver, [{
    type: Injectable
  }], null, null);
})();
var AnimationDriver = class {
  static NOOP = new NoopAnimationDriver();
};
var AnimationStyleNormalizer = class {
};
var DIMENSIONAL_PROP_SET = /* @__PURE__ */ new Set(["width", "height", "minWidth", "minHeight", "maxWidth", "maxHeight", "left", "top", "bottom", "right", "fontSize", "outlineWidth", "outlineOffset", "paddingTop", "paddingLeft", "paddingBottom", "paddingRight", "marginTop", "marginLeft", "marginBottom", "marginRight", "borderRadius", "borderWidth", "borderTopWidth", "borderLeftWidth", "borderRightWidth", "borderBottomWidth", "textIndent", "perspective"]);
var WebAnimationsStyleNormalizer = class extends AnimationStyleNormalizer {
  normalizePropertyName(propertyName, errors) {
    return dashCaseToCamelCase(propertyName);
  }
  normalizeStyleValue(userProvidedProperty, normalizedProperty, value, errors) {
    let unit = "";
    const strVal = value.toString().trim();
    if (DIMENSIONAL_PROP_SET.has(normalizedProperty) && value !== 0 && value !== "0") {
      if (typeof value === "number") {
        unit = "px";
      } else {
        const valAndSuffixMatch = value.match(/^[+-]?[\d\.]+([a-z]*)$/);
        if (valAndSuffixMatch && valAndSuffixMatch[1].length == 0) {
          errors.push(invalidCssUnitValue(userProvidedProperty, value));
        }
      }
    }
    return strVal + unit;
  }
};
function createListOfWarnings(warnings) {
  const LINE_START2 = "\n - ";
  return `${LINE_START2}${warnings.filter(Boolean).map((warning) => warning).join(LINE_START2)}`;
}
function warnTriggerBuild(name, warnings) {
  console.warn(`The animation trigger "${name}" has built with the following warnings:${createListOfWarnings(warnings)}`);
}
function warnRegister(warnings) {
  console.warn(`Animation built with the following warnings:${createListOfWarnings(warnings)}`);
}
function pushUnrecognizedPropertiesWarning(warnings, props) {
  if (props.length) {
    warnings.push(`The following provided properties are not recognized: ${props.join(", ")}`);
  }
}
var ANY_STATE = "*";
function parseTransitionExpr(transitionValue, errors) {
  const expressions = [];
  if (typeof transitionValue == "string") {
    transitionValue.split(/\s*,\s*/).forEach((str) => parseInnerTransitionStr(str, expressions, errors));
  } else {
    expressions.push(transitionValue);
  }
  return expressions;
}
function parseInnerTransitionStr(eventStr, expressions, errors) {
  if (eventStr[0] == ":") {
    const result = parseAnimationAlias(eventStr, errors);
    if (typeof result == "function") {
      expressions.push(result);
      return;
    }
    eventStr = result;
  }
  const match = eventStr.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);
  if (match == null || match.length < 4) {
    errors.push(invalidExpression(eventStr));
    return expressions;
  }
  const fromState = match[1];
  const separator = match[2];
  const toState = match[3];
  expressions.push(makeLambdaFromStates(fromState, toState));
  const isFullAnyStateExpr = fromState == ANY_STATE && toState == ANY_STATE;
  if (separator[0] == "<" && !isFullAnyStateExpr) {
    expressions.push(makeLambdaFromStates(toState, fromState));
  }
  return;
}
function parseAnimationAlias(alias, errors) {
  switch (alias) {
    case ":enter":
      return "void => *";
    case ":leave":
      return "* => void";
    case ":increment":
      return (fromState, toState) => parseFloat(toState) > parseFloat(fromState);
    case ":decrement":
      return (fromState, toState) => parseFloat(toState) < parseFloat(fromState);
    default:
      errors.push(invalidTransitionAlias(alias));
      return "* => *";
  }
}
var TRUE_BOOLEAN_VALUES = /* @__PURE__ */ new Set(["true", "1"]);
var FALSE_BOOLEAN_VALUES = /* @__PURE__ */ new Set(["false", "0"]);
function makeLambdaFromStates(lhs, rhs) {
  const LHS_MATCH_BOOLEAN = TRUE_BOOLEAN_VALUES.has(lhs) || FALSE_BOOLEAN_VALUES.has(lhs);
  const RHS_MATCH_BOOLEAN = TRUE_BOOLEAN_VALUES.has(rhs) || FALSE_BOOLEAN_VALUES.has(rhs);
  return (fromState, toState) => {
    let lhsMatch = lhs == ANY_STATE || lhs == fromState;
    let rhsMatch = rhs == ANY_STATE || rhs == toState;
    if (!lhsMatch && LHS_MATCH_BOOLEAN && typeof fromState === "boolean") {
      lhsMatch = fromState ? TRUE_BOOLEAN_VALUES.has(lhs) : FALSE_BOOLEAN_VALUES.has(lhs);
    }
    if (!rhsMatch && RHS_MATCH_BOOLEAN && typeof toState === "boolean") {
      rhsMatch = toState ? TRUE_BOOLEAN_VALUES.has(rhs) : FALSE_BOOLEAN_VALUES.has(rhs);
    }
    return lhsMatch && rhsMatch;
  };
}
var SELF_TOKEN = ":self";
var SELF_TOKEN_REGEX = /* @__PURE__ */ new RegExp(`s*${SELF_TOKEN}s*,?`, "g");
function buildAnimationAst(driver, metadata, errors, warnings) {
  return new AnimationAstBuilderVisitor(driver).build(metadata, errors, warnings);
}
var ROOT_SELECTOR = "";
var AnimationAstBuilderVisitor = class {
  _driver;
  constructor(_driver) {
    this._driver = _driver;
  }
  build(metadata, errors, warnings) {
    const context = new AnimationAstBuilderContext(errors);
    this._resetContextStyleTimingState(context);
    const ast = visitDslNode(this, normalizeAnimationEntry(metadata), context);
    if (typeof ngDevMode === "undefined" || ngDevMode) {
      if (context.unsupportedCSSPropertiesFound.size) {
        pushUnrecognizedPropertiesWarning(warnings, [...context.unsupportedCSSPropertiesFound.keys()]);
      }
    }
    return ast;
  }
  _resetContextStyleTimingState(context) {
    context.currentQuerySelector = ROOT_SELECTOR;
    context.collectedStyles = /* @__PURE__ */ new Map();
    context.collectedStyles.set(ROOT_SELECTOR, /* @__PURE__ */ new Map());
    context.currentTime = 0;
  }
  visitTrigger(metadata, context) {
    let queryCount = context.queryCount = 0;
    let depCount = context.depCount = 0;
    const states = [];
    const transitions = [];
    if (metadata.name.charAt(0) == "@") {
      context.errors.push(invalidTrigger());
    }
    metadata.definitions.forEach((def) => {
      this._resetContextStyleTimingState(context);
      if (def.type == AnimationMetadataType.State) {
        const stateDef = def;
        const name = stateDef.name;
        name.toString().split(/\s*,\s*/).forEach((n) => {
          stateDef.name = n;
          states.push(this.visitState(stateDef, context));
        });
        stateDef.name = name;
      } else if (def.type == AnimationMetadataType.Transition) {
        const transition = this.visitTransition(def, context);
        queryCount += transition.queryCount;
        depCount += transition.depCount;
        transitions.push(transition);
      } else {
        context.errors.push(invalidDefinition());
      }
    });
    return {
      type: AnimationMetadataType.Trigger,
      name: metadata.name,
      states,
      transitions,
      queryCount,
      depCount,
      options: null
    };
  }
  visitState(metadata, context) {
    const styleAst = this.visitStyle(metadata.styles, context);
    const astParams = metadata.options && metadata.options.params || null;
    if (styleAst.containsDynamicStyles) {
      const missingSubs = /* @__PURE__ */ new Set();
      const params = astParams || {};
      styleAst.styles.forEach((style2) => {
        if (style2 instanceof Map) {
          style2.forEach((value) => {
            extractStyleParams(value).forEach((sub) => {
              if (!params.hasOwnProperty(sub)) {
                missingSubs.add(sub);
              }
            });
          });
        }
      });
      if (missingSubs.size) {
        context.errors.push(invalidState(metadata.name, [...missingSubs.values()]));
      }
    }
    return {
      type: AnimationMetadataType.State,
      name: metadata.name,
      style: styleAst,
      options: astParams ? {
        params: astParams
      } : null
    };
  }
  visitTransition(metadata, context) {
    context.queryCount = 0;
    context.depCount = 0;
    const animation = visitDslNode(this, normalizeAnimationEntry(metadata.animation), context);
    const matchers = parseTransitionExpr(metadata.expr, context.errors);
    return {
      type: AnimationMetadataType.Transition,
      matchers,
      animation,
      queryCount: context.queryCount,
      depCount: context.depCount,
      options: normalizeAnimationOptions(metadata.options)
    };
  }
  visitSequence(metadata, context) {
    return {
      type: AnimationMetadataType.Sequence,
      steps: metadata.steps.map((s) => visitDslNode(this, s, context)),
      options: normalizeAnimationOptions(metadata.options)
    };
  }
  visitGroup(metadata, context) {
    const currentTime = context.currentTime;
    let furthestTime = 0;
    const steps = metadata.steps.map((step) => {
      context.currentTime = currentTime;
      const innerAst = visitDslNode(this, step, context);
      furthestTime = Math.max(furthestTime, context.currentTime);
      return innerAst;
    });
    context.currentTime = furthestTime;
    return {
      type: AnimationMetadataType.Group,
      steps,
      options: normalizeAnimationOptions(metadata.options)
    };
  }
  visitAnimate(metadata, context) {
    const timingAst = constructTimingAst(metadata.timings, context.errors);
    context.currentAnimateTimings = timingAst;
    let styleAst;
    let styleMetadata = metadata.styles ? metadata.styles : style({});
    if (styleMetadata.type == AnimationMetadataType.Keyframes) {
      styleAst = this.visitKeyframes(styleMetadata, context);
    } else {
      let styleMetadata2 = metadata.styles;
      let isEmpty = false;
      if (!styleMetadata2) {
        isEmpty = true;
        const newStyleData = {};
        if (timingAst.easing) {
          newStyleData["easing"] = timingAst.easing;
        }
        styleMetadata2 = style(newStyleData);
      }
      context.currentTime += timingAst.duration + timingAst.delay;
      const _styleAst = this.visitStyle(styleMetadata2, context);
      _styleAst.isEmptyStep = isEmpty;
      styleAst = _styleAst;
    }
    context.currentAnimateTimings = null;
    return {
      type: AnimationMetadataType.Animate,
      timings: timingAst,
      style: styleAst,
      options: null
    };
  }
  visitStyle(metadata, context) {
    const ast = this._makeStyleAst(metadata, context);
    this._validateStyleAst(ast, context);
    return ast;
  }
  _makeStyleAst(metadata, context) {
    const styles = [];
    const metadataStyles = Array.isArray(metadata.styles) ? metadata.styles : [metadata.styles];
    for (let styleTuple of metadataStyles) {
      if (typeof styleTuple === "string") {
        if (styleTuple === AUTO_STYLE) {
          styles.push(styleTuple);
        } else {
          context.errors.push(invalidStyleValue(styleTuple));
        }
      } else {
        styles.push(new Map(Object.entries(styleTuple)));
      }
    }
    let containsDynamicStyles = false;
    let collectedEasing = null;
    styles.forEach((styleData) => {
      if (styleData instanceof Map) {
        if (styleData.has("easing")) {
          collectedEasing = styleData.get("easing");
          styleData.delete("easing");
        }
        if (!containsDynamicStyles) {
          for (let value of styleData.values()) {
            if (value.toString().indexOf(SUBSTITUTION_EXPR_START) >= 0) {
              containsDynamicStyles = true;
              break;
            }
          }
        }
      }
    });
    return {
      type: AnimationMetadataType.Style,
      styles,
      easing: collectedEasing,
      offset: metadata.offset,
      containsDynamicStyles,
      options: null
    };
  }
  _validateStyleAst(ast, context) {
    const timings = context.currentAnimateTimings;
    let endTime = context.currentTime;
    let startTime = context.currentTime;
    if (timings && startTime > 0) {
      startTime -= timings.duration + timings.delay;
    }
    ast.styles.forEach((tuple) => {
      if (typeof tuple === "string") return;
      tuple.forEach((value, prop) => {
        if (typeof ngDevMode === "undefined" || ngDevMode) {
          if (!this._driver.validateStyleProperty(prop)) {
            tuple.delete(prop);
            context.unsupportedCSSPropertiesFound.add(prop);
            return;
          }
        }
        const collectedStyles = context.collectedStyles.get(context.currentQuerySelector);
        const collectedEntry = collectedStyles.get(prop);
        let updateCollectedStyle = true;
        if (collectedEntry) {
          if (startTime != endTime && startTime >= collectedEntry.startTime && endTime <= collectedEntry.endTime) {
            context.errors.push(invalidParallelAnimation(prop, collectedEntry.startTime, collectedEntry.endTime, startTime, endTime));
            updateCollectedStyle = false;
          }
          startTime = collectedEntry.startTime;
        }
        if (updateCollectedStyle) {
          collectedStyles.set(prop, {
            startTime,
            endTime
          });
        }
        if (context.options) {
          validateStyleParams(value, context.options, context.errors);
        }
      });
    });
  }
  visitKeyframes(metadata, context) {
    const ast = {
      type: AnimationMetadataType.Keyframes,
      styles: [],
      options: null
    };
    if (!context.currentAnimateTimings) {
      context.errors.push(invalidKeyframes());
      return ast;
    }
    const MAX_KEYFRAME_OFFSET = 1;
    let totalKeyframesWithOffsets = 0;
    const offsets = [];
    let offsetsOutOfOrder = false;
    let keyframesOutOfRange = false;
    let previousOffset = 0;
    const keyframes = metadata.steps.map((styles) => {
      const style2 = this._makeStyleAst(styles, context);
      let offsetVal = style2.offset != null ? style2.offset : consumeOffset(style2.styles);
      let offset = 0;
      if (offsetVal != null) {
        totalKeyframesWithOffsets++;
        offset = style2.offset = offsetVal;
      }
      keyframesOutOfRange = keyframesOutOfRange || offset < 0 || offset > 1;
      offsetsOutOfOrder = offsetsOutOfOrder || offset < previousOffset;
      previousOffset = offset;
      offsets.push(offset);
      return style2;
    });
    if (keyframesOutOfRange) {
      context.errors.push(invalidOffset());
    }
    if (offsetsOutOfOrder) {
      context.errors.push(keyframeOffsetsOutOfOrder());
    }
    const length = metadata.steps.length;
    let generatedOffset = 0;
    if (totalKeyframesWithOffsets > 0 && totalKeyframesWithOffsets < length) {
      context.errors.push(keyframesMissingOffsets());
    } else if (totalKeyframesWithOffsets == 0) {
      generatedOffset = MAX_KEYFRAME_OFFSET / (length - 1);
    }
    const limit = length - 1;
    const currentTime = context.currentTime;
    const currentAnimateTimings = context.currentAnimateTimings;
    const animateDuration = currentAnimateTimings.duration;
    keyframes.forEach((kf, i) => {
      const offset = generatedOffset > 0 ? i == limit ? 1 : generatedOffset * i : offsets[i];
      const durationUpToThisFrame = offset * animateDuration;
      context.currentTime = currentTime + currentAnimateTimings.delay + durationUpToThisFrame;
      currentAnimateTimings.duration = durationUpToThisFrame;
      this._validateStyleAst(kf, context);
      kf.offset = offset;
      ast.styles.push(kf);
    });
    return ast;
  }
  visitReference(metadata, context) {
    return {
      type: AnimationMetadataType.Reference,
      animation: visitDslNode(this, normalizeAnimationEntry(metadata.animation), context),
      options: normalizeAnimationOptions(metadata.options)
    };
  }
  visitAnimateChild(metadata, context) {
    context.depCount++;
    return {
      type: AnimationMetadataType.AnimateChild,
      options: normalizeAnimationOptions(metadata.options)
    };
  }
  visitAnimateRef(metadata, context) {
    return {
      type: AnimationMetadataType.AnimateRef,
      animation: this.visitReference(metadata.animation, context),
      options: normalizeAnimationOptions(metadata.options)
    };
  }
  visitQuery(metadata, context) {
    const parentSelector = context.currentQuerySelector;
    const options = metadata.options || {};
    context.queryCount++;
    context.currentQuery = metadata;
    const [selector, includeSelf] = normalizeSelector(metadata.selector);
    context.currentQuerySelector = parentSelector.length ? parentSelector + " " + selector : selector;
    getOrSetDefaultValue(context.collectedStyles, context.currentQuerySelector, /* @__PURE__ */ new Map());
    const animation = visitDslNode(this, normalizeAnimationEntry(metadata.animation), context);
    context.currentQuery = null;
    context.currentQuerySelector = parentSelector;
    return {
      type: AnimationMetadataType.Query,
      selector,
      limit: options.limit || 0,
      optional: !!options.optional,
      includeSelf,
      animation,
      originalSelector: metadata.selector,
      options: normalizeAnimationOptions(metadata.options)
    };
  }
  visitStagger(metadata, context) {
    if (!context.currentQuery) {
      context.errors.push(invalidStagger());
    }
    const timings = metadata.timings === "full" ? {
      duration: 0,
      delay: 0,
      easing: "full"
    } : resolveTiming(metadata.timings, context.errors, true);
    return {
      type: AnimationMetadataType.Stagger,
      animation: visitDslNode(this, normalizeAnimationEntry(metadata.animation), context),
      timings,
      options: null
    };
  }
};
function normalizeSelector(selector) {
  const hasAmpersand = selector.split(/\s*,\s*/).find((token) => token == SELF_TOKEN) ? true : false;
  if (hasAmpersand) {
    selector = selector.replace(SELF_TOKEN_REGEX, "");
  }
  selector = selector.replace(/@\*/g, NG_TRIGGER_SELECTOR).replace(/@\w+/g, (match) => NG_TRIGGER_SELECTOR + "-" + match.slice(1)).replace(/:animating/g, NG_ANIMATING_SELECTOR);
  return [selector, hasAmpersand];
}
function normalizeParams(obj) {
  return obj ? __spreadValues({}, obj) : null;
}
var AnimationAstBuilderContext = class {
  errors;
  queryCount = 0;
  depCount = 0;
  currentTransition = null;
  currentQuery = null;
  currentQuerySelector = null;
  currentAnimateTimings = null;
  currentTime = 0;
  collectedStyles = /* @__PURE__ */ new Map();
  options = null;
  unsupportedCSSPropertiesFound = /* @__PURE__ */ new Set();
  constructor(errors) {
    this.errors = errors;
  }
};
function consumeOffset(styles) {
  if (typeof styles == "string") return null;
  let offset = null;
  if (Array.isArray(styles)) {
    styles.forEach((styleTuple) => {
      if (styleTuple instanceof Map && styleTuple.has("offset")) {
        const obj = styleTuple;
        offset = parseFloat(obj.get("offset"));
        obj.delete("offset");
      }
    });
  } else if (styles instanceof Map && styles.has("offset")) {
    const obj = styles;
    offset = parseFloat(obj.get("offset"));
    obj.delete("offset");
  }
  return offset;
}
function constructTimingAst(value, errors) {
  if (value.hasOwnProperty("duration")) {
    return value;
  }
  if (typeof value == "number") {
    const duration = resolveTiming(value, errors).duration;
    return makeTimingAst(duration, 0, "");
  }
  const strValue = value;
  const isDynamic = strValue.split(/\s+/).some((v) => v.charAt(0) == "{" && v.charAt(1) == "{");
  if (isDynamic) {
    const ast = makeTimingAst(0, 0, "");
    ast.dynamic = true;
    ast.strValue = strValue;
    return ast;
  }
  const timings = resolveTiming(strValue, errors);
  return makeTimingAst(timings.duration, timings.delay, timings.easing);
}
function normalizeAnimationOptions(options) {
  if (options) {
    options = __spreadValues({}, options);
    if (options["params"]) {
      options["params"] = normalizeParams(options["params"]);
    }
  } else {
    options = {};
  }
  return options;
}
function makeTimingAst(duration, delay, easing) {
  return {
    duration,
    delay,
    easing
  };
}
function createTimelineInstruction(element, keyframes, preStyleProps, postStyleProps, duration, delay, easing = null, subTimeline = false) {
  return {
    type: 1,
    element,
    keyframes,
    preStyleProps,
    postStyleProps,
    duration,
    delay,
    totalTime: duration + delay,
    easing,
    subTimeline
  };
}
var ElementInstructionMap = class {
  _map = /* @__PURE__ */ new Map();
  get(element) {
    return this._map.get(element) || [];
  }
  append(element, instructions) {
    let existingInstructions = this._map.get(element);
    if (!existingInstructions) {
      this._map.set(element, existingInstructions = []);
    }
    existingInstructions.push(...instructions);
  }
  has(element) {
    return this._map.has(element);
  }
  clear() {
    this._map.clear();
  }
};
var ONE_FRAME_IN_MILLISECONDS = 1;
var ENTER_TOKEN = ":enter";
var ENTER_TOKEN_REGEX = /* @__PURE__ */ new RegExp(ENTER_TOKEN, "g");
var LEAVE_TOKEN = ":leave";
var LEAVE_TOKEN_REGEX = /* @__PURE__ */ new RegExp(LEAVE_TOKEN, "g");
function buildAnimationTimelines(driver, rootElement, ast, enterClassName, leaveClassName, startingStyles = /* @__PURE__ */ new Map(), finalStyles = /* @__PURE__ */ new Map(), options, subInstructions, errors = []) {
  return new AnimationTimelineBuilderVisitor().buildKeyframes(driver, rootElement, ast, enterClassName, leaveClassName, startingStyles, finalStyles, options, subInstructions, errors);
}
var AnimationTimelineBuilderVisitor = class {
  buildKeyframes(driver, rootElement, ast, enterClassName, leaveClassName, startingStyles, finalStyles, options, subInstructions, errors = []) {
    subInstructions = subInstructions || new ElementInstructionMap();
    const context = new AnimationTimelineContext(driver, rootElement, subInstructions, enterClassName, leaveClassName, errors, []);
    context.options = options;
    const delay = options.delay ? resolveTimingValue(options.delay) : 0;
    context.currentTimeline.delayNextStep(delay);
    context.currentTimeline.setStyles([startingStyles], null, context.errors, options);
    visitDslNode(this, ast, context);
    const timelines = context.timelines.filter((timeline) => timeline.containsAnimation());
    if (timelines.length && finalStyles.size) {
      let lastRootTimeline;
      for (let i = timelines.length - 1; i >= 0; i--) {
        const timeline = timelines[i];
        if (timeline.element === rootElement) {
          lastRootTimeline = timeline;
          break;
        }
      }
      if (lastRootTimeline && !lastRootTimeline.allowOnlyTimelineStyles()) {
        lastRootTimeline.setStyles([finalStyles], null, context.errors, options);
      }
    }
    return timelines.length ? timelines.map((timeline) => timeline.buildKeyframes()) : [createTimelineInstruction(rootElement, [], [], [], 0, delay, "", false)];
  }
  visitTrigger(ast, context) {
  }
  visitState(ast, context) {
  }
  visitTransition(ast, context) {
  }
  visitAnimateChild(ast, context) {
    const elementInstructions = context.subInstructions.get(context.element);
    if (elementInstructions) {
      const innerContext = context.createSubContext(ast.options);
      const startTime = context.currentTimeline.currentTime;
      const endTime = this._visitSubInstructions(elementInstructions, innerContext, innerContext.options);
      if (startTime != endTime) {
        context.transformIntoNewTimeline(endTime);
      }
    }
    context.previousNode = ast;
  }
  visitAnimateRef(ast, context) {
    const innerContext = context.createSubContext(ast.options);
    innerContext.transformIntoNewTimeline();
    this._applyAnimationRefDelays([ast.options, ast.animation.options], context, innerContext);
    this.visitReference(ast.animation, innerContext);
    context.transformIntoNewTimeline(innerContext.currentTimeline.currentTime);
    context.previousNode = ast;
  }
  _applyAnimationRefDelays(animationsRefsOptions, context, innerContext) {
    for (const animationRefOptions of animationsRefsOptions) {
      const animationDelay = animationRefOptions?.delay;
      if (animationDelay) {
        const animationDelayValue = typeof animationDelay === "number" ? animationDelay : resolveTimingValue(interpolateParams(animationDelay, animationRefOptions?.params ?? {}, context.errors));
        innerContext.delayNextStep(animationDelayValue);
      }
    }
  }
  _visitSubInstructions(instructions, context, options) {
    const startTime = context.currentTimeline.currentTime;
    let furthestTime = startTime;
    const duration = options.duration != null ? resolveTimingValue(options.duration) : null;
    const delay = options.delay != null ? resolveTimingValue(options.delay) : null;
    if (duration !== 0) {
      instructions.forEach((instruction) => {
        const instructionTimings = context.appendInstructionToTimeline(instruction, duration, delay);
        furthestTime = Math.max(furthestTime, instructionTimings.duration + instructionTimings.delay);
      });
    }
    return furthestTime;
  }
  visitReference(ast, context) {
    context.updateOptions(ast.options, true);
    visitDslNode(this, ast.animation, context);
    context.previousNode = ast;
  }
  visitSequence(ast, context) {
    const subContextCount = context.subContextCount;
    let ctx = context;
    const options = ast.options;
    if (options && (options.params || options.delay)) {
      ctx = context.createSubContext(options);
      ctx.transformIntoNewTimeline();
      if (options.delay != null) {
        if (ctx.previousNode.type == AnimationMetadataType.Style) {
          ctx.currentTimeline.snapshotCurrentStyles();
          ctx.previousNode = DEFAULT_NOOP_PREVIOUS_NODE;
        }
        const delay = resolveTimingValue(options.delay);
        ctx.delayNextStep(delay);
      }
    }
    if (ast.steps.length) {
      ast.steps.forEach((s) => visitDslNode(this, s, ctx));
      ctx.currentTimeline.applyStylesToKeyframe();
      if (ctx.subContextCount > subContextCount) {
        ctx.transformIntoNewTimeline();
      }
    }
    context.previousNode = ast;
  }
  visitGroup(ast, context) {
    const innerTimelines = [];
    let furthestTime = context.currentTimeline.currentTime;
    const delay = ast.options && ast.options.delay ? resolveTimingValue(ast.options.delay) : 0;
    ast.steps.forEach((s) => {
      const innerContext = context.createSubContext(ast.options);
      if (delay) {
        innerContext.delayNextStep(delay);
      }
      visitDslNode(this, s, innerContext);
      furthestTime = Math.max(furthestTime, innerContext.currentTimeline.currentTime);
      innerTimelines.push(innerContext.currentTimeline);
    });
    innerTimelines.forEach((timeline) => context.currentTimeline.mergeTimelineCollectedStyles(timeline));
    context.transformIntoNewTimeline(furthestTime);
    context.previousNode = ast;
  }
  _visitTiming(ast, context) {
    if (ast.dynamic) {
      const strValue = ast.strValue;
      const timingValue = context.params ? interpolateParams(strValue, context.params, context.errors) : strValue;
      return resolveTiming(timingValue, context.errors);
    } else {
      return {
        duration: ast.duration,
        delay: ast.delay,
        easing: ast.easing
      };
    }
  }
  visitAnimate(ast, context) {
    const timings = context.currentAnimateTimings = this._visitTiming(ast.timings, context);
    const timeline = context.currentTimeline;
    if (timings.delay) {
      context.incrementTime(timings.delay);
      timeline.snapshotCurrentStyles();
    }
    const style2 = ast.style;
    if (style2.type == AnimationMetadataType.Keyframes) {
      this.visitKeyframes(style2, context);
    } else {
      context.incrementTime(timings.duration);
      this.visitStyle(style2, context);
      timeline.applyStylesToKeyframe();
    }
    context.currentAnimateTimings = null;
    context.previousNode = ast;
  }
  visitStyle(ast, context) {
    const timeline = context.currentTimeline;
    const timings = context.currentAnimateTimings;
    if (!timings && timeline.hasCurrentStyleProperties()) {
      timeline.forwardFrame();
    }
    const easing = timings && timings.easing || ast.easing;
    if (ast.isEmptyStep) {
      timeline.applyEmptyStep(easing);
    } else {
      timeline.setStyles(ast.styles, easing, context.errors, context.options);
    }
    context.previousNode = ast;
  }
  visitKeyframes(ast, context) {
    const currentAnimateTimings = context.currentAnimateTimings;
    const startTime = context.currentTimeline.duration;
    const duration = currentAnimateTimings.duration;
    const innerContext = context.createSubContext();
    const innerTimeline = innerContext.currentTimeline;
    innerTimeline.easing = currentAnimateTimings.easing;
    ast.styles.forEach((step) => {
      const offset = step.offset || 0;
      innerTimeline.forwardTime(offset * duration);
      innerTimeline.setStyles(step.styles, step.easing, context.errors, context.options);
      innerTimeline.applyStylesToKeyframe();
    });
    context.currentTimeline.mergeTimelineCollectedStyles(innerTimeline);
    context.transformIntoNewTimeline(startTime + duration);
    context.previousNode = ast;
  }
  visitQuery(ast, context) {
    const startTime = context.currentTimeline.currentTime;
    const options = ast.options || {};
    const delay = options.delay ? resolveTimingValue(options.delay) : 0;
    if (delay && (context.previousNode.type === AnimationMetadataType.Style || startTime == 0 && context.currentTimeline.hasCurrentStyleProperties())) {
      context.currentTimeline.snapshotCurrentStyles();
      context.previousNode = DEFAULT_NOOP_PREVIOUS_NODE;
    }
    let furthestTime = startTime;
    const elms = context.invokeQuery(ast.selector, ast.originalSelector, ast.limit, ast.includeSelf, options.optional ? true : false, context.errors);
    context.currentQueryTotal = elms.length;
    let sameElementTimeline = null;
    elms.forEach((element, i) => {
      context.currentQueryIndex = i;
      const innerContext = context.createSubContext(ast.options, element);
      if (delay) {
        innerContext.delayNextStep(delay);
      }
      if (element === context.element) {
        sameElementTimeline = innerContext.currentTimeline;
      }
      visitDslNode(this, ast.animation, innerContext);
      innerContext.currentTimeline.applyStylesToKeyframe();
      const endTime = innerContext.currentTimeline.currentTime;
      furthestTime = Math.max(furthestTime, endTime);
    });
    context.currentQueryIndex = 0;
    context.currentQueryTotal = 0;
    context.transformIntoNewTimeline(furthestTime);
    if (sameElementTimeline) {
      context.currentTimeline.mergeTimelineCollectedStyles(sameElementTimeline);
      context.currentTimeline.snapshotCurrentStyles();
    }
    context.previousNode = ast;
  }
  visitStagger(ast, context) {
    const parentContext = context.parentContext;
    const tl = context.currentTimeline;
    const timings = ast.timings;
    const duration = Math.abs(timings.duration);
    const maxTime = duration * (context.currentQueryTotal - 1);
    let delay = duration * context.currentQueryIndex;
    let staggerTransformer = timings.duration < 0 ? "reverse" : timings.easing;
    switch (staggerTransformer) {
      case "reverse":
        delay = maxTime - delay;
        break;
      case "full":
        delay = parentContext.currentStaggerTime;
        break;
    }
    const timeline = context.currentTimeline;
    if (delay) {
      timeline.delayNextStep(delay);
    }
    const startingTime = timeline.currentTime;
    visitDslNode(this, ast.animation, context);
    context.previousNode = ast;
    parentContext.currentStaggerTime = tl.currentTime - startingTime + (tl.startTime - parentContext.currentTimeline.startTime);
  }
};
var DEFAULT_NOOP_PREVIOUS_NODE = {};
var AnimationTimelineContext = class _AnimationTimelineContext {
  _driver;
  element;
  subInstructions;
  _enterClassName;
  _leaveClassName;
  errors;
  timelines;
  parentContext = null;
  currentTimeline;
  currentAnimateTimings = null;
  previousNode = DEFAULT_NOOP_PREVIOUS_NODE;
  subContextCount = 0;
  options = {};
  currentQueryIndex = 0;
  currentQueryTotal = 0;
  currentStaggerTime = 0;
  constructor(_driver, element, subInstructions, _enterClassName, _leaveClassName, errors, timelines, initialTimeline) {
    this._driver = _driver;
    this.element = element;
    this.subInstructions = subInstructions;
    this._enterClassName = _enterClassName;
    this._leaveClassName = _leaveClassName;
    this.errors = errors;
    this.timelines = timelines;
    this.currentTimeline = initialTimeline || new TimelineBuilder(this._driver, element, 0);
    timelines.push(this.currentTimeline);
  }
  get params() {
    return this.options.params;
  }
  updateOptions(options, skipIfExists) {
    if (!options) return;
    const newOptions = options;
    let optionsToUpdate = this.options;
    if (newOptions.duration != null) {
      optionsToUpdate.duration = resolveTimingValue(newOptions.duration);
    }
    if (newOptions.delay != null) {
      optionsToUpdate.delay = resolveTimingValue(newOptions.delay);
    }
    const newParams = newOptions.params;
    if (newParams) {
      let paramsToUpdate = optionsToUpdate.params;
      if (!paramsToUpdate) {
        paramsToUpdate = this.options.params = {};
      }
      Object.keys(newParams).forEach((name) => {
        if (!skipIfExists || !paramsToUpdate.hasOwnProperty(name)) {
          paramsToUpdate[name] = interpolateParams(newParams[name], paramsToUpdate, this.errors);
        }
      });
    }
  }
  _copyOptions() {
    const options = {};
    if (this.options) {
      const oldParams = this.options.params;
      if (oldParams) {
        const params = options["params"] = {};
        Object.keys(oldParams).forEach((name) => {
          params[name] = oldParams[name];
        });
      }
    }
    return options;
  }
  createSubContext(options = null, element, newTime) {
    const target = element || this.element;
    const context = new _AnimationTimelineContext(this._driver, target, this.subInstructions, this._enterClassName, this._leaveClassName, this.errors, this.timelines, this.currentTimeline.fork(target, newTime || 0));
    context.previousNode = this.previousNode;
    context.currentAnimateTimings = this.currentAnimateTimings;
    context.options = this._copyOptions();
    context.updateOptions(options);
    context.currentQueryIndex = this.currentQueryIndex;
    context.currentQueryTotal = this.currentQueryTotal;
    context.parentContext = this;
    this.subContextCount++;
    return context;
  }
  transformIntoNewTimeline(newTime) {
    this.previousNode = DEFAULT_NOOP_PREVIOUS_NODE;
    this.currentTimeline = this.currentTimeline.fork(this.element, newTime);
    this.timelines.push(this.currentTimeline);
    return this.currentTimeline;
  }
  appendInstructionToTimeline(instruction, duration, delay) {
    const updatedTimings = {
      duration: duration != null ? duration : instruction.duration,
      delay: this.currentTimeline.currentTime + (delay != null ? delay : 0) + instruction.delay,
      easing: ""
    };
    const builder = new SubTimelineBuilder(this._driver, instruction.element, instruction.keyframes, instruction.preStyleProps, instruction.postStyleProps, updatedTimings, instruction.stretchStartingKeyframe);
    this.timelines.push(builder);
    return updatedTimings;
  }
  incrementTime(time) {
    this.currentTimeline.forwardTime(this.currentTimeline.duration + time);
  }
  delayNextStep(delay) {
    if (delay > 0) {
      this.currentTimeline.delayNextStep(delay);
    }
  }
  invokeQuery(selector, originalSelector, limit, includeSelf, optional, errors) {
    let results = [];
    if (includeSelf) {
      results.push(this.element);
    }
    if (selector.length > 0) {
      selector = selector.replace(ENTER_TOKEN_REGEX, "." + this._enterClassName);
      selector = selector.replace(LEAVE_TOKEN_REGEX, "." + this._leaveClassName);
      const multi = limit != 1;
      let elements = this._driver.query(this.element, selector, multi);
      if (limit !== 0) {
        elements = limit < 0 ? elements.slice(elements.length + limit, elements.length) : elements.slice(0, limit);
      }
      results.push(...elements);
    }
    if (!optional && results.length == 0) {
      errors.push(invalidQuery(originalSelector));
    }
    return results;
  }
};
var TimelineBuilder = class _TimelineBuilder {
  _driver;
  element;
  startTime;
  _elementTimelineStylesLookup;
  duration = 0;
  easing = null;
  _previousKeyframe = /* @__PURE__ */ new Map();
  _currentKeyframe = /* @__PURE__ */ new Map();
  _keyframes = /* @__PURE__ */ new Map();
  _styleSummary = /* @__PURE__ */ new Map();
  _localTimelineStyles = /* @__PURE__ */ new Map();
  _globalTimelineStyles;
  _pendingStyles = /* @__PURE__ */ new Map();
  _backFill = /* @__PURE__ */ new Map();
  _currentEmptyStepKeyframe = null;
  constructor(_driver, element, startTime, _elementTimelineStylesLookup) {
    this._driver = _driver;
    this.element = element;
    this.startTime = startTime;
    this._elementTimelineStylesLookup = _elementTimelineStylesLookup;
    if (!this._elementTimelineStylesLookup) {
      this._elementTimelineStylesLookup = /* @__PURE__ */ new Map();
    }
    this._globalTimelineStyles = this._elementTimelineStylesLookup.get(element);
    if (!this._globalTimelineStyles) {
      this._globalTimelineStyles = this._localTimelineStyles;
      this._elementTimelineStylesLookup.set(element, this._localTimelineStyles);
    }
    this._loadKeyframe();
  }
  containsAnimation() {
    switch (this._keyframes.size) {
      case 0:
        return false;
      case 1:
        return this.hasCurrentStyleProperties();
      default:
        return true;
    }
  }
  hasCurrentStyleProperties() {
    return this._currentKeyframe.size > 0;
  }
  get currentTime() {
    return this.startTime + this.duration;
  }
  delayNextStep(delay) {
    const hasPreStyleStep = this._keyframes.size === 1 && this._pendingStyles.size;
    if (this.duration || hasPreStyleStep) {
      this.forwardTime(this.currentTime + delay);
      if (hasPreStyleStep) {
        this.snapshotCurrentStyles();
      }
    } else {
      this.startTime += delay;
    }
  }
  fork(element, currentTime) {
    this.applyStylesToKeyframe();
    return new _TimelineBuilder(this._driver, element, currentTime || this.currentTime, this._elementTimelineStylesLookup);
  }
  _loadKeyframe() {
    if (this._currentKeyframe) {
      this._previousKeyframe = this._currentKeyframe;
    }
    this._currentKeyframe = this._keyframes.get(this.duration);
    if (!this._currentKeyframe) {
      this._currentKeyframe = /* @__PURE__ */ new Map();
      this._keyframes.set(this.duration, this._currentKeyframe);
    }
  }
  forwardFrame() {
    this.duration += ONE_FRAME_IN_MILLISECONDS;
    this._loadKeyframe();
  }
  forwardTime(time) {
    this.applyStylesToKeyframe();
    this.duration = time;
    this._loadKeyframe();
  }
  _updateStyle(prop, value) {
    this._localTimelineStyles.set(prop, value);
    this._globalTimelineStyles.set(prop, value);
    this._styleSummary.set(prop, {
      time: this.currentTime,
      value
    });
  }
  allowOnlyTimelineStyles() {
    return this._currentEmptyStepKeyframe !== this._currentKeyframe;
  }
  applyEmptyStep(easing) {
    if (easing) {
      this._previousKeyframe.set("easing", easing);
    }
    for (let [prop, value] of this._globalTimelineStyles) {
      this._backFill.set(prop, value || AUTO_STYLE);
      this._currentKeyframe.set(prop, AUTO_STYLE);
    }
    this._currentEmptyStepKeyframe = this._currentKeyframe;
  }
  setStyles(input2, easing, errors, options) {
    if (easing) {
      this._previousKeyframe.set("easing", easing);
    }
    const params = options && options.params || {};
    const styles = flattenStyles(input2, this._globalTimelineStyles);
    for (let [prop, value] of styles) {
      const val = interpolateParams(value, params, errors);
      this._pendingStyles.set(prop, val);
      if (!this._localTimelineStyles.has(prop)) {
        this._backFill.set(prop, this._globalTimelineStyles.get(prop) ?? AUTO_STYLE);
      }
      this._updateStyle(prop, val);
    }
  }
  applyStylesToKeyframe() {
    if (this._pendingStyles.size == 0) return;
    this._pendingStyles.forEach((val, prop) => {
      this._currentKeyframe.set(prop, val);
    });
    this._pendingStyles.clear();
    this._localTimelineStyles.forEach((val, prop) => {
      if (!this._currentKeyframe.has(prop)) {
        this._currentKeyframe.set(prop, val);
      }
    });
  }
  snapshotCurrentStyles() {
    for (let [prop, val] of this._localTimelineStyles) {
      this._pendingStyles.set(prop, val);
      this._updateStyle(prop, val);
    }
  }
  getFinalKeyframe() {
    return this._keyframes.get(this.duration);
  }
  get properties() {
    const properties = [];
    for (let prop in this._currentKeyframe) {
      properties.push(prop);
    }
    return properties;
  }
  mergeTimelineCollectedStyles(timeline) {
    timeline._styleSummary.forEach((details1, prop) => {
      const details0 = this._styleSummary.get(prop);
      if (!details0 || details1.time > details0.time) {
        this._updateStyle(prop, details1.value);
      }
    });
  }
  buildKeyframes() {
    this.applyStylesToKeyframe();
    const preStyleProps = /* @__PURE__ */ new Set();
    const postStyleProps = /* @__PURE__ */ new Set();
    const isEmpty = this._keyframes.size === 1 && this.duration === 0;
    let finalKeyframes = [];
    this._keyframes.forEach((keyframe, time) => {
      const finalKeyframe = new Map([...this._backFill, ...keyframe]);
      finalKeyframe.forEach((value, prop) => {
        if (value === \u0275PRE_STYLE) {
          preStyleProps.add(prop);
        } else if (value === AUTO_STYLE) {
          postStyleProps.add(prop);
        }
      });
      if (!isEmpty) {
        finalKeyframe.set("offset", time / this.duration);
      }
      finalKeyframes.push(finalKeyframe);
    });
    const preProps = [...preStyleProps.values()];
    const postProps = [...postStyleProps.values()];
    if (isEmpty) {
      const kf0 = finalKeyframes[0];
      const kf1 = new Map(kf0);
      kf0.set("offset", 0);
      kf1.set("offset", 1);
      finalKeyframes = [kf0, kf1];
    }
    return createTimelineInstruction(this.element, finalKeyframes, preProps, postProps, this.duration, this.startTime, this.easing, false);
  }
};
var SubTimelineBuilder = class extends TimelineBuilder {
  keyframes;
  preStyleProps;
  postStyleProps;
  _stretchStartingKeyframe;
  timings;
  constructor(driver, element, keyframes, preStyleProps, postStyleProps, timings, _stretchStartingKeyframe = false) {
    super(driver, element, timings.delay);
    this.keyframes = keyframes;
    this.preStyleProps = preStyleProps;
    this.postStyleProps = postStyleProps;
    this._stretchStartingKeyframe = _stretchStartingKeyframe;
    this.timings = {
      duration: timings.duration,
      delay: timings.delay,
      easing: timings.easing
    };
  }
  containsAnimation() {
    return this.keyframes.length > 1;
  }
  buildKeyframes() {
    let keyframes = this.keyframes;
    let {
      delay,
      duration,
      easing
    } = this.timings;
    if (this._stretchStartingKeyframe && delay) {
      const newKeyframes = [];
      const totalTime = duration + delay;
      const startingGap = delay / totalTime;
      const newFirstKeyframe = new Map(keyframes[0]);
      newFirstKeyframe.set("offset", 0);
      newKeyframes.push(newFirstKeyframe);
      const oldFirstKeyframe = new Map(keyframes[0]);
      oldFirstKeyframe.set("offset", roundOffset(startingGap));
      newKeyframes.push(oldFirstKeyframe);
      const limit = keyframes.length - 1;
      for (let i = 1; i <= limit; i++) {
        let kf = new Map(keyframes[i]);
        const oldOffset = kf.get("offset");
        const timeAtKeyframe = delay + oldOffset * duration;
        kf.set("offset", roundOffset(timeAtKeyframe / totalTime));
        newKeyframes.push(kf);
      }
      duration = totalTime;
      delay = 0;
      easing = "";
      keyframes = newKeyframes;
    }
    return createTimelineInstruction(this.element, keyframes, this.preStyleProps, this.postStyleProps, duration, delay, easing, true);
  }
};
function roundOffset(offset, decimalPoints = 3) {
  const mult = Math.pow(10, decimalPoints - 1);
  return Math.round(offset * mult) / mult;
}
function flattenStyles(input2, allStyles) {
  const styles = /* @__PURE__ */ new Map();
  let allProperties;
  input2.forEach((token) => {
    if (token === "*") {
      allProperties ??= allStyles.keys();
      for (let prop of allProperties) {
        styles.set(prop, AUTO_STYLE);
      }
    } else {
      for (let [prop, val] of token) {
        styles.set(prop, val);
      }
    }
  });
  return styles;
}
function createTransitionInstruction(element, triggerName, fromState, toState, isRemovalTransition, fromStyles, toStyles, timelines, queriedElements, preStyleProps, postStyleProps, totalTime, errors) {
  return {
    type: 0,
    element,
    triggerName,
    isRemovalTransition,
    fromState,
    fromStyles,
    toState,
    toStyles,
    timelines,
    queriedElements,
    preStyleProps,
    postStyleProps,
    totalTime,
    errors
  };
}
var EMPTY_OBJECT = {};
var AnimationTransitionFactory = class {
  _triggerName;
  ast;
  _stateStyles;
  constructor(_triggerName, ast, _stateStyles) {
    this._triggerName = _triggerName;
    this.ast = ast;
    this._stateStyles = _stateStyles;
  }
  match(currentState, nextState, element, params) {
    return oneOrMoreTransitionsMatch(this.ast.matchers, currentState, nextState, element, params);
  }
  buildStyles(stateName, params, errors) {
    let styler = this._stateStyles.get("*");
    if (stateName !== void 0) {
      styler = this._stateStyles.get(stateName?.toString()) || styler;
    }
    return styler ? styler.buildStyles(params, errors) : /* @__PURE__ */ new Map();
  }
  build(driver, element, currentState, nextState, enterClassName, leaveClassName, currentOptions, nextOptions, subInstructions, skipAstBuild) {
    const errors = [];
    const transitionAnimationParams = this.ast.options && this.ast.options.params || EMPTY_OBJECT;
    const currentAnimationParams = currentOptions && currentOptions.params || EMPTY_OBJECT;
    const currentStateStyles = this.buildStyles(currentState, currentAnimationParams, errors);
    const nextAnimationParams = nextOptions && nextOptions.params || EMPTY_OBJECT;
    const nextStateStyles = this.buildStyles(nextState, nextAnimationParams, errors);
    const queriedElements = /* @__PURE__ */ new Set();
    const preStyleMap = /* @__PURE__ */ new Map();
    const postStyleMap = /* @__PURE__ */ new Map();
    const isRemoval = nextState === "void";
    const animationOptions = {
      params: applyParamDefaults(nextAnimationParams, transitionAnimationParams),
      delay: this.ast.options?.delay
    };
    const timelines = skipAstBuild ? [] : buildAnimationTimelines(driver, element, this.ast.animation, enterClassName, leaveClassName, currentStateStyles, nextStateStyles, animationOptions, subInstructions, errors);
    let totalTime = 0;
    timelines.forEach((tl) => {
      totalTime = Math.max(tl.duration + tl.delay, totalTime);
    });
    if (errors.length) {
      return createTransitionInstruction(element, this._triggerName, currentState, nextState, isRemoval, currentStateStyles, nextStateStyles, [], [], preStyleMap, postStyleMap, totalTime, errors);
    }
    timelines.forEach((tl) => {
      const elm = tl.element;
      const preProps = getOrSetDefaultValue(preStyleMap, elm, /* @__PURE__ */ new Set());
      tl.preStyleProps.forEach((prop) => preProps.add(prop));
      const postProps = getOrSetDefaultValue(postStyleMap, elm, /* @__PURE__ */ new Set());
      tl.postStyleProps.forEach((prop) => postProps.add(prop));
      if (elm !== element) {
        queriedElements.add(elm);
      }
    });
    if (typeof ngDevMode === "undefined" || ngDevMode) {
      checkNonAnimatableInTimelines(timelines, this._triggerName, driver);
    }
    return createTransitionInstruction(element, this._triggerName, currentState, nextState, isRemoval, currentStateStyles, nextStateStyles, timelines, [...queriedElements.values()], preStyleMap, postStyleMap, totalTime);
  }
};
function checkNonAnimatableInTimelines(timelines, triggerName, driver) {
  if (!driver.validateAnimatableStyleProperty) {
    return;
  }
  const allowedNonAnimatableProps = /* @__PURE__ */ new Set(["easing"]);
  const invalidNonAnimatableProps = /* @__PURE__ */ new Set();
  timelines.forEach(({
    keyframes
  }) => {
    const nonAnimatablePropsInitialValues = /* @__PURE__ */ new Map();
    keyframes.forEach((keyframe) => {
      const entriesToCheck = Array.from(keyframe.entries()).filter(([prop]) => !allowedNonAnimatableProps.has(prop));
      for (const [prop, value] of entriesToCheck) {
        if (!driver.validateAnimatableStyleProperty(prop)) {
          if (nonAnimatablePropsInitialValues.has(prop) && !invalidNonAnimatableProps.has(prop)) {
            const propInitialValue = nonAnimatablePropsInitialValues.get(prop);
            if (propInitialValue !== value) {
              invalidNonAnimatableProps.add(prop);
            }
          } else {
            nonAnimatablePropsInitialValues.set(prop, value);
          }
        }
      }
    });
  });
  if (invalidNonAnimatableProps.size > 0) {
    console.warn(`Warning: The animation trigger "${triggerName}" is attempting to animate the following not animatable properties: ` + Array.from(invalidNonAnimatableProps).join(", ") + "\n(to check the list of all animatable properties visit https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_animated_properties)");
  }
}
function oneOrMoreTransitionsMatch(matchFns, currentState, nextState, element, params) {
  return matchFns.some((fn) => fn(currentState, nextState, element, params));
}
function applyParamDefaults(userParams, defaults) {
  const result = __spreadValues({}, defaults);
  Object.entries(userParams).forEach(([key, value]) => {
    if (value != null) {
      result[key] = value;
    }
  });
  return result;
}
var AnimationStateStyles = class {
  styles;
  defaultParams;
  normalizer;
  constructor(styles, defaultParams, normalizer) {
    this.styles = styles;
    this.defaultParams = defaultParams;
    this.normalizer = normalizer;
  }
  buildStyles(params, errors) {
    const finalStyles = /* @__PURE__ */ new Map();
    const combinedParams = applyParamDefaults(params, this.defaultParams);
    this.styles.styles.forEach((value) => {
      if (typeof value !== "string") {
        value.forEach((val, prop) => {
          if (val) {
            val = interpolateParams(val, combinedParams, errors);
          }
          const normalizedProp = this.normalizer.normalizePropertyName(prop, errors);
          val = this.normalizer.normalizeStyleValue(prop, normalizedProp, val, errors);
          finalStyles.set(prop, val);
        });
      }
    });
    return finalStyles;
  }
};
function buildTrigger(name, ast, normalizer) {
  return new AnimationTrigger(name, ast, normalizer);
}
var AnimationTrigger = class {
  name;
  ast;
  _normalizer;
  transitionFactories = [];
  fallbackTransition;
  states = /* @__PURE__ */ new Map();
  constructor(name, ast, _normalizer) {
    this.name = name;
    this.ast = ast;
    this._normalizer = _normalizer;
    ast.states.forEach((ast2) => {
      const defaultParams = ast2.options && ast2.options.params || {};
      this.states.set(ast2.name, new AnimationStateStyles(ast2.style, defaultParams, _normalizer));
    });
    balanceProperties(this.states, "true", "1");
    balanceProperties(this.states, "false", "0");
    ast.transitions.forEach((ast2) => {
      this.transitionFactories.push(new AnimationTransitionFactory(name, ast2, this.states));
    });
    this.fallbackTransition = createFallbackTransition(name, this.states);
  }
  get containsQueries() {
    return this.ast.queryCount > 0;
  }
  matchTransition(currentState, nextState, element, params) {
    const entry = this.transitionFactories.find((f) => f.match(currentState, nextState, element, params));
    return entry || null;
  }
  matchStyles(currentState, params, errors) {
    return this.fallbackTransition.buildStyles(currentState, params, errors);
  }
};
function createFallbackTransition(triggerName, states, normalizer) {
  const matchers = [(fromState, toState) => true];
  const animation = {
    type: AnimationMetadataType.Sequence,
    steps: [],
    options: null
  };
  const transition = {
    type: AnimationMetadataType.Transition,
    animation,
    matchers,
    options: null,
    queryCount: 0,
    depCount: 0
  };
  return new AnimationTransitionFactory(triggerName, transition, states);
}
function balanceProperties(stateMap, key1, key2) {
  if (stateMap.has(key1)) {
    if (!stateMap.has(key2)) {
      stateMap.set(key2, stateMap.get(key1));
    }
  } else if (stateMap.has(key2)) {
    stateMap.set(key1, stateMap.get(key2));
  }
}
var EMPTY_INSTRUCTION_MAP = /* @__PURE__ */ new ElementInstructionMap();
var TimelineAnimationEngine = class {
  bodyNode;
  _driver;
  _normalizer;
  _animations = /* @__PURE__ */ new Map();
  _playersById = /* @__PURE__ */ new Map();
  players = [];
  constructor(bodyNode, _driver, _normalizer) {
    this.bodyNode = bodyNode;
    this._driver = _driver;
    this._normalizer = _normalizer;
  }
  register(id, metadata) {
    const errors = [];
    const warnings = [];
    const ast = buildAnimationAst(this._driver, metadata, errors, warnings);
    if (errors.length) {
      throw registerFailed(errors);
    } else {
      if (typeof ngDevMode === "undefined" || ngDevMode) {
        if (warnings.length) {
          warnRegister(warnings);
        }
      }
      this._animations.set(id, ast);
    }
  }
  _buildPlayer(i, preStyles, postStyles) {
    const element = i.element;
    const keyframes = normalizeKeyframes$1(this._normalizer, i.keyframes, preStyles, postStyles);
    return this._driver.animate(element, keyframes, i.duration, i.delay, i.easing, [], true);
  }
  create(id, element, options = {}) {
    const errors = [];
    const ast = this._animations.get(id);
    let instructions;
    const autoStylesMap = /* @__PURE__ */ new Map();
    if (ast) {
      instructions = buildAnimationTimelines(this._driver, element, ast, ENTER_CLASSNAME, LEAVE_CLASSNAME, /* @__PURE__ */ new Map(), /* @__PURE__ */ new Map(), options, EMPTY_INSTRUCTION_MAP, errors);
      instructions.forEach((inst) => {
        const styles = getOrSetDefaultValue(autoStylesMap, inst.element, /* @__PURE__ */ new Map());
        inst.postStyleProps.forEach((prop) => styles.set(prop, null));
      });
    } else {
      errors.push(missingOrDestroyedAnimation());
      instructions = [];
    }
    if (errors.length) {
      throw createAnimationFailed(errors);
    }
    autoStylesMap.forEach((styles, element2) => {
      styles.forEach((_, prop) => {
        styles.set(prop, this._driver.computeStyle(element2, prop, AUTO_STYLE));
      });
    });
    const players = instructions.map((i) => {
      const styles = autoStylesMap.get(i.element);
      return this._buildPlayer(i, /* @__PURE__ */ new Map(), styles);
    });
    const player = optimizeGroupPlayer(players);
    this._playersById.set(id, player);
    player.onDestroy(() => this.destroy(id));
    this.players.push(player);
    return player;
  }
  destroy(id) {
    const player = this._getPlayer(id);
    player.destroy();
    this._playersById.delete(id);
    const index = this.players.indexOf(player);
    if (index >= 0) {
      this.players.splice(index, 1);
    }
  }
  _getPlayer(id) {
    const player = this._playersById.get(id);
    if (!player) {
      throw missingPlayer(id);
    }
    return player;
  }
  listen(id, element, eventName, callback) {
    const baseEvent = makeAnimationEvent(element, "", "", "");
    listenOnPlayer(this._getPlayer(id), eventName, baseEvent, callback);
    return () => {
    };
  }
  command(id, element, command, args) {
    if (command == "register") {
      this.register(id, args[0]);
      return;
    }
    if (command == "create") {
      const options = args[0] || {};
      this.create(id, element, options);
      return;
    }
    const player = this._getPlayer(id);
    switch (command) {
      case "play":
        player.play();
        break;
      case "pause":
        player.pause();
        break;
      case "reset":
        player.reset();
        break;
      case "restart":
        player.restart();
        break;
      case "finish":
        player.finish();
        break;
      case "init":
        player.init();
        break;
      case "setPosition":
        player.setPosition(parseFloat(args[0]));
        break;
      case "destroy":
        this.destroy(id);
        break;
    }
  }
};
var QUEUED_CLASSNAME = "ng-animate-queued";
var QUEUED_SELECTOR = ".ng-animate-queued";
var DISABLED_CLASSNAME = "ng-animate-disabled";
var DISABLED_SELECTOR = ".ng-animate-disabled";
var STAR_CLASSNAME = "ng-star-inserted";
var STAR_SELECTOR = ".ng-star-inserted";
var EMPTY_PLAYER_ARRAY = [];
var NULL_REMOVAL_STATE = {
  namespaceId: "",
  setForRemoval: false,
  setForMove: false,
  hasAnimation: false,
  removedBeforeQueried: false
};
var NULL_REMOVED_QUERIED_STATE = {
  namespaceId: "",
  setForMove: false,
  setForRemoval: false,
  hasAnimation: false,
  removedBeforeQueried: true
};
var REMOVAL_FLAG = "__ng_removed";
var StateValue = class {
  namespaceId;
  value;
  options;
  get params() {
    return this.options.params;
  }
  constructor(input2, namespaceId = "") {
    this.namespaceId = namespaceId;
    const isObj = input2 && input2.hasOwnProperty("value");
    const value = isObj ? input2["value"] : input2;
    this.value = normalizeTriggerValue(value);
    if (isObj) {
      const _a2 = input2, {
        value: value2
      } = _a2, options = __objRest(_a2, [
        "value"
      ]);
      this.options = options;
    } else {
      this.options = {};
    }
    if (!this.options.params) {
      this.options.params = {};
    }
  }
  absorbOptions(options) {
    const newParams = options.params;
    if (newParams) {
      const oldParams = this.options.params;
      Object.keys(newParams).forEach((prop) => {
        if (oldParams[prop] == null) {
          oldParams[prop] = newParams[prop];
        }
      });
    }
  }
};
var VOID_VALUE = "void";
var DEFAULT_STATE_VALUE = /* @__PURE__ */ new StateValue(VOID_VALUE);
var AnimationTransitionNamespace = class {
  id;
  hostElement;
  _engine;
  players = [];
  _triggers = /* @__PURE__ */ new Map();
  _queue = [];
  _elementListeners = /* @__PURE__ */ new Map();
  _hostClassName;
  constructor(id, hostElement, _engine) {
    this.id = id;
    this.hostElement = hostElement;
    this._engine = _engine;
    this._hostClassName = "ng-tns-" + id;
    addClass(hostElement, this._hostClassName);
  }
  listen(element, name, phase, callback) {
    if (!this._triggers.has(name)) {
      throw missingTrigger(phase, name);
    }
    if (phase == null || phase.length == 0) {
      throw missingEvent(name);
    }
    if (!isTriggerEventValid(phase)) {
      throw unsupportedTriggerEvent(phase, name);
    }
    const listeners = getOrSetDefaultValue(this._elementListeners, element, []);
    const data = {
      name,
      phase,
      callback
    };
    listeners.push(data);
    const triggersWithStates = getOrSetDefaultValue(this._engine.statesByElement, element, /* @__PURE__ */ new Map());
    if (!triggersWithStates.has(name)) {
      addClass(element, NG_TRIGGER_CLASSNAME);
      addClass(element, NG_TRIGGER_CLASSNAME + "-" + name);
      triggersWithStates.set(name, DEFAULT_STATE_VALUE);
    }
    return () => {
      this._engine.afterFlush(() => {
        const index = listeners.indexOf(data);
        if (index >= 0) {
          listeners.splice(index, 1);
        }
        if (!this._triggers.has(name)) {
          triggersWithStates.delete(name);
        }
      });
    };
  }
  register(name, ast) {
    if (this._triggers.has(name)) {
      return false;
    } else {
      this._triggers.set(name, ast);
      return true;
    }
  }
  _getTrigger(name) {
    const trigger = this._triggers.get(name);
    if (!trigger) {
      throw unregisteredTrigger(name);
    }
    return trigger;
  }
  trigger(element, triggerName, value, defaultToFallback = true) {
    const trigger = this._getTrigger(triggerName);
    const player = new TransitionAnimationPlayer(this.id, triggerName, element);
    let triggersWithStates = this._engine.statesByElement.get(element);
    if (!triggersWithStates) {
      addClass(element, NG_TRIGGER_CLASSNAME);
      addClass(element, NG_TRIGGER_CLASSNAME + "-" + triggerName);
      this._engine.statesByElement.set(element, triggersWithStates = /* @__PURE__ */ new Map());
    }
    let fromState = triggersWithStates.get(triggerName);
    const toState = new StateValue(value, this.id);
    const isObj = value && value.hasOwnProperty("value");
    if (!isObj && fromState) {
      toState.absorbOptions(fromState.options);
    }
    triggersWithStates.set(triggerName, toState);
    if (!fromState) {
      fromState = DEFAULT_STATE_VALUE;
    }
    const isRemoval = toState.value === VOID_VALUE;
    if (!isRemoval && fromState.value === toState.value) {
      if (!objEquals(fromState.params, toState.params)) {
        const errors = [];
        const fromStyles = trigger.matchStyles(fromState.value, fromState.params, errors);
        const toStyles = trigger.matchStyles(toState.value, toState.params, errors);
        if (errors.length) {
          this._engine.reportError(errors);
        } else {
          this._engine.afterFlush(() => {
            eraseStyles(element, fromStyles);
            setStyles(element, toStyles);
          });
        }
      }
      return;
    }
    const playersOnElement = getOrSetDefaultValue(this._engine.playersByElement, element, []);
    playersOnElement.forEach((player2) => {
      if (player2.namespaceId == this.id && player2.triggerName == triggerName && player2.queued) {
        player2.destroy();
      }
    });
    let transition = trigger.matchTransition(fromState.value, toState.value, element, toState.params);
    let isFallbackTransition = false;
    if (!transition) {
      if (!defaultToFallback) return;
      transition = trigger.fallbackTransition;
      isFallbackTransition = true;
    }
    this._engine.totalQueuedPlayers++;
    this._queue.push({
      element,
      triggerName,
      transition,
      fromState,
      toState,
      player,
      isFallbackTransition
    });
    if (!isFallbackTransition) {
      addClass(element, QUEUED_CLASSNAME);
      player.onStart(() => {
        removeClass(element, QUEUED_CLASSNAME);
      });
    }
    player.onDone(() => {
      let index = this.players.indexOf(player);
      if (index >= 0) {
        this.players.splice(index, 1);
      }
      const players = this._engine.playersByElement.get(element);
      if (players) {
        let index2 = players.indexOf(player);
        if (index2 >= 0) {
          players.splice(index2, 1);
        }
      }
    });
    this.players.push(player);
    playersOnElement.push(player);
    return player;
  }
  deregister(name) {
    this._triggers.delete(name);
    this._engine.statesByElement.forEach((stateMap) => stateMap.delete(name));
    this._elementListeners.forEach((listeners, element) => {
      this._elementListeners.set(element, listeners.filter((entry) => {
        return entry.name != name;
      }));
    });
  }
  clearElementCache(element) {
    this._engine.statesByElement.delete(element);
    this._elementListeners.delete(element);
    const elementPlayers = this._engine.playersByElement.get(element);
    if (elementPlayers) {
      elementPlayers.forEach((player) => player.destroy());
      this._engine.playersByElement.delete(element);
    }
  }
  _signalRemovalForInnerTriggers(rootElement, context) {
    const elements = this._engine.driver.query(rootElement, NG_TRIGGER_SELECTOR, true);
    elements.forEach((elm) => {
      if (elm[REMOVAL_FLAG]) return;
      const namespaces = this._engine.fetchNamespacesByElement(elm);
      if (namespaces.size) {
        namespaces.forEach((ns) => ns.triggerLeaveAnimation(elm, context, false, true));
      } else {
        this.clearElementCache(elm);
      }
    });
    this._engine.afterFlushAnimationsDone(() => elements.forEach((elm) => this.clearElementCache(elm)));
  }
  triggerLeaveAnimation(element, context, destroyAfterComplete, defaultToFallback) {
    const triggerStates = this._engine.statesByElement.get(element);
    const previousTriggersValues = /* @__PURE__ */ new Map();
    if (triggerStates) {
      const players = [];
      triggerStates.forEach((state, triggerName) => {
        previousTriggersValues.set(triggerName, state.value);
        if (this._triggers.has(triggerName)) {
          const player = this.trigger(element, triggerName, VOID_VALUE, defaultToFallback);
          if (player) {
            players.push(player);
          }
        }
      });
      if (players.length) {
        this._engine.markElementAsRemoved(this.id, element, true, context, previousTriggersValues);
        if (destroyAfterComplete) {
          optimizeGroupPlayer(players).onDone(() => this._engine.processLeaveNode(element));
        }
        return true;
      }
    }
    return false;
  }
  prepareLeaveAnimationListeners(element) {
    const listeners = this._elementListeners.get(element);
    const elementStates = this._engine.statesByElement.get(element);
    if (listeners && elementStates) {
      const visitedTriggers = /* @__PURE__ */ new Set();
      listeners.forEach((listener) => {
        const triggerName = listener.name;
        if (visitedTriggers.has(triggerName)) return;
        visitedTriggers.add(triggerName);
        const trigger = this._triggers.get(triggerName);
        const transition = trigger.fallbackTransition;
        const fromState = elementStates.get(triggerName) || DEFAULT_STATE_VALUE;
        const toState = new StateValue(VOID_VALUE);
        const player = new TransitionAnimationPlayer(this.id, triggerName, element);
        this._engine.totalQueuedPlayers++;
        this._queue.push({
          element,
          triggerName,
          transition,
          fromState,
          toState,
          player,
          isFallbackTransition: true
        });
      });
    }
  }
  removeNode(element, context) {
    const engine = this._engine;
    if (element.childElementCount) {
      this._signalRemovalForInnerTriggers(element, context);
    }
    if (this.triggerLeaveAnimation(element, context, true)) return;
    let containsPotentialParentTransition = false;
    if (engine.totalAnimations) {
      const currentPlayers = engine.players.length ? engine.playersByQueriedElement.get(element) : [];
      if (currentPlayers && currentPlayers.length) {
        containsPotentialParentTransition = true;
      } else {
        let parent = element;
        while (parent = parent.parentNode) {
          const triggers = engine.statesByElement.get(parent);
          if (triggers) {
            containsPotentialParentTransition = true;
            break;
          }
        }
      }
    }
    this.prepareLeaveAnimationListeners(element);
    if (containsPotentialParentTransition) {
      engine.markElementAsRemoved(this.id, element, false, context);
    } else {
      const removalFlag = element[REMOVAL_FLAG];
      if (!removalFlag || removalFlag === NULL_REMOVAL_STATE) {
        engine.afterFlush(() => this.clearElementCache(element));
        engine.destroyInnerAnimations(element);
        engine._onRemovalComplete(element, context);
      }
    }
  }
  insertNode(element, parent) {
    addClass(element, this._hostClassName);
  }
  drainQueuedTransitions(microtaskId) {
    const instructions = [];
    this._queue.forEach((entry) => {
      const player = entry.player;
      if (player.destroyed) return;
      const element = entry.element;
      const listeners = this._elementListeners.get(element);
      if (listeners) {
        listeners.forEach((listener) => {
          if (listener.name == entry.triggerName) {
            const baseEvent = makeAnimationEvent(element, entry.triggerName, entry.fromState.value, entry.toState.value);
            baseEvent["_data"] = microtaskId;
            listenOnPlayer(entry.player, listener.phase, baseEvent, listener.callback);
          }
        });
      }
      if (player.markedForDestroy) {
        this._engine.afterFlush(() => {
          player.destroy();
        });
      } else {
        instructions.push(entry);
      }
    });
    this._queue = [];
    return instructions.sort((a, b) => {
      const d0 = a.transition.ast.depCount;
      const d1 = b.transition.ast.depCount;
      if (d0 == 0 || d1 == 0) {
        return d0 - d1;
      }
      return this._engine.driver.containsElement(a.element, b.element) ? 1 : -1;
    });
  }
  destroy(context) {
    this.players.forEach((p) => p.destroy());
    this._signalRemovalForInnerTriggers(this.hostElement, context);
  }
};
var TransitionAnimationEngine = class {
  bodyNode;
  driver;
  _normalizer;
  players = [];
  newHostElements = /* @__PURE__ */ new Map();
  playersByElement = /* @__PURE__ */ new Map();
  playersByQueriedElement = /* @__PURE__ */ new Map();
  statesByElement = /* @__PURE__ */ new Map();
  disabledNodes = /* @__PURE__ */ new Set();
  totalAnimations = 0;
  totalQueuedPlayers = 0;
  _namespaceLookup = {};
  _namespaceList = [];
  _flushFns = [];
  _whenQuietFns = [];
  namespacesByHostElement = /* @__PURE__ */ new Map();
  collectedEnterElements = [];
  collectedLeaveElements = [];
  onRemovalComplete = (element, context) => {
  };
  _onRemovalComplete(element, context) {
    this.onRemovalComplete(element, context);
  }
  constructor(bodyNode, driver, _normalizer) {
    this.bodyNode = bodyNode;
    this.driver = driver;
    this._normalizer = _normalizer;
  }
  get queuedPlayers() {
    const players = [];
    this._namespaceList.forEach((ns) => {
      ns.players.forEach((player) => {
        if (player.queued) {
          players.push(player);
        }
      });
    });
    return players;
  }
  createNamespace(namespaceId, hostElement) {
    const ns = new AnimationTransitionNamespace(namespaceId, hostElement, this);
    if (this.bodyNode && this.driver.containsElement(this.bodyNode, hostElement)) {
      this._balanceNamespaceList(ns, hostElement);
    } else {
      this.newHostElements.set(hostElement, ns);
      this.collectEnterElement(hostElement);
    }
    return this._namespaceLookup[namespaceId] = ns;
  }
  _balanceNamespaceList(ns, hostElement) {
    const namespaceList = this._namespaceList;
    const namespacesByHostElement = this.namespacesByHostElement;
    const limit = namespaceList.length - 1;
    if (limit >= 0) {
      let found = false;
      let ancestor = this.driver.getParentElement(hostElement);
      while (ancestor) {
        const ancestorNs = namespacesByHostElement.get(ancestor);
        if (ancestorNs) {
          const index = namespaceList.indexOf(ancestorNs);
          namespaceList.splice(index + 1, 0, ns);
          found = true;
          break;
        }
        ancestor = this.driver.getParentElement(ancestor);
      }
      if (!found) {
        namespaceList.unshift(ns);
      }
    } else {
      namespaceList.push(ns);
    }
    namespacesByHostElement.set(hostElement, ns);
    return ns;
  }
  register(namespaceId, hostElement) {
    let ns = this._namespaceLookup[namespaceId];
    if (!ns) {
      ns = this.createNamespace(namespaceId, hostElement);
    }
    return ns;
  }
  registerTrigger(namespaceId, name, trigger) {
    let ns = this._namespaceLookup[namespaceId];
    if (ns && ns.register(name, trigger)) {
      this.totalAnimations++;
    }
  }
  destroy(namespaceId, context) {
    if (!namespaceId) return;
    this.afterFlush(() => {
    });
    this.afterFlushAnimationsDone(() => {
      const ns = this._fetchNamespace(namespaceId);
      this.namespacesByHostElement.delete(ns.hostElement);
      const index = this._namespaceList.indexOf(ns);
      if (index >= 0) {
        this._namespaceList.splice(index, 1);
      }
      ns.destroy(context);
      delete this._namespaceLookup[namespaceId];
    });
  }
  _fetchNamespace(id) {
    return this._namespaceLookup[id];
  }
  fetchNamespacesByElement(element) {
    const namespaces = /* @__PURE__ */ new Set();
    const elementStates = this.statesByElement.get(element);
    if (elementStates) {
      for (let stateValue of elementStates.values()) {
        if (stateValue.namespaceId) {
          const ns = this._fetchNamespace(stateValue.namespaceId);
          if (ns) {
            namespaces.add(ns);
          }
        }
      }
    }
    return namespaces;
  }
  trigger(namespaceId, element, name, value) {
    if (isElementNode(element)) {
      const ns = this._fetchNamespace(namespaceId);
      if (ns) {
        ns.trigger(element, name, value);
        return true;
      }
    }
    return false;
  }
  insertNode(namespaceId, element, parent, insertBefore) {
    if (!isElementNode(element)) return;
    const details = element[REMOVAL_FLAG];
    if (details && details.setForRemoval) {
      details.setForRemoval = false;
      details.setForMove = true;
      const index = this.collectedLeaveElements.indexOf(element);
      if (index >= 0) {
        this.collectedLeaveElements.splice(index, 1);
      }
    }
    if (namespaceId) {
      const ns = this._fetchNamespace(namespaceId);
      if (ns) {
        ns.insertNode(element, parent);
      }
    }
    if (insertBefore) {
      this.collectEnterElement(element);
    }
  }
  collectEnterElement(element) {
    this.collectedEnterElements.push(element);
  }
  markElementAsDisabled(element, value) {
    if (value) {
      if (!this.disabledNodes.has(element)) {
        this.disabledNodes.add(element);
        addClass(element, DISABLED_CLASSNAME);
      }
    } else if (this.disabledNodes.has(element)) {
      this.disabledNodes.delete(element);
      removeClass(element, DISABLED_CLASSNAME);
    }
  }
  removeNode(namespaceId, element, context) {
    if (isElementNode(element)) {
      const ns = namespaceId ? this._fetchNamespace(namespaceId) : null;
      if (ns) {
        ns.removeNode(element, context);
      } else {
        this.markElementAsRemoved(namespaceId, element, false, context);
      }
      const hostNS = this.namespacesByHostElement.get(element);
      if (hostNS && hostNS.id !== namespaceId) {
        hostNS.removeNode(element, context);
      }
    } else {
      this._onRemovalComplete(element, context);
    }
  }
  markElementAsRemoved(namespaceId, element, hasAnimation, context, previousTriggersValues) {
    this.collectedLeaveElements.push(element);
    element[REMOVAL_FLAG] = {
      namespaceId,
      setForRemoval: context,
      hasAnimation,
      removedBeforeQueried: false,
      previousTriggersValues
    };
  }
  listen(namespaceId, element, name, phase, callback) {
    if (isElementNode(element)) {
      return this._fetchNamespace(namespaceId).listen(element, name, phase, callback);
    }
    return () => {
    };
  }
  _buildInstruction(entry, subTimelines, enterClassName, leaveClassName, skipBuildAst) {
    return entry.transition.build(this.driver, entry.element, entry.fromState.value, entry.toState.value, enterClassName, leaveClassName, entry.fromState.options, entry.toState.options, subTimelines, skipBuildAst);
  }
  destroyInnerAnimations(containerElement) {
    let elements = this.driver.query(containerElement, NG_TRIGGER_SELECTOR, true);
    elements.forEach((element) => this.destroyActiveAnimationsForElement(element));
    if (this.playersByQueriedElement.size == 0) return;
    elements = this.driver.query(containerElement, NG_ANIMATING_SELECTOR, true);
    elements.forEach((element) => this.finishActiveQueriedAnimationOnElement(element));
  }
  destroyActiveAnimationsForElement(element) {
    const players = this.playersByElement.get(element);
    if (players) {
      players.forEach((player) => {
        if (player.queued) {
          player.markedForDestroy = true;
        } else {
          player.destroy();
        }
      });
    }
  }
  finishActiveQueriedAnimationOnElement(element) {
    const players = this.playersByQueriedElement.get(element);
    if (players) {
      players.forEach((player) => player.finish());
    }
  }
  whenRenderingDone() {
    return new Promise((resolve) => {
      if (this.players.length) {
        return optimizeGroupPlayer(this.players).onDone(() => resolve());
      } else {
        resolve();
      }
    });
  }
  processLeaveNode(element) {
    const details = element[REMOVAL_FLAG];
    if (details && details.setForRemoval) {
      element[REMOVAL_FLAG] = NULL_REMOVAL_STATE;
      if (details.namespaceId) {
        this.destroyInnerAnimations(element);
        const ns = this._fetchNamespace(details.namespaceId);
        if (ns) {
          ns.clearElementCache(element);
        }
      }
      this._onRemovalComplete(element, details.setForRemoval);
    }
    if (element.classList?.contains(DISABLED_CLASSNAME)) {
      this.markElementAsDisabled(element, false);
    }
    this.driver.query(element, DISABLED_SELECTOR, true).forEach((node) => {
      this.markElementAsDisabled(node, false);
    });
  }
  flush(microtaskId = -1) {
    let players = [];
    if (this.newHostElements.size) {
      this.newHostElements.forEach((ns, element) => this._balanceNamespaceList(ns, element));
      this.newHostElements.clear();
    }
    if (this.totalAnimations && this.collectedEnterElements.length) {
      for (let i = 0; i < this.collectedEnterElements.length; i++) {
        const elm = this.collectedEnterElements[i];
        addClass(elm, STAR_CLASSNAME);
      }
    }
    if (this._namespaceList.length && (this.totalQueuedPlayers || this.collectedLeaveElements.length)) {
      const cleanupFns = [];
      try {
        players = this._flushAnimations(cleanupFns, microtaskId);
      } finally {
        for (let i = 0; i < cleanupFns.length; i++) {
          cleanupFns[i]();
        }
      }
    } else {
      for (let i = 0; i < this.collectedLeaveElements.length; i++) {
        const element = this.collectedLeaveElements[i];
        this.processLeaveNode(element);
      }
    }
    this.totalQueuedPlayers = 0;
    this.collectedEnterElements.length = 0;
    this.collectedLeaveElements.length = 0;
    this._flushFns.forEach((fn) => fn());
    this._flushFns = [];
    if (this._whenQuietFns.length) {
      const quietFns = this._whenQuietFns;
      this._whenQuietFns = [];
      if (players.length) {
        optimizeGroupPlayer(players).onDone(() => {
          quietFns.forEach((fn) => fn());
        });
      } else {
        quietFns.forEach((fn) => fn());
      }
    }
  }
  reportError(errors) {
    throw triggerTransitionsFailed(errors);
  }
  _flushAnimations(cleanupFns, microtaskId) {
    const subTimelines = new ElementInstructionMap();
    const skippedPlayers = [];
    const skippedPlayersMap = /* @__PURE__ */ new Map();
    const queuedInstructions = [];
    const queriedElements = /* @__PURE__ */ new Map();
    const allPreStyleElements = /* @__PURE__ */ new Map();
    const allPostStyleElements = /* @__PURE__ */ new Map();
    const disabledElementsSet = /* @__PURE__ */ new Set();
    this.disabledNodes.forEach((node) => {
      disabledElementsSet.add(node);
      const nodesThatAreDisabled = this.driver.query(node, QUEUED_SELECTOR, true);
      for (let i2 = 0; i2 < nodesThatAreDisabled.length; i2++) {
        disabledElementsSet.add(nodesThatAreDisabled[i2]);
      }
    });
    const bodyNode = this.bodyNode;
    const allTriggerElements = Array.from(this.statesByElement.keys());
    const enterNodeMap = buildRootMap(allTriggerElements, this.collectedEnterElements);
    const enterNodeMapIds = /* @__PURE__ */ new Map();
    let i = 0;
    enterNodeMap.forEach((nodes, root) => {
      const className = ENTER_CLASSNAME + i++;
      enterNodeMapIds.set(root, className);
      nodes.forEach((node) => addClass(node, className));
    });
    const allLeaveNodes = [];
    const mergedLeaveNodes = /* @__PURE__ */ new Set();
    const leaveNodesWithoutAnimations = /* @__PURE__ */ new Set();
    for (let i2 = 0; i2 < this.collectedLeaveElements.length; i2++) {
      const element = this.collectedLeaveElements[i2];
      const details = element[REMOVAL_FLAG];
      if (details && details.setForRemoval) {
        allLeaveNodes.push(element);
        mergedLeaveNodes.add(element);
        if (details.hasAnimation) {
          this.driver.query(element, STAR_SELECTOR, true).forEach((elm) => mergedLeaveNodes.add(elm));
        } else {
          leaveNodesWithoutAnimations.add(element);
        }
      }
    }
    const leaveNodeMapIds = /* @__PURE__ */ new Map();
    const leaveNodeMap = buildRootMap(allTriggerElements, Array.from(mergedLeaveNodes));
    leaveNodeMap.forEach((nodes, root) => {
      const className = LEAVE_CLASSNAME + i++;
      leaveNodeMapIds.set(root, className);
      nodes.forEach((node) => addClass(node, className));
    });
    cleanupFns.push(() => {
      enterNodeMap.forEach((nodes, root) => {
        const className = enterNodeMapIds.get(root);
        nodes.forEach((node) => removeClass(node, className));
      });
      leaveNodeMap.forEach((nodes, root) => {
        const className = leaveNodeMapIds.get(root);
        nodes.forEach((node) => removeClass(node, className));
      });
      allLeaveNodes.forEach((element) => {
        this.processLeaveNode(element);
      });
    });
    const allPlayers = [];
    const erroneousTransitions = [];
    for (let i2 = this._namespaceList.length - 1; i2 >= 0; i2--) {
      const ns = this._namespaceList[i2];
      ns.drainQueuedTransitions(microtaskId).forEach((entry) => {
        const player = entry.player;
        const element = entry.element;
        allPlayers.push(player);
        if (this.collectedEnterElements.length) {
          const details = element[REMOVAL_FLAG];
          if (details && details.setForMove) {
            if (details.previousTriggersValues && details.previousTriggersValues.has(entry.triggerName)) {
              const previousValue = details.previousTriggersValues.get(entry.triggerName);
              const triggersWithStates = this.statesByElement.get(entry.element);
              if (triggersWithStates && triggersWithStates.has(entry.triggerName)) {
                const state = triggersWithStates.get(entry.triggerName);
                state.value = previousValue;
                triggersWithStates.set(entry.triggerName, state);
              }
            }
            player.destroy();
            return;
          }
        }
        const nodeIsOrphaned = !bodyNode || !this.driver.containsElement(bodyNode, element);
        const leaveClassName = leaveNodeMapIds.get(element);
        const enterClassName = enterNodeMapIds.get(element);
        const instruction = this._buildInstruction(entry, subTimelines, enterClassName, leaveClassName, nodeIsOrphaned);
        if (instruction.errors && instruction.errors.length) {
          erroneousTransitions.push(instruction);
          return;
        }
        if (nodeIsOrphaned) {
          player.onStart(() => eraseStyles(element, instruction.fromStyles));
          player.onDestroy(() => setStyles(element, instruction.toStyles));
          skippedPlayers.push(player);
          return;
        }
        if (entry.isFallbackTransition) {
          player.onStart(() => eraseStyles(element, instruction.fromStyles));
          player.onDestroy(() => setStyles(element, instruction.toStyles));
          skippedPlayers.push(player);
          return;
        }
        const timelines = [];
        instruction.timelines.forEach((tl) => {
          tl.stretchStartingKeyframe = true;
          if (!this.disabledNodes.has(tl.element)) {
            timelines.push(tl);
          }
        });
        instruction.timelines = timelines;
        subTimelines.append(element, instruction.timelines);
        const tuple = {
          instruction,
          player,
          element
        };
        queuedInstructions.push(tuple);
        instruction.queriedElements.forEach((element2) => getOrSetDefaultValue(queriedElements, element2, []).push(player));
        instruction.preStyleProps.forEach((stringMap, element2) => {
          if (stringMap.size) {
            let setVal = allPreStyleElements.get(element2);
            if (!setVal) {
              allPreStyleElements.set(element2, setVal = /* @__PURE__ */ new Set());
            }
            stringMap.forEach((_, prop) => setVal.add(prop));
          }
        });
        instruction.postStyleProps.forEach((stringMap, element2) => {
          let setVal = allPostStyleElements.get(element2);
          if (!setVal) {
            allPostStyleElements.set(element2, setVal = /* @__PURE__ */ new Set());
          }
          stringMap.forEach((_, prop) => setVal.add(prop));
        });
      });
    }
    if (erroneousTransitions.length) {
      const errors = [];
      erroneousTransitions.forEach((instruction) => {
        errors.push(transitionFailed(instruction.triggerName, instruction.errors));
      });
      allPlayers.forEach((player) => player.destroy());
      this.reportError(errors);
    }
    const allPreviousPlayersMap = /* @__PURE__ */ new Map();
    const animationElementMap = /* @__PURE__ */ new Map();
    queuedInstructions.forEach((entry) => {
      const element = entry.element;
      if (subTimelines.has(element)) {
        animationElementMap.set(element, element);
        this._beforeAnimationBuild(entry.player.namespaceId, entry.instruction, allPreviousPlayersMap);
      }
    });
    skippedPlayers.forEach((player) => {
      const element = player.element;
      const previousPlayers = this._getPreviousPlayers(element, false, player.namespaceId, player.triggerName, null);
      previousPlayers.forEach((prevPlayer) => {
        getOrSetDefaultValue(allPreviousPlayersMap, element, []).push(prevPlayer);
        prevPlayer.destroy();
      });
    });
    const replaceNodes = allLeaveNodes.filter((node) => {
      return replacePostStylesAsPre(node, allPreStyleElements, allPostStyleElements);
    });
    const postStylesMap = /* @__PURE__ */ new Map();
    const allLeaveQueriedNodes = cloakAndComputeStyles(postStylesMap, this.driver, leaveNodesWithoutAnimations, allPostStyleElements, AUTO_STYLE);
    allLeaveQueriedNodes.forEach((node) => {
      if (replacePostStylesAsPre(node, allPreStyleElements, allPostStyleElements)) {
        replaceNodes.push(node);
      }
    });
    const preStylesMap = /* @__PURE__ */ new Map();
    enterNodeMap.forEach((nodes, root) => {
      cloakAndComputeStyles(preStylesMap, this.driver, new Set(nodes), allPreStyleElements, \u0275PRE_STYLE);
    });
    replaceNodes.forEach((node) => {
      const post = postStylesMap.get(node);
      const pre = preStylesMap.get(node);
      postStylesMap.set(node, new Map([...post?.entries() ?? [], ...pre?.entries() ?? []]));
    });
    const rootPlayers = [];
    const subPlayers = [];
    const NO_PARENT_ANIMATION_ELEMENT_DETECTED = {};
    queuedInstructions.forEach((entry) => {
      const {
        element,
        player,
        instruction
      } = entry;
      if (subTimelines.has(element)) {
        if (disabledElementsSet.has(element)) {
          player.onDestroy(() => setStyles(element, instruction.toStyles));
          player.disabled = true;
          player.overrideTotalTime(instruction.totalTime);
          skippedPlayers.push(player);
          return;
        }
        let parentWithAnimation = NO_PARENT_ANIMATION_ELEMENT_DETECTED;
        if (animationElementMap.size > 1) {
          let elm = element;
          const parentsToAdd = [];
          while (elm = elm.parentNode) {
            const detectedParent = animationElementMap.get(elm);
            if (detectedParent) {
              parentWithAnimation = detectedParent;
              break;
            }
            parentsToAdd.push(elm);
          }
          parentsToAdd.forEach((parent) => animationElementMap.set(parent, parentWithAnimation));
        }
        const innerPlayer = this._buildAnimation(player.namespaceId, instruction, allPreviousPlayersMap, skippedPlayersMap, preStylesMap, postStylesMap);
        player.setRealPlayer(innerPlayer);
        if (parentWithAnimation === NO_PARENT_ANIMATION_ELEMENT_DETECTED) {
          rootPlayers.push(player);
        } else {
          const parentPlayers = this.playersByElement.get(parentWithAnimation);
          if (parentPlayers && parentPlayers.length) {
            player.parentPlayer = optimizeGroupPlayer(parentPlayers);
          }
          skippedPlayers.push(player);
        }
      } else {
        eraseStyles(element, instruction.fromStyles);
        player.onDestroy(() => setStyles(element, instruction.toStyles));
        subPlayers.push(player);
        if (disabledElementsSet.has(element)) {
          skippedPlayers.push(player);
        }
      }
    });
    subPlayers.forEach((player) => {
      const playersForElement = skippedPlayersMap.get(player.element);
      if (playersForElement && playersForElement.length) {
        const innerPlayer = optimizeGroupPlayer(playersForElement);
        player.setRealPlayer(innerPlayer);
      }
    });
    skippedPlayers.forEach((player) => {
      if (player.parentPlayer) {
        player.syncPlayerEvents(player.parentPlayer);
      } else {
        player.destroy();
      }
    });
    for (let i2 = 0; i2 < allLeaveNodes.length; i2++) {
      const element = allLeaveNodes[i2];
      const details = element[REMOVAL_FLAG];
      removeClass(element, LEAVE_CLASSNAME);
      if (details && details.hasAnimation) continue;
      let players = [];
      if (queriedElements.size) {
        let queriedPlayerResults = queriedElements.get(element);
        if (queriedPlayerResults && queriedPlayerResults.length) {
          players.push(...queriedPlayerResults);
        }
        let queriedInnerElements = this.driver.query(element, NG_ANIMATING_SELECTOR, true);
        for (let j = 0; j < queriedInnerElements.length; j++) {
          let queriedPlayers = queriedElements.get(queriedInnerElements[j]);
          if (queriedPlayers && queriedPlayers.length) {
            players.push(...queriedPlayers);
          }
        }
      }
      const activePlayers = players.filter((p) => !p.destroyed);
      if (activePlayers.length) {
        removeNodesAfterAnimationDone(this, element, activePlayers);
      } else {
        this.processLeaveNode(element);
      }
    }
    allLeaveNodes.length = 0;
    rootPlayers.forEach((player) => {
      this.players.push(player);
      player.onDone(() => {
        player.destroy();
        const index = this.players.indexOf(player);
        this.players.splice(index, 1);
      });
      player.play();
    });
    return rootPlayers;
  }
  afterFlush(callback) {
    this._flushFns.push(callback);
  }
  afterFlushAnimationsDone(callback) {
    this._whenQuietFns.push(callback);
  }
  _getPreviousPlayers(element, isQueriedElement, namespaceId, triggerName, toStateValue) {
    let players = [];
    if (isQueriedElement) {
      const queriedElementPlayers = this.playersByQueriedElement.get(element);
      if (queriedElementPlayers) {
        players = queriedElementPlayers;
      }
    } else {
      const elementPlayers = this.playersByElement.get(element);
      if (elementPlayers) {
        const isRemovalAnimation = !toStateValue || toStateValue == VOID_VALUE;
        elementPlayers.forEach((player) => {
          if (player.queued) return;
          if (!isRemovalAnimation && player.triggerName != triggerName) return;
          players.push(player);
        });
      }
    }
    if (namespaceId || triggerName) {
      players = players.filter((player) => {
        if (namespaceId && namespaceId != player.namespaceId) return false;
        if (triggerName && triggerName != player.triggerName) return false;
        return true;
      });
    }
    return players;
  }
  _beforeAnimationBuild(namespaceId, instruction, allPreviousPlayersMap) {
    const triggerName = instruction.triggerName;
    const rootElement = instruction.element;
    const targetNameSpaceId = instruction.isRemovalTransition ? void 0 : namespaceId;
    const targetTriggerName = instruction.isRemovalTransition ? void 0 : triggerName;
    for (const timelineInstruction of instruction.timelines) {
      const element = timelineInstruction.element;
      const isQueriedElement = element !== rootElement;
      const players = getOrSetDefaultValue(allPreviousPlayersMap, element, []);
      const previousPlayers = this._getPreviousPlayers(element, isQueriedElement, targetNameSpaceId, targetTriggerName, instruction.toState);
      previousPlayers.forEach((player) => {
        const realPlayer = player.getRealPlayer();
        if (realPlayer.beforeDestroy) {
          realPlayer.beforeDestroy();
        }
        player.destroy();
        players.push(player);
      });
    }
    eraseStyles(rootElement, instruction.fromStyles);
  }
  _buildAnimation(namespaceId, instruction, allPreviousPlayersMap, skippedPlayersMap, preStylesMap, postStylesMap) {
    const triggerName = instruction.triggerName;
    const rootElement = instruction.element;
    const allQueriedPlayers = [];
    const allConsumedElements = /* @__PURE__ */ new Set();
    const allSubElements = /* @__PURE__ */ new Set();
    const allNewPlayers = instruction.timelines.map((timelineInstruction) => {
      const element = timelineInstruction.element;
      allConsumedElements.add(element);
      const details = element[REMOVAL_FLAG];
      if (details && details.removedBeforeQueried) return new NoopAnimationPlayer(timelineInstruction.duration, timelineInstruction.delay);
      const isQueriedElement = element !== rootElement;
      const previousPlayers = flattenGroupPlayers((allPreviousPlayersMap.get(element) || EMPTY_PLAYER_ARRAY).map((p) => p.getRealPlayer())).filter((p) => {
        const pp = p;
        return pp.element ? pp.element === element : false;
      });
      const preStyles = preStylesMap.get(element);
      const postStyles = postStylesMap.get(element);
      const keyframes = normalizeKeyframes$1(this._normalizer, timelineInstruction.keyframes, preStyles, postStyles);
      const player2 = this._buildPlayer(timelineInstruction, keyframes, previousPlayers);
      if (timelineInstruction.subTimeline && skippedPlayersMap) {
        allSubElements.add(element);
      }
      if (isQueriedElement) {
        const wrappedPlayer = new TransitionAnimationPlayer(namespaceId, triggerName, element);
        wrappedPlayer.setRealPlayer(player2);
        allQueriedPlayers.push(wrappedPlayer);
      }
      return player2;
    });
    allQueriedPlayers.forEach((player2) => {
      getOrSetDefaultValue(this.playersByQueriedElement, player2.element, []).push(player2);
      player2.onDone(() => deleteOrUnsetInMap(this.playersByQueriedElement, player2.element, player2));
    });
    allConsumedElements.forEach((element) => addClass(element, NG_ANIMATING_CLASSNAME));
    const player = optimizeGroupPlayer(allNewPlayers);
    player.onDestroy(() => {
      allConsumedElements.forEach((element) => removeClass(element, NG_ANIMATING_CLASSNAME));
      setStyles(rootElement, instruction.toStyles);
    });
    allSubElements.forEach((element) => {
      getOrSetDefaultValue(skippedPlayersMap, element, []).push(player);
    });
    return player;
  }
  _buildPlayer(instruction, keyframes, previousPlayers) {
    if (keyframes.length > 0) {
      return this.driver.animate(instruction.element, keyframes, instruction.duration, instruction.delay, instruction.easing, previousPlayers);
    }
    return new NoopAnimationPlayer(instruction.duration, instruction.delay);
  }
};
var TransitionAnimationPlayer = class {
  namespaceId;
  triggerName;
  element;
  _player = new NoopAnimationPlayer();
  _containsRealPlayer = false;
  _queuedCallbacks = /* @__PURE__ */ new Map();
  destroyed = false;
  parentPlayer = null;
  markedForDestroy = false;
  disabled = false;
  queued = true;
  totalTime = 0;
  constructor(namespaceId, triggerName, element) {
    this.namespaceId = namespaceId;
    this.triggerName = triggerName;
    this.element = element;
  }
  setRealPlayer(player) {
    if (this._containsRealPlayer) return;
    this._player = player;
    this._queuedCallbacks.forEach((callbacks, phase) => {
      callbacks.forEach((callback) => listenOnPlayer(player, phase, void 0, callback));
    });
    this._queuedCallbacks.clear();
    this._containsRealPlayer = true;
    this.overrideTotalTime(player.totalTime);
    this.queued = false;
  }
  getRealPlayer() {
    return this._player;
  }
  overrideTotalTime(totalTime) {
    this.totalTime = totalTime;
  }
  syncPlayerEvents(player) {
    const p = this._player;
    if (p.triggerCallback) {
      player.onStart(() => p.triggerCallback("start"));
    }
    player.onDone(() => this.finish());
    player.onDestroy(() => this.destroy());
  }
  _queueEvent(name, callback) {
    getOrSetDefaultValue(this._queuedCallbacks, name, []).push(callback);
  }
  onDone(fn) {
    if (this.queued) {
      this._queueEvent("done", fn);
    }
    this._player.onDone(fn);
  }
  onStart(fn) {
    if (this.queued) {
      this._queueEvent("start", fn);
    }
    this._player.onStart(fn);
  }
  onDestroy(fn) {
    if (this.queued) {
      this._queueEvent("destroy", fn);
    }
    this._player.onDestroy(fn);
  }
  init() {
    this._player.init();
  }
  hasStarted() {
    return this.queued ? false : this._player.hasStarted();
  }
  play() {
    !this.queued && this._player.play();
  }
  pause() {
    !this.queued && this._player.pause();
  }
  restart() {
    !this.queued && this._player.restart();
  }
  finish() {
    this._player.finish();
  }
  destroy() {
    this.destroyed = true;
    this._player.destroy();
  }
  reset() {
    !this.queued && this._player.reset();
  }
  setPosition(p) {
    if (!this.queued) {
      this._player.setPosition(p);
    }
  }
  getPosition() {
    return this.queued ? 0 : this._player.getPosition();
  }
  triggerCallback(phaseName) {
    const p = this._player;
    if (p.triggerCallback) {
      p.triggerCallback(phaseName);
    }
  }
};
function deleteOrUnsetInMap(map2, key, value) {
  let currentValues = map2.get(key);
  if (currentValues) {
    if (currentValues.length) {
      const index = currentValues.indexOf(value);
      currentValues.splice(index, 1);
    }
    if (currentValues.length == 0) {
      map2.delete(key);
    }
  }
  return currentValues;
}
function normalizeTriggerValue(value) {
  return value != null ? value : null;
}
function isElementNode(node) {
  return node && node["nodeType"] === 1;
}
function isTriggerEventValid(eventName) {
  return eventName == "start" || eventName == "done";
}
function cloakElement(element, value) {
  const oldValue = element.style.display;
  element.style.display = value != null ? value : "none";
  return oldValue;
}
function cloakAndComputeStyles(valuesMap, driver, elements, elementPropsMap, defaultStyle) {
  const cloakVals = [];
  elements.forEach((element) => cloakVals.push(cloakElement(element)));
  const failedElements = [];
  elementPropsMap.forEach((props, element) => {
    const styles = /* @__PURE__ */ new Map();
    props.forEach((prop) => {
      const value = driver.computeStyle(element, prop, defaultStyle);
      styles.set(prop, value);
      if (!value || value.length == 0) {
        element[REMOVAL_FLAG] = NULL_REMOVED_QUERIED_STATE;
        failedElements.push(element);
      }
    });
    valuesMap.set(element, styles);
  });
  let i = 0;
  elements.forEach((element) => cloakElement(element, cloakVals[i++]));
  return failedElements;
}
function buildRootMap(roots, nodes) {
  const rootMap = /* @__PURE__ */ new Map();
  roots.forEach((root) => rootMap.set(root, []));
  if (nodes.length == 0) return rootMap;
  const NULL_NODE = 1;
  const nodeSet = new Set(nodes);
  const localRootMap = /* @__PURE__ */ new Map();
  function getRoot(node) {
    if (!node) return NULL_NODE;
    let root = localRootMap.get(node);
    if (root) return root;
    const parent = node.parentNode;
    if (rootMap.has(parent)) {
      root = parent;
    } else if (nodeSet.has(parent)) {
      root = NULL_NODE;
    } else {
      root = getRoot(parent);
    }
    localRootMap.set(node, root);
    return root;
  }
  nodes.forEach((node) => {
    const root = getRoot(node);
    if (root !== NULL_NODE) {
      rootMap.get(root).push(node);
    }
  });
  return rootMap;
}
function addClass(element, className) {
  element.classList?.add(className);
}
function removeClass(element, className) {
  element.classList?.remove(className);
}
function removeNodesAfterAnimationDone(engine, element, players) {
  optimizeGroupPlayer(players).onDone(() => engine.processLeaveNode(element));
}
function flattenGroupPlayers(players) {
  const finalPlayers = [];
  _flattenGroupPlayersRecur(players, finalPlayers);
  return finalPlayers;
}
function _flattenGroupPlayersRecur(players, finalPlayers) {
  for (let i = 0; i < players.length; i++) {
    const player = players[i];
    if (player instanceof AnimationGroupPlayer) {
      _flattenGroupPlayersRecur(player.players, finalPlayers);
    } else {
      finalPlayers.push(player);
    }
  }
}
function objEquals(a, b) {
  const k1 = Object.keys(a);
  const k2 = Object.keys(b);
  if (k1.length != k2.length) return false;
  for (let i = 0; i < k1.length; i++) {
    const prop = k1[i];
    if (!b.hasOwnProperty(prop) || a[prop] !== b[prop]) return false;
  }
  return true;
}
function replacePostStylesAsPre(element, allPreStyleElements, allPostStyleElements) {
  const postEntry = allPostStyleElements.get(element);
  if (!postEntry) return false;
  let preEntry = allPreStyleElements.get(element);
  if (preEntry) {
    postEntry.forEach((data) => preEntry.add(data));
  } else {
    allPreStyleElements.set(element, postEntry);
  }
  allPostStyleElements.delete(element);
  return true;
}
var AnimationEngine = class {
  _driver;
  _normalizer;
  _transitionEngine;
  _timelineEngine;
  _triggerCache = {};
  onRemovalComplete = (element, context) => {
  };
  constructor(doc, _driver, _normalizer) {
    this._driver = _driver;
    this._normalizer = _normalizer;
    this._transitionEngine = new TransitionAnimationEngine(doc.body, _driver, _normalizer);
    this._timelineEngine = new TimelineAnimationEngine(doc.body, _driver, _normalizer);
    this._transitionEngine.onRemovalComplete = (element, context) => this.onRemovalComplete(element, context);
  }
  registerTrigger(componentId, namespaceId, hostElement, name, metadata) {
    const cacheKey = componentId + "-" + name;
    let trigger = this._triggerCache[cacheKey];
    if (!trigger) {
      const errors = [];
      const warnings = [];
      const ast = buildAnimationAst(this._driver, metadata, errors, warnings);
      if (errors.length) {
        throw triggerBuildFailed(name, errors);
      }
      if (typeof ngDevMode === "undefined" || ngDevMode) {
        if (warnings.length) {
          warnTriggerBuild(name, warnings);
        }
      }
      trigger = buildTrigger(name, ast, this._normalizer);
      this._triggerCache[cacheKey] = trigger;
    }
    this._transitionEngine.registerTrigger(namespaceId, name, trigger);
  }
  register(namespaceId, hostElement) {
    this._transitionEngine.register(namespaceId, hostElement);
  }
  destroy(namespaceId, context) {
    this._transitionEngine.destroy(namespaceId, context);
  }
  onInsert(namespaceId, element, parent, insertBefore) {
    this._transitionEngine.insertNode(namespaceId, element, parent, insertBefore);
  }
  onRemove(namespaceId, element, context) {
    this._transitionEngine.removeNode(namespaceId, element, context);
  }
  disableAnimations(element, disable) {
    this._transitionEngine.markElementAsDisabled(element, disable);
  }
  process(namespaceId, element, property, value) {
    if (property.charAt(0) == "@") {
      const [id, action] = parseTimelineCommand(property);
      const args = value;
      this._timelineEngine.command(id, element, action, args);
    } else {
      this._transitionEngine.trigger(namespaceId, element, property, value);
    }
  }
  listen(namespaceId, element, eventName, eventPhase, callback) {
    if (eventName.charAt(0) == "@") {
      const [id, action] = parseTimelineCommand(eventName);
      return this._timelineEngine.listen(id, element, action, callback);
    }
    return this._transitionEngine.listen(namespaceId, element, eventName, eventPhase, callback);
  }
  flush(microtaskId = -1) {
    this._transitionEngine.flush(microtaskId);
  }
  get players() {
    return [...this._transitionEngine.players, ...this._timelineEngine.players];
  }
  whenRenderingDone() {
    return this._transitionEngine.whenRenderingDone();
  }
  afterFlushAnimationsDone(cb) {
    this._transitionEngine.afterFlushAnimationsDone(cb);
  }
};
function packageNonAnimatableStyles(element, styles) {
  let startStyles = null;
  let endStyles = null;
  if (Array.isArray(styles) && styles.length) {
    startStyles = filterNonAnimatableStyles(styles[0]);
    if (styles.length > 1) {
      endStyles = filterNonAnimatableStyles(styles[styles.length - 1]);
    }
  } else if (styles instanceof Map) {
    startStyles = filterNonAnimatableStyles(styles);
  }
  return startStyles || endStyles ? new SpecialCasedStyles(element, startStyles, endStyles) : null;
}
var SpecialCasedStyles = class _SpecialCasedStyles {
  _element;
  _startStyles;
  _endStyles;
  static initialStylesByElement = /* @__PURE__ */ new WeakMap();
  _state = 0;
  _initialStyles;
  constructor(_element, _startStyles, _endStyles) {
    this._element = _element;
    this._startStyles = _startStyles;
    this._endStyles = _endStyles;
    let initialStyles = _SpecialCasedStyles.initialStylesByElement.get(_element);
    if (!initialStyles) {
      _SpecialCasedStyles.initialStylesByElement.set(_element, initialStyles = /* @__PURE__ */ new Map());
    }
    this._initialStyles = initialStyles;
  }
  start() {
    if (this._state < 1) {
      if (this._startStyles) {
        setStyles(this._element, this._startStyles, this._initialStyles);
      }
      this._state = 1;
    }
  }
  finish() {
    this.start();
    if (this._state < 2) {
      setStyles(this._element, this._initialStyles);
      if (this._endStyles) {
        setStyles(this._element, this._endStyles);
        this._endStyles = null;
      }
      this._state = 1;
    }
  }
  destroy() {
    this.finish();
    if (this._state < 3) {
      _SpecialCasedStyles.initialStylesByElement.delete(this._element);
      if (this._startStyles) {
        eraseStyles(this._element, this._startStyles);
        this._endStyles = null;
      }
      if (this._endStyles) {
        eraseStyles(this._element, this._endStyles);
        this._endStyles = null;
      }
      setStyles(this._element, this._initialStyles);
      this._state = 3;
    }
  }
};
function filterNonAnimatableStyles(styles) {
  let result = null;
  styles.forEach((val, prop) => {
    if (isNonAnimatableStyle(prop)) {
      result = result || /* @__PURE__ */ new Map();
      result.set(prop, val);
    }
  });
  return result;
}
function isNonAnimatableStyle(prop) {
  return prop === "display" || prop === "position";
}
var WebAnimationsPlayer = class {
  element;
  keyframes;
  options;
  _specialStyles;
  _onDoneFns = [];
  _onStartFns = [];
  _onDestroyFns = [];
  _duration;
  _delay;
  _initialized = false;
  _finished = false;
  _started = false;
  _destroyed = false;
  _finalKeyframe;
  _originalOnDoneFns = [];
  _originalOnStartFns = [];
  domPlayer = null;
  time = 0;
  parentPlayer = null;
  currentSnapshot = /* @__PURE__ */ new Map();
  constructor(element, keyframes, options, _specialStyles) {
    this.element = element;
    this.keyframes = keyframes;
    this.options = options;
    this._specialStyles = _specialStyles;
    this._duration = options["duration"];
    this._delay = options["delay"] || 0;
    this.time = this._duration + this._delay;
  }
  _onFinish() {
    if (!this._finished) {
      this._finished = true;
      this._onDoneFns.forEach((fn) => fn());
      this._onDoneFns = [];
    }
  }
  init() {
    if (!this._buildPlayer()) {
      return;
    }
    this._preparePlayerBeforeStart();
  }
  _buildPlayer() {
    if (this._initialized) return this.domPlayer;
    this._initialized = true;
    const keyframes = this.keyframes;
    const animation = this._triggerWebAnimation(this.element, keyframes, this.options);
    if (!animation) {
      this._onFinish();
      return null;
    }
    this.domPlayer = animation;
    this._finalKeyframe = keyframes.length ? keyframes[keyframes.length - 1] : /* @__PURE__ */ new Map();
    const onFinish = () => this._onFinish();
    animation.addEventListener("finish", onFinish);
    this.onDestroy(() => {
      animation.removeEventListener("finish", onFinish);
    });
    return animation;
  }
  _preparePlayerBeforeStart() {
    if (this._delay) {
      this._resetDomPlayerState();
    } else {
      this.domPlayer?.pause();
    }
  }
  _convertKeyframesToObject(keyframes) {
    const kfs = [];
    keyframes.forEach((frame) => {
      kfs.push(Object.fromEntries(frame));
    });
    return kfs;
  }
  _triggerWebAnimation(element, keyframes, options) {
    const keyframesObject = this._convertKeyframesToObject(keyframes);
    try {
      return element.animate(keyframesObject, options);
    } catch {
      return null;
    }
  }
  onStart(fn) {
    this._originalOnStartFns.push(fn);
    this._onStartFns.push(fn);
  }
  onDone(fn) {
    this._originalOnDoneFns.push(fn);
    this._onDoneFns.push(fn);
  }
  onDestroy(fn) {
    this._onDestroyFns.push(fn);
  }
  play() {
    const player = this._buildPlayer();
    if (!player) {
      return;
    }
    if (!this.hasStarted()) {
      this._onStartFns.forEach((fn) => fn());
      this._onStartFns = [];
      this._started = true;
      if (this._specialStyles) {
        this._specialStyles.start();
      }
    }
    player.play();
  }
  pause() {
    this.init();
    this.domPlayer?.pause();
  }
  finish() {
    this.init();
    if (!this.domPlayer) return;
    if (this._specialStyles) {
      this._specialStyles.finish();
    }
    this._onFinish();
    this.domPlayer.finish();
  }
  reset() {
    this._resetDomPlayerState();
    this._destroyed = false;
    this._finished = false;
    this._started = false;
    this._onStartFns = this._originalOnStartFns;
    this._onDoneFns = this._originalOnDoneFns;
  }
  _resetDomPlayerState() {
    this.domPlayer?.cancel();
  }
  restart() {
    this.reset();
    this.play();
  }
  hasStarted() {
    return this._started;
  }
  destroy() {
    if (!this._destroyed) {
      this._destroyed = true;
      this._resetDomPlayerState();
      this._onFinish();
      if (this._specialStyles) {
        this._specialStyles.destroy();
      }
      this._onDestroyFns.forEach((fn) => fn());
      this._onDestroyFns = [];
    }
  }
  setPosition(p) {
    if (!this.domPlayer) {
      this.init();
    }
    if (this.domPlayer) {
      this.domPlayer.currentTime = p * this.time;
    }
  }
  getPosition() {
    if (!this.domPlayer) {
      return this._initialized ? 1 : 0;
    }
    return +(this.domPlayer.currentTime ?? 0) / this.time;
  }
  get totalTime() {
    return this._delay + this._duration;
  }
  beforeDestroy() {
    const styles = /* @__PURE__ */ new Map();
    if (this.hasStarted()) {
      const finalKeyframe = this._finalKeyframe;
      finalKeyframe.forEach((val, prop) => {
        if (prop !== "offset") {
          styles.set(prop, this._finished ? val : computeStyle(this.element, prop));
        }
      });
    }
    this.currentSnapshot = styles;
  }
  triggerCallback(phaseName) {
    const methods = phaseName === "start" ? this._onStartFns : this._onDoneFns;
    methods.forEach((fn) => fn());
    methods.length = 0;
  }
};
var WebAnimationsDriver = class {
  validateStyleProperty(prop) {
    if (typeof ngDevMode === "undefined" || ngDevMode) {
      return validateStyleProperty(prop);
    }
    return true;
  }
  validateAnimatableStyleProperty(prop) {
    if (typeof ngDevMode === "undefined" || ngDevMode) {
      const cssProp = camelCaseToDashCase(prop);
      return validateWebAnimatableStyleProperty(cssProp);
    }
    return true;
  }
  containsElement(elm1, elm2) {
    return containsElement(elm1, elm2);
  }
  getParentElement(element) {
    return getParentElement(element);
  }
  query(element, selector, multi) {
    return invokeQuery(element, selector, multi);
  }
  computeStyle(element, prop, defaultValue) {
    return computeStyle(element, prop);
  }
  animate(element, keyframes, duration, delay, easing, previousPlayers = []) {
    const fill = delay == 0 ? "both" : "forwards";
    const playerOptions = {
      duration,
      delay,
      fill
    };
    if (easing) {
      playerOptions["easing"] = easing;
    }
    const previousStyles = /* @__PURE__ */ new Map();
    const previousWebAnimationPlayers = previousPlayers.filter((player) => player instanceof WebAnimationsPlayer);
    if (allowPreviousPlayerStylesMerge(duration, delay)) {
      previousWebAnimationPlayers.forEach((player) => {
        player.currentSnapshot.forEach((val, prop) => previousStyles.set(prop, val));
      });
    }
    let _keyframes = normalizeKeyframes(keyframes).map((styles) => new Map(styles));
    _keyframes = balancePreviousStylesIntoKeyframes(element, _keyframes, previousStyles);
    const specialStyles = packageNonAnimatableStyles(element, _keyframes);
    return new WebAnimationsPlayer(element, _keyframes, playerOptions, specialStyles);
  }
};
var ANIMATION_PREFIX = "@";
var DISABLE_ANIMATIONS_FLAG = "@.disabled";
var BaseAnimationRenderer = class {
  namespaceId;
  delegate;
  engine;
  _onDestroy;
  \u0275type = 0;
  constructor(namespaceId, delegate, engine, _onDestroy) {
    this.namespaceId = namespaceId;
    this.delegate = delegate;
    this.engine = engine;
    this._onDestroy = _onDestroy;
  }
  get data() {
    return this.delegate.data;
  }
  destroyNode(node) {
    this.delegate.destroyNode?.(node);
  }
  destroy() {
    this.engine.destroy(this.namespaceId, this.delegate);
    this.engine.afterFlushAnimationsDone(() => {
      queueMicrotask(() => {
        this.delegate.destroy();
      });
    });
    this._onDestroy?.();
  }
  createElement(name, namespace) {
    return this.delegate.createElement(name, namespace);
  }
  createComment(value) {
    return this.delegate.createComment(value);
  }
  createText(value) {
    return this.delegate.createText(value);
  }
  appendChild(parent, newChild) {
    this.delegate.appendChild(parent, newChild);
    this.engine.onInsert(this.namespaceId, newChild, parent, false);
  }
  insertBefore(parent, newChild, refChild, isMove = true) {
    this.delegate.insertBefore(parent, newChild, refChild);
    this.engine.onInsert(this.namespaceId, newChild, parent, isMove);
  }
  removeChild(parent, oldChild, isHostElement, requireSynchronousElementRemoval) {
    if (requireSynchronousElementRemoval) {
      this.delegate.removeChild(parent, oldChild, isHostElement, requireSynchronousElementRemoval);
      return;
    }
    if (this.parentNode(oldChild)) {
      this.engine.onRemove(this.namespaceId, oldChild, this.delegate);
    }
  }
  selectRootElement(selectorOrNode, preserveContent) {
    return this.delegate.selectRootElement(selectorOrNode, preserveContent);
  }
  parentNode(node) {
    return this.delegate.parentNode(node);
  }
  nextSibling(node) {
    return this.delegate.nextSibling(node);
  }
  setAttribute(el, name, value, namespace) {
    this.delegate.setAttribute(el, name, value, namespace);
  }
  removeAttribute(el, name, namespace) {
    this.delegate.removeAttribute(el, name, namespace);
  }
  addClass(el, name) {
    this.delegate.addClass(el, name);
  }
  removeClass(el, name) {
    this.delegate.removeClass(el, name);
  }
  setStyle(el, style2, value, flags) {
    this.delegate.setStyle(el, style2, value, flags);
  }
  removeStyle(el, style2, flags) {
    this.delegate.removeStyle(el, style2, flags);
  }
  setProperty(el, name, value) {
    if (name.charAt(0) == ANIMATION_PREFIX && name == DISABLE_ANIMATIONS_FLAG) {
      this.disableAnimations(el, !!value);
    } else {
      this.delegate.setProperty(el, name, value);
    }
  }
  setValue(node, value) {
    this.delegate.setValue(node, value);
  }
  listen(target, eventName, callback, options) {
    return this.delegate.listen(target, eventName, callback, options);
  }
  disableAnimations(element, value) {
    this.engine.disableAnimations(element, value);
  }
};
var AnimationRenderer = class extends BaseAnimationRenderer {
  factory;
  constructor(factory, namespaceId, delegate, engine, onDestroy) {
    super(namespaceId, delegate, engine, onDestroy);
    this.factory = factory;
    this.namespaceId = namespaceId;
  }
  setProperty(el, name, value) {
    if (name.charAt(0) == ANIMATION_PREFIX) {
      if (name.charAt(1) == "." && name == DISABLE_ANIMATIONS_FLAG) {
        value = value === void 0 ? true : !!value;
        this.disableAnimations(el, value);
      } else {
        this.engine.process(this.namespaceId, el, name.slice(1), value);
      }
    } else {
      this.delegate.setProperty(el, name, value);
    }
  }
  listen(target, eventName, callback, options) {
    if (eventName.charAt(0) == ANIMATION_PREFIX) {
      const element = resolveElementFromTarget(target);
      let name = eventName.slice(1);
      let phase = "";
      if (name.charAt(0) != ANIMATION_PREFIX) {
        [name, phase] = parseTriggerCallbackName(name);
      }
      return this.engine.listen(this.namespaceId, element, name, phase, (event) => {
        const countId = event["_data"] || -1;
        this.factory.scheduleListenerCallback(countId, callback, event);
      });
    }
    return this.delegate.listen(target, eventName, callback, options);
  }
};
function resolveElementFromTarget(target) {
  switch (target) {
    case "body":
      return document.body;
    case "document":
      return document;
    case "window":
      return window;
    default:
      return target;
  }
}
function parseTriggerCallbackName(triggerName) {
  const dotIndex = triggerName.indexOf(".");
  const trigger = triggerName.substring(0, dotIndex);
  const phase = triggerName.slice(dotIndex + 1);
  return [trigger, phase];
}
var AnimationRendererFactory = class {
  delegate;
  engine;
  _zone;
  _currentId = 0;
  _microtaskId = 1;
  _animationCallbacksBuffer = [];
  _rendererCache = /* @__PURE__ */ new Map();
  _cdRecurDepth = 0;
  constructor(delegate, engine, _zone) {
    this.delegate = delegate;
    this.engine = engine;
    this._zone = _zone;
    engine.onRemovalComplete = (element, delegate2) => {
      delegate2?.removeChild(null, element);
    };
  }
  createRenderer(hostElement, type) {
    const EMPTY_NAMESPACE_ID = "";
    const delegate = this.delegate.createRenderer(hostElement, type);
    if (!hostElement || !type?.data?.["animation"]) {
      const cache = this._rendererCache;
      let renderer = cache.get(delegate);
      if (!renderer) {
        const onRendererDestroy = () => cache.delete(delegate);
        renderer = new BaseAnimationRenderer(EMPTY_NAMESPACE_ID, delegate, this.engine, onRendererDestroy);
        cache.set(delegate, renderer);
      }
      return renderer;
    }
    const componentId = type.id;
    const namespaceId = type.id + "-" + this._currentId;
    this._currentId++;
    this.engine.register(namespaceId, hostElement);
    const registerTrigger = (trigger) => {
      if (Array.isArray(trigger)) {
        trigger.forEach(registerTrigger);
      } else {
        this.engine.registerTrigger(componentId, namespaceId, hostElement, trigger.name, trigger);
      }
    };
    const animationTriggers = type.data["animation"];
    animationTriggers.forEach(registerTrigger);
    return new AnimationRenderer(this, namespaceId, delegate, this.engine);
  }
  begin() {
    this._cdRecurDepth++;
    if (this.delegate.begin) {
      this.delegate.begin();
    }
  }
  _scheduleCountTask() {
    queueMicrotask(() => {
      this._microtaskId++;
    });
  }
  scheduleListenerCallback(count, fn, data) {
    if (count >= 0 && count < this._microtaskId) {
      this._zone.run(() => fn(data));
      return;
    }
    const animationCallbacksBuffer = this._animationCallbacksBuffer;
    if (animationCallbacksBuffer.length == 0) {
      queueMicrotask(() => {
        this._zone.run(() => {
          animationCallbacksBuffer.forEach((tuple) => {
            const [fn2, data2] = tuple;
            fn2(data2);
          });
          this._animationCallbacksBuffer = [];
        });
      });
    }
    animationCallbacksBuffer.push([fn, data]);
  }
  end() {
    this._cdRecurDepth--;
    if (this._cdRecurDepth == 0) {
      this._zone.runOutsideAngular(() => {
        this._scheduleCountTask();
        this.engine.flush(this._microtaskId);
      });
    }
    if (this.delegate.end) {
      this.delegate.end();
    }
  }
  whenRenderingDone() {
    return this.engine.whenRenderingDone();
  }
  componentReplaced(componentId) {
    this.engine.flush();
    this.delegate.componentReplaced?.(componentId);
  }
};

// node_modules/@angular/platform-browser/fesm2022/animations.mjs
var InjectableAnimationEngine = class _InjectableAnimationEngine extends AnimationEngine {
  constructor(doc, driver, normalizer) {
    super(doc, driver, normalizer);
  }
  ngOnDestroy() {
    this.flush();
  }
  static \u0275fac = function InjectableAnimationEngine_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _InjectableAnimationEngine)(\u0275\u0275inject(DOCUMENT), \u0275\u0275inject(AnimationDriver), \u0275\u0275inject(AnimationStyleNormalizer));
  };
  static \u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({
    token: _InjectableAnimationEngine,
    factory: _InjectableAnimationEngine.\u0275fac
  });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(InjectableAnimationEngine, [{
    type: Injectable
  }], () => [{
    type: Document,
    decorators: [{
      type: Inject,
      args: [DOCUMENT]
    }]
  }, {
    type: AnimationDriver
  }, {
    type: AnimationStyleNormalizer
  }], null);
})();
function instantiateDefaultStyleNormalizer() {
  return new WebAnimationsStyleNormalizer();
}
function instantiateRendererFactory() {
  return new AnimationRendererFactory(inject(DomRendererFactory2), inject(AnimationEngine), inject(NgZone));
}
var SHARED_ANIMATION_PROVIDERS = [{
  provide: AnimationStyleNormalizer,
  useFactory: instantiateDefaultStyleNormalizer
}, {
  provide: AnimationEngine,
  useClass: InjectableAnimationEngine
}, {
  provide: RendererFactory2,
  useFactory: instantiateRendererFactory
}];
var BROWSER_NOOP_ANIMATIONS_PROVIDERS = [{
  provide: AnimationDriver,
  useClass: NoopAnimationDriver
}, {
  provide: ANIMATION_MODULE_TYPE,
  useValue: "NoopAnimations"
}, ...SHARED_ANIMATION_PROVIDERS];
var BROWSER_ANIMATIONS_PROVIDERS = [{
  provide: AnimationDriver,
  useFactory: () => false ? new NoopAnimationDriver() : new WebAnimationsDriver()
}, {
  provide: ANIMATION_MODULE_TYPE,
  useFactory: () => false ? "NoopAnimations" : "BrowserAnimations"
}, ...SHARED_ANIMATION_PROVIDERS];
var BrowserAnimationsModule = class _BrowserAnimationsModule {
  static withConfig(config) {
    return {
      ngModule: _BrowserAnimationsModule,
      providers: config.disableAnimations ? BROWSER_NOOP_ANIMATIONS_PROVIDERS : BROWSER_ANIMATIONS_PROVIDERS
    };
  }
  static \u0275fac = function BrowserAnimationsModule_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _BrowserAnimationsModule)();
  };
  static \u0275mod = /* @__PURE__ */ \u0275\u0275defineNgModule({
    type: _BrowserAnimationsModule,
    exports: [BrowserModule]
  });
  static \u0275inj = /* @__PURE__ */ \u0275\u0275defineInjector({
    providers: BROWSER_ANIMATIONS_PROVIDERS,
    imports: [BrowserModule]
  });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(BrowserAnimationsModule, [{
    type: NgModule,
    args: [{
      exports: [BrowserModule],
      providers: BROWSER_ANIMATIONS_PROVIDERS
    }]
  }], null, null);
})();
function provideAnimations() {
  performanceMarkFeature("NgEagerAnimations");
  return [...BROWSER_ANIMATIONS_PROVIDERS];
}
var NoopAnimationsModule = class _NoopAnimationsModule {
  static \u0275fac = function NoopAnimationsModule_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _NoopAnimationsModule)();
  };
  static \u0275mod = /* @__PURE__ */ \u0275\u0275defineNgModule({
    type: _NoopAnimationsModule,
    exports: [BrowserModule]
  });
  static \u0275inj = /* @__PURE__ */ \u0275\u0275defineInjector({
    providers: BROWSER_NOOP_ANIMATIONS_PROVIDERS,
    imports: [BrowserModule]
  });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(NoopAnimationsModule, [{
    type: NgModule,
    args: [{
      exports: [BrowserModule],
      providers: BROWSER_NOOP_ANIMATIONS_PROVIDERS
    }]
  }], null, null);
})();

// node_modules/@google/genai/dist/web/index.mjs
var _defaultBaseGeminiUrl = void 0;
var _defaultBaseVertexUrl = void 0;
function getDefaultBaseUrls() {
  return {
    geminiUrl: _defaultBaseGeminiUrl,
    vertexUrl: _defaultBaseVertexUrl
  };
}
function getBaseUrl(httpOptions, vertexai, vertexBaseUrlFromEnv, geminiBaseUrlFromEnv) {
  var _a2, _b;
  if (!(httpOptions === null || httpOptions === void 0 ? void 0 : httpOptions.baseUrl)) {
    const defaultBaseUrls = getDefaultBaseUrls();
    if (vertexai) {
      return (_a2 = defaultBaseUrls.vertexUrl) !== null && _a2 !== void 0 ? _a2 : vertexBaseUrlFromEnv;
    } else {
      return (_b = defaultBaseUrls.geminiUrl) !== null && _b !== void 0 ? _b : geminiBaseUrlFromEnv;
    }
  }
  return httpOptions.baseUrl;
}
var BaseModule = class {
};
function formatMap(templateString, valueMap) {
  const regex = /\{([^}]+)\}/g;
  return templateString.replace(regex, (match, key) => {
    if (Object.prototype.hasOwnProperty.call(valueMap, key)) {
      const value = valueMap[key];
      return value !== void 0 && value !== null ? String(value) : "";
    } else {
      throw new Error(`Key '${key}' not found in valueMap.`);
    }
  });
}
function setValueByPath(data, keys, value) {
  for (let i = 0; i < keys.length - 1; i++) {
    const key = keys[i];
    if (key.endsWith("[]")) {
      const keyName = key.slice(0, -2);
      if (!(keyName in data)) {
        if (Array.isArray(value)) {
          data[keyName] = Array.from({ length: value.length }, () => ({}));
        } else {
          throw new Error(`Value must be a list given an array path ${key}`);
        }
      }
      if (Array.isArray(data[keyName])) {
        const arrayData = data[keyName];
        if (Array.isArray(value)) {
          for (let j = 0; j < arrayData.length; j++) {
            const entry = arrayData[j];
            setValueByPath(entry, keys.slice(i + 1), value[j]);
          }
        } else {
          for (const d of arrayData) {
            setValueByPath(d, keys.slice(i + 1), value);
          }
        }
      }
      return;
    } else if (key.endsWith("[0]")) {
      const keyName = key.slice(0, -3);
      if (!(keyName in data)) {
        data[keyName] = [{}];
      }
      const arrayData = data[keyName];
      setValueByPath(arrayData[0], keys.slice(i + 1), value);
      return;
    }
    if (!data[key] || typeof data[key] !== "object") {
      data[key] = {};
    }
    data = data[key];
  }
  const keyToSet = keys[keys.length - 1];
  const existingData = data[keyToSet];
  if (existingData !== void 0) {
    if (!value || typeof value === "object" && Object.keys(value).length === 0) {
      return;
    }
    if (value === existingData) {
      return;
    }
    if (typeof existingData === "object" && typeof value === "object" && existingData !== null && value !== null) {
      Object.assign(existingData, value);
    } else {
      throw new Error(`Cannot set value for an existing key. Key: ${keyToSet}`);
    }
  } else {
    if (keyToSet === "_self" && typeof value === "object" && value !== null && !Array.isArray(value)) {
      const valueAsRecord = value;
      Object.assign(data, valueAsRecord);
    } else {
      data[keyToSet] = value;
    }
  }
}
function getValueByPath(data, keys, defaultValue = void 0) {
  try {
    if (keys.length === 1 && keys[0] === "_self") {
      return data;
    }
    for (let i = 0; i < keys.length; i++) {
      if (typeof data !== "object" || data === null) {
        return defaultValue;
      }
      const key = keys[i];
      if (key.endsWith("[]")) {
        const keyName = key.slice(0, -2);
        if (keyName in data) {
          const arrayData = data[keyName];
          if (!Array.isArray(arrayData)) {
            return defaultValue;
          }
          return arrayData.map((d) => getValueByPath(d, keys.slice(i + 1), defaultValue));
        } else {
          return defaultValue;
        }
      } else {
        data = data[key];
      }
    }
    return data;
  } catch (error) {
    if (error instanceof TypeError) {
      return defaultValue;
    }
    throw error;
  }
}
function moveValueByPath(data, paths) {
  for (const [sourcePath, destPath] of Object.entries(paths)) {
    const sourceKeys = sourcePath.split(".");
    const destKeys = destPath.split(".");
    const excludeKeys = /* @__PURE__ */ new Set();
    let wildcardIdx = -1;
    for (let i = 0; i < sourceKeys.length; i++) {
      if (sourceKeys[i] === "*") {
        wildcardIdx = i;
        break;
      }
    }
    if (wildcardIdx !== -1 && destKeys.length > wildcardIdx) {
      for (let i = wildcardIdx; i < destKeys.length; i++) {
        const key = destKeys[i];
        if (key !== "*" && !key.endsWith("[]") && !key.endsWith("[0]")) {
          excludeKeys.add(key);
        }
      }
    }
    _moveValueRecursive(data, sourceKeys, destKeys, 0, excludeKeys);
  }
}
function _moveValueRecursive(data, sourceKeys, destKeys, keyIdx, excludeKeys) {
  if (keyIdx >= sourceKeys.length) {
    return;
  }
  if (typeof data !== "object" || data === null) {
    return;
  }
  const key = sourceKeys[keyIdx];
  if (key.endsWith("[]")) {
    const keyName = key.slice(0, -2);
    const dataRecord = data;
    if (keyName in dataRecord && Array.isArray(dataRecord[keyName])) {
      for (const item of dataRecord[keyName]) {
        _moveValueRecursive(item, sourceKeys, destKeys, keyIdx + 1, excludeKeys);
      }
    }
  } else if (key === "*") {
    if (typeof data === "object" && data !== null && !Array.isArray(data)) {
      const dataRecord = data;
      const keysToMove = Object.keys(dataRecord).filter((k) => !k.startsWith("_") && !excludeKeys.has(k));
      const valuesToMove = {};
      for (const k of keysToMove) {
        valuesToMove[k] = dataRecord[k];
      }
      for (const [k, v] of Object.entries(valuesToMove)) {
        const newDestKeys = [];
        for (const dk of destKeys.slice(keyIdx)) {
          if (dk === "*") {
            newDestKeys.push(k);
          } else {
            newDestKeys.push(dk);
          }
        }
        setValueByPath(dataRecord, newDestKeys, v);
      }
      for (const k of keysToMove) {
        delete dataRecord[k];
      }
    }
  } else {
    const dataRecord = data;
    if (key in dataRecord) {
      _moveValueRecursive(dataRecord[key], sourceKeys, destKeys, keyIdx + 1, excludeKeys);
    }
  }
}
function tBytes$1(fromBytes) {
  if (typeof fromBytes !== "string") {
    throw new Error("fromImageBytes must be a string");
  }
  return fromBytes;
}
function fetchPredictOperationParametersToVertex(fromObject) {
  const toObject = {};
  const fromOperationName = getValueByPath(fromObject, [
    "operationName"
  ]);
  if (fromOperationName != null) {
    setValueByPath(toObject, ["operationName"], fromOperationName);
  }
  const fromResourceName = getValueByPath(fromObject, ["resourceName"]);
  if (fromResourceName != null) {
    setValueByPath(toObject, ["_url", "resourceName"], fromResourceName);
  }
  return toObject;
}
function generateVideosOperationFromMldev$1(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromMetadata = getValueByPath(fromObject, ["metadata"]);
  if (fromMetadata != null) {
    setValueByPath(toObject, ["metadata"], fromMetadata);
  }
  const fromDone = getValueByPath(fromObject, ["done"]);
  if (fromDone != null) {
    setValueByPath(toObject, ["done"], fromDone);
  }
  const fromError = getValueByPath(fromObject, ["error"]);
  if (fromError != null) {
    setValueByPath(toObject, ["error"], fromError);
  }
  const fromResponse = getValueByPath(fromObject, [
    "response",
    "generateVideoResponse"
  ]);
  if (fromResponse != null) {
    setValueByPath(toObject, ["response"], generateVideosResponseFromMldev$1(fromResponse));
  }
  return toObject;
}
function generateVideosOperationFromVertex$1(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromMetadata = getValueByPath(fromObject, ["metadata"]);
  if (fromMetadata != null) {
    setValueByPath(toObject, ["metadata"], fromMetadata);
  }
  const fromDone = getValueByPath(fromObject, ["done"]);
  if (fromDone != null) {
    setValueByPath(toObject, ["done"], fromDone);
  }
  const fromError = getValueByPath(fromObject, ["error"]);
  if (fromError != null) {
    setValueByPath(toObject, ["error"], fromError);
  }
  const fromResponse = getValueByPath(fromObject, ["response"]);
  if (fromResponse != null) {
    setValueByPath(toObject, ["response"], generateVideosResponseFromVertex$1(fromResponse));
  }
  return toObject;
}
function generateVideosResponseFromMldev$1(fromObject) {
  const toObject = {};
  const fromGeneratedVideos = getValueByPath(fromObject, [
    "generatedSamples"
  ]);
  if (fromGeneratedVideos != null) {
    let transformedList = fromGeneratedVideos;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return generatedVideoFromMldev$1(item);
      });
    }
    setValueByPath(toObject, ["generatedVideos"], transformedList);
  }
  const fromRaiMediaFilteredCount = getValueByPath(fromObject, [
    "raiMediaFilteredCount"
  ]);
  if (fromRaiMediaFilteredCount != null) {
    setValueByPath(toObject, ["raiMediaFilteredCount"], fromRaiMediaFilteredCount);
  }
  const fromRaiMediaFilteredReasons = getValueByPath(fromObject, [
    "raiMediaFilteredReasons"
  ]);
  if (fromRaiMediaFilteredReasons != null) {
    setValueByPath(toObject, ["raiMediaFilteredReasons"], fromRaiMediaFilteredReasons);
  }
  return toObject;
}
function generateVideosResponseFromVertex$1(fromObject) {
  const toObject = {};
  const fromGeneratedVideos = getValueByPath(fromObject, ["videos"]);
  if (fromGeneratedVideos != null) {
    let transformedList = fromGeneratedVideos;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return generatedVideoFromVertex$1(item);
      });
    }
    setValueByPath(toObject, ["generatedVideos"], transformedList);
  }
  const fromRaiMediaFilteredCount = getValueByPath(fromObject, [
    "raiMediaFilteredCount"
  ]);
  if (fromRaiMediaFilteredCount != null) {
    setValueByPath(toObject, ["raiMediaFilteredCount"], fromRaiMediaFilteredCount);
  }
  const fromRaiMediaFilteredReasons = getValueByPath(fromObject, [
    "raiMediaFilteredReasons"
  ]);
  if (fromRaiMediaFilteredReasons != null) {
    setValueByPath(toObject, ["raiMediaFilteredReasons"], fromRaiMediaFilteredReasons);
  }
  return toObject;
}
function generatedVideoFromMldev$1(fromObject) {
  const toObject = {};
  const fromVideo = getValueByPath(fromObject, ["video"]);
  if (fromVideo != null) {
    setValueByPath(toObject, ["video"], videoFromMldev$1(fromVideo));
  }
  return toObject;
}
function generatedVideoFromVertex$1(fromObject) {
  const toObject = {};
  const fromVideo = getValueByPath(fromObject, ["_self"]);
  if (fromVideo != null) {
    setValueByPath(toObject, ["video"], videoFromVertex$1(fromVideo));
  }
  return toObject;
}
function getOperationParametersToMldev(fromObject) {
  const toObject = {};
  const fromOperationName = getValueByPath(fromObject, [
    "operationName"
  ]);
  if (fromOperationName != null) {
    setValueByPath(toObject, ["_url", "operationName"], fromOperationName);
  }
  return toObject;
}
function getOperationParametersToVertex(fromObject) {
  const toObject = {};
  const fromOperationName = getValueByPath(fromObject, [
    "operationName"
  ]);
  if (fromOperationName != null) {
    setValueByPath(toObject, ["_url", "operationName"], fromOperationName);
  }
  return toObject;
}
function importFileOperationFromMldev$1(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromMetadata = getValueByPath(fromObject, ["metadata"]);
  if (fromMetadata != null) {
    setValueByPath(toObject, ["metadata"], fromMetadata);
  }
  const fromDone = getValueByPath(fromObject, ["done"]);
  if (fromDone != null) {
    setValueByPath(toObject, ["done"], fromDone);
  }
  const fromError = getValueByPath(fromObject, ["error"]);
  if (fromError != null) {
    setValueByPath(toObject, ["error"], fromError);
  }
  const fromResponse = getValueByPath(fromObject, ["response"]);
  if (fromResponse != null) {
    setValueByPath(toObject, ["response"], importFileResponseFromMldev$1(fromResponse));
  }
  return toObject;
}
function importFileResponseFromMldev$1(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromParent = getValueByPath(fromObject, ["parent"]);
  if (fromParent != null) {
    setValueByPath(toObject, ["parent"], fromParent);
  }
  const fromDocumentName = getValueByPath(fromObject, ["documentName"]);
  if (fromDocumentName != null) {
    setValueByPath(toObject, ["documentName"], fromDocumentName);
  }
  return toObject;
}
function uploadToFileSearchStoreOperationFromMldev(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromMetadata = getValueByPath(fromObject, ["metadata"]);
  if (fromMetadata != null) {
    setValueByPath(toObject, ["metadata"], fromMetadata);
  }
  const fromDone = getValueByPath(fromObject, ["done"]);
  if (fromDone != null) {
    setValueByPath(toObject, ["done"], fromDone);
  }
  const fromError = getValueByPath(fromObject, ["error"]);
  if (fromError != null) {
    setValueByPath(toObject, ["error"], fromError);
  }
  const fromResponse = getValueByPath(fromObject, ["response"]);
  if (fromResponse != null) {
    setValueByPath(toObject, ["response"], uploadToFileSearchStoreResponseFromMldev(fromResponse));
  }
  return toObject;
}
function uploadToFileSearchStoreResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromParent = getValueByPath(fromObject, ["parent"]);
  if (fromParent != null) {
    setValueByPath(toObject, ["parent"], fromParent);
  }
  const fromDocumentName = getValueByPath(fromObject, ["documentName"]);
  if (fromDocumentName != null) {
    setValueByPath(toObject, ["documentName"], fromDocumentName);
  }
  return toObject;
}
function videoFromMldev$1(fromObject) {
  const toObject = {};
  const fromUri = getValueByPath(fromObject, ["uri"]);
  if (fromUri != null) {
    setValueByPath(toObject, ["uri"], fromUri);
  }
  const fromVideoBytes = getValueByPath(fromObject, ["encodedVideo"]);
  if (fromVideoBytes != null) {
    setValueByPath(toObject, ["videoBytes"], tBytes$1(fromVideoBytes));
  }
  const fromMimeType = getValueByPath(fromObject, ["encoding"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function videoFromVertex$1(fromObject) {
  const toObject = {};
  const fromUri = getValueByPath(fromObject, ["gcsUri"]);
  if (fromUri != null) {
    setValueByPath(toObject, ["uri"], fromUri);
  }
  const fromVideoBytes = getValueByPath(fromObject, [
    "bytesBase64Encoded"
  ]);
  if (fromVideoBytes != null) {
    setValueByPath(toObject, ["videoBytes"], tBytes$1(fromVideoBytes));
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
var Outcome;
(function(Outcome2) {
  Outcome2["OUTCOME_UNSPECIFIED"] = "OUTCOME_UNSPECIFIED";
  Outcome2["OUTCOME_OK"] = "OUTCOME_OK";
  Outcome2["OUTCOME_FAILED"] = "OUTCOME_FAILED";
  Outcome2["OUTCOME_DEADLINE_EXCEEDED"] = "OUTCOME_DEADLINE_EXCEEDED";
})(Outcome || (Outcome = {}));
var Language;
(function(Language2) {
  Language2["LANGUAGE_UNSPECIFIED"] = "LANGUAGE_UNSPECIFIED";
  Language2["PYTHON"] = "PYTHON";
})(Language || (Language = {}));
var FunctionResponseScheduling;
(function(FunctionResponseScheduling2) {
  FunctionResponseScheduling2["SCHEDULING_UNSPECIFIED"] = "SCHEDULING_UNSPECIFIED";
  FunctionResponseScheduling2["SILENT"] = "SILENT";
  FunctionResponseScheduling2["WHEN_IDLE"] = "WHEN_IDLE";
  FunctionResponseScheduling2["INTERRUPT"] = "INTERRUPT";
})(FunctionResponseScheduling || (FunctionResponseScheduling = {}));
var Type;
(function(Type2) {
  Type2["TYPE_UNSPECIFIED"] = "TYPE_UNSPECIFIED";
  Type2["STRING"] = "STRING";
  Type2["NUMBER"] = "NUMBER";
  Type2["INTEGER"] = "INTEGER";
  Type2["BOOLEAN"] = "BOOLEAN";
  Type2["ARRAY"] = "ARRAY";
  Type2["OBJECT"] = "OBJECT";
  Type2["NULL"] = "NULL";
})(Type || (Type = {}));
var Mode;
(function(Mode2) {
  Mode2["MODE_UNSPECIFIED"] = "MODE_UNSPECIFIED";
  Mode2["MODE_DYNAMIC"] = "MODE_DYNAMIC";
})(Mode || (Mode = {}));
var ApiSpec;
(function(ApiSpec2) {
  ApiSpec2["API_SPEC_UNSPECIFIED"] = "API_SPEC_UNSPECIFIED";
  ApiSpec2["SIMPLE_SEARCH"] = "SIMPLE_SEARCH";
  ApiSpec2["ELASTIC_SEARCH"] = "ELASTIC_SEARCH";
})(ApiSpec || (ApiSpec = {}));
var AuthType;
(function(AuthType2) {
  AuthType2["AUTH_TYPE_UNSPECIFIED"] = "AUTH_TYPE_UNSPECIFIED";
  AuthType2["NO_AUTH"] = "NO_AUTH";
  AuthType2["API_KEY_AUTH"] = "API_KEY_AUTH";
  AuthType2["HTTP_BASIC_AUTH"] = "HTTP_BASIC_AUTH";
  AuthType2["GOOGLE_SERVICE_ACCOUNT_AUTH"] = "GOOGLE_SERVICE_ACCOUNT_AUTH";
  AuthType2["OAUTH"] = "OAUTH";
  AuthType2["OIDC_AUTH"] = "OIDC_AUTH";
})(AuthType || (AuthType = {}));
var HttpElementLocation;
(function(HttpElementLocation2) {
  HttpElementLocation2["HTTP_IN_UNSPECIFIED"] = "HTTP_IN_UNSPECIFIED";
  HttpElementLocation2["HTTP_IN_QUERY"] = "HTTP_IN_QUERY";
  HttpElementLocation2["HTTP_IN_HEADER"] = "HTTP_IN_HEADER";
  HttpElementLocation2["HTTP_IN_PATH"] = "HTTP_IN_PATH";
  HttpElementLocation2["HTTP_IN_BODY"] = "HTTP_IN_BODY";
  HttpElementLocation2["HTTP_IN_COOKIE"] = "HTTP_IN_COOKIE";
})(HttpElementLocation || (HttpElementLocation = {}));
var PhishBlockThreshold;
(function(PhishBlockThreshold2) {
  PhishBlockThreshold2["PHISH_BLOCK_THRESHOLD_UNSPECIFIED"] = "PHISH_BLOCK_THRESHOLD_UNSPECIFIED";
  PhishBlockThreshold2["BLOCK_LOW_AND_ABOVE"] = "BLOCK_LOW_AND_ABOVE";
  PhishBlockThreshold2["BLOCK_MEDIUM_AND_ABOVE"] = "BLOCK_MEDIUM_AND_ABOVE";
  PhishBlockThreshold2["BLOCK_HIGH_AND_ABOVE"] = "BLOCK_HIGH_AND_ABOVE";
  PhishBlockThreshold2["BLOCK_HIGHER_AND_ABOVE"] = "BLOCK_HIGHER_AND_ABOVE";
  PhishBlockThreshold2["BLOCK_VERY_HIGH_AND_ABOVE"] = "BLOCK_VERY_HIGH_AND_ABOVE";
  PhishBlockThreshold2["BLOCK_ONLY_EXTREMELY_HIGH"] = "BLOCK_ONLY_EXTREMELY_HIGH";
})(PhishBlockThreshold || (PhishBlockThreshold = {}));
var ThinkingLevel;
(function(ThinkingLevel2) {
  ThinkingLevel2["THINKING_LEVEL_UNSPECIFIED"] = "THINKING_LEVEL_UNSPECIFIED";
  ThinkingLevel2["LOW"] = "LOW";
  ThinkingLevel2["MEDIUM"] = "MEDIUM";
  ThinkingLevel2["HIGH"] = "HIGH";
  ThinkingLevel2["MINIMAL"] = "MINIMAL";
})(ThinkingLevel || (ThinkingLevel = {}));
var HarmCategory;
(function(HarmCategory2) {
  HarmCategory2["HARM_CATEGORY_UNSPECIFIED"] = "HARM_CATEGORY_UNSPECIFIED";
  HarmCategory2["HARM_CATEGORY_HARASSMENT"] = "HARM_CATEGORY_HARASSMENT";
  HarmCategory2["HARM_CATEGORY_HATE_SPEECH"] = "HARM_CATEGORY_HATE_SPEECH";
  HarmCategory2["HARM_CATEGORY_SEXUALLY_EXPLICIT"] = "HARM_CATEGORY_SEXUALLY_EXPLICIT";
  HarmCategory2["HARM_CATEGORY_DANGEROUS_CONTENT"] = "HARM_CATEGORY_DANGEROUS_CONTENT";
  HarmCategory2["HARM_CATEGORY_CIVIC_INTEGRITY"] = "HARM_CATEGORY_CIVIC_INTEGRITY";
  HarmCategory2["HARM_CATEGORY_IMAGE_HATE"] = "HARM_CATEGORY_IMAGE_HATE";
  HarmCategory2["HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT"] = "HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT";
  HarmCategory2["HARM_CATEGORY_IMAGE_HARASSMENT"] = "HARM_CATEGORY_IMAGE_HARASSMENT";
  HarmCategory2["HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"] = "HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT";
  HarmCategory2["HARM_CATEGORY_JAILBREAK"] = "HARM_CATEGORY_JAILBREAK";
})(HarmCategory || (HarmCategory = {}));
var HarmBlockMethod;
(function(HarmBlockMethod2) {
  HarmBlockMethod2["HARM_BLOCK_METHOD_UNSPECIFIED"] = "HARM_BLOCK_METHOD_UNSPECIFIED";
  HarmBlockMethod2["SEVERITY"] = "SEVERITY";
  HarmBlockMethod2["PROBABILITY"] = "PROBABILITY";
})(HarmBlockMethod || (HarmBlockMethod = {}));
var HarmBlockThreshold;
(function(HarmBlockThreshold2) {
  HarmBlockThreshold2["HARM_BLOCK_THRESHOLD_UNSPECIFIED"] = "HARM_BLOCK_THRESHOLD_UNSPECIFIED";
  HarmBlockThreshold2["BLOCK_LOW_AND_ABOVE"] = "BLOCK_LOW_AND_ABOVE";
  HarmBlockThreshold2["BLOCK_MEDIUM_AND_ABOVE"] = "BLOCK_MEDIUM_AND_ABOVE";
  HarmBlockThreshold2["BLOCK_ONLY_HIGH"] = "BLOCK_ONLY_HIGH";
  HarmBlockThreshold2["BLOCK_NONE"] = "BLOCK_NONE";
  HarmBlockThreshold2["OFF"] = "OFF";
})(HarmBlockThreshold || (HarmBlockThreshold = {}));
var FinishReason;
(function(FinishReason2) {
  FinishReason2["FINISH_REASON_UNSPECIFIED"] = "FINISH_REASON_UNSPECIFIED";
  FinishReason2["STOP"] = "STOP";
  FinishReason2["MAX_TOKENS"] = "MAX_TOKENS";
  FinishReason2["SAFETY"] = "SAFETY";
  FinishReason2["RECITATION"] = "RECITATION";
  FinishReason2["LANGUAGE"] = "LANGUAGE";
  FinishReason2["OTHER"] = "OTHER";
  FinishReason2["BLOCKLIST"] = "BLOCKLIST";
  FinishReason2["PROHIBITED_CONTENT"] = "PROHIBITED_CONTENT";
  FinishReason2["SPII"] = "SPII";
  FinishReason2["MALFORMED_FUNCTION_CALL"] = "MALFORMED_FUNCTION_CALL";
  FinishReason2["IMAGE_SAFETY"] = "IMAGE_SAFETY";
  FinishReason2["UNEXPECTED_TOOL_CALL"] = "UNEXPECTED_TOOL_CALL";
  FinishReason2["IMAGE_PROHIBITED_CONTENT"] = "IMAGE_PROHIBITED_CONTENT";
  FinishReason2["NO_IMAGE"] = "NO_IMAGE";
  FinishReason2["IMAGE_RECITATION"] = "IMAGE_RECITATION";
  FinishReason2["IMAGE_OTHER"] = "IMAGE_OTHER";
})(FinishReason || (FinishReason = {}));
var HarmProbability;
(function(HarmProbability2) {
  HarmProbability2["HARM_PROBABILITY_UNSPECIFIED"] = "HARM_PROBABILITY_UNSPECIFIED";
  HarmProbability2["NEGLIGIBLE"] = "NEGLIGIBLE";
  HarmProbability2["LOW"] = "LOW";
  HarmProbability2["MEDIUM"] = "MEDIUM";
  HarmProbability2["HIGH"] = "HIGH";
})(HarmProbability || (HarmProbability = {}));
var HarmSeverity;
(function(HarmSeverity2) {
  HarmSeverity2["HARM_SEVERITY_UNSPECIFIED"] = "HARM_SEVERITY_UNSPECIFIED";
  HarmSeverity2["HARM_SEVERITY_NEGLIGIBLE"] = "HARM_SEVERITY_NEGLIGIBLE";
  HarmSeverity2["HARM_SEVERITY_LOW"] = "HARM_SEVERITY_LOW";
  HarmSeverity2["HARM_SEVERITY_MEDIUM"] = "HARM_SEVERITY_MEDIUM";
  HarmSeverity2["HARM_SEVERITY_HIGH"] = "HARM_SEVERITY_HIGH";
})(HarmSeverity || (HarmSeverity = {}));
var UrlRetrievalStatus;
(function(UrlRetrievalStatus2) {
  UrlRetrievalStatus2["URL_RETRIEVAL_STATUS_UNSPECIFIED"] = "URL_RETRIEVAL_STATUS_UNSPECIFIED";
  UrlRetrievalStatus2["URL_RETRIEVAL_STATUS_SUCCESS"] = "URL_RETRIEVAL_STATUS_SUCCESS";
  UrlRetrievalStatus2["URL_RETRIEVAL_STATUS_ERROR"] = "URL_RETRIEVAL_STATUS_ERROR";
  UrlRetrievalStatus2["URL_RETRIEVAL_STATUS_PAYWALL"] = "URL_RETRIEVAL_STATUS_PAYWALL";
  UrlRetrievalStatus2["URL_RETRIEVAL_STATUS_UNSAFE"] = "URL_RETRIEVAL_STATUS_UNSAFE";
})(UrlRetrievalStatus || (UrlRetrievalStatus = {}));
var BlockedReason;
(function(BlockedReason2) {
  BlockedReason2["BLOCKED_REASON_UNSPECIFIED"] = "BLOCKED_REASON_UNSPECIFIED";
  BlockedReason2["SAFETY"] = "SAFETY";
  BlockedReason2["OTHER"] = "OTHER";
  BlockedReason2["BLOCKLIST"] = "BLOCKLIST";
  BlockedReason2["PROHIBITED_CONTENT"] = "PROHIBITED_CONTENT";
  BlockedReason2["IMAGE_SAFETY"] = "IMAGE_SAFETY";
  BlockedReason2["MODEL_ARMOR"] = "MODEL_ARMOR";
  BlockedReason2["JAILBREAK"] = "JAILBREAK";
})(BlockedReason || (BlockedReason = {}));
var TrafficType;
(function(TrafficType2) {
  TrafficType2["TRAFFIC_TYPE_UNSPECIFIED"] = "TRAFFIC_TYPE_UNSPECIFIED";
  TrafficType2["ON_DEMAND"] = "ON_DEMAND";
  TrafficType2["PROVISIONED_THROUGHPUT"] = "PROVISIONED_THROUGHPUT";
})(TrafficType || (TrafficType = {}));
var Modality;
(function(Modality2) {
  Modality2["MODALITY_UNSPECIFIED"] = "MODALITY_UNSPECIFIED";
  Modality2["TEXT"] = "TEXT";
  Modality2["IMAGE"] = "IMAGE";
  Modality2["AUDIO"] = "AUDIO";
})(Modality || (Modality = {}));
var MediaResolution;
(function(MediaResolution2) {
  MediaResolution2["MEDIA_RESOLUTION_UNSPECIFIED"] = "MEDIA_RESOLUTION_UNSPECIFIED";
  MediaResolution2["MEDIA_RESOLUTION_LOW"] = "MEDIA_RESOLUTION_LOW";
  MediaResolution2["MEDIA_RESOLUTION_MEDIUM"] = "MEDIA_RESOLUTION_MEDIUM";
  MediaResolution2["MEDIA_RESOLUTION_HIGH"] = "MEDIA_RESOLUTION_HIGH";
})(MediaResolution || (MediaResolution = {}));
var TuningMode;
(function(TuningMode2) {
  TuningMode2["TUNING_MODE_UNSPECIFIED"] = "TUNING_MODE_UNSPECIFIED";
  TuningMode2["TUNING_MODE_FULL"] = "TUNING_MODE_FULL";
  TuningMode2["TUNING_MODE_PEFT_ADAPTER"] = "TUNING_MODE_PEFT_ADAPTER";
})(TuningMode || (TuningMode = {}));
var AdapterSize;
(function(AdapterSize2) {
  AdapterSize2["ADAPTER_SIZE_UNSPECIFIED"] = "ADAPTER_SIZE_UNSPECIFIED";
  AdapterSize2["ADAPTER_SIZE_ONE"] = "ADAPTER_SIZE_ONE";
  AdapterSize2["ADAPTER_SIZE_TWO"] = "ADAPTER_SIZE_TWO";
  AdapterSize2["ADAPTER_SIZE_FOUR"] = "ADAPTER_SIZE_FOUR";
  AdapterSize2["ADAPTER_SIZE_EIGHT"] = "ADAPTER_SIZE_EIGHT";
  AdapterSize2["ADAPTER_SIZE_SIXTEEN"] = "ADAPTER_SIZE_SIXTEEN";
  AdapterSize2["ADAPTER_SIZE_THIRTY_TWO"] = "ADAPTER_SIZE_THIRTY_TWO";
})(AdapterSize || (AdapterSize = {}));
var JobState;
(function(JobState2) {
  JobState2["JOB_STATE_UNSPECIFIED"] = "JOB_STATE_UNSPECIFIED";
  JobState2["JOB_STATE_QUEUED"] = "JOB_STATE_QUEUED";
  JobState2["JOB_STATE_PENDING"] = "JOB_STATE_PENDING";
  JobState2["JOB_STATE_RUNNING"] = "JOB_STATE_RUNNING";
  JobState2["JOB_STATE_SUCCEEDED"] = "JOB_STATE_SUCCEEDED";
  JobState2["JOB_STATE_FAILED"] = "JOB_STATE_FAILED";
  JobState2["JOB_STATE_CANCELLING"] = "JOB_STATE_CANCELLING";
  JobState2["JOB_STATE_CANCELLED"] = "JOB_STATE_CANCELLED";
  JobState2["JOB_STATE_PAUSED"] = "JOB_STATE_PAUSED";
  JobState2["JOB_STATE_EXPIRED"] = "JOB_STATE_EXPIRED";
  JobState2["JOB_STATE_UPDATING"] = "JOB_STATE_UPDATING";
  JobState2["JOB_STATE_PARTIALLY_SUCCEEDED"] = "JOB_STATE_PARTIALLY_SUCCEEDED";
})(JobState || (JobState = {}));
var TuningTask;
(function(TuningTask2) {
  TuningTask2["TUNING_TASK_UNSPECIFIED"] = "TUNING_TASK_UNSPECIFIED";
  TuningTask2["TUNING_TASK_I2V"] = "TUNING_TASK_I2V";
  TuningTask2["TUNING_TASK_T2V"] = "TUNING_TASK_T2V";
  TuningTask2["TUNING_TASK_R2V"] = "TUNING_TASK_R2V";
})(TuningTask || (TuningTask = {}));
var PartMediaResolutionLevel;
(function(PartMediaResolutionLevel2) {
  PartMediaResolutionLevel2["MEDIA_RESOLUTION_UNSPECIFIED"] = "MEDIA_RESOLUTION_UNSPECIFIED";
  PartMediaResolutionLevel2["MEDIA_RESOLUTION_LOW"] = "MEDIA_RESOLUTION_LOW";
  PartMediaResolutionLevel2["MEDIA_RESOLUTION_MEDIUM"] = "MEDIA_RESOLUTION_MEDIUM";
  PartMediaResolutionLevel2["MEDIA_RESOLUTION_HIGH"] = "MEDIA_RESOLUTION_HIGH";
  PartMediaResolutionLevel2["MEDIA_RESOLUTION_ULTRA_HIGH"] = "MEDIA_RESOLUTION_ULTRA_HIGH";
})(PartMediaResolutionLevel || (PartMediaResolutionLevel = {}));
var FeatureSelectionPreference;
(function(FeatureSelectionPreference2) {
  FeatureSelectionPreference2["FEATURE_SELECTION_PREFERENCE_UNSPECIFIED"] = "FEATURE_SELECTION_PREFERENCE_UNSPECIFIED";
  FeatureSelectionPreference2["PRIORITIZE_QUALITY"] = "PRIORITIZE_QUALITY";
  FeatureSelectionPreference2["BALANCED"] = "BALANCED";
  FeatureSelectionPreference2["PRIORITIZE_COST"] = "PRIORITIZE_COST";
})(FeatureSelectionPreference || (FeatureSelectionPreference = {}));
var Behavior;
(function(Behavior2) {
  Behavior2["UNSPECIFIED"] = "UNSPECIFIED";
  Behavior2["BLOCKING"] = "BLOCKING";
  Behavior2["NON_BLOCKING"] = "NON_BLOCKING";
})(Behavior || (Behavior = {}));
var DynamicRetrievalConfigMode;
(function(DynamicRetrievalConfigMode2) {
  DynamicRetrievalConfigMode2["MODE_UNSPECIFIED"] = "MODE_UNSPECIFIED";
  DynamicRetrievalConfigMode2["MODE_DYNAMIC"] = "MODE_DYNAMIC";
})(DynamicRetrievalConfigMode || (DynamicRetrievalConfigMode = {}));
var Environment;
(function(Environment2) {
  Environment2["ENVIRONMENT_UNSPECIFIED"] = "ENVIRONMENT_UNSPECIFIED";
  Environment2["ENVIRONMENT_BROWSER"] = "ENVIRONMENT_BROWSER";
})(Environment || (Environment = {}));
var FunctionCallingConfigMode;
(function(FunctionCallingConfigMode2) {
  FunctionCallingConfigMode2["MODE_UNSPECIFIED"] = "MODE_UNSPECIFIED";
  FunctionCallingConfigMode2["AUTO"] = "AUTO";
  FunctionCallingConfigMode2["ANY"] = "ANY";
  FunctionCallingConfigMode2["NONE"] = "NONE";
  FunctionCallingConfigMode2["VALIDATED"] = "VALIDATED";
})(FunctionCallingConfigMode || (FunctionCallingConfigMode = {}));
var SafetyFilterLevel;
(function(SafetyFilterLevel2) {
  SafetyFilterLevel2["BLOCK_LOW_AND_ABOVE"] = "BLOCK_LOW_AND_ABOVE";
  SafetyFilterLevel2["BLOCK_MEDIUM_AND_ABOVE"] = "BLOCK_MEDIUM_AND_ABOVE";
  SafetyFilterLevel2["BLOCK_ONLY_HIGH"] = "BLOCK_ONLY_HIGH";
  SafetyFilterLevel2["BLOCK_NONE"] = "BLOCK_NONE";
})(SafetyFilterLevel || (SafetyFilterLevel = {}));
var PersonGeneration;
(function(PersonGeneration2) {
  PersonGeneration2["DONT_ALLOW"] = "DONT_ALLOW";
  PersonGeneration2["ALLOW_ADULT"] = "ALLOW_ADULT";
  PersonGeneration2["ALLOW_ALL"] = "ALLOW_ALL";
})(PersonGeneration || (PersonGeneration = {}));
var ImagePromptLanguage;
(function(ImagePromptLanguage2) {
  ImagePromptLanguage2["auto"] = "auto";
  ImagePromptLanguage2["en"] = "en";
  ImagePromptLanguage2["ja"] = "ja";
  ImagePromptLanguage2["ko"] = "ko";
  ImagePromptLanguage2["hi"] = "hi";
  ImagePromptLanguage2["zh"] = "zh";
  ImagePromptLanguage2["pt"] = "pt";
  ImagePromptLanguage2["es"] = "es";
})(ImagePromptLanguage || (ImagePromptLanguage = {}));
var MaskReferenceMode;
(function(MaskReferenceMode2) {
  MaskReferenceMode2["MASK_MODE_DEFAULT"] = "MASK_MODE_DEFAULT";
  MaskReferenceMode2["MASK_MODE_USER_PROVIDED"] = "MASK_MODE_USER_PROVIDED";
  MaskReferenceMode2["MASK_MODE_BACKGROUND"] = "MASK_MODE_BACKGROUND";
  MaskReferenceMode2["MASK_MODE_FOREGROUND"] = "MASK_MODE_FOREGROUND";
  MaskReferenceMode2["MASK_MODE_SEMANTIC"] = "MASK_MODE_SEMANTIC";
})(MaskReferenceMode || (MaskReferenceMode = {}));
var ControlReferenceType;
(function(ControlReferenceType2) {
  ControlReferenceType2["CONTROL_TYPE_DEFAULT"] = "CONTROL_TYPE_DEFAULT";
  ControlReferenceType2["CONTROL_TYPE_CANNY"] = "CONTROL_TYPE_CANNY";
  ControlReferenceType2["CONTROL_TYPE_SCRIBBLE"] = "CONTROL_TYPE_SCRIBBLE";
  ControlReferenceType2["CONTROL_TYPE_FACE_MESH"] = "CONTROL_TYPE_FACE_MESH";
})(ControlReferenceType || (ControlReferenceType = {}));
var SubjectReferenceType;
(function(SubjectReferenceType2) {
  SubjectReferenceType2["SUBJECT_TYPE_DEFAULT"] = "SUBJECT_TYPE_DEFAULT";
  SubjectReferenceType2["SUBJECT_TYPE_PERSON"] = "SUBJECT_TYPE_PERSON";
  SubjectReferenceType2["SUBJECT_TYPE_ANIMAL"] = "SUBJECT_TYPE_ANIMAL";
  SubjectReferenceType2["SUBJECT_TYPE_PRODUCT"] = "SUBJECT_TYPE_PRODUCT";
})(SubjectReferenceType || (SubjectReferenceType = {}));
var EditMode;
(function(EditMode2) {
  EditMode2["EDIT_MODE_DEFAULT"] = "EDIT_MODE_DEFAULT";
  EditMode2["EDIT_MODE_INPAINT_REMOVAL"] = "EDIT_MODE_INPAINT_REMOVAL";
  EditMode2["EDIT_MODE_INPAINT_INSERTION"] = "EDIT_MODE_INPAINT_INSERTION";
  EditMode2["EDIT_MODE_OUTPAINT"] = "EDIT_MODE_OUTPAINT";
  EditMode2["EDIT_MODE_CONTROLLED_EDITING"] = "EDIT_MODE_CONTROLLED_EDITING";
  EditMode2["EDIT_MODE_STYLE"] = "EDIT_MODE_STYLE";
  EditMode2["EDIT_MODE_BGSWAP"] = "EDIT_MODE_BGSWAP";
  EditMode2["EDIT_MODE_PRODUCT_IMAGE"] = "EDIT_MODE_PRODUCT_IMAGE";
})(EditMode || (EditMode = {}));
var SegmentMode;
(function(SegmentMode2) {
  SegmentMode2["FOREGROUND"] = "FOREGROUND";
  SegmentMode2["BACKGROUND"] = "BACKGROUND";
  SegmentMode2["PROMPT"] = "PROMPT";
  SegmentMode2["SEMANTIC"] = "SEMANTIC";
  SegmentMode2["INTERACTIVE"] = "INTERACTIVE";
})(SegmentMode || (SegmentMode = {}));
var VideoGenerationReferenceType;
(function(VideoGenerationReferenceType2) {
  VideoGenerationReferenceType2["ASSET"] = "ASSET";
  VideoGenerationReferenceType2["STYLE"] = "STYLE";
})(VideoGenerationReferenceType || (VideoGenerationReferenceType = {}));
var VideoGenerationMaskMode;
(function(VideoGenerationMaskMode2) {
  VideoGenerationMaskMode2["INSERT"] = "INSERT";
  VideoGenerationMaskMode2["REMOVE"] = "REMOVE";
  VideoGenerationMaskMode2["REMOVE_STATIC"] = "REMOVE_STATIC";
  VideoGenerationMaskMode2["OUTPAINT"] = "OUTPAINT";
})(VideoGenerationMaskMode || (VideoGenerationMaskMode = {}));
var VideoCompressionQuality;
(function(VideoCompressionQuality2) {
  VideoCompressionQuality2["OPTIMIZED"] = "OPTIMIZED";
  VideoCompressionQuality2["LOSSLESS"] = "LOSSLESS";
})(VideoCompressionQuality || (VideoCompressionQuality = {}));
var TuningMethod;
(function(TuningMethod2) {
  TuningMethod2["SUPERVISED_FINE_TUNING"] = "SUPERVISED_FINE_TUNING";
  TuningMethod2["PREFERENCE_TUNING"] = "PREFERENCE_TUNING";
})(TuningMethod || (TuningMethod = {}));
var DocumentState;
(function(DocumentState2) {
  DocumentState2["STATE_UNSPECIFIED"] = "STATE_UNSPECIFIED";
  DocumentState2["STATE_PENDING"] = "STATE_PENDING";
  DocumentState2["STATE_ACTIVE"] = "STATE_ACTIVE";
  DocumentState2["STATE_FAILED"] = "STATE_FAILED";
})(DocumentState || (DocumentState = {}));
var FileState;
(function(FileState2) {
  FileState2["STATE_UNSPECIFIED"] = "STATE_UNSPECIFIED";
  FileState2["PROCESSING"] = "PROCESSING";
  FileState2["ACTIVE"] = "ACTIVE";
  FileState2["FAILED"] = "FAILED";
})(FileState || (FileState = {}));
var FileSource;
(function(FileSource2) {
  FileSource2["SOURCE_UNSPECIFIED"] = "SOURCE_UNSPECIFIED";
  FileSource2["UPLOADED"] = "UPLOADED";
  FileSource2["GENERATED"] = "GENERATED";
})(FileSource || (FileSource = {}));
var TurnCompleteReason;
(function(TurnCompleteReason2) {
  TurnCompleteReason2["TURN_COMPLETE_REASON_UNSPECIFIED"] = "TURN_COMPLETE_REASON_UNSPECIFIED";
  TurnCompleteReason2["MALFORMED_FUNCTION_CALL"] = "MALFORMED_FUNCTION_CALL";
  TurnCompleteReason2["RESPONSE_REJECTED"] = "RESPONSE_REJECTED";
  TurnCompleteReason2["NEED_MORE_INPUT"] = "NEED_MORE_INPUT";
})(TurnCompleteReason || (TurnCompleteReason = {}));
var MediaModality;
(function(MediaModality2) {
  MediaModality2["MODALITY_UNSPECIFIED"] = "MODALITY_UNSPECIFIED";
  MediaModality2["TEXT"] = "TEXT";
  MediaModality2["IMAGE"] = "IMAGE";
  MediaModality2["VIDEO"] = "VIDEO";
  MediaModality2["AUDIO"] = "AUDIO";
  MediaModality2["DOCUMENT"] = "DOCUMENT";
})(MediaModality || (MediaModality = {}));
var VadSignalType;
(function(VadSignalType2) {
  VadSignalType2["VAD_SIGNAL_TYPE_UNSPECIFIED"] = "VAD_SIGNAL_TYPE_UNSPECIFIED";
  VadSignalType2["VAD_SIGNAL_TYPE_SOS"] = "VAD_SIGNAL_TYPE_SOS";
  VadSignalType2["VAD_SIGNAL_TYPE_EOS"] = "VAD_SIGNAL_TYPE_EOS";
})(VadSignalType || (VadSignalType = {}));
var StartSensitivity;
(function(StartSensitivity2) {
  StartSensitivity2["START_SENSITIVITY_UNSPECIFIED"] = "START_SENSITIVITY_UNSPECIFIED";
  StartSensitivity2["START_SENSITIVITY_HIGH"] = "START_SENSITIVITY_HIGH";
  StartSensitivity2["START_SENSITIVITY_LOW"] = "START_SENSITIVITY_LOW";
})(StartSensitivity || (StartSensitivity = {}));
var EndSensitivity;
(function(EndSensitivity2) {
  EndSensitivity2["END_SENSITIVITY_UNSPECIFIED"] = "END_SENSITIVITY_UNSPECIFIED";
  EndSensitivity2["END_SENSITIVITY_HIGH"] = "END_SENSITIVITY_HIGH";
  EndSensitivity2["END_SENSITIVITY_LOW"] = "END_SENSITIVITY_LOW";
})(EndSensitivity || (EndSensitivity = {}));
var ActivityHandling;
(function(ActivityHandling2) {
  ActivityHandling2["ACTIVITY_HANDLING_UNSPECIFIED"] = "ACTIVITY_HANDLING_UNSPECIFIED";
  ActivityHandling2["START_OF_ACTIVITY_INTERRUPTS"] = "START_OF_ACTIVITY_INTERRUPTS";
  ActivityHandling2["NO_INTERRUPTION"] = "NO_INTERRUPTION";
})(ActivityHandling || (ActivityHandling = {}));
var TurnCoverage;
(function(TurnCoverage2) {
  TurnCoverage2["TURN_COVERAGE_UNSPECIFIED"] = "TURN_COVERAGE_UNSPECIFIED";
  TurnCoverage2["TURN_INCLUDES_ONLY_ACTIVITY"] = "TURN_INCLUDES_ONLY_ACTIVITY";
  TurnCoverage2["TURN_INCLUDES_ALL_INPUT"] = "TURN_INCLUDES_ALL_INPUT";
})(TurnCoverage || (TurnCoverage = {}));
var Scale;
(function(Scale2) {
  Scale2["SCALE_UNSPECIFIED"] = "SCALE_UNSPECIFIED";
  Scale2["C_MAJOR_A_MINOR"] = "C_MAJOR_A_MINOR";
  Scale2["D_FLAT_MAJOR_B_FLAT_MINOR"] = "D_FLAT_MAJOR_B_FLAT_MINOR";
  Scale2["D_MAJOR_B_MINOR"] = "D_MAJOR_B_MINOR";
  Scale2["E_FLAT_MAJOR_C_MINOR"] = "E_FLAT_MAJOR_C_MINOR";
  Scale2["E_MAJOR_D_FLAT_MINOR"] = "E_MAJOR_D_FLAT_MINOR";
  Scale2["F_MAJOR_D_MINOR"] = "F_MAJOR_D_MINOR";
  Scale2["G_FLAT_MAJOR_E_FLAT_MINOR"] = "G_FLAT_MAJOR_E_FLAT_MINOR";
  Scale2["G_MAJOR_E_MINOR"] = "G_MAJOR_E_MINOR";
  Scale2["A_FLAT_MAJOR_F_MINOR"] = "A_FLAT_MAJOR_F_MINOR";
  Scale2["A_MAJOR_G_FLAT_MINOR"] = "A_MAJOR_G_FLAT_MINOR";
  Scale2["B_FLAT_MAJOR_G_MINOR"] = "B_FLAT_MAJOR_G_MINOR";
  Scale2["B_MAJOR_A_FLAT_MINOR"] = "B_MAJOR_A_FLAT_MINOR";
})(Scale || (Scale = {}));
var MusicGenerationMode;
(function(MusicGenerationMode2) {
  MusicGenerationMode2["MUSIC_GENERATION_MODE_UNSPECIFIED"] = "MUSIC_GENERATION_MODE_UNSPECIFIED";
  MusicGenerationMode2["QUALITY"] = "QUALITY";
  MusicGenerationMode2["DIVERSITY"] = "DIVERSITY";
  MusicGenerationMode2["VOCALIZATION"] = "VOCALIZATION";
})(MusicGenerationMode || (MusicGenerationMode = {}));
var LiveMusicPlaybackControl;
(function(LiveMusicPlaybackControl2) {
  LiveMusicPlaybackControl2["PLAYBACK_CONTROL_UNSPECIFIED"] = "PLAYBACK_CONTROL_UNSPECIFIED";
  LiveMusicPlaybackControl2["PLAY"] = "PLAY";
  LiveMusicPlaybackControl2["PAUSE"] = "PAUSE";
  LiveMusicPlaybackControl2["STOP"] = "STOP";
  LiveMusicPlaybackControl2["RESET_CONTEXT"] = "RESET_CONTEXT";
})(LiveMusicPlaybackControl || (LiveMusicPlaybackControl = {}));
var HttpResponse = class {
  constructor(response) {
    const headers = {};
    for (const pair of response.headers.entries()) {
      headers[pair[0]] = pair[1];
    }
    this.headers = headers;
    this.responseInternal = response;
  }
  json() {
    return this.responseInternal.json();
  }
};
var GenerateContentResponse = class {
  /**
   * Returns the concatenation of all text parts from the first candidate in the response.
   *
   * @remarks
   * If there are multiple candidates in the response, the text from the first
   * one will be returned.
   * If there are non-text parts in the response, the concatenation of all text
   * parts will be returned, and a warning will be logged.
   * If there are thought parts in the response, the concatenation of all text
   * parts excluding the thought parts will be returned.
   *
   * @example
   * ```ts
   * const response = await ai.models.generateContent({
   *   model: 'gemini-2.0-flash',
   *   contents:
   *     'Why is the sky blue?',
   * });
   *
   * console.debug(response.text);
   * ```
   */
  get text() {
    var _a2, _b, _c, _d, _e, _f, _g, _h;
    if (((_d = (_c = (_b = (_a2 = this.candidates) === null || _a2 === void 0 ? void 0 : _a2[0]) === null || _b === void 0 ? void 0 : _b.content) === null || _c === void 0 ? void 0 : _c.parts) === null || _d === void 0 ? void 0 : _d.length) === 0) {
      return void 0;
    }
    if (this.candidates && this.candidates.length > 1) {
      console.warn("there are multiple candidates in the response, returning text from the first one.");
    }
    let text = "";
    let anyTextPartText = false;
    const nonTextParts = [];
    for (const part of (_h = (_g = (_f = (_e = this.candidates) === null || _e === void 0 ? void 0 : _e[0]) === null || _f === void 0 ? void 0 : _f.content) === null || _g === void 0 ? void 0 : _g.parts) !== null && _h !== void 0 ? _h : []) {
      for (const [fieldName, fieldValue] of Object.entries(part)) {
        if (fieldName !== "text" && fieldName !== "thought" && fieldName !== "thoughtSignature" && (fieldValue !== null || fieldValue !== void 0)) {
          nonTextParts.push(fieldName);
        }
      }
      if (typeof part.text === "string") {
        if (typeof part.thought === "boolean" && part.thought) {
          continue;
        }
        anyTextPartText = true;
        text += part.text;
      }
    }
    if (nonTextParts.length > 0) {
      console.warn(`there are non-text parts ${nonTextParts} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`);
    }
    return anyTextPartText ? text : void 0;
  }
  /**
   * Returns the concatenation of all inline data parts from the first candidate
   * in the response.
   *
   * @remarks
   * If there are multiple candidates in the response, the inline data from the
   * first one will be returned. If there are non-inline data parts in the
   * response, the concatenation of all inline data parts will be returned, and
   * a warning will be logged.
   */
  get data() {
    var _a2, _b, _c, _d, _e, _f, _g, _h;
    if (((_d = (_c = (_b = (_a2 = this.candidates) === null || _a2 === void 0 ? void 0 : _a2[0]) === null || _b === void 0 ? void 0 : _b.content) === null || _c === void 0 ? void 0 : _c.parts) === null || _d === void 0 ? void 0 : _d.length) === 0) {
      return void 0;
    }
    if (this.candidates && this.candidates.length > 1) {
      console.warn("there are multiple candidates in the response, returning data from the first one.");
    }
    let data = "";
    const nonDataParts = [];
    for (const part of (_h = (_g = (_f = (_e = this.candidates) === null || _e === void 0 ? void 0 : _e[0]) === null || _f === void 0 ? void 0 : _f.content) === null || _g === void 0 ? void 0 : _g.parts) !== null && _h !== void 0 ? _h : []) {
      for (const [fieldName, fieldValue] of Object.entries(part)) {
        if (fieldName !== "inlineData" && (fieldValue !== null || fieldValue !== void 0)) {
          nonDataParts.push(fieldName);
        }
      }
      if (part.inlineData && typeof part.inlineData.data === "string") {
        data += atob(part.inlineData.data);
      }
    }
    if (nonDataParts.length > 0) {
      console.warn(`there are non-data parts ${nonDataParts} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`);
    }
    return data.length > 0 ? btoa(data) : void 0;
  }
  /**
   * Returns the function calls from the first candidate in the response.
   *
   * @remarks
   * If there are multiple candidates in the response, the function calls from
   * the first one will be returned.
   * If there are no function calls in the response, undefined will be returned.
   *
   * @example
   * ```ts
   * const controlLightFunctionDeclaration: FunctionDeclaration = {
   *   name: 'controlLight',
   *   parameters: {
   *   type: Type.OBJECT,
   *   description: 'Set the brightness and color temperature of a room light.',
   *   properties: {
   *     brightness: {
   *       type: Type.NUMBER,
   *       description:
   *         'Light level from 0 to 100. Zero is off and 100 is full brightness.',
   *     },
   *     colorTemperature: {
   *       type: Type.STRING,
   *       description:
   *         'Color temperature of the light fixture which can be `daylight`, `cool` or `warm`.',
   *     },
   *   },
   *   required: ['brightness', 'colorTemperature'],
   *  };
   *  const response = await ai.models.generateContent({
   *     model: 'gemini-2.0-flash',
   *     contents: 'Dim the lights so the room feels cozy and warm.',
   *     config: {
   *       tools: [{functionDeclarations: [controlLightFunctionDeclaration]}],
   *       toolConfig: {
   *         functionCallingConfig: {
   *           mode: FunctionCallingConfigMode.ANY,
   *           allowedFunctionNames: ['controlLight'],
   *         },
   *       },
   *     },
   *   });
   *  console.debug(JSON.stringify(response.functionCalls));
   * ```
   */
  get functionCalls() {
    var _a2, _b, _c, _d, _e, _f, _g, _h;
    if (((_d = (_c = (_b = (_a2 = this.candidates) === null || _a2 === void 0 ? void 0 : _a2[0]) === null || _b === void 0 ? void 0 : _b.content) === null || _c === void 0 ? void 0 : _c.parts) === null || _d === void 0 ? void 0 : _d.length) === 0) {
      return void 0;
    }
    if (this.candidates && this.candidates.length > 1) {
      console.warn("there are multiple candidates in the response, returning function calls from the first one.");
    }
    const functionCalls = (_h = (_g = (_f = (_e = this.candidates) === null || _e === void 0 ? void 0 : _e[0]) === null || _f === void 0 ? void 0 : _f.content) === null || _g === void 0 ? void 0 : _g.parts) === null || _h === void 0 ? void 0 : _h.filter((part) => part.functionCall).map((part) => part.functionCall).filter((functionCall) => functionCall !== void 0);
    if ((functionCalls === null || functionCalls === void 0 ? void 0 : functionCalls.length) === 0) {
      return void 0;
    }
    return functionCalls;
  }
  /**
   * Returns the first executable code from the first candidate in the response.
   *
   * @remarks
   * If there are multiple candidates in the response, the executable code from
   * the first one will be returned.
   * If there are no executable code in the response, undefined will be
   * returned.
   *
   * @example
   * ```ts
   * const response = await ai.models.generateContent({
   *   model: 'gemini-2.0-flash',
   *   contents:
   *     'What is the sum of the first 50 prime numbers? Generate and run code for the calculation, and make sure you get all 50.'
   *   config: {
   *     tools: [{codeExecution: {}}],
   *   },
   * });
   *
   * console.debug(response.executableCode);
   * ```
   */
  get executableCode() {
    var _a2, _b, _c, _d, _e, _f, _g, _h, _j;
    if (((_d = (_c = (_b = (_a2 = this.candidates) === null || _a2 === void 0 ? void 0 : _a2[0]) === null || _b === void 0 ? void 0 : _b.content) === null || _c === void 0 ? void 0 : _c.parts) === null || _d === void 0 ? void 0 : _d.length) === 0) {
      return void 0;
    }
    if (this.candidates && this.candidates.length > 1) {
      console.warn("there are multiple candidates in the response, returning executable code from the first one.");
    }
    const executableCode = (_h = (_g = (_f = (_e = this.candidates) === null || _e === void 0 ? void 0 : _e[0]) === null || _f === void 0 ? void 0 : _f.content) === null || _g === void 0 ? void 0 : _g.parts) === null || _h === void 0 ? void 0 : _h.filter((part) => part.executableCode).map((part) => part.executableCode).filter((executableCode2) => executableCode2 !== void 0);
    if ((executableCode === null || executableCode === void 0 ? void 0 : executableCode.length) === 0) {
      return void 0;
    }
    return (_j = executableCode === null || executableCode === void 0 ? void 0 : executableCode[0]) === null || _j === void 0 ? void 0 : _j.code;
  }
  /**
   * Returns the first code execution result from the first candidate in the response.
   *
   * @remarks
   * If there are multiple candidates in the response, the code execution result from
   * the first one will be returned.
   * If there are no code execution result in the response, undefined will be returned.
   *
   * @example
   * ```ts
   * const response = await ai.models.generateContent({
   *   model: 'gemini-2.0-flash',
   *   contents:
   *     'What is the sum of the first 50 prime numbers? Generate and run code for the calculation, and make sure you get all 50.'
   *   config: {
   *     tools: [{codeExecution: {}}],
   *   },
   * });
   *
   * console.debug(response.codeExecutionResult);
   * ```
   */
  get codeExecutionResult() {
    var _a2, _b, _c, _d, _e, _f, _g, _h, _j;
    if (((_d = (_c = (_b = (_a2 = this.candidates) === null || _a2 === void 0 ? void 0 : _a2[0]) === null || _b === void 0 ? void 0 : _b.content) === null || _c === void 0 ? void 0 : _c.parts) === null || _d === void 0 ? void 0 : _d.length) === 0) {
      return void 0;
    }
    if (this.candidates && this.candidates.length > 1) {
      console.warn("there are multiple candidates in the response, returning code execution result from the first one.");
    }
    const codeExecutionResult = (_h = (_g = (_f = (_e = this.candidates) === null || _e === void 0 ? void 0 : _e[0]) === null || _f === void 0 ? void 0 : _f.content) === null || _g === void 0 ? void 0 : _g.parts) === null || _h === void 0 ? void 0 : _h.filter((part) => part.codeExecutionResult).map((part) => part.codeExecutionResult).filter((codeExecutionResult2) => codeExecutionResult2 !== void 0);
    if ((codeExecutionResult === null || codeExecutionResult === void 0 ? void 0 : codeExecutionResult.length) === 0) {
      return void 0;
    }
    return (_j = codeExecutionResult === null || codeExecutionResult === void 0 ? void 0 : codeExecutionResult[0]) === null || _j === void 0 ? void 0 : _j.output;
  }
};
var EmbedContentResponse = class {
};
var GenerateImagesResponse = class {
};
var EditImageResponse = class {
};
var UpscaleImageResponse = class {
};
var RecontextImageResponse = class {
};
var SegmentImageResponse = class {
};
var ListModelsResponse = class {
};
var DeleteModelResponse = class {
};
var CountTokensResponse = class {
};
var ComputeTokensResponse = class {
};
var GenerateVideosOperation = class _GenerateVideosOperation {
  /**
   * Instantiates an Operation of the same type as the one being called with the fields set from the API response.
   * @internal
   */
  _fromAPIResponse({ apiResponse, _isVertexAI }) {
    const operation = new _GenerateVideosOperation();
    let response;
    const op = apiResponse;
    if (_isVertexAI) {
      response = generateVideosOperationFromVertex$1(op);
    } else {
      response = generateVideosOperationFromMldev$1(op);
    }
    Object.assign(operation, response);
    return operation;
  }
};
var ListTuningJobsResponse = class {
};
var CancelTuningJobResponse = class {
};
var DeleteCachedContentResponse = class {
};
var ListCachedContentsResponse = class {
};
var ListDocumentsResponse = class {
};
var ListFileSearchStoresResponse = class {
};
var UploadToFileSearchStoreResumableResponse = class {
};
var ImportFileOperation = class _ImportFileOperation {
  /**
   * Instantiates an Operation of the same type as the one being called with the fields set from the API response.
   * @internal
   */
  _fromAPIResponse({ apiResponse, _isVertexAI }) {
    const operation = new _ImportFileOperation();
    const op = apiResponse;
    const response = importFileOperationFromMldev$1(op);
    Object.assign(operation, response);
    return operation;
  }
};
var ListFilesResponse = class {
};
var CreateFileResponse = class {
};
var DeleteFileResponse = class {
};
var ListBatchJobsResponse = class {
};
var LiveServerMessage = class {
  /**
   * Returns the concatenation of all text parts from the server content if present.
   *
   * @remarks
   * If there are non-text parts in the response, the concatenation of all text
   * parts will be returned, and a warning will be logged.
   */
  get text() {
    var _a2, _b, _c;
    let text = "";
    let anyTextPartFound = false;
    const nonTextParts = [];
    for (const part of (_c = (_b = (_a2 = this.serverContent) === null || _a2 === void 0 ? void 0 : _a2.modelTurn) === null || _b === void 0 ? void 0 : _b.parts) !== null && _c !== void 0 ? _c : []) {
      for (const [fieldName, fieldValue] of Object.entries(part)) {
        if (fieldName !== "text" && fieldName !== "thought" && fieldValue !== null) {
          nonTextParts.push(fieldName);
        }
      }
      if (typeof part.text === "string") {
        if (typeof part.thought === "boolean" && part.thought) {
          continue;
        }
        anyTextPartFound = true;
        text += part.text;
      }
    }
    if (nonTextParts.length > 0) {
      console.warn(`there are non-text parts ${nonTextParts} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`);
    }
    return anyTextPartFound ? text : void 0;
  }
  /**
   * Returns the concatenation of all inline data parts from the server content if present.
   *
   * @remarks
   * If there are non-inline data parts in the
   * response, the concatenation of all inline data parts will be returned, and
   * a warning will be logged.
   */
  get data() {
    var _a2, _b, _c;
    let data = "";
    const nonDataParts = [];
    for (const part of (_c = (_b = (_a2 = this.serverContent) === null || _a2 === void 0 ? void 0 : _a2.modelTurn) === null || _b === void 0 ? void 0 : _b.parts) !== null && _c !== void 0 ? _c : []) {
      for (const [fieldName, fieldValue] of Object.entries(part)) {
        if (fieldName !== "inlineData" && fieldValue !== null) {
          nonDataParts.push(fieldName);
        }
      }
      if (part.inlineData && typeof part.inlineData.data === "string") {
        data += atob(part.inlineData.data);
      }
    }
    if (nonDataParts.length > 0) {
      console.warn(`there are non-data parts ${nonDataParts} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`);
    }
    return data.length > 0 ? btoa(data) : void 0;
  }
};
var LiveMusicServerMessage = class {
  /**
   * Returns the first audio chunk from the server content, if present.
   *
   * @remarks
   * If there are no audio chunks in the response, undefined will be returned.
   */
  get audioChunk() {
    if (this.serverContent && this.serverContent.audioChunks && this.serverContent.audioChunks.length > 0) {
      return this.serverContent.audioChunks[0];
    }
    return void 0;
  }
};
var UploadToFileSearchStoreOperation = class _UploadToFileSearchStoreOperation {
  /**
   * Instantiates an Operation of the same type as the one being called with the fields set from the API response.
   * @internal
   */
  _fromAPIResponse({ apiResponse, _isVertexAI }) {
    const operation = new _UploadToFileSearchStoreOperation();
    const op = apiResponse;
    const response = uploadToFileSearchStoreOperationFromMldev(op);
    Object.assign(operation, response);
    return operation;
  }
};
function tModel(apiClient, model) {
  if (!model || typeof model !== "string") {
    throw new Error("model is required and must be a string");
  }
  if (model.includes("..") || model.includes("?") || model.includes("&")) {
    throw new Error("invalid model parameter");
  }
  if (apiClient.isVertexAI()) {
    if (model.startsWith("publishers/") || model.startsWith("projects/") || model.startsWith("models/")) {
      return model;
    } else if (model.indexOf("/") >= 0) {
      const parts = model.split("/", 2);
      return `publishers/${parts[0]}/models/${parts[1]}`;
    } else {
      return `publishers/google/models/${model}`;
    }
  } else {
    if (model.startsWith("models/") || model.startsWith("tunedModels/")) {
      return model;
    } else {
      return `models/${model}`;
    }
  }
}
function tCachesModel(apiClient, model) {
  const transformedModel = tModel(apiClient, model);
  if (!transformedModel) {
    return "";
  }
  if (transformedModel.startsWith("publishers/") && apiClient.isVertexAI()) {
    return `projects/${apiClient.getProject()}/locations/${apiClient.getLocation()}/${transformedModel}`;
  } else if (transformedModel.startsWith("models/") && apiClient.isVertexAI()) {
    return `projects/${apiClient.getProject()}/locations/${apiClient.getLocation()}/publishers/google/${transformedModel}`;
  } else {
    return transformedModel;
  }
}
function tBlobs(blobs) {
  if (Array.isArray(blobs)) {
    return blobs.map((blob) => tBlob(blob));
  } else {
    return [tBlob(blobs)];
  }
}
function tBlob(blob) {
  if (typeof blob === "object" && blob !== null) {
    return blob;
  }
  throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof blob}`);
}
function tImageBlob(blob) {
  const transformedBlob = tBlob(blob);
  if (transformedBlob.mimeType && transformedBlob.mimeType.startsWith("image/")) {
    return transformedBlob;
  }
  throw new Error(`Unsupported mime type: ${transformedBlob.mimeType}`);
}
function tAudioBlob(blob) {
  const transformedBlob = tBlob(blob);
  if (transformedBlob.mimeType && transformedBlob.mimeType.startsWith("audio/")) {
    return transformedBlob;
  }
  throw new Error(`Unsupported mime type: ${transformedBlob.mimeType}`);
}
function tPart(origin) {
  if (origin === null || origin === void 0) {
    throw new Error("PartUnion is required");
  }
  if (typeof origin === "object") {
    return origin;
  }
  if (typeof origin === "string") {
    return { text: origin };
  }
  throw new Error(`Unsupported part type: ${typeof origin}`);
}
function tParts(origin) {
  if (origin === null || origin === void 0 || Array.isArray(origin) && origin.length === 0) {
    throw new Error("PartListUnion is required");
  }
  if (Array.isArray(origin)) {
    return origin.map((item) => tPart(item));
  }
  return [tPart(origin)];
}
function _isContent(origin) {
  return origin !== null && origin !== void 0 && typeof origin === "object" && "parts" in origin && Array.isArray(origin.parts);
}
function _isFunctionCallPart(origin) {
  return origin !== null && origin !== void 0 && typeof origin === "object" && "functionCall" in origin;
}
function _isFunctionResponsePart(origin) {
  return origin !== null && origin !== void 0 && typeof origin === "object" && "functionResponse" in origin;
}
function tContent(origin) {
  if (origin === null || origin === void 0) {
    throw new Error("ContentUnion is required");
  }
  if (_isContent(origin)) {
    return origin;
  }
  return {
    role: "user",
    parts: tParts(origin)
  };
}
function tContentsForEmbed(apiClient, origin) {
  if (!origin) {
    return [];
  }
  if (apiClient.isVertexAI() && Array.isArray(origin)) {
    return origin.flatMap((item) => {
      const content = tContent(item);
      if (content.parts && content.parts.length > 0 && content.parts[0].text !== void 0) {
        return [content.parts[0].text];
      }
      return [];
    });
  } else if (apiClient.isVertexAI()) {
    const content = tContent(origin);
    if (content.parts && content.parts.length > 0 && content.parts[0].text !== void 0) {
      return [content.parts[0].text];
    }
    return [];
  }
  if (Array.isArray(origin)) {
    return origin.map((item) => tContent(item));
  }
  return [tContent(origin)];
}
function tContents(origin) {
  if (origin === null || origin === void 0 || Array.isArray(origin) && origin.length === 0) {
    throw new Error("contents are required");
  }
  if (!Array.isArray(origin)) {
    if (_isFunctionCallPart(origin) || _isFunctionResponsePart(origin)) {
      throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");
    }
    return [tContent(origin)];
  }
  const result = [];
  const accumulatedParts = [];
  const isContentArray = _isContent(origin[0]);
  for (const item of origin) {
    const isContent = _isContent(item);
    if (isContent != isContentArray) {
      throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");
    }
    if (isContent) {
      result.push(item);
    } else if (_isFunctionCallPart(item) || _isFunctionResponsePart(item)) {
      throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");
    } else {
      accumulatedParts.push(item);
    }
  }
  if (!isContentArray) {
    result.push({ role: "user", parts: tParts(accumulatedParts) });
  }
  return result;
}
function flattenTypeArrayToAnyOf(typeList, resultingSchema) {
  if (typeList.includes("null")) {
    resultingSchema["nullable"] = true;
  }
  const listWithoutNull = typeList.filter((type) => type !== "null");
  if (listWithoutNull.length === 1) {
    resultingSchema["type"] = Object.values(Type).includes(listWithoutNull[0].toUpperCase()) ? listWithoutNull[0].toUpperCase() : Type.TYPE_UNSPECIFIED;
  } else {
    resultingSchema["anyOf"] = [];
    for (const i of listWithoutNull) {
      resultingSchema["anyOf"].push({
        "type": Object.values(Type).includes(i.toUpperCase()) ? i.toUpperCase() : Type.TYPE_UNSPECIFIED
      });
    }
  }
}
function processJsonSchema(_jsonSchema) {
  const genAISchema = {};
  const schemaFieldNames = ["items"];
  const listSchemaFieldNames = ["anyOf"];
  const dictSchemaFieldNames = ["properties"];
  if (_jsonSchema["type"] && _jsonSchema["anyOf"]) {
    throw new Error("type and anyOf cannot be both populated.");
  }
  const incomingAnyOf = _jsonSchema["anyOf"];
  if (incomingAnyOf != null && incomingAnyOf.length == 2) {
    if (incomingAnyOf[0]["type"] === "null") {
      genAISchema["nullable"] = true;
      _jsonSchema = incomingAnyOf[1];
    } else if (incomingAnyOf[1]["type"] === "null") {
      genAISchema["nullable"] = true;
      _jsonSchema = incomingAnyOf[0];
    }
  }
  if (_jsonSchema["type"] instanceof Array) {
    flattenTypeArrayToAnyOf(_jsonSchema["type"], genAISchema);
  }
  for (const [fieldName, fieldValue] of Object.entries(_jsonSchema)) {
    if (fieldValue == null) {
      continue;
    }
    if (fieldName == "type") {
      if (fieldValue === "null") {
        throw new Error("type: null can not be the only possible type for the field.");
      }
      if (fieldValue instanceof Array) {
        continue;
      }
      genAISchema["type"] = Object.values(Type).includes(fieldValue.toUpperCase()) ? fieldValue.toUpperCase() : Type.TYPE_UNSPECIFIED;
    } else if (schemaFieldNames.includes(fieldName)) {
      genAISchema[fieldName] = processJsonSchema(fieldValue);
    } else if (listSchemaFieldNames.includes(fieldName)) {
      const listSchemaFieldValue = [];
      for (const item of fieldValue) {
        if (item["type"] == "null") {
          genAISchema["nullable"] = true;
          continue;
        }
        listSchemaFieldValue.push(processJsonSchema(item));
      }
      genAISchema[fieldName] = listSchemaFieldValue;
    } else if (dictSchemaFieldNames.includes(fieldName)) {
      const dictSchemaFieldValue = {};
      for (const [key, value] of Object.entries(fieldValue)) {
        dictSchemaFieldValue[key] = processJsonSchema(value);
      }
      genAISchema[fieldName] = dictSchemaFieldValue;
    } else {
      if (fieldName === "additionalProperties") {
        continue;
      }
      genAISchema[fieldName] = fieldValue;
    }
  }
  return genAISchema;
}
function tSchema(schema) {
  return processJsonSchema(schema);
}
function tSpeechConfig(speechConfig) {
  if (typeof speechConfig === "object") {
    return speechConfig;
  } else if (typeof speechConfig === "string") {
    return {
      voiceConfig: {
        prebuiltVoiceConfig: {
          voiceName: speechConfig
        }
      }
    };
  } else {
    throw new Error(`Unsupported speechConfig type: ${typeof speechConfig}`);
  }
}
function tLiveSpeechConfig(speechConfig) {
  if ("multiSpeakerVoiceConfig" in speechConfig) {
    throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");
  }
  return speechConfig;
}
function tTool(tool) {
  if (tool.functionDeclarations) {
    for (const functionDeclaration of tool.functionDeclarations) {
      if (functionDeclaration.parameters) {
        if (!Object.keys(functionDeclaration.parameters).includes("$schema")) {
          functionDeclaration.parameters = processJsonSchema(functionDeclaration.parameters);
        } else {
          if (!functionDeclaration.parametersJsonSchema) {
            functionDeclaration.parametersJsonSchema = functionDeclaration.parameters;
            delete functionDeclaration.parameters;
          }
        }
      }
      if (functionDeclaration.response) {
        if (!Object.keys(functionDeclaration.response).includes("$schema")) {
          functionDeclaration.response = processJsonSchema(functionDeclaration.response);
        } else {
          if (!functionDeclaration.responseJsonSchema) {
            functionDeclaration.responseJsonSchema = functionDeclaration.response;
            delete functionDeclaration.response;
          }
        }
      }
    }
  }
  return tool;
}
function tTools(tools) {
  if (tools === void 0 || tools === null) {
    throw new Error("tools is required");
  }
  if (!Array.isArray(tools)) {
    throw new Error("tools is required and must be an array of Tools");
  }
  const result = [];
  for (const tool of tools) {
    result.push(tool);
  }
  return result;
}
function resourceName(client, resourceName2, resourcePrefix, splitsAfterPrefix = 1) {
  const shouldAppendPrefix = !resourceName2.startsWith(`${resourcePrefix}/`) && resourceName2.split("/").length === splitsAfterPrefix;
  if (client.isVertexAI()) {
    if (resourceName2.startsWith("projects/")) {
      return resourceName2;
    } else if (resourceName2.startsWith("locations/")) {
      return `projects/${client.getProject()}/${resourceName2}`;
    } else if (resourceName2.startsWith(`${resourcePrefix}/`)) {
      return `projects/${client.getProject()}/locations/${client.getLocation()}/${resourceName2}`;
    } else if (shouldAppendPrefix) {
      return `projects/${client.getProject()}/locations/${client.getLocation()}/${resourcePrefix}/${resourceName2}`;
    } else {
      return resourceName2;
    }
  }
  if (shouldAppendPrefix) {
    return `${resourcePrefix}/${resourceName2}`;
  }
  return resourceName2;
}
function tCachedContentName(apiClient, name) {
  if (typeof name !== "string") {
    throw new Error("name must be a string");
  }
  return resourceName(apiClient, name, "cachedContents");
}
function tTuningJobStatus(status) {
  switch (status) {
    case "STATE_UNSPECIFIED":
      return "JOB_STATE_UNSPECIFIED";
    case "CREATING":
      return "JOB_STATE_RUNNING";
    case "ACTIVE":
      return "JOB_STATE_SUCCEEDED";
    case "FAILED":
      return "JOB_STATE_FAILED";
    default:
      return status;
  }
}
function tBytes(fromImageBytes) {
  return tBytes$1(fromImageBytes);
}
function _isFile(origin) {
  return origin !== null && origin !== void 0 && typeof origin === "object" && "name" in origin;
}
function isGeneratedVideo(origin) {
  return origin !== null && origin !== void 0 && typeof origin === "object" && "video" in origin;
}
function isVideo(origin) {
  return origin !== null && origin !== void 0 && typeof origin === "object" && "uri" in origin;
}
function tFileName(fromName) {
  var _a2;
  let name;
  if (_isFile(fromName)) {
    name = fromName.name;
  }
  if (isVideo(fromName)) {
    name = fromName.uri;
    if (name === void 0) {
      return void 0;
    }
  }
  if (isGeneratedVideo(fromName)) {
    name = (_a2 = fromName.video) === null || _a2 === void 0 ? void 0 : _a2.uri;
    if (name === void 0) {
      return void 0;
    }
  }
  if (typeof fromName === "string") {
    name = fromName;
  }
  if (name === void 0) {
    throw new Error("Could not extract file name from the provided input.");
  }
  if (name.startsWith("https://")) {
    const suffix = name.split("files/")[1];
    const match = suffix.match(/[a-z0-9]+/);
    if (match === null) {
      throw new Error(`Could not extract file name from URI ${name}`);
    }
    name = match[0];
  } else if (name.startsWith("files/")) {
    name = name.split("files/")[1];
  }
  return name;
}
function tModelsUrl(apiClient, baseModels) {
  let res;
  if (apiClient.isVertexAI()) {
    res = baseModels ? "publishers/google/models" : "models";
  } else {
    res = baseModels ? "models" : "tunedModels";
  }
  return res;
}
function tExtractModels(response) {
  for (const key of ["models", "tunedModels", "publisherModels"]) {
    if (hasField(response, key)) {
      return response[key];
    }
  }
  return [];
}
function hasField(data, fieldName) {
  return data !== null && typeof data === "object" && fieldName in data;
}
function mcpToGeminiTool(mcpTool, config = {}) {
  const mcpToolSchema = mcpTool;
  const functionDeclaration = {
    name: mcpToolSchema["name"],
    description: mcpToolSchema["description"],
    parametersJsonSchema: mcpToolSchema["inputSchema"]
  };
  if (mcpToolSchema["outputSchema"]) {
    functionDeclaration["responseJsonSchema"] = mcpToolSchema["outputSchema"];
  }
  if (config.behavior) {
    functionDeclaration["behavior"] = config.behavior;
  }
  const geminiTool = {
    functionDeclarations: [
      functionDeclaration
    ]
  };
  return geminiTool;
}
function mcpToolsToGeminiTool(mcpTools, config = {}) {
  const functionDeclarations = [];
  const toolNames = /* @__PURE__ */ new Set();
  for (const mcpTool of mcpTools) {
    const mcpToolName = mcpTool.name;
    if (toolNames.has(mcpToolName)) {
      throw new Error(`Duplicate function name ${mcpToolName} found in MCP tools. Please ensure function names are unique.`);
    }
    toolNames.add(mcpToolName);
    const geminiTool = mcpToGeminiTool(mcpTool, config);
    if (geminiTool.functionDeclarations) {
      functionDeclarations.push(...geminiTool.functionDeclarations);
    }
  }
  return { functionDeclarations };
}
function tBatchJobSource(client, src) {
  let sourceObj;
  if (typeof src === "string") {
    if (client.isVertexAI()) {
      if (src.startsWith("gs://")) {
        sourceObj = { format: "jsonl", gcsUri: [src] };
      } else if (src.startsWith("bq://")) {
        sourceObj = { format: "bigquery", bigqueryUri: src };
      } else {
        throw new Error(`Unsupported string source for Vertex AI: ${src}`);
      }
    } else {
      if (src.startsWith("files/")) {
        sourceObj = { fileName: src };
      } else {
        throw new Error(`Unsupported string source for Gemini API: ${src}`);
      }
    }
  } else if (Array.isArray(src)) {
    if (client.isVertexAI()) {
      throw new Error("InlinedRequest[] is not supported in Vertex AI.");
    }
    sourceObj = { inlinedRequests: src };
  } else {
    sourceObj = src;
  }
  const vertexSourcesCount = [sourceObj.gcsUri, sourceObj.bigqueryUri].filter(Boolean).length;
  const mldevSourcesCount = [
    sourceObj.inlinedRequests,
    sourceObj.fileName
  ].filter(Boolean).length;
  if (client.isVertexAI()) {
    if (mldevSourcesCount > 0 || vertexSourcesCount !== 1) {
      throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.");
    }
  } else {
    if (vertexSourcesCount > 0 || mldevSourcesCount !== 1) {
      throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");
    }
  }
  return sourceObj;
}
function tBatchJobDestination(dest) {
  if (typeof dest !== "string") {
    return dest;
  }
  const destString = dest;
  if (destString.startsWith("gs://")) {
    return {
      format: "jsonl",
      gcsUri: destString
    };
  } else if (destString.startsWith("bq://")) {
    return {
      format: "bigquery",
      bigqueryUri: destString
    };
  } else {
    throw new Error(`Unsupported destination: ${destString}`);
  }
}
function tRecvBatchJobDestination(dest) {
  if (typeof dest !== "object" || dest === null) {
    return {};
  }
  const obj = dest;
  const inlineResponsesVal = obj["inlinedResponses"];
  if (typeof inlineResponsesVal !== "object" || inlineResponsesVal === null) {
    return dest;
  }
  const inlineResponsesObj = inlineResponsesVal;
  const responsesArray = inlineResponsesObj["inlinedResponses"];
  if (!Array.isArray(responsesArray) || responsesArray.length === 0) {
    return dest;
  }
  let hasEmbedding = false;
  for (const responseItem of responsesArray) {
    if (typeof responseItem !== "object" || responseItem === null) {
      continue;
    }
    const responseItemObj = responseItem;
    const responseVal = responseItemObj["response"];
    if (typeof responseVal !== "object" || responseVal === null) {
      continue;
    }
    const responseObj = responseVal;
    if (responseObj["embedding"] !== void 0) {
      hasEmbedding = true;
      break;
    }
  }
  if (hasEmbedding) {
    obj["inlinedEmbedContentResponses"] = obj["inlinedResponses"];
    delete obj["inlinedResponses"];
  }
  return dest;
}
function tBatchJobName(apiClient, name) {
  const nameString = name;
  if (!apiClient.isVertexAI()) {
    const mldevPattern = /batches\/[^/]+$/;
    if (mldevPattern.test(nameString)) {
      return nameString.split("/").pop();
    } else {
      throw new Error(`Invalid batch job name: ${nameString}.`);
    }
  }
  const vertexPattern = /^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/;
  if (vertexPattern.test(nameString)) {
    return nameString.split("/").pop();
  } else if (/^\d+$/.test(nameString)) {
    return nameString;
  } else {
    throw new Error(`Invalid batch job name: ${nameString}.`);
  }
}
function tJobState(state) {
  const stateString = state;
  if (stateString === "BATCH_STATE_UNSPECIFIED") {
    return "JOB_STATE_UNSPECIFIED";
  } else if (stateString === "BATCH_STATE_PENDING") {
    return "JOB_STATE_PENDING";
  } else if (stateString === "BATCH_STATE_RUNNING") {
    return "JOB_STATE_RUNNING";
  } else if (stateString === "BATCH_STATE_SUCCEEDED") {
    return "JOB_STATE_SUCCEEDED";
  } else if (stateString === "BATCH_STATE_FAILED") {
    return "JOB_STATE_FAILED";
  } else if (stateString === "BATCH_STATE_CANCELLED") {
    return "JOB_STATE_CANCELLED";
  } else if (stateString === "BATCH_STATE_EXPIRED") {
    return "JOB_STATE_EXPIRED";
  } else {
    return stateString;
  }
}
function batchJobDestinationFromMldev(fromObject) {
  const toObject = {};
  const fromFileName = getValueByPath(fromObject, ["responsesFile"]);
  if (fromFileName != null) {
    setValueByPath(toObject, ["fileName"], fromFileName);
  }
  const fromInlinedResponses = getValueByPath(fromObject, [
    "inlinedResponses",
    "inlinedResponses"
  ]);
  if (fromInlinedResponses != null) {
    let transformedList = fromInlinedResponses;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return inlinedResponseFromMldev(item);
      });
    }
    setValueByPath(toObject, ["inlinedResponses"], transformedList);
  }
  const fromInlinedEmbedContentResponses = getValueByPath(fromObject, [
    "inlinedEmbedContentResponses",
    "inlinedResponses"
  ]);
  if (fromInlinedEmbedContentResponses != null) {
    let transformedList = fromInlinedEmbedContentResponses;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["inlinedEmbedContentResponses"], transformedList);
  }
  return toObject;
}
function batchJobDestinationFromVertex(fromObject) {
  const toObject = {};
  const fromFormat = getValueByPath(fromObject, ["predictionsFormat"]);
  if (fromFormat != null) {
    setValueByPath(toObject, ["format"], fromFormat);
  }
  const fromGcsUri = getValueByPath(fromObject, [
    "gcsDestination",
    "outputUriPrefix"
  ]);
  if (fromGcsUri != null) {
    setValueByPath(toObject, ["gcsUri"], fromGcsUri);
  }
  const fromBigqueryUri = getValueByPath(fromObject, [
    "bigqueryDestination",
    "outputUri"
  ]);
  if (fromBigqueryUri != null) {
    setValueByPath(toObject, ["bigqueryUri"], fromBigqueryUri);
  }
  return toObject;
}
function batchJobDestinationToVertex(fromObject) {
  const toObject = {};
  const fromFormat = getValueByPath(fromObject, ["format"]);
  if (fromFormat != null) {
    setValueByPath(toObject, ["predictionsFormat"], fromFormat);
  }
  const fromGcsUri = getValueByPath(fromObject, ["gcsUri"]);
  if (fromGcsUri != null) {
    setValueByPath(toObject, ["gcsDestination", "outputUriPrefix"], fromGcsUri);
  }
  const fromBigqueryUri = getValueByPath(fromObject, ["bigqueryUri"]);
  if (fromBigqueryUri != null) {
    setValueByPath(toObject, ["bigqueryDestination", "outputUri"], fromBigqueryUri);
  }
  if (getValueByPath(fromObject, ["fileName"]) !== void 0) {
    throw new Error("fileName parameter is not supported in Vertex AI.");
  }
  if (getValueByPath(fromObject, ["inlinedResponses"]) !== void 0) {
    throw new Error("inlinedResponses parameter is not supported in Vertex AI.");
  }
  if (getValueByPath(fromObject, ["inlinedEmbedContentResponses"]) !== void 0) {
    throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");
  }
  return toObject;
}
function batchJobFromMldev(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromDisplayName = getValueByPath(fromObject, [
    "metadata",
    "displayName"
  ]);
  if (fromDisplayName != null) {
    setValueByPath(toObject, ["displayName"], fromDisplayName);
  }
  const fromState = getValueByPath(fromObject, ["metadata", "state"]);
  if (fromState != null) {
    setValueByPath(toObject, ["state"], tJobState(fromState));
  }
  const fromCreateTime = getValueByPath(fromObject, [
    "metadata",
    "createTime"
  ]);
  if (fromCreateTime != null) {
    setValueByPath(toObject, ["createTime"], fromCreateTime);
  }
  const fromEndTime = getValueByPath(fromObject, [
    "metadata",
    "endTime"
  ]);
  if (fromEndTime != null) {
    setValueByPath(toObject, ["endTime"], fromEndTime);
  }
  const fromUpdateTime = getValueByPath(fromObject, [
    "metadata",
    "updateTime"
  ]);
  if (fromUpdateTime != null) {
    setValueByPath(toObject, ["updateTime"], fromUpdateTime);
  }
  const fromModel = getValueByPath(fromObject, ["metadata", "model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["model"], fromModel);
  }
  const fromDest = getValueByPath(fromObject, ["metadata", "output"]);
  if (fromDest != null) {
    setValueByPath(toObject, ["dest"], batchJobDestinationFromMldev(tRecvBatchJobDestination(fromDest)));
  }
  return toObject;
}
function batchJobFromVertex(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromDisplayName = getValueByPath(fromObject, ["displayName"]);
  if (fromDisplayName != null) {
    setValueByPath(toObject, ["displayName"], fromDisplayName);
  }
  const fromState = getValueByPath(fromObject, ["state"]);
  if (fromState != null) {
    setValueByPath(toObject, ["state"], tJobState(fromState));
  }
  const fromError = getValueByPath(fromObject, ["error"]);
  if (fromError != null) {
    setValueByPath(toObject, ["error"], fromError);
  }
  const fromCreateTime = getValueByPath(fromObject, ["createTime"]);
  if (fromCreateTime != null) {
    setValueByPath(toObject, ["createTime"], fromCreateTime);
  }
  const fromStartTime = getValueByPath(fromObject, ["startTime"]);
  if (fromStartTime != null) {
    setValueByPath(toObject, ["startTime"], fromStartTime);
  }
  const fromEndTime = getValueByPath(fromObject, ["endTime"]);
  if (fromEndTime != null) {
    setValueByPath(toObject, ["endTime"], fromEndTime);
  }
  const fromUpdateTime = getValueByPath(fromObject, ["updateTime"]);
  if (fromUpdateTime != null) {
    setValueByPath(toObject, ["updateTime"], fromUpdateTime);
  }
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["model"], fromModel);
  }
  const fromSrc = getValueByPath(fromObject, ["inputConfig"]);
  if (fromSrc != null) {
    setValueByPath(toObject, ["src"], batchJobSourceFromVertex(fromSrc));
  }
  const fromDest = getValueByPath(fromObject, ["outputConfig"]);
  if (fromDest != null) {
    setValueByPath(toObject, ["dest"], batchJobDestinationFromVertex(tRecvBatchJobDestination(fromDest)));
  }
  const fromCompletionStats = getValueByPath(fromObject, [
    "completionStats"
  ]);
  if (fromCompletionStats != null) {
    setValueByPath(toObject, ["completionStats"], fromCompletionStats);
  }
  return toObject;
}
function batchJobSourceFromVertex(fromObject) {
  const toObject = {};
  const fromFormat = getValueByPath(fromObject, ["instancesFormat"]);
  if (fromFormat != null) {
    setValueByPath(toObject, ["format"], fromFormat);
  }
  const fromGcsUri = getValueByPath(fromObject, ["gcsSource", "uris"]);
  if (fromGcsUri != null) {
    setValueByPath(toObject, ["gcsUri"], fromGcsUri);
  }
  const fromBigqueryUri = getValueByPath(fromObject, [
    "bigquerySource",
    "inputUri"
  ]);
  if (fromBigqueryUri != null) {
    setValueByPath(toObject, ["bigqueryUri"], fromBigqueryUri);
  }
  return toObject;
}
function batchJobSourceToMldev(apiClient, fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["format"]) !== void 0) {
    throw new Error("format parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["gcsUri"]) !== void 0) {
    throw new Error("gcsUri parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["bigqueryUri"]) !== void 0) {
    throw new Error("bigqueryUri parameter is not supported in Gemini API.");
  }
  const fromFileName = getValueByPath(fromObject, ["fileName"]);
  if (fromFileName != null) {
    setValueByPath(toObject, ["fileName"], fromFileName);
  }
  const fromInlinedRequests = getValueByPath(fromObject, [
    "inlinedRequests"
  ]);
  if (fromInlinedRequests != null) {
    let transformedList = fromInlinedRequests;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return inlinedRequestToMldev(apiClient, item);
      });
    }
    setValueByPath(toObject, ["requests", "requests"], transformedList);
  }
  return toObject;
}
function batchJobSourceToVertex(fromObject) {
  const toObject = {};
  const fromFormat = getValueByPath(fromObject, ["format"]);
  if (fromFormat != null) {
    setValueByPath(toObject, ["instancesFormat"], fromFormat);
  }
  const fromGcsUri = getValueByPath(fromObject, ["gcsUri"]);
  if (fromGcsUri != null) {
    setValueByPath(toObject, ["gcsSource", "uris"], fromGcsUri);
  }
  const fromBigqueryUri = getValueByPath(fromObject, ["bigqueryUri"]);
  if (fromBigqueryUri != null) {
    setValueByPath(toObject, ["bigquerySource", "inputUri"], fromBigqueryUri);
  }
  if (getValueByPath(fromObject, ["fileName"]) !== void 0) {
    throw new Error("fileName parameter is not supported in Vertex AI.");
  }
  if (getValueByPath(fromObject, ["inlinedRequests"]) !== void 0) {
    throw new Error("inlinedRequests parameter is not supported in Vertex AI.");
  }
  return toObject;
}
function blobToMldev$4(fromObject) {
  const toObject = {};
  const fromData = getValueByPath(fromObject, ["data"]);
  if (fromData != null) {
    setValueByPath(toObject, ["data"], fromData);
  }
  if (getValueByPath(fromObject, ["displayName"]) !== void 0) {
    throw new Error("displayName parameter is not supported in Gemini API.");
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function cancelBatchJobParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], tBatchJobName(apiClient, fromName));
  }
  return toObject;
}
function cancelBatchJobParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], tBatchJobName(apiClient, fromName));
  }
  return toObject;
}
function candidateFromMldev$1(fromObject) {
  const toObject = {};
  const fromContent = getValueByPath(fromObject, ["content"]);
  if (fromContent != null) {
    setValueByPath(toObject, ["content"], fromContent);
  }
  const fromCitationMetadata = getValueByPath(fromObject, [
    "citationMetadata"
  ]);
  if (fromCitationMetadata != null) {
    setValueByPath(toObject, ["citationMetadata"], citationMetadataFromMldev$1(fromCitationMetadata));
  }
  const fromTokenCount = getValueByPath(fromObject, ["tokenCount"]);
  if (fromTokenCount != null) {
    setValueByPath(toObject, ["tokenCount"], fromTokenCount);
  }
  const fromFinishReason = getValueByPath(fromObject, ["finishReason"]);
  if (fromFinishReason != null) {
    setValueByPath(toObject, ["finishReason"], fromFinishReason);
  }
  const fromAvgLogprobs = getValueByPath(fromObject, ["avgLogprobs"]);
  if (fromAvgLogprobs != null) {
    setValueByPath(toObject, ["avgLogprobs"], fromAvgLogprobs);
  }
  const fromGroundingMetadata = getValueByPath(fromObject, [
    "groundingMetadata"
  ]);
  if (fromGroundingMetadata != null) {
    setValueByPath(toObject, ["groundingMetadata"], fromGroundingMetadata);
  }
  const fromIndex = getValueByPath(fromObject, ["index"]);
  if (fromIndex != null) {
    setValueByPath(toObject, ["index"], fromIndex);
  }
  const fromLogprobsResult = getValueByPath(fromObject, [
    "logprobsResult"
  ]);
  if (fromLogprobsResult != null) {
    setValueByPath(toObject, ["logprobsResult"], fromLogprobsResult);
  }
  const fromSafetyRatings = getValueByPath(fromObject, [
    "safetyRatings"
  ]);
  if (fromSafetyRatings != null) {
    let transformedList = fromSafetyRatings;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["safetyRatings"], transformedList);
  }
  const fromUrlContextMetadata = getValueByPath(fromObject, [
    "urlContextMetadata"
  ]);
  if (fromUrlContextMetadata != null) {
    setValueByPath(toObject, ["urlContextMetadata"], fromUrlContextMetadata);
  }
  return toObject;
}
function citationMetadataFromMldev$1(fromObject) {
  const toObject = {};
  const fromCitations = getValueByPath(fromObject, ["citationSources"]);
  if (fromCitations != null) {
    let transformedList = fromCitations;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["citations"], transformedList);
  }
  return toObject;
}
function contentToMldev$4(fromObject) {
  const toObject = {};
  const fromParts = getValueByPath(fromObject, ["parts"]);
  if (fromParts != null) {
    let transformedList = fromParts;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return partToMldev$4(item);
      });
    }
    setValueByPath(toObject, ["parts"], transformedList);
  }
  const fromRole = getValueByPath(fromObject, ["role"]);
  if (fromRole != null) {
    setValueByPath(toObject, ["role"], fromRole);
  }
  return toObject;
}
function createBatchJobConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromDisplayName = getValueByPath(fromObject, ["displayName"]);
  if (parentObject !== void 0 && fromDisplayName != null) {
    setValueByPath(parentObject, ["batch", "displayName"], fromDisplayName);
  }
  if (getValueByPath(fromObject, ["dest"]) !== void 0) {
    throw new Error("dest parameter is not supported in Gemini API.");
  }
  return toObject;
}
function createBatchJobConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromDisplayName = getValueByPath(fromObject, ["displayName"]);
  if (parentObject !== void 0 && fromDisplayName != null) {
    setValueByPath(parentObject, ["displayName"], fromDisplayName);
  }
  const fromDest = getValueByPath(fromObject, ["dest"]);
  if (parentObject !== void 0 && fromDest != null) {
    setValueByPath(parentObject, ["outputConfig"], batchJobDestinationToVertex(tBatchJobDestination(fromDest)));
  }
  return toObject;
}
function createBatchJobParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromSrc = getValueByPath(fromObject, ["src"]);
  if (fromSrc != null) {
    setValueByPath(toObject, ["batch", "inputConfig"], batchJobSourceToMldev(apiClient, tBatchJobSource(apiClient, fromSrc)));
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    createBatchJobConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function createBatchJobParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["model"], tModel(apiClient, fromModel));
  }
  const fromSrc = getValueByPath(fromObject, ["src"]);
  if (fromSrc != null) {
    setValueByPath(toObject, ["inputConfig"], batchJobSourceToVertex(tBatchJobSource(apiClient, fromSrc)));
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    createBatchJobConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
function createEmbeddingsBatchJobConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromDisplayName = getValueByPath(fromObject, ["displayName"]);
  if (parentObject !== void 0 && fromDisplayName != null) {
    setValueByPath(parentObject, ["batch", "displayName"], fromDisplayName);
  }
  return toObject;
}
function createEmbeddingsBatchJobParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromSrc = getValueByPath(fromObject, ["src"]);
  if (fromSrc != null) {
    setValueByPath(toObject, ["batch", "inputConfig"], embeddingsBatchJobSourceToMldev(apiClient, fromSrc));
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    createEmbeddingsBatchJobConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function deleteBatchJobParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], tBatchJobName(apiClient, fromName));
  }
  return toObject;
}
function deleteBatchJobParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], tBatchJobName(apiClient, fromName));
  }
  return toObject;
}
function deleteResourceJobFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromDone = getValueByPath(fromObject, ["done"]);
  if (fromDone != null) {
    setValueByPath(toObject, ["done"], fromDone);
  }
  const fromError = getValueByPath(fromObject, ["error"]);
  if (fromError != null) {
    setValueByPath(toObject, ["error"], fromError);
  }
  return toObject;
}
function deleteResourceJobFromVertex(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromDone = getValueByPath(fromObject, ["done"]);
  if (fromDone != null) {
    setValueByPath(toObject, ["done"], fromDone);
  }
  const fromError = getValueByPath(fromObject, ["error"]);
  if (fromError != null) {
    setValueByPath(toObject, ["error"], fromError);
  }
  return toObject;
}
function embedContentBatchToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromContents = getValueByPath(fromObject, ["contents"]);
  if (fromContents != null) {
    let transformedList = tContentsForEmbed(apiClient, fromContents);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["requests[]", "request", "content"], transformedList);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    setValueByPath(toObject, ["_self"], embedContentConfigToMldev$1(fromConfig, toObject));
    moveValueByPath(toObject, { "requests[].*": "requests[].request.*" });
  }
  return toObject;
}
function embedContentConfigToMldev$1(fromObject, parentObject) {
  const toObject = {};
  const fromTaskType = getValueByPath(fromObject, ["taskType"]);
  if (parentObject !== void 0 && fromTaskType != null) {
    setValueByPath(parentObject, ["requests[]", "taskType"], fromTaskType);
  }
  const fromTitle = getValueByPath(fromObject, ["title"]);
  if (parentObject !== void 0 && fromTitle != null) {
    setValueByPath(parentObject, ["requests[]", "title"], fromTitle);
  }
  const fromOutputDimensionality = getValueByPath(fromObject, [
    "outputDimensionality"
  ]);
  if (parentObject !== void 0 && fromOutputDimensionality != null) {
    setValueByPath(parentObject, ["requests[]", "outputDimensionality"], fromOutputDimensionality);
  }
  if (getValueByPath(fromObject, ["mimeType"]) !== void 0) {
    throw new Error("mimeType parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["autoTruncate"]) !== void 0) {
    throw new Error("autoTruncate parameter is not supported in Gemini API.");
  }
  return toObject;
}
function embeddingsBatchJobSourceToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromFileName = getValueByPath(fromObject, ["fileName"]);
  if (fromFileName != null) {
    setValueByPath(toObject, ["file_name"], fromFileName);
  }
  const fromInlinedRequests = getValueByPath(fromObject, [
    "inlinedRequests"
  ]);
  if (fromInlinedRequests != null) {
    setValueByPath(toObject, ["requests"], embedContentBatchToMldev(apiClient, fromInlinedRequests));
  }
  return toObject;
}
function fileDataToMldev$4(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["displayName"]) !== void 0) {
    throw new Error("displayName parameter is not supported in Gemini API.");
  }
  const fromFileUri = getValueByPath(fromObject, ["fileUri"]);
  if (fromFileUri != null) {
    setValueByPath(toObject, ["fileUri"], fromFileUri);
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function functionCallToMldev$4(fromObject) {
  const toObject = {};
  const fromId = getValueByPath(fromObject, ["id"]);
  if (fromId != null) {
    setValueByPath(toObject, ["id"], fromId);
  }
  const fromArgs = getValueByPath(fromObject, ["args"]);
  if (fromArgs != null) {
    setValueByPath(toObject, ["args"], fromArgs);
  }
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  if (getValueByPath(fromObject, ["partialArgs"]) !== void 0) {
    throw new Error("partialArgs parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["willContinue"]) !== void 0) {
    throw new Error("willContinue parameter is not supported in Gemini API.");
  }
  return toObject;
}
function functionCallingConfigToMldev$2(fromObject) {
  const toObject = {};
  const fromMode = getValueByPath(fromObject, ["mode"]);
  if (fromMode != null) {
    setValueByPath(toObject, ["mode"], fromMode);
  }
  const fromAllowedFunctionNames = getValueByPath(fromObject, [
    "allowedFunctionNames"
  ]);
  if (fromAllowedFunctionNames != null) {
    setValueByPath(toObject, ["allowedFunctionNames"], fromAllowedFunctionNames);
  }
  if (getValueByPath(fromObject, ["streamFunctionCallArguments"]) !== void 0) {
    throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");
  }
  return toObject;
}
function generateContentConfigToMldev$1(apiClient, fromObject, parentObject) {
  const toObject = {};
  const fromSystemInstruction = getValueByPath(fromObject, [
    "systemInstruction"
  ]);
  if (parentObject !== void 0 && fromSystemInstruction != null) {
    setValueByPath(parentObject, ["systemInstruction"], contentToMldev$4(tContent(fromSystemInstruction)));
  }
  const fromTemperature = getValueByPath(fromObject, ["temperature"]);
  if (fromTemperature != null) {
    setValueByPath(toObject, ["temperature"], fromTemperature);
  }
  const fromTopP = getValueByPath(fromObject, ["topP"]);
  if (fromTopP != null) {
    setValueByPath(toObject, ["topP"], fromTopP);
  }
  const fromTopK = getValueByPath(fromObject, ["topK"]);
  if (fromTopK != null) {
    setValueByPath(toObject, ["topK"], fromTopK);
  }
  const fromCandidateCount = getValueByPath(fromObject, [
    "candidateCount"
  ]);
  if (fromCandidateCount != null) {
    setValueByPath(toObject, ["candidateCount"], fromCandidateCount);
  }
  const fromMaxOutputTokens = getValueByPath(fromObject, [
    "maxOutputTokens"
  ]);
  if (fromMaxOutputTokens != null) {
    setValueByPath(toObject, ["maxOutputTokens"], fromMaxOutputTokens);
  }
  const fromStopSequences = getValueByPath(fromObject, [
    "stopSequences"
  ]);
  if (fromStopSequences != null) {
    setValueByPath(toObject, ["stopSequences"], fromStopSequences);
  }
  const fromResponseLogprobs = getValueByPath(fromObject, [
    "responseLogprobs"
  ]);
  if (fromResponseLogprobs != null) {
    setValueByPath(toObject, ["responseLogprobs"], fromResponseLogprobs);
  }
  const fromLogprobs = getValueByPath(fromObject, ["logprobs"]);
  if (fromLogprobs != null) {
    setValueByPath(toObject, ["logprobs"], fromLogprobs);
  }
  const fromPresencePenalty = getValueByPath(fromObject, [
    "presencePenalty"
  ]);
  if (fromPresencePenalty != null) {
    setValueByPath(toObject, ["presencePenalty"], fromPresencePenalty);
  }
  const fromFrequencyPenalty = getValueByPath(fromObject, [
    "frequencyPenalty"
  ]);
  if (fromFrequencyPenalty != null) {
    setValueByPath(toObject, ["frequencyPenalty"], fromFrequencyPenalty);
  }
  const fromSeed = getValueByPath(fromObject, ["seed"]);
  if (fromSeed != null) {
    setValueByPath(toObject, ["seed"], fromSeed);
  }
  const fromResponseMimeType = getValueByPath(fromObject, [
    "responseMimeType"
  ]);
  if (fromResponseMimeType != null) {
    setValueByPath(toObject, ["responseMimeType"], fromResponseMimeType);
  }
  const fromResponseSchema = getValueByPath(fromObject, [
    "responseSchema"
  ]);
  if (fromResponseSchema != null) {
    setValueByPath(toObject, ["responseSchema"], tSchema(fromResponseSchema));
  }
  const fromResponseJsonSchema = getValueByPath(fromObject, [
    "responseJsonSchema"
  ]);
  if (fromResponseJsonSchema != null) {
    setValueByPath(toObject, ["responseJsonSchema"], fromResponseJsonSchema);
  }
  if (getValueByPath(fromObject, ["routingConfig"]) !== void 0) {
    throw new Error("routingConfig parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["modelSelectionConfig"]) !== void 0) {
    throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");
  }
  const fromSafetySettings = getValueByPath(fromObject, [
    "safetySettings"
  ]);
  if (parentObject !== void 0 && fromSafetySettings != null) {
    let transformedList = fromSafetySettings;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return safetySettingToMldev$1(item);
      });
    }
    setValueByPath(parentObject, ["safetySettings"], transformedList);
  }
  const fromTools = getValueByPath(fromObject, ["tools"]);
  if (parentObject !== void 0 && fromTools != null) {
    let transformedList = tTools(fromTools);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return toolToMldev$4(tTool(item));
      });
    }
    setValueByPath(parentObject, ["tools"], transformedList);
  }
  const fromToolConfig = getValueByPath(fromObject, ["toolConfig"]);
  if (parentObject !== void 0 && fromToolConfig != null) {
    setValueByPath(parentObject, ["toolConfig"], toolConfigToMldev$2(fromToolConfig));
  }
  if (getValueByPath(fromObject, ["labels"]) !== void 0) {
    throw new Error("labels parameter is not supported in Gemini API.");
  }
  const fromCachedContent = getValueByPath(fromObject, [
    "cachedContent"
  ]);
  if (parentObject !== void 0 && fromCachedContent != null) {
    setValueByPath(parentObject, ["cachedContent"], tCachedContentName(apiClient, fromCachedContent));
  }
  const fromResponseModalities = getValueByPath(fromObject, [
    "responseModalities"
  ]);
  if (fromResponseModalities != null) {
    setValueByPath(toObject, ["responseModalities"], fromResponseModalities);
  }
  const fromMediaResolution = getValueByPath(fromObject, [
    "mediaResolution"
  ]);
  if (fromMediaResolution != null) {
    setValueByPath(toObject, ["mediaResolution"], fromMediaResolution);
  }
  const fromSpeechConfig = getValueByPath(fromObject, ["speechConfig"]);
  if (fromSpeechConfig != null) {
    setValueByPath(toObject, ["speechConfig"], tSpeechConfig(fromSpeechConfig));
  }
  if (getValueByPath(fromObject, ["audioTimestamp"]) !== void 0) {
    throw new Error("audioTimestamp parameter is not supported in Gemini API.");
  }
  const fromThinkingConfig = getValueByPath(fromObject, [
    "thinkingConfig"
  ]);
  if (fromThinkingConfig != null) {
    setValueByPath(toObject, ["thinkingConfig"], fromThinkingConfig);
  }
  const fromImageConfig = getValueByPath(fromObject, ["imageConfig"]);
  if (fromImageConfig != null) {
    setValueByPath(toObject, ["imageConfig"], imageConfigToMldev$1(fromImageConfig));
  }
  const fromEnableEnhancedCivicAnswers = getValueByPath(fromObject, [
    "enableEnhancedCivicAnswers"
  ]);
  if (fromEnableEnhancedCivicAnswers != null) {
    setValueByPath(toObject, ["enableEnhancedCivicAnswers"], fromEnableEnhancedCivicAnswers);
  }
  return toObject;
}
function generateContentResponseFromMldev$1(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromCandidates = getValueByPath(fromObject, ["candidates"]);
  if (fromCandidates != null) {
    let transformedList = fromCandidates;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return candidateFromMldev$1(item);
      });
    }
    setValueByPath(toObject, ["candidates"], transformedList);
  }
  const fromModelVersion = getValueByPath(fromObject, ["modelVersion"]);
  if (fromModelVersion != null) {
    setValueByPath(toObject, ["modelVersion"], fromModelVersion);
  }
  const fromPromptFeedback = getValueByPath(fromObject, [
    "promptFeedback"
  ]);
  if (fromPromptFeedback != null) {
    setValueByPath(toObject, ["promptFeedback"], fromPromptFeedback);
  }
  const fromResponseId = getValueByPath(fromObject, ["responseId"]);
  if (fromResponseId != null) {
    setValueByPath(toObject, ["responseId"], fromResponseId);
  }
  const fromUsageMetadata = getValueByPath(fromObject, [
    "usageMetadata"
  ]);
  if (fromUsageMetadata != null) {
    setValueByPath(toObject, ["usageMetadata"], fromUsageMetadata);
  }
  return toObject;
}
function getBatchJobParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], tBatchJobName(apiClient, fromName));
  }
  return toObject;
}
function getBatchJobParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], tBatchJobName(apiClient, fromName));
  }
  return toObject;
}
function googleMapsToMldev$4(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["authConfig"]) !== void 0) {
    throw new Error("authConfig parameter is not supported in Gemini API.");
  }
  const fromEnableWidget = getValueByPath(fromObject, ["enableWidget"]);
  if (fromEnableWidget != null) {
    setValueByPath(toObject, ["enableWidget"], fromEnableWidget);
  }
  return toObject;
}
function googleSearchToMldev$4(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["excludeDomains"]) !== void 0) {
    throw new Error("excludeDomains parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["blockingConfidence"]) !== void 0) {
    throw new Error("blockingConfidence parameter is not supported in Gemini API.");
  }
  const fromTimeRangeFilter = getValueByPath(fromObject, [
    "timeRangeFilter"
  ]);
  if (fromTimeRangeFilter != null) {
    setValueByPath(toObject, ["timeRangeFilter"], fromTimeRangeFilter);
  }
  return toObject;
}
function imageConfigToMldev$1(fromObject) {
  const toObject = {};
  const fromAspectRatio = getValueByPath(fromObject, ["aspectRatio"]);
  if (fromAspectRatio != null) {
    setValueByPath(toObject, ["aspectRatio"], fromAspectRatio);
  }
  const fromImageSize = getValueByPath(fromObject, ["imageSize"]);
  if (fromImageSize != null) {
    setValueByPath(toObject, ["imageSize"], fromImageSize);
  }
  if (getValueByPath(fromObject, ["outputMimeType"]) !== void 0) {
    throw new Error("outputMimeType parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["outputCompressionQuality"]) !== void 0) {
    throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");
  }
  return toObject;
}
function inlinedRequestToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["request", "model"], tModel(apiClient, fromModel));
  }
  const fromContents = getValueByPath(fromObject, ["contents"]);
  if (fromContents != null) {
    let transformedList = tContents(fromContents);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return contentToMldev$4(item);
      });
    }
    setValueByPath(toObject, ["request", "contents"], transformedList);
  }
  const fromMetadata = getValueByPath(fromObject, ["metadata"]);
  if (fromMetadata != null) {
    setValueByPath(toObject, ["metadata"], fromMetadata);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    setValueByPath(toObject, ["request", "generationConfig"], generateContentConfigToMldev$1(apiClient, fromConfig, getValueByPath(toObject, ["request"], {})));
  }
  return toObject;
}
function inlinedResponseFromMldev(fromObject) {
  const toObject = {};
  const fromResponse = getValueByPath(fromObject, ["response"]);
  if (fromResponse != null) {
    setValueByPath(toObject, ["response"], generateContentResponseFromMldev$1(fromResponse));
  }
  const fromError = getValueByPath(fromObject, ["error"]);
  if (fromError != null) {
    setValueByPath(toObject, ["error"], fromError);
  }
  return toObject;
}
function listBatchJobsConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromPageSize = getValueByPath(fromObject, ["pageSize"]);
  if (parentObject !== void 0 && fromPageSize != null) {
    setValueByPath(parentObject, ["_query", "pageSize"], fromPageSize);
  }
  const fromPageToken = getValueByPath(fromObject, ["pageToken"]);
  if (parentObject !== void 0 && fromPageToken != null) {
    setValueByPath(parentObject, ["_query", "pageToken"], fromPageToken);
  }
  if (getValueByPath(fromObject, ["filter"]) !== void 0) {
    throw new Error("filter parameter is not supported in Gemini API.");
  }
  return toObject;
}
function listBatchJobsConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromPageSize = getValueByPath(fromObject, ["pageSize"]);
  if (parentObject !== void 0 && fromPageSize != null) {
    setValueByPath(parentObject, ["_query", "pageSize"], fromPageSize);
  }
  const fromPageToken = getValueByPath(fromObject, ["pageToken"]);
  if (parentObject !== void 0 && fromPageToken != null) {
    setValueByPath(parentObject, ["_query", "pageToken"], fromPageToken);
  }
  const fromFilter = getValueByPath(fromObject, ["filter"]);
  if (parentObject !== void 0 && fromFilter != null) {
    setValueByPath(parentObject, ["_query", "filter"], fromFilter);
  }
  return toObject;
}
function listBatchJobsParametersToMldev(fromObject) {
  const toObject = {};
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    listBatchJobsConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function listBatchJobsParametersToVertex(fromObject) {
  const toObject = {};
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    listBatchJobsConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
function listBatchJobsResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromNextPageToken = getValueByPath(fromObject, [
    "nextPageToken"
  ]);
  if (fromNextPageToken != null) {
    setValueByPath(toObject, ["nextPageToken"], fromNextPageToken);
  }
  const fromBatchJobs = getValueByPath(fromObject, ["operations"]);
  if (fromBatchJobs != null) {
    let transformedList = fromBatchJobs;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return batchJobFromMldev(item);
      });
    }
    setValueByPath(toObject, ["batchJobs"], transformedList);
  }
  return toObject;
}
function listBatchJobsResponseFromVertex(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromNextPageToken = getValueByPath(fromObject, [
    "nextPageToken"
  ]);
  if (fromNextPageToken != null) {
    setValueByPath(toObject, ["nextPageToken"], fromNextPageToken);
  }
  const fromBatchJobs = getValueByPath(fromObject, [
    "batchPredictionJobs"
  ]);
  if (fromBatchJobs != null) {
    let transformedList = fromBatchJobs;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return batchJobFromVertex(item);
      });
    }
    setValueByPath(toObject, ["batchJobs"], transformedList);
  }
  return toObject;
}
function partToMldev$4(fromObject) {
  const toObject = {};
  const fromMediaResolution = getValueByPath(fromObject, [
    "mediaResolution"
  ]);
  if (fromMediaResolution != null) {
    setValueByPath(toObject, ["mediaResolution"], fromMediaResolution);
  }
  const fromCodeExecutionResult = getValueByPath(fromObject, [
    "codeExecutionResult"
  ]);
  if (fromCodeExecutionResult != null) {
    setValueByPath(toObject, ["codeExecutionResult"], fromCodeExecutionResult);
  }
  const fromExecutableCode = getValueByPath(fromObject, [
    "executableCode"
  ]);
  if (fromExecutableCode != null) {
    setValueByPath(toObject, ["executableCode"], fromExecutableCode);
  }
  const fromFileData = getValueByPath(fromObject, ["fileData"]);
  if (fromFileData != null) {
    setValueByPath(toObject, ["fileData"], fileDataToMldev$4(fromFileData));
  }
  const fromFunctionCall = getValueByPath(fromObject, ["functionCall"]);
  if (fromFunctionCall != null) {
    setValueByPath(toObject, ["functionCall"], functionCallToMldev$4(fromFunctionCall));
  }
  const fromFunctionResponse = getValueByPath(fromObject, [
    "functionResponse"
  ]);
  if (fromFunctionResponse != null) {
    setValueByPath(toObject, ["functionResponse"], fromFunctionResponse);
  }
  const fromInlineData = getValueByPath(fromObject, ["inlineData"]);
  if (fromInlineData != null) {
    setValueByPath(toObject, ["inlineData"], blobToMldev$4(fromInlineData));
  }
  const fromText = getValueByPath(fromObject, ["text"]);
  if (fromText != null) {
    setValueByPath(toObject, ["text"], fromText);
  }
  const fromThought = getValueByPath(fromObject, ["thought"]);
  if (fromThought != null) {
    setValueByPath(toObject, ["thought"], fromThought);
  }
  const fromThoughtSignature = getValueByPath(fromObject, [
    "thoughtSignature"
  ]);
  if (fromThoughtSignature != null) {
    setValueByPath(toObject, ["thoughtSignature"], fromThoughtSignature);
  }
  const fromVideoMetadata = getValueByPath(fromObject, [
    "videoMetadata"
  ]);
  if (fromVideoMetadata != null) {
    setValueByPath(toObject, ["videoMetadata"], fromVideoMetadata);
  }
  return toObject;
}
function safetySettingToMldev$1(fromObject) {
  const toObject = {};
  const fromCategory = getValueByPath(fromObject, ["category"]);
  if (fromCategory != null) {
    setValueByPath(toObject, ["category"], fromCategory);
  }
  if (getValueByPath(fromObject, ["method"]) !== void 0) {
    throw new Error("method parameter is not supported in Gemini API.");
  }
  const fromThreshold = getValueByPath(fromObject, ["threshold"]);
  if (fromThreshold != null) {
    setValueByPath(toObject, ["threshold"], fromThreshold);
  }
  return toObject;
}
function toolConfigToMldev$2(fromObject) {
  const toObject = {};
  const fromFunctionCallingConfig = getValueByPath(fromObject, [
    "functionCallingConfig"
  ]);
  if (fromFunctionCallingConfig != null) {
    setValueByPath(toObject, ["functionCallingConfig"], functionCallingConfigToMldev$2(fromFunctionCallingConfig));
  }
  const fromRetrievalConfig = getValueByPath(fromObject, [
    "retrievalConfig"
  ]);
  if (fromRetrievalConfig != null) {
    setValueByPath(toObject, ["retrievalConfig"], fromRetrievalConfig);
  }
  return toObject;
}
function toolToMldev$4(fromObject) {
  const toObject = {};
  const fromFunctionDeclarations = getValueByPath(fromObject, [
    "functionDeclarations"
  ]);
  if (fromFunctionDeclarations != null) {
    let transformedList = fromFunctionDeclarations;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["functionDeclarations"], transformedList);
  }
  if (getValueByPath(fromObject, ["retrieval"]) !== void 0) {
    throw new Error("retrieval parameter is not supported in Gemini API.");
  }
  const fromGoogleSearchRetrieval = getValueByPath(fromObject, [
    "googleSearchRetrieval"
  ]);
  if (fromGoogleSearchRetrieval != null) {
    setValueByPath(toObject, ["googleSearchRetrieval"], fromGoogleSearchRetrieval);
  }
  const fromComputerUse = getValueByPath(fromObject, ["computerUse"]);
  if (fromComputerUse != null) {
    setValueByPath(toObject, ["computerUse"], fromComputerUse);
  }
  const fromFileSearch = getValueByPath(fromObject, ["fileSearch"]);
  if (fromFileSearch != null) {
    setValueByPath(toObject, ["fileSearch"], fromFileSearch);
  }
  const fromCodeExecution = getValueByPath(fromObject, [
    "codeExecution"
  ]);
  if (fromCodeExecution != null) {
    setValueByPath(toObject, ["codeExecution"], fromCodeExecution);
  }
  if (getValueByPath(fromObject, ["enterpriseWebSearch"]) !== void 0) {
    throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");
  }
  const fromGoogleMaps = getValueByPath(fromObject, ["googleMaps"]);
  if (fromGoogleMaps != null) {
    setValueByPath(toObject, ["googleMaps"], googleMapsToMldev$4(fromGoogleMaps));
  }
  const fromGoogleSearch = getValueByPath(fromObject, ["googleSearch"]);
  if (fromGoogleSearch != null) {
    setValueByPath(toObject, ["googleSearch"], googleSearchToMldev$4(fromGoogleSearch));
  }
  const fromUrlContext = getValueByPath(fromObject, ["urlContext"]);
  if (fromUrlContext != null) {
    setValueByPath(toObject, ["urlContext"], fromUrlContext);
  }
  return toObject;
}
var PagedItem;
(function(PagedItem2) {
  PagedItem2["PAGED_ITEM_BATCH_JOBS"] = "batchJobs";
  PagedItem2["PAGED_ITEM_MODELS"] = "models";
  PagedItem2["PAGED_ITEM_TUNING_JOBS"] = "tuningJobs";
  PagedItem2["PAGED_ITEM_FILES"] = "files";
  PagedItem2["PAGED_ITEM_CACHED_CONTENTS"] = "cachedContents";
  PagedItem2["PAGED_ITEM_FILE_SEARCH_STORES"] = "fileSearchStores";
  PagedItem2["PAGED_ITEM_DOCUMENTS"] = "documents";
})(PagedItem || (PagedItem = {}));
var Pager = class {
  constructor(name, request, response, params) {
    this.pageInternal = [];
    this.paramsInternal = {};
    this.requestInternal = request;
    this.init(name, response, params);
  }
  init(name, response, params) {
    var _a2, _b;
    this.nameInternal = name;
    this.pageInternal = response[this.nameInternal] || [];
    this.sdkHttpResponseInternal = response === null || response === void 0 ? void 0 : response.sdkHttpResponse;
    this.idxInternal = 0;
    let requestParams = { config: {} };
    if (!params || Object.keys(params).length === 0) {
      requestParams = { config: {} };
    } else if (typeof params === "object") {
      requestParams = Object.assign({}, params);
    } else {
      requestParams = params;
    }
    if (requestParams["config"]) {
      requestParams["config"]["pageToken"] = response["nextPageToken"];
    }
    this.paramsInternal = requestParams;
    this.pageInternalSize = (_b = (_a2 = requestParams["config"]) === null || _a2 === void 0 ? void 0 : _a2["pageSize"]) !== null && _b !== void 0 ? _b : this.pageInternal.length;
  }
  initNextPage(response) {
    this.init(this.nameInternal, response, this.paramsInternal);
  }
  /**
   * Returns the current page, which is a list of items.
   *
   * @remarks
   * The first page is retrieved when the pager is created. The returned list of
   * items could be a subset of the entire list.
   */
  get page() {
    return this.pageInternal;
  }
  /**
   * Returns the type of paged item (for example, ``batch_jobs``).
   */
  get name() {
    return this.nameInternal;
  }
  /**
   * Returns the length of the page fetched each time by this pager.
   *
   * @remarks
   * The number of items in the page is less than or equal to the page length.
   */
  get pageSize() {
    return this.pageInternalSize;
  }
  /**
   * Returns the headers of the API response.
   */
  get sdkHttpResponse() {
    return this.sdkHttpResponseInternal;
  }
  /**
   * Returns the parameters when making the API request for the next page.
   *
   * @remarks
   * Parameters contain a set of optional configs that can be
   * used to customize the API request. For example, the `pageToken` parameter
   * contains the token to request the next page.
   */
  get params() {
    return this.paramsInternal;
  }
  /**
   * Returns the total number of items in the current page.
   */
  get pageLength() {
    return this.pageInternal.length;
  }
  /**
   * Returns the item at the given index.
   */
  getItem(index) {
    return this.pageInternal[index];
  }
  /**
   * Returns an async iterator that support iterating through all items
   * retrieved from the API.
   *
   * @remarks
   * The iterator will automatically fetch the next page if there are more items
   * to fetch from the API.
   *
   * @example
   *
   * ```ts
   * const pager = await ai.files.list({config: {pageSize: 10}});
   * for await (const file of pager) {
   *   console.log(file.name);
   * }
   * ```
   */
  [Symbol.asyncIterator]() {
    return {
      next: async () => {
        if (this.idxInternal >= this.pageLength) {
          if (this.hasNextPage()) {
            await this.nextPage();
          } else {
            return { value: void 0, done: true };
          }
        }
        const item = this.getItem(this.idxInternal);
        this.idxInternal += 1;
        return { value: item, done: false };
      },
      return: async () => {
        return { value: void 0, done: true };
      }
    };
  }
  /**
   * Fetches the next page of items. This makes a new API request.
   *
   * @throws {Error} If there are no more pages to fetch.
   *
   * @example
   *
   * ```ts
   * const pager = await ai.files.list({config: {pageSize: 10}});
   * let page = pager.page;
   * while (true) {
   *   for (const file of page) {
   *     console.log(file.name);
   *   }
   *   if (!pager.hasNextPage()) {
   *     break;
   *   }
   *   page = await pager.nextPage();
   * }
   * ```
   */
  async nextPage() {
    if (!this.hasNextPage()) {
      throw new Error("No more pages to fetch.");
    }
    const response = await this.requestInternal(this.params);
    this.initNextPage(response);
    return this.page;
  }
  /**
   * Returns true if there are more pages to fetch from the API.
   */
  hasNextPage() {
    var _a2;
    if (((_a2 = this.params["config"]) === null || _a2 === void 0 ? void 0 : _a2["pageToken"]) !== void 0) {
      return true;
    }
    return false;
  }
};
var Batches = class extends BaseModule {
  constructor(apiClient) {
    super();
    this.apiClient = apiClient;
    this.list = async (params = {}) => {
      return new Pager(PagedItem.PAGED_ITEM_BATCH_JOBS, (x) => this.listInternal(x), await this.listInternal(params), params);
    };
    this.create = async (params) => {
      if (this.apiClient.isVertexAI()) {
        params.config = this.formatDestination(params.src, params.config);
      }
      return this.createInternal(params);
    };
    this.createEmbeddings = async (params) => {
      console.warn("batches.createEmbeddings() is experimental and may change without notice.");
      if (this.apiClient.isVertexAI()) {
        throw new Error("Vertex AI does not support batches.createEmbeddings.");
      }
      return this.createEmbeddingsInternal(params);
    };
  }
  // Helper function to handle inlined generate content requests
  createInlinedGenerateContentRequest(params) {
    const body = createBatchJobParametersToMldev(
      this.apiClient,
      // Use instance apiClient
      params
    );
    const urlParams = body["_url"];
    const path2 = formatMap("{model}:batchGenerateContent", urlParams);
    const batch = body["batch"];
    const inputConfig = batch["inputConfig"];
    const requestsWrapper = inputConfig["requests"];
    const requests = requestsWrapper["requests"];
    const newRequests = [];
    for (const request of requests) {
      const requestDict = Object.assign({}, request);
      if (requestDict["systemInstruction"]) {
        const systemInstructionValue = requestDict["systemInstruction"];
        delete requestDict["systemInstruction"];
        const requestContent = requestDict["request"];
        requestContent["systemInstruction"] = systemInstructionValue;
        requestDict["request"] = requestContent;
      }
      newRequests.push(requestDict);
    }
    requestsWrapper["requests"] = newRequests;
    delete body["config"];
    delete body["_url"];
    delete body["_query"];
    return { path: path2, body };
  }
  // Helper function to get the first GCS URI
  getGcsUri(src) {
    if (typeof src === "string") {
      return src.startsWith("gs://") ? src : void 0;
    }
    if (!Array.isArray(src) && src.gcsUri && src.gcsUri.length > 0) {
      return src.gcsUri[0];
    }
    return void 0;
  }
  // Helper function to get the BigQuery URI
  getBigqueryUri(src) {
    if (typeof src === "string") {
      return src.startsWith("bq://") ? src : void 0;
    }
    if (!Array.isArray(src)) {
      return src.bigqueryUri;
    }
    return void 0;
  }
  // Function to format the destination configuration for Vertex AI
  formatDestination(src, config) {
    const newConfig = config ? Object.assign({}, config) : {};
    const timestampStr = Date.now().toString();
    if (!newConfig.displayName) {
      newConfig.displayName = `genaiBatchJob_${timestampStr}`;
    }
    if (newConfig.dest === void 0) {
      const gcsUri = this.getGcsUri(src);
      const bigqueryUri = this.getBigqueryUri(src);
      if (gcsUri) {
        if (gcsUri.endsWith(".jsonl")) {
          newConfig.dest = `${gcsUri.slice(0, -6)}/dest`;
        } else {
          newConfig.dest = `${gcsUri}_dest_${timestampStr}`;
        }
      } else if (bigqueryUri) {
        newConfig.dest = `${bigqueryUri}_dest_${timestampStr}`;
      } else {
        throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.");
      }
    }
    return newConfig;
  }
  /**
   * Internal method to create batch job.
   *
   * @param params - The parameters for create batch job request.
   * @return The created batch job.
   *
   */
  async createInternal(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = createBatchJobParametersToVertex(this.apiClient, params);
      path2 = formatMap("batchPredictionJobs", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = batchJobFromVertex(apiResponse);
        return resp;
      });
    } else {
      const body = createBatchJobParametersToMldev(this.apiClient, params);
      path2 = formatMap("{model}:batchGenerateContent", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = batchJobFromMldev(apiResponse);
        return resp;
      });
    }
  }
  /**
   * Internal method to create batch job.
   *
   * @param params - The parameters for create batch job request.
   * @return The created batch job.
   *
   */
  async createEmbeddingsInternal(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = createEmbeddingsBatchJobParametersToMldev(this.apiClient, params);
      path2 = formatMap("{model}:asyncBatchEmbedContent", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = batchJobFromMldev(apiResponse);
        return resp;
      });
    }
  }
  /**
   * Gets batch job configurations.
   *
   * @param params - The parameters for the get request.
   * @return The batch job.
   *
   * @example
   * ```ts
   * await ai.batches.get({name: '...'}); // The server-generated resource name.
   * ```
   */
  async get(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = getBatchJobParametersToVertex(this.apiClient, params);
      path2 = formatMap("batchPredictionJobs/{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = batchJobFromVertex(apiResponse);
        return resp;
      });
    } else {
      const body = getBatchJobParametersToMldev(this.apiClient, params);
      path2 = formatMap("batches/{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = batchJobFromMldev(apiResponse);
        return resp;
      });
    }
  }
  /**
   * Cancels a batch job.
   *
   * @param params - The parameters for the cancel request.
   * @return The empty response returned by the API.
   *
   * @example
   * ```ts
   * await ai.batches.cancel({name: '...'}); // The server-generated resource name.
   * ```
   */
  async cancel(params) {
    var _a2, _b, _c, _d;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = cancelBatchJobParametersToVertex(this.apiClient, params);
      path2 = formatMap("batchPredictionJobs/{name}:cancel", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      await this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      });
    } else {
      const body = cancelBatchJobParametersToMldev(this.apiClient, params);
      path2 = formatMap("batches/{name}:cancel", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      await this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      });
    }
  }
  async listInternal(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = listBatchJobsParametersToVertex(params);
      path2 = formatMap("batchPredictionJobs", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = listBatchJobsResponseFromVertex(apiResponse);
        const typedResp = new ListBatchJobsResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      const body = listBatchJobsParametersToMldev(params);
      path2 = formatMap("batches", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = listBatchJobsResponseFromMldev(apiResponse);
        const typedResp = new ListBatchJobsResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  /**
   * Deletes a batch job.
   *
   * @param params - The parameters for the delete request.
   * @return The empty response returned by the API.
   *
   * @example
   * ```ts
   * await ai.batches.delete({name: '...'}); // The server-generated resource name.
   * ```
   */
  async delete(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = deleteBatchJobParametersToVertex(this.apiClient, params);
      path2 = formatMap("batchPredictionJobs/{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "DELETE",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = deleteResourceJobFromVertex(apiResponse);
        return resp;
      });
    } else {
      const body = deleteBatchJobParametersToMldev(this.apiClient, params);
      path2 = formatMap("batches/{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "DELETE",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = deleteResourceJobFromMldev(apiResponse);
        return resp;
      });
    }
  }
};
function blobToMldev$3(fromObject) {
  const toObject = {};
  const fromData = getValueByPath(fromObject, ["data"]);
  if (fromData != null) {
    setValueByPath(toObject, ["data"], fromData);
  }
  if (getValueByPath(fromObject, ["displayName"]) !== void 0) {
    throw new Error("displayName parameter is not supported in Gemini API.");
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function contentToMldev$3(fromObject) {
  const toObject = {};
  const fromParts = getValueByPath(fromObject, ["parts"]);
  if (fromParts != null) {
    let transformedList = fromParts;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return partToMldev$3(item);
      });
    }
    setValueByPath(toObject, ["parts"], transformedList);
  }
  const fromRole = getValueByPath(fromObject, ["role"]);
  if (fromRole != null) {
    setValueByPath(toObject, ["role"], fromRole);
  }
  return toObject;
}
function createCachedContentConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromTtl = getValueByPath(fromObject, ["ttl"]);
  if (parentObject !== void 0 && fromTtl != null) {
    setValueByPath(parentObject, ["ttl"], fromTtl);
  }
  const fromExpireTime = getValueByPath(fromObject, ["expireTime"]);
  if (parentObject !== void 0 && fromExpireTime != null) {
    setValueByPath(parentObject, ["expireTime"], fromExpireTime);
  }
  const fromDisplayName = getValueByPath(fromObject, ["displayName"]);
  if (parentObject !== void 0 && fromDisplayName != null) {
    setValueByPath(parentObject, ["displayName"], fromDisplayName);
  }
  const fromContents = getValueByPath(fromObject, ["contents"]);
  if (parentObject !== void 0 && fromContents != null) {
    let transformedList = tContents(fromContents);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return contentToMldev$3(item);
      });
    }
    setValueByPath(parentObject, ["contents"], transformedList);
  }
  const fromSystemInstruction = getValueByPath(fromObject, [
    "systemInstruction"
  ]);
  if (parentObject !== void 0 && fromSystemInstruction != null) {
    setValueByPath(parentObject, ["systemInstruction"], contentToMldev$3(tContent(fromSystemInstruction)));
  }
  const fromTools = getValueByPath(fromObject, ["tools"]);
  if (parentObject !== void 0 && fromTools != null) {
    let transformedList = fromTools;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return toolToMldev$3(item);
      });
    }
    setValueByPath(parentObject, ["tools"], transformedList);
  }
  const fromToolConfig = getValueByPath(fromObject, ["toolConfig"]);
  if (parentObject !== void 0 && fromToolConfig != null) {
    setValueByPath(parentObject, ["toolConfig"], toolConfigToMldev$1(fromToolConfig));
  }
  if (getValueByPath(fromObject, ["kmsKeyName"]) !== void 0) {
    throw new Error("kmsKeyName parameter is not supported in Gemini API.");
  }
  return toObject;
}
function createCachedContentConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromTtl = getValueByPath(fromObject, ["ttl"]);
  if (parentObject !== void 0 && fromTtl != null) {
    setValueByPath(parentObject, ["ttl"], fromTtl);
  }
  const fromExpireTime = getValueByPath(fromObject, ["expireTime"]);
  if (parentObject !== void 0 && fromExpireTime != null) {
    setValueByPath(parentObject, ["expireTime"], fromExpireTime);
  }
  const fromDisplayName = getValueByPath(fromObject, ["displayName"]);
  if (parentObject !== void 0 && fromDisplayName != null) {
    setValueByPath(parentObject, ["displayName"], fromDisplayName);
  }
  const fromContents = getValueByPath(fromObject, ["contents"]);
  if (parentObject !== void 0 && fromContents != null) {
    let transformedList = tContents(fromContents);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(parentObject, ["contents"], transformedList);
  }
  const fromSystemInstruction = getValueByPath(fromObject, [
    "systemInstruction"
  ]);
  if (parentObject !== void 0 && fromSystemInstruction != null) {
    setValueByPath(parentObject, ["systemInstruction"], tContent(fromSystemInstruction));
  }
  const fromTools = getValueByPath(fromObject, ["tools"]);
  if (parentObject !== void 0 && fromTools != null) {
    let transformedList = fromTools;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return toolToVertex$2(item);
      });
    }
    setValueByPath(parentObject, ["tools"], transformedList);
  }
  const fromToolConfig = getValueByPath(fromObject, ["toolConfig"]);
  if (parentObject !== void 0 && fromToolConfig != null) {
    setValueByPath(parentObject, ["toolConfig"], fromToolConfig);
  }
  const fromKmsKeyName = getValueByPath(fromObject, ["kmsKeyName"]);
  if (parentObject !== void 0 && fromKmsKeyName != null) {
    setValueByPath(parentObject, ["encryption_spec", "kmsKeyName"], fromKmsKeyName);
  }
  return toObject;
}
function createCachedContentParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["model"], tCachesModel(apiClient, fromModel));
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    createCachedContentConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function createCachedContentParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["model"], tCachesModel(apiClient, fromModel));
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    createCachedContentConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
function deleteCachedContentParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], tCachedContentName(apiClient, fromName));
  }
  return toObject;
}
function deleteCachedContentParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], tCachedContentName(apiClient, fromName));
  }
  return toObject;
}
function deleteCachedContentResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  return toObject;
}
function deleteCachedContentResponseFromVertex(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  return toObject;
}
function fileDataToMldev$3(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["displayName"]) !== void 0) {
    throw new Error("displayName parameter is not supported in Gemini API.");
  }
  const fromFileUri = getValueByPath(fromObject, ["fileUri"]);
  if (fromFileUri != null) {
    setValueByPath(toObject, ["fileUri"], fromFileUri);
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function functionCallToMldev$3(fromObject) {
  const toObject = {};
  const fromId = getValueByPath(fromObject, ["id"]);
  if (fromId != null) {
    setValueByPath(toObject, ["id"], fromId);
  }
  const fromArgs = getValueByPath(fromObject, ["args"]);
  if (fromArgs != null) {
    setValueByPath(toObject, ["args"], fromArgs);
  }
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  if (getValueByPath(fromObject, ["partialArgs"]) !== void 0) {
    throw new Error("partialArgs parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["willContinue"]) !== void 0) {
    throw new Error("willContinue parameter is not supported in Gemini API.");
  }
  return toObject;
}
function functionCallingConfigToMldev$1(fromObject) {
  const toObject = {};
  const fromMode = getValueByPath(fromObject, ["mode"]);
  if (fromMode != null) {
    setValueByPath(toObject, ["mode"], fromMode);
  }
  const fromAllowedFunctionNames = getValueByPath(fromObject, [
    "allowedFunctionNames"
  ]);
  if (fromAllowedFunctionNames != null) {
    setValueByPath(toObject, ["allowedFunctionNames"], fromAllowedFunctionNames);
  }
  if (getValueByPath(fromObject, ["streamFunctionCallArguments"]) !== void 0) {
    throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");
  }
  return toObject;
}
function functionDeclarationToVertex$2(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["behavior"]) !== void 0) {
    throw new Error("behavior parameter is not supported in Vertex AI.");
  }
  const fromDescription = getValueByPath(fromObject, ["description"]);
  if (fromDescription != null) {
    setValueByPath(toObject, ["description"], fromDescription);
  }
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromParameters = getValueByPath(fromObject, ["parameters"]);
  if (fromParameters != null) {
    setValueByPath(toObject, ["parameters"], fromParameters);
  }
  const fromParametersJsonSchema = getValueByPath(fromObject, [
    "parametersJsonSchema"
  ]);
  if (fromParametersJsonSchema != null) {
    setValueByPath(toObject, ["parametersJsonSchema"], fromParametersJsonSchema);
  }
  const fromResponse = getValueByPath(fromObject, ["response"]);
  if (fromResponse != null) {
    setValueByPath(toObject, ["response"], fromResponse);
  }
  const fromResponseJsonSchema = getValueByPath(fromObject, [
    "responseJsonSchema"
  ]);
  if (fromResponseJsonSchema != null) {
    setValueByPath(toObject, ["responseJsonSchema"], fromResponseJsonSchema);
  }
  return toObject;
}
function getCachedContentParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], tCachedContentName(apiClient, fromName));
  }
  return toObject;
}
function getCachedContentParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], tCachedContentName(apiClient, fromName));
  }
  return toObject;
}
function googleMapsToMldev$3(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["authConfig"]) !== void 0) {
    throw new Error("authConfig parameter is not supported in Gemini API.");
  }
  const fromEnableWidget = getValueByPath(fromObject, ["enableWidget"]);
  if (fromEnableWidget != null) {
    setValueByPath(toObject, ["enableWidget"], fromEnableWidget);
  }
  return toObject;
}
function googleSearchToMldev$3(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["excludeDomains"]) !== void 0) {
    throw new Error("excludeDomains parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["blockingConfidence"]) !== void 0) {
    throw new Error("blockingConfidence parameter is not supported in Gemini API.");
  }
  const fromTimeRangeFilter = getValueByPath(fromObject, [
    "timeRangeFilter"
  ]);
  if (fromTimeRangeFilter != null) {
    setValueByPath(toObject, ["timeRangeFilter"], fromTimeRangeFilter);
  }
  return toObject;
}
function listCachedContentsConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromPageSize = getValueByPath(fromObject, ["pageSize"]);
  if (parentObject !== void 0 && fromPageSize != null) {
    setValueByPath(parentObject, ["_query", "pageSize"], fromPageSize);
  }
  const fromPageToken = getValueByPath(fromObject, ["pageToken"]);
  if (parentObject !== void 0 && fromPageToken != null) {
    setValueByPath(parentObject, ["_query", "pageToken"], fromPageToken);
  }
  return toObject;
}
function listCachedContentsConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromPageSize = getValueByPath(fromObject, ["pageSize"]);
  if (parentObject !== void 0 && fromPageSize != null) {
    setValueByPath(parentObject, ["_query", "pageSize"], fromPageSize);
  }
  const fromPageToken = getValueByPath(fromObject, ["pageToken"]);
  if (parentObject !== void 0 && fromPageToken != null) {
    setValueByPath(parentObject, ["_query", "pageToken"], fromPageToken);
  }
  return toObject;
}
function listCachedContentsParametersToMldev(fromObject) {
  const toObject = {};
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    listCachedContentsConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function listCachedContentsParametersToVertex(fromObject) {
  const toObject = {};
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    listCachedContentsConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
function listCachedContentsResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromNextPageToken = getValueByPath(fromObject, [
    "nextPageToken"
  ]);
  if (fromNextPageToken != null) {
    setValueByPath(toObject, ["nextPageToken"], fromNextPageToken);
  }
  const fromCachedContents = getValueByPath(fromObject, [
    "cachedContents"
  ]);
  if (fromCachedContents != null) {
    let transformedList = fromCachedContents;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["cachedContents"], transformedList);
  }
  return toObject;
}
function listCachedContentsResponseFromVertex(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromNextPageToken = getValueByPath(fromObject, [
    "nextPageToken"
  ]);
  if (fromNextPageToken != null) {
    setValueByPath(toObject, ["nextPageToken"], fromNextPageToken);
  }
  const fromCachedContents = getValueByPath(fromObject, [
    "cachedContents"
  ]);
  if (fromCachedContents != null) {
    let transformedList = fromCachedContents;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["cachedContents"], transformedList);
  }
  return toObject;
}
function partToMldev$3(fromObject) {
  const toObject = {};
  const fromMediaResolution = getValueByPath(fromObject, [
    "mediaResolution"
  ]);
  if (fromMediaResolution != null) {
    setValueByPath(toObject, ["mediaResolution"], fromMediaResolution);
  }
  const fromCodeExecutionResult = getValueByPath(fromObject, [
    "codeExecutionResult"
  ]);
  if (fromCodeExecutionResult != null) {
    setValueByPath(toObject, ["codeExecutionResult"], fromCodeExecutionResult);
  }
  const fromExecutableCode = getValueByPath(fromObject, [
    "executableCode"
  ]);
  if (fromExecutableCode != null) {
    setValueByPath(toObject, ["executableCode"], fromExecutableCode);
  }
  const fromFileData = getValueByPath(fromObject, ["fileData"]);
  if (fromFileData != null) {
    setValueByPath(toObject, ["fileData"], fileDataToMldev$3(fromFileData));
  }
  const fromFunctionCall = getValueByPath(fromObject, ["functionCall"]);
  if (fromFunctionCall != null) {
    setValueByPath(toObject, ["functionCall"], functionCallToMldev$3(fromFunctionCall));
  }
  const fromFunctionResponse = getValueByPath(fromObject, [
    "functionResponse"
  ]);
  if (fromFunctionResponse != null) {
    setValueByPath(toObject, ["functionResponse"], fromFunctionResponse);
  }
  const fromInlineData = getValueByPath(fromObject, ["inlineData"]);
  if (fromInlineData != null) {
    setValueByPath(toObject, ["inlineData"], blobToMldev$3(fromInlineData));
  }
  const fromText = getValueByPath(fromObject, ["text"]);
  if (fromText != null) {
    setValueByPath(toObject, ["text"], fromText);
  }
  const fromThought = getValueByPath(fromObject, ["thought"]);
  if (fromThought != null) {
    setValueByPath(toObject, ["thought"], fromThought);
  }
  const fromThoughtSignature = getValueByPath(fromObject, [
    "thoughtSignature"
  ]);
  if (fromThoughtSignature != null) {
    setValueByPath(toObject, ["thoughtSignature"], fromThoughtSignature);
  }
  const fromVideoMetadata = getValueByPath(fromObject, [
    "videoMetadata"
  ]);
  if (fromVideoMetadata != null) {
    setValueByPath(toObject, ["videoMetadata"], fromVideoMetadata);
  }
  return toObject;
}
function toolConfigToMldev$1(fromObject) {
  const toObject = {};
  const fromFunctionCallingConfig = getValueByPath(fromObject, [
    "functionCallingConfig"
  ]);
  if (fromFunctionCallingConfig != null) {
    setValueByPath(toObject, ["functionCallingConfig"], functionCallingConfigToMldev$1(fromFunctionCallingConfig));
  }
  const fromRetrievalConfig = getValueByPath(fromObject, [
    "retrievalConfig"
  ]);
  if (fromRetrievalConfig != null) {
    setValueByPath(toObject, ["retrievalConfig"], fromRetrievalConfig);
  }
  return toObject;
}
function toolToMldev$3(fromObject) {
  const toObject = {};
  const fromFunctionDeclarations = getValueByPath(fromObject, [
    "functionDeclarations"
  ]);
  if (fromFunctionDeclarations != null) {
    let transformedList = fromFunctionDeclarations;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["functionDeclarations"], transformedList);
  }
  if (getValueByPath(fromObject, ["retrieval"]) !== void 0) {
    throw new Error("retrieval parameter is not supported in Gemini API.");
  }
  const fromGoogleSearchRetrieval = getValueByPath(fromObject, [
    "googleSearchRetrieval"
  ]);
  if (fromGoogleSearchRetrieval != null) {
    setValueByPath(toObject, ["googleSearchRetrieval"], fromGoogleSearchRetrieval);
  }
  const fromComputerUse = getValueByPath(fromObject, ["computerUse"]);
  if (fromComputerUse != null) {
    setValueByPath(toObject, ["computerUse"], fromComputerUse);
  }
  const fromFileSearch = getValueByPath(fromObject, ["fileSearch"]);
  if (fromFileSearch != null) {
    setValueByPath(toObject, ["fileSearch"], fromFileSearch);
  }
  const fromCodeExecution = getValueByPath(fromObject, [
    "codeExecution"
  ]);
  if (fromCodeExecution != null) {
    setValueByPath(toObject, ["codeExecution"], fromCodeExecution);
  }
  if (getValueByPath(fromObject, ["enterpriseWebSearch"]) !== void 0) {
    throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");
  }
  const fromGoogleMaps = getValueByPath(fromObject, ["googleMaps"]);
  if (fromGoogleMaps != null) {
    setValueByPath(toObject, ["googleMaps"], googleMapsToMldev$3(fromGoogleMaps));
  }
  const fromGoogleSearch = getValueByPath(fromObject, ["googleSearch"]);
  if (fromGoogleSearch != null) {
    setValueByPath(toObject, ["googleSearch"], googleSearchToMldev$3(fromGoogleSearch));
  }
  const fromUrlContext = getValueByPath(fromObject, ["urlContext"]);
  if (fromUrlContext != null) {
    setValueByPath(toObject, ["urlContext"], fromUrlContext);
  }
  return toObject;
}
function toolToVertex$2(fromObject) {
  const toObject = {};
  const fromFunctionDeclarations = getValueByPath(fromObject, [
    "functionDeclarations"
  ]);
  if (fromFunctionDeclarations != null) {
    let transformedList = fromFunctionDeclarations;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return functionDeclarationToVertex$2(item);
      });
    }
    setValueByPath(toObject, ["functionDeclarations"], transformedList);
  }
  const fromRetrieval = getValueByPath(fromObject, ["retrieval"]);
  if (fromRetrieval != null) {
    setValueByPath(toObject, ["retrieval"], fromRetrieval);
  }
  const fromGoogleSearchRetrieval = getValueByPath(fromObject, [
    "googleSearchRetrieval"
  ]);
  if (fromGoogleSearchRetrieval != null) {
    setValueByPath(toObject, ["googleSearchRetrieval"], fromGoogleSearchRetrieval);
  }
  const fromComputerUse = getValueByPath(fromObject, ["computerUse"]);
  if (fromComputerUse != null) {
    setValueByPath(toObject, ["computerUse"], fromComputerUse);
  }
  if (getValueByPath(fromObject, ["fileSearch"]) !== void 0) {
    throw new Error("fileSearch parameter is not supported in Vertex AI.");
  }
  const fromCodeExecution = getValueByPath(fromObject, [
    "codeExecution"
  ]);
  if (fromCodeExecution != null) {
    setValueByPath(toObject, ["codeExecution"], fromCodeExecution);
  }
  const fromEnterpriseWebSearch = getValueByPath(fromObject, [
    "enterpriseWebSearch"
  ]);
  if (fromEnterpriseWebSearch != null) {
    setValueByPath(toObject, ["enterpriseWebSearch"], fromEnterpriseWebSearch);
  }
  const fromGoogleMaps = getValueByPath(fromObject, ["googleMaps"]);
  if (fromGoogleMaps != null) {
    setValueByPath(toObject, ["googleMaps"], fromGoogleMaps);
  }
  const fromGoogleSearch = getValueByPath(fromObject, ["googleSearch"]);
  if (fromGoogleSearch != null) {
    setValueByPath(toObject, ["googleSearch"], fromGoogleSearch);
  }
  const fromUrlContext = getValueByPath(fromObject, ["urlContext"]);
  if (fromUrlContext != null) {
    setValueByPath(toObject, ["urlContext"], fromUrlContext);
  }
  return toObject;
}
function updateCachedContentConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromTtl = getValueByPath(fromObject, ["ttl"]);
  if (parentObject !== void 0 && fromTtl != null) {
    setValueByPath(parentObject, ["ttl"], fromTtl);
  }
  const fromExpireTime = getValueByPath(fromObject, ["expireTime"]);
  if (parentObject !== void 0 && fromExpireTime != null) {
    setValueByPath(parentObject, ["expireTime"], fromExpireTime);
  }
  return toObject;
}
function updateCachedContentConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromTtl = getValueByPath(fromObject, ["ttl"]);
  if (parentObject !== void 0 && fromTtl != null) {
    setValueByPath(parentObject, ["ttl"], fromTtl);
  }
  const fromExpireTime = getValueByPath(fromObject, ["expireTime"]);
  if (parentObject !== void 0 && fromExpireTime != null) {
    setValueByPath(parentObject, ["expireTime"], fromExpireTime);
  }
  return toObject;
}
function updateCachedContentParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], tCachedContentName(apiClient, fromName));
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    updateCachedContentConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function updateCachedContentParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], tCachedContentName(apiClient, fromName));
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    updateCachedContentConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
var Caches = class extends BaseModule {
  constructor(apiClient) {
    super();
    this.apiClient = apiClient;
    this.list = async (params = {}) => {
      return new Pager(PagedItem.PAGED_ITEM_CACHED_CONTENTS, (x) => this.listInternal(x), await this.listInternal(params), params);
    };
  }
  /**
   * Creates a cached contents resource.
   *
   * @remarks
   * Context caching is only supported for specific models. See [Gemini
   * Developer API reference](https://ai.google.dev/gemini-api/docs/caching?lang=node/context-cac)
   * and [Vertex AI reference](https://cloud.google.com/vertex-ai/generative-ai/docs/context-cache/context-cache-overview#supported_models)
   * for more information.
   *
   * @param params - The parameters for the create request.
   * @return The created cached content.
   *
   * @example
   * ```ts
   * const contents = ...; // Initialize the content to cache.
   * const response = await ai.caches.create({
   *   model: 'gemini-2.0-flash-001',
   *   config: {
   *    'contents': contents,
   *    'displayName': 'test cache',
   *    'systemInstruction': 'What is the sum of the two pdfs?',
   *    'ttl': '86400s',
   *  }
   * });
   * ```
   */
  async create(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = createCachedContentParametersToVertex(this.apiClient, params);
      path2 = formatMap("cachedContents", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((resp) => {
        return resp;
      });
    } else {
      const body = createCachedContentParametersToMldev(this.apiClient, params);
      path2 = formatMap("cachedContents", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((resp) => {
        return resp;
      });
    }
  }
  /**
   * Gets cached content configurations.
   *
   * @param params - The parameters for the get request.
   * @return The cached content.
   *
   * @example
   * ```ts
   * await ai.caches.get({name: '...'}); // The server-generated resource name.
   * ```
   */
  async get(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = getCachedContentParametersToVertex(this.apiClient, params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((resp) => {
        return resp;
      });
    } else {
      const body = getCachedContentParametersToMldev(this.apiClient, params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((resp) => {
        return resp;
      });
    }
  }
  /**
   * Deletes cached content.
   *
   * @param params - The parameters for the delete request.
   * @return The empty response returned by the API.
   *
   * @example
   * ```ts
   * await ai.caches.delete({name: '...'}); // The server-generated resource name.
   * ```
   */
  async delete(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = deleteCachedContentParametersToVertex(this.apiClient, params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "DELETE",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = deleteCachedContentResponseFromVertex(apiResponse);
        const typedResp = new DeleteCachedContentResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      const body = deleteCachedContentParametersToMldev(this.apiClient, params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "DELETE",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = deleteCachedContentResponseFromMldev(apiResponse);
        const typedResp = new DeleteCachedContentResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  /**
   * Updates cached content configurations.
   *
   * @param params - The parameters for the update request.
   * @return The updated cached content.
   *
   * @example
   * ```ts
   * const response = await ai.caches.update({
   *   name: '...',  // The server-generated resource name.
   *   config: {'ttl': '7600s'}
   * });
   * ```
   */
  async update(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = updateCachedContentParametersToVertex(this.apiClient, params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "PATCH",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((resp) => {
        return resp;
      });
    } else {
      const body = updateCachedContentParametersToMldev(this.apiClient, params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "PATCH",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((resp) => {
        return resp;
      });
    }
  }
  async listInternal(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = listCachedContentsParametersToVertex(params);
      path2 = formatMap("cachedContents", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = listCachedContentsResponseFromVertex(apiResponse);
        const typedResp = new ListCachedContentsResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      const body = listCachedContentsParametersToMldev(params);
      path2 = formatMap("cachedContents", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = listCachedContentsResponseFromMldev(apiResponse);
        const typedResp = new ListCachedContentsResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
};
function __rest(s, e) {
  var t = {};
  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
    t[p] = s[p];
  if (s != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
      if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
        t[p[i]] = s[p[i]];
    }
  return t;
}
function __values(o) {
  var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
  if (m) return m.call(o);
  if (o && typeof o.length === "number") return {
    next: function() {
      if (o && i >= o.length) o = void 0;
      return { value: o && o[i++], done: !o };
    }
  };
  throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
}
function __await(v) {
  return this instanceof __await ? (this.v = v, this) : new __await(v);
}
function __asyncGenerator(thisArg, _arguments, generator) {
  if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
  var g = generator.apply(thisArg, _arguments || []), i, q = [];
  return i = Object.create((typeof AsyncIterator === "function" ? AsyncIterator : Object).prototype), verb("next"), verb("throw"), verb("return", awaitReturn), i[Symbol.asyncIterator] = function() {
    return this;
  }, i;
  function awaitReturn(f) {
    return function(v) {
      return Promise.resolve(v).then(f, reject);
    };
  }
  function verb(n, f) {
    if (g[n]) {
      i[n] = function(v) {
        return new Promise(function(a, b) {
          q.push([n, v, a, b]) > 1 || resume(n, v);
        });
      };
      if (f) i[n] = f(i[n]);
    }
  }
  function resume(n, v) {
    try {
      step(g[n](v));
    } catch (e) {
      settle(q[0][3], e);
    }
  }
  function step(r) {
    r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);
  }
  function fulfill(value) {
    resume("next", value);
  }
  function reject(value) {
    resume("throw", value);
  }
  function settle(f, v) {
    if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]);
  }
}
function __asyncValues(o) {
  if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
  var m = o[Symbol.asyncIterator], i;
  return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function() {
    return this;
  }, i);
  function verb(n) {
    i[n] = o[n] && function(v) {
      return new Promise(function(resolve, reject) {
        v = o[n](v), settle(resolve, reject, v.done, v.value);
      });
    };
  }
  function settle(resolve, reject, d, v) {
    Promise.resolve(v).then(function(v2) {
      resolve({ value: v2, done: d });
    }, reject);
  }
}
function isValidResponse(response) {
  var _a2;
  if (response.candidates == void 0 || response.candidates.length === 0) {
    return false;
  }
  const content = (_a2 = response.candidates[0]) === null || _a2 === void 0 ? void 0 : _a2.content;
  if (content === void 0) {
    return false;
  }
  return isValidContent(content);
}
function isValidContent(content) {
  if (content.parts === void 0 || content.parts.length === 0) {
    return false;
  }
  for (const part of content.parts) {
    if (part === void 0 || Object.keys(part).length === 0) {
      return false;
    }
  }
  return true;
}
function validateHistory(history) {
  if (history.length === 0) {
    return;
  }
  for (const content of history) {
    if (content.role !== "user" && content.role !== "model") {
      throw new Error(`Role must be user or model, but got ${content.role}.`);
    }
  }
}
function extractCuratedHistory(comprehensiveHistory) {
  if (comprehensiveHistory === void 0 || comprehensiveHistory.length === 0) {
    return [];
  }
  const curatedHistory = [];
  const length = comprehensiveHistory.length;
  let i = 0;
  while (i < length) {
    if (comprehensiveHistory[i].role === "user") {
      curatedHistory.push(comprehensiveHistory[i]);
      i++;
    } else {
      const modelOutput = [];
      let isValid = true;
      while (i < length && comprehensiveHistory[i].role === "model") {
        modelOutput.push(comprehensiveHistory[i]);
        if (isValid && !isValidContent(comprehensiveHistory[i])) {
          isValid = false;
        }
        i++;
      }
      if (isValid) {
        curatedHistory.push(...modelOutput);
      } else {
        curatedHistory.pop();
      }
    }
  }
  return curatedHistory;
}
var Chats = class {
  constructor(modelsModule, apiClient) {
    this.modelsModule = modelsModule;
    this.apiClient = apiClient;
  }
  /**
   * Creates a new chat session.
   *
   * @remarks
   * The config in the params will be used for all requests within the chat
   * session unless overridden by a per-request `config` in
   * @see {@link types.SendMessageParameters#config}.
   *
   * @param params - Parameters for creating a chat session.
   * @returns A new chat session.
   *
   * @example
   * ```ts
   * const chat = ai.chats.create({
   *   model: 'gemini-2.0-flash'
   *   config: {
   *     temperature: 0.5,
   *     maxOutputTokens: 1024,
   *   }
   * });
   * ```
   */
  create(params) {
    return new Chat(
      this.apiClient,
      this.modelsModule,
      params.model,
      params.config,
      // Deep copy the history to avoid mutating the history outside of the
      // chat session.
      structuredClone(params.history)
    );
  }
};
var Chat = class {
  constructor(apiClient, modelsModule, model, config = {}, history = []) {
    this.apiClient = apiClient;
    this.modelsModule = modelsModule;
    this.model = model;
    this.config = config;
    this.history = history;
    this.sendPromise = Promise.resolve();
    validateHistory(history);
  }
  /**
   * Sends a message to the model and returns the response.
   *
   * @remarks
   * This method will wait for the previous message to be processed before
   * sending the next message.
   *
   * @see {@link Chat#sendMessageStream} for streaming method.
   * @param params - parameters for sending messages within a chat session.
   * @returns The model's response.
   *
   * @example
   * ```ts
   * const chat = ai.chats.create({model: 'gemini-2.0-flash'});
   * const response = await chat.sendMessage({
   *   message: 'Why is the sky blue?'
   * });
   * console.log(response.text);
   * ```
   */
  async sendMessage(params) {
    var _a2;
    await this.sendPromise;
    const inputContent = tContent(params.message);
    const responsePromise = this.modelsModule.generateContent({
      model: this.model,
      contents: this.getHistory(true).concat(inputContent),
      config: (_a2 = params.config) !== null && _a2 !== void 0 ? _a2 : this.config
    });
    this.sendPromise = (async () => {
      var _a3, _b, _c;
      const response = await responsePromise;
      const outputContent = (_b = (_a3 = response.candidates) === null || _a3 === void 0 ? void 0 : _a3[0]) === null || _b === void 0 ? void 0 : _b.content;
      const fullAutomaticFunctionCallingHistory = response.automaticFunctionCallingHistory;
      const index = this.getHistory(true).length;
      let automaticFunctionCallingHistory = [];
      if (fullAutomaticFunctionCallingHistory != null) {
        automaticFunctionCallingHistory = (_c = fullAutomaticFunctionCallingHistory.slice(index)) !== null && _c !== void 0 ? _c : [];
      }
      const modelOutput = outputContent ? [outputContent] : [];
      this.recordHistory(inputContent, modelOutput, automaticFunctionCallingHistory);
      return;
    })();
    await this.sendPromise.catch(() => {
      this.sendPromise = Promise.resolve();
    });
    return responsePromise;
  }
  /**
   * Sends a message to the model and returns the response in chunks.
   *
   * @remarks
   * This method will wait for the previous message to be processed before
   * sending the next message.
   *
   * @see {@link Chat#sendMessage} for non-streaming method.
   * @param params - parameters for sending the message.
   * @return The model's response.
   *
   * @example
   * ```ts
   * const chat = ai.chats.create({model: 'gemini-2.0-flash'});
   * const response = await chat.sendMessageStream({
   *   message: 'Why is the sky blue?'
   * });
   * for await (const chunk of response) {
   *   console.log(chunk.text);
   * }
   * ```
   */
  async sendMessageStream(params) {
    var _a2;
    await this.sendPromise;
    const inputContent = tContent(params.message);
    const streamResponse = this.modelsModule.generateContentStream({
      model: this.model,
      contents: this.getHistory(true).concat(inputContent),
      config: (_a2 = params.config) !== null && _a2 !== void 0 ? _a2 : this.config
    });
    this.sendPromise = streamResponse.then(() => void 0).catch(() => void 0);
    const response = await streamResponse;
    const result = this.processStreamResponse(response, inputContent);
    return result;
  }
  /**
   * Returns the chat history.
   *
   * @remarks
   * The history is a list of contents alternating between user and model.
   *
   * There are two types of history:
   * - The `curated history` contains only the valid turns between user and
   * model, which will be included in the subsequent requests sent to the model.
   * - The `comprehensive history` contains all turns, including invalid or
   *   empty model outputs, providing a complete record of the history.
   *
   * The history is updated after receiving the response from the model,
   * for streaming response, it means receiving the last chunk of the response.
   *
   * The `comprehensive history` is returned by default. To get the `curated
   * history`, set the `curated` parameter to `true`.
   *
   * @param curated - whether to return the curated history or the comprehensive
   *     history.
   * @return History contents alternating between user and model for the entire
   *     chat session.
   */
  getHistory(curated = false) {
    const history = curated ? extractCuratedHistory(this.history) : this.history;
    return structuredClone(history);
  }
  processStreamResponse(streamResponse, inputContent) {
    return __asyncGenerator(this, arguments, function* processStreamResponse_1() {
      var _a2, e_1, _b, _c;
      var _d, _e;
      const outputContent = [];
      try {
        for (var _f = true, streamResponse_1 = __asyncValues(streamResponse), streamResponse_1_1; streamResponse_1_1 = yield __await(streamResponse_1.next()), _a2 = streamResponse_1_1.done, !_a2; _f = true) {
          _c = streamResponse_1_1.value;
          _f = false;
          const chunk = _c;
          if (isValidResponse(chunk)) {
            const content = (_e = (_d = chunk.candidates) === null || _d === void 0 ? void 0 : _d[0]) === null || _e === void 0 ? void 0 : _e.content;
            if (content !== void 0) {
              outputContent.push(content);
            }
          }
          yield yield __await(chunk);
        }
      } catch (e_1_1) {
        e_1 = { error: e_1_1 };
      } finally {
        try {
          if (!_f && !_a2 && (_b = streamResponse_1.return)) yield __await(_b.call(streamResponse_1));
        } finally {
          if (e_1) throw e_1.error;
        }
      }
      this.recordHistory(inputContent, outputContent);
    });
  }
  recordHistory(userInput, modelOutput, automaticFunctionCallingHistory) {
    let outputContents = [];
    if (modelOutput.length > 0 && modelOutput.every((content) => content.role !== void 0)) {
      outputContents = modelOutput;
    } else {
      outputContents.push({
        role: "model",
        parts: []
      });
    }
    if (automaticFunctionCallingHistory && automaticFunctionCallingHistory.length > 0) {
      this.history.push(...extractCuratedHistory(automaticFunctionCallingHistory));
    } else {
      this.history.push(userInput);
    }
    this.history.push(...outputContents);
  }
};
var ApiError = class _ApiError extends Error {
  constructor(options) {
    super(options.message);
    this.name = "ApiError";
    this.status = options.status;
    Object.setPrototypeOf(this, _ApiError.prototype);
  }
};
function createFileParametersToMldev(fromObject) {
  const toObject = {};
  const fromFile = getValueByPath(fromObject, ["file"]);
  if (fromFile != null) {
    setValueByPath(toObject, ["file"], fromFile);
  }
  return toObject;
}
function createFileResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  return toObject;
}
function deleteFileParametersToMldev(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "file"], tFileName(fromName));
  }
  return toObject;
}
function deleteFileResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  return toObject;
}
function getFileParametersToMldev(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "file"], tFileName(fromName));
  }
  return toObject;
}
function listFilesConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromPageSize = getValueByPath(fromObject, ["pageSize"]);
  if (parentObject !== void 0 && fromPageSize != null) {
    setValueByPath(parentObject, ["_query", "pageSize"], fromPageSize);
  }
  const fromPageToken = getValueByPath(fromObject, ["pageToken"]);
  if (parentObject !== void 0 && fromPageToken != null) {
    setValueByPath(parentObject, ["_query", "pageToken"], fromPageToken);
  }
  return toObject;
}
function listFilesParametersToMldev(fromObject) {
  const toObject = {};
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    listFilesConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function listFilesResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromNextPageToken = getValueByPath(fromObject, [
    "nextPageToken"
  ]);
  if (fromNextPageToken != null) {
    setValueByPath(toObject, ["nextPageToken"], fromNextPageToken);
  }
  const fromFiles = getValueByPath(fromObject, ["files"]);
  if (fromFiles != null) {
    let transformedList = fromFiles;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["files"], transformedList);
  }
  return toObject;
}
var Files = class extends BaseModule {
  constructor(apiClient) {
    super();
    this.apiClient = apiClient;
    this.list = async (params = {}) => {
      return new Pager(PagedItem.PAGED_ITEM_FILES, (x) => this.listInternal(x), await this.listInternal(params), params);
    };
  }
  /**
   * Uploads a file asynchronously to the Gemini API.
   * This method is not available in Vertex AI.
   * Supported upload sources:
   * - Node.js: File path (string) or Blob object.
   * - Browser: Blob object (e.g., File).
   *
   * @remarks
   * The `mimeType` can be specified in the `config` parameter. If omitted:
   *  - For file path (string) inputs, the `mimeType` will be inferred from the
   *     file extension.
   *  - For Blob object inputs, the `mimeType` will be set to the Blob's `type`
   *     property.
   * Somex eamples for file extension to mimeType mapping:
   * .txt -> text/plain
   * .json -> application/json
   * .jpg  -> image/jpeg
   * .png -> image/png
   * .mp3 -> audio/mpeg
   * .mp4 -> video/mp4
   *
   * This section can contain multiple paragraphs and code examples.
   *
   * @param params - Optional parameters specified in the
   *        `types.UploadFileParameters` interface.
   *         @see {@link types.UploadFileParameters#config} for the optional
   *         config in the parameters.
   * @return A promise that resolves to a `types.File` object.
   * @throws An error if called on a Vertex AI client.
   * @throws An error if the `mimeType` is not provided and can not be inferred,
   * the `mimeType` can be provided in the `params.config` parameter.
   * @throws An error occurs if a suitable upload location cannot be established.
   *
   * @example
   * The following code uploads a file to Gemini API.
   *
   * ```ts
   * const file = await ai.files.upload({file: 'file.txt', config: {
   *   mimeType: 'text/plain',
   * }});
   * console.log(file.name);
   * ```
   */
  async upload(params) {
    if (this.apiClient.isVertexAI()) {
      throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");
    }
    return this.apiClient.uploadFile(params.file, params.config).then((resp) => {
      return resp;
    });
  }
  /**
   * Downloads a remotely stored file asynchronously to a location specified in
   * the `params` object. This method only works on Node environment, to
   * download files in the browser, use a browser compliant method like an <a>
   * tag.
   *
   * @param params - The parameters for the download request.
   *
   * @example
   * The following code downloads an example file named "files/mehozpxf877d" as
   * "file.txt".
   *
   * ```ts
   * await ai.files.download({file: file.name, downloadPath: 'file.txt'});
   * ```
   */
  async download(params) {
    await this.apiClient.downloadFile(params);
  }
  async listInternal(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = listFilesParametersToMldev(params);
      path2 = formatMap("files", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = listFilesResponseFromMldev(apiResponse);
        const typedResp = new ListFilesResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  async createInternal(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = createFileParametersToMldev(params);
      path2 = formatMap("upload/v1beta/files", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = createFileResponseFromMldev(apiResponse);
        const typedResp = new CreateFileResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  /**
   * Retrieves the file information from the service.
   *
   * @param params - The parameters for the get request
   * @return The Promise that resolves to the types.File object requested.
   *
   * @example
   * ```ts
   * const config: GetFileParameters = {
   *   name: fileName,
   * };
   * file = await ai.files.get(config);
   * console.log(file.name);
   * ```
   */
  async get(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = getFileParametersToMldev(params);
      path2 = formatMap("files/{file}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((resp) => {
        return resp;
      });
    }
  }
  /**
   * Deletes a remotely stored file.
   *
   * @param params - The parameters for the delete request.
   * @return The DeleteFileResponse, the response for the delete method.
   *
   * @example
   * The following code deletes an example file named "files/mehozpxf877d".
   *
   * ```ts
   * await ai.files.delete({name: file.name});
   * ```
   */
  async delete(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = deleteFileParametersToMldev(params);
      path2 = formatMap("files/{file}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "DELETE",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = deleteFileResponseFromMldev(apiResponse);
        const typedResp = new DeleteFileResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
};
function blobToMldev$2(fromObject) {
  const toObject = {};
  const fromData = getValueByPath(fromObject, ["data"]);
  if (fromData != null) {
    setValueByPath(toObject, ["data"], fromData);
  }
  if (getValueByPath(fromObject, ["displayName"]) !== void 0) {
    throw new Error("displayName parameter is not supported in Gemini API.");
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function contentToMldev$2(fromObject) {
  const toObject = {};
  const fromParts = getValueByPath(fromObject, ["parts"]);
  if (fromParts != null) {
    let transformedList = fromParts;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return partToMldev$2(item);
      });
    }
    setValueByPath(toObject, ["parts"], transformedList);
  }
  const fromRole = getValueByPath(fromObject, ["role"]);
  if (fromRole != null) {
    setValueByPath(toObject, ["role"], fromRole);
  }
  return toObject;
}
function fileDataToMldev$2(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["displayName"]) !== void 0) {
    throw new Error("displayName parameter is not supported in Gemini API.");
  }
  const fromFileUri = getValueByPath(fromObject, ["fileUri"]);
  if (fromFileUri != null) {
    setValueByPath(toObject, ["fileUri"], fromFileUri);
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function functionCallToMldev$2(fromObject) {
  const toObject = {};
  const fromId = getValueByPath(fromObject, ["id"]);
  if (fromId != null) {
    setValueByPath(toObject, ["id"], fromId);
  }
  const fromArgs = getValueByPath(fromObject, ["args"]);
  if (fromArgs != null) {
    setValueByPath(toObject, ["args"], fromArgs);
  }
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  if (getValueByPath(fromObject, ["partialArgs"]) !== void 0) {
    throw new Error("partialArgs parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["willContinue"]) !== void 0) {
    throw new Error("willContinue parameter is not supported in Gemini API.");
  }
  return toObject;
}
function functionDeclarationToVertex$1(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["behavior"]) !== void 0) {
    throw new Error("behavior parameter is not supported in Vertex AI.");
  }
  const fromDescription = getValueByPath(fromObject, ["description"]);
  if (fromDescription != null) {
    setValueByPath(toObject, ["description"], fromDescription);
  }
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromParameters = getValueByPath(fromObject, ["parameters"]);
  if (fromParameters != null) {
    setValueByPath(toObject, ["parameters"], fromParameters);
  }
  const fromParametersJsonSchema = getValueByPath(fromObject, [
    "parametersJsonSchema"
  ]);
  if (fromParametersJsonSchema != null) {
    setValueByPath(toObject, ["parametersJsonSchema"], fromParametersJsonSchema);
  }
  const fromResponse = getValueByPath(fromObject, ["response"]);
  if (fromResponse != null) {
    setValueByPath(toObject, ["response"], fromResponse);
  }
  const fromResponseJsonSchema = getValueByPath(fromObject, [
    "responseJsonSchema"
  ]);
  if (fromResponseJsonSchema != null) {
    setValueByPath(toObject, ["responseJsonSchema"], fromResponseJsonSchema);
  }
  return toObject;
}
function generationConfigToVertex$1(fromObject) {
  const toObject = {};
  const fromModelSelectionConfig = getValueByPath(fromObject, [
    "modelSelectionConfig"
  ]);
  if (fromModelSelectionConfig != null) {
    setValueByPath(toObject, ["modelConfig"], fromModelSelectionConfig);
  }
  const fromResponseJsonSchema = getValueByPath(fromObject, [
    "responseJsonSchema"
  ]);
  if (fromResponseJsonSchema != null) {
    setValueByPath(toObject, ["responseJsonSchema"], fromResponseJsonSchema);
  }
  const fromAudioTimestamp = getValueByPath(fromObject, [
    "audioTimestamp"
  ]);
  if (fromAudioTimestamp != null) {
    setValueByPath(toObject, ["audioTimestamp"], fromAudioTimestamp);
  }
  const fromCandidateCount = getValueByPath(fromObject, [
    "candidateCount"
  ]);
  if (fromCandidateCount != null) {
    setValueByPath(toObject, ["candidateCount"], fromCandidateCount);
  }
  const fromEnableAffectiveDialog = getValueByPath(fromObject, [
    "enableAffectiveDialog"
  ]);
  if (fromEnableAffectiveDialog != null) {
    setValueByPath(toObject, ["enableAffectiveDialog"], fromEnableAffectiveDialog);
  }
  const fromFrequencyPenalty = getValueByPath(fromObject, [
    "frequencyPenalty"
  ]);
  if (fromFrequencyPenalty != null) {
    setValueByPath(toObject, ["frequencyPenalty"], fromFrequencyPenalty);
  }
  const fromLogprobs = getValueByPath(fromObject, ["logprobs"]);
  if (fromLogprobs != null) {
    setValueByPath(toObject, ["logprobs"], fromLogprobs);
  }
  const fromMaxOutputTokens = getValueByPath(fromObject, [
    "maxOutputTokens"
  ]);
  if (fromMaxOutputTokens != null) {
    setValueByPath(toObject, ["maxOutputTokens"], fromMaxOutputTokens);
  }
  const fromMediaResolution = getValueByPath(fromObject, [
    "mediaResolution"
  ]);
  if (fromMediaResolution != null) {
    setValueByPath(toObject, ["mediaResolution"], fromMediaResolution);
  }
  const fromPresencePenalty = getValueByPath(fromObject, [
    "presencePenalty"
  ]);
  if (fromPresencePenalty != null) {
    setValueByPath(toObject, ["presencePenalty"], fromPresencePenalty);
  }
  const fromResponseLogprobs = getValueByPath(fromObject, [
    "responseLogprobs"
  ]);
  if (fromResponseLogprobs != null) {
    setValueByPath(toObject, ["responseLogprobs"], fromResponseLogprobs);
  }
  const fromResponseMimeType = getValueByPath(fromObject, [
    "responseMimeType"
  ]);
  if (fromResponseMimeType != null) {
    setValueByPath(toObject, ["responseMimeType"], fromResponseMimeType);
  }
  const fromResponseModalities = getValueByPath(fromObject, [
    "responseModalities"
  ]);
  if (fromResponseModalities != null) {
    setValueByPath(toObject, ["responseModalities"], fromResponseModalities);
  }
  const fromResponseSchema = getValueByPath(fromObject, [
    "responseSchema"
  ]);
  if (fromResponseSchema != null) {
    setValueByPath(toObject, ["responseSchema"], fromResponseSchema);
  }
  const fromRoutingConfig = getValueByPath(fromObject, [
    "routingConfig"
  ]);
  if (fromRoutingConfig != null) {
    setValueByPath(toObject, ["routingConfig"], fromRoutingConfig);
  }
  const fromSeed = getValueByPath(fromObject, ["seed"]);
  if (fromSeed != null) {
    setValueByPath(toObject, ["seed"], fromSeed);
  }
  const fromSpeechConfig = getValueByPath(fromObject, ["speechConfig"]);
  if (fromSpeechConfig != null) {
    setValueByPath(toObject, ["speechConfig"], fromSpeechConfig);
  }
  const fromStopSequences = getValueByPath(fromObject, [
    "stopSequences"
  ]);
  if (fromStopSequences != null) {
    setValueByPath(toObject, ["stopSequences"], fromStopSequences);
  }
  const fromTemperature = getValueByPath(fromObject, ["temperature"]);
  if (fromTemperature != null) {
    setValueByPath(toObject, ["temperature"], fromTemperature);
  }
  const fromThinkingConfig = getValueByPath(fromObject, [
    "thinkingConfig"
  ]);
  if (fromThinkingConfig != null) {
    setValueByPath(toObject, ["thinkingConfig"], fromThinkingConfig);
  }
  const fromTopK = getValueByPath(fromObject, ["topK"]);
  if (fromTopK != null) {
    setValueByPath(toObject, ["topK"], fromTopK);
  }
  const fromTopP = getValueByPath(fromObject, ["topP"]);
  if (fromTopP != null) {
    setValueByPath(toObject, ["topP"], fromTopP);
  }
  if (getValueByPath(fromObject, ["enableEnhancedCivicAnswers"]) !== void 0) {
    throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");
  }
  return toObject;
}
function googleMapsToMldev$2(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["authConfig"]) !== void 0) {
    throw new Error("authConfig parameter is not supported in Gemini API.");
  }
  const fromEnableWidget = getValueByPath(fromObject, ["enableWidget"]);
  if (fromEnableWidget != null) {
    setValueByPath(toObject, ["enableWidget"], fromEnableWidget);
  }
  return toObject;
}
function googleSearchToMldev$2(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["excludeDomains"]) !== void 0) {
    throw new Error("excludeDomains parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["blockingConfidence"]) !== void 0) {
    throw new Error("blockingConfidence parameter is not supported in Gemini API.");
  }
  const fromTimeRangeFilter = getValueByPath(fromObject, [
    "timeRangeFilter"
  ]);
  if (fromTimeRangeFilter != null) {
    setValueByPath(toObject, ["timeRangeFilter"], fromTimeRangeFilter);
  }
  return toObject;
}
function liveConnectConfigToMldev$1(fromObject, parentObject) {
  const toObject = {};
  const fromGenerationConfig = getValueByPath(fromObject, [
    "generationConfig"
  ]);
  if (parentObject !== void 0 && fromGenerationConfig != null) {
    setValueByPath(parentObject, ["setup", "generationConfig"], fromGenerationConfig);
  }
  const fromResponseModalities = getValueByPath(fromObject, [
    "responseModalities"
  ]);
  if (parentObject !== void 0 && fromResponseModalities != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "responseModalities"], fromResponseModalities);
  }
  const fromTemperature = getValueByPath(fromObject, ["temperature"]);
  if (parentObject !== void 0 && fromTemperature != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "temperature"], fromTemperature);
  }
  const fromTopP = getValueByPath(fromObject, ["topP"]);
  if (parentObject !== void 0 && fromTopP != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "topP"], fromTopP);
  }
  const fromTopK = getValueByPath(fromObject, ["topK"]);
  if (parentObject !== void 0 && fromTopK != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "topK"], fromTopK);
  }
  const fromMaxOutputTokens = getValueByPath(fromObject, [
    "maxOutputTokens"
  ]);
  if (parentObject !== void 0 && fromMaxOutputTokens != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "maxOutputTokens"], fromMaxOutputTokens);
  }
  const fromMediaResolution = getValueByPath(fromObject, [
    "mediaResolution"
  ]);
  if (parentObject !== void 0 && fromMediaResolution != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "mediaResolution"], fromMediaResolution);
  }
  const fromSeed = getValueByPath(fromObject, ["seed"]);
  if (parentObject !== void 0 && fromSeed != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "seed"], fromSeed);
  }
  const fromSpeechConfig = getValueByPath(fromObject, ["speechConfig"]);
  if (parentObject !== void 0 && fromSpeechConfig != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "speechConfig"], tLiveSpeechConfig(fromSpeechConfig));
  }
  const fromThinkingConfig = getValueByPath(fromObject, [
    "thinkingConfig"
  ]);
  if (parentObject !== void 0 && fromThinkingConfig != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "thinkingConfig"], fromThinkingConfig);
  }
  const fromEnableAffectiveDialog = getValueByPath(fromObject, [
    "enableAffectiveDialog"
  ]);
  if (parentObject !== void 0 && fromEnableAffectiveDialog != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "enableAffectiveDialog"], fromEnableAffectiveDialog);
  }
  const fromSystemInstruction = getValueByPath(fromObject, [
    "systemInstruction"
  ]);
  if (parentObject !== void 0 && fromSystemInstruction != null) {
    setValueByPath(parentObject, ["setup", "systemInstruction"], contentToMldev$2(tContent(fromSystemInstruction)));
  }
  const fromTools = getValueByPath(fromObject, ["tools"]);
  if (parentObject !== void 0 && fromTools != null) {
    let transformedList = tTools(fromTools);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return toolToMldev$2(tTool(item));
      });
    }
    setValueByPath(parentObject, ["setup", "tools"], transformedList);
  }
  const fromSessionResumption = getValueByPath(fromObject, [
    "sessionResumption"
  ]);
  if (parentObject !== void 0 && fromSessionResumption != null) {
    setValueByPath(parentObject, ["setup", "sessionResumption"], sessionResumptionConfigToMldev$1(fromSessionResumption));
  }
  const fromInputAudioTranscription = getValueByPath(fromObject, [
    "inputAudioTranscription"
  ]);
  if (parentObject !== void 0 && fromInputAudioTranscription != null) {
    setValueByPath(parentObject, ["setup", "inputAudioTranscription"], fromInputAudioTranscription);
  }
  const fromOutputAudioTranscription = getValueByPath(fromObject, [
    "outputAudioTranscription"
  ]);
  if (parentObject !== void 0 && fromOutputAudioTranscription != null) {
    setValueByPath(parentObject, ["setup", "outputAudioTranscription"], fromOutputAudioTranscription);
  }
  const fromRealtimeInputConfig = getValueByPath(fromObject, [
    "realtimeInputConfig"
  ]);
  if (parentObject !== void 0 && fromRealtimeInputConfig != null) {
    setValueByPath(parentObject, ["setup", "realtimeInputConfig"], fromRealtimeInputConfig);
  }
  const fromContextWindowCompression = getValueByPath(fromObject, [
    "contextWindowCompression"
  ]);
  if (parentObject !== void 0 && fromContextWindowCompression != null) {
    setValueByPath(parentObject, ["setup", "contextWindowCompression"], fromContextWindowCompression);
  }
  const fromProactivity = getValueByPath(fromObject, ["proactivity"]);
  if (parentObject !== void 0 && fromProactivity != null) {
    setValueByPath(parentObject, ["setup", "proactivity"], fromProactivity);
  }
  if (getValueByPath(fromObject, ["explicitVadSignal"]) !== void 0) {
    throw new Error("explicitVadSignal parameter is not supported in Gemini API.");
  }
  return toObject;
}
function liveConnectConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromGenerationConfig = getValueByPath(fromObject, [
    "generationConfig"
  ]);
  if (parentObject !== void 0 && fromGenerationConfig != null) {
    setValueByPath(parentObject, ["setup", "generationConfig"], generationConfigToVertex$1(fromGenerationConfig));
  }
  const fromResponseModalities = getValueByPath(fromObject, [
    "responseModalities"
  ]);
  if (parentObject !== void 0 && fromResponseModalities != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "responseModalities"], fromResponseModalities);
  }
  const fromTemperature = getValueByPath(fromObject, ["temperature"]);
  if (parentObject !== void 0 && fromTemperature != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "temperature"], fromTemperature);
  }
  const fromTopP = getValueByPath(fromObject, ["topP"]);
  if (parentObject !== void 0 && fromTopP != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "topP"], fromTopP);
  }
  const fromTopK = getValueByPath(fromObject, ["topK"]);
  if (parentObject !== void 0 && fromTopK != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "topK"], fromTopK);
  }
  const fromMaxOutputTokens = getValueByPath(fromObject, [
    "maxOutputTokens"
  ]);
  if (parentObject !== void 0 && fromMaxOutputTokens != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "maxOutputTokens"], fromMaxOutputTokens);
  }
  const fromMediaResolution = getValueByPath(fromObject, [
    "mediaResolution"
  ]);
  if (parentObject !== void 0 && fromMediaResolution != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "mediaResolution"], fromMediaResolution);
  }
  const fromSeed = getValueByPath(fromObject, ["seed"]);
  if (parentObject !== void 0 && fromSeed != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "seed"], fromSeed);
  }
  const fromSpeechConfig = getValueByPath(fromObject, ["speechConfig"]);
  if (parentObject !== void 0 && fromSpeechConfig != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "speechConfig"], tLiveSpeechConfig(fromSpeechConfig));
  }
  const fromThinkingConfig = getValueByPath(fromObject, [
    "thinkingConfig"
  ]);
  if (parentObject !== void 0 && fromThinkingConfig != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "thinkingConfig"], fromThinkingConfig);
  }
  const fromEnableAffectiveDialog = getValueByPath(fromObject, [
    "enableAffectiveDialog"
  ]);
  if (parentObject !== void 0 && fromEnableAffectiveDialog != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "enableAffectiveDialog"], fromEnableAffectiveDialog);
  }
  const fromSystemInstruction = getValueByPath(fromObject, [
    "systemInstruction"
  ]);
  if (parentObject !== void 0 && fromSystemInstruction != null) {
    setValueByPath(parentObject, ["setup", "systemInstruction"], tContent(fromSystemInstruction));
  }
  const fromTools = getValueByPath(fromObject, ["tools"]);
  if (parentObject !== void 0 && fromTools != null) {
    let transformedList = tTools(fromTools);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return toolToVertex$1(tTool(item));
      });
    }
    setValueByPath(parentObject, ["setup", "tools"], transformedList);
  }
  const fromSessionResumption = getValueByPath(fromObject, [
    "sessionResumption"
  ]);
  if (parentObject !== void 0 && fromSessionResumption != null) {
    setValueByPath(parentObject, ["setup", "sessionResumption"], fromSessionResumption);
  }
  const fromInputAudioTranscription = getValueByPath(fromObject, [
    "inputAudioTranscription"
  ]);
  if (parentObject !== void 0 && fromInputAudioTranscription != null) {
    setValueByPath(parentObject, ["setup", "inputAudioTranscription"], fromInputAudioTranscription);
  }
  const fromOutputAudioTranscription = getValueByPath(fromObject, [
    "outputAudioTranscription"
  ]);
  if (parentObject !== void 0 && fromOutputAudioTranscription != null) {
    setValueByPath(parentObject, ["setup", "outputAudioTranscription"], fromOutputAudioTranscription);
  }
  const fromRealtimeInputConfig = getValueByPath(fromObject, [
    "realtimeInputConfig"
  ]);
  if (parentObject !== void 0 && fromRealtimeInputConfig != null) {
    setValueByPath(parentObject, ["setup", "realtimeInputConfig"], fromRealtimeInputConfig);
  }
  const fromContextWindowCompression = getValueByPath(fromObject, [
    "contextWindowCompression"
  ]);
  if (parentObject !== void 0 && fromContextWindowCompression != null) {
    setValueByPath(parentObject, ["setup", "contextWindowCompression"], fromContextWindowCompression);
  }
  const fromProactivity = getValueByPath(fromObject, ["proactivity"]);
  if (parentObject !== void 0 && fromProactivity != null) {
    setValueByPath(parentObject, ["setup", "proactivity"], fromProactivity);
  }
  const fromExplicitVadSignal = getValueByPath(fromObject, [
    "explicitVadSignal"
  ]);
  if (parentObject !== void 0 && fromExplicitVadSignal != null) {
    setValueByPath(parentObject, ["setup", "explicitVadSignal"], fromExplicitVadSignal);
  }
  return toObject;
}
function liveConnectParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["setup", "model"], tModel(apiClient, fromModel));
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    setValueByPath(toObject, ["config"], liveConnectConfigToMldev$1(fromConfig, toObject));
  }
  return toObject;
}
function liveConnectParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["setup", "model"], tModel(apiClient, fromModel));
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    setValueByPath(toObject, ["config"], liveConnectConfigToVertex(fromConfig, toObject));
  }
  return toObject;
}
function liveMusicSetConfigParametersToMldev(fromObject) {
  const toObject = {};
  const fromMusicGenerationConfig = getValueByPath(fromObject, [
    "musicGenerationConfig"
  ]);
  if (fromMusicGenerationConfig != null) {
    setValueByPath(toObject, ["musicGenerationConfig"], fromMusicGenerationConfig);
  }
  return toObject;
}
function liveMusicSetWeightedPromptsParametersToMldev(fromObject) {
  const toObject = {};
  const fromWeightedPrompts = getValueByPath(fromObject, [
    "weightedPrompts"
  ]);
  if (fromWeightedPrompts != null) {
    let transformedList = fromWeightedPrompts;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["weightedPrompts"], transformedList);
  }
  return toObject;
}
function liveSendRealtimeInputParametersToMldev(fromObject) {
  const toObject = {};
  const fromMedia = getValueByPath(fromObject, ["media"]);
  if (fromMedia != null) {
    let transformedList = tBlobs(fromMedia);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return blobToMldev$2(item);
      });
    }
    setValueByPath(toObject, ["mediaChunks"], transformedList);
  }
  const fromAudio = getValueByPath(fromObject, ["audio"]);
  if (fromAudio != null) {
    setValueByPath(toObject, ["audio"], blobToMldev$2(tAudioBlob(fromAudio)));
  }
  const fromAudioStreamEnd = getValueByPath(fromObject, [
    "audioStreamEnd"
  ]);
  if (fromAudioStreamEnd != null) {
    setValueByPath(toObject, ["audioStreamEnd"], fromAudioStreamEnd);
  }
  const fromVideo = getValueByPath(fromObject, ["video"]);
  if (fromVideo != null) {
    setValueByPath(toObject, ["video"], blobToMldev$2(tImageBlob(fromVideo)));
  }
  const fromText = getValueByPath(fromObject, ["text"]);
  if (fromText != null) {
    setValueByPath(toObject, ["text"], fromText);
  }
  const fromActivityStart = getValueByPath(fromObject, [
    "activityStart"
  ]);
  if (fromActivityStart != null) {
    setValueByPath(toObject, ["activityStart"], fromActivityStart);
  }
  const fromActivityEnd = getValueByPath(fromObject, ["activityEnd"]);
  if (fromActivityEnd != null) {
    setValueByPath(toObject, ["activityEnd"], fromActivityEnd);
  }
  return toObject;
}
function liveSendRealtimeInputParametersToVertex(fromObject) {
  const toObject = {};
  const fromMedia = getValueByPath(fromObject, ["media"]);
  if (fromMedia != null) {
    let transformedList = tBlobs(fromMedia);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["mediaChunks"], transformedList);
  }
  const fromAudio = getValueByPath(fromObject, ["audio"]);
  if (fromAudio != null) {
    setValueByPath(toObject, ["audio"], tAudioBlob(fromAudio));
  }
  const fromAudioStreamEnd = getValueByPath(fromObject, [
    "audioStreamEnd"
  ]);
  if (fromAudioStreamEnd != null) {
    setValueByPath(toObject, ["audioStreamEnd"], fromAudioStreamEnd);
  }
  const fromVideo = getValueByPath(fromObject, ["video"]);
  if (fromVideo != null) {
    setValueByPath(toObject, ["video"], tImageBlob(fromVideo));
  }
  const fromText = getValueByPath(fromObject, ["text"]);
  if (fromText != null) {
    setValueByPath(toObject, ["text"], fromText);
  }
  const fromActivityStart = getValueByPath(fromObject, [
    "activityStart"
  ]);
  if (fromActivityStart != null) {
    setValueByPath(toObject, ["activityStart"], fromActivityStart);
  }
  const fromActivityEnd = getValueByPath(fromObject, ["activityEnd"]);
  if (fromActivityEnd != null) {
    setValueByPath(toObject, ["activityEnd"], fromActivityEnd);
  }
  return toObject;
}
function liveServerMessageFromVertex(fromObject) {
  const toObject = {};
  const fromSetupComplete = getValueByPath(fromObject, [
    "setupComplete"
  ]);
  if (fromSetupComplete != null) {
    setValueByPath(toObject, ["setupComplete"], fromSetupComplete);
  }
  const fromServerContent = getValueByPath(fromObject, [
    "serverContent"
  ]);
  if (fromServerContent != null) {
    setValueByPath(toObject, ["serverContent"], fromServerContent);
  }
  const fromToolCall = getValueByPath(fromObject, ["toolCall"]);
  if (fromToolCall != null) {
    setValueByPath(toObject, ["toolCall"], fromToolCall);
  }
  const fromToolCallCancellation = getValueByPath(fromObject, [
    "toolCallCancellation"
  ]);
  if (fromToolCallCancellation != null) {
    setValueByPath(toObject, ["toolCallCancellation"], fromToolCallCancellation);
  }
  const fromUsageMetadata = getValueByPath(fromObject, [
    "usageMetadata"
  ]);
  if (fromUsageMetadata != null) {
    setValueByPath(toObject, ["usageMetadata"], usageMetadataFromVertex(fromUsageMetadata));
  }
  const fromGoAway = getValueByPath(fromObject, ["goAway"]);
  if (fromGoAway != null) {
    setValueByPath(toObject, ["goAway"], fromGoAway);
  }
  const fromSessionResumptionUpdate = getValueByPath(fromObject, [
    "sessionResumptionUpdate"
  ]);
  if (fromSessionResumptionUpdate != null) {
    setValueByPath(toObject, ["sessionResumptionUpdate"], fromSessionResumptionUpdate);
  }
  const fromVoiceActivityDetectionSignal = getValueByPath(fromObject, [
    "voiceActivityDetectionSignal"
  ]);
  if (fromVoiceActivityDetectionSignal != null) {
    setValueByPath(toObject, ["voiceActivityDetectionSignal"], fromVoiceActivityDetectionSignal);
  }
  return toObject;
}
function partToMldev$2(fromObject) {
  const toObject = {};
  const fromMediaResolution = getValueByPath(fromObject, [
    "mediaResolution"
  ]);
  if (fromMediaResolution != null) {
    setValueByPath(toObject, ["mediaResolution"], fromMediaResolution);
  }
  const fromCodeExecutionResult = getValueByPath(fromObject, [
    "codeExecutionResult"
  ]);
  if (fromCodeExecutionResult != null) {
    setValueByPath(toObject, ["codeExecutionResult"], fromCodeExecutionResult);
  }
  const fromExecutableCode = getValueByPath(fromObject, [
    "executableCode"
  ]);
  if (fromExecutableCode != null) {
    setValueByPath(toObject, ["executableCode"], fromExecutableCode);
  }
  const fromFileData = getValueByPath(fromObject, ["fileData"]);
  if (fromFileData != null) {
    setValueByPath(toObject, ["fileData"], fileDataToMldev$2(fromFileData));
  }
  const fromFunctionCall = getValueByPath(fromObject, ["functionCall"]);
  if (fromFunctionCall != null) {
    setValueByPath(toObject, ["functionCall"], functionCallToMldev$2(fromFunctionCall));
  }
  const fromFunctionResponse = getValueByPath(fromObject, [
    "functionResponse"
  ]);
  if (fromFunctionResponse != null) {
    setValueByPath(toObject, ["functionResponse"], fromFunctionResponse);
  }
  const fromInlineData = getValueByPath(fromObject, ["inlineData"]);
  if (fromInlineData != null) {
    setValueByPath(toObject, ["inlineData"], blobToMldev$2(fromInlineData));
  }
  const fromText = getValueByPath(fromObject, ["text"]);
  if (fromText != null) {
    setValueByPath(toObject, ["text"], fromText);
  }
  const fromThought = getValueByPath(fromObject, ["thought"]);
  if (fromThought != null) {
    setValueByPath(toObject, ["thought"], fromThought);
  }
  const fromThoughtSignature = getValueByPath(fromObject, [
    "thoughtSignature"
  ]);
  if (fromThoughtSignature != null) {
    setValueByPath(toObject, ["thoughtSignature"], fromThoughtSignature);
  }
  const fromVideoMetadata = getValueByPath(fromObject, [
    "videoMetadata"
  ]);
  if (fromVideoMetadata != null) {
    setValueByPath(toObject, ["videoMetadata"], fromVideoMetadata);
  }
  return toObject;
}
function sessionResumptionConfigToMldev$1(fromObject) {
  const toObject = {};
  const fromHandle = getValueByPath(fromObject, ["handle"]);
  if (fromHandle != null) {
    setValueByPath(toObject, ["handle"], fromHandle);
  }
  if (getValueByPath(fromObject, ["transparent"]) !== void 0) {
    throw new Error("transparent parameter is not supported in Gemini API.");
  }
  return toObject;
}
function toolToMldev$2(fromObject) {
  const toObject = {};
  const fromFunctionDeclarations = getValueByPath(fromObject, [
    "functionDeclarations"
  ]);
  if (fromFunctionDeclarations != null) {
    let transformedList = fromFunctionDeclarations;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["functionDeclarations"], transformedList);
  }
  if (getValueByPath(fromObject, ["retrieval"]) !== void 0) {
    throw new Error("retrieval parameter is not supported in Gemini API.");
  }
  const fromGoogleSearchRetrieval = getValueByPath(fromObject, [
    "googleSearchRetrieval"
  ]);
  if (fromGoogleSearchRetrieval != null) {
    setValueByPath(toObject, ["googleSearchRetrieval"], fromGoogleSearchRetrieval);
  }
  const fromComputerUse = getValueByPath(fromObject, ["computerUse"]);
  if (fromComputerUse != null) {
    setValueByPath(toObject, ["computerUse"], fromComputerUse);
  }
  const fromFileSearch = getValueByPath(fromObject, ["fileSearch"]);
  if (fromFileSearch != null) {
    setValueByPath(toObject, ["fileSearch"], fromFileSearch);
  }
  const fromCodeExecution = getValueByPath(fromObject, [
    "codeExecution"
  ]);
  if (fromCodeExecution != null) {
    setValueByPath(toObject, ["codeExecution"], fromCodeExecution);
  }
  if (getValueByPath(fromObject, ["enterpriseWebSearch"]) !== void 0) {
    throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");
  }
  const fromGoogleMaps = getValueByPath(fromObject, ["googleMaps"]);
  if (fromGoogleMaps != null) {
    setValueByPath(toObject, ["googleMaps"], googleMapsToMldev$2(fromGoogleMaps));
  }
  const fromGoogleSearch = getValueByPath(fromObject, ["googleSearch"]);
  if (fromGoogleSearch != null) {
    setValueByPath(toObject, ["googleSearch"], googleSearchToMldev$2(fromGoogleSearch));
  }
  const fromUrlContext = getValueByPath(fromObject, ["urlContext"]);
  if (fromUrlContext != null) {
    setValueByPath(toObject, ["urlContext"], fromUrlContext);
  }
  return toObject;
}
function toolToVertex$1(fromObject) {
  const toObject = {};
  const fromFunctionDeclarations = getValueByPath(fromObject, [
    "functionDeclarations"
  ]);
  if (fromFunctionDeclarations != null) {
    let transformedList = fromFunctionDeclarations;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return functionDeclarationToVertex$1(item);
      });
    }
    setValueByPath(toObject, ["functionDeclarations"], transformedList);
  }
  const fromRetrieval = getValueByPath(fromObject, ["retrieval"]);
  if (fromRetrieval != null) {
    setValueByPath(toObject, ["retrieval"], fromRetrieval);
  }
  const fromGoogleSearchRetrieval = getValueByPath(fromObject, [
    "googleSearchRetrieval"
  ]);
  if (fromGoogleSearchRetrieval != null) {
    setValueByPath(toObject, ["googleSearchRetrieval"], fromGoogleSearchRetrieval);
  }
  const fromComputerUse = getValueByPath(fromObject, ["computerUse"]);
  if (fromComputerUse != null) {
    setValueByPath(toObject, ["computerUse"], fromComputerUse);
  }
  if (getValueByPath(fromObject, ["fileSearch"]) !== void 0) {
    throw new Error("fileSearch parameter is not supported in Vertex AI.");
  }
  const fromCodeExecution = getValueByPath(fromObject, [
    "codeExecution"
  ]);
  if (fromCodeExecution != null) {
    setValueByPath(toObject, ["codeExecution"], fromCodeExecution);
  }
  const fromEnterpriseWebSearch = getValueByPath(fromObject, [
    "enterpriseWebSearch"
  ]);
  if (fromEnterpriseWebSearch != null) {
    setValueByPath(toObject, ["enterpriseWebSearch"], fromEnterpriseWebSearch);
  }
  const fromGoogleMaps = getValueByPath(fromObject, ["googleMaps"]);
  if (fromGoogleMaps != null) {
    setValueByPath(toObject, ["googleMaps"], fromGoogleMaps);
  }
  const fromGoogleSearch = getValueByPath(fromObject, ["googleSearch"]);
  if (fromGoogleSearch != null) {
    setValueByPath(toObject, ["googleSearch"], fromGoogleSearch);
  }
  const fromUrlContext = getValueByPath(fromObject, ["urlContext"]);
  if (fromUrlContext != null) {
    setValueByPath(toObject, ["urlContext"], fromUrlContext);
  }
  return toObject;
}
function usageMetadataFromVertex(fromObject) {
  const toObject = {};
  const fromPromptTokenCount = getValueByPath(fromObject, [
    "promptTokenCount"
  ]);
  if (fromPromptTokenCount != null) {
    setValueByPath(toObject, ["promptTokenCount"], fromPromptTokenCount);
  }
  const fromCachedContentTokenCount = getValueByPath(fromObject, [
    "cachedContentTokenCount"
  ]);
  if (fromCachedContentTokenCount != null) {
    setValueByPath(toObject, ["cachedContentTokenCount"], fromCachedContentTokenCount);
  }
  const fromResponseTokenCount = getValueByPath(fromObject, [
    "candidatesTokenCount"
  ]);
  if (fromResponseTokenCount != null) {
    setValueByPath(toObject, ["responseTokenCount"], fromResponseTokenCount);
  }
  const fromToolUsePromptTokenCount = getValueByPath(fromObject, [
    "toolUsePromptTokenCount"
  ]);
  if (fromToolUsePromptTokenCount != null) {
    setValueByPath(toObject, ["toolUsePromptTokenCount"], fromToolUsePromptTokenCount);
  }
  const fromThoughtsTokenCount = getValueByPath(fromObject, [
    "thoughtsTokenCount"
  ]);
  if (fromThoughtsTokenCount != null) {
    setValueByPath(toObject, ["thoughtsTokenCount"], fromThoughtsTokenCount);
  }
  const fromTotalTokenCount = getValueByPath(fromObject, [
    "totalTokenCount"
  ]);
  if (fromTotalTokenCount != null) {
    setValueByPath(toObject, ["totalTokenCount"], fromTotalTokenCount);
  }
  const fromPromptTokensDetails = getValueByPath(fromObject, [
    "promptTokensDetails"
  ]);
  if (fromPromptTokensDetails != null) {
    let transformedList = fromPromptTokensDetails;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["promptTokensDetails"], transformedList);
  }
  const fromCacheTokensDetails = getValueByPath(fromObject, [
    "cacheTokensDetails"
  ]);
  if (fromCacheTokensDetails != null) {
    let transformedList = fromCacheTokensDetails;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["cacheTokensDetails"], transformedList);
  }
  const fromResponseTokensDetails = getValueByPath(fromObject, [
    "candidatesTokensDetails"
  ]);
  if (fromResponseTokensDetails != null) {
    let transformedList = fromResponseTokensDetails;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["responseTokensDetails"], transformedList);
  }
  const fromToolUsePromptTokensDetails = getValueByPath(fromObject, [
    "toolUsePromptTokensDetails"
  ]);
  if (fromToolUsePromptTokensDetails != null) {
    let transformedList = fromToolUsePromptTokensDetails;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["toolUsePromptTokensDetails"], transformedList);
  }
  const fromTrafficType = getValueByPath(fromObject, ["trafficType"]);
  if (fromTrafficType != null) {
    setValueByPath(toObject, ["trafficType"], fromTrafficType);
  }
  return toObject;
}
function blobToMldev$1(fromObject) {
  const toObject = {};
  const fromData = getValueByPath(fromObject, ["data"]);
  if (fromData != null) {
    setValueByPath(toObject, ["data"], fromData);
  }
  if (getValueByPath(fromObject, ["displayName"]) !== void 0) {
    throw new Error("displayName parameter is not supported in Gemini API.");
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function candidateFromMldev(fromObject) {
  const toObject = {};
  const fromContent = getValueByPath(fromObject, ["content"]);
  if (fromContent != null) {
    setValueByPath(toObject, ["content"], fromContent);
  }
  const fromCitationMetadata = getValueByPath(fromObject, [
    "citationMetadata"
  ]);
  if (fromCitationMetadata != null) {
    setValueByPath(toObject, ["citationMetadata"], citationMetadataFromMldev(fromCitationMetadata));
  }
  const fromTokenCount = getValueByPath(fromObject, ["tokenCount"]);
  if (fromTokenCount != null) {
    setValueByPath(toObject, ["tokenCount"], fromTokenCount);
  }
  const fromFinishReason = getValueByPath(fromObject, ["finishReason"]);
  if (fromFinishReason != null) {
    setValueByPath(toObject, ["finishReason"], fromFinishReason);
  }
  const fromAvgLogprobs = getValueByPath(fromObject, ["avgLogprobs"]);
  if (fromAvgLogprobs != null) {
    setValueByPath(toObject, ["avgLogprobs"], fromAvgLogprobs);
  }
  const fromGroundingMetadata = getValueByPath(fromObject, [
    "groundingMetadata"
  ]);
  if (fromGroundingMetadata != null) {
    setValueByPath(toObject, ["groundingMetadata"], fromGroundingMetadata);
  }
  const fromIndex = getValueByPath(fromObject, ["index"]);
  if (fromIndex != null) {
    setValueByPath(toObject, ["index"], fromIndex);
  }
  const fromLogprobsResult = getValueByPath(fromObject, [
    "logprobsResult"
  ]);
  if (fromLogprobsResult != null) {
    setValueByPath(toObject, ["logprobsResult"], fromLogprobsResult);
  }
  const fromSafetyRatings = getValueByPath(fromObject, [
    "safetyRatings"
  ]);
  if (fromSafetyRatings != null) {
    let transformedList = fromSafetyRatings;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["safetyRatings"], transformedList);
  }
  const fromUrlContextMetadata = getValueByPath(fromObject, [
    "urlContextMetadata"
  ]);
  if (fromUrlContextMetadata != null) {
    setValueByPath(toObject, ["urlContextMetadata"], fromUrlContextMetadata);
  }
  return toObject;
}
function citationMetadataFromMldev(fromObject) {
  const toObject = {};
  const fromCitations = getValueByPath(fromObject, ["citationSources"]);
  if (fromCitations != null) {
    let transformedList = fromCitations;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["citations"], transformedList);
  }
  return toObject;
}
function computeTokensParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromContents = getValueByPath(fromObject, ["contents"]);
  if (fromContents != null) {
    let transformedList = tContents(fromContents);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["contents"], transformedList);
  }
  return toObject;
}
function computeTokensResponseFromVertex(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromTokensInfo = getValueByPath(fromObject, ["tokensInfo"]);
  if (fromTokensInfo != null) {
    let transformedList = fromTokensInfo;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["tokensInfo"], transformedList);
  }
  return toObject;
}
function contentEmbeddingFromVertex(fromObject) {
  const toObject = {};
  const fromValues = getValueByPath(fromObject, ["values"]);
  if (fromValues != null) {
    setValueByPath(toObject, ["values"], fromValues);
  }
  const fromStatistics = getValueByPath(fromObject, ["statistics"]);
  if (fromStatistics != null) {
    setValueByPath(toObject, ["statistics"], contentEmbeddingStatisticsFromVertex(fromStatistics));
  }
  return toObject;
}
function contentEmbeddingStatisticsFromVertex(fromObject) {
  const toObject = {};
  const fromTruncated = getValueByPath(fromObject, ["truncated"]);
  if (fromTruncated != null) {
    setValueByPath(toObject, ["truncated"], fromTruncated);
  }
  const fromTokenCount = getValueByPath(fromObject, ["token_count"]);
  if (fromTokenCount != null) {
    setValueByPath(toObject, ["tokenCount"], fromTokenCount);
  }
  return toObject;
}
function contentToMldev$1(fromObject) {
  const toObject = {};
  const fromParts = getValueByPath(fromObject, ["parts"]);
  if (fromParts != null) {
    let transformedList = fromParts;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return partToMldev$1(item);
      });
    }
    setValueByPath(toObject, ["parts"], transformedList);
  }
  const fromRole = getValueByPath(fromObject, ["role"]);
  if (fromRole != null) {
    setValueByPath(toObject, ["role"], fromRole);
  }
  return toObject;
}
function controlReferenceConfigToVertex(fromObject) {
  const toObject = {};
  const fromControlType = getValueByPath(fromObject, ["controlType"]);
  if (fromControlType != null) {
    setValueByPath(toObject, ["controlType"], fromControlType);
  }
  const fromEnableControlImageComputation = getValueByPath(fromObject, [
    "enableControlImageComputation"
  ]);
  if (fromEnableControlImageComputation != null) {
    setValueByPath(toObject, ["computeControl"], fromEnableControlImageComputation);
  }
  return toObject;
}
function countTokensConfigToMldev(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["systemInstruction"]) !== void 0) {
    throw new Error("systemInstruction parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["tools"]) !== void 0) {
    throw new Error("tools parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["generationConfig"]) !== void 0) {
    throw new Error("generationConfig parameter is not supported in Gemini API.");
  }
  return toObject;
}
function countTokensConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromSystemInstruction = getValueByPath(fromObject, [
    "systemInstruction"
  ]);
  if (parentObject !== void 0 && fromSystemInstruction != null) {
    setValueByPath(parentObject, ["systemInstruction"], tContent(fromSystemInstruction));
  }
  const fromTools = getValueByPath(fromObject, ["tools"]);
  if (parentObject !== void 0 && fromTools != null) {
    let transformedList = fromTools;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return toolToVertex(item);
      });
    }
    setValueByPath(parentObject, ["tools"], transformedList);
  }
  const fromGenerationConfig = getValueByPath(fromObject, [
    "generationConfig"
  ]);
  if (parentObject !== void 0 && fromGenerationConfig != null) {
    setValueByPath(parentObject, ["generationConfig"], generationConfigToVertex(fromGenerationConfig));
  }
  return toObject;
}
function countTokensParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromContents = getValueByPath(fromObject, ["contents"]);
  if (fromContents != null) {
    let transformedList = tContents(fromContents);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return contentToMldev$1(item);
      });
    }
    setValueByPath(toObject, ["contents"], transformedList);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    countTokensConfigToMldev(fromConfig);
  }
  return toObject;
}
function countTokensParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromContents = getValueByPath(fromObject, ["contents"]);
  if (fromContents != null) {
    let transformedList = tContents(fromContents);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["contents"], transformedList);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    countTokensConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
function countTokensResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromTotalTokens = getValueByPath(fromObject, ["totalTokens"]);
  if (fromTotalTokens != null) {
    setValueByPath(toObject, ["totalTokens"], fromTotalTokens);
  }
  const fromCachedContentTokenCount = getValueByPath(fromObject, [
    "cachedContentTokenCount"
  ]);
  if (fromCachedContentTokenCount != null) {
    setValueByPath(toObject, ["cachedContentTokenCount"], fromCachedContentTokenCount);
  }
  return toObject;
}
function countTokensResponseFromVertex(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromTotalTokens = getValueByPath(fromObject, ["totalTokens"]);
  if (fromTotalTokens != null) {
    setValueByPath(toObject, ["totalTokens"], fromTotalTokens);
  }
  return toObject;
}
function deleteModelParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "name"], tModel(apiClient, fromModel));
  }
  return toObject;
}
function deleteModelParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "name"], tModel(apiClient, fromModel));
  }
  return toObject;
}
function deleteModelResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  return toObject;
}
function deleteModelResponseFromVertex(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  return toObject;
}
function editImageConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromOutputGcsUri = getValueByPath(fromObject, ["outputGcsUri"]);
  if (parentObject !== void 0 && fromOutputGcsUri != null) {
    setValueByPath(parentObject, ["parameters", "storageUri"], fromOutputGcsUri);
  }
  const fromNegativePrompt = getValueByPath(fromObject, [
    "negativePrompt"
  ]);
  if (parentObject !== void 0 && fromNegativePrompt != null) {
    setValueByPath(parentObject, ["parameters", "negativePrompt"], fromNegativePrompt);
  }
  const fromNumberOfImages = getValueByPath(fromObject, [
    "numberOfImages"
  ]);
  if (parentObject !== void 0 && fromNumberOfImages != null) {
    setValueByPath(parentObject, ["parameters", "sampleCount"], fromNumberOfImages);
  }
  const fromAspectRatio = getValueByPath(fromObject, ["aspectRatio"]);
  if (parentObject !== void 0 && fromAspectRatio != null) {
    setValueByPath(parentObject, ["parameters", "aspectRatio"], fromAspectRatio);
  }
  const fromGuidanceScale = getValueByPath(fromObject, [
    "guidanceScale"
  ]);
  if (parentObject !== void 0 && fromGuidanceScale != null) {
    setValueByPath(parentObject, ["parameters", "guidanceScale"], fromGuidanceScale);
  }
  const fromSeed = getValueByPath(fromObject, ["seed"]);
  if (parentObject !== void 0 && fromSeed != null) {
    setValueByPath(parentObject, ["parameters", "seed"], fromSeed);
  }
  const fromSafetyFilterLevel = getValueByPath(fromObject, [
    "safetyFilterLevel"
  ]);
  if (parentObject !== void 0 && fromSafetyFilterLevel != null) {
    setValueByPath(parentObject, ["parameters", "safetySetting"], fromSafetyFilterLevel);
  }
  const fromPersonGeneration = getValueByPath(fromObject, [
    "personGeneration"
  ]);
  if (parentObject !== void 0 && fromPersonGeneration != null) {
    setValueByPath(parentObject, ["parameters", "personGeneration"], fromPersonGeneration);
  }
  const fromIncludeSafetyAttributes = getValueByPath(fromObject, [
    "includeSafetyAttributes"
  ]);
  if (parentObject !== void 0 && fromIncludeSafetyAttributes != null) {
    setValueByPath(parentObject, ["parameters", "includeSafetyAttributes"], fromIncludeSafetyAttributes);
  }
  const fromIncludeRaiReason = getValueByPath(fromObject, [
    "includeRaiReason"
  ]);
  if (parentObject !== void 0 && fromIncludeRaiReason != null) {
    setValueByPath(parentObject, ["parameters", "includeRaiReason"], fromIncludeRaiReason);
  }
  const fromLanguage = getValueByPath(fromObject, ["language"]);
  if (parentObject !== void 0 && fromLanguage != null) {
    setValueByPath(parentObject, ["parameters", "language"], fromLanguage);
  }
  const fromOutputMimeType = getValueByPath(fromObject, [
    "outputMimeType"
  ]);
  if (parentObject !== void 0 && fromOutputMimeType != null) {
    setValueByPath(parentObject, ["parameters", "outputOptions", "mimeType"], fromOutputMimeType);
  }
  const fromOutputCompressionQuality = getValueByPath(fromObject, [
    "outputCompressionQuality"
  ]);
  if (parentObject !== void 0 && fromOutputCompressionQuality != null) {
    setValueByPath(parentObject, ["parameters", "outputOptions", "compressionQuality"], fromOutputCompressionQuality);
  }
  const fromAddWatermark = getValueByPath(fromObject, ["addWatermark"]);
  if (parentObject !== void 0 && fromAddWatermark != null) {
    setValueByPath(parentObject, ["parameters", "addWatermark"], fromAddWatermark);
  }
  const fromLabels = getValueByPath(fromObject, ["labels"]);
  if (parentObject !== void 0 && fromLabels != null) {
    setValueByPath(parentObject, ["labels"], fromLabels);
  }
  const fromEditMode = getValueByPath(fromObject, ["editMode"]);
  if (parentObject !== void 0 && fromEditMode != null) {
    setValueByPath(parentObject, ["parameters", "editMode"], fromEditMode);
  }
  const fromBaseSteps = getValueByPath(fromObject, ["baseSteps"]);
  if (parentObject !== void 0 && fromBaseSteps != null) {
    setValueByPath(parentObject, ["parameters", "editConfig", "baseSteps"], fromBaseSteps);
  }
  return toObject;
}
function editImageParametersInternalToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromPrompt = getValueByPath(fromObject, ["prompt"]);
  if (fromPrompt != null) {
    setValueByPath(toObject, ["instances[0]", "prompt"], fromPrompt);
  }
  const fromReferenceImages = getValueByPath(fromObject, [
    "referenceImages"
  ]);
  if (fromReferenceImages != null) {
    let transformedList = fromReferenceImages;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return referenceImageAPIInternalToVertex(item);
      });
    }
    setValueByPath(toObject, ["instances[0]", "referenceImages"], transformedList);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    editImageConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
function editImageResponseFromVertex(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromGeneratedImages = getValueByPath(fromObject, [
    "predictions"
  ]);
  if (fromGeneratedImages != null) {
    let transformedList = fromGeneratedImages;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return generatedImageFromVertex(item);
      });
    }
    setValueByPath(toObject, ["generatedImages"], transformedList);
  }
  return toObject;
}
function embedContentConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromTaskType = getValueByPath(fromObject, ["taskType"]);
  if (parentObject !== void 0 && fromTaskType != null) {
    setValueByPath(parentObject, ["requests[]", "taskType"], fromTaskType);
  }
  const fromTitle = getValueByPath(fromObject, ["title"]);
  if (parentObject !== void 0 && fromTitle != null) {
    setValueByPath(parentObject, ["requests[]", "title"], fromTitle);
  }
  const fromOutputDimensionality = getValueByPath(fromObject, [
    "outputDimensionality"
  ]);
  if (parentObject !== void 0 && fromOutputDimensionality != null) {
    setValueByPath(parentObject, ["requests[]", "outputDimensionality"], fromOutputDimensionality);
  }
  if (getValueByPath(fromObject, ["mimeType"]) !== void 0) {
    throw new Error("mimeType parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["autoTruncate"]) !== void 0) {
    throw new Error("autoTruncate parameter is not supported in Gemini API.");
  }
  return toObject;
}
function embedContentConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromTaskType = getValueByPath(fromObject, ["taskType"]);
  if (parentObject !== void 0 && fromTaskType != null) {
    setValueByPath(parentObject, ["instances[]", "task_type"], fromTaskType);
  }
  const fromTitle = getValueByPath(fromObject, ["title"]);
  if (parentObject !== void 0 && fromTitle != null) {
    setValueByPath(parentObject, ["instances[]", "title"], fromTitle);
  }
  const fromOutputDimensionality = getValueByPath(fromObject, [
    "outputDimensionality"
  ]);
  if (parentObject !== void 0 && fromOutputDimensionality != null) {
    setValueByPath(parentObject, ["parameters", "outputDimensionality"], fromOutputDimensionality);
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (parentObject !== void 0 && fromMimeType != null) {
    setValueByPath(parentObject, ["instances[]", "mimeType"], fromMimeType);
  }
  const fromAutoTruncate = getValueByPath(fromObject, ["autoTruncate"]);
  if (parentObject !== void 0 && fromAutoTruncate != null) {
    setValueByPath(parentObject, ["parameters", "autoTruncate"], fromAutoTruncate);
  }
  return toObject;
}
function embedContentParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromContents = getValueByPath(fromObject, ["contents"]);
  if (fromContents != null) {
    let transformedList = tContentsForEmbed(apiClient, fromContents);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["requests[]", "content"], transformedList);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    embedContentConfigToMldev(fromConfig, toObject);
  }
  const fromModelForEmbedContent = getValueByPath(fromObject, ["model"]);
  if (fromModelForEmbedContent !== void 0) {
    setValueByPath(toObject, ["requests[]", "model"], tModel(apiClient, fromModelForEmbedContent));
  }
  return toObject;
}
function embedContentParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromContents = getValueByPath(fromObject, ["contents"]);
  if (fromContents != null) {
    let transformedList = tContentsForEmbed(apiClient, fromContents);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["instances[]", "content"], transformedList);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    embedContentConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
function embedContentResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromEmbeddings = getValueByPath(fromObject, ["embeddings"]);
  if (fromEmbeddings != null) {
    let transformedList = fromEmbeddings;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["embeddings"], transformedList);
  }
  const fromMetadata = getValueByPath(fromObject, ["metadata"]);
  if (fromMetadata != null) {
    setValueByPath(toObject, ["metadata"], fromMetadata);
  }
  return toObject;
}
function embedContentResponseFromVertex(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromEmbeddings = getValueByPath(fromObject, [
    "predictions[]",
    "embeddings"
  ]);
  if (fromEmbeddings != null) {
    let transformedList = fromEmbeddings;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return contentEmbeddingFromVertex(item);
      });
    }
    setValueByPath(toObject, ["embeddings"], transformedList);
  }
  const fromMetadata = getValueByPath(fromObject, ["metadata"]);
  if (fromMetadata != null) {
    setValueByPath(toObject, ["metadata"], fromMetadata);
  }
  return toObject;
}
function endpointFromVertex(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["endpoint"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromDeployedModelId = getValueByPath(fromObject, [
    "deployedModelId"
  ]);
  if (fromDeployedModelId != null) {
    setValueByPath(toObject, ["deployedModelId"], fromDeployedModelId);
  }
  return toObject;
}
function fileDataToMldev$1(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["displayName"]) !== void 0) {
    throw new Error("displayName parameter is not supported in Gemini API.");
  }
  const fromFileUri = getValueByPath(fromObject, ["fileUri"]);
  if (fromFileUri != null) {
    setValueByPath(toObject, ["fileUri"], fromFileUri);
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function functionCallToMldev$1(fromObject) {
  const toObject = {};
  const fromId = getValueByPath(fromObject, ["id"]);
  if (fromId != null) {
    setValueByPath(toObject, ["id"], fromId);
  }
  const fromArgs = getValueByPath(fromObject, ["args"]);
  if (fromArgs != null) {
    setValueByPath(toObject, ["args"], fromArgs);
  }
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  if (getValueByPath(fromObject, ["partialArgs"]) !== void 0) {
    throw new Error("partialArgs parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["willContinue"]) !== void 0) {
    throw new Error("willContinue parameter is not supported in Gemini API.");
  }
  return toObject;
}
function functionCallingConfigToMldev(fromObject) {
  const toObject = {};
  const fromMode = getValueByPath(fromObject, ["mode"]);
  if (fromMode != null) {
    setValueByPath(toObject, ["mode"], fromMode);
  }
  const fromAllowedFunctionNames = getValueByPath(fromObject, [
    "allowedFunctionNames"
  ]);
  if (fromAllowedFunctionNames != null) {
    setValueByPath(toObject, ["allowedFunctionNames"], fromAllowedFunctionNames);
  }
  if (getValueByPath(fromObject, ["streamFunctionCallArguments"]) !== void 0) {
    throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");
  }
  return toObject;
}
function functionDeclarationToVertex(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["behavior"]) !== void 0) {
    throw new Error("behavior parameter is not supported in Vertex AI.");
  }
  const fromDescription = getValueByPath(fromObject, ["description"]);
  if (fromDescription != null) {
    setValueByPath(toObject, ["description"], fromDescription);
  }
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromParameters = getValueByPath(fromObject, ["parameters"]);
  if (fromParameters != null) {
    setValueByPath(toObject, ["parameters"], fromParameters);
  }
  const fromParametersJsonSchema = getValueByPath(fromObject, [
    "parametersJsonSchema"
  ]);
  if (fromParametersJsonSchema != null) {
    setValueByPath(toObject, ["parametersJsonSchema"], fromParametersJsonSchema);
  }
  const fromResponse = getValueByPath(fromObject, ["response"]);
  if (fromResponse != null) {
    setValueByPath(toObject, ["response"], fromResponse);
  }
  const fromResponseJsonSchema = getValueByPath(fromObject, [
    "responseJsonSchema"
  ]);
  if (fromResponseJsonSchema != null) {
    setValueByPath(toObject, ["responseJsonSchema"], fromResponseJsonSchema);
  }
  return toObject;
}
function generateContentConfigToMldev(apiClient, fromObject, parentObject) {
  const toObject = {};
  const fromSystemInstruction = getValueByPath(fromObject, [
    "systemInstruction"
  ]);
  if (parentObject !== void 0 && fromSystemInstruction != null) {
    setValueByPath(parentObject, ["systemInstruction"], contentToMldev$1(tContent(fromSystemInstruction)));
  }
  const fromTemperature = getValueByPath(fromObject, ["temperature"]);
  if (fromTemperature != null) {
    setValueByPath(toObject, ["temperature"], fromTemperature);
  }
  const fromTopP = getValueByPath(fromObject, ["topP"]);
  if (fromTopP != null) {
    setValueByPath(toObject, ["topP"], fromTopP);
  }
  const fromTopK = getValueByPath(fromObject, ["topK"]);
  if (fromTopK != null) {
    setValueByPath(toObject, ["topK"], fromTopK);
  }
  const fromCandidateCount = getValueByPath(fromObject, [
    "candidateCount"
  ]);
  if (fromCandidateCount != null) {
    setValueByPath(toObject, ["candidateCount"], fromCandidateCount);
  }
  const fromMaxOutputTokens = getValueByPath(fromObject, [
    "maxOutputTokens"
  ]);
  if (fromMaxOutputTokens != null) {
    setValueByPath(toObject, ["maxOutputTokens"], fromMaxOutputTokens);
  }
  const fromStopSequences = getValueByPath(fromObject, [
    "stopSequences"
  ]);
  if (fromStopSequences != null) {
    setValueByPath(toObject, ["stopSequences"], fromStopSequences);
  }
  const fromResponseLogprobs = getValueByPath(fromObject, [
    "responseLogprobs"
  ]);
  if (fromResponseLogprobs != null) {
    setValueByPath(toObject, ["responseLogprobs"], fromResponseLogprobs);
  }
  const fromLogprobs = getValueByPath(fromObject, ["logprobs"]);
  if (fromLogprobs != null) {
    setValueByPath(toObject, ["logprobs"], fromLogprobs);
  }
  const fromPresencePenalty = getValueByPath(fromObject, [
    "presencePenalty"
  ]);
  if (fromPresencePenalty != null) {
    setValueByPath(toObject, ["presencePenalty"], fromPresencePenalty);
  }
  const fromFrequencyPenalty = getValueByPath(fromObject, [
    "frequencyPenalty"
  ]);
  if (fromFrequencyPenalty != null) {
    setValueByPath(toObject, ["frequencyPenalty"], fromFrequencyPenalty);
  }
  const fromSeed = getValueByPath(fromObject, ["seed"]);
  if (fromSeed != null) {
    setValueByPath(toObject, ["seed"], fromSeed);
  }
  const fromResponseMimeType = getValueByPath(fromObject, [
    "responseMimeType"
  ]);
  if (fromResponseMimeType != null) {
    setValueByPath(toObject, ["responseMimeType"], fromResponseMimeType);
  }
  const fromResponseSchema = getValueByPath(fromObject, [
    "responseSchema"
  ]);
  if (fromResponseSchema != null) {
    setValueByPath(toObject, ["responseSchema"], tSchema(fromResponseSchema));
  }
  const fromResponseJsonSchema = getValueByPath(fromObject, [
    "responseJsonSchema"
  ]);
  if (fromResponseJsonSchema != null) {
    setValueByPath(toObject, ["responseJsonSchema"], fromResponseJsonSchema);
  }
  if (getValueByPath(fromObject, ["routingConfig"]) !== void 0) {
    throw new Error("routingConfig parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["modelSelectionConfig"]) !== void 0) {
    throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");
  }
  const fromSafetySettings = getValueByPath(fromObject, [
    "safetySettings"
  ]);
  if (parentObject !== void 0 && fromSafetySettings != null) {
    let transformedList = fromSafetySettings;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return safetySettingToMldev(item);
      });
    }
    setValueByPath(parentObject, ["safetySettings"], transformedList);
  }
  const fromTools = getValueByPath(fromObject, ["tools"]);
  if (parentObject !== void 0 && fromTools != null) {
    let transformedList = tTools(fromTools);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return toolToMldev$1(tTool(item));
      });
    }
    setValueByPath(parentObject, ["tools"], transformedList);
  }
  const fromToolConfig = getValueByPath(fromObject, ["toolConfig"]);
  if (parentObject !== void 0 && fromToolConfig != null) {
    setValueByPath(parentObject, ["toolConfig"], toolConfigToMldev(fromToolConfig));
  }
  if (getValueByPath(fromObject, ["labels"]) !== void 0) {
    throw new Error("labels parameter is not supported in Gemini API.");
  }
  const fromCachedContent = getValueByPath(fromObject, [
    "cachedContent"
  ]);
  if (parentObject !== void 0 && fromCachedContent != null) {
    setValueByPath(parentObject, ["cachedContent"], tCachedContentName(apiClient, fromCachedContent));
  }
  const fromResponseModalities = getValueByPath(fromObject, [
    "responseModalities"
  ]);
  if (fromResponseModalities != null) {
    setValueByPath(toObject, ["responseModalities"], fromResponseModalities);
  }
  const fromMediaResolution = getValueByPath(fromObject, [
    "mediaResolution"
  ]);
  if (fromMediaResolution != null) {
    setValueByPath(toObject, ["mediaResolution"], fromMediaResolution);
  }
  const fromSpeechConfig = getValueByPath(fromObject, ["speechConfig"]);
  if (fromSpeechConfig != null) {
    setValueByPath(toObject, ["speechConfig"], tSpeechConfig(fromSpeechConfig));
  }
  if (getValueByPath(fromObject, ["audioTimestamp"]) !== void 0) {
    throw new Error("audioTimestamp parameter is not supported in Gemini API.");
  }
  const fromThinkingConfig = getValueByPath(fromObject, [
    "thinkingConfig"
  ]);
  if (fromThinkingConfig != null) {
    setValueByPath(toObject, ["thinkingConfig"], fromThinkingConfig);
  }
  const fromImageConfig = getValueByPath(fromObject, ["imageConfig"]);
  if (fromImageConfig != null) {
    setValueByPath(toObject, ["imageConfig"], imageConfigToMldev(fromImageConfig));
  }
  const fromEnableEnhancedCivicAnswers = getValueByPath(fromObject, [
    "enableEnhancedCivicAnswers"
  ]);
  if (fromEnableEnhancedCivicAnswers != null) {
    setValueByPath(toObject, ["enableEnhancedCivicAnswers"], fromEnableEnhancedCivicAnswers);
  }
  return toObject;
}
function generateContentConfigToVertex(apiClient, fromObject, parentObject) {
  const toObject = {};
  const fromSystemInstruction = getValueByPath(fromObject, [
    "systemInstruction"
  ]);
  if (parentObject !== void 0 && fromSystemInstruction != null) {
    setValueByPath(parentObject, ["systemInstruction"], tContent(fromSystemInstruction));
  }
  const fromTemperature = getValueByPath(fromObject, ["temperature"]);
  if (fromTemperature != null) {
    setValueByPath(toObject, ["temperature"], fromTemperature);
  }
  const fromTopP = getValueByPath(fromObject, ["topP"]);
  if (fromTopP != null) {
    setValueByPath(toObject, ["topP"], fromTopP);
  }
  const fromTopK = getValueByPath(fromObject, ["topK"]);
  if (fromTopK != null) {
    setValueByPath(toObject, ["topK"], fromTopK);
  }
  const fromCandidateCount = getValueByPath(fromObject, [
    "candidateCount"
  ]);
  if (fromCandidateCount != null) {
    setValueByPath(toObject, ["candidateCount"], fromCandidateCount);
  }
  const fromMaxOutputTokens = getValueByPath(fromObject, [
    "maxOutputTokens"
  ]);
  if (fromMaxOutputTokens != null) {
    setValueByPath(toObject, ["maxOutputTokens"], fromMaxOutputTokens);
  }
  const fromStopSequences = getValueByPath(fromObject, [
    "stopSequences"
  ]);
  if (fromStopSequences != null) {
    setValueByPath(toObject, ["stopSequences"], fromStopSequences);
  }
  const fromResponseLogprobs = getValueByPath(fromObject, [
    "responseLogprobs"
  ]);
  if (fromResponseLogprobs != null) {
    setValueByPath(toObject, ["responseLogprobs"], fromResponseLogprobs);
  }
  const fromLogprobs = getValueByPath(fromObject, ["logprobs"]);
  if (fromLogprobs != null) {
    setValueByPath(toObject, ["logprobs"], fromLogprobs);
  }
  const fromPresencePenalty = getValueByPath(fromObject, [
    "presencePenalty"
  ]);
  if (fromPresencePenalty != null) {
    setValueByPath(toObject, ["presencePenalty"], fromPresencePenalty);
  }
  const fromFrequencyPenalty = getValueByPath(fromObject, [
    "frequencyPenalty"
  ]);
  if (fromFrequencyPenalty != null) {
    setValueByPath(toObject, ["frequencyPenalty"], fromFrequencyPenalty);
  }
  const fromSeed = getValueByPath(fromObject, ["seed"]);
  if (fromSeed != null) {
    setValueByPath(toObject, ["seed"], fromSeed);
  }
  const fromResponseMimeType = getValueByPath(fromObject, [
    "responseMimeType"
  ]);
  if (fromResponseMimeType != null) {
    setValueByPath(toObject, ["responseMimeType"], fromResponseMimeType);
  }
  const fromResponseSchema = getValueByPath(fromObject, [
    "responseSchema"
  ]);
  if (fromResponseSchema != null) {
    setValueByPath(toObject, ["responseSchema"], tSchema(fromResponseSchema));
  }
  const fromResponseJsonSchema = getValueByPath(fromObject, [
    "responseJsonSchema"
  ]);
  if (fromResponseJsonSchema != null) {
    setValueByPath(toObject, ["responseJsonSchema"], fromResponseJsonSchema);
  }
  const fromRoutingConfig = getValueByPath(fromObject, [
    "routingConfig"
  ]);
  if (fromRoutingConfig != null) {
    setValueByPath(toObject, ["routingConfig"], fromRoutingConfig);
  }
  const fromModelSelectionConfig = getValueByPath(fromObject, [
    "modelSelectionConfig"
  ]);
  if (fromModelSelectionConfig != null) {
    setValueByPath(toObject, ["modelConfig"], fromModelSelectionConfig);
  }
  const fromSafetySettings = getValueByPath(fromObject, [
    "safetySettings"
  ]);
  if (parentObject !== void 0 && fromSafetySettings != null) {
    let transformedList = fromSafetySettings;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(parentObject, ["safetySettings"], transformedList);
  }
  const fromTools = getValueByPath(fromObject, ["tools"]);
  if (parentObject !== void 0 && fromTools != null) {
    let transformedList = tTools(fromTools);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return toolToVertex(tTool(item));
      });
    }
    setValueByPath(parentObject, ["tools"], transformedList);
  }
  const fromToolConfig = getValueByPath(fromObject, ["toolConfig"]);
  if (parentObject !== void 0 && fromToolConfig != null) {
    setValueByPath(parentObject, ["toolConfig"], fromToolConfig);
  }
  const fromLabels = getValueByPath(fromObject, ["labels"]);
  if (parentObject !== void 0 && fromLabels != null) {
    setValueByPath(parentObject, ["labels"], fromLabels);
  }
  const fromCachedContent = getValueByPath(fromObject, [
    "cachedContent"
  ]);
  if (parentObject !== void 0 && fromCachedContent != null) {
    setValueByPath(parentObject, ["cachedContent"], tCachedContentName(apiClient, fromCachedContent));
  }
  const fromResponseModalities = getValueByPath(fromObject, [
    "responseModalities"
  ]);
  if (fromResponseModalities != null) {
    setValueByPath(toObject, ["responseModalities"], fromResponseModalities);
  }
  const fromMediaResolution = getValueByPath(fromObject, [
    "mediaResolution"
  ]);
  if (fromMediaResolution != null) {
    setValueByPath(toObject, ["mediaResolution"], fromMediaResolution);
  }
  const fromSpeechConfig = getValueByPath(fromObject, ["speechConfig"]);
  if (fromSpeechConfig != null) {
    setValueByPath(toObject, ["speechConfig"], tSpeechConfig(fromSpeechConfig));
  }
  const fromAudioTimestamp = getValueByPath(fromObject, [
    "audioTimestamp"
  ]);
  if (fromAudioTimestamp != null) {
    setValueByPath(toObject, ["audioTimestamp"], fromAudioTimestamp);
  }
  const fromThinkingConfig = getValueByPath(fromObject, [
    "thinkingConfig"
  ]);
  if (fromThinkingConfig != null) {
    setValueByPath(toObject, ["thinkingConfig"], fromThinkingConfig);
  }
  const fromImageConfig = getValueByPath(fromObject, ["imageConfig"]);
  if (fromImageConfig != null) {
    setValueByPath(toObject, ["imageConfig"], imageConfigToVertex(fromImageConfig));
  }
  if (getValueByPath(fromObject, ["enableEnhancedCivicAnswers"]) !== void 0) {
    throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");
  }
  return toObject;
}
function generateContentParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromContents = getValueByPath(fromObject, ["contents"]);
  if (fromContents != null) {
    let transformedList = tContents(fromContents);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return contentToMldev$1(item);
      });
    }
    setValueByPath(toObject, ["contents"], transformedList);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    setValueByPath(toObject, ["generationConfig"], generateContentConfigToMldev(apiClient, fromConfig, toObject));
  }
  return toObject;
}
function generateContentParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromContents = getValueByPath(fromObject, ["contents"]);
  if (fromContents != null) {
    let transformedList = tContents(fromContents);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["contents"], transformedList);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    setValueByPath(toObject, ["generationConfig"], generateContentConfigToVertex(apiClient, fromConfig, toObject));
  }
  return toObject;
}
function generateContentResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromCandidates = getValueByPath(fromObject, ["candidates"]);
  if (fromCandidates != null) {
    let transformedList = fromCandidates;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return candidateFromMldev(item);
      });
    }
    setValueByPath(toObject, ["candidates"], transformedList);
  }
  const fromModelVersion = getValueByPath(fromObject, ["modelVersion"]);
  if (fromModelVersion != null) {
    setValueByPath(toObject, ["modelVersion"], fromModelVersion);
  }
  const fromPromptFeedback = getValueByPath(fromObject, [
    "promptFeedback"
  ]);
  if (fromPromptFeedback != null) {
    setValueByPath(toObject, ["promptFeedback"], fromPromptFeedback);
  }
  const fromResponseId = getValueByPath(fromObject, ["responseId"]);
  if (fromResponseId != null) {
    setValueByPath(toObject, ["responseId"], fromResponseId);
  }
  const fromUsageMetadata = getValueByPath(fromObject, [
    "usageMetadata"
  ]);
  if (fromUsageMetadata != null) {
    setValueByPath(toObject, ["usageMetadata"], fromUsageMetadata);
  }
  return toObject;
}
function generateContentResponseFromVertex(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromCandidates = getValueByPath(fromObject, ["candidates"]);
  if (fromCandidates != null) {
    let transformedList = fromCandidates;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["candidates"], transformedList);
  }
  const fromCreateTime = getValueByPath(fromObject, ["createTime"]);
  if (fromCreateTime != null) {
    setValueByPath(toObject, ["createTime"], fromCreateTime);
  }
  const fromModelVersion = getValueByPath(fromObject, ["modelVersion"]);
  if (fromModelVersion != null) {
    setValueByPath(toObject, ["modelVersion"], fromModelVersion);
  }
  const fromPromptFeedback = getValueByPath(fromObject, [
    "promptFeedback"
  ]);
  if (fromPromptFeedback != null) {
    setValueByPath(toObject, ["promptFeedback"], fromPromptFeedback);
  }
  const fromResponseId = getValueByPath(fromObject, ["responseId"]);
  if (fromResponseId != null) {
    setValueByPath(toObject, ["responseId"], fromResponseId);
  }
  const fromUsageMetadata = getValueByPath(fromObject, [
    "usageMetadata"
  ]);
  if (fromUsageMetadata != null) {
    setValueByPath(toObject, ["usageMetadata"], fromUsageMetadata);
  }
  return toObject;
}
function generateImagesConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["outputGcsUri"]) !== void 0) {
    throw new Error("outputGcsUri parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["negativePrompt"]) !== void 0) {
    throw new Error("negativePrompt parameter is not supported in Gemini API.");
  }
  const fromNumberOfImages = getValueByPath(fromObject, [
    "numberOfImages"
  ]);
  if (parentObject !== void 0 && fromNumberOfImages != null) {
    setValueByPath(parentObject, ["parameters", "sampleCount"], fromNumberOfImages);
  }
  const fromAspectRatio = getValueByPath(fromObject, ["aspectRatio"]);
  if (parentObject !== void 0 && fromAspectRatio != null) {
    setValueByPath(parentObject, ["parameters", "aspectRatio"], fromAspectRatio);
  }
  const fromGuidanceScale = getValueByPath(fromObject, [
    "guidanceScale"
  ]);
  if (parentObject !== void 0 && fromGuidanceScale != null) {
    setValueByPath(parentObject, ["parameters", "guidanceScale"], fromGuidanceScale);
  }
  if (getValueByPath(fromObject, ["seed"]) !== void 0) {
    throw new Error("seed parameter is not supported in Gemini API.");
  }
  const fromSafetyFilterLevel = getValueByPath(fromObject, [
    "safetyFilterLevel"
  ]);
  if (parentObject !== void 0 && fromSafetyFilterLevel != null) {
    setValueByPath(parentObject, ["parameters", "safetySetting"], fromSafetyFilterLevel);
  }
  const fromPersonGeneration = getValueByPath(fromObject, [
    "personGeneration"
  ]);
  if (parentObject !== void 0 && fromPersonGeneration != null) {
    setValueByPath(parentObject, ["parameters", "personGeneration"], fromPersonGeneration);
  }
  const fromIncludeSafetyAttributes = getValueByPath(fromObject, [
    "includeSafetyAttributes"
  ]);
  if (parentObject !== void 0 && fromIncludeSafetyAttributes != null) {
    setValueByPath(parentObject, ["parameters", "includeSafetyAttributes"], fromIncludeSafetyAttributes);
  }
  const fromIncludeRaiReason = getValueByPath(fromObject, [
    "includeRaiReason"
  ]);
  if (parentObject !== void 0 && fromIncludeRaiReason != null) {
    setValueByPath(parentObject, ["parameters", "includeRaiReason"], fromIncludeRaiReason);
  }
  const fromLanguage = getValueByPath(fromObject, ["language"]);
  if (parentObject !== void 0 && fromLanguage != null) {
    setValueByPath(parentObject, ["parameters", "language"], fromLanguage);
  }
  const fromOutputMimeType = getValueByPath(fromObject, [
    "outputMimeType"
  ]);
  if (parentObject !== void 0 && fromOutputMimeType != null) {
    setValueByPath(parentObject, ["parameters", "outputOptions", "mimeType"], fromOutputMimeType);
  }
  const fromOutputCompressionQuality = getValueByPath(fromObject, [
    "outputCompressionQuality"
  ]);
  if (parentObject !== void 0 && fromOutputCompressionQuality != null) {
    setValueByPath(parentObject, ["parameters", "outputOptions", "compressionQuality"], fromOutputCompressionQuality);
  }
  if (getValueByPath(fromObject, ["addWatermark"]) !== void 0) {
    throw new Error("addWatermark parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["labels"]) !== void 0) {
    throw new Error("labels parameter is not supported in Gemini API.");
  }
  const fromImageSize = getValueByPath(fromObject, ["imageSize"]);
  if (parentObject !== void 0 && fromImageSize != null) {
    setValueByPath(parentObject, ["parameters", "sampleImageSize"], fromImageSize);
  }
  if (getValueByPath(fromObject, ["enhancePrompt"]) !== void 0) {
    throw new Error("enhancePrompt parameter is not supported in Gemini API.");
  }
  return toObject;
}
function generateImagesConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromOutputGcsUri = getValueByPath(fromObject, ["outputGcsUri"]);
  if (parentObject !== void 0 && fromOutputGcsUri != null) {
    setValueByPath(parentObject, ["parameters", "storageUri"], fromOutputGcsUri);
  }
  const fromNegativePrompt = getValueByPath(fromObject, [
    "negativePrompt"
  ]);
  if (parentObject !== void 0 && fromNegativePrompt != null) {
    setValueByPath(parentObject, ["parameters", "negativePrompt"], fromNegativePrompt);
  }
  const fromNumberOfImages = getValueByPath(fromObject, [
    "numberOfImages"
  ]);
  if (parentObject !== void 0 && fromNumberOfImages != null) {
    setValueByPath(parentObject, ["parameters", "sampleCount"], fromNumberOfImages);
  }
  const fromAspectRatio = getValueByPath(fromObject, ["aspectRatio"]);
  if (parentObject !== void 0 && fromAspectRatio != null) {
    setValueByPath(parentObject, ["parameters", "aspectRatio"], fromAspectRatio);
  }
  const fromGuidanceScale = getValueByPath(fromObject, [
    "guidanceScale"
  ]);
  if (parentObject !== void 0 && fromGuidanceScale != null) {
    setValueByPath(parentObject, ["parameters", "guidanceScale"], fromGuidanceScale);
  }
  const fromSeed = getValueByPath(fromObject, ["seed"]);
  if (parentObject !== void 0 && fromSeed != null) {
    setValueByPath(parentObject, ["parameters", "seed"], fromSeed);
  }
  const fromSafetyFilterLevel = getValueByPath(fromObject, [
    "safetyFilterLevel"
  ]);
  if (parentObject !== void 0 && fromSafetyFilterLevel != null) {
    setValueByPath(parentObject, ["parameters", "safetySetting"], fromSafetyFilterLevel);
  }
  const fromPersonGeneration = getValueByPath(fromObject, [
    "personGeneration"
  ]);
  if (parentObject !== void 0 && fromPersonGeneration != null) {
    setValueByPath(parentObject, ["parameters", "personGeneration"], fromPersonGeneration);
  }
  const fromIncludeSafetyAttributes = getValueByPath(fromObject, [
    "includeSafetyAttributes"
  ]);
  if (parentObject !== void 0 && fromIncludeSafetyAttributes != null) {
    setValueByPath(parentObject, ["parameters", "includeSafetyAttributes"], fromIncludeSafetyAttributes);
  }
  const fromIncludeRaiReason = getValueByPath(fromObject, [
    "includeRaiReason"
  ]);
  if (parentObject !== void 0 && fromIncludeRaiReason != null) {
    setValueByPath(parentObject, ["parameters", "includeRaiReason"], fromIncludeRaiReason);
  }
  const fromLanguage = getValueByPath(fromObject, ["language"]);
  if (parentObject !== void 0 && fromLanguage != null) {
    setValueByPath(parentObject, ["parameters", "language"], fromLanguage);
  }
  const fromOutputMimeType = getValueByPath(fromObject, [
    "outputMimeType"
  ]);
  if (parentObject !== void 0 && fromOutputMimeType != null) {
    setValueByPath(parentObject, ["parameters", "outputOptions", "mimeType"], fromOutputMimeType);
  }
  const fromOutputCompressionQuality = getValueByPath(fromObject, [
    "outputCompressionQuality"
  ]);
  if (parentObject !== void 0 && fromOutputCompressionQuality != null) {
    setValueByPath(parentObject, ["parameters", "outputOptions", "compressionQuality"], fromOutputCompressionQuality);
  }
  const fromAddWatermark = getValueByPath(fromObject, ["addWatermark"]);
  if (parentObject !== void 0 && fromAddWatermark != null) {
    setValueByPath(parentObject, ["parameters", "addWatermark"], fromAddWatermark);
  }
  const fromLabels = getValueByPath(fromObject, ["labels"]);
  if (parentObject !== void 0 && fromLabels != null) {
    setValueByPath(parentObject, ["labels"], fromLabels);
  }
  const fromImageSize = getValueByPath(fromObject, ["imageSize"]);
  if (parentObject !== void 0 && fromImageSize != null) {
    setValueByPath(parentObject, ["parameters", "sampleImageSize"], fromImageSize);
  }
  const fromEnhancePrompt = getValueByPath(fromObject, [
    "enhancePrompt"
  ]);
  if (parentObject !== void 0 && fromEnhancePrompt != null) {
    setValueByPath(parentObject, ["parameters", "enhancePrompt"], fromEnhancePrompt);
  }
  return toObject;
}
function generateImagesParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromPrompt = getValueByPath(fromObject, ["prompt"]);
  if (fromPrompt != null) {
    setValueByPath(toObject, ["instances[0]", "prompt"], fromPrompt);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    generateImagesConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function generateImagesParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromPrompt = getValueByPath(fromObject, ["prompt"]);
  if (fromPrompt != null) {
    setValueByPath(toObject, ["instances[0]", "prompt"], fromPrompt);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    generateImagesConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
function generateImagesResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromGeneratedImages = getValueByPath(fromObject, [
    "predictions"
  ]);
  if (fromGeneratedImages != null) {
    let transformedList = fromGeneratedImages;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return generatedImageFromMldev(item);
      });
    }
    setValueByPath(toObject, ["generatedImages"], transformedList);
  }
  const fromPositivePromptSafetyAttributes = getValueByPath(fromObject, [
    "positivePromptSafetyAttributes"
  ]);
  if (fromPositivePromptSafetyAttributes != null) {
    setValueByPath(toObject, ["positivePromptSafetyAttributes"], safetyAttributesFromMldev(fromPositivePromptSafetyAttributes));
  }
  return toObject;
}
function generateImagesResponseFromVertex(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromGeneratedImages = getValueByPath(fromObject, [
    "predictions"
  ]);
  if (fromGeneratedImages != null) {
    let transformedList = fromGeneratedImages;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return generatedImageFromVertex(item);
      });
    }
    setValueByPath(toObject, ["generatedImages"], transformedList);
  }
  const fromPositivePromptSafetyAttributes = getValueByPath(fromObject, [
    "positivePromptSafetyAttributes"
  ]);
  if (fromPositivePromptSafetyAttributes != null) {
    setValueByPath(toObject, ["positivePromptSafetyAttributes"], safetyAttributesFromVertex(fromPositivePromptSafetyAttributes));
  }
  return toObject;
}
function generateVideosConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromNumberOfVideos = getValueByPath(fromObject, [
    "numberOfVideos"
  ]);
  if (parentObject !== void 0 && fromNumberOfVideos != null) {
    setValueByPath(parentObject, ["parameters", "sampleCount"], fromNumberOfVideos);
  }
  if (getValueByPath(fromObject, ["outputGcsUri"]) !== void 0) {
    throw new Error("outputGcsUri parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["fps"]) !== void 0) {
    throw new Error("fps parameter is not supported in Gemini API.");
  }
  const fromDurationSeconds = getValueByPath(fromObject, [
    "durationSeconds"
  ]);
  if (parentObject !== void 0 && fromDurationSeconds != null) {
    setValueByPath(parentObject, ["parameters", "durationSeconds"], fromDurationSeconds);
  }
  if (getValueByPath(fromObject, ["seed"]) !== void 0) {
    throw new Error("seed parameter is not supported in Gemini API.");
  }
  const fromAspectRatio = getValueByPath(fromObject, ["aspectRatio"]);
  if (parentObject !== void 0 && fromAspectRatio != null) {
    setValueByPath(parentObject, ["parameters", "aspectRatio"], fromAspectRatio);
  }
  const fromResolution = getValueByPath(fromObject, ["resolution"]);
  if (parentObject !== void 0 && fromResolution != null) {
    setValueByPath(parentObject, ["parameters", "resolution"], fromResolution);
  }
  const fromPersonGeneration = getValueByPath(fromObject, [
    "personGeneration"
  ]);
  if (parentObject !== void 0 && fromPersonGeneration != null) {
    setValueByPath(parentObject, ["parameters", "personGeneration"], fromPersonGeneration);
  }
  if (getValueByPath(fromObject, ["pubsubTopic"]) !== void 0) {
    throw new Error("pubsubTopic parameter is not supported in Gemini API.");
  }
  const fromNegativePrompt = getValueByPath(fromObject, [
    "negativePrompt"
  ]);
  if (parentObject !== void 0 && fromNegativePrompt != null) {
    setValueByPath(parentObject, ["parameters", "negativePrompt"], fromNegativePrompt);
  }
  const fromEnhancePrompt = getValueByPath(fromObject, [
    "enhancePrompt"
  ]);
  if (parentObject !== void 0 && fromEnhancePrompt != null) {
    setValueByPath(parentObject, ["parameters", "enhancePrompt"], fromEnhancePrompt);
  }
  if (getValueByPath(fromObject, ["generateAudio"]) !== void 0) {
    throw new Error("generateAudio parameter is not supported in Gemini API.");
  }
  const fromLastFrame = getValueByPath(fromObject, ["lastFrame"]);
  if (parentObject !== void 0 && fromLastFrame != null) {
    setValueByPath(parentObject, ["instances[0]", "lastFrame"], imageToMldev(fromLastFrame));
  }
  const fromReferenceImages = getValueByPath(fromObject, [
    "referenceImages"
  ]);
  if (parentObject !== void 0 && fromReferenceImages != null) {
    let transformedList = fromReferenceImages;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return videoGenerationReferenceImageToMldev(item);
      });
    }
    setValueByPath(parentObject, ["instances[0]", "referenceImages"], transformedList);
  }
  if (getValueByPath(fromObject, ["mask"]) !== void 0) {
    throw new Error("mask parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["compressionQuality"]) !== void 0) {
    throw new Error("compressionQuality parameter is not supported in Gemini API.");
  }
  return toObject;
}
function generateVideosConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromNumberOfVideos = getValueByPath(fromObject, [
    "numberOfVideos"
  ]);
  if (parentObject !== void 0 && fromNumberOfVideos != null) {
    setValueByPath(parentObject, ["parameters", "sampleCount"], fromNumberOfVideos);
  }
  const fromOutputGcsUri = getValueByPath(fromObject, ["outputGcsUri"]);
  if (parentObject !== void 0 && fromOutputGcsUri != null) {
    setValueByPath(parentObject, ["parameters", "storageUri"], fromOutputGcsUri);
  }
  const fromFps = getValueByPath(fromObject, ["fps"]);
  if (parentObject !== void 0 && fromFps != null) {
    setValueByPath(parentObject, ["parameters", "fps"], fromFps);
  }
  const fromDurationSeconds = getValueByPath(fromObject, [
    "durationSeconds"
  ]);
  if (parentObject !== void 0 && fromDurationSeconds != null) {
    setValueByPath(parentObject, ["parameters", "durationSeconds"], fromDurationSeconds);
  }
  const fromSeed = getValueByPath(fromObject, ["seed"]);
  if (parentObject !== void 0 && fromSeed != null) {
    setValueByPath(parentObject, ["parameters", "seed"], fromSeed);
  }
  const fromAspectRatio = getValueByPath(fromObject, ["aspectRatio"]);
  if (parentObject !== void 0 && fromAspectRatio != null) {
    setValueByPath(parentObject, ["parameters", "aspectRatio"], fromAspectRatio);
  }
  const fromResolution = getValueByPath(fromObject, ["resolution"]);
  if (parentObject !== void 0 && fromResolution != null) {
    setValueByPath(parentObject, ["parameters", "resolution"], fromResolution);
  }
  const fromPersonGeneration = getValueByPath(fromObject, [
    "personGeneration"
  ]);
  if (parentObject !== void 0 && fromPersonGeneration != null) {
    setValueByPath(parentObject, ["parameters", "personGeneration"], fromPersonGeneration);
  }
  const fromPubsubTopic = getValueByPath(fromObject, ["pubsubTopic"]);
  if (parentObject !== void 0 && fromPubsubTopic != null) {
    setValueByPath(parentObject, ["parameters", "pubsubTopic"], fromPubsubTopic);
  }
  const fromNegativePrompt = getValueByPath(fromObject, [
    "negativePrompt"
  ]);
  if (parentObject !== void 0 && fromNegativePrompt != null) {
    setValueByPath(parentObject, ["parameters", "negativePrompt"], fromNegativePrompt);
  }
  const fromEnhancePrompt = getValueByPath(fromObject, [
    "enhancePrompt"
  ]);
  if (parentObject !== void 0 && fromEnhancePrompt != null) {
    setValueByPath(parentObject, ["parameters", "enhancePrompt"], fromEnhancePrompt);
  }
  const fromGenerateAudio = getValueByPath(fromObject, [
    "generateAudio"
  ]);
  if (parentObject !== void 0 && fromGenerateAudio != null) {
    setValueByPath(parentObject, ["parameters", "generateAudio"], fromGenerateAudio);
  }
  const fromLastFrame = getValueByPath(fromObject, ["lastFrame"]);
  if (parentObject !== void 0 && fromLastFrame != null) {
    setValueByPath(parentObject, ["instances[0]", "lastFrame"], imageToVertex(fromLastFrame));
  }
  const fromReferenceImages = getValueByPath(fromObject, [
    "referenceImages"
  ]);
  if (parentObject !== void 0 && fromReferenceImages != null) {
    let transformedList = fromReferenceImages;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return videoGenerationReferenceImageToVertex(item);
      });
    }
    setValueByPath(parentObject, ["instances[0]", "referenceImages"], transformedList);
  }
  const fromMask = getValueByPath(fromObject, ["mask"]);
  if (parentObject !== void 0 && fromMask != null) {
    setValueByPath(parentObject, ["instances[0]", "mask"], videoGenerationMaskToVertex(fromMask));
  }
  const fromCompressionQuality = getValueByPath(fromObject, [
    "compressionQuality"
  ]);
  if (parentObject !== void 0 && fromCompressionQuality != null) {
    setValueByPath(parentObject, ["parameters", "compressionQuality"], fromCompressionQuality);
  }
  return toObject;
}
function generateVideosOperationFromMldev(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromMetadata = getValueByPath(fromObject, ["metadata"]);
  if (fromMetadata != null) {
    setValueByPath(toObject, ["metadata"], fromMetadata);
  }
  const fromDone = getValueByPath(fromObject, ["done"]);
  if (fromDone != null) {
    setValueByPath(toObject, ["done"], fromDone);
  }
  const fromError = getValueByPath(fromObject, ["error"]);
  if (fromError != null) {
    setValueByPath(toObject, ["error"], fromError);
  }
  const fromResponse = getValueByPath(fromObject, [
    "response",
    "generateVideoResponse"
  ]);
  if (fromResponse != null) {
    setValueByPath(toObject, ["response"], generateVideosResponseFromMldev(fromResponse));
  }
  return toObject;
}
function generateVideosOperationFromVertex(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromMetadata = getValueByPath(fromObject, ["metadata"]);
  if (fromMetadata != null) {
    setValueByPath(toObject, ["metadata"], fromMetadata);
  }
  const fromDone = getValueByPath(fromObject, ["done"]);
  if (fromDone != null) {
    setValueByPath(toObject, ["done"], fromDone);
  }
  const fromError = getValueByPath(fromObject, ["error"]);
  if (fromError != null) {
    setValueByPath(toObject, ["error"], fromError);
  }
  const fromResponse = getValueByPath(fromObject, ["response"]);
  if (fromResponse != null) {
    setValueByPath(toObject, ["response"], generateVideosResponseFromVertex(fromResponse));
  }
  return toObject;
}
function generateVideosParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromPrompt = getValueByPath(fromObject, ["prompt"]);
  if (fromPrompt != null) {
    setValueByPath(toObject, ["instances[0]", "prompt"], fromPrompt);
  }
  const fromImage = getValueByPath(fromObject, ["image"]);
  if (fromImage != null) {
    setValueByPath(toObject, ["instances[0]", "image"], imageToMldev(fromImage));
  }
  const fromVideo = getValueByPath(fromObject, ["video"]);
  if (fromVideo != null) {
    setValueByPath(toObject, ["instances[0]", "video"], videoToMldev(fromVideo));
  }
  const fromSource = getValueByPath(fromObject, ["source"]);
  if (fromSource != null) {
    generateVideosSourceToMldev(fromSource, toObject);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    generateVideosConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function generateVideosParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromPrompt = getValueByPath(fromObject, ["prompt"]);
  if (fromPrompt != null) {
    setValueByPath(toObject, ["instances[0]", "prompt"], fromPrompt);
  }
  const fromImage = getValueByPath(fromObject, ["image"]);
  if (fromImage != null) {
    setValueByPath(toObject, ["instances[0]", "image"], imageToVertex(fromImage));
  }
  const fromVideo = getValueByPath(fromObject, ["video"]);
  if (fromVideo != null) {
    setValueByPath(toObject, ["instances[0]", "video"], videoToVertex(fromVideo));
  }
  const fromSource = getValueByPath(fromObject, ["source"]);
  if (fromSource != null) {
    generateVideosSourceToVertex(fromSource, toObject);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    generateVideosConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
function generateVideosResponseFromMldev(fromObject) {
  const toObject = {};
  const fromGeneratedVideos = getValueByPath(fromObject, [
    "generatedSamples"
  ]);
  if (fromGeneratedVideos != null) {
    let transformedList = fromGeneratedVideos;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return generatedVideoFromMldev(item);
      });
    }
    setValueByPath(toObject, ["generatedVideos"], transformedList);
  }
  const fromRaiMediaFilteredCount = getValueByPath(fromObject, [
    "raiMediaFilteredCount"
  ]);
  if (fromRaiMediaFilteredCount != null) {
    setValueByPath(toObject, ["raiMediaFilteredCount"], fromRaiMediaFilteredCount);
  }
  const fromRaiMediaFilteredReasons = getValueByPath(fromObject, [
    "raiMediaFilteredReasons"
  ]);
  if (fromRaiMediaFilteredReasons != null) {
    setValueByPath(toObject, ["raiMediaFilteredReasons"], fromRaiMediaFilteredReasons);
  }
  return toObject;
}
function generateVideosResponseFromVertex(fromObject) {
  const toObject = {};
  const fromGeneratedVideos = getValueByPath(fromObject, ["videos"]);
  if (fromGeneratedVideos != null) {
    let transformedList = fromGeneratedVideos;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return generatedVideoFromVertex(item);
      });
    }
    setValueByPath(toObject, ["generatedVideos"], transformedList);
  }
  const fromRaiMediaFilteredCount = getValueByPath(fromObject, [
    "raiMediaFilteredCount"
  ]);
  if (fromRaiMediaFilteredCount != null) {
    setValueByPath(toObject, ["raiMediaFilteredCount"], fromRaiMediaFilteredCount);
  }
  const fromRaiMediaFilteredReasons = getValueByPath(fromObject, [
    "raiMediaFilteredReasons"
  ]);
  if (fromRaiMediaFilteredReasons != null) {
    setValueByPath(toObject, ["raiMediaFilteredReasons"], fromRaiMediaFilteredReasons);
  }
  return toObject;
}
function generateVideosSourceToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromPrompt = getValueByPath(fromObject, ["prompt"]);
  if (parentObject !== void 0 && fromPrompt != null) {
    setValueByPath(parentObject, ["instances[0]", "prompt"], fromPrompt);
  }
  const fromImage = getValueByPath(fromObject, ["image"]);
  if (parentObject !== void 0 && fromImage != null) {
    setValueByPath(parentObject, ["instances[0]", "image"], imageToMldev(fromImage));
  }
  const fromVideo = getValueByPath(fromObject, ["video"]);
  if (parentObject !== void 0 && fromVideo != null) {
    setValueByPath(parentObject, ["instances[0]", "video"], videoToMldev(fromVideo));
  }
  return toObject;
}
function generateVideosSourceToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromPrompt = getValueByPath(fromObject, ["prompt"]);
  if (parentObject !== void 0 && fromPrompt != null) {
    setValueByPath(parentObject, ["instances[0]", "prompt"], fromPrompt);
  }
  const fromImage = getValueByPath(fromObject, ["image"]);
  if (parentObject !== void 0 && fromImage != null) {
    setValueByPath(parentObject, ["instances[0]", "image"], imageToVertex(fromImage));
  }
  const fromVideo = getValueByPath(fromObject, ["video"]);
  if (parentObject !== void 0 && fromVideo != null) {
    setValueByPath(parentObject, ["instances[0]", "video"], videoToVertex(fromVideo));
  }
  return toObject;
}
function generatedImageFromMldev(fromObject) {
  const toObject = {};
  const fromImage = getValueByPath(fromObject, ["_self"]);
  if (fromImage != null) {
    setValueByPath(toObject, ["image"], imageFromMldev(fromImage));
  }
  const fromRaiFilteredReason = getValueByPath(fromObject, [
    "raiFilteredReason"
  ]);
  if (fromRaiFilteredReason != null) {
    setValueByPath(toObject, ["raiFilteredReason"], fromRaiFilteredReason);
  }
  const fromSafetyAttributes = getValueByPath(fromObject, ["_self"]);
  if (fromSafetyAttributes != null) {
    setValueByPath(toObject, ["safetyAttributes"], safetyAttributesFromMldev(fromSafetyAttributes));
  }
  return toObject;
}
function generatedImageFromVertex(fromObject) {
  const toObject = {};
  const fromImage = getValueByPath(fromObject, ["_self"]);
  if (fromImage != null) {
    setValueByPath(toObject, ["image"], imageFromVertex(fromImage));
  }
  const fromRaiFilteredReason = getValueByPath(fromObject, [
    "raiFilteredReason"
  ]);
  if (fromRaiFilteredReason != null) {
    setValueByPath(toObject, ["raiFilteredReason"], fromRaiFilteredReason);
  }
  const fromSafetyAttributes = getValueByPath(fromObject, ["_self"]);
  if (fromSafetyAttributes != null) {
    setValueByPath(toObject, ["safetyAttributes"], safetyAttributesFromVertex(fromSafetyAttributes));
  }
  const fromEnhancedPrompt = getValueByPath(fromObject, ["prompt"]);
  if (fromEnhancedPrompt != null) {
    setValueByPath(toObject, ["enhancedPrompt"], fromEnhancedPrompt);
  }
  return toObject;
}
function generatedImageMaskFromVertex(fromObject) {
  const toObject = {};
  const fromMask = getValueByPath(fromObject, ["_self"]);
  if (fromMask != null) {
    setValueByPath(toObject, ["mask"], imageFromVertex(fromMask));
  }
  const fromLabels = getValueByPath(fromObject, ["labels"]);
  if (fromLabels != null) {
    let transformedList = fromLabels;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["labels"], transformedList);
  }
  return toObject;
}
function generatedVideoFromMldev(fromObject) {
  const toObject = {};
  const fromVideo = getValueByPath(fromObject, ["video"]);
  if (fromVideo != null) {
    setValueByPath(toObject, ["video"], videoFromMldev(fromVideo));
  }
  return toObject;
}
function generatedVideoFromVertex(fromObject) {
  const toObject = {};
  const fromVideo = getValueByPath(fromObject, ["_self"]);
  if (fromVideo != null) {
    setValueByPath(toObject, ["video"], videoFromVertex(fromVideo));
  }
  return toObject;
}
function generationConfigToVertex(fromObject) {
  const toObject = {};
  const fromModelSelectionConfig = getValueByPath(fromObject, [
    "modelSelectionConfig"
  ]);
  if (fromModelSelectionConfig != null) {
    setValueByPath(toObject, ["modelConfig"], fromModelSelectionConfig);
  }
  const fromResponseJsonSchema = getValueByPath(fromObject, [
    "responseJsonSchema"
  ]);
  if (fromResponseJsonSchema != null) {
    setValueByPath(toObject, ["responseJsonSchema"], fromResponseJsonSchema);
  }
  const fromAudioTimestamp = getValueByPath(fromObject, [
    "audioTimestamp"
  ]);
  if (fromAudioTimestamp != null) {
    setValueByPath(toObject, ["audioTimestamp"], fromAudioTimestamp);
  }
  const fromCandidateCount = getValueByPath(fromObject, [
    "candidateCount"
  ]);
  if (fromCandidateCount != null) {
    setValueByPath(toObject, ["candidateCount"], fromCandidateCount);
  }
  const fromEnableAffectiveDialog = getValueByPath(fromObject, [
    "enableAffectiveDialog"
  ]);
  if (fromEnableAffectiveDialog != null) {
    setValueByPath(toObject, ["enableAffectiveDialog"], fromEnableAffectiveDialog);
  }
  const fromFrequencyPenalty = getValueByPath(fromObject, [
    "frequencyPenalty"
  ]);
  if (fromFrequencyPenalty != null) {
    setValueByPath(toObject, ["frequencyPenalty"], fromFrequencyPenalty);
  }
  const fromLogprobs = getValueByPath(fromObject, ["logprobs"]);
  if (fromLogprobs != null) {
    setValueByPath(toObject, ["logprobs"], fromLogprobs);
  }
  const fromMaxOutputTokens = getValueByPath(fromObject, [
    "maxOutputTokens"
  ]);
  if (fromMaxOutputTokens != null) {
    setValueByPath(toObject, ["maxOutputTokens"], fromMaxOutputTokens);
  }
  const fromMediaResolution = getValueByPath(fromObject, [
    "mediaResolution"
  ]);
  if (fromMediaResolution != null) {
    setValueByPath(toObject, ["mediaResolution"], fromMediaResolution);
  }
  const fromPresencePenalty = getValueByPath(fromObject, [
    "presencePenalty"
  ]);
  if (fromPresencePenalty != null) {
    setValueByPath(toObject, ["presencePenalty"], fromPresencePenalty);
  }
  const fromResponseLogprobs = getValueByPath(fromObject, [
    "responseLogprobs"
  ]);
  if (fromResponseLogprobs != null) {
    setValueByPath(toObject, ["responseLogprobs"], fromResponseLogprobs);
  }
  const fromResponseMimeType = getValueByPath(fromObject, [
    "responseMimeType"
  ]);
  if (fromResponseMimeType != null) {
    setValueByPath(toObject, ["responseMimeType"], fromResponseMimeType);
  }
  const fromResponseModalities = getValueByPath(fromObject, [
    "responseModalities"
  ]);
  if (fromResponseModalities != null) {
    setValueByPath(toObject, ["responseModalities"], fromResponseModalities);
  }
  const fromResponseSchema = getValueByPath(fromObject, [
    "responseSchema"
  ]);
  if (fromResponseSchema != null) {
    setValueByPath(toObject, ["responseSchema"], fromResponseSchema);
  }
  const fromRoutingConfig = getValueByPath(fromObject, [
    "routingConfig"
  ]);
  if (fromRoutingConfig != null) {
    setValueByPath(toObject, ["routingConfig"], fromRoutingConfig);
  }
  const fromSeed = getValueByPath(fromObject, ["seed"]);
  if (fromSeed != null) {
    setValueByPath(toObject, ["seed"], fromSeed);
  }
  const fromSpeechConfig = getValueByPath(fromObject, ["speechConfig"]);
  if (fromSpeechConfig != null) {
    setValueByPath(toObject, ["speechConfig"], fromSpeechConfig);
  }
  const fromStopSequences = getValueByPath(fromObject, [
    "stopSequences"
  ]);
  if (fromStopSequences != null) {
    setValueByPath(toObject, ["stopSequences"], fromStopSequences);
  }
  const fromTemperature = getValueByPath(fromObject, ["temperature"]);
  if (fromTemperature != null) {
    setValueByPath(toObject, ["temperature"], fromTemperature);
  }
  const fromThinkingConfig = getValueByPath(fromObject, [
    "thinkingConfig"
  ]);
  if (fromThinkingConfig != null) {
    setValueByPath(toObject, ["thinkingConfig"], fromThinkingConfig);
  }
  const fromTopK = getValueByPath(fromObject, ["topK"]);
  if (fromTopK != null) {
    setValueByPath(toObject, ["topK"], fromTopK);
  }
  const fromTopP = getValueByPath(fromObject, ["topP"]);
  if (fromTopP != null) {
    setValueByPath(toObject, ["topP"], fromTopP);
  }
  if (getValueByPath(fromObject, ["enableEnhancedCivicAnswers"]) !== void 0) {
    throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");
  }
  return toObject;
}
function getModelParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "name"], tModel(apiClient, fromModel));
  }
  return toObject;
}
function getModelParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "name"], tModel(apiClient, fromModel));
  }
  return toObject;
}
function googleMapsToMldev$1(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["authConfig"]) !== void 0) {
    throw new Error("authConfig parameter is not supported in Gemini API.");
  }
  const fromEnableWidget = getValueByPath(fromObject, ["enableWidget"]);
  if (fromEnableWidget != null) {
    setValueByPath(toObject, ["enableWidget"], fromEnableWidget);
  }
  return toObject;
}
function googleSearchToMldev$1(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["excludeDomains"]) !== void 0) {
    throw new Error("excludeDomains parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["blockingConfidence"]) !== void 0) {
    throw new Error("blockingConfidence parameter is not supported in Gemini API.");
  }
  const fromTimeRangeFilter = getValueByPath(fromObject, [
    "timeRangeFilter"
  ]);
  if (fromTimeRangeFilter != null) {
    setValueByPath(toObject, ["timeRangeFilter"], fromTimeRangeFilter);
  }
  return toObject;
}
function imageConfigToMldev(fromObject) {
  const toObject = {};
  const fromAspectRatio = getValueByPath(fromObject, ["aspectRatio"]);
  if (fromAspectRatio != null) {
    setValueByPath(toObject, ["aspectRatio"], fromAspectRatio);
  }
  const fromImageSize = getValueByPath(fromObject, ["imageSize"]);
  if (fromImageSize != null) {
    setValueByPath(toObject, ["imageSize"], fromImageSize);
  }
  if (getValueByPath(fromObject, ["outputMimeType"]) !== void 0) {
    throw new Error("outputMimeType parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["outputCompressionQuality"]) !== void 0) {
    throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");
  }
  return toObject;
}
function imageConfigToVertex(fromObject) {
  const toObject = {};
  const fromAspectRatio = getValueByPath(fromObject, ["aspectRatio"]);
  if (fromAspectRatio != null) {
    setValueByPath(toObject, ["aspectRatio"], fromAspectRatio);
  }
  const fromImageSize = getValueByPath(fromObject, ["imageSize"]);
  if (fromImageSize != null) {
    setValueByPath(toObject, ["imageSize"], fromImageSize);
  }
  const fromOutputMimeType = getValueByPath(fromObject, [
    "outputMimeType"
  ]);
  if (fromOutputMimeType != null) {
    setValueByPath(toObject, ["imageOutputOptions", "mimeType"], fromOutputMimeType);
  }
  const fromOutputCompressionQuality = getValueByPath(fromObject, [
    "outputCompressionQuality"
  ]);
  if (fromOutputCompressionQuality != null) {
    setValueByPath(toObject, ["imageOutputOptions", "compressionQuality"], fromOutputCompressionQuality);
  }
  return toObject;
}
function imageFromMldev(fromObject) {
  const toObject = {};
  const fromImageBytes = getValueByPath(fromObject, [
    "bytesBase64Encoded"
  ]);
  if (fromImageBytes != null) {
    setValueByPath(toObject, ["imageBytes"], tBytes(fromImageBytes));
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function imageFromVertex(fromObject) {
  const toObject = {};
  const fromGcsUri = getValueByPath(fromObject, ["gcsUri"]);
  if (fromGcsUri != null) {
    setValueByPath(toObject, ["gcsUri"], fromGcsUri);
  }
  const fromImageBytes = getValueByPath(fromObject, [
    "bytesBase64Encoded"
  ]);
  if (fromImageBytes != null) {
    setValueByPath(toObject, ["imageBytes"], tBytes(fromImageBytes));
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function imageToMldev(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["gcsUri"]) !== void 0) {
    throw new Error("gcsUri parameter is not supported in Gemini API.");
  }
  const fromImageBytes = getValueByPath(fromObject, ["imageBytes"]);
  if (fromImageBytes != null) {
    setValueByPath(toObject, ["bytesBase64Encoded"], tBytes(fromImageBytes));
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function imageToVertex(fromObject) {
  const toObject = {};
  const fromGcsUri = getValueByPath(fromObject, ["gcsUri"]);
  if (fromGcsUri != null) {
    setValueByPath(toObject, ["gcsUri"], fromGcsUri);
  }
  const fromImageBytes = getValueByPath(fromObject, ["imageBytes"]);
  if (fromImageBytes != null) {
    setValueByPath(toObject, ["bytesBase64Encoded"], tBytes(fromImageBytes));
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function listModelsConfigToMldev(apiClient, fromObject, parentObject) {
  const toObject = {};
  const fromPageSize = getValueByPath(fromObject, ["pageSize"]);
  if (parentObject !== void 0 && fromPageSize != null) {
    setValueByPath(parentObject, ["_query", "pageSize"], fromPageSize);
  }
  const fromPageToken = getValueByPath(fromObject, ["pageToken"]);
  if (parentObject !== void 0 && fromPageToken != null) {
    setValueByPath(parentObject, ["_query", "pageToken"], fromPageToken);
  }
  const fromFilter = getValueByPath(fromObject, ["filter"]);
  if (parentObject !== void 0 && fromFilter != null) {
    setValueByPath(parentObject, ["_query", "filter"], fromFilter);
  }
  const fromQueryBase = getValueByPath(fromObject, ["queryBase"]);
  if (parentObject !== void 0 && fromQueryBase != null) {
    setValueByPath(parentObject, ["_url", "models_url"], tModelsUrl(apiClient, fromQueryBase));
  }
  return toObject;
}
function listModelsConfigToVertex(apiClient, fromObject, parentObject) {
  const toObject = {};
  const fromPageSize = getValueByPath(fromObject, ["pageSize"]);
  if (parentObject !== void 0 && fromPageSize != null) {
    setValueByPath(parentObject, ["_query", "pageSize"], fromPageSize);
  }
  const fromPageToken = getValueByPath(fromObject, ["pageToken"]);
  if (parentObject !== void 0 && fromPageToken != null) {
    setValueByPath(parentObject, ["_query", "pageToken"], fromPageToken);
  }
  const fromFilter = getValueByPath(fromObject, ["filter"]);
  if (parentObject !== void 0 && fromFilter != null) {
    setValueByPath(parentObject, ["_query", "filter"], fromFilter);
  }
  const fromQueryBase = getValueByPath(fromObject, ["queryBase"]);
  if (parentObject !== void 0 && fromQueryBase != null) {
    setValueByPath(parentObject, ["_url", "models_url"], tModelsUrl(apiClient, fromQueryBase));
  }
  return toObject;
}
function listModelsParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    listModelsConfigToMldev(apiClient, fromConfig, toObject);
  }
  return toObject;
}
function listModelsParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    listModelsConfigToVertex(apiClient, fromConfig, toObject);
  }
  return toObject;
}
function listModelsResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromNextPageToken = getValueByPath(fromObject, [
    "nextPageToken"
  ]);
  if (fromNextPageToken != null) {
    setValueByPath(toObject, ["nextPageToken"], fromNextPageToken);
  }
  const fromModels = getValueByPath(fromObject, ["_self"]);
  if (fromModels != null) {
    let transformedList = tExtractModels(fromModels);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return modelFromMldev(item);
      });
    }
    setValueByPath(toObject, ["models"], transformedList);
  }
  return toObject;
}
function listModelsResponseFromVertex(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromNextPageToken = getValueByPath(fromObject, [
    "nextPageToken"
  ]);
  if (fromNextPageToken != null) {
    setValueByPath(toObject, ["nextPageToken"], fromNextPageToken);
  }
  const fromModels = getValueByPath(fromObject, ["_self"]);
  if (fromModels != null) {
    let transformedList = tExtractModels(fromModels);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return modelFromVertex(item);
      });
    }
    setValueByPath(toObject, ["models"], transformedList);
  }
  return toObject;
}
function maskReferenceConfigToVertex(fromObject) {
  const toObject = {};
  const fromMaskMode = getValueByPath(fromObject, ["maskMode"]);
  if (fromMaskMode != null) {
    setValueByPath(toObject, ["maskMode"], fromMaskMode);
  }
  const fromSegmentationClasses = getValueByPath(fromObject, [
    "segmentationClasses"
  ]);
  if (fromSegmentationClasses != null) {
    setValueByPath(toObject, ["maskClasses"], fromSegmentationClasses);
  }
  const fromMaskDilation = getValueByPath(fromObject, ["maskDilation"]);
  if (fromMaskDilation != null) {
    setValueByPath(toObject, ["dilation"], fromMaskDilation);
  }
  return toObject;
}
function modelFromMldev(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromDisplayName = getValueByPath(fromObject, ["displayName"]);
  if (fromDisplayName != null) {
    setValueByPath(toObject, ["displayName"], fromDisplayName);
  }
  const fromDescription = getValueByPath(fromObject, ["description"]);
  if (fromDescription != null) {
    setValueByPath(toObject, ["description"], fromDescription);
  }
  const fromVersion = getValueByPath(fromObject, ["version"]);
  if (fromVersion != null) {
    setValueByPath(toObject, ["version"], fromVersion);
  }
  const fromTunedModelInfo = getValueByPath(fromObject, ["_self"]);
  if (fromTunedModelInfo != null) {
    setValueByPath(toObject, ["tunedModelInfo"], tunedModelInfoFromMldev(fromTunedModelInfo));
  }
  const fromInputTokenLimit = getValueByPath(fromObject, [
    "inputTokenLimit"
  ]);
  if (fromInputTokenLimit != null) {
    setValueByPath(toObject, ["inputTokenLimit"], fromInputTokenLimit);
  }
  const fromOutputTokenLimit = getValueByPath(fromObject, [
    "outputTokenLimit"
  ]);
  if (fromOutputTokenLimit != null) {
    setValueByPath(toObject, ["outputTokenLimit"], fromOutputTokenLimit);
  }
  const fromSupportedActions = getValueByPath(fromObject, [
    "supportedGenerationMethods"
  ]);
  if (fromSupportedActions != null) {
    setValueByPath(toObject, ["supportedActions"], fromSupportedActions);
  }
  const fromTemperature = getValueByPath(fromObject, ["temperature"]);
  if (fromTemperature != null) {
    setValueByPath(toObject, ["temperature"], fromTemperature);
  }
  const fromMaxTemperature = getValueByPath(fromObject, [
    "maxTemperature"
  ]);
  if (fromMaxTemperature != null) {
    setValueByPath(toObject, ["maxTemperature"], fromMaxTemperature);
  }
  const fromTopP = getValueByPath(fromObject, ["topP"]);
  if (fromTopP != null) {
    setValueByPath(toObject, ["topP"], fromTopP);
  }
  const fromTopK = getValueByPath(fromObject, ["topK"]);
  if (fromTopK != null) {
    setValueByPath(toObject, ["topK"], fromTopK);
  }
  const fromThinking = getValueByPath(fromObject, ["thinking"]);
  if (fromThinking != null) {
    setValueByPath(toObject, ["thinking"], fromThinking);
  }
  return toObject;
}
function modelFromVertex(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromDisplayName = getValueByPath(fromObject, ["displayName"]);
  if (fromDisplayName != null) {
    setValueByPath(toObject, ["displayName"], fromDisplayName);
  }
  const fromDescription = getValueByPath(fromObject, ["description"]);
  if (fromDescription != null) {
    setValueByPath(toObject, ["description"], fromDescription);
  }
  const fromVersion = getValueByPath(fromObject, ["versionId"]);
  if (fromVersion != null) {
    setValueByPath(toObject, ["version"], fromVersion);
  }
  const fromEndpoints = getValueByPath(fromObject, ["deployedModels"]);
  if (fromEndpoints != null) {
    let transformedList = fromEndpoints;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return endpointFromVertex(item);
      });
    }
    setValueByPath(toObject, ["endpoints"], transformedList);
  }
  const fromLabels = getValueByPath(fromObject, ["labels"]);
  if (fromLabels != null) {
    setValueByPath(toObject, ["labels"], fromLabels);
  }
  const fromTunedModelInfo = getValueByPath(fromObject, ["_self"]);
  if (fromTunedModelInfo != null) {
    setValueByPath(toObject, ["tunedModelInfo"], tunedModelInfoFromVertex(fromTunedModelInfo));
  }
  const fromDefaultCheckpointId = getValueByPath(fromObject, [
    "defaultCheckpointId"
  ]);
  if (fromDefaultCheckpointId != null) {
    setValueByPath(toObject, ["defaultCheckpointId"], fromDefaultCheckpointId);
  }
  const fromCheckpoints = getValueByPath(fromObject, ["checkpoints"]);
  if (fromCheckpoints != null) {
    let transformedList = fromCheckpoints;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["checkpoints"], transformedList);
  }
  return toObject;
}
function partToMldev$1(fromObject) {
  const toObject = {};
  const fromMediaResolution = getValueByPath(fromObject, [
    "mediaResolution"
  ]);
  if (fromMediaResolution != null) {
    setValueByPath(toObject, ["mediaResolution"], fromMediaResolution);
  }
  const fromCodeExecutionResult = getValueByPath(fromObject, [
    "codeExecutionResult"
  ]);
  if (fromCodeExecutionResult != null) {
    setValueByPath(toObject, ["codeExecutionResult"], fromCodeExecutionResult);
  }
  const fromExecutableCode = getValueByPath(fromObject, [
    "executableCode"
  ]);
  if (fromExecutableCode != null) {
    setValueByPath(toObject, ["executableCode"], fromExecutableCode);
  }
  const fromFileData = getValueByPath(fromObject, ["fileData"]);
  if (fromFileData != null) {
    setValueByPath(toObject, ["fileData"], fileDataToMldev$1(fromFileData));
  }
  const fromFunctionCall = getValueByPath(fromObject, ["functionCall"]);
  if (fromFunctionCall != null) {
    setValueByPath(toObject, ["functionCall"], functionCallToMldev$1(fromFunctionCall));
  }
  const fromFunctionResponse = getValueByPath(fromObject, [
    "functionResponse"
  ]);
  if (fromFunctionResponse != null) {
    setValueByPath(toObject, ["functionResponse"], fromFunctionResponse);
  }
  const fromInlineData = getValueByPath(fromObject, ["inlineData"]);
  if (fromInlineData != null) {
    setValueByPath(toObject, ["inlineData"], blobToMldev$1(fromInlineData));
  }
  const fromText = getValueByPath(fromObject, ["text"]);
  if (fromText != null) {
    setValueByPath(toObject, ["text"], fromText);
  }
  const fromThought = getValueByPath(fromObject, ["thought"]);
  if (fromThought != null) {
    setValueByPath(toObject, ["thought"], fromThought);
  }
  const fromThoughtSignature = getValueByPath(fromObject, [
    "thoughtSignature"
  ]);
  if (fromThoughtSignature != null) {
    setValueByPath(toObject, ["thoughtSignature"], fromThoughtSignature);
  }
  const fromVideoMetadata = getValueByPath(fromObject, [
    "videoMetadata"
  ]);
  if (fromVideoMetadata != null) {
    setValueByPath(toObject, ["videoMetadata"], fromVideoMetadata);
  }
  return toObject;
}
function productImageToVertex(fromObject) {
  const toObject = {};
  const fromProductImage = getValueByPath(fromObject, ["productImage"]);
  if (fromProductImage != null) {
    setValueByPath(toObject, ["image"], imageToVertex(fromProductImage));
  }
  return toObject;
}
function recontextImageConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromNumberOfImages = getValueByPath(fromObject, [
    "numberOfImages"
  ]);
  if (parentObject !== void 0 && fromNumberOfImages != null) {
    setValueByPath(parentObject, ["parameters", "sampleCount"], fromNumberOfImages);
  }
  const fromBaseSteps = getValueByPath(fromObject, ["baseSteps"]);
  if (parentObject !== void 0 && fromBaseSteps != null) {
    setValueByPath(parentObject, ["parameters", "baseSteps"], fromBaseSteps);
  }
  const fromOutputGcsUri = getValueByPath(fromObject, ["outputGcsUri"]);
  if (parentObject !== void 0 && fromOutputGcsUri != null) {
    setValueByPath(parentObject, ["parameters", "storageUri"], fromOutputGcsUri);
  }
  const fromSeed = getValueByPath(fromObject, ["seed"]);
  if (parentObject !== void 0 && fromSeed != null) {
    setValueByPath(parentObject, ["parameters", "seed"], fromSeed);
  }
  const fromSafetyFilterLevel = getValueByPath(fromObject, [
    "safetyFilterLevel"
  ]);
  if (parentObject !== void 0 && fromSafetyFilterLevel != null) {
    setValueByPath(parentObject, ["parameters", "safetySetting"], fromSafetyFilterLevel);
  }
  const fromPersonGeneration = getValueByPath(fromObject, [
    "personGeneration"
  ]);
  if (parentObject !== void 0 && fromPersonGeneration != null) {
    setValueByPath(parentObject, ["parameters", "personGeneration"], fromPersonGeneration);
  }
  const fromAddWatermark = getValueByPath(fromObject, ["addWatermark"]);
  if (parentObject !== void 0 && fromAddWatermark != null) {
    setValueByPath(parentObject, ["parameters", "addWatermark"], fromAddWatermark);
  }
  const fromOutputMimeType = getValueByPath(fromObject, [
    "outputMimeType"
  ]);
  if (parentObject !== void 0 && fromOutputMimeType != null) {
    setValueByPath(parentObject, ["parameters", "outputOptions", "mimeType"], fromOutputMimeType);
  }
  const fromOutputCompressionQuality = getValueByPath(fromObject, [
    "outputCompressionQuality"
  ]);
  if (parentObject !== void 0 && fromOutputCompressionQuality != null) {
    setValueByPath(parentObject, ["parameters", "outputOptions", "compressionQuality"], fromOutputCompressionQuality);
  }
  const fromEnhancePrompt = getValueByPath(fromObject, [
    "enhancePrompt"
  ]);
  if (parentObject !== void 0 && fromEnhancePrompt != null) {
    setValueByPath(parentObject, ["parameters", "enhancePrompt"], fromEnhancePrompt);
  }
  const fromLabels = getValueByPath(fromObject, ["labels"]);
  if (parentObject !== void 0 && fromLabels != null) {
    setValueByPath(parentObject, ["labels"], fromLabels);
  }
  return toObject;
}
function recontextImageParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromSource = getValueByPath(fromObject, ["source"]);
  if (fromSource != null) {
    recontextImageSourceToVertex(fromSource, toObject);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    recontextImageConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
function recontextImageResponseFromVertex(fromObject) {
  const toObject = {};
  const fromGeneratedImages = getValueByPath(fromObject, [
    "predictions"
  ]);
  if (fromGeneratedImages != null) {
    let transformedList = fromGeneratedImages;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return generatedImageFromVertex(item);
      });
    }
    setValueByPath(toObject, ["generatedImages"], transformedList);
  }
  return toObject;
}
function recontextImageSourceToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromPrompt = getValueByPath(fromObject, ["prompt"]);
  if (parentObject !== void 0 && fromPrompt != null) {
    setValueByPath(parentObject, ["instances[0]", "prompt"], fromPrompt);
  }
  const fromPersonImage = getValueByPath(fromObject, ["personImage"]);
  if (parentObject !== void 0 && fromPersonImage != null) {
    setValueByPath(parentObject, ["instances[0]", "personImage", "image"], imageToVertex(fromPersonImage));
  }
  const fromProductImages = getValueByPath(fromObject, [
    "productImages"
  ]);
  if (parentObject !== void 0 && fromProductImages != null) {
    let transformedList = fromProductImages;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return productImageToVertex(item);
      });
    }
    setValueByPath(parentObject, ["instances[0]", "productImages"], transformedList);
  }
  return toObject;
}
function referenceImageAPIInternalToVertex(fromObject) {
  const toObject = {};
  const fromReferenceImage = getValueByPath(fromObject, [
    "referenceImage"
  ]);
  if (fromReferenceImage != null) {
    setValueByPath(toObject, ["referenceImage"], imageToVertex(fromReferenceImage));
  }
  const fromReferenceId = getValueByPath(fromObject, ["referenceId"]);
  if (fromReferenceId != null) {
    setValueByPath(toObject, ["referenceId"], fromReferenceId);
  }
  const fromReferenceType = getValueByPath(fromObject, [
    "referenceType"
  ]);
  if (fromReferenceType != null) {
    setValueByPath(toObject, ["referenceType"], fromReferenceType);
  }
  const fromMaskImageConfig = getValueByPath(fromObject, [
    "maskImageConfig"
  ]);
  if (fromMaskImageConfig != null) {
    setValueByPath(toObject, ["maskImageConfig"], maskReferenceConfigToVertex(fromMaskImageConfig));
  }
  const fromControlImageConfig = getValueByPath(fromObject, [
    "controlImageConfig"
  ]);
  if (fromControlImageConfig != null) {
    setValueByPath(toObject, ["controlImageConfig"], controlReferenceConfigToVertex(fromControlImageConfig));
  }
  const fromStyleImageConfig = getValueByPath(fromObject, [
    "styleImageConfig"
  ]);
  if (fromStyleImageConfig != null) {
    setValueByPath(toObject, ["styleImageConfig"], fromStyleImageConfig);
  }
  const fromSubjectImageConfig = getValueByPath(fromObject, [
    "subjectImageConfig"
  ]);
  if (fromSubjectImageConfig != null) {
    setValueByPath(toObject, ["subjectImageConfig"], fromSubjectImageConfig);
  }
  return toObject;
}
function safetyAttributesFromMldev(fromObject) {
  const toObject = {};
  const fromCategories = getValueByPath(fromObject, [
    "safetyAttributes",
    "categories"
  ]);
  if (fromCategories != null) {
    setValueByPath(toObject, ["categories"], fromCategories);
  }
  const fromScores = getValueByPath(fromObject, [
    "safetyAttributes",
    "scores"
  ]);
  if (fromScores != null) {
    setValueByPath(toObject, ["scores"], fromScores);
  }
  const fromContentType = getValueByPath(fromObject, ["contentType"]);
  if (fromContentType != null) {
    setValueByPath(toObject, ["contentType"], fromContentType);
  }
  return toObject;
}
function safetyAttributesFromVertex(fromObject) {
  const toObject = {};
  const fromCategories = getValueByPath(fromObject, [
    "safetyAttributes",
    "categories"
  ]);
  if (fromCategories != null) {
    setValueByPath(toObject, ["categories"], fromCategories);
  }
  const fromScores = getValueByPath(fromObject, [
    "safetyAttributes",
    "scores"
  ]);
  if (fromScores != null) {
    setValueByPath(toObject, ["scores"], fromScores);
  }
  const fromContentType = getValueByPath(fromObject, ["contentType"]);
  if (fromContentType != null) {
    setValueByPath(toObject, ["contentType"], fromContentType);
  }
  return toObject;
}
function safetySettingToMldev(fromObject) {
  const toObject = {};
  const fromCategory = getValueByPath(fromObject, ["category"]);
  if (fromCategory != null) {
    setValueByPath(toObject, ["category"], fromCategory);
  }
  if (getValueByPath(fromObject, ["method"]) !== void 0) {
    throw new Error("method parameter is not supported in Gemini API.");
  }
  const fromThreshold = getValueByPath(fromObject, ["threshold"]);
  if (fromThreshold != null) {
    setValueByPath(toObject, ["threshold"], fromThreshold);
  }
  return toObject;
}
function scribbleImageToVertex(fromObject) {
  const toObject = {};
  const fromImage = getValueByPath(fromObject, ["image"]);
  if (fromImage != null) {
    setValueByPath(toObject, ["image"], imageToVertex(fromImage));
  }
  return toObject;
}
function segmentImageConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromMode = getValueByPath(fromObject, ["mode"]);
  if (parentObject !== void 0 && fromMode != null) {
    setValueByPath(parentObject, ["parameters", "mode"], fromMode);
  }
  const fromMaxPredictions = getValueByPath(fromObject, [
    "maxPredictions"
  ]);
  if (parentObject !== void 0 && fromMaxPredictions != null) {
    setValueByPath(parentObject, ["parameters", "maxPredictions"], fromMaxPredictions);
  }
  const fromConfidenceThreshold = getValueByPath(fromObject, [
    "confidenceThreshold"
  ]);
  if (parentObject !== void 0 && fromConfidenceThreshold != null) {
    setValueByPath(parentObject, ["parameters", "confidenceThreshold"], fromConfidenceThreshold);
  }
  const fromMaskDilation = getValueByPath(fromObject, ["maskDilation"]);
  if (parentObject !== void 0 && fromMaskDilation != null) {
    setValueByPath(parentObject, ["parameters", "maskDilation"], fromMaskDilation);
  }
  const fromBinaryColorThreshold = getValueByPath(fromObject, [
    "binaryColorThreshold"
  ]);
  if (parentObject !== void 0 && fromBinaryColorThreshold != null) {
    setValueByPath(parentObject, ["parameters", "binaryColorThreshold"], fromBinaryColorThreshold);
  }
  const fromLabels = getValueByPath(fromObject, ["labels"]);
  if (parentObject !== void 0 && fromLabels != null) {
    setValueByPath(parentObject, ["labels"], fromLabels);
  }
  return toObject;
}
function segmentImageParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromSource = getValueByPath(fromObject, ["source"]);
  if (fromSource != null) {
    segmentImageSourceToVertex(fromSource, toObject);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    segmentImageConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
function segmentImageResponseFromVertex(fromObject) {
  const toObject = {};
  const fromGeneratedMasks = getValueByPath(fromObject, ["predictions"]);
  if (fromGeneratedMasks != null) {
    let transformedList = fromGeneratedMasks;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return generatedImageMaskFromVertex(item);
      });
    }
    setValueByPath(toObject, ["generatedMasks"], transformedList);
  }
  return toObject;
}
function segmentImageSourceToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromPrompt = getValueByPath(fromObject, ["prompt"]);
  if (parentObject !== void 0 && fromPrompt != null) {
    setValueByPath(parentObject, ["instances[0]", "prompt"], fromPrompt);
  }
  const fromImage = getValueByPath(fromObject, ["image"]);
  if (parentObject !== void 0 && fromImage != null) {
    setValueByPath(parentObject, ["instances[0]", "image"], imageToVertex(fromImage));
  }
  const fromScribbleImage = getValueByPath(fromObject, [
    "scribbleImage"
  ]);
  if (parentObject !== void 0 && fromScribbleImage != null) {
    setValueByPath(parentObject, ["instances[0]", "scribble"], scribbleImageToVertex(fromScribbleImage));
  }
  return toObject;
}
function toolConfigToMldev(fromObject) {
  const toObject = {};
  const fromFunctionCallingConfig = getValueByPath(fromObject, [
    "functionCallingConfig"
  ]);
  if (fromFunctionCallingConfig != null) {
    setValueByPath(toObject, ["functionCallingConfig"], functionCallingConfigToMldev(fromFunctionCallingConfig));
  }
  const fromRetrievalConfig = getValueByPath(fromObject, [
    "retrievalConfig"
  ]);
  if (fromRetrievalConfig != null) {
    setValueByPath(toObject, ["retrievalConfig"], fromRetrievalConfig);
  }
  return toObject;
}
function toolToMldev$1(fromObject) {
  const toObject = {};
  const fromFunctionDeclarations = getValueByPath(fromObject, [
    "functionDeclarations"
  ]);
  if (fromFunctionDeclarations != null) {
    let transformedList = fromFunctionDeclarations;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["functionDeclarations"], transformedList);
  }
  if (getValueByPath(fromObject, ["retrieval"]) !== void 0) {
    throw new Error("retrieval parameter is not supported in Gemini API.");
  }
  const fromGoogleSearchRetrieval = getValueByPath(fromObject, [
    "googleSearchRetrieval"
  ]);
  if (fromGoogleSearchRetrieval != null) {
    setValueByPath(toObject, ["googleSearchRetrieval"], fromGoogleSearchRetrieval);
  }
  const fromComputerUse = getValueByPath(fromObject, ["computerUse"]);
  if (fromComputerUse != null) {
    setValueByPath(toObject, ["computerUse"], fromComputerUse);
  }
  const fromFileSearch = getValueByPath(fromObject, ["fileSearch"]);
  if (fromFileSearch != null) {
    setValueByPath(toObject, ["fileSearch"], fromFileSearch);
  }
  const fromCodeExecution = getValueByPath(fromObject, [
    "codeExecution"
  ]);
  if (fromCodeExecution != null) {
    setValueByPath(toObject, ["codeExecution"], fromCodeExecution);
  }
  if (getValueByPath(fromObject, ["enterpriseWebSearch"]) !== void 0) {
    throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");
  }
  const fromGoogleMaps = getValueByPath(fromObject, ["googleMaps"]);
  if (fromGoogleMaps != null) {
    setValueByPath(toObject, ["googleMaps"], googleMapsToMldev$1(fromGoogleMaps));
  }
  const fromGoogleSearch = getValueByPath(fromObject, ["googleSearch"]);
  if (fromGoogleSearch != null) {
    setValueByPath(toObject, ["googleSearch"], googleSearchToMldev$1(fromGoogleSearch));
  }
  const fromUrlContext = getValueByPath(fromObject, ["urlContext"]);
  if (fromUrlContext != null) {
    setValueByPath(toObject, ["urlContext"], fromUrlContext);
  }
  return toObject;
}
function toolToVertex(fromObject) {
  const toObject = {};
  const fromFunctionDeclarations = getValueByPath(fromObject, [
    "functionDeclarations"
  ]);
  if (fromFunctionDeclarations != null) {
    let transformedList = fromFunctionDeclarations;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return functionDeclarationToVertex(item);
      });
    }
    setValueByPath(toObject, ["functionDeclarations"], transformedList);
  }
  const fromRetrieval = getValueByPath(fromObject, ["retrieval"]);
  if (fromRetrieval != null) {
    setValueByPath(toObject, ["retrieval"], fromRetrieval);
  }
  const fromGoogleSearchRetrieval = getValueByPath(fromObject, [
    "googleSearchRetrieval"
  ]);
  if (fromGoogleSearchRetrieval != null) {
    setValueByPath(toObject, ["googleSearchRetrieval"], fromGoogleSearchRetrieval);
  }
  const fromComputerUse = getValueByPath(fromObject, ["computerUse"]);
  if (fromComputerUse != null) {
    setValueByPath(toObject, ["computerUse"], fromComputerUse);
  }
  if (getValueByPath(fromObject, ["fileSearch"]) !== void 0) {
    throw new Error("fileSearch parameter is not supported in Vertex AI.");
  }
  const fromCodeExecution = getValueByPath(fromObject, [
    "codeExecution"
  ]);
  if (fromCodeExecution != null) {
    setValueByPath(toObject, ["codeExecution"], fromCodeExecution);
  }
  const fromEnterpriseWebSearch = getValueByPath(fromObject, [
    "enterpriseWebSearch"
  ]);
  if (fromEnterpriseWebSearch != null) {
    setValueByPath(toObject, ["enterpriseWebSearch"], fromEnterpriseWebSearch);
  }
  const fromGoogleMaps = getValueByPath(fromObject, ["googleMaps"]);
  if (fromGoogleMaps != null) {
    setValueByPath(toObject, ["googleMaps"], fromGoogleMaps);
  }
  const fromGoogleSearch = getValueByPath(fromObject, ["googleSearch"]);
  if (fromGoogleSearch != null) {
    setValueByPath(toObject, ["googleSearch"], fromGoogleSearch);
  }
  const fromUrlContext = getValueByPath(fromObject, ["urlContext"]);
  if (fromUrlContext != null) {
    setValueByPath(toObject, ["urlContext"], fromUrlContext);
  }
  return toObject;
}
function tunedModelInfoFromMldev(fromObject) {
  const toObject = {};
  const fromBaseModel = getValueByPath(fromObject, ["baseModel"]);
  if (fromBaseModel != null) {
    setValueByPath(toObject, ["baseModel"], fromBaseModel);
  }
  const fromCreateTime = getValueByPath(fromObject, ["createTime"]);
  if (fromCreateTime != null) {
    setValueByPath(toObject, ["createTime"], fromCreateTime);
  }
  const fromUpdateTime = getValueByPath(fromObject, ["updateTime"]);
  if (fromUpdateTime != null) {
    setValueByPath(toObject, ["updateTime"], fromUpdateTime);
  }
  return toObject;
}
function tunedModelInfoFromVertex(fromObject) {
  const toObject = {};
  const fromBaseModel = getValueByPath(fromObject, [
    "labels",
    "google-vertex-llm-tuning-base-model-id"
  ]);
  if (fromBaseModel != null) {
    setValueByPath(toObject, ["baseModel"], fromBaseModel);
  }
  const fromCreateTime = getValueByPath(fromObject, ["createTime"]);
  if (fromCreateTime != null) {
    setValueByPath(toObject, ["createTime"], fromCreateTime);
  }
  const fromUpdateTime = getValueByPath(fromObject, ["updateTime"]);
  if (fromUpdateTime != null) {
    setValueByPath(toObject, ["updateTime"], fromUpdateTime);
  }
  return toObject;
}
function updateModelConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromDisplayName = getValueByPath(fromObject, ["displayName"]);
  if (parentObject !== void 0 && fromDisplayName != null) {
    setValueByPath(parentObject, ["displayName"], fromDisplayName);
  }
  const fromDescription = getValueByPath(fromObject, ["description"]);
  if (parentObject !== void 0 && fromDescription != null) {
    setValueByPath(parentObject, ["description"], fromDescription);
  }
  const fromDefaultCheckpointId = getValueByPath(fromObject, [
    "defaultCheckpointId"
  ]);
  if (parentObject !== void 0 && fromDefaultCheckpointId != null) {
    setValueByPath(parentObject, ["defaultCheckpointId"], fromDefaultCheckpointId);
  }
  return toObject;
}
function updateModelConfigToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromDisplayName = getValueByPath(fromObject, ["displayName"]);
  if (parentObject !== void 0 && fromDisplayName != null) {
    setValueByPath(parentObject, ["displayName"], fromDisplayName);
  }
  const fromDescription = getValueByPath(fromObject, ["description"]);
  if (parentObject !== void 0 && fromDescription != null) {
    setValueByPath(parentObject, ["description"], fromDescription);
  }
  const fromDefaultCheckpointId = getValueByPath(fromObject, [
    "defaultCheckpointId"
  ]);
  if (parentObject !== void 0 && fromDefaultCheckpointId != null) {
    setValueByPath(parentObject, ["defaultCheckpointId"], fromDefaultCheckpointId);
  }
  return toObject;
}
function updateModelParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "name"], tModel(apiClient, fromModel));
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    updateModelConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function updateModelParametersToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    updateModelConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
function upscaleImageAPIConfigInternalToVertex(fromObject, parentObject) {
  const toObject = {};
  const fromOutputGcsUri = getValueByPath(fromObject, ["outputGcsUri"]);
  if (parentObject !== void 0 && fromOutputGcsUri != null) {
    setValueByPath(parentObject, ["parameters", "storageUri"], fromOutputGcsUri);
  }
  const fromSafetyFilterLevel = getValueByPath(fromObject, [
    "safetyFilterLevel"
  ]);
  if (parentObject !== void 0 && fromSafetyFilterLevel != null) {
    setValueByPath(parentObject, ["parameters", "safetySetting"], fromSafetyFilterLevel);
  }
  const fromPersonGeneration = getValueByPath(fromObject, [
    "personGeneration"
  ]);
  if (parentObject !== void 0 && fromPersonGeneration != null) {
    setValueByPath(parentObject, ["parameters", "personGeneration"], fromPersonGeneration);
  }
  const fromIncludeRaiReason = getValueByPath(fromObject, [
    "includeRaiReason"
  ]);
  if (parentObject !== void 0 && fromIncludeRaiReason != null) {
    setValueByPath(parentObject, ["parameters", "includeRaiReason"], fromIncludeRaiReason);
  }
  const fromOutputMimeType = getValueByPath(fromObject, [
    "outputMimeType"
  ]);
  if (parentObject !== void 0 && fromOutputMimeType != null) {
    setValueByPath(parentObject, ["parameters", "outputOptions", "mimeType"], fromOutputMimeType);
  }
  const fromOutputCompressionQuality = getValueByPath(fromObject, [
    "outputCompressionQuality"
  ]);
  if (parentObject !== void 0 && fromOutputCompressionQuality != null) {
    setValueByPath(parentObject, ["parameters", "outputOptions", "compressionQuality"], fromOutputCompressionQuality);
  }
  const fromEnhanceInputImage = getValueByPath(fromObject, [
    "enhanceInputImage"
  ]);
  if (parentObject !== void 0 && fromEnhanceInputImage != null) {
    setValueByPath(parentObject, ["parameters", "upscaleConfig", "enhanceInputImage"], fromEnhanceInputImage);
  }
  const fromImagePreservationFactor = getValueByPath(fromObject, [
    "imagePreservationFactor"
  ]);
  if (parentObject !== void 0 && fromImagePreservationFactor != null) {
    setValueByPath(parentObject, ["parameters", "upscaleConfig", "imagePreservationFactor"], fromImagePreservationFactor);
  }
  const fromLabels = getValueByPath(fromObject, ["labels"]);
  if (parentObject !== void 0 && fromLabels != null) {
    setValueByPath(parentObject, ["labels"], fromLabels);
  }
  const fromNumberOfImages = getValueByPath(fromObject, [
    "numberOfImages"
  ]);
  if (parentObject !== void 0 && fromNumberOfImages != null) {
    setValueByPath(parentObject, ["parameters", "sampleCount"], fromNumberOfImages);
  }
  const fromMode = getValueByPath(fromObject, ["mode"]);
  if (parentObject !== void 0 && fromMode != null) {
    setValueByPath(parentObject, ["parameters", "mode"], fromMode);
  }
  return toObject;
}
function upscaleImageAPIParametersInternalToVertex(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["_url", "model"], tModel(apiClient, fromModel));
  }
  const fromImage = getValueByPath(fromObject, ["image"]);
  if (fromImage != null) {
    setValueByPath(toObject, ["instances[0]", "image"], imageToVertex(fromImage));
  }
  const fromUpscaleFactor = getValueByPath(fromObject, [
    "upscaleFactor"
  ]);
  if (fromUpscaleFactor != null) {
    setValueByPath(toObject, ["parameters", "upscaleConfig", "upscaleFactor"], fromUpscaleFactor);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    upscaleImageAPIConfigInternalToVertex(fromConfig, toObject);
  }
  return toObject;
}
function upscaleImageResponseFromVertex(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromGeneratedImages = getValueByPath(fromObject, [
    "predictions"
  ]);
  if (fromGeneratedImages != null) {
    let transformedList = fromGeneratedImages;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return generatedImageFromVertex(item);
      });
    }
    setValueByPath(toObject, ["generatedImages"], transformedList);
  }
  return toObject;
}
function videoFromMldev(fromObject) {
  const toObject = {};
  const fromUri = getValueByPath(fromObject, ["uri"]);
  if (fromUri != null) {
    setValueByPath(toObject, ["uri"], fromUri);
  }
  const fromVideoBytes = getValueByPath(fromObject, ["encodedVideo"]);
  if (fromVideoBytes != null) {
    setValueByPath(toObject, ["videoBytes"], tBytes(fromVideoBytes));
  }
  const fromMimeType = getValueByPath(fromObject, ["encoding"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function videoFromVertex(fromObject) {
  const toObject = {};
  const fromUri = getValueByPath(fromObject, ["gcsUri"]);
  if (fromUri != null) {
    setValueByPath(toObject, ["uri"], fromUri);
  }
  const fromVideoBytes = getValueByPath(fromObject, [
    "bytesBase64Encoded"
  ]);
  if (fromVideoBytes != null) {
    setValueByPath(toObject, ["videoBytes"], tBytes(fromVideoBytes));
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function videoGenerationMaskToVertex(fromObject) {
  const toObject = {};
  const fromImage = getValueByPath(fromObject, ["image"]);
  if (fromImage != null) {
    setValueByPath(toObject, ["_self"], imageToVertex(fromImage));
  }
  const fromMaskMode = getValueByPath(fromObject, ["maskMode"]);
  if (fromMaskMode != null) {
    setValueByPath(toObject, ["maskMode"], fromMaskMode);
  }
  return toObject;
}
function videoGenerationReferenceImageToMldev(fromObject) {
  const toObject = {};
  const fromImage = getValueByPath(fromObject, ["image"]);
  if (fromImage != null) {
    setValueByPath(toObject, ["image"], imageToMldev(fromImage));
  }
  const fromReferenceType = getValueByPath(fromObject, [
    "referenceType"
  ]);
  if (fromReferenceType != null) {
    setValueByPath(toObject, ["referenceType"], fromReferenceType);
  }
  return toObject;
}
function videoGenerationReferenceImageToVertex(fromObject) {
  const toObject = {};
  const fromImage = getValueByPath(fromObject, ["image"]);
  if (fromImage != null) {
    setValueByPath(toObject, ["image"], imageToVertex(fromImage));
  }
  const fromReferenceType = getValueByPath(fromObject, [
    "referenceType"
  ]);
  if (fromReferenceType != null) {
    setValueByPath(toObject, ["referenceType"], fromReferenceType);
  }
  return toObject;
}
function videoToMldev(fromObject) {
  const toObject = {};
  const fromUri = getValueByPath(fromObject, ["uri"]);
  if (fromUri != null) {
    setValueByPath(toObject, ["uri"], fromUri);
  }
  const fromVideoBytes = getValueByPath(fromObject, ["videoBytes"]);
  if (fromVideoBytes != null) {
    setValueByPath(toObject, ["encodedVideo"], tBytes(fromVideoBytes));
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["encoding"], fromMimeType);
  }
  return toObject;
}
function videoToVertex(fromObject) {
  const toObject = {};
  const fromUri = getValueByPath(fromObject, ["uri"]);
  if (fromUri != null) {
    setValueByPath(toObject, ["gcsUri"], fromUri);
  }
  const fromVideoBytes = getValueByPath(fromObject, ["videoBytes"]);
  if (fromVideoBytes != null) {
    setValueByPath(toObject, ["bytesBase64Encoded"], tBytes(fromVideoBytes));
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function createFileSearchStoreConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromDisplayName = getValueByPath(fromObject, ["displayName"]);
  if (parentObject !== void 0 && fromDisplayName != null) {
    setValueByPath(parentObject, ["displayName"], fromDisplayName);
  }
  return toObject;
}
function createFileSearchStoreParametersToMldev(fromObject) {
  const toObject = {};
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    createFileSearchStoreConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function deleteFileSearchStoreConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromForce = getValueByPath(fromObject, ["force"]);
  if (parentObject !== void 0 && fromForce != null) {
    setValueByPath(parentObject, ["_query", "force"], fromForce);
  }
  return toObject;
}
function deleteFileSearchStoreParametersToMldev(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], fromName);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    deleteFileSearchStoreConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function getFileSearchStoreParametersToMldev(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], fromName);
  }
  return toObject;
}
function importFileConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromCustomMetadata = getValueByPath(fromObject, [
    "customMetadata"
  ]);
  if (parentObject !== void 0 && fromCustomMetadata != null) {
    let transformedList = fromCustomMetadata;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(parentObject, ["customMetadata"], transformedList);
  }
  const fromChunkingConfig = getValueByPath(fromObject, [
    "chunkingConfig"
  ]);
  if (parentObject !== void 0 && fromChunkingConfig != null) {
    setValueByPath(parentObject, ["chunkingConfig"], fromChunkingConfig);
  }
  return toObject;
}
function importFileOperationFromMldev(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromMetadata = getValueByPath(fromObject, ["metadata"]);
  if (fromMetadata != null) {
    setValueByPath(toObject, ["metadata"], fromMetadata);
  }
  const fromDone = getValueByPath(fromObject, ["done"]);
  if (fromDone != null) {
    setValueByPath(toObject, ["done"], fromDone);
  }
  const fromError = getValueByPath(fromObject, ["error"]);
  if (fromError != null) {
    setValueByPath(toObject, ["error"], fromError);
  }
  const fromResponse = getValueByPath(fromObject, ["response"]);
  if (fromResponse != null) {
    setValueByPath(toObject, ["response"], importFileResponseFromMldev(fromResponse));
  }
  return toObject;
}
function importFileParametersToMldev(fromObject) {
  const toObject = {};
  const fromFileSearchStoreName = getValueByPath(fromObject, [
    "fileSearchStoreName"
  ]);
  if (fromFileSearchStoreName != null) {
    setValueByPath(toObject, ["_url", "file_search_store_name"], fromFileSearchStoreName);
  }
  const fromFileName = getValueByPath(fromObject, ["fileName"]);
  if (fromFileName != null) {
    setValueByPath(toObject, ["fileName"], fromFileName);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    importFileConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function importFileResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromParent = getValueByPath(fromObject, ["parent"]);
  if (fromParent != null) {
    setValueByPath(toObject, ["parent"], fromParent);
  }
  const fromDocumentName = getValueByPath(fromObject, ["documentName"]);
  if (fromDocumentName != null) {
    setValueByPath(toObject, ["documentName"], fromDocumentName);
  }
  return toObject;
}
function listFileSearchStoresConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromPageSize = getValueByPath(fromObject, ["pageSize"]);
  if (parentObject !== void 0 && fromPageSize != null) {
    setValueByPath(parentObject, ["_query", "pageSize"], fromPageSize);
  }
  const fromPageToken = getValueByPath(fromObject, ["pageToken"]);
  if (parentObject !== void 0 && fromPageToken != null) {
    setValueByPath(parentObject, ["_query", "pageToken"], fromPageToken);
  }
  return toObject;
}
function listFileSearchStoresParametersToMldev(fromObject) {
  const toObject = {};
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    listFileSearchStoresConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function listFileSearchStoresResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromNextPageToken = getValueByPath(fromObject, [
    "nextPageToken"
  ]);
  if (fromNextPageToken != null) {
    setValueByPath(toObject, ["nextPageToken"], fromNextPageToken);
  }
  const fromFileSearchStores = getValueByPath(fromObject, [
    "fileSearchStores"
  ]);
  if (fromFileSearchStores != null) {
    let transformedList = fromFileSearchStores;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["fileSearchStores"], transformedList);
  }
  return toObject;
}
function uploadToFileSearchStoreConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (parentObject !== void 0 && fromMimeType != null) {
    setValueByPath(parentObject, ["mimeType"], fromMimeType);
  }
  const fromDisplayName = getValueByPath(fromObject, ["displayName"]);
  if (parentObject !== void 0 && fromDisplayName != null) {
    setValueByPath(parentObject, ["displayName"], fromDisplayName);
  }
  const fromCustomMetadata = getValueByPath(fromObject, [
    "customMetadata"
  ]);
  if (parentObject !== void 0 && fromCustomMetadata != null) {
    let transformedList = fromCustomMetadata;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(parentObject, ["customMetadata"], transformedList);
  }
  const fromChunkingConfig = getValueByPath(fromObject, [
    "chunkingConfig"
  ]);
  if (parentObject !== void 0 && fromChunkingConfig != null) {
    setValueByPath(parentObject, ["chunkingConfig"], fromChunkingConfig);
  }
  return toObject;
}
function uploadToFileSearchStoreParametersToMldev(fromObject) {
  const toObject = {};
  const fromFileSearchStoreName = getValueByPath(fromObject, [
    "fileSearchStoreName"
  ]);
  if (fromFileSearchStoreName != null) {
    setValueByPath(toObject, ["_url", "file_search_store_name"], fromFileSearchStoreName);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    uploadToFileSearchStoreConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function uploadToFileSearchStoreResumableResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  return toObject;
}
var CONTENT_TYPE_HEADER = "Content-Type";
var SERVER_TIMEOUT_HEADER = "X-Server-Timeout";
var USER_AGENT_HEADER = "User-Agent";
var GOOGLE_API_CLIENT_HEADER = "x-goog-api-client";
var SDK_VERSION = "1.34.0";
var LIBRARY_LABEL = `google-genai-sdk/${SDK_VERSION}`;
var VERTEX_AI_API_DEFAULT_VERSION = "v1beta1";
var GOOGLE_AI_API_DEFAULT_VERSION = "v1beta";
var ApiClient = class {
  constructor(opts) {
    var _a2, _b;
    this.clientOptions = Object.assign(Object.assign({}, opts), { project: opts.project, location: opts.location, apiKey: opts.apiKey, vertexai: opts.vertexai });
    const initHttpOptions = {};
    if (this.clientOptions.vertexai) {
      initHttpOptions.apiVersion = (_a2 = this.clientOptions.apiVersion) !== null && _a2 !== void 0 ? _a2 : VERTEX_AI_API_DEFAULT_VERSION;
      initHttpOptions.baseUrl = this.baseUrlFromProjectLocation();
      this.normalizeAuthParameters();
    } else {
      initHttpOptions.apiVersion = (_b = this.clientOptions.apiVersion) !== null && _b !== void 0 ? _b : GOOGLE_AI_API_DEFAULT_VERSION;
      initHttpOptions.baseUrl = `https://generativelanguage.googleapis.com/`;
    }
    initHttpOptions.headers = this.getDefaultHeaders();
    this.clientOptions.httpOptions = initHttpOptions;
    if (opts.httpOptions) {
      this.clientOptions.httpOptions = this.patchHttpOptions(initHttpOptions, opts.httpOptions);
    }
  }
  /**
   * Determines the base URL for Vertex AI based on project and location.
   * Uses the global endpoint if location is 'global' or if project/location
   * are not specified (implying API key usage).
   * @private
   */
  baseUrlFromProjectLocation() {
    if (this.clientOptions.project && this.clientOptions.location && this.clientOptions.location !== "global") {
      return `https://${this.clientOptions.location}-aiplatform.googleapis.com/`;
    }
    return `https://aiplatform.googleapis.com/`;
  }
  /**
   * Normalizes authentication parameters for Vertex AI.
   * If project and location are provided, API key is cleared.
   * If project and location are not provided (implying API key usage),
   * project and location are cleared.
   * @private
   */
  normalizeAuthParameters() {
    if (this.clientOptions.project && this.clientOptions.location) {
      this.clientOptions.apiKey = void 0;
      return;
    }
    this.clientOptions.project = void 0;
    this.clientOptions.location = void 0;
  }
  isVertexAI() {
    var _a2;
    return (_a2 = this.clientOptions.vertexai) !== null && _a2 !== void 0 ? _a2 : false;
  }
  getProject() {
    return this.clientOptions.project;
  }
  getLocation() {
    return this.clientOptions.location;
  }
  async getAuthHeaders() {
    const headers = new Headers();
    await this.clientOptions.auth.addAuthHeaders(headers);
    return headers;
  }
  getApiVersion() {
    if (this.clientOptions.httpOptions && this.clientOptions.httpOptions.apiVersion !== void 0) {
      return this.clientOptions.httpOptions.apiVersion;
    }
    throw new Error("API version is not set.");
  }
  getBaseUrl() {
    if (this.clientOptions.httpOptions && this.clientOptions.httpOptions.baseUrl !== void 0) {
      return this.clientOptions.httpOptions.baseUrl;
    }
    throw new Error("Base URL is not set.");
  }
  getRequestUrl() {
    return this.getRequestUrlInternal(this.clientOptions.httpOptions);
  }
  getHeaders() {
    if (this.clientOptions.httpOptions && this.clientOptions.httpOptions.headers !== void 0) {
      return this.clientOptions.httpOptions.headers;
    } else {
      throw new Error("Headers are not set.");
    }
  }
  getRequestUrlInternal(httpOptions) {
    if (!httpOptions || httpOptions.baseUrl === void 0 || httpOptions.apiVersion === void 0) {
      throw new Error("HTTP options are not correctly set.");
    }
    const baseUrl = httpOptions.baseUrl.endsWith("/") ? httpOptions.baseUrl.slice(0, -1) : httpOptions.baseUrl;
    const urlElement = [baseUrl];
    if (httpOptions.apiVersion && httpOptions.apiVersion !== "") {
      urlElement.push(httpOptions.apiVersion);
    }
    return urlElement.join("/");
  }
  getBaseResourcePath() {
    return `projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`;
  }
  getApiKey() {
    return this.clientOptions.apiKey;
  }
  getWebsocketBaseUrl() {
    const baseUrl = this.getBaseUrl();
    const urlParts = new URL(baseUrl);
    urlParts.protocol = urlParts.protocol == "http:" ? "ws" : "wss";
    return urlParts.toString();
  }
  setBaseUrl(url) {
    if (this.clientOptions.httpOptions) {
      this.clientOptions.httpOptions.baseUrl = url;
    } else {
      throw new Error("HTTP options are not correctly set.");
    }
  }
  constructUrl(path2, httpOptions, prependProjectLocation) {
    const urlElement = [this.getRequestUrlInternal(httpOptions)];
    if (prependProjectLocation) {
      urlElement.push(this.getBaseResourcePath());
    }
    if (path2 !== "") {
      urlElement.push(path2);
    }
    const url = new URL(`${urlElement.join("/")}`);
    return url;
  }
  shouldPrependVertexProjectPath(request) {
    if (this.clientOptions.apiKey) {
      return false;
    }
    if (!this.clientOptions.vertexai) {
      return false;
    }
    if (request.path.startsWith("projects/")) {
      return false;
    }
    if (request.httpMethod === "GET" && request.path.startsWith("publishers/google/models")) {
      return false;
    }
    return true;
  }
  async request(request) {
    let patchedHttpOptions = this.clientOptions.httpOptions;
    if (request.httpOptions) {
      patchedHttpOptions = this.patchHttpOptions(this.clientOptions.httpOptions, request.httpOptions);
    }
    const prependProjectLocation = this.shouldPrependVertexProjectPath(request);
    const url = this.constructUrl(request.path, patchedHttpOptions, prependProjectLocation);
    if (request.queryParams) {
      for (const [key, value] of Object.entries(request.queryParams)) {
        url.searchParams.append(key, String(value));
      }
    }
    let requestInit = {};
    if (request.httpMethod === "GET") {
      if (request.body && request.body !== "{}") {
        throw new Error("Request body should be empty for GET request, but got non empty request body");
      }
    } else {
      requestInit.body = request.body;
    }
    requestInit = await this.includeExtraHttpOptionsToRequestInit(requestInit, patchedHttpOptions, url.toString(), request.abortSignal);
    return this.unaryApiCall(url, requestInit, request.httpMethod);
  }
  patchHttpOptions(baseHttpOptions, requestHttpOptions) {
    const patchedHttpOptions = JSON.parse(JSON.stringify(baseHttpOptions));
    for (const [key, value] of Object.entries(requestHttpOptions)) {
      if (typeof value === "object") {
        patchedHttpOptions[key] = Object.assign(Object.assign({}, patchedHttpOptions[key]), value);
      } else if (value !== void 0) {
        patchedHttpOptions[key] = value;
      }
    }
    return patchedHttpOptions;
  }
  async requestStream(request) {
    let patchedHttpOptions = this.clientOptions.httpOptions;
    if (request.httpOptions) {
      patchedHttpOptions = this.patchHttpOptions(this.clientOptions.httpOptions, request.httpOptions);
    }
    const prependProjectLocation = this.shouldPrependVertexProjectPath(request);
    const url = this.constructUrl(request.path, patchedHttpOptions, prependProjectLocation);
    if (!url.searchParams.has("alt") || url.searchParams.get("alt") !== "sse") {
      url.searchParams.set("alt", "sse");
    }
    let requestInit = {};
    requestInit.body = request.body;
    requestInit = await this.includeExtraHttpOptionsToRequestInit(requestInit, patchedHttpOptions, url.toString(), request.abortSignal);
    return this.streamApiCall(url, requestInit, request.httpMethod);
  }
  async includeExtraHttpOptionsToRequestInit(requestInit, httpOptions, url, abortSignal) {
    if (httpOptions && httpOptions.timeout || abortSignal) {
      const abortController = new AbortController();
      const signal2 = abortController.signal;
      if (httpOptions.timeout && (httpOptions === null || httpOptions === void 0 ? void 0 : httpOptions.timeout) > 0) {
        const timeoutHandle = setTimeout(() => abortController.abort(), httpOptions.timeout);
        if (timeoutHandle && typeof timeoutHandle.unref === "function") {
          timeoutHandle.unref();
        }
      }
      if (abortSignal) {
        abortSignal.addEventListener("abort", () => {
          abortController.abort();
        });
      }
      requestInit.signal = signal2;
    }
    if (httpOptions && httpOptions.extraBody !== null) {
      includeExtraBodyToRequestInit(requestInit, httpOptions.extraBody);
    }
    requestInit.headers = await this.getHeadersInternal(httpOptions, url);
    return requestInit;
  }
  async unaryApiCall(url, requestInit, httpMethod) {
    return this.apiCall(url.toString(), Object.assign(Object.assign({}, requestInit), { method: httpMethod })).then(async (response) => {
      await throwErrorIfNotOK(response);
      return new HttpResponse(response);
    }).catch((e) => {
      if (e instanceof Error) {
        throw e;
      } else {
        throw new Error(JSON.stringify(e));
      }
    });
  }
  async streamApiCall(url, requestInit, httpMethod) {
    return this.apiCall(url.toString(), Object.assign(Object.assign({}, requestInit), { method: httpMethod })).then(async (response) => {
      await throwErrorIfNotOK(response);
      return this.processStreamResponse(response);
    }).catch((e) => {
      if (e instanceof Error) {
        throw e;
      } else {
        throw new Error(JSON.stringify(e));
      }
    });
  }
  processStreamResponse(response) {
    return __asyncGenerator(this, arguments, function* processStreamResponse_1() {
      var _a2;
      const reader = (_a2 = response === null || response === void 0 ? void 0 : response.body) === null || _a2 === void 0 ? void 0 : _a2.getReader();
      const decoder = new TextDecoder("utf-8");
      if (!reader) {
        throw new Error("Response body is empty");
      }
      try {
        let buffer = "";
        const dataPrefix = "data:";
        const delimiters = ["\n\n", "\r\r", "\r\n\r\n"];
        while (true) {
          const { done, value } = yield __await(reader.read());
          if (done) {
            if (buffer.trim().length > 0) {
              throw new Error("Incomplete JSON segment at the end");
            }
            break;
          }
          const chunkString = decoder.decode(value, { stream: true });
          try {
            const chunkJson = JSON.parse(chunkString);
            if ("error" in chunkJson) {
              const errorJson = JSON.parse(JSON.stringify(chunkJson["error"]));
              const status = errorJson["status"];
              const code = errorJson["code"];
              const errorMessage = `got status: ${status}. ${JSON.stringify(chunkJson)}`;
              if (code >= 400 && code < 600) {
                const apiError = new ApiError({
                  message: errorMessage,
                  status: code
                });
                throw apiError;
              }
            }
          } catch (e) {
            const error = e;
            if (error.name === "ApiError") {
              throw e;
            }
          }
          buffer += chunkString;
          let delimiterIndex = -1;
          let delimiterLength = 0;
          while (true) {
            delimiterIndex = -1;
            delimiterLength = 0;
            for (const delimiter of delimiters) {
              const index = buffer.indexOf(delimiter);
              if (index !== -1 && (delimiterIndex === -1 || index < delimiterIndex)) {
                delimiterIndex = index;
                delimiterLength = delimiter.length;
              }
            }
            if (delimiterIndex === -1) {
              break;
            }
            const eventString = buffer.substring(0, delimiterIndex);
            buffer = buffer.substring(delimiterIndex + delimiterLength);
            const trimmedEvent = eventString.trim();
            if (trimmedEvent.startsWith(dataPrefix)) {
              const processedChunkString = trimmedEvent.substring(dataPrefix.length).trim();
              try {
                const partialResponse = new Response(processedChunkString, {
                  headers: response === null || response === void 0 ? void 0 : response.headers,
                  status: response === null || response === void 0 ? void 0 : response.status,
                  statusText: response === null || response === void 0 ? void 0 : response.statusText
                });
                yield yield __await(new HttpResponse(partialResponse));
              } catch (e) {
                throw new Error(`exception parsing stream chunk ${processedChunkString}. ${e}`);
              }
            }
          }
        }
      } finally {
        reader.releaseLock();
      }
    });
  }
  async apiCall(url, requestInit) {
    return fetch(url, requestInit).catch((e) => {
      throw new Error(`exception ${e} sending request`);
    });
  }
  getDefaultHeaders() {
    const headers = {};
    const versionHeaderValue = LIBRARY_LABEL + " " + this.clientOptions.userAgentExtra;
    headers[USER_AGENT_HEADER] = versionHeaderValue;
    headers[GOOGLE_API_CLIENT_HEADER] = versionHeaderValue;
    headers[CONTENT_TYPE_HEADER] = "application/json";
    return headers;
  }
  async getHeadersInternal(httpOptions, url) {
    const headers = new Headers();
    if (httpOptions && httpOptions.headers) {
      for (const [key, value] of Object.entries(httpOptions.headers)) {
        headers.append(key, value);
      }
      if (httpOptions.timeout && httpOptions.timeout > 0) {
        headers.append(SERVER_TIMEOUT_HEADER, String(Math.ceil(httpOptions.timeout / 1e3)));
      }
    }
    await this.clientOptions.auth.addAuthHeaders(headers, url);
    return headers;
  }
  getFileName(file) {
    var _a2;
    let fileName = "";
    if (typeof file === "string") {
      fileName = file.replace(/[/\\]+$/, "");
      fileName = (_a2 = fileName.split(/[/\\]/).pop()) !== null && _a2 !== void 0 ? _a2 : "";
    }
    return fileName;
  }
  /**
   * Uploads a file asynchronously using Gemini API only, this is not supported
   * in Vertex AI.
   *
   * @param file The string path to the file to be uploaded or a Blob object.
   * @param config Optional parameters specified in the `UploadFileConfig`
   *     interface. @see {@link types.UploadFileConfig}
   * @return A promise that resolves to a `File` object.
   * @throws An error if called on a Vertex AI client.
   * @throws An error if the `mimeType` is not provided and can not be inferred,
   */
  async uploadFile(file, config) {
    var _a2;
    const fileToUpload = {};
    if (config != null) {
      fileToUpload.mimeType = config.mimeType;
      fileToUpload.name = config.name;
      fileToUpload.displayName = config.displayName;
    }
    if (fileToUpload.name && !fileToUpload.name.startsWith("files/")) {
      fileToUpload.name = `files/${fileToUpload.name}`;
    }
    const uploader = this.clientOptions.uploader;
    const fileStat = await uploader.stat(file);
    fileToUpload.sizeBytes = String(fileStat.size);
    const mimeType = (_a2 = config === null || config === void 0 ? void 0 : config.mimeType) !== null && _a2 !== void 0 ? _a2 : fileStat.type;
    if (mimeType === void 0 || mimeType === "") {
      throw new Error("Can not determine mimeType. Please provide mimeType in the config.");
    }
    fileToUpload.mimeType = mimeType;
    const body = {
      file: fileToUpload
    };
    const fileName = this.getFileName(file);
    const path2 = formatMap("upload/v1beta/files", body["_url"]);
    const uploadUrl = await this.fetchUploadUrl(path2, fileToUpload.sizeBytes, fileToUpload.mimeType, fileName, body, config === null || config === void 0 ? void 0 : config.httpOptions);
    return uploader.upload(file, uploadUrl, this);
  }
  /**
   * Uploads a file to a given file search store asynchronously using Gemini API only, this is not supported
   * in Vertex AI.
   *
   * @param fileSearchStoreName The name of the file search store to upload the file to.
   * @param file The string path to the file to be uploaded or a Blob object.
   * @param config Optional parameters specified in the `UploadFileConfig`
   *     interface. @see {@link UploadFileConfig}
   * @return A promise that resolves to a `File` object.
   * @throws An error if called on a Vertex AI client.
   * @throws An error if the `mimeType` is not provided and can not be inferred,
   */
  async uploadFileToFileSearchStore(fileSearchStoreName, file, config) {
    var _a2;
    const uploader = this.clientOptions.uploader;
    const fileStat = await uploader.stat(file);
    const sizeBytes = String(fileStat.size);
    const mimeType = (_a2 = config === null || config === void 0 ? void 0 : config.mimeType) !== null && _a2 !== void 0 ? _a2 : fileStat.type;
    if (mimeType === void 0 || mimeType === "") {
      throw new Error("Can not determine mimeType. Please provide mimeType in the config.");
    }
    const path2 = `upload/v1beta/${fileSearchStoreName}:uploadToFileSearchStore`;
    const fileName = this.getFileName(file);
    const body = {};
    if (config != null) {
      uploadToFileSearchStoreConfigToMldev(config, body);
    }
    const uploadUrl = await this.fetchUploadUrl(path2, sizeBytes, mimeType, fileName, body, config === null || config === void 0 ? void 0 : config.httpOptions);
    return uploader.uploadToFileSearchStore(file, uploadUrl, this);
  }
  /**
   * Downloads a file asynchronously to the specified path.
   *
   * @params params - The parameters for the download request, see {@link
   * types.DownloadFileParameters}
   */
  async downloadFile(params) {
    const downloader = this.clientOptions.downloader;
    await downloader.download(params, this);
  }
  async fetchUploadUrl(path2, sizeBytes, mimeType, fileName, body, configHttpOptions) {
    var _a2;
    let httpOptions = {};
    if (configHttpOptions) {
      httpOptions = configHttpOptions;
    } else {
      httpOptions = {
        apiVersion: "",
        // api-version is set in the path.
        headers: Object.assign({ "Content-Type": "application/json", "X-Goog-Upload-Protocol": "resumable", "X-Goog-Upload-Command": "start", "X-Goog-Upload-Header-Content-Length": `${sizeBytes}`, "X-Goog-Upload-Header-Content-Type": `${mimeType}` }, fileName ? { "X-Goog-Upload-File-Name": fileName } : {})
      };
    }
    const httpResponse = await this.request({
      path: path2,
      body: JSON.stringify(body),
      httpMethod: "POST",
      httpOptions
    });
    if (!httpResponse || !(httpResponse === null || httpResponse === void 0 ? void 0 : httpResponse.headers)) {
      throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");
    }
    const uploadUrl = (_a2 = httpResponse === null || httpResponse === void 0 ? void 0 : httpResponse.headers) === null || _a2 === void 0 ? void 0 : _a2["x-goog-upload-url"];
    if (uploadUrl === void 0) {
      throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");
    }
    return uploadUrl;
  }
};
async function throwErrorIfNotOK(response) {
  var _a2;
  if (response === void 0) {
    throw new Error("response is undefined");
  }
  if (!response.ok) {
    const status = response.status;
    let errorBody;
    if ((_a2 = response.headers.get("content-type")) === null || _a2 === void 0 ? void 0 : _a2.includes("application/json")) {
      errorBody = await response.json();
    } else {
      errorBody = {
        error: {
          message: await response.text(),
          code: response.status,
          status: response.statusText
        }
      };
    }
    const errorMessage = JSON.stringify(errorBody);
    if (status >= 400 && status < 600) {
      const apiError = new ApiError({
        message: errorMessage,
        status
      });
      throw apiError;
    }
    throw new Error(errorMessage);
  }
}
function includeExtraBodyToRequestInit(requestInit, extraBody) {
  if (!extraBody || Object.keys(extraBody).length === 0) {
    return;
  }
  if (requestInit.body instanceof Blob) {
    console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");
    return;
  }
  let currentBodyObject = {};
  if (typeof requestInit.body === "string" && requestInit.body.length > 0) {
    try {
      const parsedBody = JSON.parse(requestInit.body);
      if (typeof parsedBody === "object" && parsedBody !== null && !Array.isArray(parsedBody)) {
        currentBodyObject = parsedBody;
      } else {
        console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");
        return;
      }
    } catch (e) {
      console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");
      return;
    }
  }
  function deepMerge(target, source) {
    const output2 = Object.assign({}, target);
    for (const key in source) {
      if (Object.prototype.hasOwnProperty.call(source, key)) {
        const sourceValue = source[key];
        const targetValue = output2[key];
        if (sourceValue && typeof sourceValue === "object" && !Array.isArray(sourceValue) && targetValue && typeof targetValue === "object" && !Array.isArray(targetValue)) {
          output2[key] = deepMerge(targetValue, sourceValue);
        } else {
          if (targetValue && sourceValue && typeof targetValue !== typeof sourceValue) {
            console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${key}". Original type: ${typeof targetValue}, New type: ${typeof sourceValue}. Overwriting.`);
          }
          output2[key] = sourceValue;
        }
      }
    }
    return output2;
  }
  const mergedBody = deepMerge(currentBodyObject, extraBody);
  requestInit.body = JSON.stringify(mergedBody);
}
var MCP_LABEL = "mcp_used/unknown";
var hasMcpToolUsageFromMcpToTool = false;
function hasMcpToolUsage(tools) {
  for (const tool of tools) {
    if (isMcpCallableTool(tool)) {
      return true;
    }
    if (typeof tool === "object" && "inputSchema" in tool) {
      return true;
    }
  }
  return hasMcpToolUsageFromMcpToTool;
}
function setMcpUsageHeader(headers) {
  var _a2;
  const existingHeader = (_a2 = headers[GOOGLE_API_CLIENT_HEADER]) !== null && _a2 !== void 0 ? _a2 : "";
  headers[GOOGLE_API_CLIENT_HEADER] = (existingHeader + ` ${MCP_LABEL}`).trimStart();
}
function isMcpCallableTool(object) {
  return object !== null && typeof object === "object" && object instanceof McpCallableTool;
}
function listAllTools(mcpClient_1) {
  return __asyncGenerator(this, arguments, function* listAllTools_1(mcpClient, maxTools = 100) {
    let cursor = void 0;
    let numTools = 0;
    while (numTools < maxTools) {
      const t = yield __await(mcpClient.listTools({ cursor }));
      for (const tool of t.tools) {
        yield yield __await(tool);
        numTools++;
      }
      if (!t.nextCursor) {
        break;
      }
      cursor = t.nextCursor;
    }
  });
}
var McpCallableTool = class _McpCallableTool {
  constructor(mcpClients = [], config) {
    this.mcpTools = [];
    this.functionNameToMcpClient = {};
    this.mcpClients = mcpClients;
    this.config = config;
  }
  /**
   * Creates a McpCallableTool.
   */
  static create(mcpClients, config) {
    return new _McpCallableTool(mcpClients, config);
  }
  /**
   * Validates the function names are not duplicate and initialize the function
   * name to MCP client mapping.
   *
   * @throws {Error} if the MCP tools from the MCP clients have duplicate tool
   *     names.
   */
  async initialize() {
    var _a2, e_1, _b, _c;
    if (this.mcpTools.length > 0) {
      return;
    }
    const functionMap = {};
    const mcpTools = [];
    for (const mcpClient of this.mcpClients) {
      try {
        for (var _d = true, _e = (e_1 = void 0, __asyncValues(listAllTools(mcpClient))), _f; _f = await _e.next(), _a2 = _f.done, !_a2; _d = true) {
          _c = _f.value;
          _d = false;
          const mcpTool = _c;
          mcpTools.push(mcpTool);
          const mcpToolName = mcpTool.name;
          if (functionMap[mcpToolName]) {
            throw new Error(`Duplicate function name ${mcpToolName} found in MCP tools. Please ensure function names are unique.`);
          }
          functionMap[mcpToolName] = mcpClient;
        }
      } catch (e_1_1) {
        e_1 = { error: e_1_1 };
      } finally {
        try {
          if (!_d && !_a2 && (_b = _e.return)) await _b.call(_e);
        } finally {
          if (e_1) throw e_1.error;
        }
      }
    }
    this.mcpTools = mcpTools;
    this.functionNameToMcpClient = functionMap;
  }
  async tool() {
    await this.initialize();
    return mcpToolsToGeminiTool(this.mcpTools, this.config);
  }
  async callTool(functionCalls) {
    await this.initialize();
    const functionCallResponseParts = [];
    for (const functionCall of functionCalls) {
      if (functionCall.name in this.functionNameToMcpClient) {
        const mcpClient = this.functionNameToMcpClient[functionCall.name];
        let requestOptions = void 0;
        if (this.config.timeout) {
          requestOptions = {
            timeout: this.config.timeout
          };
        }
        const callToolResponse = await mcpClient.callTool(
          {
            name: functionCall.name,
            arguments: functionCall.args
          },
          // Set the result schema to undefined to allow MCP to rely on the
          // default schema.
          void 0,
          requestOptions
        );
        functionCallResponseParts.push({
          functionResponse: {
            name: functionCall.name,
            response: callToolResponse.isError ? { error: callToolResponse } : callToolResponse
          }
        });
      }
    }
    return functionCallResponseParts;
  }
};
async function handleWebSocketMessage$1(apiClient, onmessage, event) {
  const serverMessage = new LiveMusicServerMessage();
  let data;
  if (event.data instanceof Blob) {
    data = JSON.parse(await event.data.text());
  } else {
    data = JSON.parse(event.data);
  }
  Object.assign(serverMessage, data);
  onmessage(serverMessage);
}
var LiveMusic = class {
  constructor(apiClient, auth, webSocketFactory) {
    this.apiClient = apiClient;
    this.auth = auth;
    this.webSocketFactory = webSocketFactory;
  }
  /**
       Establishes a connection to the specified model and returns a
       LiveMusicSession object representing that connection.
  
       @experimental
  
       @remarks
  
       @param params - The parameters for establishing a connection to the model.
       @return A live session.
  
       @example
       ```ts
       let model = 'models/lyria-realtime-exp';
       const session = await ai.live.music.connect({
         model: model,
         callbacks: {
           onmessage: (e: MessageEvent) => {
             console.log('Received message from the server: %s\n', debug(e.data));
           },
           onerror: (e: ErrorEvent) => {
             console.log('Error occurred: %s\n', debug(e.error));
           },
           onclose: (e: CloseEvent) => {
             console.log('Connection closed.');
           },
         },
       });
       ```
      */
  async connect(params) {
    var _a2, _b;
    if (this.apiClient.isVertexAI()) {
      throw new Error("Live music is not supported for Vertex AI.");
    }
    console.warn("Live music generation is experimental and may change in future versions.");
    const websocketBaseUrl = this.apiClient.getWebsocketBaseUrl();
    const apiVersion = this.apiClient.getApiVersion();
    const headers = mapToHeaders$1(this.apiClient.getDefaultHeaders());
    const apiKey = this.apiClient.getApiKey();
    const url = `${websocketBaseUrl}/ws/google.ai.generativelanguage.${apiVersion}.GenerativeService.BidiGenerateMusic?key=${apiKey}`;
    let onopenResolve = () => {
    };
    const onopenPromise = new Promise((resolve) => {
      onopenResolve = resolve;
    });
    const callbacks = params.callbacks;
    const onopenAwaitedCallback = function() {
      onopenResolve({});
    };
    const apiClient = this.apiClient;
    const websocketCallbacks = {
      onopen: onopenAwaitedCallback,
      onmessage: (event) => {
        void handleWebSocketMessage$1(apiClient, callbacks.onmessage, event);
      },
      onerror: (_a2 = callbacks === null || callbacks === void 0 ? void 0 : callbacks.onerror) !== null && _a2 !== void 0 ? _a2 : function(e) {
      },
      onclose: (_b = callbacks === null || callbacks === void 0 ? void 0 : callbacks.onclose) !== null && _b !== void 0 ? _b : function(e) {
      }
    };
    const conn = this.webSocketFactory.create(url, headersToMap$1(headers), websocketCallbacks);
    conn.connect();
    await onopenPromise;
    const model = tModel(this.apiClient, params.model);
    const setup = { model };
    const clientMessage = { setup };
    conn.send(JSON.stringify(clientMessage));
    return new LiveMusicSession(conn, this.apiClient);
  }
};
var LiveMusicSession = class {
  constructor(conn, apiClient) {
    this.conn = conn;
    this.apiClient = apiClient;
  }
  /**
      Sets inputs to steer music generation. Updates the session's current
      weighted prompts.
  
      @param params - Contains one property, `weightedPrompts`.
  
        - `weightedPrompts` to send to the model; weights are normalized to
          sum to 1.0.
  
      @experimental
     */
  async setWeightedPrompts(params) {
    if (!params.weightedPrompts || Object.keys(params.weightedPrompts).length === 0) {
      throw new Error("Weighted prompts must be set and contain at least one entry.");
    }
    const clientContent = liveMusicSetWeightedPromptsParametersToMldev(params);
    this.conn.send(JSON.stringify({ clientContent }));
  }
  /**
      Sets a configuration to the model. Updates the session's current
      music generation config.
  
      @param params - Contains one property, `musicGenerationConfig`.
  
        - `musicGenerationConfig` to set in the model. Passing an empty or
      undefined config to the model will reset the config to defaults.
  
      @experimental
     */
  async setMusicGenerationConfig(params) {
    if (!params.musicGenerationConfig) {
      params.musicGenerationConfig = {};
    }
    const setConfigParameters = liveMusicSetConfigParametersToMldev(params);
    this.conn.send(JSON.stringify(setConfigParameters));
  }
  sendPlaybackControl(playbackControl) {
    const clientMessage = { playbackControl };
    this.conn.send(JSON.stringify(clientMessage));
  }
  /**
   * Start the music stream.
   *
   * @experimental
   */
  play() {
    this.sendPlaybackControl(LiveMusicPlaybackControl.PLAY);
  }
  /**
   * Temporarily halt the music stream. Use `play` to resume from the current
   * position.
   *
   * @experimental
   */
  pause() {
    this.sendPlaybackControl(LiveMusicPlaybackControl.PAUSE);
  }
  /**
   * Stop the music stream and reset the state. Retains the current prompts
   * and config.
   *
   * @experimental
   */
  stop() {
    this.sendPlaybackControl(LiveMusicPlaybackControl.STOP);
  }
  /**
   * Resets the context of the music generation without stopping it.
   * Retains the current prompts and config.
   *
   * @experimental
   */
  resetContext() {
    this.sendPlaybackControl(LiveMusicPlaybackControl.RESET_CONTEXT);
  }
  /**
       Terminates the WebSocket connection.
  
       @experimental
     */
  close() {
    this.conn.close();
  }
};
function headersToMap$1(headers) {
  const headerMap = {};
  headers.forEach((value, key) => {
    headerMap[key] = value;
  });
  return headerMap;
}
function mapToHeaders$1(map2) {
  const headers = new Headers();
  for (const [key, value] of Object.entries(map2)) {
    headers.append(key, value);
  }
  return headers;
}
var FUNCTION_RESPONSE_REQUIRES_ID = "FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";
async function handleWebSocketMessage(apiClient, onmessage, event) {
  const serverMessage = new LiveServerMessage();
  let jsonData;
  if (event.data instanceof Blob) {
    jsonData = await event.data.text();
  } else if (event.data instanceof ArrayBuffer) {
    jsonData = new TextDecoder().decode(event.data);
  } else {
    jsonData = event.data;
  }
  const data = JSON.parse(jsonData);
  if (apiClient.isVertexAI()) {
    const resp = liveServerMessageFromVertex(data);
    Object.assign(serverMessage, resp);
  } else {
    const resp = data;
    Object.assign(serverMessage, resp);
  }
  onmessage(serverMessage);
}
var Live = class {
  constructor(apiClient, auth, webSocketFactory) {
    this.apiClient = apiClient;
    this.auth = auth;
    this.webSocketFactory = webSocketFactory;
    this.music = new LiveMusic(this.apiClient, this.auth, this.webSocketFactory);
  }
  /**
       Establishes a connection to the specified model with the given
       configuration and returns a Session object representing that connection.
  
       @experimental Built-in MCP support is an experimental feature, may change in
       future versions.
  
       @remarks
  
       @param params - The parameters for establishing a connection to the model.
       @return A live session.
  
       @example
       ```ts
       let model: string;
       if (GOOGLE_GENAI_USE_VERTEXAI) {
         model = 'gemini-2.0-flash-live-preview-04-09';
       } else {
         model = 'gemini-live-2.5-flash-preview';
       }
       const session = await ai.live.connect({
         model: model,
         config: {
           responseModalities: [Modality.AUDIO],
         },
         callbacks: {
           onopen: () => {
             console.log('Connected to the socket.');
           },
           onmessage: (e: MessageEvent) => {
             console.log('Received message from the server: %s\n', debug(e.data));
           },
           onerror: (e: ErrorEvent) => {
             console.log('Error occurred: %s\n', debug(e.error));
           },
           onclose: (e: CloseEvent) => {
             console.log('Connection closed.');
           },
         },
       });
       ```
      */
  async connect(params) {
    var _a2, _b, _c, _d, _e, _f;
    if (params.config && params.config.httpOptions) {
      throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");
    }
    const websocketBaseUrl = this.apiClient.getWebsocketBaseUrl();
    const apiVersion = this.apiClient.getApiVersion();
    let url;
    const clientHeaders = this.apiClient.getHeaders();
    if (params.config && params.config.tools && hasMcpToolUsage(params.config.tools)) {
      setMcpUsageHeader(clientHeaders);
    }
    const headers = mapToHeaders(clientHeaders);
    if (this.apiClient.isVertexAI()) {
      url = `${websocketBaseUrl}/ws/google.cloud.aiplatform.${apiVersion}.LlmBidiService/BidiGenerateContent`;
      await this.auth.addAuthHeaders(headers, url);
    } else {
      const apiKey = this.apiClient.getApiKey();
      let method = "BidiGenerateContent";
      let keyName = "key";
      if (apiKey === null || apiKey === void 0 ? void 0 : apiKey.startsWith("auth_tokens/")) {
        console.warn("Warning: Ephemeral token support is experimental and may change in future versions.");
        if (apiVersion !== "v1alpha") {
          console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection.");
        }
        method = "BidiGenerateContentConstrained";
        keyName = "access_token";
      }
      url = `${websocketBaseUrl}/ws/google.ai.generativelanguage.${apiVersion}.GenerativeService.${method}?${keyName}=${apiKey}`;
    }
    let onopenResolve = () => {
    };
    const onopenPromise = new Promise((resolve) => {
      onopenResolve = resolve;
    });
    const callbacks = params.callbacks;
    const onopenAwaitedCallback = function() {
      var _a3;
      (_a3 = callbacks === null || callbacks === void 0 ? void 0 : callbacks.onopen) === null || _a3 === void 0 ? void 0 : _a3.call(callbacks);
      onopenResolve({});
    };
    const apiClient = this.apiClient;
    const websocketCallbacks = {
      onopen: onopenAwaitedCallback,
      onmessage: (event) => {
        void handleWebSocketMessage(apiClient, callbacks.onmessage, event);
      },
      onerror: (_a2 = callbacks === null || callbacks === void 0 ? void 0 : callbacks.onerror) !== null && _a2 !== void 0 ? _a2 : function(e) {
      },
      onclose: (_b = callbacks === null || callbacks === void 0 ? void 0 : callbacks.onclose) !== null && _b !== void 0 ? _b : function(e) {
      }
    };
    const conn = this.webSocketFactory.create(url, headersToMap(headers), websocketCallbacks);
    conn.connect();
    await onopenPromise;
    let transformedModel = tModel(this.apiClient, params.model);
    if (this.apiClient.isVertexAI() && transformedModel.startsWith("publishers/")) {
      const project = this.apiClient.getProject();
      const location2 = this.apiClient.getLocation();
      transformedModel = `projects/${project}/locations/${location2}/` + transformedModel;
    }
    let clientMessage = {};
    if (this.apiClient.isVertexAI() && ((_c = params.config) === null || _c === void 0 ? void 0 : _c.responseModalities) === void 0) {
      if (params.config === void 0) {
        params.config = { responseModalities: [Modality.AUDIO] };
      } else {
        params.config.responseModalities = [Modality.AUDIO];
      }
    }
    if ((_d = params.config) === null || _d === void 0 ? void 0 : _d.generationConfig) {
      console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");
    }
    const inputTools = (_f = (_e = params.config) === null || _e === void 0 ? void 0 : _e.tools) !== null && _f !== void 0 ? _f : [];
    const convertedTools = [];
    for (const tool of inputTools) {
      if (this.isCallableTool(tool)) {
        const callableTool = tool;
        convertedTools.push(await callableTool.tool());
      } else {
        convertedTools.push(tool);
      }
    }
    if (convertedTools.length > 0) {
      params.config.tools = convertedTools;
    }
    const liveConnectParameters = {
      model: transformedModel,
      config: params.config,
      callbacks: params.callbacks
    };
    if (this.apiClient.isVertexAI()) {
      clientMessage = liveConnectParametersToVertex(this.apiClient, liveConnectParameters);
    } else {
      clientMessage = liveConnectParametersToMldev(this.apiClient, liveConnectParameters);
    }
    delete clientMessage["config"];
    conn.send(JSON.stringify(clientMessage));
    return new Session(conn, this.apiClient);
  }
  // TODO: b/416041229 - Abstract this method to a common place.
  isCallableTool(tool) {
    return "callTool" in tool && typeof tool.callTool === "function";
  }
};
var defaultLiveSendClientContentParamerters = {
  turnComplete: true
};
var Session = class {
  constructor(conn, apiClient) {
    this.conn = conn;
    this.apiClient = apiClient;
  }
  tLiveClientContent(apiClient, params) {
    if (params.turns !== null && params.turns !== void 0) {
      let contents = [];
      try {
        contents = tContents(params.turns);
        if (!apiClient.isVertexAI()) {
          contents = contents.map((item) => contentToMldev$1(item));
        }
      } catch (_a2) {
        throw new Error(`Failed to parse client content "turns", type: '${typeof params.turns}'`);
      }
      return {
        clientContent: { turns: contents, turnComplete: params.turnComplete }
      };
    }
    return {
      clientContent: { turnComplete: params.turnComplete }
    };
  }
  tLiveClienttToolResponse(apiClient, params) {
    let functionResponses = [];
    if (params.functionResponses == null) {
      throw new Error("functionResponses is required.");
    }
    if (!Array.isArray(params.functionResponses)) {
      functionResponses = [params.functionResponses];
    } else {
      functionResponses = params.functionResponses;
    }
    if (functionResponses.length === 0) {
      throw new Error("functionResponses is required.");
    }
    for (const functionResponse of functionResponses) {
      if (typeof functionResponse !== "object" || functionResponse === null || !("name" in functionResponse) || !("response" in functionResponse)) {
        throw new Error(`Could not parse function response, type '${typeof functionResponse}'.`);
      }
      if (!apiClient.isVertexAI() && !("id" in functionResponse)) {
        throw new Error(FUNCTION_RESPONSE_REQUIRES_ID);
      }
    }
    const clientMessage = {
      toolResponse: { functionResponses }
    };
    return clientMessage;
  }
  /**
      Send a message over the established connection.
  
      @param params - Contains two **optional** properties, `turns` and
          `turnComplete`.
  
        - `turns` will be converted to a `Content[]`
        - `turnComplete: true` [default] indicates that you are done sending
          content and expect a response. If `turnComplete: false`, the server
          will wait for additional messages before starting generation.
  
      @experimental
  
      @remarks
      There are two ways to send messages to the live API:
      `sendClientContent` and `sendRealtimeInput`.
  
      `sendClientContent` messages are added to the model context **in order**.
      Having a conversation using `sendClientContent` messages is roughly
      equivalent to using the `Chat.sendMessageStream`, except that the state of
      the `chat` history is stored on the API server instead of locally.
  
      Because of `sendClientContent`'s order guarantee, the model cannot respons
      as quickly to `sendClientContent` messages as to `sendRealtimeInput`
      messages. This makes the biggest difference when sending objects that have
      significant preprocessing time (typically images).
  
      The `sendClientContent` message sends a `Content[]`
      which has more options than the `Blob` sent by `sendRealtimeInput`.
  
      So the main use-cases for `sendClientContent` over `sendRealtimeInput` are:
  
      - Sending anything that can't be represented as a `Blob` (text,
      `sendClientContent({turns="Hello?"}`)).
      - Managing turns when not using audio input and voice activity detection.
        (`sendClientContent({turnComplete:true})` or the short form
      `sendClientContent()`)
      - Prefilling a conversation context
        ```
        sendClientContent({
            turns: [
              Content({role:user, parts:...}),
              Content({role:user, parts:...}),
              ...
            ]
        })
        ```
      @experimental
     */
  sendClientContent(params) {
    params = Object.assign(Object.assign({}, defaultLiveSendClientContentParamerters), params);
    const clientMessage = this.tLiveClientContent(this.apiClient, params);
    this.conn.send(JSON.stringify(clientMessage));
  }
  /**
      Send a realtime message over the established connection.
  
      @param params - Contains one property, `media`.
  
        - `media` will be converted to a `Blob`
  
      @experimental
  
      @remarks
      Use `sendRealtimeInput` for realtime audio chunks and video frames (images).
  
      With `sendRealtimeInput` the api will respond to audio automatically
      based on voice activity detection (VAD).
  
      `sendRealtimeInput` is optimized for responsivness at the expense of
      deterministic ordering guarantees. Audio and video tokens are to the
      context when they become available.
  
      Note: The Call signature expects a `Blob` object, but only a subset
      of audio and image mimetypes are allowed.
     */
  sendRealtimeInput(params) {
    let clientMessage = {};
    if (this.apiClient.isVertexAI()) {
      clientMessage = {
        "realtimeInput": liveSendRealtimeInputParametersToVertex(params)
      };
    } else {
      clientMessage = {
        "realtimeInput": liveSendRealtimeInputParametersToMldev(params)
      };
    }
    this.conn.send(JSON.stringify(clientMessage));
  }
  /**
      Send a function response message over the established connection.
  
      @param params - Contains property `functionResponses`.
  
        - `functionResponses` will be converted to a `functionResponses[]`
  
      @remarks
      Use `sendFunctionResponse` to reply to `LiveServerToolCall` from the server.
  
      Use {@link types.LiveConnectConfig#tools} to configure the callable functions.
  
      @experimental
     */
  sendToolResponse(params) {
    if (params.functionResponses == null) {
      throw new Error("Tool response parameters are required.");
    }
    const clientMessage = this.tLiveClienttToolResponse(this.apiClient, params);
    this.conn.send(JSON.stringify(clientMessage));
  }
  /**
       Terminates the WebSocket connection.
  
       @experimental
  
       @example
       ```ts
       let model: string;
       if (GOOGLE_GENAI_USE_VERTEXAI) {
         model = 'gemini-2.0-flash-live-preview-04-09';
       } else {
         model = 'gemini-live-2.5-flash-preview';
       }
       const session = await ai.live.connect({
         model: model,
         config: {
           responseModalities: [Modality.AUDIO],
         }
       });
  
       session.close();
       ```
     */
  close() {
    this.conn.close();
  }
};
function headersToMap(headers) {
  const headerMap = {};
  headers.forEach((value, key) => {
    headerMap[key] = value;
  });
  return headerMap;
}
function mapToHeaders(map2) {
  const headers = new Headers();
  for (const [key, value] of Object.entries(map2)) {
    headers.append(key, value);
  }
  return headers;
}
var DEFAULT_MAX_REMOTE_CALLS = 10;
function shouldDisableAfc(config) {
  var _a2, _b, _c;
  if ((_a2 = config === null || config === void 0 ? void 0 : config.automaticFunctionCalling) === null || _a2 === void 0 ? void 0 : _a2.disable) {
    return true;
  }
  let callableToolsPresent = false;
  for (const tool of (_b = config === null || config === void 0 ? void 0 : config.tools) !== null && _b !== void 0 ? _b : []) {
    if (isCallableTool(tool)) {
      callableToolsPresent = true;
      break;
    }
  }
  if (!callableToolsPresent) {
    return true;
  }
  const maxCalls = (_c = config === null || config === void 0 ? void 0 : config.automaticFunctionCalling) === null || _c === void 0 ? void 0 : _c.maximumRemoteCalls;
  if (maxCalls && (maxCalls < 0 || !Number.isInteger(maxCalls)) || maxCalls == 0) {
    console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:", maxCalls);
    return true;
  }
  return false;
}
function isCallableTool(tool) {
  return "callTool" in tool && typeof tool.callTool === "function";
}
function hasCallableTools(params) {
  var _a2, _b, _c;
  return (_c = (_b = (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.tools) === null || _b === void 0 ? void 0 : _b.some((tool) => isCallableTool(tool))) !== null && _c !== void 0 ? _c : false;
}
function findAfcIncompatibleToolIndexes(params) {
  var _a2;
  const afcIncompatibleToolIndexes = [];
  if (!((_a2 = params === null || params === void 0 ? void 0 : params.config) === null || _a2 === void 0 ? void 0 : _a2.tools)) {
    return afcIncompatibleToolIndexes;
  }
  params.config.tools.forEach((tool, index) => {
    if (isCallableTool(tool)) {
      return;
    }
    const geminiTool = tool;
    if (geminiTool.functionDeclarations && geminiTool.functionDeclarations.length > 0) {
      afcIncompatibleToolIndexes.push(index);
    }
  });
  return afcIncompatibleToolIndexes;
}
function shouldAppendAfcHistory(config) {
  var _a2;
  return !((_a2 = config === null || config === void 0 ? void 0 : config.automaticFunctionCalling) === null || _a2 === void 0 ? void 0 : _a2.ignoreCallHistory);
}
var Models = class extends BaseModule {
  constructor(apiClient) {
    super();
    this.apiClient = apiClient;
    this.generateContent = async (params) => {
      var _a2, _b, _c, _d, _e;
      const transformedParams = await this.processParamsMaybeAddMcpUsage(params);
      this.maybeMoveToResponseJsonSchem(params);
      if (!hasCallableTools(params) || shouldDisableAfc(params.config)) {
        return await this.generateContentInternal(transformedParams);
      }
      const incompatibleToolIndexes = findAfcIncompatibleToolIndexes(params);
      if (incompatibleToolIndexes.length > 0) {
        const formattedIndexes = incompatibleToolIndexes.map((index) => `tools[${index}]`).join(", ");
        throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${formattedIndexes}.`);
      }
      let response;
      let functionResponseContent;
      const automaticFunctionCallingHistory = tContents(transformedParams.contents);
      const maxRemoteCalls = (_c = (_b = (_a2 = transformedParams.config) === null || _a2 === void 0 ? void 0 : _a2.automaticFunctionCalling) === null || _b === void 0 ? void 0 : _b.maximumRemoteCalls) !== null && _c !== void 0 ? _c : DEFAULT_MAX_REMOTE_CALLS;
      let remoteCalls = 0;
      while (remoteCalls < maxRemoteCalls) {
        response = await this.generateContentInternal(transformedParams);
        if (!response.functionCalls || response.functionCalls.length === 0) {
          break;
        }
        const responseContent = response.candidates[0].content;
        const functionResponseParts = [];
        for (const tool of (_e = (_d = params.config) === null || _d === void 0 ? void 0 : _d.tools) !== null && _e !== void 0 ? _e : []) {
          if (isCallableTool(tool)) {
            const callableTool = tool;
            const parts = await callableTool.callTool(response.functionCalls);
            functionResponseParts.push(...parts);
          }
        }
        remoteCalls++;
        functionResponseContent = {
          role: "user",
          parts: functionResponseParts
        };
        transformedParams.contents = tContents(transformedParams.contents);
        transformedParams.contents.push(responseContent);
        transformedParams.contents.push(functionResponseContent);
        if (shouldAppendAfcHistory(transformedParams.config)) {
          automaticFunctionCallingHistory.push(responseContent);
          automaticFunctionCallingHistory.push(functionResponseContent);
        }
      }
      if (shouldAppendAfcHistory(transformedParams.config)) {
        response.automaticFunctionCallingHistory = automaticFunctionCallingHistory;
      }
      return response;
    };
    this.generateContentStream = async (params) => {
      var _a2, _b, _c, _d, _e;
      this.maybeMoveToResponseJsonSchem(params);
      if (shouldDisableAfc(params.config)) {
        const transformedParams = await this.processParamsMaybeAddMcpUsage(params);
        return await this.generateContentStreamInternal(transformedParams);
      }
      const incompatibleToolIndexes = findAfcIncompatibleToolIndexes(params);
      if (incompatibleToolIndexes.length > 0) {
        const formattedIndexes = incompatibleToolIndexes.map((index) => `tools[${index}]`).join(", ");
        throw new Error(`Incompatible tools found at ${formattedIndexes}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`);
      }
      const streamFunctionCall = (_c = (_b = (_a2 = params === null || params === void 0 ? void 0 : params.config) === null || _a2 === void 0 ? void 0 : _a2.toolConfig) === null || _b === void 0 ? void 0 : _b.functionCallingConfig) === null || _c === void 0 ? void 0 : _c.streamFunctionCallArguments;
      const disableAfc = (_e = (_d = params === null || params === void 0 ? void 0 : params.config) === null || _d === void 0 ? void 0 : _d.automaticFunctionCalling) === null || _e === void 0 ? void 0 : _e.disable;
      if (streamFunctionCall && !disableAfc) {
        throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");
      }
      return await this.processAfcStream(params);
    };
    this.generateImages = async (params) => {
      return await this.generateImagesInternal(params).then((apiResponse) => {
        var _a2;
        let positivePromptSafetyAttributes;
        const generatedImages = [];
        if (apiResponse === null || apiResponse === void 0 ? void 0 : apiResponse.generatedImages) {
          for (const generatedImage of apiResponse.generatedImages) {
            if (generatedImage && (generatedImage === null || generatedImage === void 0 ? void 0 : generatedImage.safetyAttributes) && ((_a2 = generatedImage === null || generatedImage === void 0 ? void 0 : generatedImage.safetyAttributes) === null || _a2 === void 0 ? void 0 : _a2.contentType) === "Positive Prompt") {
              positivePromptSafetyAttributes = generatedImage === null || generatedImage === void 0 ? void 0 : generatedImage.safetyAttributes;
            } else {
              generatedImages.push(generatedImage);
            }
          }
        }
        let response;
        if (positivePromptSafetyAttributes) {
          response = {
            generatedImages,
            positivePromptSafetyAttributes,
            sdkHttpResponse: apiResponse.sdkHttpResponse
          };
        } else {
          response = {
            generatedImages,
            sdkHttpResponse: apiResponse.sdkHttpResponse
          };
        }
        return response;
      });
    };
    this.list = async (params) => {
      var _a2;
      const defaultConfig = {
        queryBase: true
      };
      const actualConfig = Object.assign(Object.assign({}, defaultConfig), params === null || params === void 0 ? void 0 : params.config);
      const actualParams = {
        config: actualConfig
      };
      if (this.apiClient.isVertexAI()) {
        if (!actualParams.config.queryBase) {
          if ((_a2 = actualParams.config) === null || _a2 === void 0 ? void 0 : _a2.filter) {
            throw new Error("Filtering tuned models list for Vertex AI is not currently supported");
          } else {
            actualParams.config.filter = "labels.tune-type:*";
          }
        }
      }
      return new Pager(PagedItem.PAGED_ITEM_MODELS, (x) => this.listInternal(x), await this.listInternal(actualParams), actualParams);
    };
    this.editImage = async (params) => {
      const paramsInternal = {
        model: params.model,
        prompt: params.prompt,
        referenceImages: [],
        config: params.config
      };
      if (params.referenceImages) {
        if (params.referenceImages) {
          paramsInternal.referenceImages = params.referenceImages.map((img) => img.toReferenceImageAPI());
        }
      }
      return await this.editImageInternal(paramsInternal);
    };
    this.upscaleImage = async (params) => {
      let apiConfig = {
        numberOfImages: 1,
        mode: "upscale"
      };
      if (params.config) {
        apiConfig = Object.assign(Object.assign({}, apiConfig), params.config);
      }
      const apiParams = {
        model: params.model,
        image: params.image,
        upscaleFactor: params.upscaleFactor,
        config: apiConfig
      };
      return await this.upscaleImageInternal(apiParams);
    };
    this.generateVideos = async (params) => {
      var _a2, _b, _c, _d, _e, _f;
      if ((params.prompt || params.image || params.video) && params.source) {
        throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");
      }
      if (!this.apiClient.isVertexAI()) {
        if (((_a2 = params.video) === null || _a2 === void 0 ? void 0 : _a2.uri) && ((_b = params.video) === null || _b === void 0 ? void 0 : _b.videoBytes)) {
          params.video = {
            uri: params.video.uri,
            mimeType: params.video.mimeType
          };
        } else if (((_d = (_c = params.source) === null || _c === void 0 ? void 0 : _c.video) === null || _d === void 0 ? void 0 : _d.uri) && ((_f = (_e = params.source) === null || _e === void 0 ? void 0 : _e.video) === null || _f === void 0 ? void 0 : _f.videoBytes)) {
          params.source.video = {
            uri: params.source.video.uri,
            mimeType: params.source.video.mimeType
          };
        }
      }
      return await this.generateVideosInternal(params);
    };
  }
  /**
   * This logic is needed for GenerateContentConfig only.
   * Previously we made GenerateContentConfig.responseSchema field to accept
   * unknown. Since v1.9.0, we switch to use backend JSON schema support.
   * To maintain backward compatibility, we move the data that was treated as
   * JSON schema from the responseSchema field to the responseJsonSchema field.
   */
  maybeMoveToResponseJsonSchem(params) {
    if (params.config && params.config.responseSchema) {
      if (!params.config.responseJsonSchema) {
        if (Object.keys(params.config.responseSchema).includes("$schema")) {
          params.config.responseJsonSchema = params.config.responseSchema;
          delete params.config.responseSchema;
        }
      }
    }
    return;
  }
  /**
   * Transforms the CallableTools in the parameters to be simply Tools, it
   * copies the params into a new object and replaces the tools, it does not
   * modify the original params. Also sets the MCP usage header if there are
   * MCP tools in the parameters.
   */
  async processParamsMaybeAddMcpUsage(params) {
    var _a2, _b, _c;
    const tools = (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.tools;
    if (!tools) {
      return params;
    }
    const transformedTools = await Promise.all(tools.map(async (tool) => {
      if (isCallableTool(tool)) {
        const callableTool = tool;
        return await callableTool.tool();
      }
      return tool;
    }));
    const newParams = {
      model: params.model,
      contents: params.contents,
      config: Object.assign(Object.assign({}, params.config), { tools: transformedTools })
    };
    newParams.config.tools = transformedTools;
    if (params.config && params.config.tools && hasMcpToolUsage(params.config.tools)) {
      const headers = (_c = (_b = params.config.httpOptions) === null || _b === void 0 ? void 0 : _b.headers) !== null && _c !== void 0 ? _c : {};
      let newHeaders = Object.assign({}, headers);
      if (Object.keys(newHeaders).length === 0) {
        newHeaders = this.apiClient.getDefaultHeaders();
      }
      setMcpUsageHeader(newHeaders);
      newParams.config.httpOptions = Object.assign(Object.assign({}, params.config.httpOptions), { headers: newHeaders });
    }
    return newParams;
  }
  async initAfcToolsMap(params) {
    var _a2, _b, _c;
    const afcTools = /* @__PURE__ */ new Map();
    for (const tool of (_b = (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.tools) !== null && _b !== void 0 ? _b : []) {
      if (isCallableTool(tool)) {
        const callableTool = tool;
        const toolDeclaration = await callableTool.tool();
        for (const declaration of (_c = toolDeclaration.functionDeclarations) !== null && _c !== void 0 ? _c : []) {
          if (!declaration.name) {
            throw new Error("Function declaration name is required.");
          }
          if (afcTools.has(declaration.name)) {
            throw new Error(`Duplicate tool declaration name: ${declaration.name}`);
          }
          afcTools.set(declaration.name, callableTool);
        }
      }
    }
    return afcTools;
  }
  async processAfcStream(params) {
    var _a2, _b, _c;
    const maxRemoteCalls = (_c = (_b = (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.automaticFunctionCalling) === null || _b === void 0 ? void 0 : _b.maximumRemoteCalls) !== null && _c !== void 0 ? _c : DEFAULT_MAX_REMOTE_CALLS;
    let wereFunctionsCalled = false;
    let remoteCallCount = 0;
    const afcToolsMap = await this.initAfcToolsMap(params);
    return (function(models, afcTools, params2) {
      return __asyncGenerator(this, arguments, function* () {
        var _a3, e_1, _b2, _c2;
        var _d, _e;
        while (remoteCallCount < maxRemoteCalls) {
          if (wereFunctionsCalled) {
            remoteCallCount++;
            wereFunctionsCalled = false;
          }
          const transformedParams = yield __await(models.processParamsMaybeAddMcpUsage(params2));
          const response = yield __await(models.generateContentStreamInternal(transformedParams));
          const functionResponses = [];
          const responseContents = [];
          try {
            for (var _f = true, response_1 = (e_1 = void 0, __asyncValues(response)), response_1_1; response_1_1 = yield __await(response_1.next()), _a3 = response_1_1.done, !_a3; _f = true) {
              _c2 = response_1_1.value;
              _f = false;
              const chunk = _c2;
              yield yield __await(chunk);
              if (chunk.candidates && ((_d = chunk.candidates[0]) === null || _d === void 0 ? void 0 : _d.content)) {
                responseContents.push(chunk.candidates[0].content);
                for (const part of (_e = chunk.candidates[0].content.parts) !== null && _e !== void 0 ? _e : []) {
                  if (remoteCallCount < maxRemoteCalls && part.functionCall) {
                    if (!part.functionCall.name) {
                      throw new Error("Function call name was not returned by the model.");
                    }
                    if (!afcTools.has(part.functionCall.name)) {
                      throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${afcTools.keys()}, mising tool: ${part.functionCall.name}`);
                    } else {
                      const responseParts = yield __await(afcTools.get(part.functionCall.name).callTool([part.functionCall]));
                      functionResponses.push(...responseParts);
                    }
                  }
                }
              }
            }
          } catch (e_1_1) {
            e_1 = { error: e_1_1 };
          } finally {
            try {
              if (!_f && !_a3 && (_b2 = response_1.return)) yield __await(_b2.call(response_1));
            } finally {
              if (e_1) throw e_1.error;
            }
          }
          if (functionResponses.length > 0) {
            wereFunctionsCalled = true;
            const typedResponseChunk = new GenerateContentResponse();
            typedResponseChunk.candidates = [
              {
                content: {
                  role: "user",
                  parts: functionResponses
                }
              }
            ];
            yield yield __await(typedResponseChunk);
            const newContents = [];
            newContents.push(...responseContents);
            newContents.push({
              role: "user",
              parts: functionResponses
            });
            const updatedContents = tContents(params2.contents).concat(newContents);
            params2.contents = updatedContents;
          } else {
            break;
          }
        }
      });
    })(this, afcToolsMap, params);
  }
  async generateContentInternal(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = generateContentParametersToVertex(this.apiClient, params);
      path2 = formatMap("{model}:generateContent", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = generateContentResponseFromVertex(apiResponse);
        const typedResp = new GenerateContentResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      const body = generateContentParametersToMldev(this.apiClient, params);
      path2 = formatMap("{model}:generateContent", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = generateContentResponseFromMldev(apiResponse);
        const typedResp = new GenerateContentResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  async generateContentStreamInternal(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = generateContentParametersToVertex(this.apiClient, params);
      path2 = formatMap("{model}:streamGenerateContent?alt=sse", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      const apiClient = this.apiClient;
      response = apiClient.requestStream({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      });
      return response.then(function(apiResponse) {
        return __asyncGenerator(this, arguments, function* () {
          var _a3, e_2, _b2, _c2;
          try {
            for (var _d2 = true, apiResponse_1 = __asyncValues(apiResponse), apiResponse_1_1; apiResponse_1_1 = yield __await(apiResponse_1.next()), _a3 = apiResponse_1_1.done, !_a3; _d2 = true) {
              _c2 = apiResponse_1_1.value;
              _d2 = false;
              const chunk = _c2;
              const resp = generateContentResponseFromVertex(yield __await(chunk.json()));
              resp["sdkHttpResponse"] = {
                headers: chunk.headers
              };
              const typedResp = new GenerateContentResponse();
              Object.assign(typedResp, resp);
              yield yield __await(typedResp);
            }
          } catch (e_2_1) {
            e_2 = { error: e_2_1 };
          } finally {
            try {
              if (!_d2 && !_a3 && (_b2 = apiResponse_1.return)) yield __await(_b2.call(apiResponse_1));
            } finally {
              if (e_2) throw e_2.error;
            }
          }
        });
      });
    } else {
      const body = generateContentParametersToMldev(this.apiClient, params);
      path2 = formatMap("{model}:streamGenerateContent?alt=sse", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      const apiClient = this.apiClient;
      response = apiClient.requestStream({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      });
      return response.then(function(apiResponse) {
        return __asyncGenerator(this, arguments, function* () {
          var _a3, e_3, _b2, _c2;
          try {
            for (var _d2 = true, apiResponse_2 = __asyncValues(apiResponse), apiResponse_2_1; apiResponse_2_1 = yield __await(apiResponse_2.next()), _a3 = apiResponse_2_1.done, !_a3; _d2 = true) {
              _c2 = apiResponse_2_1.value;
              _d2 = false;
              const chunk = _c2;
              const resp = generateContentResponseFromMldev(yield __await(chunk.json()));
              resp["sdkHttpResponse"] = {
                headers: chunk.headers
              };
              const typedResp = new GenerateContentResponse();
              Object.assign(typedResp, resp);
              yield yield __await(typedResp);
            }
          } catch (e_3_1) {
            e_3 = { error: e_3_1 };
          } finally {
            try {
              if (!_d2 && !_a3 && (_b2 = apiResponse_2.return)) yield __await(_b2.call(apiResponse_2));
            } finally {
              if (e_3) throw e_3.error;
            }
          }
        });
      });
    }
  }
  /**
   * Calculates embeddings for the given contents. Only text is supported.
   *
   * @param params - The parameters for embedding contents.
   * @return The response from the API.
   *
   * @example
   * ```ts
   * const response = await ai.models.embedContent({
   *  model: 'text-embedding-004',
   *  contents: [
   *    'What is your name?',
   *    'What is your favorite color?',
   *  ],
   *  config: {
   *    outputDimensionality: 64,
   *  },
   * });
   * console.log(response);
   * ```
   */
  async embedContent(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = embedContentParametersToVertex(this.apiClient, params);
      path2 = formatMap("{model}:predict", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = embedContentResponseFromVertex(apiResponse);
        const typedResp = new EmbedContentResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      const body = embedContentParametersToMldev(this.apiClient, params);
      path2 = formatMap("{model}:batchEmbedContents", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = embedContentResponseFromMldev(apiResponse);
        const typedResp = new EmbedContentResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  /**
   * Private method for generating images.
   */
  async generateImagesInternal(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = generateImagesParametersToVertex(this.apiClient, params);
      path2 = formatMap("{model}:predict", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = generateImagesResponseFromVertex(apiResponse);
        const typedResp = new GenerateImagesResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      const body = generateImagesParametersToMldev(this.apiClient, params);
      path2 = formatMap("{model}:predict", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = generateImagesResponseFromMldev(apiResponse);
        const typedResp = new GenerateImagesResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  /**
   * Private method for editing an image.
   */
  async editImageInternal(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = editImageParametersInternalToVertex(this.apiClient, params);
      path2 = formatMap("{model}:predict", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = editImageResponseFromVertex(apiResponse);
        const typedResp = new EditImageResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      throw new Error("This method is only supported by the Vertex AI.");
    }
  }
  /**
   * Private method for upscaling an image.
   */
  async upscaleImageInternal(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = upscaleImageAPIParametersInternalToVertex(this.apiClient, params);
      path2 = formatMap("{model}:predict", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = upscaleImageResponseFromVertex(apiResponse);
        const typedResp = new UpscaleImageResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      throw new Error("This method is only supported by the Vertex AI.");
    }
  }
  /**
   * Recontextualizes an image.
   *
   * There are two types of recontextualization currently supported:
   * 1) Imagen Product Recontext - Generate images of products in new scenes
   *    and contexts.
   * 2) Virtual Try-On: Generate images of persons modeling fashion products.
   *
   * @param params - The parameters for recontextualizing an image.
   * @return The response from the API.
   *
   * @example
   * ```ts
   * const response1 = await ai.models.recontextImage({
   *  model: 'imagen-product-recontext-preview-06-30',
   *  source: {
   *    prompt: 'In a modern kitchen setting.',
   *    productImages: [productImage],
   *  },
   *  config: {
   *    numberOfImages: 1,
   *  },
   * });
   * console.log(response1?.generatedImages?.[0]?.image?.imageBytes);
   *
   * const response2 = await ai.models.recontextImage({
   *  model: 'virtual-try-on-preview-08-04',
   *  source: {
   *    personImage: personImage,
   *    productImages: [productImage],
   *  },
   *  config: {
   *    numberOfImages: 1,
   *  },
   * });
   * console.log(response2?.generatedImages?.[0]?.image?.imageBytes);
   * ```
   */
  async recontextImage(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = recontextImageParametersToVertex(this.apiClient, params);
      path2 = formatMap("{model}:predict", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = recontextImageResponseFromVertex(apiResponse);
        const typedResp = new RecontextImageResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      throw new Error("This method is only supported by the Vertex AI.");
    }
  }
  /**
   * Segments an image, creating a mask of a specified area.
   *
   * @param params - The parameters for segmenting an image.
   * @return The response from the API.
   *
   * @example
   * ```ts
   * const response = await ai.models.segmentImage({
   *  model: 'image-segmentation-001',
   *  source: {
   *    image: image,
   *  },
   *  config: {
   *    mode: 'foreground',
   *  },
   * });
   * console.log(response?.generatedMasks?.[0]?.mask?.imageBytes);
   * ```
   */
  async segmentImage(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = segmentImageParametersToVertex(this.apiClient, params);
      path2 = formatMap("{model}:predict", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = segmentImageResponseFromVertex(apiResponse);
        const typedResp = new SegmentImageResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      throw new Error("This method is only supported by the Vertex AI.");
    }
  }
  /**
   * Fetches information about a model by name.
   *
   * @example
   * ```ts
   * const modelInfo = await ai.models.get({model: 'gemini-2.0-flash'});
   * ```
   */
  async get(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = getModelParametersToVertex(this.apiClient, params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = modelFromVertex(apiResponse);
        return resp;
      });
    } else {
      const body = getModelParametersToMldev(this.apiClient, params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = modelFromMldev(apiResponse);
        return resp;
      });
    }
  }
  async listInternal(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = listModelsParametersToVertex(this.apiClient, params);
      path2 = formatMap("{models_url}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = listModelsResponseFromVertex(apiResponse);
        const typedResp = new ListModelsResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      const body = listModelsParametersToMldev(this.apiClient, params);
      path2 = formatMap("{models_url}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = listModelsResponseFromMldev(apiResponse);
        const typedResp = new ListModelsResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  /**
   * Updates a tuned model by its name.
   *
   * @param params - The parameters for updating the model.
   * @return The response from the API.
   *
   * @example
   * ```ts
   * const response = await ai.models.update({
   *   model: 'tuned-model-name',
   *   config: {
   *     displayName: 'New display name',
   *     description: 'New description',
   *   },
   * });
   * ```
   */
  async update(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = updateModelParametersToVertex(this.apiClient, params);
      path2 = formatMap("{model}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "PATCH",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = modelFromVertex(apiResponse);
        return resp;
      });
    } else {
      const body = updateModelParametersToMldev(this.apiClient, params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "PATCH",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = modelFromMldev(apiResponse);
        return resp;
      });
    }
  }
  /**
   * Deletes a tuned model by its name.
   *
   * @param params - The parameters for deleting the model.
   * @return The response from the API.
   *
   * @example
   * ```ts
   * const response = await ai.models.delete({model: 'tuned-model-name'});
   * ```
   */
  async delete(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = deleteModelParametersToVertex(this.apiClient, params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "DELETE",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = deleteModelResponseFromVertex(apiResponse);
        const typedResp = new DeleteModelResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      const body = deleteModelParametersToMldev(this.apiClient, params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "DELETE",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = deleteModelResponseFromMldev(apiResponse);
        const typedResp = new DeleteModelResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  /**
   * Counts the number of tokens in the given contents. Multimodal input is
   * supported for Gemini models.
   *
   * @param params - The parameters for counting tokens.
   * @return The response from the API.
   *
   * @example
   * ```ts
   * const response = await ai.models.countTokens({
   *  model: 'gemini-2.0-flash',
   *  contents: 'The quick brown fox jumps over the lazy dog.'
   * });
   * console.log(response);
   * ```
   */
  async countTokens(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = countTokensParametersToVertex(this.apiClient, params);
      path2 = formatMap("{model}:countTokens", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = countTokensResponseFromVertex(apiResponse);
        const typedResp = new CountTokensResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      const body = countTokensParametersToMldev(this.apiClient, params);
      path2 = formatMap("{model}:countTokens", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = countTokensResponseFromMldev(apiResponse);
        const typedResp = new CountTokensResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  /**
   * Given a list of contents, returns a corresponding TokensInfo containing
   * the list of tokens and list of token ids.
   *
   * This method is not supported by the Gemini Developer API.
   *
   * @param params - The parameters for computing tokens.
   * @return The response from the API.
   *
   * @example
   * ```ts
   * const response = await ai.models.computeTokens({
   *  model: 'gemini-2.0-flash',
   *  contents: 'What is your name?'
   * });
   * console.log(response);
   * ```
   */
  async computeTokens(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = computeTokensParametersToVertex(this.apiClient, params);
      path2 = formatMap("{model}:computeTokens", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = computeTokensResponseFromVertex(apiResponse);
        const typedResp = new ComputeTokensResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      throw new Error("This method is only supported by the Vertex AI.");
    }
  }
  /**
   * Private method for generating videos.
   */
  async generateVideosInternal(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = generateVideosParametersToVertex(this.apiClient, params);
      path2 = formatMap("{model}:predictLongRunning", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = generateVideosOperationFromVertex(apiResponse);
        const typedResp = new GenerateVideosOperation();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      const body = generateVideosParametersToMldev(this.apiClient, params);
      path2 = formatMap("{model}:predictLongRunning", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = generateVideosOperationFromMldev(apiResponse);
        const typedResp = new GenerateVideosOperation();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
};
var Operations = class extends BaseModule {
  constructor(apiClient) {
    super();
    this.apiClient = apiClient;
  }
  /**
   * Gets the status of a long-running operation.
   *
   * @param parameters The parameters for the get operation request.
   * @return The updated Operation object, with the latest status or result.
   */
  async getVideosOperation(parameters) {
    const operation = parameters.operation;
    const config = parameters.config;
    if (operation.name === void 0 || operation.name === "") {
      throw new Error("Operation name is required.");
    }
    if (this.apiClient.isVertexAI()) {
      const resourceName2 = operation.name.split("/operations/")[0];
      let httpOptions = void 0;
      if (config && "httpOptions" in config) {
        httpOptions = config.httpOptions;
      }
      const rawOperation = await this.fetchPredictVideosOperationInternal({
        operationName: operation.name,
        resourceName: resourceName2,
        config: { httpOptions }
      });
      return operation._fromAPIResponse({
        apiResponse: rawOperation,
        _isVertexAI: true
      });
    } else {
      const rawOperation = await this.getVideosOperationInternal({
        operationName: operation.name,
        config
      });
      return operation._fromAPIResponse({
        apiResponse: rawOperation,
        _isVertexAI: false
      });
    }
  }
  /**
   * Gets the status of a long-running operation.
   *
   * @param parameters The parameters for the get operation request.
   * @return The updated Operation object, with the latest status or result.
   */
  async get(parameters) {
    const operation = parameters.operation;
    const config = parameters.config;
    if (operation.name === void 0 || operation.name === "") {
      throw new Error("Operation name is required.");
    }
    if (this.apiClient.isVertexAI()) {
      const resourceName2 = operation.name.split("/operations/")[0];
      let httpOptions = void 0;
      if (config && "httpOptions" in config) {
        httpOptions = config.httpOptions;
      }
      const rawOperation = await this.fetchPredictVideosOperationInternal({
        operationName: operation.name,
        resourceName: resourceName2,
        config: { httpOptions }
      });
      return operation._fromAPIResponse({
        apiResponse: rawOperation,
        _isVertexAI: true
      });
    } else {
      const rawOperation = await this.getVideosOperationInternal({
        operationName: operation.name,
        config
      });
      return operation._fromAPIResponse({
        apiResponse: rawOperation,
        _isVertexAI: false
      });
    }
  }
  async getVideosOperationInternal(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = getOperationParametersToVertex(params);
      path2 = formatMap("{operationName}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response;
    } else {
      const body = getOperationParametersToMldev(params);
      path2 = formatMap("{operationName}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response;
    }
  }
  async fetchPredictVideosOperationInternal(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = fetchPredictOperationParametersToVertex(params);
      path2 = formatMap("{resourceName}:fetchPredictOperation", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response;
    } else {
      throw new Error("This method is only supported by the Vertex AI.");
    }
  }
};
function blobToMldev(fromObject) {
  const toObject = {};
  const fromData = getValueByPath(fromObject, ["data"]);
  if (fromData != null) {
    setValueByPath(toObject, ["data"], fromData);
  }
  if (getValueByPath(fromObject, ["displayName"]) !== void 0) {
    throw new Error("displayName parameter is not supported in Gemini API.");
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function contentToMldev(fromObject) {
  const toObject = {};
  const fromParts = getValueByPath(fromObject, ["parts"]);
  if (fromParts != null) {
    let transformedList = fromParts;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return partToMldev(item);
      });
    }
    setValueByPath(toObject, ["parts"], transformedList);
  }
  const fromRole = getValueByPath(fromObject, ["role"]);
  if (fromRole != null) {
    setValueByPath(toObject, ["role"], fromRole);
  }
  return toObject;
}
function createAuthTokenConfigToMldev(apiClient, fromObject, parentObject) {
  const toObject = {};
  const fromExpireTime = getValueByPath(fromObject, ["expireTime"]);
  if (parentObject !== void 0 && fromExpireTime != null) {
    setValueByPath(parentObject, ["expireTime"], fromExpireTime);
  }
  const fromNewSessionExpireTime = getValueByPath(fromObject, [
    "newSessionExpireTime"
  ]);
  if (parentObject !== void 0 && fromNewSessionExpireTime != null) {
    setValueByPath(parentObject, ["newSessionExpireTime"], fromNewSessionExpireTime);
  }
  const fromUses = getValueByPath(fromObject, ["uses"]);
  if (parentObject !== void 0 && fromUses != null) {
    setValueByPath(parentObject, ["uses"], fromUses);
  }
  const fromLiveConnectConstraints = getValueByPath(fromObject, [
    "liveConnectConstraints"
  ]);
  if (parentObject !== void 0 && fromLiveConnectConstraints != null) {
    setValueByPath(parentObject, ["bidiGenerateContentSetup"], liveConnectConstraintsToMldev(apiClient, fromLiveConnectConstraints));
  }
  const fromLockAdditionalFields = getValueByPath(fromObject, [
    "lockAdditionalFields"
  ]);
  if (parentObject !== void 0 && fromLockAdditionalFields != null) {
    setValueByPath(parentObject, ["fieldMask"], fromLockAdditionalFields);
  }
  return toObject;
}
function createAuthTokenParametersToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    setValueByPath(toObject, ["config"], createAuthTokenConfigToMldev(apiClient, fromConfig, toObject));
  }
  return toObject;
}
function fileDataToMldev(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["displayName"]) !== void 0) {
    throw new Error("displayName parameter is not supported in Gemini API.");
  }
  const fromFileUri = getValueByPath(fromObject, ["fileUri"]);
  if (fromFileUri != null) {
    setValueByPath(toObject, ["fileUri"], fromFileUri);
  }
  const fromMimeType = getValueByPath(fromObject, ["mimeType"]);
  if (fromMimeType != null) {
    setValueByPath(toObject, ["mimeType"], fromMimeType);
  }
  return toObject;
}
function functionCallToMldev(fromObject) {
  const toObject = {};
  const fromId = getValueByPath(fromObject, ["id"]);
  if (fromId != null) {
    setValueByPath(toObject, ["id"], fromId);
  }
  const fromArgs = getValueByPath(fromObject, ["args"]);
  if (fromArgs != null) {
    setValueByPath(toObject, ["args"], fromArgs);
  }
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  if (getValueByPath(fromObject, ["partialArgs"]) !== void 0) {
    throw new Error("partialArgs parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["willContinue"]) !== void 0) {
    throw new Error("willContinue parameter is not supported in Gemini API.");
  }
  return toObject;
}
function googleMapsToMldev(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["authConfig"]) !== void 0) {
    throw new Error("authConfig parameter is not supported in Gemini API.");
  }
  const fromEnableWidget = getValueByPath(fromObject, ["enableWidget"]);
  if (fromEnableWidget != null) {
    setValueByPath(toObject, ["enableWidget"], fromEnableWidget);
  }
  return toObject;
}
function googleSearchToMldev(fromObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["excludeDomains"]) !== void 0) {
    throw new Error("excludeDomains parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["blockingConfidence"]) !== void 0) {
    throw new Error("blockingConfidence parameter is not supported in Gemini API.");
  }
  const fromTimeRangeFilter = getValueByPath(fromObject, [
    "timeRangeFilter"
  ]);
  if (fromTimeRangeFilter != null) {
    setValueByPath(toObject, ["timeRangeFilter"], fromTimeRangeFilter);
  }
  return toObject;
}
function liveConnectConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromGenerationConfig = getValueByPath(fromObject, [
    "generationConfig"
  ]);
  if (parentObject !== void 0 && fromGenerationConfig != null) {
    setValueByPath(parentObject, ["setup", "generationConfig"], fromGenerationConfig);
  }
  const fromResponseModalities = getValueByPath(fromObject, [
    "responseModalities"
  ]);
  if (parentObject !== void 0 && fromResponseModalities != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "responseModalities"], fromResponseModalities);
  }
  const fromTemperature = getValueByPath(fromObject, ["temperature"]);
  if (parentObject !== void 0 && fromTemperature != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "temperature"], fromTemperature);
  }
  const fromTopP = getValueByPath(fromObject, ["topP"]);
  if (parentObject !== void 0 && fromTopP != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "topP"], fromTopP);
  }
  const fromTopK = getValueByPath(fromObject, ["topK"]);
  if (parentObject !== void 0 && fromTopK != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "topK"], fromTopK);
  }
  const fromMaxOutputTokens = getValueByPath(fromObject, [
    "maxOutputTokens"
  ]);
  if (parentObject !== void 0 && fromMaxOutputTokens != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "maxOutputTokens"], fromMaxOutputTokens);
  }
  const fromMediaResolution = getValueByPath(fromObject, [
    "mediaResolution"
  ]);
  if (parentObject !== void 0 && fromMediaResolution != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "mediaResolution"], fromMediaResolution);
  }
  const fromSeed = getValueByPath(fromObject, ["seed"]);
  if (parentObject !== void 0 && fromSeed != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "seed"], fromSeed);
  }
  const fromSpeechConfig = getValueByPath(fromObject, ["speechConfig"]);
  if (parentObject !== void 0 && fromSpeechConfig != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "speechConfig"], tLiveSpeechConfig(fromSpeechConfig));
  }
  const fromThinkingConfig = getValueByPath(fromObject, [
    "thinkingConfig"
  ]);
  if (parentObject !== void 0 && fromThinkingConfig != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "thinkingConfig"], fromThinkingConfig);
  }
  const fromEnableAffectiveDialog = getValueByPath(fromObject, [
    "enableAffectiveDialog"
  ]);
  if (parentObject !== void 0 && fromEnableAffectiveDialog != null) {
    setValueByPath(parentObject, ["setup", "generationConfig", "enableAffectiveDialog"], fromEnableAffectiveDialog);
  }
  const fromSystemInstruction = getValueByPath(fromObject, [
    "systemInstruction"
  ]);
  if (parentObject !== void 0 && fromSystemInstruction != null) {
    setValueByPath(parentObject, ["setup", "systemInstruction"], contentToMldev(tContent(fromSystemInstruction)));
  }
  const fromTools = getValueByPath(fromObject, ["tools"]);
  if (parentObject !== void 0 && fromTools != null) {
    let transformedList = tTools(fromTools);
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return toolToMldev(tTool(item));
      });
    }
    setValueByPath(parentObject, ["setup", "tools"], transformedList);
  }
  const fromSessionResumption = getValueByPath(fromObject, [
    "sessionResumption"
  ]);
  if (parentObject !== void 0 && fromSessionResumption != null) {
    setValueByPath(parentObject, ["setup", "sessionResumption"], sessionResumptionConfigToMldev(fromSessionResumption));
  }
  const fromInputAudioTranscription = getValueByPath(fromObject, [
    "inputAudioTranscription"
  ]);
  if (parentObject !== void 0 && fromInputAudioTranscription != null) {
    setValueByPath(parentObject, ["setup", "inputAudioTranscription"], fromInputAudioTranscription);
  }
  const fromOutputAudioTranscription = getValueByPath(fromObject, [
    "outputAudioTranscription"
  ]);
  if (parentObject !== void 0 && fromOutputAudioTranscription != null) {
    setValueByPath(parentObject, ["setup", "outputAudioTranscription"], fromOutputAudioTranscription);
  }
  const fromRealtimeInputConfig = getValueByPath(fromObject, [
    "realtimeInputConfig"
  ]);
  if (parentObject !== void 0 && fromRealtimeInputConfig != null) {
    setValueByPath(parentObject, ["setup", "realtimeInputConfig"], fromRealtimeInputConfig);
  }
  const fromContextWindowCompression = getValueByPath(fromObject, [
    "contextWindowCompression"
  ]);
  if (parentObject !== void 0 && fromContextWindowCompression != null) {
    setValueByPath(parentObject, ["setup", "contextWindowCompression"], fromContextWindowCompression);
  }
  const fromProactivity = getValueByPath(fromObject, ["proactivity"]);
  if (parentObject !== void 0 && fromProactivity != null) {
    setValueByPath(parentObject, ["setup", "proactivity"], fromProactivity);
  }
  if (getValueByPath(fromObject, ["explicitVadSignal"]) !== void 0) {
    throw new Error("explicitVadSignal parameter is not supported in Gemini API.");
  }
  return toObject;
}
function liveConnectConstraintsToMldev(apiClient, fromObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["model"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["setup", "model"], tModel(apiClient, fromModel));
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    setValueByPath(toObject, ["config"], liveConnectConfigToMldev(fromConfig, toObject));
  }
  return toObject;
}
function partToMldev(fromObject) {
  const toObject = {};
  const fromMediaResolution = getValueByPath(fromObject, [
    "mediaResolution"
  ]);
  if (fromMediaResolution != null) {
    setValueByPath(toObject, ["mediaResolution"], fromMediaResolution);
  }
  const fromCodeExecutionResult = getValueByPath(fromObject, [
    "codeExecutionResult"
  ]);
  if (fromCodeExecutionResult != null) {
    setValueByPath(toObject, ["codeExecutionResult"], fromCodeExecutionResult);
  }
  const fromExecutableCode = getValueByPath(fromObject, [
    "executableCode"
  ]);
  if (fromExecutableCode != null) {
    setValueByPath(toObject, ["executableCode"], fromExecutableCode);
  }
  const fromFileData = getValueByPath(fromObject, ["fileData"]);
  if (fromFileData != null) {
    setValueByPath(toObject, ["fileData"], fileDataToMldev(fromFileData));
  }
  const fromFunctionCall = getValueByPath(fromObject, ["functionCall"]);
  if (fromFunctionCall != null) {
    setValueByPath(toObject, ["functionCall"], functionCallToMldev(fromFunctionCall));
  }
  const fromFunctionResponse = getValueByPath(fromObject, [
    "functionResponse"
  ]);
  if (fromFunctionResponse != null) {
    setValueByPath(toObject, ["functionResponse"], fromFunctionResponse);
  }
  const fromInlineData = getValueByPath(fromObject, ["inlineData"]);
  if (fromInlineData != null) {
    setValueByPath(toObject, ["inlineData"], blobToMldev(fromInlineData));
  }
  const fromText = getValueByPath(fromObject, ["text"]);
  if (fromText != null) {
    setValueByPath(toObject, ["text"], fromText);
  }
  const fromThought = getValueByPath(fromObject, ["thought"]);
  if (fromThought != null) {
    setValueByPath(toObject, ["thought"], fromThought);
  }
  const fromThoughtSignature = getValueByPath(fromObject, [
    "thoughtSignature"
  ]);
  if (fromThoughtSignature != null) {
    setValueByPath(toObject, ["thoughtSignature"], fromThoughtSignature);
  }
  const fromVideoMetadata = getValueByPath(fromObject, [
    "videoMetadata"
  ]);
  if (fromVideoMetadata != null) {
    setValueByPath(toObject, ["videoMetadata"], fromVideoMetadata);
  }
  return toObject;
}
function sessionResumptionConfigToMldev(fromObject) {
  const toObject = {};
  const fromHandle = getValueByPath(fromObject, ["handle"]);
  if (fromHandle != null) {
    setValueByPath(toObject, ["handle"], fromHandle);
  }
  if (getValueByPath(fromObject, ["transparent"]) !== void 0) {
    throw new Error("transparent parameter is not supported in Gemini API.");
  }
  return toObject;
}
function toolToMldev(fromObject) {
  const toObject = {};
  const fromFunctionDeclarations = getValueByPath(fromObject, [
    "functionDeclarations"
  ]);
  if (fromFunctionDeclarations != null) {
    let transformedList = fromFunctionDeclarations;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["functionDeclarations"], transformedList);
  }
  if (getValueByPath(fromObject, ["retrieval"]) !== void 0) {
    throw new Error("retrieval parameter is not supported in Gemini API.");
  }
  const fromGoogleSearchRetrieval = getValueByPath(fromObject, [
    "googleSearchRetrieval"
  ]);
  if (fromGoogleSearchRetrieval != null) {
    setValueByPath(toObject, ["googleSearchRetrieval"], fromGoogleSearchRetrieval);
  }
  const fromComputerUse = getValueByPath(fromObject, ["computerUse"]);
  if (fromComputerUse != null) {
    setValueByPath(toObject, ["computerUse"], fromComputerUse);
  }
  const fromFileSearch = getValueByPath(fromObject, ["fileSearch"]);
  if (fromFileSearch != null) {
    setValueByPath(toObject, ["fileSearch"], fromFileSearch);
  }
  const fromCodeExecution = getValueByPath(fromObject, [
    "codeExecution"
  ]);
  if (fromCodeExecution != null) {
    setValueByPath(toObject, ["codeExecution"], fromCodeExecution);
  }
  if (getValueByPath(fromObject, ["enterpriseWebSearch"]) !== void 0) {
    throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");
  }
  const fromGoogleMaps = getValueByPath(fromObject, ["googleMaps"]);
  if (fromGoogleMaps != null) {
    setValueByPath(toObject, ["googleMaps"], googleMapsToMldev(fromGoogleMaps));
  }
  const fromGoogleSearch = getValueByPath(fromObject, ["googleSearch"]);
  if (fromGoogleSearch != null) {
    setValueByPath(toObject, ["googleSearch"], googleSearchToMldev(fromGoogleSearch));
  }
  const fromUrlContext = getValueByPath(fromObject, ["urlContext"]);
  if (fromUrlContext != null) {
    setValueByPath(toObject, ["urlContext"], fromUrlContext);
  }
  return toObject;
}
function getFieldMasks(setup) {
  const fields = [];
  for (const key in setup) {
    if (Object.prototype.hasOwnProperty.call(setup, key)) {
      const value = setup[key];
      if (typeof value === "object" && value != null && Object.keys(value).length > 0) {
        const field = Object.keys(value).map((kk) => `${key}.${kk}`);
        fields.push(...field);
      } else {
        fields.push(key);
      }
    }
  }
  return fields.join(",");
}
function convertBidiSetupToTokenSetup(requestDict, config) {
  let setupForMaskGeneration = null;
  const bidiGenerateContentSetupValue = requestDict["bidiGenerateContentSetup"];
  if (typeof bidiGenerateContentSetupValue === "object" && bidiGenerateContentSetupValue !== null && "setup" in bidiGenerateContentSetupValue) {
    const innerSetup = bidiGenerateContentSetupValue.setup;
    if (typeof innerSetup === "object" && innerSetup !== null) {
      requestDict["bidiGenerateContentSetup"] = innerSetup;
      setupForMaskGeneration = innerSetup;
    } else {
      delete requestDict["bidiGenerateContentSetup"];
    }
  } else if (bidiGenerateContentSetupValue !== void 0) {
    delete requestDict["bidiGenerateContentSetup"];
  }
  const preExistingFieldMask = requestDict["fieldMask"];
  if (setupForMaskGeneration) {
    const generatedMaskFromBidi = getFieldMasks(setupForMaskGeneration);
    if (Array.isArray(config === null || config === void 0 ? void 0 : config.lockAdditionalFields) && (config === null || config === void 0 ? void 0 : config.lockAdditionalFields.length) === 0) {
      if (generatedMaskFromBidi) {
        requestDict["fieldMask"] = generatedMaskFromBidi;
      } else {
        delete requestDict["fieldMask"];
      }
    } else if ((config === null || config === void 0 ? void 0 : config.lockAdditionalFields) && config.lockAdditionalFields.length > 0 && preExistingFieldMask !== null && Array.isArray(preExistingFieldMask) && preExistingFieldMask.length > 0) {
      const generationConfigFields = [
        "temperature",
        "topK",
        "topP",
        "maxOutputTokens",
        "responseModalities",
        "seed",
        "speechConfig"
      ];
      let mappedFieldsFromPreExisting = [];
      if (preExistingFieldMask.length > 0) {
        mappedFieldsFromPreExisting = preExistingFieldMask.map((field) => {
          if (generationConfigFields.includes(field)) {
            return `generationConfig.${field}`;
          }
          return field;
        });
      }
      const finalMaskParts = [];
      if (generatedMaskFromBidi) {
        finalMaskParts.push(generatedMaskFromBidi);
      }
      if (mappedFieldsFromPreExisting.length > 0) {
        finalMaskParts.push(...mappedFieldsFromPreExisting);
      }
      if (finalMaskParts.length > 0) {
        requestDict["fieldMask"] = finalMaskParts.join(",");
      } else {
        delete requestDict["fieldMask"];
      }
    } else {
      delete requestDict["fieldMask"];
    }
  } else {
    if (preExistingFieldMask !== null && Array.isArray(preExistingFieldMask) && preExistingFieldMask.length > 0) {
      requestDict["fieldMask"] = preExistingFieldMask.join(",");
    } else {
      delete requestDict["fieldMask"];
    }
  }
  return requestDict;
}
var Tokens = class extends BaseModule {
  constructor(apiClient) {
    super();
    this.apiClient = apiClient;
  }
  /**
   * Creates an ephemeral auth token resource.
   *
   * @experimental
   *
   * @remarks
   * Ephemeral auth tokens is only supported in the Gemini Developer API.
   * It can be used for the session connection to the Live constrained API.
   * Support in v1alpha only.
   *
   * @param params - The parameters for the create request.
   * @return The created auth token.
   *
   * @example
   * ```ts
   * const ai = new GoogleGenAI({
   *     apiKey: token.name,
   *     httpOptions: { apiVersion: 'v1alpha' }  // Support in v1alpha only.
   * });
   *
   * // Case 1: If LiveEphemeralParameters is unset, unlock LiveConnectConfig
   * // when using the token in Live API sessions. Each session connection can
   * // use a different configuration.
   * const config: CreateAuthTokenConfig = {
   *     uses: 3,
   *     expireTime: '2025-05-01T00:00:00Z',
   * }
   * const token = await ai.tokens.create(config);
   *
   * // Case 2: If LiveEphemeralParameters is set, lock all fields in
   * // LiveConnectConfig when using the token in Live API sessions. For
   * // example, changing `outputAudioTranscription` in the Live API
   * // connection will be ignored by the API.
   * const config: CreateAuthTokenConfig =
   *     uses: 3,
   *     expireTime: '2025-05-01T00:00:00Z',
   *     LiveEphemeralParameters: {
   *        model: 'gemini-2.0-flash-001',
   *        config: {
   *           'responseModalities': ['AUDIO'],
   *           'systemInstruction': 'Always answer in English.',
   *        }
   *     }
   * }
   * const token = await ai.tokens.create(config);
   *
   * // Case 3: If LiveEphemeralParameters is set and lockAdditionalFields is
   * // set, lock LiveConnectConfig with set and additional fields (e.g.
   * // responseModalities, systemInstruction, temperature in this example) when
   * // using the token in Live API sessions.
   * const config: CreateAuthTokenConfig =
   *     uses: 3,
   *     expireTime: '2025-05-01T00:00:00Z',
   *     LiveEphemeralParameters: {
   *        model: 'gemini-2.0-flash-001',
   *        config: {
   *           'responseModalities': ['AUDIO'],
   *           'systemInstruction': 'Always answer in English.',
   *        }
   *     },
   *     lockAdditionalFields: ['temperature'],
   * }
   * const token = await ai.tokens.create(config);
   *
   * // Case 4: If LiveEphemeralParameters is set and lockAdditionalFields is
   * // empty array, lock LiveConnectConfig with set fields (e.g.
   * // responseModalities, systemInstruction in this example) when using the
   * // token in Live API sessions.
   * const config: CreateAuthTokenConfig =
   *     uses: 3,
   *     expireTime: '2025-05-01T00:00:00Z',
   *     LiveEphemeralParameters: {
   *        model: 'gemini-2.0-flash-001',
   *        config: {
   *           'responseModalities': ['AUDIO'],
   *           'systemInstruction': 'Always answer in English.',
   *        }
   *     },
   *     lockAdditionalFields: [],
   * }
   * const token = await ai.tokens.create(config);
   * ```
   */
  async create(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");
    } else {
      const body = createAuthTokenParametersToMldev(this.apiClient, params);
      path2 = formatMap("auth_tokens", body["_url"]);
      queryParams = body["_query"];
      delete body["config"];
      delete body["_url"];
      delete body["_query"];
      const transformedBody = convertBidiSetupToTokenSetup(body, params.config);
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(transformedBody),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((resp) => {
        return resp;
      });
    }
  }
};
function deleteDocumentConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromForce = getValueByPath(fromObject, ["force"]);
  if (parentObject !== void 0 && fromForce != null) {
    setValueByPath(parentObject, ["_query", "force"], fromForce);
  }
  return toObject;
}
function deleteDocumentParametersToMldev(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], fromName);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    deleteDocumentConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function getDocumentParametersToMldev(fromObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], fromName);
  }
  return toObject;
}
function listDocumentsConfigToMldev(fromObject, parentObject) {
  const toObject = {};
  const fromPageSize = getValueByPath(fromObject, ["pageSize"]);
  if (parentObject !== void 0 && fromPageSize != null) {
    setValueByPath(parentObject, ["_query", "pageSize"], fromPageSize);
  }
  const fromPageToken = getValueByPath(fromObject, ["pageToken"]);
  if (parentObject !== void 0 && fromPageToken != null) {
    setValueByPath(parentObject, ["_query", "pageToken"], fromPageToken);
  }
  return toObject;
}
function listDocumentsParametersToMldev(fromObject) {
  const toObject = {};
  const fromParent = getValueByPath(fromObject, ["parent"]);
  if (fromParent != null) {
    setValueByPath(toObject, ["_url", "parent"], fromParent);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    listDocumentsConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function listDocumentsResponseFromMldev(fromObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromNextPageToken = getValueByPath(fromObject, [
    "nextPageToken"
  ]);
  if (fromNextPageToken != null) {
    setValueByPath(toObject, ["nextPageToken"], fromNextPageToken);
  }
  const fromDocuments = getValueByPath(fromObject, ["documents"]);
  if (fromDocuments != null) {
    let transformedList = fromDocuments;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["documents"], transformedList);
  }
  return toObject;
}
var Documents = class extends BaseModule {
  constructor(apiClient) {
    super();
    this.apiClient = apiClient;
    this.list = async (params) => {
      return new Pager(PagedItem.PAGED_ITEM_DOCUMENTS, (x) => this.listInternal({ parent: params.parent, config: x.config }), await this.listInternal(params), params);
    };
  }
  /**
   * Gets a Document.
   *
   * @param params - The parameters for getting a document.
   * @return Document.
   */
  async get(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = getDocumentParametersToMldev(params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((resp) => {
        return resp;
      });
    }
  }
  /**
   * Deletes a Document.
   *
   * @param params - The parameters for deleting a document.
   */
  async delete(params) {
    var _a2, _b;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = deleteDocumentParametersToMldev(params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      await this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "DELETE",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      });
    }
  }
  async listInternal(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = listDocumentsParametersToMldev(params);
      path2 = formatMap("{parent}/documents", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = listDocumentsResponseFromMldev(apiResponse);
        const typedResp = new ListDocumentsResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
};
var FileSearchStores = class extends BaseModule {
  constructor(apiClient, documents = new Documents(apiClient)) {
    super();
    this.apiClient = apiClient;
    this.documents = documents;
    this.list = async (params = {}) => {
      return new Pager(PagedItem.PAGED_ITEM_FILE_SEARCH_STORES, (x) => this.listInternal(x), await this.listInternal(params), params);
    };
  }
  /**
   * Uploads a file asynchronously to a given File Search Store.
   * This method is not available in Vertex AI.
   * Supported upload sources:
   * - Node.js: File path (string) or Blob object.
   * - Browser: Blob object (e.g., File).
   *
   * @remarks
   * The `mimeType` can be specified in the `config` parameter. If omitted:
   *  - For file path (string) inputs, the `mimeType` will be inferred from the
   *     file extension.
   *  - For Blob object inputs, the `mimeType` will be set to the Blob's `type`
   *     property.
   *
   * This section can contain multiple paragraphs and code examples.
   *
   * @param params - Optional parameters specified in the
   *        `types.UploadToFileSearchStoreParameters` interface.
   *         @see {@link types.UploadToFileSearchStoreParameters#config} for the optional
   *         config in the parameters.
   * @return A promise that resolves to a long running operation.
   * @throws An error if called on a Vertex AI client.
   * @throws An error if the `mimeType` is not provided and can not be inferred,
   * the `mimeType` can be provided in the `params.config` parameter.
   * @throws An error occurs if a suitable upload location cannot be established.
   *
   * @example
   * The following code uploads a file to a given file search store.
   *
   * ```ts
   * const operation = await ai.fileSearchStores.upload({fileSearchStoreName: 'fileSearchStores/foo-bar', file: 'file.txt', config: {
   *   mimeType: 'text/plain',
   * }});
   * console.log(operation.name);
   * ```
   */
  async uploadToFileSearchStore(params) {
    if (this.apiClient.isVertexAI()) {
      throw new Error("Vertex AI does not support uploading files to a file search store.");
    }
    return this.apiClient.uploadFileToFileSearchStore(params.fileSearchStoreName, params.file, params.config);
  }
  /**
   * Creates a File Search Store.
   *
   * @param params - The parameters for creating a File Search Store.
   * @return FileSearchStore.
   */
  async create(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = createFileSearchStoreParametersToMldev(params);
      path2 = formatMap("fileSearchStores", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((resp) => {
        return resp;
      });
    }
  }
  /**
   * Gets a File Search Store.
   *
   * @param params - The parameters for getting a File Search Store.
   * @return FileSearchStore.
   */
  async get(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = getFileSearchStoreParametersToMldev(params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((resp) => {
        return resp;
      });
    }
  }
  /**
   * Deletes a File Search Store.
   *
   * @param params - The parameters for deleting a File Search Store.
   */
  async delete(params) {
    var _a2, _b;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = deleteFileSearchStoreParametersToMldev(params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      await this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "DELETE",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      });
    }
  }
  async listInternal(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = listFileSearchStoresParametersToMldev(params);
      path2 = formatMap("fileSearchStores", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = listFileSearchStoresResponseFromMldev(apiResponse);
        const typedResp = new ListFileSearchStoresResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  async uploadToFileSearchStoreInternal(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = uploadToFileSearchStoreParametersToMldev(params);
      path2 = formatMap("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = uploadToFileSearchStoreResumableResponseFromMldev(apiResponse);
        const typedResp = new UploadToFileSearchStoreResumableResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  /**
   * Imports a File from File Service to a FileSearchStore.
   *
   * This is a long-running operation, see aip.dev/151
   *
   * @param params - The parameters for importing a file to a file search store.
   * @return ImportFileOperation.
   */
  async importFile(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = importFileParametersToMldev(params);
      path2 = formatMap("{file_search_store_name}:importFile", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json();
      });
      return response.then((apiResponse) => {
        const resp = importFileOperationFromMldev(apiResponse);
        const typedResp = new ImportFileOperation();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
};
var uuid4Internal = function() {
  const { crypto: crypto2 } = globalThis;
  if (crypto2 === null || crypto2 === void 0 ? void 0 : crypto2.randomUUID) {
    uuid4Internal = crypto2.randomUUID.bind(crypto2);
    return crypto2.randomUUID();
  }
  const u8 = new Uint8Array(1);
  const randomByte = crypto2 ? () => crypto2.getRandomValues(u8)[0] : () => Math.random() * 255 & 255;
  return "10000000-1000-4000-8000-100000000000".replace(/[018]/g, (c) => (+c ^ randomByte() & 15 >> +c / 4).toString(16));
};
var uuid4 = () => uuid4Internal();
function isAbortError(err) {
  return typeof err === "object" && err !== null && // Spec-compliant fetch implementations
  ("name" in err && err.name === "AbortError" || // Expo fetch
  "message" in err && String(err.message).includes("FetchRequestCanceledException"));
}
var castToError = (err) => {
  if (err instanceof Error)
    return err;
  if (typeof err === "object" && err !== null) {
    try {
      if (Object.prototype.toString.call(err) === "[object Error]") {
        const error = new Error(err.message, err.cause ? { cause: err.cause } : {});
        if (err.stack)
          error.stack = err.stack;
        if (err.cause && !error.cause)
          error.cause = err.cause;
        if (err.name)
          error.name = err.name;
        return error;
      }
    } catch (_a2) {
    }
    try {
      return new Error(JSON.stringify(err));
    } catch (_b) {
    }
  }
  return new Error(err);
};
var GeminiNextGenAPIClientError = class extends Error {
};
var APIError = class _APIError extends GeminiNextGenAPIClientError {
  constructor(status, error, message, headers) {
    super(`${_APIError.makeMessage(status, error, message)}`);
    this.status = status;
    this.headers = headers;
    this.error = error;
  }
  static makeMessage(status, error, message) {
    const msg = (error === null || error === void 0 ? void 0 : error.message) ? typeof error.message === "string" ? error.message : JSON.stringify(error.message) : error ? JSON.stringify(error) : message;
    if (status && msg) {
      return `${status} ${msg}`;
    }
    if (status) {
      return `${status} status code (no body)`;
    }
    if (msg) {
      return msg;
    }
    return "(no status code or body)";
  }
  static generate(status, errorResponse, message, headers) {
    if (!status || !headers) {
      return new APIConnectionError({ message, cause: castToError(errorResponse) });
    }
    const error = errorResponse;
    if (status === 400) {
      return new BadRequestError(status, error, message, headers);
    }
    if (status === 401) {
      return new AuthenticationError(status, error, message, headers);
    }
    if (status === 403) {
      return new PermissionDeniedError(status, error, message, headers);
    }
    if (status === 404) {
      return new NotFoundError(status, error, message, headers);
    }
    if (status === 409) {
      return new ConflictError(status, error, message, headers);
    }
    if (status === 422) {
      return new UnprocessableEntityError(status, error, message, headers);
    }
    if (status === 429) {
      return new RateLimitError(status, error, message, headers);
    }
    if (status >= 500) {
      return new InternalServerError(status, error, message, headers);
    }
    return new _APIError(status, error, message, headers);
  }
};
var APIUserAbortError = class extends APIError {
  constructor({ message } = {}) {
    super(void 0, void 0, message || "Request was aborted.", void 0);
  }
};
var APIConnectionError = class extends APIError {
  constructor({ message, cause }) {
    super(void 0, void 0, message || "Connection error.", void 0);
    if (cause)
      this.cause = cause;
  }
};
var APIConnectionTimeoutError = class extends APIConnectionError {
  constructor({ message } = {}) {
    super({ message: message !== null && message !== void 0 ? message : "Request timed out." });
  }
};
var BadRequestError = class extends APIError {
};
var AuthenticationError = class extends APIError {
};
var PermissionDeniedError = class extends APIError {
};
var NotFoundError = class extends APIError {
};
var ConflictError = class extends APIError {
};
var UnprocessableEntityError = class extends APIError {
};
var RateLimitError = class extends APIError {
};
var InternalServerError = class extends APIError {
};
var startsWithSchemeRegexp = /^[a-z][a-z0-9+.-]*:/i;
var isAbsoluteURL = (url) => {
  return startsWithSchemeRegexp.test(url);
};
var isArrayInternal = (val) => (isArrayInternal = Array.isArray, isArrayInternal(val));
var isArray = isArrayInternal;
var isReadonlyArrayInternal = isArray;
var isReadonlyArray = isReadonlyArrayInternal;
function isEmptyObj(obj) {
  if (!obj)
    return true;
  for (const _k in obj)
    return false;
  return true;
}
function hasOwn(obj, key) {
  return Object.prototype.hasOwnProperty.call(obj, key);
}
var validatePositiveInteger = (name, n) => {
  if (typeof n !== "number" || !Number.isInteger(n)) {
    throw new GeminiNextGenAPIClientError(`${name} must be an integer`);
  }
  if (n < 0) {
    throw new GeminiNextGenAPIClientError(`${name} must be a positive integer`);
  }
  return n;
};
var safeJSON = (text) => {
  try {
    return JSON.parse(text);
  } catch (err) {
    return void 0;
  }
};
var sleep$1 = (ms) => new Promise((resolve) => setTimeout(resolve, ms));
var VERSION = "0.0.1";
function getDetectedPlatform() {
  if (typeof Deno !== "undefined" && Deno.build != null) {
    return "deno";
  }
  if (typeof EdgeRuntime !== "undefined") {
    return "edge";
  }
  if (Object.prototype.toString.call(typeof globalThis.process !== "undefined" ? globalThis.process : 0) === "[object process]") {
    return "node";
  }
  return "unknown";
}
var getPlatformProperties = () => {
  var _a2, _b, _c, _d, _e;
  const detectedPlatform = getDetectedPlatform();
  if (detectedPlatform === "deno") {
    return {
      "X-Stainless-Lang": "js",
      "X-Stainless-Package-Version": VERSION,
      "X-Stainless-OS": normalizePlatform(Deno.build.os),
      "X-Stainless-Arch": normalizeArch(Deno.build.arch),
      "X-Stainless-Runtime": "deno",
      "X-Stainless-Runtime-Version": typeof Deno.version === "string" ? Deno.version : (_b = (_a2 = Deno.version) === null || _a2 === void 0 ? void 0 : _a2.deno) !== null && _b !== void 0 ? _b : "unknown"
    };
  }
  if (typeof EdgeRuntime !== "undefined") {
    return {
      "X-Stainless-Lang": "js",
      "X-Stainless-Package-Version": VERSION,
      "X-Stainless-OS": "Unknown",
      "X-Stainless-Arch": `other:${EdgeRuntime}`,
      "X-Stainless-Runtime": "edge",
      "X-Stainless-Runtime-Version": globalThis.process.version
    };
  }
  if (detectedPlatform === "node") {
    return {
      "X-Stainless-Lang": "js",
      "X-Stainless-Package-Version": VERSION,
      "X-Stainless-OS": normalizePlatform((_c = globalThis.process.platform) !== null && _c !== void 0 ? _c : "unknown"),
      "X-Stainless-Arch": normalizeArch((_d = globalThis.process.arch) !== null && _d !== void 0 ? _d : "unknown"),
      "X-Stainless-Runtime": "node",
      "X-Stainless-Runtime-Version": (_e = globalThis.process.version) !== null && _e !== void 0 ? _e : "unknown"
    };
  }
  const browserInfo = getBrowserInfo();
  if (browserInfo) {
    return {
      "X-Stainless-Lang": "js",
      "X-Stainless-Package-Version": VERSION,
      "X-Stainless-OS": "Unknown",
      "X-Stainless-Arch": "unknown",
      "X-Stainless-Runtime": `browser:${browserInfo.browser}`,
      "X-Stainless-Runtime-Version": browserInfo.version
    };
  }
  return {
    "X-Stainless-Lang": "js",
    "X-Stainless-Package-Version": VERSION,
    "X-Stainless-OS": "Unknown",
    "X-Stainless-Arch": "unknown",
    "X-Stainless-Runtime": "unknown",
    "X-Stainless-Runtime-Version": "unknown"
  };
};
function getBrowserInfo() {
  if (typeof navigator === "undefined" || !navigator) {
    return null;
  }
  const browserPatterns = [
    { key: "edge", pattern: /Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/ },
    { key: "ie", pattern: /MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/ },
    { key: "ie", pattern: /Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/ },
    { key: "chrome", pattern: /Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/ },
    { key: "firefox", pattern: /Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/ },
    { key: "safari", pattern: /(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/ }
  ];
  for (const { key, pattern } of browserPatterns) {
    const match = pattern.exec(navigator.userAgent);
    if (match) {
      const major = match[1] || 0;
      const minor = match[2] || 0;
      const patch = match[3] || 0;
      return { browser: key, version: `${major}.${minor}.${patch}` };
    }
  }
  return null;
}
var normalizeArch = (arch) => {
  if (arch === "x32")
    return "x32";
  if (arch === "x86_64" || arch === "x64")
    return "x64";
  if (arch === "arm")
    return "arm";
  if (arch === "aarch64" || arch === "arm64")
    return "arm64";
  if (arch)
    return `other:${arch}`;
  return "unknown";
};
var normalizePlatform = (platform) => {
  platform = platform.toLowerCase();
  if (platform.includes("ios"))
    return "iOS";
  if (platform === "android")
    return "Android";
  if (platform === "darwin")
    return "MacOS";
  if (platform === "win32")
    return "Windows";
  if (platform === "freebsd")
    return "FreeBSD";
  if (platform === "openbsd")
    return "OpenBSD";
  if (platform === "linux")
    return "Linux";
  if (platform)
    return `Other:${platform}`;
  return "Unknown";
};
var _platformHeaders;
var getPlatformHeaders = () => {
  return _platformHeaders !== null && _platformHeaders !== void 0 ? _platformHeaders : _platformHeaders = getPlatformProperties();
};
function getDefaultFetch() {
  if (typeof fetch !== "undefined") {
    return fetch;
  }
  throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`");
}
function makeReadableStream(...args) {
  const ReadableStream = globalThis.ReadableStream;
  if (typeof ReadableStream === "undefined") {
    throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");
  }
  return new ReadableStream(...args);
}
function ReadableStreamFrom(iterable) {
  let iter = Symbol.asyncIterator in iterable ? iterable[Symbol.asyncIterator]() : iterable[Symbol.iterator]();
  return makeReadableStream({
    start() {
    },
    async pull(controller) {
      const { done, value } = await iter.next();
      if (done) {
        controller.close();
      } else {
        controller.enqueue(value);
      }
    },
    async cancel() {
      var _a2;
      await ((_a2 = iter.return) === null || _a2 === void 0 ? void 0 : _a2.call(iter));
    }
  });
}
function ReadableStreamToAsyncIterable(stream) {
  if (stream[Symbol.asyncIterator])
    return stream;
  const reader = stream.getReader();
  return {
    async next() {
      try {
        const result = await reader.read();
        if (result === null || result === void 0 ? void 0 : result.done)
          reader.releaseLock();
        return result;
      } catch (e) {
        reader.releaseLock();
        throw e;
      }
    },
    async return() {
      const cancelPromise = reader.cancel();
      reader.releaseLock();
      await cancelPromise;
      return { done: true, value: void 0 };
    },
    [Symbol.asyncIterator]() {
      return this;
    }
  };
}
async function CancelReadableStream(stream) {
  var _a2, _b;
  if (stream === null || typeof stream !== "object")
    return;
  if (stream[Symbol.asyncIterator]) {
    await ((_b = (_a2 = stream[Symbol.asyncIterator]()).return) === null || _b === void 0 ? void 0 : _b.call(_a2));
    return;
  }
  const reader = stream.getReader();
  const cancelPromise = reader.cancel();
  reader.releaseLock();
  await cancelPromise;
}
var FallbackEncoder = ({ headers, body }) => {
  return {
    bodyHeaders: {
      "content-type": "application/json"
    },
    body: JSON.stringify(body)
  };
};
var checkFileSupport = () => {
  var _a2;
  if (typeof File === "undefined") {
    const { process } = globalThis;
    const isOldNode = typeof ((_a2 = process === null || process === void 0 ? void 0 : process.versions) === null || _a2 === void 0 ? void 0 : _a2.node) === "string" && parseInt(process.versions.node.split(".")) < 20;
    throw new Error("`File` is not defined as a global, which is required for file uploads." + (isOldNode ? " Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`." : ""));
  }
};
function makeFile(fileBits, fileName, options) {
  checkFileSupport();
  return new File(fileBits, fileName !== null && fileName !== void 0 ? fileName : "unknown_file", options);
}
function getName(value) {
  return (typeof value === "object" && value !== null && ("name" in value && value.name && String(value.name) || "url" in value && value.url && String(value.url) || "filename" in value && value.filename && String(value.filename) || "path" in value && value.path && String(value.path)) || "").split(/[\\/]/).pop() || void 0;
}
var isAsyncIterable = (value) => value != null && typeof value === "object" && typeof value[Symbol.asyncIterator] === "function";
var isBlobLike = (value) => value != null && typeof value === "object" && typeof value.size === "number" && typeof value.type === "string" && typeof value.text === "function" && typeof value.slice === "function" && typeof value.arrayBuffer === "function";
var isFileLike = (value) => value != null && typeof value === "object" && typeof value.name === "string" && typeof value.lastModified === "number" && isBlobLike(value);
var isResponseLike = (value) => value != null && typeof value === "object" && typeof value.url === "string" && typeof value.blob === "function";
async function toFile(value, name, options) {
  checkFileSupport();
  value = await value;
  if (isFileLike(value)) {
    if (value instanceof File) {
      return value;
    }
    return makeFile([await value.arrayBuffer()], value.name);
  }
  if (isResponseLike(value)) {
    const blob = await value.blob();
    name || (name = new URL(value.url).pathname.split(/[\\/]/).pop());
    return makeFile(await getBytes(blob), name, options);
  }
  const parts = await getBytes(value);
  name || (name = getName(value));
  if (!(options === null || options === void 0 ? void 0 : options.type)) {
    const type = parts.find((part) => typeof part === "object" && "type" in part && part.type);
    if (typeof type === "string") {
      options = Object.assign(Object.assign({}, options), { type });
    }
  }
  return makeFile(parts, name, options);
}
async function getBytes(value) {
  var _a2, e_1, _b, _c;
  var _d;
  let parts = [];
  if (typeof value === "string" || ArrayBuffer.isView(value) || // includes Uint8Array, Buffer, etc.
  value instanceof ArrayBuffer) {
    parts.push(value);
  } else if (isBlobLike(value)) {
    parts.push(value instanceof Blob ? value : await value.arrayBuffer());
  } else if (isAsyncIterable(value)) {
    try {
      for (var _e = true, value_1 = __asyncValues(value), value_1_1; value_1_1 = await value_1.next(), _a2 = value_1_1.done, !_a2; _e = true) {
        _c = value_1_1.value;
        _e = false;
        const chunk = _c;
        parts.push(...await getBytes(chunk));
      }
    } catch (e_1_1) {
      e_1 = { error: e_1_1 };
    } finally {
      try {
        if (!_e && !_a2 && (_b = value_1.return)) await _b.call(value_1);
      } finally {
        if (e_1) throw e_1.error;
      }
    }
  } else {
    const constructor = (_d = value === null || value === void 0 ? void 0 : value.constructor) === null || _d === void 0 ? void 0 : _d.name;
    throw new Error(`Unexpected data type: ${typeof value}${constructor ? `; constructor: ${constructor}` : ""}${propsForError(value)}`);
  }
  return parts;
}
function propsForError(value) {
  if (typeof value !== "object" || value === null)
    return "";
  const props = Object.getOwnPropertyNames(value);
  return `; props: [${props.map((p) => `"${p}"`).join(", ")}]`;
}
var APIResource = class {
  constructor(client) {
    this._client = client;
  }
};
APIResource._key = [];
function encodeURIPath(str) {
  return str.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g, encodeURIComponent);
}
var EMPTY = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.create(null));
var createPathTagFunction = (pathEncoder = encodeURIPath) => (function path2(statics, ...params) {
  if (statics.length === 1)
    return statics[0];
  let postPath = false;
  const invalidSegments = [];
  const path3 = statics.reduce((previousValue, currentValue, index) => {
    var _a2, _b, _c;
    if (/[?#]/.test(currentValue)) {
      postPath = true;
    }
    const value = params[index];
    let encoded = (postPath ? encodeURIComponent : pathEncoder)("" + value);
    if (index !== params.length && (value == null || typeof value === "object" && // handle values from other realms
    value.toString === ((_c = Object.getPrototypeOf((_b = Object.getPrototypeOf((_a2 = value.hasOwnProperty) !== null && _a2 !== void 0 ? _a2 : EMPTY)) !== null && _b !== void 0 ? _b : EMPTY)) === null || _c === void 0 ? void 0 : _c.toString))) {
      encoded = value + "";
      invalidSegments.push({
        start: previousValue.length + currentValue.length,
        length: encoded.length,
        error: `Value of type ${Object.prototype.toString.call(value).slice(8, -1)} is not a valid path parameter`
      });
    }
    return previousValue + currentValue + (index === params.length ? "" : encoded);
  }, "");
  const pathOnly = path3.split(/[?#]/, 1)[0];
  const invalidSegmentPattern = /(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;
  let match;
  while ((match = invalidSegmentPattern.exec(pathOnly)) !== null) {
    invalidSegments.push({
      start: match.index,
      length: match[0].length,
      error: `Value "${match[0]}" can't be safely passed as a path parameter`
    });
  }
  invalidSegments.sort((a, b) => a.start - b.start);
  if (invalidSegments.length > 0) {
    let lastEnd = 0;
    const underline = invalidSegments.reduce((acc, segment) => {
      const spaces = " ".repeat(segment.start - lastEnd);
      const arrows = "^".repeat(segment.length);
      lastEnd = segment.start + segment.length;
      return acc + spaces + arrows;
    }, "");
    throw new GeminiNextGenAPIClientError(`Path parameters result in path with invalid segments:
${invalidSegments.map((e) => e.error).join("\n")}
${path3}
${underline}`);
  }
  return path3;
});
var path = /* @__PURE__ */ createPathTagFunction(encodeURIPath);
var BaseInteractions = class extends APIResource {
  create(params, options) {
    var _a2;
    const { api_version = this._client.apiVersion } = params, body = __rest(params, ["api_version"]);
    if ("model" in body && "agent_config" in body) {
      throw new GeminiNextGenAPIClientError(`Invalid request: specified \`model\` and \`agent_config\`. If specifying \`model\`, use \`generation_config\`.`);
    }
    if ("agent" in body && "generation_config" in body) {
      throw new GeminiNextGenAPIClientError(`Invalid request: specified \`agent\` and \`generation_config\`. If specifying \`agent\`, use \`agent_config\`.`);
    }
    return this._client.post(path`/${api_version}/interactions`, Object.assign(Object.assign({ body }, options), { stream: (_a2 = params.stream) !== null && _a2 !== void 0 ? _a2 : false }));
  }
  /**
   * Deletes the interaction by id.
   *
   * @example
   * ```ts
   * const interaction = await client.interactions.delete('id');
   * ```
   */
  delete(id, params = {}, options) {
    const { api_version = this._client.apiVersion } = params !== null && params !== void 0 ? params : {};
    return this._client.delete(path`/${api_version}/interactions/${id}`, options);
  }
  /**
   * Cancels an interaction by id. This only applies to background interactions that are still running.
   *
   * @example
   * ```ts
   * const interaction = await client.interactions.cancel('id');
   * ```
   */
  cancel(id, params = {}, options) {
    const { api_version = this._client.apiVersion } = params !== null && params !== void 0 ? params : {};
    return this._client.post(path`/${api_version}/interactions/${id}/cancel`, options);
  }
  get(id, params = {}, options) {
    var _a2;
    const _b = params !== null && params !== void 0 ? params : {}, { api_version = this._client.apiVersion } = _b, query = __rest(_b, ["api_version"]);
    return this._client.get(path`/${api_version}/interactions/${id}`, Object.assign(Object.assign({ query }, options), { stream: (_a2 = params === null || params === void 0 ? void 0 : params.stream) !== null && _a2 !== void 0 ? _a2 : false }));
  }
};
BaseInteractions._key = Object.freeze(["interactions"]);
var Interactions = class extends BaseInteractions {
};
function concatBytes(buffers) {
  let length = 0;
  for (const buffer of buffers) {
    length += buffer.length;
  }
  const output2 = new Uint8Array(length);
  let index = 0;
  for (const buffer of buffers) {
    output2.set(buffer, index);
    index += buffer.length;
  }
  return output2;
}
var encodeUTF8_;
function encodeUTF8(str) {
  let encoder;
  return (encodeUTF8_ !== null && encodeUTF8_ !== void 0 ? encodeUTF8_ : (encoder = new globalThis.TextEncoder(), encodeUTF8_ = encoder.encode.bind(encoder)))(str);
}
var decodeUTF8_;
function decodeUTF8(bytes) {
  let decoder;
  return (decodeUTF8_ !== null && decodeUTF8_ !== void 0 ? decodeUTF8_ : (decoder = new globalThis.TextDecoder(), decodeUTF8_ = decoder.decode.bind(decoder)))(bytes);
}
var LineDecoder = class {
  constructor() {
    this.buffer = new Uint8Array();
    this.carriageReturnIndex = null;
  }
  decode(chunk) {
    if (chunk == null) {
      return [];
    }
    const binaryChunk = chunk instanceof ArrayBuffer ? new Uint8Array(chunk) : typeof chunk === "string" ? encodeUTF8(chunk) : chunk;
    this.buffer = concatBytes([this.buffer, binaryChunk]);
    const lines = [];
    let patternIndex;
    while ((patternIndex = findNewlineIndex(this.buffer, this.carriageReturnIndex)) != null) {
      if (patternIndex.carriage && this.carriageReturnIndex == null) {
        this.carriageReturnIndex = patternIndex.index;
        continue;
      }
      if (this.carriageReturnIndex != null && (patternIndex.index !== this.carriageReturnIndex + 1 || patternIndex.carriage)) {
        lines.push(decodeUTF8(this.buffer.subarray(0, this.carriageReturnIndex - 1)));
        this.buffer = this.buffer.subarray(this.carriageReturnIndex);
        this.carriageReturnIndex = null;
        continue;
      }
      const endIndex = this.carriageReturnIndex !== null ? patternIndex.preceding - 1 : patternIndex.preceding;
      const line = decodeUTF8(this.buffer.subarray(0, endIndex));
      lines.push(line);
      this.buffer = this.buffer.subarray(patternIndex.index);
      this.carriageReturnIndex = null;
    }
    return lines;
  }
  flush() {
    if (!this.buffer.length) {
      return [];
    }
    return this.decode("\n");
  }
};
LineDecoder.NEWLINE_CHARS = /* @__PURE__ */ new Set(["\n", "\r"]);
LineDecoder.NEWLINE_REGEXP = /\r\n|[\n\r]/g;
function findNewlineIndex(buffer, startIndex) {
  const newline = 10;
  const carriage = 13;
  for (let i = startIndex !== null && startIndex !== void 0 ? startIndex : 0; i < buffer.length; i++) {
    if (buffer[i] === newline) {
      return { preceding: i, index: i + 1, carriage: false };
    }
    if (buffer[i] === carriage) {
      return { preceding: i, index: i + 1, carriage: true };
    }
  }
  return null;
}
function findDoubleNewlineIndex(buffer) {
  const newline = 10;
  const carriage = 13;
  for (let i = 0; i < buffer.length - 1; i++) {
    if (buffer[i] === newline && buffer[i + 1] === newline) {
      return i + 2;
    }
    if (buffer[i] === carriage && buffer[i + 1] === carriage) {
      return i + 2;
    }
    if (buffer[i] === carriage && buffer[i + 1] === newline && i + 3 < buffer.length && buffer[i + 2] === carriage && buffer[i + 3] === newline) {
      return i + 4;
    }
  }
  return -1;
}
var levelNumbers = {
  off: 0,
  error: 200,
  warn: 300,
  info: 400,
  debug: 500
};
var parseLogLevel = (maybeLevel, sourceName, client) => {
  if (!maybeLevel) {
    return void 0;
  }
  if (hasOwn(levelNumbers, maybeLevel)) {
    return maybeLevel;
  }
  loggerFor(client).warn(`${sourceName} was set to ${JSON.stringify(maybeLevel)}, expected one of ${JSON.stringify(Object.keys(levelNumbers))}`);
  return void 0;
};
function noop() {
}
function makeLogFn(fnLevel, logger, logLevel) {
  if (!logger || levelNumbers[fnLevel] > levelNumbers[logLevel]) {
    return noop;
  } else {
    return logger[fnLevel].bind(logger);
  }
}
var noopLogger = {
  error: noop,
  warn: noop,
  info: noop,
  debug: noop
};
var cachedLoggers = /* @__PURE__ */ new WeakMap();
function loggerFor(client) {
  var _a2;
  const logger = client.logger;
  const logLevel = (_a2 = client.logLevel) !== null && _a2 !== void 0 ? _a2 : "off";
  if (!logger) {
    return noopLogger;
  }
  const cachedLogger = cachedLoggers.get(logger);
  if (cachedLogger && cachedLogger[0] === logLevel) {
    return cachedLogger[1];
  }
  const levelLogger = {
    error: makeLogFn("error", logger, logLevel),
    warn: makeLogFn("warn", logger, logLevel),
    info: makeLogFn("info", logger, logLevel),
    debug: makeLogFn("debug", logger, logLevel)
  };
  cachedLoggers.set(logger, [logLevel, levelLogger]);
  return levelLogger;
}
var formatRequestDetails = (details) => {
  if (details.options) {
    details.options = Object.assign({}, details.options);
    delete details.options["headers"];
  }
  if (details.headers) {
    details.headers = Object.fromEntries((details.headers instanceof Headers ? [...details.headers] : Object.entries(details.headers)).map(([name, value]) => [
      name,
      name.toLowerCase() === "x-goog-api-key" || name.toLowerCase() === "authorization" || name.toLowerCase() === "cookie" || name.toLowerCase() === "set-cookie" ? "***" : value
    ]));
  }
  if ("retryOfRequestLogID" in details) {
    if (details.retryOfRequestLogID) {
      details.retryOf = details.retryOfRequestLogID;
    }
    delete details.retryOfRequestLogID;
  }
  return details;
};
var Stream = class _Stream {
  constructor(iterator, controller, client) {
    this.iterator = iterator;
    this.controller = controller;
    this.client = client;
  }
  static fromSSEResponse(response, controller, client) {
    let consumed = false;
    const logger = client ? loggerFor(client) : console;
    function iterator() {
      return __asyncGenerator(this, arguments, function* iterator_1() {
        var _a2, e_1, _b, _c;
        if (consumed) {
          throw new GeminiNextGenAPIClientError("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");
        }
        consumed = true;
        let done = false;
        try {
          try {
            for (var _d = true, _e = __asyncValues(_iterSSEMessages(response, controller)), _f; _f = yield __await(_e.next()), _a2 = _f.done, !_a2; _d = true) {
              _c = _f.value;
              _d = false;
              const sse = _c;
              if (done)
                continue;
              if (sse.data.startsWith("[DONE]")) {
                done = true;
                continue;
              } else {
                try {
                  yield yield __await(JSON.parse(sse.data));
                } catch (e) {
                  logger.error(`Could not parse message into JSON:`, sse.data);
                  logger.error(`From chunk:`, sse.raw);
                  throw e;
                }
              }
            }
          } catch (e_1_1) {
            e_1 = { error: e_1_1 };
          } finally {
            try {
              if (!_d && !_a2 && (_b = _e.return)) yield __await(_b.call(_e));
            } finally {
              if (e_1) throw e_1.error;
            }
          }
          done = true;
        } catch (e) {
          if (isAbortError(e))
            return yield __await(void 0);
          throw e;
        } finally {
          if (!done)
            controller.abort();
        }
      });
    }
    return new _Stream(iterator, controller, client);
  }
  /**
   * Generates a Stream from a newline-separated ReadableStream
   * where each item is a JSON value.
   */
  static fromReadableStream(readableStream, controller, client) {
    let consumed = false;
    function iterLines() {
      return __asyncGenerator(this, arguments, function* iterLines_1() {
        var _a2, e_2, _b, _c;
        const lineDecoder = new LineDecoder();
        const iter = ReadableStreamToAsyncIterable(readableStream);
        try {
          for (var _d = true, iter_1 = __asyncValues(iter), iter_1_1; iter_1_1 = yield __await(iter_1.next()), _a2 = iter_1_1.done, !_a2; _d = true) {
            _c = iter_1_1.value;
            _d = false;
            const chunk = _c;
            for (const line of lineDecoder.decode(chunk)) {
              yield yield __await(line);
            }
          }
        } catch (e_2_1) {
          e_2 = { error: e_2_1 };
        } finally {
          try {
            if (!_d && !_a2 && (_b = iter_1.return)) yield __await(_b.call(iter_1));
          } finally {
            if (e_2) throw e_2.error;
          }
        }
        for (const line of lineDecoder.flush()) {
          yield yield __await(line);
        }
      });
    }
    function iterator() {
      return __asyncGenerator(this, arguments, function* iterator_2() {
        var _a2, e_3, _b, _c;
        if (consumed) {
          throw new GeminiNextGenAPIClientError("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");
        }
        consumed = true;
        let done = false;
        try {
          try {
            for (var _d = true, _e = __asyncValues(iterLines()), _f; _f = yield __await(_e.next()), _a2 = _f.done, !_a2; _d = true) {
              _c = _f.value;
              _d = false;
              const line = _c;
              if (done)
                continue;
              if (line)
                yield yield __await(JSON.parse(line));
            }
          } catch (e_3_1) {
            e_3 = { error: e_3_1 };
          } finally {
            try {
              if (!_d && !_a2 && (_b = _e.return)) yield __await(_b.call(_e));
            } finally {
              if (e_3) throw e_3.error;
            }
          }
          done = true;
        } catch (e) {
          if (isAbortError(e))
            return yield __await(void 0);
          throw e;
        } finally {
          if (!done)
            controller.abort();
        }
      });
    }
    return new _Stream(iterator, controller, client);
  }
  [Symbol.asyncIterator]() {
    return this.iterator();
  }
  /**
   * Splits the stream into two streams which can be
   * independently read from at different speeds.
   */
  tee() {
    const left = [];
    const right = [];
    const iterator = this.iterator();
    const teeIterator = (queue) => {
      return {
        next: () => {
          if (queue.length === 0) {
            const result = iterator.next();
            left.push(result);
            right.push(result);
          }
          return queue.shift();
        }
      };
    };
    return [
      new _Stream(() => teeIterator(left), this.controller, this.client),
      new _Stream(() => teeIterator(right), this.controller, this.client)
    ];
  }
  /**
   * Converts this stream to a newline-separated ReadableStream of
   * JSON stringified values in the stream
   * which can be turned back into a Stream with `Stream.fromReadableStream()`.
   */
  toReadableStream() {
    const self = this;
    let iter;
    return makeReadableStream({
      async start() {
        iter = self[Symbol.asyncIterator]();
      },
      async pull(ctrl) {
        try {
          const { value, done } = await iter.next();
          if (done)
            return ctrl.close();
          const bytes = encodeUTF8(JSON.stringify(value) + "\n");
          ctrl.enqueue(bytes);
        } catch (err) {
          ctrl.error(err);
        }
      },
      async cancel() {
        var _a2;
        await ((_a2 = iter.return) === null || _a2 === void 0 ? void 0 : _a2.call(iter));
      }
    });
  }
};
function _iterSSEMessages(response, controller) {
  return __asyncGenerator(this, arguments, function* _iterSSEMessages_1() {
    var _a2, e_4, _b, _c;
    if (!response.body) {
      controller.abort();
      if (typeof globalThis.navigator !== "undefined" && globalThis.navigator.product === "ReactNative") {
        throw new GeminiNextGenAPIClientError(`The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api`);
      }
      throw new GeminiNextGenAPIClientError(`Attempted to iterate over a response with no body`);
    }
    const sseDecoder = new SSEDecoder();
    const lineDecoder = new LineDecoder();
    const iter = ReadableStreamToAsyncIterable(response.body);
    try {
      for (var _d = true, _e = __asyncValues(iterSSEChunks(iter)), _f; _f = yield __await(_e.next()), _a2 = _f.done, !_a2; _d = true) {
        _c = _f.value;
        _d = false;
        const sseChunk = _c;
        for (const line of lineDecoder.decode(sseChunk)) {
          const sse = sseDecoder.decode(line);
          if (sse)
            yield yield __await(sse);
        }
      }
    } catch (e_4_1) {
      e_4 = { error: e_4_1 };
    } finally {
      try {
        if (!_d && !_a2 && (_b = _e.return)) yield __await(_b.call(_e));
      } finally {
        if (e_4) throw e_4.error;
      }
    }
    for (const line of lineDecoder.flush()) {
      const sse = sseDecoder.decode(line);
      if (sse)
        yield yield __await(sse);
    }
  });
}
function iterSSEChunks(iterator) {
  return __asyncGenerator(this, arguments, function* iterSSEChunks_1() {
    var _a2, e_5, _b, _c;
    let data = new Uint8Array();
    try {
      for (var _d = true, iterator_3 = __asyncValues(iterator), iterator_3_1; iterator_3_1 = yield __await(iterator_3.next()), _a2 = iterator_3_1.done, !_a2; _d = true) {
        _c = iterator_3_1.value;
        _d = false;
        const chunk = _c;
        if (chunk == null) {
          continue;
        }
        const binaryChunk = chunk instanceof ArrayBuffer ? new Uint8Array(chunk) : typeof chunk === "string" ? encodeUTF8(chunk) : chunk;
        let newData = new Uint8Array(data.length + binaryChunk.length);
        newData.set(data);
        newData.set(binaryChunk, data.length);
        data = newData;
        let patternIndex;
        while ((patternIndex = findDoubleNewlineIndex(data)) !== -1) {
          yield yield __await(data.slice(0, patternIndex));
          data = data.slice(patternIndex);
        }
      }
    } catch (e_5_1) {
      e_5 = { error: e_5_1 };
    } finally {
      try {
        if (!_d && !_a2 && (_b = iterator_3.return)) yield __await(_b.call(iterator_3));
      } finally {
        if (e_5) throw e_5.error;
      }
    }
    if (data.length > 0) {
      yield yield __await(data);
    }
  });
}
var SSEDecoder = class {
  constructor() {
    this.event = null;
    this.data = [];
    this.chunks = [];
  }
  decode(line) {
    if (line.endsWith("\r")) {
      line = line.substring(0, line.length - 1);
    }
    if (!line) {
      if (!this.event && !this.data.length)
        return null;
      const sse = {
        event: this.event,
        data: this.data.join("\n"),
        raw: this.chunks
      };
      this.event = null;
      this.data = [];
      this.chunks = [];
      return sse;
    }
    this.chunks.push(line);
    if (line.startsWith(":")) {
      return null;
    }
    let [fieldname, _, value] = partition(line, ":");
    if (value.startsWith(" ")) {
      value = value.substring(1);
    }
    if (fieldname === "event") {
      this.event = value;
    } else if (fieldname === "data") {
      this.data.push(value);
    }
    return null;
  }
};
function partition(str, delimiter) {
  const index = str.indexOf(delimiter);
  if (index !== -1) {
    return [str.substring(0, index), delimiter, str.substring(index + delimiter.length)];
  }
  return [str, "", ""];
}
async function defaultParseResponse(client, props) {
  const { response, requestLogID, retryOfRequestLogID, startTime } = props;
  const body = await (async () => {
    var _a2;
    if (props.options.stream) {
      loggerFor(client).debug("response", response.status, response.url, response.headers, response.body);
      if (props.options.__streamClass) {
        return props.options.__streamClass.fromSSEResponse(response, props.controller, client);
      }
      return Stream.fromSSEResponse(response, props.controller, client);
    }
    if (response.status === 204) {
      return null;
    }
    if (props.options.__binaryResponse) {
      return response;
    }
    const contentType = response.headers.get("content-type");
    const mediaType = (_a2 = contentType === null || contentType === void 0 ? void 0 : contentType.split(";")[0]) === null || _a2 === void 0 ? void 0 : _a2.trim();
    const isJSON = (mediaType === null || mediaType === void 0 ? void 0 : mediaType.includes("application/json")) || (mediaType === null || mediaType === void 0 ? void 0 : mediaType.endsWith("+json"));
    if (isJSON) {
      const json = await response.json();
      return json;
    }
    const text = await response.text();
    return text;
  })();
  loggerFor(client).debug(`[${requestLogID}] response parsed`, formatRequestDetails({
    retryOfRequestLogID,
    url: response.url,
    status: response.status,
    body,
    durationMs: Date.now() - startTime
  }));
  return body;
}
var APIPromise = class _APIPromise extends Promise {
  constructor(client, responsePromise, parseResponse = defaultParseResponse) {
    super((resolve) => {
      resolve(null);
    });
    this.responsePromise = responsePromise;
    this.parseResponse = parseResponse;
    this.client = client;
  }
  _thenUnwrap(transform) {
    return new _APIPromise(this.client, this.responsePromise, async (client, props) => transform(await this.parseResponse(client, props), props));
  }
  /**
   * Gets the raw `Response` instance instead of parsing the response
   * data.
   *
   * If you want to parse the response body but still get the `Response`
   * instance, you can use {@link withResponse()}.
   *
   * 👋 Getting the wrong TypeScript type for `Response`?
   * Try setting `"moduleResolution": "NodeNext"` or add `"lib": ["DOM"]`
   * to your `tsconfig.json`.
   */
  asResponse() {
    return this.responsePromise.then((p) => p.response);
  }
  /**
   * Gets the parsed response data and the raw `Response` instance.
   *
   * If you just want to get the raw `Response` instance without parsing it,
   * you can use {@link asResponse()}.
   *
   * 👋 Getting the wrong TypeScript type for `Response`?
   * Try setting `"moduleResolution": "NodeNext"` or add `"lib": ["DOM"]`
   * to your `tsconfig.json`.
   */
  async withResponse() {
    const [data, response] = await Promise.all([this.parse(), this.asResponse()]);
    return { data, response };
  }
  parse() {
    if (!this.parsedPromise) {
      this.parsedPromise = this.responsePromise.then((data) => this.parseResponse(this.client, data));
    }
    return this.parsedPromise;
  }
  then(onfulfilled, onrejected) {
    return this.parse().then(onfulfilled, onrejected);
  }
  catch(onrejected) {
    return this.parse().catch(onrejected);
  }
  finally(onfinally) {
    return this.parse().finally(onfinally);
  }
};
var brand_privateNullableHeaders = /* @__PURE__ */ Symbol("brand.privateNullableHeaders");
function* iterateHeaders(headers) {
  if (!headers)
    return;
  if (brand_privateNullableHeaders in headers) {
    const { values, nulls } = headers;
    yield* values.entries();
    for (const name of nulls) {
      yield [name, null];
    }
    return;
  }
  let shouldClear = false;
  let iter;
  if (headers instanceof Headers) {
    iter = headers.entries();
  } else if (isReadonlyArray(headers)) {
    iter = headers;
  } else {
    shouldClear = true;
    iter = Object.entries(headers !== null && headers !== void 0 ? headers : {});
  }
  for (let row of iter) {
    const name = row[0];
    if (typeof name !== "string")
      throw new TypeError("expected header name to be a string");
    const values = isReadonlyArray(row[1]) ? row[1] : [row[1]];
    let didClear = false;
    for (const value of values) {
      if (value === void 0)
        continue;
      if (shouldClear && !didClear) {
        didClear = true;
        yield [name, null];
      }
      yield [name, value];
    }
  }
}
var buildHeaders = (newHeaders) => {
  const targetHeaders = new Headers();
  const nullHeaders = /* @__PURE__ */ new Set();
  for (const headers of newHeaders) {
    const seenHeaders = /* @__PURE__ */ new Set();
    for (const [name, value] of iterateHeaders(headers)) {
      const lowerName = name.toLowerCase();
      if (!seenHeaders.has(lowerName)) {
        targetHeaders.delete(name);
        seenHeaders.add(lowerName);
      }
      if (value === null) {
        targetHeaders.delete(name);
        nullHeaders.add(lowerName);
      } else {
        targetHeaders.append(name, value);
        nullHeaders.delete(lowerName);
      }
    }
  }
  return { [brand_privateNullableHeaders]: true, values: targetHeaders, nulls: nullHeaders };
};
var readEnv = (env) => {
  var _a2, _b, _c, _d, _e, _f;
  if (typeof globalThis.process !== "undefined") {
    return (_c = (_b = (_a2 = globalThis.process.env) === null || _a2 === void 0 ? void 0 : _a2[env]) === null || _b === void 0 ? void 0 : _b.trim()) !== null && _c !== void 0 ? _c : void 0;
  }
  if (typeof globalThis.Deno !== "undefined") {
    return (_f = (_e = (_d = globalThis.Deno.env) === null || _d === void 0 ? void 0 : _d.get) === null || _e === void 0 ? void 0 : _e.call(_d, env)) === null || _f === void 0 ? void 0 : _f.trim();
  }
  return void 0;
};
var _a;
var BaseGeminiNextGenAPIClient = class _BaseGeminiNextGenAPIClient {
  /**
   * API Client for interfacing with the Gemini Next Gen API API.
   *
   * @param {string | null | undefined} [opts.apiKey=process.env['GEMINI_API_KEY'] ?? null]
   * @param {string | undefined} [opts.apiVersion=v1beta]
   * @param {string} [opts.baseURL=process.env['GEMINI_NEXT_GEN_API_BASE_URL'] ?? https://generativelanguage.googleapis.com] - Override the default base URL for the API.
   * @param {number} [opts.timeout=1 minute] - The maximum amount of time (in milliseconds) the client will wait for a response before timing out.
   * @param {MergedRequestInit} [opts.fetchOptions] - Additional `RequestInit` options to be passed to `fetch` calls.
   * @param {Fetch} [opts.fetch] - Specify a custom `fetch` function implementation.
   * @param {number} [opts.maxRetries=2] - The maximum number of times the client will retry a request.
   * @param {HeadersLike} opts.defaultHeaders - Default headers to include with every request to the API.
   * @param {Record<string, string | undefined>} opts.defaultQuery - Default query parameters to include with every request to the API.
   */
  constructor(_b) {
    var _c, _d, _e, _f, _g, _h, _j;
    var { baseURL = readEnv("GEMINI_NEXT_GEN_API_BASE_URL"), apiKey = (_c = readEnv("GEMINI_API_KEY")) !== null && _c !== void 0 ? _c : null, apiVersion = "v1beta" } = _b, opts = __rest(_b, ["baseURL", "apiKey", "apiVersion"]);
    const options = Object.assign(Object.assign({
      apiKey,
      apiVersion
    }, opts), { baseURL: baseURL || `https://generativelanguage.googleapis.com` });
    this.baseURL = options.baseURL;
    this.timeout = (_d = options.timeout) !== null && _d !== void 0 ? _d : _BaseGeminiNextGenAPIClient.DEFAULT_TIMEOUT;
    this.logger = (_e = options.logger) !== null && _e !== void 0 ? _e : console;
    const defaultLogLevel = "warn";
    this.logLevel = defaultLogLevel;
    this.logLevel = (_g = (_f = parseLogLevel(options.logLevel, "ClientOptions.logLevel", this)) !== null && _f !== void 0 ? _f : parseLogLevel(readEnv("GEMINI_NEXT_GEN_API_LOG"), "process.env['GEMINI_NEXT_GEN_API_LOG']", this)) !== null && _g !== void 0 ? _g : defaultLogLevel;
    this.fetchOptions = options.fetchOptions;
    this.maxRetries = (_h = options.maxRetries) !== null && _h !== void 0 ? _h : 2;
    this.fetch = (_j = options.fetch) !== null && _j !== void 0 ? _j : getDefaultFetch();
    this.encoder = FallbackEncoder;
    this._options = options;
    this.apiKey = apiKey;
    this.apiVersion = apiVersion;
    this.clientAdapter = options.clientAdapter;
  }
  /**
   * Create a new client instance re-using the same options given to the current client with optional overriding.
   */
  withOptions(options) {
    const client = new this.constructor(Object.assign(Object.assign(Object.assign({}, this._options), { baseURL: this.baseURL, maxRetries: this.maxRetries, timeout: this.timeout, logger: this.logger, logLevel: this.logLevel, fetch: this.fetch, fetchOptions: this.fetchOptions, apiKey: this.apiKey, apiVersion: this.apiVersion }), options));
    return client;
  }
  /**
   * Check whether the base URL is set to its default.
   */
  baseURLOverridden() {
    return this.baseURL !== "https://generativelanguage.googleapis.com";
  }
  defaultQuery() {
    return this._options.defaultQuery;
  }
  validateHeaders({ values, nulls }) {
    if (values.has("authorization") || values.has("x-goog-api-key")) {
      return;
    }
    if (this.apiKey && values.get("x-goog-api-key")) {
      return;
    }
    if (nulls.has("x-goog-api-key")) {
      return;
    }
    throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted');
  }
  async authHeaders(opts) {
    const existingHeaders = buildHeaders([opts.headers]);
    if (existingHeaders.values.has("authorization") || existingHeaders.values.has("x-goog-api-key")) {
      return void 0;
    }
    if (this.apiKey) {
      return buildHeaders([{ "x-goog-api-key": this.apiKey }]);
    }
    if (this.clientAdapter.isVertexAI()) {
      return buildHeaders([await this.clientAdapter.getAuthHeaders()]);
    }
    return void 0;
  }
  /**
   * Basic re-implementation of `qs.stringify` for primitive types.
   */
  stringifyQuery(query) {
    return Object.entries(query).filter(([_, value]) => typeof value !== "undefined").map(([key, value]) => {
      if (typeof value === "string" || typeof value === "number" || typeof value === "boolean") {
        return `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;
      }
      if (value === null) {
        return `${encodeURIComponent(key)}=`;
      }
      throw new GeminiNextGenAPIClientError(`Cannot stringify type ${typeof value}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`);
    }).join("&");
  }
  getUserAgent() {
    return `${this.constructor.name}/JS ${VERSION}`;
  }
  defaultIdempotencyKey() {
    return `stainless-node-retry-${uuid4()}`;
  }
  makeStatusError(status, error, message, headers) {
    return APIError.generate(status, error, message, headers);
  }
  buildURL(path2, query, defaultBaseURL) {
    const baseURL = !this.baseURLOverridden() && defaultBaseURL || this.baseURL;
    const url = isAbsoluteURL(path2) ? new URL(path2) : new URL(baseURL + (baseURL.endsWith("/") && path2.startsWith("/") ? path2.slice(1) : path2));
    const defaultQuery = this.defaultQuery();
    if (!isEmptyObj(defaultQuery)) {
      query = Object.assign(Object.assign({}, defaultQuery), query);
    }
    if (typeof query === "object" && query && !Array.isArray(query)) {
      url.search = this.stringifyQuery(query);
    }
    return url.toString();
  }
  /**
     * Used as a callback for mutating the given `FinalRequestOptions` object.
  
     */
  async prepareOptions(options) {
    if (this.clientAdapter && this.clientAdapter.isVertexAI() && !options.path.startsWith(`/${this.apiVersion}/projects/`)) {
      const oldPath = options.path.slice(this.apiVersion.length + 1);
      options.path = `/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${oldPath}`;
    }
  }
  /**
   * Used as a callback for mutating the given `RequestInit` object.
   *
   * This is useful for cases where you want to add certain headers based off of
   * the request properties, e.g. `method` or `url`.
   */
  async prepareRequest(request, { url, options }) {
  }
  get(path2, opts) {
    return this.methodRequest("get", path2, opts);
  }
  post(path2, opts) {
    return this.methodRequest("post", path2, opts);
  }
  patch(path2, opts) {
    return this.methodRequest("patch", path2, opts);
  }
  put(path2, opts) {
    return this.methodRequest("put", path2, opts);
  }
  delete(path2, opts) {
    return this.methodRequest("delete", path2, opts);
  }
  methodRequest(method, path2, opts) {
    return this.request(Promise.resolve(opts).then((opts2) => {
      return Object.assign({ method, path: path2 }, opts2);
    }));
  }
  request(options, remainingRetries = null) {
    return new APIPromise(this, this.makeRequest(options, remainingRetries, void 0));
  }
  async makeRequest(optionsInput, retriesRemaining, retryOfRequestLogID) {
    var _b, _c, _d;
    const options = await optionsInput;
    const maxRetries = (_b = options.maxRetries) !== null && _b !== void 0 ? _b : this.maxRetries;
    if (retriesRemaining == null) {
      retriesRemaining = maxRetries;
    }
    await this.prepareOptions(options);
    const { req, url, timeout } = await this.buildRequest(options, {
      retryCount: maxRetries - retriesRemaining
    });
    await this.prepareRequest(req, { url, options });
    const requestLogID = "log_" + (Math.random() * (1 << 24) | 0).toString(16).padStart(6, "0");
    const retryLogStr = retryOfRequestLogID === void 0 ? "" : `, retryOf: ${retryOfRequestLogID}`;
    const startTime = Date.now();
    loggerFor(this).debug(`[${requestLogID}] sending request`, formatRequestDetails({
      retryOfRequestLogID,
      method: options.method,
      url,
      options,
      headers: req.headers
    }));
    if ((_c = options.signal) === null || _c === void 0 ? void 0 : _c.aborted) {
      throw new APIUserAbortError();
    }
    const controller = new AbortController();
    const response = await this.fetchWithTimeout(url, req, timeout, controller).catch(castToError);
    const headersTime = Date.now();
    if (response instanceof globalThis.Error) {
      const retryMessage = `retrying, ${retriesRemaining} attempts remaining`;
      if ((_d = options.signal) === null || _d === void 0 ? void 0 : _d.aborted) {
        throw new APIUserAbortError();
      }
      const isTimeout = isAbortError(response) || /timed? ?out/i.test(String(response) + ("cause" in response ? String(response.cause) : ""));
      if (retriesRemaining) {
        loggerFor(this).info(`[${requestLogID}] connection ${isTimeout ? "timed out" : "failed"} - ${retryMessage}`);
        loggerFor(this).debug(`[${requestLogID}] connection ${isTimeout ? "timed out" : "failed"} (${retryMessage})`, formatRequestDetails({
          retryOfRequestLogID,
          url,
          durationMs: headersTime - startTime,
          message: response.message
        }));
        return this.retryRequest(options, retriesRemaining, retryOfRequestLogID !== null && retryOfRequestLogID !== void 0 ? retryOfRequestLogID : requestLogID);
      }
      loggerFor(this).info(`[${requestLogID}] connection ${isTimeout ? "timed out" : "failed"} - error; no more retries left`);
      loggerFor(this).debug(`[${requestLogID}] connection ${isTimeout ? "timed out" : "failed"} (error; no more retries left)`, formatRequestDetails({
        retryOfRequestLogID,
        url,
        durationMs: headersTime - startTime,
        message: response.message
      }));
      if (isTimeout) {
        throw new APIConnectionTimeoutError();
      }
      throw new APIConnectionError({ cause: response });
    }
    const responseInfo = `[${requestLogID}${retryLogStr}] ${req.method} ${url} ${response.ok ? "succeeded" : "failed"} with status ${response.status} in ${headersTime - startTime}ms`;
    if (!response.ok) {
      const shouldRetry = await this.shouldRetry(response);
      if (retriesRemaining && shouldRetry) {
        const retryMessage2 = `retrying, ${retriesRemaining} attempts remaining`;
        await CancelReadableStream(response.body);
        loggerFor(this).info(`${responseInfo} - ${retryMessage2}`);
        loggerFor(this).debug(`[${requestLogID}] response error (${retryMessage2})`, formatRequestDetails({
          retryOfRequestLogID,
          url: response.url,
          status: response.status,
          headers: response.headers,
          durationMs: headersTime - startTime
        }));
        return this.retryRequest(options, retriesRemaining, retryOfRequestLogID !== null && retryOfRequestLogID !== void 0 ? retryOfRequestLogID : requestLogID, response.headers);
      }
      const retryMessage = shouldRetry ? `error; no more retries left` : `error; not retryable`;
      loggerFor(this).info(`${responseInfo} - ${retryMessage}`);
      const errText = await response.text().catch((err2) => castToError(err2).message);
      const errJSON = safeJSON(errText);
      const errMessage = errJSON ? void 0 : errText;
      loggerFor(this).debug(`[${requestLogID}] response error (${retryMessage})`, formatRequestDetails({
        retryOfRequestLogID,
        url: response.url,
        status: response.status,
        headers: response.headers,
        message: errMessage,
        durationMs: Date.now() - startTime
      }));
      const err = this.makeStatusError(response.status, errJSON, errMessage, response.headers);
      throw err;
    }
    loggerFor(this).info(responseInfo);
    loggerFor(this).debug(`[${requestLogID}] response start`, formatRequestDetails({
      retryOfRequestLogID,
      url: response.url,
      status: response.status,
      headers: response.headers,
      durationMs: headersTime - startTime
    }));
    return { response, options, controller, requestLogID, retryOfRequestLogID, startTime };
  }
  async fetchWithTimeout(url, init, ms, controller) {
    const _b = init || {}, { signal: signal2, method } = _b, options = __rest(_b, ["signal", "method"]);
    if (signal2)
      signal2.addEventListener("abort", () => controller.abort());
    const timeout = setTimeout(() => controller.abort(), ms);
    const isReadableBody = globalThis.ReadableStream && options.body instanceof globalThis.ReadableStream || typeof options.body === "object" && options.body !== null && Symbol.asyncIterator in options.body;
    const fetchOptions = Object.assign(Object.assign(Object.assign({ signal: controller.signal }, isReadableBody ? { duplex: "half" } : {}), { method: "GET" }), options);
    if (method) {
      fetchOptions.method = method.toUpperCase();
    }
    try {
      return await this.fetch.call(void 0, url, fetchOptions);
    } finally {
      clearTimeout(timeout);
    }
  }
  async shouldRetry(response) {
    const shouldRetryHeader = response.headers.get("x-should-retry");
    if (shouldRetryHeader === "true")
      return true;
    if (shouldRetryHeader === "false")
      return false;
    if (response.status === 408)
      return true;
    if (response.status === 409)
      return true;
    if (response.status === 429)
      return true;
    if (response.status >= 500)
      return true;
    return false;
  }
  async retryRequest(options, retriesRemaining, requestLogID, responseHeaders) {
    var _b;
    let timeoutMillis;
    const retryAfterMillisHeader = responseHeaders === null || responseHeaders === void 0 ? void 0 : responseHeaders.get("retry-after-ms");
    if (retryAfterMillisHeader) {
      const timeoutMs = parseFloat(retryAfterMillisHeader);
      if (!Number.isNaN(timeoutMs)) {
        timeoutMillis = timeoutMs;
      }
    }
    const retryAfterHeader = responseHeaders === null || responseHeaders === void 0 ? void 0 : responseHeaders.get("retry-after");
    if (retryAfterHeader && !timeoutMillis) {
      const timeoutSeconds = parseFloat(retryAfterHeader);
      if (!Number.isNaN(timeoutSeconds)) {
        timeoutMillis = timeoutSeconds * 1e3;
      } else {
        timeoutMillis = Date.parse(retryAfterHeader) - Date.now();
      }
    }
    if (!(timeoutMillis && 0 <= timeoutMillis && timeoutMillis < 60 * 1e3)) {
      const maxRetries = (_b = options.maxRetries) !== null && _b !== void 0 ? _b : this.maxRetries;
      timeoutMillis = this.calculateDefaultRetryTimeoutMillis(retriesRemaining, maxRetries);
    }
    await sleep$1(timeoutMillis);
    return this.makeRequest(options, retriesRemaining - 1, requestLogID);
  }
  calculateDefaultRetryTimeoutMillis(retriesRemaining, maxRetries) {
    const initialRetryDelay = 0.5;
    const maxRetryDelay = 8;
    const numRetries = maxRetries - retriesRemaining;
    const sleepSeconds = Math.min(initialRetryDelay * Math.pow(2, numRetries), maxRetryDelay);
    const jitter = 1 - Math.random() * 0.25;
    return sleepSeconds * jitter * 1e3;
  }
  async buildRequest(inputOptions, { retryCount = 0 } = {}) {
    var _b, _c, _d;
    const options = Object.assign({}, inputOptions);
    const { method, path: path2, query, defaultBaseURL } = options;
    const url = this.buildURL(path2, query, defaultBaseURL);
    if ("timeout" in options)
      validatePositiveInteger("timeout", options.timeout);
    options.timeout = (_b = options.timeout) !== null && _b !== void 0 ? _b : this.timeout;
    const { bodyHeaders, body } = this.buildBody({ options });
    const reqHeaders = await this.buildHeaders({ options: inputOptions, method, bodyHeaders, retryCount });
    const req = Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({ method, headers: reqHeaders }, options.signal && { signal: options.signal }), globalThis.ReadableStream && body instanceof globalThis.ReadableStream && { duplex: "half" }), body && { body }), (_c = this.fetchOptions) !== null && _c !== void 0 ? _c : {}), (_d = options.fetchOptions) !== null && _d !== void 0 ? _d : {});
    return { req, url, timeout: options.timeout };
  }
  async buildHeaders({ options, method, bodyHeaders, retryCount }) {
    let idempotencyHeaders = {};
    if (this.idempotencyHeader && method !== "get") {
      if (!options.idempotencyKey)
        options.idempotencyKey = this.defaultIdempotencyKey();
      idempotencyHeaders[this.idempotencyHeader] = options.idempotencyKey;
    }
    const authHeaders = await this.authHeaders(options);
    let headers = buildHeaders([
      idempotencyHeaders,
      Object.assign(Object.assign({ Accept: "application/json", "User-Agent": this.getUserAgent(), "X-Stainless-Retry-Count": String(retryCount) }, options.timeout ? { "X-Stainless-Timeout": String(Math.trunc(options.timeout / 1e3)) } : {}), getPlatformHeaders()),
      this._options.defaultHeaders,
      bodyHeaders,
      options.headers,
      authHeaders
    ]);
    this.validateHeaders(headers);
    return headers.values;
  }
  buildBody({ options: { body, headers: rawHeaders } }) {
    if (!body) {
      return { bodyHeaders: void 0, body: void 0 };
    }
    const headers = buildHeaders([rawHeaders]);
    if (
      // Pass raw type verbatim
      ArrayBuffer.isView(body) || body instanceof ArrayBuffer || body instanceof DataView || typeof body === "string" && // Preserve legacy string encoding behavior for now
      headers.values.has("content-type") || // `Blob` is superset of `File`
      globalThis.Blob && body instanceof globalThis.Blob || // `FormData` -> `multipart/form-data`
      body instanceof FormData || // `URLSearchParams` -> `application/x-www-form-urlencoded`
      body instanceof URLSearchParams || // Send chunked stream (each chunk has own `length`)
      globalThis.ReadableStream && body instanceof globalThis.ReadableStream
    ) {
      return { bodyHeaders: void 0, body };
    } else if (typeof body === "object" && (Symbol.asyncIterator in body || Symbol.iterator in body && "next" in body && typeof body.next === "function")) {
      return { bodyHeaders: void 0, body: ReadableStreamFrom(body) };
    } else {
      return this.encoder({ body, headers });
    }
  }
};
BaseGeminiNextGenAPIClient.DEFAULT_TIMEOUT = 6e4;
var GeminiNextGenAPIClient = class extends BaseGeminiNextGenAPIClient {
  constructor() {
    super(...arguments);
    this.interactions = new Interactions(this);
  }
};
_a = GeminiNextGenAPIClient;
GeminiNextGenAPIClient.GeminiNextGenAPIClient = _a;
GeminiNextGenAPIClient.GeminiNextGenAPIClientError = GeminiNextGenAPIClientError;
GeminiNextGenAPIClient.APIError = APIError;
GeminiNextGenAPIClient.APIConnectionError = APIConnectionError;
GeminiNextGenAPIClient.APIConnectionTimeoutError = APIConnectionTimeoutError;
GeminiNextGenAPIClient.APIUserAbortError = APIUserAbortError;
GeminiNextGenAPIClient.NotFoundError = NotFoundError;
GeminiNextGenAPIClient.ConflictError = ConflictError;
GeminiNextGenAPIClient.RateLimitError = RateLimitError;
GeminiNextGenAPIClient.BadRequestError = BadRequestError;
GeminiNextGenAPIClient.AuthenticationError = AuthenticationError;
GeminiNextGenAPIClient.InternalServerError = InternalServerError;
GeminiNextGenAPIClient.PermissionDeniedError = PermissionDeniedError;
GeminiNextGenAPIClient.UnprocessableEntityError = UnprocessableEntityError;
GeminiNextGenAPIClient.toFile = toFile;
GeminiNextGenAPIClient.Interactions = Interactions;
function cancelTuningJobParametersToMldev(fromObject, _rootObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], fromName);
  }
  return toObject;
}
function cancelTuningJobParametersToVertex(fromObject, _rootObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], fromName);
  }
  return toObject;
}
function cancelTuningJobResponseFromMldev(fromObject, _rootObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  return toObject;
}
function cancelTuningJobResponseFromVertex(fromObject, _rootObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  return toObject;
}
function createTuningJobConfigToMldev(fromObject, parentObject, _rootObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["validationDataset"]) !== void 0) {
    throw new Error("validationDataset parameter is not supported in Gemini API.");
  }
  const fromTunedModelDisplayName = getValueByPath(fromObject, [
    "tunedModelDisplayName"
  ]);
  if (parentObject !== void 0 && fromTunedModelDisplayName != null) {
    setValueByPath(parentObject, ["displayName"], fromTunedModelDisplayName);
  }
  if (getValueByPath(fromObject, ["description"]) !== void 0) {
    throw new Error("description parameter is not supported in Gemini API.");
  }
  const fromEpochCount = getValueByPath(fromObject, ["epochCount"]);
  if (parentObject !== void 0 && fromEpochCount != null) {
    setValueByPath(parentObject, ["tuningTask", "hyperparameters", "epochCount"], fromEpochCount);
  }
  const fromLearningRateMultiplier = getValueByPath(fromObject, [
    "learningRateMultiplier"
  ]);
  if (fromLearningRateMultiplier != null) {
    setValueByPath(toObject, ["tuningTask", "hyperparameters", "learningRateMultiplier"], fromLearningRateMultiplier);
  }
  if (getValueByPath(fromObject, ["exportLastCheckpointOnly"]) !== void 0) {
    throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["preTunedModelCheckpointId"]) !== void 0) {
    throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["adapterSize"]) !== void 0) {
    throw new Error("adapterSize parameter is not supported in Gemini API.");
  }
  const fromBatchSize = getValueByPath(fromObject, ["batchSize"]);
  if (parentObject !== void 0 && fromBatchSize != null) {
    setValueByPath(parentObject, ["tuningTask", "hyperparameters", "batchSize"], fromBatchSize);
  }
  const fromLearningRate = getValueByPath(fromObject, ["learningRate"]);
  if (parentObject !== void 0 && fromLearningRate != null) {
    setValueByPath(parentObject, ["tuningTask", "hyperparameters", "learningRate"], fromLearningRate);
  }
  if (getValueByPath(fromObject, ["labels"]) !== void 0) {
    throw new Error("labels parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["beta"]) !== void 0) {
    throw new Error("beta parameter is not supported in Gemini API.");
  }
  return toObject;
}
function createTuningJobConfigToVertex(fromObject, parentObject, rootObject) {
  const toObject = {};
  let discriminatorValidationDataset = getValueByPath(rootObject, [
    "config",
    "method"
  ]);
  if (discriminatorValidationDataset === void 0) {
    discriminatorValidationDataset = "SUPERVISED_FINE_TUNING";
  }
  if (discriminatorValidationDataset === "SUPERVISED_FINE_TUNING") {
    const fromValidationDataset = getValueByPath(fromObject, [
      "validationDataset"
    ]);
    if (parentObject !== void 0 && fromValidationDataset != null) {
      setValueByPath(parentObject, ["supervisedTuningSpec"], tuningValidationDatasetToVertex(fromValidationDataset));
    }
  } else if (discriminatorValidationDataset === "PREFERENCE_TUNING") {
    const fromValidationDataset = getValueByPath(fromObject, [
      "validationDataset"
    ]);
    if (parentObject !== void 0 && fromValidationDataset != null) {
      setValueByPath(parentObject, ["preferenceOptimizationSpec"], tuningValidationDatasetToVertex(fromValidationDataset));
    }
  }
  const fromTunedModelDisplayName = getValueByPath(fromObject, [
    "tunedModelDisplayName"
  ]);
  if (parentObject !== void 0 && fromTunedModelDisplayName != null) {
    setValueByPath(parentObject, ["tunedModelDisplayName"], fromTunedModelDisplayName);
  }
  const fromDescription = getValueByPath(fromObject, ["description"]);
  if (parentObject !== void 0 && fromDescription != null) {
    setValueByPath(parentObject, ["description"], fromDescription);
  }
  let discriminatorEpochCount = getValueByPath(rootObject, [
    "config",
    "method"
  ]);
  if (discriminatorEpochCount === void 0) {
    discriminatorEpochCount = "SUPERVISED_FINE_TUNING";
  }
  if (discriminatorEpochCount === "SUPERVISED_FINE_TUNING") {
    const fromEpochCount = getValueByPath(fromObject, ["epochCount"]);
    if (parentObject !== void 0 && fromEpochCount != null) {
      setValueByPath(parentObject, ["supervisedTuningSpec", "hyperParameters", "epochCount"], fromEpochCount);
    }
  } else if (discriminatorEpochCount === "PREFERENCE_TUNING") {
    const fromEpochCount = getValueByPath(fromObject, ["epochCount"]);
    if (parentObject !== void 0 && fromEpochCount != null) {
      setValueByPath(parentObject, ["preferenceOptimizationSpec", "hyperParameters", "epochCount"], fromEpochCount);
    }
  }
  let discriminatorLearningRateMultiplier = getValueByPath(rootObject, [
    "config",
    "method"
  ]);
  if (discriminatorLearningRateMultiplier === void 0) {
    discriminatorLearningRateMultiplier = "SUPERVISED_FINE_TUNING";
  }
  if (discriminatorLearningRateMultiplier === "SUPERVISED_FINE_TUNING") {
    const fromLearningRateMultiplier = getValueByPath(fromObject, [
      "learningRateMultiplier"
    ]);
    if (parentObject !== void 0 && fromLearningRateMultiplier != null) {
      setValueByPath(parentObject, ["supervisedTuningSpec", "hyperParameters", "learningRateMultiplier"], fromLearningRateMultiplier);
    }
  } else if (discriminatorLearningRateMultiplier === "PREFERENCE_TUNING") {
    const fromLearningRateMultiplier = getValueByPath(fromObject, [
      "learningRateMultiplier"
    ]);
    if (parentObject !== void 0 && fromLearningRateMultiplier != null) {
      setValueByPath(parentObject, [
        "preferenceOptimizationSpec",
        "hyperParameters",
        "learningRateMultiplier"
      ], fromLearningRateMultiplier);
    }
  }
  let discriminatorExportLastCheckpointOnly = getValueByPath(rootObject, ["config", "method"]);
  if (discriminatorExportLastCheckpointOnly === void 0) {
    discriminatorExportLastCheckpointOnly = "SUPERVISED_FINE_TUNING";
  }
  if (discriminatorExportLastCheckpointOnly === "SUPERVISED_FINE_TUNING") {
    const fromExportLastCheckpointOnly = getValueByPath(fromObject, [
      "exportLastCheckpointOnly"
    ]);
    if (parentObject !== void 0 && fromExportLastCheckpointOnly != null) {
      setValueByPath(parentObject, ["supervisedTuningSpec", "exportLastCheckpointOnly"], fromExportLastCheckpointOnly);
    }
  } else if (discriminatorExportLastCheckpointOnly === "PREFERENCE_TUNING") {
    const fromExportLastCheckpointOnly = getValueByPath(fromObject, [
      "exportLastCheckpointOnly"
    ]);
    if (parentObject !== void 0 && fromExportLastCheckpointOnly != null) {
      setValueByPath(parentObject, ["preferenceOptimizationSpec", "exportLastCheckpointOnly"], fromExportLastCheckpointOnly);
    }
  }
  let discriminatorAdapterSize = getValueByPath(rootObject, [
    "config",
    "method"
  ]);
  if (discriminatorAdapterSize === void 0) {
    discriminatorAdapterSize = "SUPERVISED_FINE_TUNING";
  }
  if (discriminatorAdapterSize === "SUPERVISED_FINE_TUNING") {
    const fromAdapterSize = getValueByPath(fromObject, ["adapterSize"]);
    if (parentObject !== void 0 && fromAdapterSize != null) {
      setValueByPath(parentObject, ["supervisedTuningSpec", "hyperParameters", "adapterSize"], fromAdapterSize);
    }
  } else if (discriminatorAdapterSize === "PREFERENCE_TUNING") {
    const fromAdapterSize = getValueByPath(fromObject, ["adapterSize"]);
    if (parentObject !== void 0 && fromAdapterSize != null) {
      setValueByPath(parentObject, ["preferenceOptimizationSpec", "hyperParameters", "adapterSize"], fromAdapterSize);
    }
  }
  if (getValueByPath(fromObject, ["batchSize"]) !== void 0) {
    throw new Error("batchSize parameter is not supported in Vertex AI.");
  }
  if (getValueByPath(fromObject, ["learningRate"]) !== void 0) {
    throw new Error("learningRate parameter is not supported in Vertex AI.");
  }
  const fromLabels = getValueByPath(fromObject, ["labels"]);
  if (parentObject !== void 0 && fromLabels != null) {
    setValueByPath(parentObject, ["labels"], fromLabels);
  }
  const fromBeta = getValueByPath(fromObject, ["beta"]);
  if (parentObject !== void 0 && fromBeta != null) {
    setValueByPath(parentObject, ["preferenceOptimizationSpec", "hyperParameters", "beta"], fromBeta);
  }
  return toObject;
}
function createTuningJobParametersPrivateToMldev(fromObject, rootObject) {
  const toObject = {};
  const fromBaseModel = getValueByPath(fromObject, ["baseModel"]);
  if (fromBaseModel != null) {
    setValueByPath(toObject, ["baseModel"], fromBaseModel);
  }
  const fromPreTunedModel = getValueByPath(fromObject, [
    "preTunedModel"
  ]);
  if (fromPreTunedModel != null) {
    setValueByPath(toObject, ["preTunedModel"], fromPreTunedModel);
  }
  const fromTrainingDataset = getValueByPath(fromObject, [
    "trainingDataset"
  ]);
  if (fromTrainingDataset != null) {
    tuningDatasetToMldev(fromTrainingDataset);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    createTuningJobConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function createTuningJobParametersPrivateToVertex(fromObject, rootObject) {
  const toObject = {};
  const fromBaseModel = getValueByPath(fromObject, ["baseModel"]);
  if (fromBaseModel != null) {
    setValueByPath(toObject, ["baseModel"], fromBaseModel);
  }
  const fromPreTunedModel = getValueByPath(fromObject, [
    "preTunedModel"
  ]);
  if (fromPreTunedModel != null) {
    setValueByPath(toObject, ["preTunedModel"], fromPreTunedModel);
  }
  const fromTrainingDataset = getValueByPath(fromObject, [
    "trainingDataset"
  ]);
  if (fromTrainingDataset != null) {
    tuningDatasetToVertex(fromTrainingDataset, toObject, rootObject);
  }
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    createTuningJobConfigToVertex(fromConfig, toObject, rootObject);
  }
  return toObject;
}
function getTuningJobParametersToMldev(fromObject, _rootObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], fromName);
  }
  return toObject;
}
function getTuningJobParametersToVertex(fromObject, _rootObject) {
  const toObject = {};
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["_url", "name"], fromName);
  }
  return toObject;
}
function listTuningJobsConfigToMldev(fromObject, parentObject, _rootObject) {
  const toObject = {};
  const fromPageSize = getValueByPath(fromObject, ["pageSize"]);
  if (parentObject !== void 0 && fromPageSize != null) {
    setValueByPath(parentObject, ["_query", "pageSize"], fromPageSize);
  }
  const fromPageToken = getValueByPath(fromObject, ["pageToken"]);
  if (parentObject !== void 0 && fromPageToken != null) {
    setValueByPath(parentObject, ["_query", "pageToken"], fromPageToken);
  }
  const fromFilter = getValueByPath(fromObject, ["filter"]);
  if (parentObject !== void 0 && fromFilter != null) {
    setValueByPath(parentObject, ["_query", "filter"], fromFilter);
  }
  return toObject;
}
function listTuningJobsConfigToVertex(fromObject, parentObject, _rootObject) {
  const toObject = {};
  const fromPageSize = getValueByPath(fromObject, ["pageSize"]);
  if (parentObject !== void 0 && fromPageSize != null) {
    setValueByPath(parentObject, ["_query", "pageSize"], fromPageSize);
  }
  const fromPageToken = getValueByPath(fromObject, ["pageToken"]);
  if (parentObject !== void 0 && fromPageToken != null) {
    setValueByPath(parentObject, ["_query", "pageToken"], fromPageToken);
  }
  const fromFilter = getValueByPath(fromObject, ["filter"]);
  if (parentObject !== void 0 && fromFilter != null) {
    setValueByPath(parentObject, ["_query", "filter"], fromFilter);
  }
  return toObject;
}
function listTuningJobsParametersToMldev(fromObject, rootObject) {
  const toObject = {};
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    listTuningJobsConfigToMldev(fromConfig, toObject);
  }
  return toObject;
}
function listTuningJobsParametersToVertex(fromObject, rootObject) {
  const toObject = {};
  const fromConfig = getValueByPath(fromObject, ["config"]);
  if (fromConfig != null) {
    listTuningJobsConfigToVertex(fromConfig, toObject);
  }
  return toObject;
}
function listTuningJobsResponseFromMldev(fromObject, rootObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromNextPageToken = getValueByPath(fromObject, [
    "nextPageToken"
  ]);
  if (fromNextPageToken != null) {
    setValueByPath(toObject, ["nextPageToken"], fromNextPageToken);
  }
  const fromTuningJobs = getValueByPath(fromObject, ["tunedModels"]);
  if (fromTuningJobs != null) {
    let transformedList = fromTuningJobs;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return tuningJobFromMldev(item);
      });
    }
    setValueByPath(toObject, ["tuningJobs"], transformedList);
  }
  return toObject;
}
function listTuningJobsResponseFromVertex(fromObject, rootObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromNextPageToken = getValueByPath(fromObject, [
    "nextPageToken"
  ]);
  if (fromNextPageToken != null) {
    setValueByPath(toObject, ["nextPageToken"], fromNextPageToken);
  }
  const fromTuningJobs = getValueByPath(fromObject, ["tuningJobs"]);
  if (fromTuningJobs != null) {
    let transformedList = fromTuningJobs;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return tuningJobFromVertex(item);
      });
    }
    setValueByPath(toObject, ["tuningJobs"], transformedList);
  }
  return toObject;
}
function tunedModelFromMldev(fromObject, _rootObject) {
  const toObject = {};
  const fromModel = getValueByPath(fromObject, ["name"]);
  if (fromModel != null) {
    setValueByPath(toObject, ["model"], fromModel);
  }
  const fromEndpoint = getValueByPath(fromObject, ["name"]);
  if (fromEndpoint != null) {
    setValueByPath(toObject, ["endpoint"], fromEndpoint);
  }
  return toObject;
}
function tuningDatasetToMldev(fromObject, _rootObject) {
  const toObject = {};
  if (getValueByPath(fromObject, ["gcsUri"]) !== void 0) {
    throw new Error("gcsUri parameter is not supported in Gemini API.");
  }
  if (getValueByPath(fromObject, ["vertexDatasetResource"]) !== void 0) {
    throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");
  }
  const fromExamples = getValueByPath(fromObject, ["examples"]);
  if (fromExamples != null) {
    let transformedList = fromExamples;
    if (Array.isArray(transformedList)) {
      transformedList = transformedList.map((item) => {
        return item;
      });
    }
    setValueByPath(toObject, ["examples", "examples"], transformedList);
  }
  return toObject;
}
function tuningDatasetToVertex(fromObject, parentObject, rootObject) {
  const toObject = {};
  let discriminatorGcsUri = getValueByPath(rootObject, [
    "config",
    "method"
  ]);
  if (discriminatorGcsUri === void 0) {
    discriminatorGcsUri = "SUPERVISED_FINE_TUNING";
  }
  if (discriminatorGcsUri === "SUPERVISED_FINE_TUNING") {
    const fromGcsUri = getValueByPath(fromObject, ["gcsUri"]);
    if (parentObject !== void 0 && fromGcsUri != null) {
      setValueByPath(parentObject, ["supervisedTuningSpec", "trainingDatasetUri"], fromGcsUri);
    }
  } else if (discriminatorGcsUri === "PREFERENCE_TUNING") {
    const fromGcsUri = getValueByPath(fromObject, ["gcsUri"]);
    if (parentObject !== void 0 && fromGcsUri != null) {
      setValueByPath(parentObject, ["preferenceOptimizationSpec", "trainingDatasetUri"], fromGcsUri);
    }
  }
  let discriminatorVertexDatasetResource = getValueByPath(rootObject, [
    "config",
    "method"
  ]);
  if (discriminatorVertexDatasetResource === void 0) {
    discriminatorVertexDatasetResource = "SUPERVISED_FINE_TUNING";
  }
  if (discriminatorVertexDatasetResource === "SUPERVISED_FINE_TUNING") {
    const fromVertexDatasetResource = getValueByPath(fromObject, [
      "vertexDatasetResource"
    ]);
    if (parentObject !== void 0 && fromVertexDatasetResource != null) {
      setValueByPath(parentObject, ["supervisedTuningSpec", "trainingDatasetUri"], fromVertexDatasetResource);
    }
  } else if (discriminatorVertexDatasetResource === "PREFERENCE_TUNING") {
    const fromVertexDatasetResource = getValueByPath(fromObject, [
      "vertexDatasetResource"
    ]);
    if (parentObject !== void 0 && fromVertexDatasetResource != null) {
      setValueByPath(parentObject, ["preferenceOptimizationSpec", "trainingDatasetUri"], fromVertexDatasetResource);
    }
  }
  if (getValueByPath(fromObject, ["examples"]) !== void 0) {
    throw new Error("examples parameter is not supported in Vertex AI.");
  }
  return toObject;
}
function tuningJobFromMldev(fromObject, rootObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromState = getValueByPath(fromObject, ["state"]);
  if (fromState != null) {
    setValueByPath(toObject, ["state"], tTuningJobStatus(fromState));
  }
  const fromCreateTime = getValueByPath(fromObject, ["createTime"]);
  if (fromCreateTime != null) {
    setValueByPath(toObject, ["createTime"], fromCreateTime);
  }
  const fromStartTime = getValueByPath(fromObject, [
    "tuningTask",
    "startTime"
  ]);
  if (fromStartTime != null) {
    setValueByPath(toObject, ["startTime"], fromStartTime);
  }
  const fromEndTime = getValueByPath(fromObject, [
    "tuningTask",
    "completeTime"
  ]);
  if (fromEndTime != null) {
    setValueByPath(toObject, ["endTime"], fromEndTime);
  }
  const fromUpdateTime = getValueByPath(fromObject, ["updateTime"]);
  if (fromUpdateTime != null) {
    setValueByPath(toObject, ["updateTime"], fromUpdateTime);
  }
  const fromDescription = getValueByPath(fromObject, ["description"]);
  if (fromDescription != null) {
    setValueByPath(toObject, ["description"], fromDescription);
  }
  const fromBaseModel = getValueByPath(fromObject, ["baseModel"]);
  if (fromBaseModel != null) {
    setValueByPath(toObject, ["baseModel"], fromBaseModel);
  }
  const fromTunedModel = getValueByPath(fromObject, ["_self"]);
  if (fromTunedModel != null) {
    setValueByPath(toObject, ["tunedModel"], tunedModelFromMldev(fromTunedModel));
  }
  return toObject;
}
function tuningJobFromVertex(fromObject, _rootObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromState = getValueByPath(fromObject, ["state"]);
  if (fromState != null) {
    setValueByPath(toObject, ["state"], tTuningJobStatus(fromState));
  }
  const fromCreateTime = getValueByPath(fromObject, ["createTime"]);
  if (fromCreateTime != null) {
    setValueByPath(toObject, ["createTime"], fromCreateTime);
  }
  const fromStartTime = getValueByPath(fromObject, ["startTime"]);
  if (fromStartTime != null) {
    setValueByPath(toObject, ["startTime"], fromStartTime);
  }
  const fromEndTime = getValueByPath(fromObject, ["endTime"]);
  if (fromEndTime != null) {
    setValueByPath(toObject, ["endTime"], fromEndTime);
  }
  const fromUpdateTime = getValueByPath(fromObject, ["updateTime"]);
  if (fromUpdateTime != null) {
    setValueByPath(toObject, ["updateTime"], fromUpdateTime);
  }
  const fromError = getValueByPath(fromObject, ["error"]);
  if (fromError != null) {
    setValueByPath(toObject, ["error"], fromError);
  }
  const fromDescription = getValueByPath(fromObject, ["description"]);
  if (fromDescription != null) {
    setValueByPath(toObject, ["description"], fromDescription);
  }
  const fromBaseModel = getValueByPath(fromObject, ["baseModel"]);
  if (fromBaseModel != null) {
    setValueByPath(toObject, ["baseModel"], fromBaseModel);
  }
  const fromTunedModel = getValueByPath(fromObject, ["tunedModel"]);
  if (fromTunedModel != null) {
    setValueByPath(toObject, ["tunedModel"], fromTunedModel);
  }
  const fromPreTunedModel = getValueByPath(fromObject, [
    "preTunedModel"
  ]);
  if (fromPreTunedModel != null) {
    setValueByPath(toObject, ["preTunedModel"], fromPreTunedModel);
  }
  const fromSupervisedTuningSpec = getValueByPath(fromObject, [
    "supervisedTuningSpec"
  ]);
  if (fromSupervisedTuningSpec != null) {
    setValueByPath(toObject, ["supervisedTuningSpec"], fromSupervisedTuningSpec);
  }
  const fromPreferenceOptimizationSpec = getValueByPath(fromObject, [
    "preferenceOptimizationSpec"
  ]);
  if (fromPreferenceOptimizationSpec != null) {
    setValueByPath(toObject, ["preferenceOptimizationSpec"], fromPreferenceOptimizationSpec);
  }
  const fromTuningDataStats = getValueByPath(fromObject, [
    "tuningDataStats"
  ]);
  if (fromTuningDataStats != null) {
    setValueByPath(toObject, ["tuningDataStats"], fromTuningDataStats);
  }
  const fromEncryptionSpec = getValueByPath(fromObject, [
    "encryptionSpec"
  ]);
  if (fromEncryptionSpec != null) {
    setValueByPath(toObject, ["encryptionSpec"], fromEncryptionSpec);
  }
  const fromPartnerModelTuningSpec = getValueByPath(fromObject, [
    "partnerModelTuningSpec"
  ]);
  if (fromPartnerModelTuningSpec != null) {
    setValueByPath(toObject, ["partnerModelTuningSpec"], fromPartnerModelTuningSpec);
  }
  const fromCustomBaseModel = getValueByPath(fromObject, [
    "customBaseModel"
  ]);
  if (fromCustomBaseModel != null) {
    setValueByPath(toObject, ["customBaseModel"], fromCustomBaseModel);
  }
  const fromExperiment = getValueByPath(fromObject, ["experiment"]);
  if (fromExperiment != null) {
    setValueByPath(toObject, ["experiment"], fromExperiment);
  }
  const fromLabels = getValueByPath(fromObject, ["labels"]);
  if (fromLabels != null) {
    setValueByPath(toObject, ["labels"], fromLabels);
  }
  const fromOutputUri = getValueByPath(fromObject, ["outputUri"]);
  if (fromOutputUri != null) {
    setValueByPath(toObject, ["outputUri"], fromOutputUri);
  }
  const fromPipelineJob = getValueByPath(fromObject, ["pipelineJob"]);
  if (fromPipelineJob != null) {
    setValueByPath(toObject, ["pipelineJob"], fromPipelineJob);
  }
  const fromServiceAccount = getValueByPath(fromObject, [
    "serviceAccount"
  ]);
  if (fromServiceAccount != null) {
    setValueByPath(toObject, ["serviceAccount"], fromServiceAccount);
  }
  const fromTunedModelDisplayName = getValueByPath(fromObject, [
    "tunedModelDisplayName"
  ]);
  if (fromTunedModelDisplayName != null) {
    setValueByPath(toObject, ["tunedModelDisplayName"], fromTunedModelDisplayName);
  }
  const fromVeoTuningSpec = getValueByPath(fromObject, [
    "veoTuningSpec"
  ]);
  if (fromVeoTuningSpec != null) {
    setValueByPath(toObject, ["veoTuningSpec"], fromVeoTuningSpec);
  }
  return toObject;
}
function tuningOperationFromMldev(fromObject, _rootObject) {
  const toObject = {};
  const fromSdkHttpResponse = getValueByPath(fromObject, [
    "sdkHttpResponse"
  ]);
  if (fromSdkHttpResponse != null) {
    setValueByPath(toObject, ["sdkHttpResponse"], fromSdkHttpResponse);
  }
  const fromName = getValueByPath(fromObject, ["name"]);
  if (fromName != null) {
    setValueByPath(toObject, ["name"], fromName);
  }
  const fromMetadata = getValueByPath(fromObject, ["metadata"]);
  if (fromMetadata != null) {
    setValueByPath(toObject, ["metadata"], fromMetadata);
  }
  const fromDone = getValueByPath(fromObject, ["done"]);
  if (fromDone != null) {
    setValueByPath(toObject, ["done"], fromDone);
  }
  const fromError = getValueByPath(fromObject, ["error"]);
  if (fromError != null) {
    setValueByPath(toObject, ["error"], fromError);
  }
  return toObject;
}
function tuningValidationDatasetToVertex(fromObject, _rootObject) {
  const toObject = {};
  const fromGcsUri = getValueByPath(fromObject, ["gcsUri"]);
  if (fromGcsUri != null) {
    setValueByPath(toObject, ["validationDatasetUri"], fromGcsUri);
  }
  const fromVertexDatasetResource = getValueByPath(fromObject, [
    "vertexDatasetResource"
  ]);
  if (fromVertexDatasetResource != null) {
    setValueByPath(toObject, ["validationDatasetUri"], fromVertexDatasetResource);
  }
  return toObject;
}
var Tunings = class extends BaseModule {
  constructor(apiClient) {
    super();
    this.apiClient = apiClient;
    this.list = async (params = {}) => {
      return new Pager(PagedItem.PAGED_ITEM_TUNING_JOBS, (x) => this.listInternal(x), await this.listInternal(params), params);
    };
    this.get = async (params) => {
      return await this.getInternal(params);
    };
    this.tune = async (params) => {
      var _a2;
      if (this.apiClient.isVertexAI()) {
        if (params.baseModel.startsWith("projects/")) {
          const preTunedModel = {
            tunedModelName: params.baseModel
          };
          if ((_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.preTunedModelCheckpointId) {
            preTunedModel.checkpointId = params.config.preTunedModelCheckpointId;
          }
          const paramsPrivate = Object.assign(Object.assign({}, params), { preTunedModel });
          paramsPrivate.baseModel = void 0;
          return await this.tuneInternal(paramsPrivate);
        } else {
          const paramsPrivate = Object.assign({}, params);
          return await this.tuneInternal(paramsPrivate);
        }
      } else {
        const paramsPrivate = Object.assign({}, params);
        const operation = await this.tuneMldevInternal(paramsPrivate);
        let tunedModelName = "";
        if (operation["metadata"] !== void 0 && operation["metadata"]["tunedModel"] !== void 0) {
          tunedModelName = operation["metadata"]["tunedModel"];
        } else if (operation["name"] !== void 0 && operation["name"].includes("/operations/")) {
          tunedModelName = operation["name"].split("/operations/")[0];
        }
        const tuningJob = {
          name: tunedModelName,
          state: JobState.JOB_STATE_QUEUED
        };
        return tuningJob;
      }
    };
  }
  async getInternal(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = getTuningJobParametersToVertex(params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = tuningJobFromVertex(apiResponse);
        return resp;
      });
    } else {
      const body = getTuningJobParametersToMldev(params);
      path2 = formatMap("{name}", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = tuningJobFromMldev(apiResponse);
        return resp;
      });
    }
  }
  async listInternal(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = listTuningJobsParametersToVertex(params);
      path2 = formatMap("tuningJobs", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = listTuningJobsResponseFromVertex(apiResponse);
        const typedResp = new ListTuningJobsResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      const body = listTuningJobsParametersToMldev(params);
      path2 = formatMap("tunedModels", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "GET",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = listTuningJobsResponseFromMldev(apiResponse);
        const typedResp = new ListTuningJobsResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  /**
   * Cancels a tuning job.
   *
   * @param params - The parameters for the cancel request.
   * @return The empty response returned by the API.
   *
   * @example
   * ```ts
   * await ai.tunings.cancel({name: '...'}); // The server-generated resource name.
   * ```
   */
  async cancel(params) {
    var _a2, _b, _c, _d;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = cancelTuningJobParametersToVertex(params);
      path2 = formatMap("{name}:cancel", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = cancelTuningJobResponseFromVertex(apiResponse);
        const typedResp = new CancelTuningJobResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    } else {
      const body = cancelTuningJobParametersToMldev(params);
      path2 = formatMap("{name}:cancel", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_c = params.config) === null || _c === void 0 ? void 0 : _c.httpOptions,
        abortSignal: (_d = params.config) === null || _d === void 0 ? void 0 : _d.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = cancelTuningJobResponseFromMldev(apiResponse);
        const typedResp = new CancelTuningJobResponse();
        Object.assign(typedResp, resp);
        return typedResp;
      });
    }
  }
  async tuneInternal(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      const body = createTuningJobParametersPrivateToVertex(params, params);
      path2 = formatMap("tuningJobs", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = tuningJobFromVertex(apiResponse);
        return resp;
      });
    } else {
      throw new Error("This method is only supported by the Vertex AI.");
    }
  }
  async tuneMldevInternal(params) {
    var _a2, _b;
    let response;
    let path2 = "";
    let queryParams = {};
    if (this.apiClient.isVertexAI()) {
      throw new Error("This method is only supported by the Gemini Developer API.");
    } else {
      const body = createTuningJobParametersPrivateToMldev(params);
      path2 = formatMap("tunedModels", body["_url"]);
      queryParams = body["_query"];
      delete body["_url"];
      delete body["_query"];
      response = this.apiClient.request({
        path: path2,
        queryParams,
        body: JSON.stringify(body),
        httpMethod: "POST",
        httpOptions: (_a2 = params.config) === null || _a2 === void 0 ? void 0 : _a2.httpOptions,
        abortSignal: (_b = params.config) === null || _b === void 0 ? void 0 : _b.abortSignal
      }).then((httpResponse) => {
        return httpResponse.json().then((jsonResponse) => {
          const response2 = jsonResponse;
          response2.sdkHttpResponse = {
            headers: httpResponse.headers
          };
          return response2;
        });
      });
      return response.then((apiResponse) => {
        const resp = tuningOperationFromMldev(apiResponse);
        return resp;
      });
    }
  }
};
var BrowserDownloader = class {
  async download(_params, _apiClient) {
    throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.");
  }
};
var MAX_CHUNK_SIZE = 1024 * 1024 * 8;
var MAX_RETRY_COUNT = 3;
var INITIAL_RETRY_DELAY_MS = 1e3;
var DELAY_MULTIPLIER = 2;
var X_GOOG_UPLOAD_STATUS_HEADER_FIELD = "x-goog-upload-status";
async function uploadBlob(file, uploadUrl, apiClient) {
  var _a2;
  const response = await uploadBlobInternal(file, uploadUrl, apiClient);
  const responseJson = await (response === null || response === void 0 ? void 0 : response.json());
  if (((_a2 = response === null || response === void 0 ? void 0 : response.headers) === null || _a2 === void 0 ? void 0 : _a2[X_GOOG_UPLOAD_STATUS_HEADER_FIELD]) !== "final") {
    throw new Error("Failed to upload file: Upload status is not finalized.");
  }
  return responseJson["file"];
}
async function uploadBlobToFileSearchStore(file, uploadUrl, apiClient) {
  var _a2;
  const response = await uploadBlobInternal(file, uploadUrl, apiClient);
  const responseJson = await (response === null || response === void 0 ? void 0 : response.json());
  if (((_a2 = response === null || response === void 0 ? void 0 : response.headers) === null || _a2 === void 0 ? void 0 : _a2[X_GOOG_UPLOAD_STATUS_HEADER_FIELD]) !== "final") {
    throw new Error("Failed to upload file: Upload status is not finalized.");
  }
  const resp = uploadToFileSearchStoreOperationFromMldev(responseJson);
  const typedResp = new UploadToFileSearchStoreOperation();
  Object.assign(typedResp, resp);
  return typedResp;
}
async function uploadBlobInternal(file, uploadUrl, apiClient) {
  var _a2, _b;
  let fileSize = 0;
  let offset = 0;
  let response = new HttpResponse(new Response());
  let uploadCommand = "upload";
  fileSize = file.size;
  while (offset < fileSize) {
    const chunkSize = Math.min(MAX_CHUNK_SIZE, fileSize - offset);
    const chunk = file.slice(offset, offset + chunkSize);
    if (offset + chunkSize >= fileSize) {
      uploadCommand += ", finalize";
    }
    let retryCount = 0;
    let currentDelayMs = INITIAL_RETRY_DELAY_MS;
    while (retryCount < MAX_RETRY_COUNT) {
      response = await apiClient.request({
        path: "",
        body: chunk,
        httpMethod: "POST",
        httpOptions: {
          apiVersion: "",
          baseUrl: uploadUrl,
          headers: {
            "X-Goog-Upload-Command": uploadCommand,
            "X-Goog-Upload-Offset": String(offset),
            "Content-Length": String(chunkSize)
          }
        }
      });
      if ((_a2 = response === null || response === void 0 ? void 0 : response.headers) === null || _a2 === void 0 ? void 0 : _a2[X_GOOG_UPLOAD_STATUS_HEADER_FIELD]) {
        break;
      }
      retryCount++;
      await sleep(currentDelayMs);
      currentDelayMs = currentDelayMs * DELAY_MULTIPLIER;
    }
    offset += chunkSize;
    if (((_b = response === null || response === void 0 ? void 0 : response.headers) === null || _b === void 0 ? void 0 : _b[X_GOOG_UPLOAD_STATUS_HEADER_FIELD]) !== "active") {
      break;
    }
    if (fileSize <= offset) {
      throw new Error("All content has been uploaded, but the upload status is not finalized.");
    }
  }
  return response;
}
async function getBlobStat(file) {
  const fileStat = { size: file.size, type: file.type };
  return fileStat;
}
function sleep(ms) {
  return new Promise((resolvePromise) => setTimeout(resolvePromise, ms));
}
var BrowserUploader = class {
  async upload(file, uploadUrl, apiClient) {
    if (typeof file === "string") {
      throw new Error("File path is not supported in browser uploader.");
    }
    return await uploadBlob(file, uploadUrl, apiClient);
  }
  async uploadToFileSearchStore(file, uploadUrl, apiClient) {
    if (typeof file === "string") {
      throw new Error("File path is not supported in browser uploader.");
    }
    return await uploadBlobToFileSearchStore(file, uploadUrl, apiClient);
  }
  async stat(file) {
    if (typeof file === "string") {
      throw new Error("File path is not supported in browser uploader.");
    } else {
      return await getBlobStat(file);
    }
  }
};
var BrowserWebSocketFactory = class {
  create(url, headers, callbacks) {
    return new BrowserWebSocket(url, headers, callbacks);
  }
};
var BrowserWebSocket = class {
  constructor(url, headers, callbacks) {
    this.url = url;
    this.headers = headers;
    this.callbacks = callbacks;
  }
  connect() {
    this.ws = new WebSocket(this.url);
    this.ws.onopen = this.callbacks.onopen;
    this.ws.onerror = this.callbacks.onerror;
    this.ws.onclose = this.callbacks.onclose;
    this.ws.onmessage = this.callbacks.onmessage;
  }
  send(message) {
    if (this.ws === void 0) {
      throw new Error("WebSocket is not connected");
    }
    this.ws.send(message);
  }
  close() {
    if (this.ws === void 0) {
      throw new Error("WebSocket is not connected");
    }
    this.ws.close();
  }
};
var GOOGLE_API_KEY_HEADER = "x-goog-api-key";
var WebAuth = class {
  constructor(apiKey) {
    this.apiKey = apiKey;
  }
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  async addAuthHeaders(headers, url) {
    if (headers.get(GOOGLE_API_KEY_HEADER) !== null) {
      return;
    }
    if (this.apiKey.startsWith("auth_tokens/")) {
      throw new Error("Ephemeral tokens are only supported by the live API.");
    }
    if (!this.apiKey) {
      throw new Error("API key is missing. Please provide a valid API key.");
    }
    headers.append(GOOGLE_API_KEY_HEADER, this.apiKey);
  }
};
var LANGUAGE_LABEL_PREFIX = "gl-node/";
var GoogleGenAI = class {
  get interactions() {
    if (this._interactions !== void 0) {
      return this._interactions;
    }
    console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");
    const httpOpts = this.httpOptions;
    if (httpOpts === null || httpOpts === void 0 ? void 0 : httpOpts.extraBody) {
      console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");
    }
    const nextGenClient = new GeminiNextGenAPIClient({
      baseURL: this.apiClient.getBaseUrl(),
      apiKey: this.apiKey,
      apiVersion: this.apiClient.getApiVersion(),
      clientAdapter: this.apiClient,
      defaultHeaders: this.apiClient.getDefaultHeaders(),
      timeout: httpOpts === null || httpOpts === void 0 ? void 0 : httpOpts.timeout
    });
    this._interactions = nextGenClient.interactions;
    return this._interactions;
  }
  constructor(options) {
    var _a2;
    if (options.apiKey == null) {
      throw new Error("An API Key must be set when running in a browser");
    }
    if (options.project || options.location) {
      throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");
    }
    this.vertexai = (_a2 = options.vertexai) !== null && _a2 !== void 0 ? _a2 : false;
    this.apiKey = options.apiKey;
    const baseUrl = getBaseUrl(
      options.httpOptions,
      options.vertexai,
      /*vertexBaseUrlFromEnv*/
      void 0,
      /*geminiBaseUrlFromEnv*/
      void 0
    );
    if (baseUrl) {
      if (options.httpOptions) {
        options.httpOptions.baseUrl = baseUrl;
      } else {
        options.httpOptions = { baseUrl };
      }
    }
    this.apiVersion = options.apiVersion;
    this.httpOptions = options.httpOptions;
    const auth = new WebAuth(this.apiKey);
    this.apiClient = new ApiClient({
      auth,
      apiVersion: this.apiVersion,
      apiKey: this.apiKey,
      vertexai: this.vertexai,
      httpOptions: this.httpOptions,
      userAgentExtra: LANGUAGE_LABEL_PREFIX + "web",
      uploader: new BrowserUploader(),
      downloader: new BrowserDownloader()
    });
    this.models = new Models(this.apiClient);
    this.live = new Live(this.apiClient, auth, new BrowserWebSocketFactory());
    this.batches = new Batches(this.apiClient);
    this.chats = new Chats(this.models, this.apiClient);
    this.caches = new Caches(this.apiClient);
    this.files = new Files(this.apiClient);
    this.operations = new Operations(this.apiClient);
    this.authTokens = new Tokens(this.apiClient);
    this.tunings = new Tunings(this.apiClient);
    this.fileSearchStores = new FileSearchStores(this.apiClient);
  }
};

// src/gemini.service.ts
var GeminiService = class _GeminiService {
  constructor() {
    this.genAI = null;
    this.apiKey = "";
    this.ipc = inject(ElectronIpcService);
    this.isInitialized = false;
    this.loadApiKeyFromBackend();
  }
  /**
   * 從後端數據庫加載 API Key
   */
  loadApiKeyFromBackend() {
    const cachedKey = localStorage.getItem("ai_api_key");
    if (cachedKey) {
      this.setApiKeyInternal(cachedKey);
    }
    this.ipc.on("ai-settings-loaded", (data) => {
      if (data?.geminiApiKey) {
        this.setApiKeyInternal(data.geminiApiKey);
        localStorage.setItem("ai_api_key", data.geminiApiKey);
        console.log("[GeminiService] API key loaded from backend");
      }
    });
    this.ipc.send("get-ai-settings", {});
    setTimeout(() => {
      if (!this.isConfigured()) {
        console.warn("Gemini API Key not found. AI features will be disabled until configured.");
      }
    }, 2e3);
  }
  /**
   * 內部設置 API Key（不保存到後端）
   */
  setApiKeyInternal(apiKey) {
    if (!apiKey)
      return;
    this.apiKey = apiKey;
    this.genAI = new GoogleGenAI({ apiKey });
    this.isInitialized = true;
  }
  /**
   * 設置 API Key 並保存到後端數據庫
   */
  setApiKey(apiKey) {
    if (!apiKey)
      return;
    this.setApiKeyInternal(apiKey);
    localStorage.setItem("ai_api_key", apiKey);
    this.ipc.send("save-ai-settings", { geminiApiKey: apiKey });
    console.log("[GeminiService] API key configured and saved to backend");
  }
  isConfigured() {
    return this.genAI !== null && this.apiKey.length > 0;
  }
  getApiKey() {
    return this.apiKey;
  }
  async generateOutreachMessage(lead, basePrompt) {
    if (!this.genAI) {
      throw new Error("Gemini API is not initialized. Please ensure the API_KEY environment variable is set.");
    }
    const model = "gemini-2.5-flash";
    const systemInstruction = `You are an expert marketing assistant for a tool called TG-AI\u667A\u63A7\u738B. You write friendly, professional, and short direct messages (DMs). Do not use markdown formatting. Just return the plain text of the message.`;
    const userPrompt = `
      A user was found in the Telegram group "${lead.sourceGroup}" because they mentioned the keyword "${lead.triggeredKeyword}".
      Their username is @${lead.username}.

      Based on the following instruction, write a direct message to this user.

      Instruction: "${basePrompt}"
    `;
    try {
      const response = await this.genAI.models.generateContent({
        model,
        contents: userPrompt,
        config: {
          systemInstruction
        }
      });
      return response.text;
    } catch (error) {
      console.error("Error generating content with Gemini:", error);
      throw new Error("Failed to generate message. Check console for details.");
    }
  }
  static {
    this.\u0275fac = function GeminiService_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _GeminiService)();
    };
  }
  static {
    this.\u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({ token: _GeminiService, factory: _GeminiService.\u0275fac, providedIn: "root" });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(GeminiService, [{
    type: Injectable,
    args: [{
      providedIn: "root"
    }]
  }], () => [], null);
})();

// src/translation.service.ts
var translations = {
  en: {
    title: "TG-AI\u667A\u63A7\u738B",
    subtitle: "AI Telegram Outreach",
    dashboard: "Dashboard",
    accounts: "Accounts",
    automation: "Automation",
    leads: "Leads",
    analytics: "Analytics",
    logs: "Logs",
    performance: "Performance",
    alerts: "Alerts",
    // Menu Categories
    resourceManagement: "Resource Management",
    marketingAutomation: "Marketing Automation",
    aiIntelligence: "AI & Intelligence",
    systemMonitor: "System Monitor",
    // New Menu Items
    resourceDiscoveryMenu: "Resource Discovery",
    aiCenter: "AI Center",
    monitoringCenter: "Monitoring Center",
    // AI Center Tabs
    aiAutoChat: "AI Auto Chat",
    ragKnowledge: "RAG Knowledge",
    voiceService: "Voice Service",
    enableAiAutoChat: "Enable AI Auto Chat",
    aiAutoChatHint: "Automatically reply to private messages using AI",
    chatMode: "Chat Mode",
    systemPrompt: "System Prompt",
    // Voice Service
    ttsService: "Text to Speech (TTS)",
    sttService: "Speech to Text (STT)",
    enableTts: "Enable TTS",
    enableStt: "Enable STT",
    ttsEndpointLabel: "TTS Endpoint",
    sttEndpointLabel: "STT Endpoint",
    settings: "Settings",
    totalAccounts: "Total Accounts",
    onlineAccounts: "Online Accounts",
    leadsToday: "Leads Today",
    messagesSentToday: "Messages Sent Today",
    leadsCaptured: "Leads Captured",
    keywords: "Keywords",
    monitoredGroups: "Monitored Groups",
    systemControl: "System Control",
    monitoringStatus: "Monitoring Status:",
    active: "Active",
    inactive: "Inactive",
    start: "Start",
    stop: "Stop",
    recentLogs: "Recent Logs",
    recentLeads: "Recent Leads",
    noRecentActivity: "No recent activity.",
    manageAccounts: "Manage Accounts",
    addNewAccount: "Add New Account Manually",
    phoneNumber: "Phone Number",
    apiId: "API ID",
    apiHash: "API Hash",
    proxy: "SOCKS5 Proxy (Optional)",
    addAccount: "Add Account",
    phone: "Phone",
    status: "Status",
    actions: "Actions",
    login: "Login",
    remove: "Remove",
    enableWarmup: "Enable Warm-up Mode",
    dailySends: "Daily Sends",
    monitoringConfig: "Monitoring Configuration",
    keywordsTitle: "Keywords",
    addGroupTitle: "Groups to Monitor",
    groupUrl: "Group URL or @username",
    add: "Add",
    regex: "Regex",
    leadPipeline: "Lead Pipeline",
    newLeadCaptured: "New Lead Captured",
    username: "Username",
    sourceGroup: "Source Group",
    keyword: "Keyword",
    message: "Message",
    contacted: "Contacted",
    actionLogs: "Action Logs",
    clearLogs: "Clear Logs",
    settingsTitle: "Settings",
    messagingConfig: "Messaging Configuration",
    enableSpintax: "Enable Spintax Processing",
    spintaxHint: "Process message prompts with Spintax (e.g., {Hi|Hello}) for message variations.",
    abTesting: "A/B Testing Templates",
    addNewTemplate: "Add New Template",
    templateName: "Template Name",
    prompt: "Prompt",
    saveTemplate: "Save Template",
    deactivate: "Deactivate",
    activate: "Activate",
    abTestingHint: "Create multiple active templates. The system will automatically assign them to new leads for testing.",
    leadDetails: "Lead Details",
    sendMessageTab: "Send Message",
    historyTab: "History",
    assignedTemplate: "Assigned Template",
    customizePrompt: "Customize Prompt for this Lead",
    // Message sending enhancements
    selectSenderAccount: "Select Sender Account",
    noSenderAccounts: "No sender accounts available",
    noSenderAccountsHint: "Please configure sender accounts in Account Management",
    manualInput: "Manual Input",
    aiGenerate: "AI Generate",
    useTemplate: "Use Template",
    aiPromptPlaceholder: "Enter instructions for AI to generate message...",
    aiNotConfigured: "AI is not configured.",
    goToSettings: "Go to Settings",
    selectTemplatePlaceholder: "Choose a template...",
    messageContent: "Message Content",
    characters: "chars",
    messageContentPlaceholder: "Enter your message here...",
    messageRequired: "Please enter a message",
    selectSenderFirst: "Please select a sender account",
    senderAccountNotFound: "Sender account not found",
    messageSent: "Message sent successfully!",
    messageQueued: "Message added to queue",
    // AI Configuration
    aiConfiguration: "AI Configuration",
    aiConfigurationHint: "Configure AI API to enable automatic message generation",
    aiProvider: "AI Provider",
    customApi: "Custom API",
    customApiKey: "API Key",
    geminiKeyHint: "Get your API key from",
    openaiKeyHint: "Get your API key from",
    customApiHint: "Enter your custom API key",
    customApiEndpoint: "API Endpoint URL",
    testConnection: "Test Connection",
    testing: "Testing...",
    saveApiKey: "Save API Key",
    aiConnectionSuccess: "AI connection successful!",
    aiConnectionFailed: "AI connection failed",
    invalidApiKeyFormat: "Invalid API key format",
    aiSettingsSaved: "AI settings saved!",
    // Local AI & Voice Services
    localAi: "Local AI",
    localAiConfiguration: "Local AI Service",
    localAiHint: "Configure local AI service (e.g., Ollama, LocalAI, LM Studio)",
    localAiEndpoint: "Local AI Endpoint",
    localAiEndpointPlaceholder: "http://localhost:3002",
    localAiModel: "Model Name (Optional)",
    localAiModelPlaceholder: "e.g., llama2, mistral",
    voiceServices: "Voice Services",
    voiceServicesHint: "Configure local text-to-speech and speech-to-text services",
    ttsServiceLabel: "Text-to-Speech (TTS)",
    ttsEndpoint: "TTS Endpoint",
    ttsEndpointPlaceholder: "http://localhost:9881",
    ttsVoice: "Voice ID (Optional)",
    ttsVoicePlaceholder: "e.g., default, speaker_01",
    ttsEnabled: "Enable TTS",
    sttServiceLabel: "Speech-to-Text (STT)",
    sttEndpoint: "STT Endpoint",
    sttEndpointPlaceholder: "http://localhost:9000",
    sttEnabled: "Enable STT",
    testLocalAi: "Test Local AI",
    testTts: "Test TTS",
    testStt: "Test STT",
    localAiSuccess: "Local AI connection successful!",
    localAiFailed: "Local AI connection failed",
    ttsSuccess: "TTS service connection successful!",
    ttsFailed: "TTS service connection failed",
    sttSuccess: "STT service connection successful!",
    sttFailed: "STT service connection failed",
    invalidEndpointFormat: "Invalid endpoint format (must start with http:// or https://)",
    saveLocalSettings: "Save Settings",
    // AI Auto Chat (Extended)
    aiAutoChatTitle: "AI Auto Chat",
    aiAutoChatDescription: "Configure AI-powered automatic responses with unlimited context memory",
    enableAutoChat: "Enable AI Auto Chat",
    autoChatMode: "Auto Chat Mode",
    modeFullAuto: "Full Auto",
    modeFullAutoDesc: "AI fully takes over, automatically replies to all messages",
    modeSemiAuto: "Semi-Auto",
    modeSemiAutoDesc: "AI generates drafts, human confirms before sending",
    modeAssist: "Assist",
    modeAssistDesc: "Human inputs, AI provides suggestions and polishing",
    modeKeyword: "Keyword Trigger",
    modeKeywordDesc: "AI only activates when keywords are matched",
    typingSpeed: "Typing Speed",
    typingSpeedHint: "Characters per minute (simulates human typing)",
    replyDelay: "Reply Delay",
    replyDelayHint: "Random delay range before replying (seconds)",
    systemPromptLabel: "System Prompt",
    systemPromptHint: "Instructions for AI behavior and personality",
    systemPromptPlaceholder: "You are a friendly customer service assistant...",
    maxContextMessages: "Max Context Messages",
    maxContextHint: "Number of recent messages to include in AI context",
    enableMemory: "Enable AI Memory",
    enableMemoryHint: "AI remembers important facts about users across sessions",
    autoGreeting: "Auto Greeting",
    autoGreetingHint: "Automatically greet new users",
    greetingMessage: "Greeting Message",
    greetingPlaceholder: "Hello {name}! How can I help you today?",
    unlimitedContext: "Unlimited Context",
    chatHistory: "Chat History",
    userProfile: "User Profile",
    aiMemories: "AI Memories",
    conversationStage: "Conversation Stage",
    // Knowledge Base
    knowledgeBase: "Knowledge Base",
    knowledgeBaseHint: "Manage documents, images, videos and QA pairs for AI-enhanced responses",
    documents: "Documents",
    images: "Images",
    videos: "Videos",
    qaPairs: "Q&A Pairs",
    addDocument: "Add Document",
    addImage: "Add Image",
    addVideo: "Add Video",
    addQaPair: "Add Q&A",
    importQa: "Import Q&A",
    searchKnowledge: "Search Knowledge Base",
    documentTitle: "Document Title",
    documentCategory: "Category",
    documentTags: "Tags",
    uploadFile: "Upload File",
    orPasteContent: "Or paste content directly",
    contentPlaceholder: "Paste document content here...",
    question: "Question",
    answer: "Answer",
    noDocuments: "No documents yet. Add documents to enhance AI responses.",
    noImages: "No images yet. Add images for rich media responses.",
    noVideos: "No videos yet. Add videos for tutorial responses.",
    noQaPairs: "No Q&A pairs yet. Add common questions and answers.",
    categoryProducts: "Products",
    categoryTutorials: "Tutorials",
    categoryGeneral: "General",
    categoryFaq: "FAQ",
    dragDropHint: "Drag & drop files here or click to browse",
    supportedFormats: "Supported formats",
    fileSize: "File size",
    chunks: "chunks",
    preview: "Preview",
    edit: "Edit",
    ragEnabled: "RAG Enabled",
    ragHint: "AI will search knowledge base for relevant information",
    // Telegram RAG System
    telegramRagTitle: "Telegram Auto-Learning RAG",
    telegramRagHint: "Automatically learn from chat history to enhance AI responses",
    totalKnowledge: "Total Knowledge",
    qaLearned: "Q&A Learned",
    scriptsLearned: "Scripts Learned",
    totalUses: "Total Uses",
    ragSystemOnline: "RAG System Online",
    ragSystemOffline: "RAG System Offline",
    vectorDb: "Vector DB",
    embedding: "Embedding",
    initRagSystem: "Initialize RAG",
    learnFromChats: "Learn from Chats",
    reindexHighValue: "Reindex High Value",
    cleanupRag: "Cleanup",
    refreshStats: "Refresh Stats",
    searchRagPlaceholder: "Search knowledge base...",
    searchResults: "Search Results",
    score: "Score",
    knowledgeByType: "Knowledge by Type",
    items: "items",
    addManualKnowledge: "Add Manual Knowledge",
    addRagKnowledge: "Add RAG Knowledge",
    knowledgeType: "Knowledge Type",
    ragQuestion: "Question",
    ragAnswer: "Answer",
    context: "Context",
    questionPlaceholder: "Enter question or trigger...",
    answerPlaceholder: "Enter answer or response...",
    contextPlaceholder: "Optional context info...",
    addKnowledge: "Add",
    // Resource Discovery
    resourceDiscoveryTitle: "Resource Discovery",
    resourceDiscoveryHint: "Automatically discover and join Telegram groups/channels",
    totalResources: "Total Resources",
    todayDiscovered: "Discovered Today",
    pendingJoins: "Pending Joins",
    joinedCount: "Joined",
    initResourceDiscovery: "Initialize",
    searchResources: "Search Resources",
    searchResourcesPlaceholder: "Enter keywords to search groups/channels...",
    processJoinQueue: "Process Queue",
    batchJoin: "Batch Join",
    addToQueue: "Add to Queue",
    resourceType: "Type",
    resourceStatus: "Status",
    memberCount: "Members",
    overallScore: "Score",
    discoveredAt: "Discovered",
    noResourcesFound: "No resources found. Start searching!",
    chineseSearch: "Chinese Search",
    tgstatAnalysis: "TGStat Analysis",
    resourceGroup: "Group",
    resourceSupergroup: "Supergroup",
    resourceChannel: "Channel",
    statusDiscovered: "Discovered",
    statusQueued: "Queued",
    statusJoined: "Joined",
    statusBlocked: "Blocked",
    selectAll: "Select All",
    selectedCount: "selected",
    // Voice Clone
    voiceClone: "Voice Clone",
    voiceCloneHint: "Upload audio samples to clone voices for TTS. Supports WAV, MP3, OGG, FLAC formats (max 50MB)",
    uploadVoiceSample: "Upload Voice Sample",
    clonedVoices: "Cloned Voices",
    noClonedVoices: "No cloned voices yet. Upload an audio sample to get started.",
    voiceUploadSuccess: "Voice sample uploaded successfully!",
    voiceUploadFailed: "Failed to upload voice sample",
    voiceDeleted: "Voice sample deleted",
    invalidAudioFormat: "Invalid audio format. Please use WAV, MP3, OGG, or FLAC.",
    audioFileTooLarge: "Audio file too large. Maximum size is 50MB.",
    selectVoiceFirst: "Please select a cloned voice first",
    ttsEndpointRequired: "Please configure TTS endpoint first",
    previewVoice: "Preview",
    useThisVoice: "Use",
    deleteVoice: "Delete",
    remoteEndpointHint: "Enter the remote server URL where the service is deployed",
    // Voice Recording
    recordVoice: "Record Voice",
    startRecording: "Start Recording",
    stopRecording: "Stop Recording",
    recording: "Recording...",
    recordingHint: "Please record 3-10 seconds of clear speech",
    voiceNameLabel: "Voice Name",
    voiceNamePlaceholder: "e.g., My Voice, Customer Service",
    promptTextLabel: "Reference Text (what you said)",
    promptTextPlaceholder: "Enter the text you spoke during recording...",
    confirmUpload: "Confirm & Upload",
    reRecord: "Re-record",
    recordingTooShort: "Recording too short. Please record at least 3 seconds.",
    recordingTooLong: "Recording too long. Maximum 10 seconds.",
    voiceNameRequired: "Please enter a voice name",
    noRecordingToUpload: "No recording to upload. Please record first.",
    microphoneAccessDenied: "Microphone access denied. Please allow microphone access.",
    orUploadFile: "Or upload audio file",
    seconds: "seconds",
    generateWithAi: "\u2728 Generate with AI",
    generating: "Generating...",
    generatedMessage: "Generated Message",
    error: "Error:",
    cancel: "Cancel",
    sendMessage: "Send Message",
    language: "Language",
    appearance: "Appearance",
    light: "Light",
    dark: "Dark",
    health: "Health",
    group: "Group",
    allAccounts: "All Accounts",
    importSession: "Import Session",
    exportSession: "Export Session",
    twoFactorPassword: "2FA Password (optional)",
    accountGroup: "Account Group",
    accountHealthTooltip: "Health Score based on activity, profile, and proxy quality.",
    viewLogs: "View Logs",
    fileBasedManagement: "File-Based Management",
    downloadTemplate: "Download Template",
    uploadExcel: "Upload Excel",
    reloadSessions: "Reload Sessions",
    noAccountsFound: "No accounts found. Add accounts manually or upload an Excel file.",
    "New": "New",
    "Contacted": "Contacted",
    "Replied": "Replied",
    "Follow-up": "Follow-up",
    "Closed-Won": "Closed-Won",
    "Closed-Lost": "Closed-Lost",
    moveTo: "Move to",
    analyticsTitle: "Performance Analytics",
    replyRate: "Reply Rate",
    replyRateDesc: 'Percentage of contacted leads that have been moved to the "Replied" stage.',
    templatePerformance: "Template Performance",
    leadsOverTime: "Leads Over Time",
    last7Days: "Last 7 Days",
    conversionFunnel: "Conversion Funnel",
    contactHistory: "Contact History",
    noHistoryFound: "No history found for this lead.",
    kanbanView: "Kanban",
    listView: "List",
    exportToExcel: "Export to Excel",
    onlineStatus: "Online Status",
    userId: "User ID",
    leadName: "Lead Name",
    capturedAt: "Captured At",
    "Online": "Online",
    "Offline": "Offline",
    "Recently": "Recently",
    "Unknown": "Unknown",
    role: "Role",
    "Listener": "Listener",
    "Sender": "Sender",
    "Unassigned": "Unassigned",
    "Logging in...": "Logging in...",
    "Banned": "Banned",
    "Warming Up": "Warming Up",
    listenerConfiguration: "Listener Configuration",
    senderConfiguration: "Sender & Automation Configuration",
    activeListenerAccounts: "Active Listener Accounts",
    activeSenderAccounts: "Active Sender Accounts",
    outreachAutomation: "Outreach & Follow-up Automation",
    enableAutoReply: "Enable Automated Reply",
    autoReplyHint: "When a lead is moved to 'Replied', automatically send a message to acknowledge.",
    autoReplyMessage: "Auto-Reply Message",
    autoReplyEditHint: "Edit the message and click save to update",
    saveAutoReply: "Save",
    settingsSaved: "Settings saved successfully!",
    saveSettings: "Save Settings",
    settingsAutoSaveHint: "Settings are auto-saved when changed. You can also click to save manually.",
    sendingDelays: "Randomized Sending Delays",
    delayRangeHint: "Wait for a random period before sending the first message.",
    min: "Min (s)",
    max: "Max (s)",
    noActiveListeners: "No active Listener accounts. Assign the Listener role to online accounts.",
    noActiveSenders: "No active Sender accounts. Assign the Sender role to online accounts.",
    sendingStrategy: "Sending Strategy",
    sendImmediately: "Send Immediately",
    sendWithinTimeWindow: "Send within Time Window",
    timeWindowHint: "Only send messages between these local times.",
    from: "From",
    to: "To",
    smartSending: "Smart Sending",
    enableSmartSending: "Enable Smart Sending",
    smartSendingHint: "Only send messages when the lead is online. Queues message if offline.",
    attachImage: "Attach Image",
    attachFile: "Attach File",
    checkStatus: "Check Status",
    "Proxy Error": "Proxy Error",
    selected: "selected",
    bulkActions: "Bulk Actions",
    assignRole: "Assign Role",
    assignGroup: "Assign Group",
    enterGroupName: "Enter new group name:",
    deleteSelected: "Delete Selected",
    keywordSets: "Keyword Sets",
    newKeywordSet: "New Keyword Set Name",
    assignKeywordSets: "Assign Keyword Sets",
    addToDNC: "Add to Do Not Contact List",
    userOnDNC: "User is on DNC List",
    automationCampaigns: "Automation Campaigns",
    campaigns: "Campaigns",
    createCampaign: "Create New Campaign",
    campaignName: "Campaign Name",
    triggers: "Triggers",
    campaignTriggerHint: "A lead will be captured if it matches ALL selected criteria.",
    sourceGroups: "Source Groups",
    messageTemplate: "Message Template",
    selectTemplate: "Select a template...",
    noCampaignsFound: "No campaigns created yet.",
    campaign: "Campaign",
    groups: "Groups",
    "Resting (Cooldown)": "Resting (Cooldown)",
    allCampaigns: "All Campaigns",
    selectCampaign: "Select Campaign",
    campaignPerformance: "Campaign Performance",
    replied: "Replied",
    campaignDetails: "Campaign Details",
    automationHub: "Automation Hub",
    monitoringTargets: "Step 1: Monitoring Targets",
    automationRules: "Step 2: Automation Rules",
    globalSendingConfig: "Global Sending Configuration",
    accountStatus: "Account Status",
    addKeywordPlaceholder: "Enter keyword or phrase (e.g., bitcoin, payment)",
    regexTooltip: 'Regular Expression: Use pattern matching instead of exact text. Example: bitcoin|BTC matches "bitcoin" or "BTC"',
    regexExamples: "Regex Examples",
    regexExample1: "bitcoin|BTC - matches bitcoin or BTC",
    regexExample2: "pay.*ment - matches payment, payments, etc.",
    regexExample3: "\\d+.*USD - matches numbers followed by USD",
    addKeywordButton: "Add",
    keywordAdded: "Keyword added",
    keywordAddFailed: "Failed to add keyword",
    invalidRegex: "Invalid regex syntax",
    selectKeywordSetFirst: "Please select a keyword set first",
    keywordEmpty: "Keyword cannot be empty",
    testKeyword: "Test",
    testKeywordPlaceholder: "Enter test text...",
    keywordMatches: "Matches",
    keywordNoMatch: "No match"
  },
  zh: {
    title: "TG-AI\u667A\u63A7\u738B",
    subtitle: "AI Telegram \u8425\u9500",
    dashboard: "\u4EEA\u8868\u76D8",
    accounts: "\u8D26\u6237\u7BA1\u7406",
    automation: "\u81EA\u52A8\u5316\u4E2D\u5FC3",
    leads: "\u6F5C\u5728\u5BA2\u6237",
    analytics: "\u5206\u6790",
    logs: "\u65E5\u5FD7",
    performance: "\u6027\u80FD\u76D1\u63A7",
    alerts: "\u544A\u8B66",
    // Menu Categories
    resourceManagement: "\u8D44\u6E90\u7BA1\u7406",
    marketingAutomation: "\u8425\u9500\u81EA\u52A8\u5316",
    aiIntelligence: "AI \u667A\u80FD",
    systemMonitor: "\u7CFB\u7EDF\u76D1\u63A7",
    // New Menu Items
    resourceDiscoveryMenu: "\u8D44\u6E90\u53D1\u73B0",
    aiCenter: "AI \u4E2D\u5FC3",
    monitoringCenter: "\u76D1\u63A7\u4E2D\u5FC3",
    // AI Center Tabs
    aiAutoChat: "AI \u81EA\u52A8\u804A\u5929",
    ragKnowledge: "RAG \u77E5\u8BC6\u5E93",
    voiceService: "\u8BED\u97F3\u670D\u52A1",
    enableAiAutoChat: "\u542F\u7528 AI \u81EA\u52A8\u804A\u5929",
    aiAutoChatHint: "\u4F7F\u7528 AI \u81EA\u52A8\u56DE\u590D\u79C1\u4FE1",
    chatMode: "\u804A\u5929\u6A21\u5F0F",
    systemPrompt: "\u7CFB\u7EDF\u63D0\u793A\u8BCD",
    // Voice Service
    ttsService: "\u6587\u5B57\u8F6C\u8BED\u97F3 (TTS)",
    sttService: "\u8BED\u97F3\u8F6C\u6587\u5B57 (STT)",
    enableTts: "\u542F\u7528 TTS",
    enableStt: "\u542F\u7528 STT",
    ttsEndpointLabel: "TTS \u7AEF\u70B9",
    sttEndpointLabel: "STT \u7AEF\u70B9",
    settings: "\u8BBE\u7F6E",
    totalAccounts: "\u603B\u8D26\u6237\u6570",
    onlineAccounts: "\u5728\u7EBF\u8D26\u6237",
    leadsToday: "\u4ECA\u65E5\u83B7\u5BA2",
    messagesSentToday: "\u4ECA\u65E5\u5DF2\u53D1",
    leadsCaptured: "\u6355\u83B7\u5BA2\u6237",
    keywords: "\u5173\u952E\u8BCD",
    monitoredGroups: "\u76D1\u63A7\u7FA4\u7EC4",
    systemControl: "\u7CFB\u7EDF\u63A7\u5236",
    monitoringStatus: "\u76D1\u63A7\u72B6\u6001:",
    active: "\u8FD0\u884C\u4E2D",
    inactive: "\u5DF2\u505C\u6B62",
    start: "\u542F\u52A8",
    stop: "\u505C\u6B62",
    recentLogs: "\u6700\u8FD1\u65E5\u5FD7",
    recentLeads: "\u6700\u8FD1\u5BA2\u6237",
    noRecentActivity: "\u6682\u65E0\u6700\u8FD1\u6D3B\u52A8\u3002",
    manageAccounts: "\u7BA1\u7406\u8D26\u6237",
    addNewAccount: "\u624B\u52A8\u6DFB\u52A0\u65B0\u8D26\u6237",
    phoneNumber: "\u7535\u8BDD\u53F7\u7801",
    apiId: "API ID",
    apiHash: "API Hash",
    proxy: "SOCKS5 \u4EE3\u7406 (\u53EF\u9009)",
    addAccount: "\u6DFB\u52A0\u8D26\u6237",
    phone: "\u7535\u8BDD",
    status: "\u72B6\u6001",
    actions: "\u64CD\u4F5C",
    login: "\u767B\u5F55",
    remove: "\u79FB\u9664",
    enableWarmup: "\u542F\u7528\u9884\u70ED\u6A21\u5F0F",
    dailySends: "\u4ECA\u65E5\u5DF2\u53D1",
    monitoringConfig: "\u76D1\u63A7\u914D\u7F6E",
    keywordsTitle: "\u5173\u952E\u8BCD",
    addGroupTitle: "\u8981\u76D1\u63A7\u7684\u7FA4\u7EC4",
    groupUrl: "\u7FA4\u7EC4 URL \u6216 @username",
    add: "\u6DFB\u52A0",
    regex: "\u6B63\u5219",
    leadPipeline: "\u6F5C\u5728\u5BA2\u6237\u6F0F\u6597",
    newLeadCaptured: "\u6355\u83B7\u65B0\u6F5C\u5728\u5BA2\u6237",
    username: "\u7528\u6237\u540D",
    sourceGroup: "\u6765\u6E90\u7FA4\u7EC4",
    keyword: "\u5173\u952E\u8BCD",
    message: "\u6D88\u606F",
    contacted: "\u5DF2\u8054\u7CFB",
    actionLogs: "\u64CD\u4F5C\u65E5\u5FD7",
    clearLogs: "\u6E05\u7A7A\u65E5\u5FD7",
    settingsTitle: "\u8BBE\u7F6E",
    messagingConfig: "\u6D88\u606F\u914D\u7F6E",
    enableSpintax: "\u542F\u7528 Spintax \u5904\u7406",
    spintaxHint: "\u5904\u7406\u6D88\u606F\u63D0\u793A\u4E2D\u7684 Spintax (\u4F8B\u5982 {Hi|Hello}) \u4EE5\u5B9E\u73B0\u6D88\u606F\u591A\u6837\u5316\u3002",
    abTesting: "A/B \u6D4B\u8BD5\u6A21\u677F",
    addNewTemplate: "\u6DFB\u52A0\u65B0\u6A21\u677F",
    templateName: "\u6A21\u677F\u540D\u79F0",
    prompt: "\u63D0\u793A\u8BED",
    saveTemplate: "\u4FDD\u5B58\u6A21\u677F",
    deactivate: "\u505C\u7528",
    activate: "\u6FC0\u6D3B",
    abTestingHint: "\u521B\u5EFA\u591A\u4E2A\u6D3B\u52A8\u6A21\u677F\u3002\u7CFB\u7EDF\u5C06\u81EA\u52A8\u628A\u5B83\u4EEC\u5206\u914D\u7ED9\u65B0\u7684\u6F5C\u5728\u5BA2\u6237\u8FDB\u884C\u6D4B\u8BD5\u3002",
    leadDetails: "\u6F5C\u5728\u5BA2\u6237\u8BE6\u60C5",
    sendMessageTab: "\u53D1\u9001\u6D88\u606F",
    historyTab: "\u5386\u53F2\u8BB0\u5F55",
    assignedTemplate: "\u5206\u914D\u7684\u6A21\u677F",
    customizePrompt: "\u4E3A\u6B64\u6F5C\u5728\u5BA2\u6237\u81EA\u5B9A\u4E49\u63D0\u793A",
    // Message sending enhancements
    selectSenderAccount: "\u9009\u62E9\u53D1\u9001\u8D26\u53F7",
    noSenderAccounts: "\u6CA1\u6709\u53EF\u7528\u7684\u53D1\u9001\u8D26\u53F7",
    noSenderAccountsHint: "\u8BF7\u5728\u8D26\u6237\u7BA1\u7406\u4E2D\u914D\u7F6E\u53D1\u9001\u8D26\u53F7",
    manualInput: "\u624B\u52A8\u8F93\u5165",
    aiGenerate: "AI \u751F\u6210",
    useTemplate: "\u4F7F\u7528\u6A21\u677F",
    aiPromptPlaceholder: "\u8F93\u5165 AI \u751F\u6210\u6D88\u606F\u7684\u6307\u4EE4...",
    aiNotConfigured: "AI \u5C1A\u672A\u914D\u7F6E\u3002",
    goToSettings: "\u524D\u5F80\u8BBE\u7F6E",
    selectTemplatePlaceholder: "\u9009\u62E9\u4E00\u4E2A\u6A21\u677F...",
    messageContent: "\u6D88\u606F\u5185\u5BB9",
    characters: "\u5B57\u7B26",
    messageContentPlaceholder: "\u5728\u6B64\u8F93\u5165\u60A8\u7684\u6D88\u606F...",
    messageRequired: "\u8BF7\u8F93\u5165\u6D88\u606F\u5185\u5BB9",
    selectSenderFirst: "\u8BF7\u5148\u9009\u62E9\u53D1\u9001\u8D26\u53F7",
    senderAccountNotFound: "\u53D1\u9001\u8D26\u53F7\u4E0D\u5B58\u5728",
    messageSent: "\u6D88\u606F\u53D1\u9001\u6210\u529F\uFF01",
    messageQueued: "\u6D88\u606F\u5DF2\u52A0\u5165\u53D1\u9001\u961F\u5217",
    // AI Configuration
    aiConfiguration: "AI \u914D\u7F6E",
    aiConfigurationHint: "\u914D\u7F6E AI API \u4EE5\u542F\u7528\u81EA\u52A8\u6D88\u606F\u751F\u6210\u529F\u80FD",
    aiProvider: "AI \u670D\u52A1\u5546",
    customApi: "\u81EA\u5B9A\u4E49 API",
    customApiKey: "API \u5BC6\u94A5",
    geminiKeyHint: "\u4ECE\u4EE5\u4E0B\u5730\u5740\u83B7\u53D6\u60A8\u7684 API \u5BC6\u94A5\uFF1A",
    openaiKeyHint: "\u4ECE\u4EE5\u4E0B\u5730\u5740\u83B7\u53D6\u60A8\u7684 API \u5BC6\u94A5\uFF1A",
    customApiHint: "\u8F93\u5165\u60A8\u7684\u81EA\u5B9A\u4E49 API \u5BC6\u94A5",
    customApiEndpoint: "API \u63A5\u53E3\u5730\u5740",
    testConnection: "\u6D4B\u8BD5\u8FDE\u63A5",
    testing: "\u6D4B\u8BD5\u4E2D...",
    saveApiKey: "\u4FDD\u5B58 API \u5BC6\u94A5",
    aiConnectionSuccess: "AI \u8FDE\u63A5\u6210\u529F\uFF01",
    aiConnectionFailed: "AI \u8FDE\u63A5\u5931\u8D25",
    invalidApiKeyFormat: "API \u5BC6\u94A5\u683C\u5F0F\u65E0\u6548",
    aiSettingsSaved: "AI \u8BBE\u7F6E\u5DF2\u4FDD\u5B58\uFF01",
    // Local AI & Voice Services
    localAi: "\u672C\u5730 AI",
    localAiConfiguration: "\u672C\u5730 AI \u670D\u52A1",
    localAiHint: "\u914D\u7F6E\u672C\u5730 AI \u670D\u52A1\uFF08\u5982 Ollama\u3001LocalAI\u3001LM Studio\uFF09",
    localAiEndpoint: "\u672C\u5730 AI \u7AEF\u70B9",
    localAiEndpointPlaceholder: "http://localhost:3002",
    localAiModel: "\u6A21\u578B\u540D\u79F0\uFF08\u53EF\u9009\uFF09",
    localAiModelPlaceholder: "\u4F8B\u5982\uFF1Allama2\u3001mistral",
    voiceServices: "\u8BED\u97F3\u670D\u52A1",
    voiceServicesHint: "\u914D\u7F6E\u672C\u5730\u8BED\u97F3\u5408\u6210\u548C\u8BED\u97F3\u8BC6\u522B\u670D\u52A1",
    ttsServiceLabel: "\u8BED\u97F3\u5408\u6210 (TTS)",
    ttsEndpoint: "TTS \u7AEF\u70B9",
    ttsEndpointPlaceholder: "http://localhost:9881",
    ttsVoice: "\u8BED\u97F3 ID\uFF08\u53EF\u9009\uFF09",
    ttsVoicePlaceholder: "\u4F8B\u5982\uFF1Adefault\u3001speaker_01",
    ttsEnabled: "\u542F\u7528 TTS",
    sttServiceLabel: "\u8BED\u97F3\u8BC6\u522B (STT)",
    sttEndpoint: "STT \u7AEF\u70B9",
    sttEndpointPlaceholder: "http://localhost:9000",
    sttEnabled: "\u542F\u7528 STT",
    testLocalAi: "\u6D4B\u8BD5\u672C\u5730 AI",
    testTts: "\u6D4B\u8BD5 TTS",
    testStt: "\u6D4B\u8BD5 STT",
    localAiSuccess: "\u672C\u5730 AI \u8FDE\u63A5\u6210\u529F\uFF01",
    localAiFailed: "\u672C\u5730 AI \u8FDE\u63A5\u5931\u8D25",
    ttsSuccess: "TTS \u670D\u52A1\u8FDE\u63A5\u6210\u529F\uFF01",
    ttsFailed: "TTS \u670D\u52A1\u8FDE\u63A5\u5931\u8D25",
    sttSuccess: "STT \u670D\u52A1\u8FDE\u63A5\u6210\u529F\uFF01",
    sttFailed: "STT \u670D\u52A1\u8FDE\u63A5\u5931\u8D25",
    invalidEndpointFormat: "\u7AEF\u70B9\u683C\u5F0F\u65E0\u6548\uFF08\u5FC5\u987B\u4EE5 http:// \u6216 https:// \u5F00\u5934\uFF09",
    saveLocalSettings: "\u4FDD\u5B58\u8BBE\u7F6E",
    // AI Auto Chat (Extended)
    aiAutoChatTitle: "AI \u81EA\u52A8\u804A\u5929",
    aiAutoChatDescription: "\u914D\u7F6E AI \u9A71\u52A8\u7684\u81EA\u52A8\u56DE\u590D\uFF0C\u652F\u6301\u65E0\u9650\u4E0A\u4E0B\u6587\u8BB0\u5FC6",
    enableAutoChat: "\u542F\u7528 AI \u81EA\u52A8\u804A\u5929",
    autoChatMode: "\u81EA\u52A8\u804A\u5929\u6A21\u5F0F",
    modeFullAuto: "\u5168\u81EA\u52A8",
    modeFullAutoDesc: "AI \u5B8C\u5168\u63A5\u7BA1\uFF0C\u81EA\u52A8\u56DE\u590D\u6240\u6709\u6D88\u606F",
    modeSemiAuto: "\u534A\u81EA\u52A8",
    modeSemiAutoDesc: "AI \u751F\u6210\u8349\u7A3F\uFF0C\u4EBA\u5DE5\u786E\u8BA4\u540E\u53D1\u9001",
    modeAssist: "\u8F85\u52A9",
    modeAssistDesc: "\u4EBA\u5DE5\u8F93\u5165\uFF0CAI \u63D0\u4F9B\u5EFA\u8BAE\u548C\u6DA6\u8272",
    modeKeyword: "\u5173\u952E\u8BCD\u89E6\u53D1",
    modeKeywordDesc: "\u4EC5\u5728\u5339\u914D\u5173\u952E\u8BCD\u65F6\u542F\u52A8 AI",
    typingSpeed: "\u6253\u5B57\u901F\u5EA6",
    typingSpeedHint: "\u6BCF\u5206\u949F\u5B57\u7B26\u6570\uFF08\u6A21\u62DF\u4EBA\u7C7B\u6253\u5B57\uFF09",
    replyDelay: "\u56DE\u590D\u5EF6\u8FDF",
    replyDelayHint: "\u56DE\u590D\u524D\u7684\u968F\u673A\u5EF6\u8FDF\u8303\u56F4\uFF08\u79D2\uFF09",
    systemPromptLabel: "\u7CFB\u7EDF\u63D0\u793A\u8BCD",
    systemPromptHint: "AI \u884C\u4E3A\u548C\u4E2A\u6027\u7684\u6307\u4EE4",
    systemPromptPlaceholder: "\u4F60\u662F\u4E00\u4E2A\u53CB\u597D\u7684\u5BA2\u670D\u52A9\u624B...",
    maxContextMessages: "\u6700\u5927\u4E0A\u4E0B\u6587\u6D88\u606F\u6570",
    maxContextHint: "\u5305\u542B\u5728 AI \u4E0A\u4E0B\u6587\u4E2D\u7684\u6700\u8FD1\u6D88\u606F\u6570\u91CF",
    enableMemory: "\u542F\u7528 AI \u8BB0\u5FC6",
    enableMemoryHint: "AI \u8DE8\u4F1A\u8BDD\u8BB0\u4F4F\u7528\u6237\u7684\u91CD\u8981\u4FE1\u606F",
    autoGreeting: "\u81EA\u52A8\u95EE\u5019",
    autoGreetingHint: "\u81EA\u52A8\u95EE\u5019\u65B0\u7528\u6237",
    greetingMessage: "\u95EE\u5019\u8BED",
    greetingPlaceholder: "\u4F60\u597D {name}\uFF01\u6709\u4EC0\u4E48\u53EF\u4EE5\u5E2E\u5230\u4F60\u7684\u5417\uFF1F",
    unlimitedContext: "\u65E0\u9650\u4E0A\u4E0B\u6587",
    chatHistory: "\u804A\u5929\u5386\u53F2",
    userProfile: "\u7528\u6237\u753B\u50CF",
    aiMemories: "AI \u8BB0\u5FC6",
    conversationStage: "\u5BF9\u8BDD\u9636\u6BB5",
    // Knowledge Base
    knowledgeBase: "\u77E5\u8BC6\u5E93",
    knowledgeBaseHint: "\u7BA1\u7406\u6587\u6863\u3001\u56FE\u7247\u3001\u89C6\u9891\u548C\u95EE\u7B54\u5BF9\uFF0C\u589E\u5F3A AI \u56DE\u590D\u80FD\u529B",
    documents: "\u6587\u6863",
    images: "\u56FE\u7247",
    videos: "\u89C6\u9891",
    qaPairs: "\u95EE\u7B54\u5BF9",
    addDocument: "\u6DFB\u52A0\u6587\u6863",
    addImage: "\u6DFB\u52A0\u56FE\u7247",
    addVideo: "\u6DFB\u52A0\u89C6\u9891",
    addQaPair: "\u6DFB\u52A0\u95EE\u7B54",
    importQa: "\u5BFC\u5165\u95EE\u7B54",
    searchKnowledge: "\u641C\u7D22\u77E5\u8BC6\u5E93",
    documentTitle: "\u6587\u6863\u6807\u9898",
    documentCategory: "\u5206\u7C7B",
    documentTags: "\u6807\u7B7E",
    uploadFile: "\u4E0A\u4F20\u6587\u4EF6",
    orPasteContent: "\u6216\u76F4\u63A5\u7C98\u8D34\u5185\u5BB9",
    contentPlaceholder: "\u5728\u6B64\u7C98\u8D34\u6587\u6863\u5185\u5BB9...",
    question: "\u95EE\u9898",
    answer: "\u56DE\u7B54",
    noDocuments: "\u8FD8\u6CA1\u6709\u6587\u6863\u3002\u6DFB\u52A0\u6587\u6863\u6765\u589E\u5F3A AI \u56DE\u590D\u3002",
    noImages: "\u8FD8\u6CA1\u6709\u56FE\u7247\u3002\u6DFB\u52A0\u56FE\u7247\u7528\u4E8E\u5BCC\u5A92\u4F53\u56DE\u590D\u3002",
    noVideos: "\u8FD8\u6CA1\u6709\u89C6\u9891\u3002\u6DFB\u52A0\u89C6\u9891\u7528\u4E8E\u6559\u7A0B\u56DE\u590D\u3002",
    noQaPairs: "\u8FD8\u6CA1\u6709\u95EE\u7B54\u5BF9\u3002\u6DFB\u52A0\u5E38\u89C1\u95EE\u9898\u548C\u56DE\u7B54\u3002",
    categoryProducts: "\u4EA7\u54C1",
    categoryTutorials: "\u6559\u7A0B",
    categoryGeneral: "\u901A\u7528",
    categoryFaq: "\u5E38\u89C1\u95EE\u9898",
    dragDropHint: "\u62D6\u653E\u6587\u4EF6\u5230\u8FD9\u91CC\u6216\u70B9\u51FB\u6D4F\u89C8",
    supportedFormats: "\u652F\u6301\u7684\u683C\u5F0F",
    fileSize: "\u6587\u4EF6\u5927\u5C0F",
    chunks: "\u5206\u6BB5",
    preview: "\u9884\u89C8",
    edit: "\u7F16\u8F91",
    ragEnabled: "\u542F\u7528 RAG",
    ragHint: "AI \u5C06\u4ECE\u77E5\u8BC6\u5E93\u641C\u7D22\u76F8\u5173\u4FE1\u606F",
    // Telegram RAG System
    telegramRagTitle: "Telegram \u81EA\u52A8\u5B66\u4E60 RAG",
    telegramRagHint: "\u81EA\u52A8\u4ECE\u804A\u5929\u8BB0\u5F55\u4E2D\u5B66\u4E60\uFF0C\u589E\u5F3A AI \u56DE\u590D\u80FD\u529B",
    totalKnowledge: "\u603B\u77E5\u8BC6\u91CF",
    qaLearned: "\u5B66\u4E60\u7684\u95EE\u7B54",
    scriptsLearned: "\u5B66\u4E60\u7684\u8BDD\u672F",
    totalUses: "\u603B\u4F7F\u7528\u6B21\u6570",
    ragSystemOnline: "RAG \u7CFB\u7EDF\u5728\u7EBF",
    ragSystemOffline: "RAG \u7CFB\u7EDF\u79BB\u7EBF",
    vectorDb: "\u5411\u91CF\u5E93",
    embedding: "\u5D4C\u5165\u6A21\u578B",
    initRagSystem: "\u521D\u59CB\u5316 RAG",
    learnFromChats: "\u4ECE\u804A\u5929\u5B66\u4E60",
    reindexHighValue: "\u91CD\u5EFA\u9AD8\u4EF7\u503C\u7D22\u5F15",
    cleanupRag: "\u6E05\u7406\u77E5\u8BC6\u5E93",
    refreshStats: "\u5237\u65B0\u7EDF\u8BA1",
    searchRagPlaceholder: "\u641C\u7D22\u77E5\u8BC6\u5E93...",
    searchResults: "\u641C\u7D22\u7ED3\u679C",
    score: "\u8BC4\u5206",
    knowledgeByType: "\u6309\u7C7B\u578B\u5206\u7C7B",
    items: "\u6761",
    addManualKnowledge: "\u624B\u52A8\u6DFB\u52A0\u77E5\u8BC6",
    addRagKnowledge: "\u6DFB\u52A0 RAG \u77E5\u8BC6",
    knowledgeType: "\u77E5\u8BC6\u7C7B\u578B",
    ragQuestion: "\u95EE\u9898",
    ragAnswer: "\u56DE\u7B54",
    context: "\u4E0A\u4E0B\u6587",
    questionPlaceholder: "\u8F93\u5165\u95EE\u9898\u6216\u89E6\u53D1\u8BCD...",
    answerPlaceholder: "\u8F93\u5165\u7B54\u6848\u6216\u56DE\u590D...",
    contextPlaceholder: "\u53EF\u9009\u7684\u4E0A\u4E0B\u6587\u4FE1\u606F...",
    addKnowledge: "\u6DFB\u52A0",
    // Resource Discovery
    resourceDiscoveryTitle: "\u8D44\u6E90\u53D1\u73B0",
    resourceDiscoveryHint: "\u81EA\u52A8\u53D1\u73B0\u5E76\u52A0\u5165 Telegram \u7FA4\u7EC4/\u9891\u9053",
    totalResources: "\u603B\u8D44\u6E90\u6570",
    todayDiscovered: "\u4ECA\u65E5\u53D1\u73B0",
    pendingJoins: "\u5F85\u52A0\u5165",
    joinedCount: "\u5DF2\u52A0\u5165",
    initResourceDiscovery: "\u521D\u59CB\u5316",
    searchResources: "\u641C\u7D22\u8D44\u6E90",
    searchResourcesPlaceholder: "\u8F93\u5165\u5173\u952E\u8BCD\u641C\u7D22\u7FA4\u7EC4/\u9891\u9053...",
    processJoinQueue: "\u5904\u7406\u961F\u5217",
    batchJoin: "\u6279\u91CF\u52A0\u5165",
    addToQueue: "\u52A0\u5165\u961F\u5217",
    resourceType: "\u7C7B\u578B",
    resourceStatus: "\u72B6\u6001",
    memberCount: "\u6210\u5458\u6570",
    overallScore: "\u8BC4\u5206",
    discoveredAt: "\u53D1\u73B0\u65F6\u95F4",
    noResourcesFound: "\u6682\u65E0\u8D44\u6E90\u3002\u5F00\u59CB\u641C\u7D22\u5427\uFF01",
    chineseSearch: "\u4E2D\u6587\u641C\u7D22",
    tgstatAnalysis: "TGStat\u6570\u636E\u5206\u6790",
    resourceGroup: "\u7FA4\u7EC4",
    resourceSupergroup: "\u8D85\u7EA7\u7FA4\u7EC4",
    resourceChannel: "\u9891\u9053",
    statusDiscovered: "\u5DF2\u53D1\u73B0",
    statusQueued: "\u961F\u5217\u4E2D",
    statusJoined: "\u5DF2\u52A0\u5165",
    statusBlocked: "\u88AB\u5C01\u7981",
    selectAll: "\u5168\u9009",
    selectedCount: "\u5DF2\u9009",
    // Voice Clone
    voiceClone: "\u58F0\u97F3\u514B\u9686",
    voiceCloneHint: "\u4E0A\u4F20\u97F3\u9891\u6837\u672C\u6765\u514B\u9686\u58F0\u97F3\u7528\u4E8E TTS\u3002\u652F\u6301 WAV\u3001MP3\u3001OGG\u3001FLAC \u683C\u5F0F\uFF08\u6700\u5927 50MB\uFF09",
    uploadVoiceSample: "\u4E0A\u4F20\u58F0\u97F3\u6837\u672C",
    clonedVoices: "\u5DF2\u514B\u9686\u7684\u58F0\u97F3",
    noClonedVoices: "\u8FD8\u6CA1\u6709\u514B\u9686\u7684\u58F0\u97F3\u3002\u4E0A\u4F20\u97F3\u9891\u6837\u672C\u5F00\u59CB\u4F7F\u7528\u3002",
    voiceUploadSuccess: "\u58F0\u97F3\u6837\u672C\u4E0A\u4F20\u6210\u529F\uFF01",
    voiceUploadFailed: "\u58F0\u97F3\u6837\u672C\u4E0A\u4F20\u5931\u8D25",
    voiceDeleted: "\u58F0\u97F3\u6837\u672C\u5DF2\u5220\u9664",
    invalidAudioFormat: "\u97F3\u9891\u683C\u5F0F\u65E0\u6548\u3002\u8BF7\u4F7F\u7528 WAV\u3001MP3\u3001OGG \u6216 FLAC\u3002",
    audioFileTooLarge: "\u97F3\u9891\u6587\u4EF6\u8FC7\u5927\u3002\u6700\u5927\u5927\u5C0F\u4E3A 50MB\u3002",
    selectVoiceFirst: "\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u514B\u9686\u7684\u58F0\u97F3",
    ttsEndpointRequired: "\u8BF7\u5148\u914D\u7F6E TTS \u7AEF\u70B9",
    previewVoice: "\u9884\u89C8",
    useThisVoice: "\u4F7F\u7528",
    deleteVoice: "\u5220\u9664",
    remoteEndpointHint: "\u8F93\u5165\u670D\u52A1\u90E8\u7F72\u7684\u8FDC\u7A0B\u670D\u52A1\u5668 URL",
    // Voice Recording
    recordVoice: "\u5F55\u5236\u58F0\u97F3",
    startRecording: "\u5F00\u59CB\u5F55\u97F3",
    stopRecording: "\u505C\u6B62\u5F55\u97F3",
    recording: "\u5F55\u97F3\u4E2D...",
    recordingHint: "\u8BF7\u5F55\u5236 3-10 \u79D2\u6E05\u6670\u7684\u8BED\u97F3",
    voiceNameLabel: "\u58F0\u97F3\u540D\u79F0",
    voiceNamePlaceholder: "\u4F8B\u5982\uFF1A\u6211\u7684\u58F0\u97F3\u3001\u5BA2\u670D\u58F0\u97F3",
    promptTextLabel: "\u53C2\u8003\u6587\u672C\uFF08\u60A8\u8BF4\u7684\u5185\u5BB9\uFF09",
    promptTextPlaceholder: "\u8F93\u5165\u60A8\u5F55\u97F3\u65F6\u8BF4\u7684\u6587\u5B57...",
    confirmUpload: "\u786E\u8BA4\u5E76\u4E0A\u4F20",
    reRecord: "\u91CD\u65B0\u5F55\u97F3",
    recordingTooShort: "\u5F55\u97F3\u65F6\u95F4\u592A\u77ED\uFF0C\u8BF7\u81F3\u5C11\u5F55\u5236 3 \u79D2",
    recordingTooLong: "\u5F55\u97F3\u65F6\u95F4\u592A\u957F\uFF0C\u6700\u957F 10 \u79D2",
    voiceNameRequired: "\u8BF7\u8F93\u5165\u58F0\u97F3\u540D\u79F0",
    noRecordingToUpload: "\u6CA1\u6709\u53EF\u4E0A\u4F20\u7684\u5F55\u97F3\uFF0C\u8BF7\u5148\u5F55\u97F3",
    microphoneAccessDenied: "\u9EA6\u514B\u98CE\u8BBF\u95EE\u88AB\u62D2\u7EDD\uFF0C\u8BF7\u5141\u8BB8\u9EA6\u514B\u98CE\u6743\u9650",
    orUploadFile: "\u6216\u4E0A\u4F20\u97F3\u9891\u6587\u4EF6",
    seconds: "\u79D2",
    generateWithAi: "\u2728 AI \u751F\u6210",
    generating: "\u751F\u6210\u4E2D...",
    generatedMessage: "\u751F\u6210\u7684\u6D88\u606F",
    error: "\u9519\u8BEF:",
    cancel: "\u53D6\u6D88",
    sendMessage: "\u53D1\u9001\u6D88\u606F",
    language: "\u8BED\u8A00",
    appearance: "\u5916\u89C2",
    light: "\u6D45\u8272",
    dark: "\u6DF1\u8272",
    health: "\u5065\u5EB7\u5EA6",
    group: "\u5206\u7EC4",
    allAccounts: "\u6240\u6709\u8D26\u6237",
    importSession: "\u5BFC\u5165\u4F1A\u8BDD",
    exportSession: "\u5BFC\u51FA\u56DE\u8BDD",
    twoFactorPassword: "2FA \u5BC6\u7801 (\u53EF\u9009)",
    accountGroup: "\u8D26\u6237\u5206\u7EC4",
    accountHealthTooltip: "\u5065\u5EB7\u5206\u57FA\u4E8E\u8D26\u53F7\u6D3B\u8DC3\u5EA6\u3001\u4E2A\u4EBA\u8D44\u6599\u5B8C\u6574\u5EA6\u548C\u4EE3\u7406\u8D28\u91CF\u3002",
    viewLogs: "\u67E5\u770B\u65E5\u5FD7",
    fileBasedManagement: "\u6587\u4EF6\u7BA1\u7406",
    downloadTemplate: "\u4E0B\u8F7D\u6A21\u677F",
    uploadExcel: "\u4E0A\u4F20 Excel",
    reloadSessions: "\u91CD\u65B0\u52A0\u8F7D\u4F1A\u8BDD",
    noAccountsFound: "\u672A\u627E\u5230\u4EFB\u4F55\u8D26\u6237\u3002\u8BF7\u624B\u52A8\u6DFB\u52A0\u6216\u4E0A\u4F20 Excel \u6587\u4EF6\u3002",
    "New": "\u65B0\u5BA2\u6237",
    "Contacted": "\u5DF2\u8054\u7CFB",
    "Replied": "\u5DF2\u56DE\u590D",
    "Follow-up": "\u9700\u8DDF\u8FDB",
    "Closed-Won": "\u6210\u4EA4",
    "Closed-Lost": "\u6D41\u5931",
    moveTo: "\u79FB\u52A8\u5230",
    analyticsTitle: "\u6027\u80FD\u5206\u6790",
    replyRate: "\u56DE\u590D\u7387",
    replyRateDesc: "\u5DF2\u8054\u7CFB\u7684\u6F5C\u5728\u5BA2\u6237\u4E2D\u88AB\u79FB\u81F3\u201C\u5DF2\u56DE\u590D\u201D\u9636\u6BB5\u7684\u767E\u5206\u6BD4\u3002",
    templatePerformance: "\u6A21\u677F\u6027\u80FD",
    leadsOverTime: "\u6F5C\u5728\u5BA2\u6237\u8D8B\u52BF",
    last7Days: "\u8FC7\u53BB7\u5929",
    conversionFunnel: "\u8F6C\u5316\u6F0F\u6597",
    contactHistory: "\u8054\u7CFB\u5386\u53F2",
    noHistoryFound: "\u672A\u627E\u5230\u6B64\u6F5C\u5728\u5BA2\u6237\u7684\u5386\u53F2\u8BB0\u5F55\u3002",
    kanbanView: "\u770B\u677F",
    listView: "\u5217\u8868",
    exportToExcel: "\u5BFC\u51FA\u5230 Excel",
    onlineStatus: "\u5728\u7EBF\u72B6\u6001",
    userId: "\u7528\u6237 ID",
    leadName: "\u6F5C\u5728\u5BA2\u6237",
    capturedAt: "\u6355\u83B7\u4E8E",
    "Online": "\u5728\u7EBF",
    "Offline": "\u79BB\u7EBF",
    "Recently": "\u6700\u8FD1\u5728\u7EBF",
    "Unknown": "\u672A\u77E5",
    role: "\u89D2\u8272",
    "Listener": "\u76D1\u63A7\u53F7",
    "Sender": "\u53D1\u9001\u53F7",
    "Unassigned": "\u672A\u5206\u914D",
    "Logging in...": "\u767B\u5F55\u4E2D...",
    "Banned": "\u5DF2\u5C01\u7981",
    "Warming Up": "\u9884\u70ED\u4E2D",
    listenerConfiguration: "\u76D1\u63A7\u914D\u7F6E",
    senderConfiguration: "\u53D1\u9001\u4E0E\u81EA\u52A8\u5316\u914D\u7F6E",
    activeListenerAccounts: "\u5F53\u524D\u76D1\u63A7\u53F7",
    activeSenderAccounts: "\u5F53\u524D\u53D1\u9001\u53F7",
    outreachAutomation: "\u81EA\u52A8\u5916\u8054\u4E0E\u8DDF\u8FDB",
    enableAutoReply: "\u542F\u7528\u81EA\u52A8\u56DE\u590D",
    autoReplyHint: "\u5F53\u6F5C\u5728\u5BA2\u6237\u72B6\u6001\u53D8\u4E3A\u201C\u5DF2\u56DE\u590D\u201D\u65F6\uFF0C\u81EA\u52A8\u53D1\u9001\u4E00\u6761\u6D88\u606F\u4EE5\u786E\u8BA4\u3002",
    autoReplyMessage: "\u81EA\u52A8\u56DE\u590D\u6D88\u606F",
    autoReplyEditHint: "\u7F16\u8F91\u6D88\u606F\u5185\u5BB9\uFF0C\u70B9\u51FB\u4FDD\u5B58\u4EE5\u66F4\u65B0",
    saveAutoReply: "\u4FDD\u5B58",
    settingsSaved: "\u8BBE\u7F6E\u5DF2\u4FDD\u5B58\uFF01",
    saveSettings: "\u4FDD\u5B58\u8BBE\u7F6E",
    settingsAutoSaveHint: "\u66F4\u6539\u8BBE\u7F6E\u65F6\u4F1A\u81EA\u52A8\u4FDD\u5B58\uFF0C\u4E5F\u53EF\u4EE5\u624B\u52A8\u70B9\u51FB\u4FDD\u5B58",
    sendingDelays: "\u968F\u673A\u53D1\u9001\u5EF6\u8FDF",
    delayRangeHint: "\u5728\u53D1\u9001\u7B2C\u4E00\u6761\u6D88\u606F\u524D\uFF0C\u968F\u673A\u7B49\u5F85\u4E00\u6BB5\u65F6\u95F4\u3002",
    min: "\u6700\u5C0F (\u79D2)",
    max: "\u6700\u5927 (\u79D2)",
    noActiveListeners: "\u6CA1\u6709\u53EF\u7528\u7684\u76D1\u63A7\u53F7\u3002\u8BF7\u4E3A\u5728\u7EBF\u8D26\u6237\u5206\u914D\u201C\u76D1\u63A7\u53F7\u201D\u89D2\u8272\u3002",
    noActiveSenders: "\u6CA1\u6709\u53EF\u7528\u7684\u53D1\u9001\u53F7\u3002\u8BF7\u4E3A\u5728\u7EBF\u8D26\u6237\u5206\u914D\u201C\u53D1\u9001\u53F7\u201D\u89D2\u8272\u3002",
    sendingStrategy: "\u53D1\u9001\u7B56\u7565",
    sendImmediately: "\u7ACB\u5373\u53D1\u9001",
    sendWithinTimeWindow: "\u5728\u65F6\u95F4\u7A97\u53E3\u5185\u53D1\u9001",
    timeWindowHint: "\u4EC5\u5728\u8FD9\u4E9B\u672C\u5730\u65F6\u95F4\u4E4B\u95F4\u53D1\u9001\u6D88\u606F\u3002",
    from: "\u4ECE",
    to: "\u5230",
    smartSending: "\u667A\u80FD\u53D1\u9001",
    enableSmartSending: "\u542F\u7528\u667A\u80FD\u53D1\u9001",
    smartSendingHint: "\u4EC5\u5F53\u6F5C\u5728\u5BA2\u6237\u5728\u7EBF\u65F6\u53D1\u9001\u6D88\u606F\u3002\u5982\u679C\u79BB\u7EBF\u5219\u5C06\u6D88\u606F\u52A0\u5165\u961F\u5217\u3002",
    attachImage: "\u9644\u52A0\u56FE\u7247",
    attachFile: "\u9644\u52A0\u6587\u4EF6",
    checkStatus: "\u68C0\u67E5\u72B6\u6001",
    "Proxy Error": "\u4EE3\u7406\u9519\u8BEF",
    selected: "\u5DF2\u9009\u62E9",
    bulkActions: "\u6279\u91CF\u64CD\u4F5C",
    assignRole: "\u5206\u914D\u89D2\u8272",
    assignGroup: "\u5206\u914D\u5206\u7EC4",
    enterGroupName: "\u8F93\u5165\u65B0\u5206\u7EC4\u540D\u79F0:",
    deleteSelected: "\u5220\u9664\u6240\u9009",
    keywordSets: "\u5173\u952E\u8BCD\u96C6",
    newKeywordSet: "\u65B0\u5173\u952E\u8BCD\u96C6\u540D\u79F0",
    assignKeywordSets: "\u5206\u914D\u5173\u952E\u8BCD\u96C6",
    addToDNC: "\u6DFB\u52A0\u5230\u201C\u8BF7\u52FF\u8054\u7CFB\u201D\u5217\u8868",
    userOnDNC: "\u7528\u6237\u5DF2\u5728\u201C\u8BF7\u52FF\u8054\u7CFB\u201D\u5217\u8868",
    automationCampaigns: "\u81EA\u52A8\u5316\u6D3B\u52A8",
    campaigns: "\u6D3B\u52A8\u5217\u8868",
    createCampaign: "\u521B\u5EFA\u65B0\u6D3B\u52A8",
    campaignName: "\u6D3B\u52A8\u540D\u79F0",
    triggers: "\u89E6\u53D1\u5668",
    campaignTriggerHint: "\u5F53\u6F5C\u5728\u5BA2\u6237\u6EE1\u8DB3\u6240\u6709\u9009\u5B9A\u6761\u4EF6\u65F6\uFF0C\u5C06\u89E6\u53D1\u6B64\u6D3B\u52A8\u3002",
    sourceGroups: "\u6765\u6E90\u7FA4\u7EC4",
    messageTemplate: "\u6D88\u606F\u6A21\u677F",
    selectTemplate: "\u9009\u62E9\u4E00\u4E2A\u6A21\u677F...",
    noCampaignsFound: "\u5C1A\u672A\u521B\u5EFA\u4EFB\u4F55\u6D3B\u52A8\u3002",
    campaign: "\u6D3B\u52A8",
    groups: "\u7FA4\u7EC4",
    "Resting (Cooldown)": "\u4F11\u606F\u4E2D (\u51B7\u5374)",
    allCampaigns: "\u6240\u6709\u6D3B\u52A8",
    selectCampaign: "\u9009\u62E9\u6D3B\u52A8",
    campaignPerformance: "\u6D3B\u52A8\u6027\u80FD",
    replied: "\u5DF2\u56DE\u590D",
    campaignDetails: "\u6D3B\u52A8\u8BE6\u60C5",
    automationHub: "\u81EA\u52A8\u5316\u4E2D\u5FC3",
    monitoringTargets: "\u7B2C1\u6B65\uFF1A\u76D1\u63A7\u76EE\u6807",
    automationRules: "\u7B2C2\u6B65\uFF1A\u81EA\u52A8\u5316\u89C4\u5219",
    globalSendingConfig: "\u5168\u5C40\u53D1\u9001\u914D\u7F6E",
    accountStatus: "\u8D26\u6237\u72B6\u6001",
    addKeywordPlaceholder: "\u8F38\u5165\u95DC\u9375\u8A5E\u6216\u77ED\u8A9E\uFF08\u4F8B\u5982\uFF1Abitcoin, \u4ED8\u6B3E\uFF09",
    regexTooltip: '\u6B63\u5247\u8868\u9054\u5F0F\uFF1A\u4F7F\u7528\u6A21\u5F0F\u5339\u914D\u800C\u975E\u7CBE\u78BA\u6587\u5B57\u3002\u4F8B\u5982\uFF1Abitcoin|BTC \u53EF\u5339\u914D "bitcoin" \u6216 "BTC"',
    regexExamples: "\u6B63\u5247\u793A\u4F8B",
    regexExample1: "bitcoin|BTC - \u5339\u914D bitcoin \u6216 BTC",
    regexExample2: "pay.*ment - \u5339\u914D payment, payments \u7B49",
    regexExample3: "\\d+.*USD - \u5339\u914D\u6578\u5B57\u5F8C\u8DDF USD",
    addKeywordButton: "\u6DFB\u52A0",
    keywordAdded: "\u95DC\u9375\u8A5E\u5DF2\u6DFB\u52A0",
    keywordAddFailed: "\u6DFB\u52A0\u95DC\u9375\u8A5E\u5931\u6557",
    invalidRegex: "\u6B63\u5247\u8868\u9054\u5F0F\u8A9E\u6CD5\u932F\u8AA4",
    selectKeywordSetFirst: "\u8ACB\u5148\u9EDE\u64CA\u95DC\u9375\u8A5E\u96C6\u4EE5\u9078\u64C7",
    keywordEmpty: "\u95DC\u9375\u8A5E\u4E0D\u80FD\u70BA\u7A7A",
    testKeyword: "\u6E2C\u8A66",
    testKeywordPlaceholder: "\u8F38\u5165\u6E2C\u8A66\u6587\u672C...",
    keywordMatches: "\u5339\u914D",
    keywordNoMatch: "\u4E0D\u5339\u914D"
  }
};
var TranslationService = class _TranslationService {
  constructor() {
    this.language = signal("zh", ...ngDevMode ? [{ debugName: "language" }] : []);
    this.dictionary = signal(translations, ...ngDevMode ? [{ debugName: "dictionary" }] : []);
  }
  translate(key) {
    const lang = this.language();
    return this.dictionary()[lang][key] || key;
  }
  setLanguage(lang) {
    this.language.set(lang);
  }
  static {
    this.\u0275fac = function TranslationService_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _TranslationService)();
    };
  }
  static {
    this.\u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({ token: _TranslationService, factory: _TranslationService.\u0275fac, providedIn: "root" });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(TranslationService, [{
    type: Injectable,
    args: [{ providedIn: "root" }]
  }], null, null);
})();

// src/account-loader.service.ts
var AccountLoaderService = class _AccountLoaderService {
  constructor() {
    this.ipcService = inject(ElectronIpcService);
  }
  // All methods now delegate to the backend via IPC.
  /**
   * Asks the main process to trigger a download of the Excel template file.
   */
  downloadExcelTemplate() {
    this.ipcService.send("download-excel-template");
  }
  /**
   * Asks the main process to open a file dialog and load accounts from the selected Excel file.
   * The backend will handle file reading and parsing.
   * The frontend will receive an `accounts-updated` event upon completion.
   */
  loadAccountsFromExcel() {
    this.ipcService.send("load-accounts-from-excel");
  }
  /**
   * Asks the main process to reload accounts by merging data from the database/excel with
   * session files found on the local disk.
   */
  reloadSessionsAndAccounts() {
    this.ipcService.send("reload-sessions-and-accounts");
  }
  /**
   * Asks the main process to open a "save" dialog and export the provided leads to an Excel file.
   * @param leads The list of captured leads to export.
   */
  exportLeadsToExcel(leads) {
    this.ipcService.send("export-leads-to-excel", JSON.parse(JSON.stringify(leads)));
  }
  static {
    this.\u0275fac = function AccountLoaderService_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _AccountLoaderService)();
    };
  }
  static {
    this.\u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({ token: _AccountLoaderService, factory: _AccountLoaderService.\u0275fac });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AccountLoaderService, [{
    type: Injectable
  }], null, null);
})();

// src/toast.component.ts
var _forTrack0 = ($index, $item) => $item.id;
var _forTrack1 = ($index, $item) => $item.label;
function ToastComponent_For_2_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 6);
    \u0275\u0275text(1);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const toast_r1 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(toast_r1.title);
  }
}
function ToastComponent_For_2_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    const _r2 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "button", 12);
    \u0275\u0275domListener("click", function ToastComponent_For_2_Conditional_8_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r2);
      const toast_r1 = \u0275\u0275nextContext().$implicit;
      const ctx_r2 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r2.handleNextStep(toast_r1));
    });
    \u0275\u0275domElementStart(1, "span");
    \u0275\u0275text(2, "\u2192");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(3, "span", 13);
    \u0275\u0275text(4);
    \u0275\u0275domElementEnd()();
  }
  if (rf & 2) {
    const toast_r1 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(toast_r1.nextStep.label);
  }
}
function ToastComponent_For_2_Conditional_9_For_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "button", 15);
    \u0275\u0275domListener("click", function ToastComponent_For_2_Conditional_9_For_2_Template_button_click_0_listener() {
      const action_r5 = \u0275\u0275restoreView(_r4).$implicit;
      const toast_r1 = \u0275\u0275nextContext(2).$implicit;
      const ctx_r2 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r2.handleAction(toast_r1, action_r5));
    });
    \u0275\u0275text(1);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const action_r5 = ctx.$implicit;
    \u0275\u0275classProp("bg-white", action_r5.variant === "primary")("text-slate-900", action_r5.variant === "primary")("hover:bg-white/90", action_r5.variant === "primary")("bg-white/20", action_r5.variant === "secondary" || !action_r5.variant)("text-white", action_r5.variant === "secondary" || !action_r5.variant)("hover:bg-white/30", action_r5.variant === "secondary" || !action_r5.variant)("bg-red-600", action_r5.variant === "danger")("text-white", action_r5.variant === "danger")("hover:bg-red-700", action_r5.variant === "danger");
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", action_r5.label, " ");
  }
}
function ToastComponent_For_2_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 9);
    \u0275\u0275repeaterCreate(1, ToastComponent_For_2_Conditional_9_For_2_Template, 2, 19, "button", 14, _forTrack1);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const toast_r1 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275repeater(toast_r1.actions);
  }
}
function ToastComponent_For_2_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "button", 16);
    \u0275\u0275domListener("click", function ToastComponent_For_2_Conditional_10_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r6);
      const toast_r1 = \u0275\u0275nextContext().$implicit;
      const ctx_r2 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r2.dismiss(toast_r1.id));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275domElementStart(1, "svg", 17);
    \u0275\u0275domElement(2, "path", 18);
    \u0275\u0275domElementEnd()();
  }
}
function ToastComponent_For_2_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 11);
    \u0275\u0275domElement(1, "div", 19);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const toast_r1 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275styleProp("width", toast_r1.progress, "%");
  }
}
function ToastComponent_For_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 2)(1, "div", 3)(2, "div", 4);
    \u0275\u0275text(3);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(4, "div", 5);
    \u0275\u0275conditionalCreate(5, ToastComponent_For_2_Conditional_5_Template, 2, 1, "div", 6);
    \u0275\u0275domElementStart(6, "div", 7);
    \u0275\u0275text(7);
    \u0275\u0275domElementEnd();
    \u0275\u0275conditionalCreate(8, ToastComponent_For_2_Conditional_8_Template, 5, 1, "button", 8);
    \u0275\u0275conditionalCreate(9, ToastComponent_For_2_Conditional_9_Template, 3, 0, "div", 9);
    \u0275\u0275domElementEnd();
    \u0275\u0275conditionalCreate(10, ToastComponent_For_2_Conditional_10_Template, 3, 0, "button", 10);
    \u0275\u0275domElementEnd();
    \u0275\u0275conditionalCreate(11, ToastComponent_For_2_Conditional_11_Template, 2, 2, "div", 11);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const toast_r1 = ctx.$implicit;
    const ctx_r2 = \u0275\u0275nextContext();
    \u0275\u0275classProp("bg-emerald-500/95", toast_r1.type === "success")("bg-red-500/95", toast_r1.type === "error")("bg-amber-500/95", toast_r1.type === "warning")("bg-blue-500/95", toast_r1.type === "info")("bg-slate-700/95", toast_r1.type === "progress")("border-emerald-400/50", toast_r1.type === "success")("border-red-400/50", toast_r1.type === "error")("border-amber-400/50", toast_r1.type === "warning")("border-blue-400/50", toast_r1.type === "info")("border-slate-600/50", toast_r1.type === "progress");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", toast_r1.icon || ctx_r2.getDefaultIcon(toast_r1.type), " ");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(toast_r1.title ? 5 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", toast_r1.message, " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(toast_r1.nextStep ? 8 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(toast_r1.actions && toast_r1.actions.length > 0 ? 9 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(toast_r1.dismissible !== false ? 10 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(toast_r1.type === "progress" && toast_r1.progress !== void 0 ? 11 : -1);
  }
}
var ToastComponent = class _ToastComponent {
  constructor() {
    this.toastService = inject(ToastService);
  }
  get toasts() {
    return this.toastService.getToasts();
  }
  getDefaultIcon(type) {
    const icons = {
      success: "\u2705",
      error: "\u274C",
      warning: "\u26A0\uFE0F",
      info: "\u2139\uFE0F",
      progress: "\u23F3"
    };
    return icons[type] || "\u2139\uFE0F";
  }
  dismiss(id) {
    this.toastService.dismiss(id);
  }
  handleNextStep(toast) {
    if (toast.nextStep) {
      toast.nextStep.action();
      this.dismiss(toast.id);
    }
  }
  handleAction(toast, action) {
    action.handler();
    this.dismiss(toast.id);
  }
  static {
    this.\u0275fac = function ToastComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _ToastComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _ToastComponent, selectors: [["app-toast"]], decls: 3, vars: 0, consts: [[1, "fixed", "top-4", "right-4", "z-[9999]", "space-y-3", "max-w-md"], [1, "toast-item", "rounded-xl", "shadow-2xl", "backdrop-blur-md", "border", "animate-slide-in", "overflow-hidden", 3, "bg-emerald-500/95", "bg-red-500/95", "bg-amber-500/95", "bg-blue-500/95", "bg-slate-700/95", "border-emerald-400/50", "border-red-400/50", "border-amber-400/50", "border-blue-400/50", "border-slate-600/50"], [1, "toast-item", "rounded-xl", "shadow-2xl", "backdrop-blur-md", "border", "animate-slide-in", "overflow-hidden"], [1, "flex", "items-start", "gap-3", "p-4"], [1, "flex-shrink-0", "text-xl"], [1, "flex-1", "min-w-0"], [1, "font-semibold", "text-white", "mb-0.5"], [1, "text-white", "text-sm"], [1, "mt-2", "text-xs", "text-white/90", "hover:text-white", "flex", "items-center", "gap-1", "transition-colors"], [1, "flex", "items-center", "gap-2", "mt-3"], [1, "flex-shrink-0", "text-white/60", "hover:text-white", "transition-colors", "p-1", "-mr-1", "-mt-1"], [1, "h-1", "bg-slate-600"], [1, "mt-2", "text-xs", "text-white/90", "hover:text-white", "flex", "items-center", "gap-1", "transition-colors", 3, "click"], [1, "underline"], [1, "px-3", "py-1.5", "rounded-lg", "text-xs", "font-medium", "transition-all", 3, "bg-white", "text-slate-900", "hover:bg-white/90", "bg-white/20", "text-white", "hover:bg-white/30", "bg-red-600", "hover:bg-red-700"], [1, "px-3", "py-1.5", "rounded-lg", "text-xs", "font-medium", "transition-all", 3, "click"], [1, "flex-shrink-0", "text-white/60", "hover:text-white", "transition-colors", "p-1", "-mr-1", "-mt-1", 3, "click"], ["fill", "none", "viewBox", "0 0 24 24", "stroke", "currentColor", 1, "h-4", "w-4"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M6 18L18 6M6 6l12 12"], [1, "h-full", "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "transition-all", "duration-300"]], template: function ToastComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275domElementStart(0, "div", 0);
        \u0275\u0275repeaterCreate(1, ToastComponent_For_2_Template, 12, 27, "div", 1, _forTrack0);
        \u0275\u0275domElementEnd();
      }
      if (rf & 2) {
        \u0275\u0275advance();
        \u0275\u0275repeater(ctx.toasts());
      }
    }, dependencies: [CommonModule], styles: ["\n\n@keyframes _ngcontent-%COMP%_slide-in {\n  from {\n    transform: translateX(100%) scale(0.95);\n    opacity: 0;\n  }\n  to {\n    transform: translateX(0) scale(1);\n    opacity: 1;\n  }\n}\n.animate-slide-in[_ngcontent-%COMP%] {\n  animation: _ngcontent-%COMP%_slide-in 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n}\n/*# sourceMappingURL=toast.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(ToastComponent, [{
    type: Component,
    args: [{ selector: "app-toast", standalone: true, imports: [CommonModule], template: `
    <div class="fixed top-4 right-4 z-[9999] space-y-3 max-w-md">
      @for(toast of toasts(); track toast.id) {
        <div 
          class="toast-item rounded-xl shadow-2xl backdrop-blur-md border animate-slide-in overflow-hidden"
          [class.bg-emerald-500/95]="toast.type === 'success'"
          [class.bg-red-500/95]="toast.type === 'error'"
          [class.bg-amber-500/95]="toast.type === 'warning'"
          [class.bg-blue-500/95]="toast.type === 'info'"
          [class.bg-slate-700/95]="toast.type === 'progress'"
          [class.border-emerald-400/50]="toast.type === 'success'"
          [class.border-red-400/50]="toast.type === 'error'"
          [class.border-amber-400/50]="toast.type === 'warning'"
          [class.border-blue-400/50]="toast.type === 'info'"
          [class.border-slate-600/50]="toast.type === 'progress'">
          
          <!-- \u4E3B\u5167\u5BB9 -->
          <div class="flex items-start gap-3 p-4">
            <!-- Icon -->
            <div class="flex-shrink-0 text-xl">
              {{ toast.icon || getDefaultIcon(toast.type) }}
            </div>
            
            <!-- Message -->
            <div class="flex-1 min-w-0">
              @if (toast.title) {
                <div class="font-semibold text-white mb-0.5">{{ toast.title }}</div>
              }
              <div class="text-white text-sm">
                {{ toast.message }}
              </div>
              
              <!-- \u4E0B\u4E00\u6B65\u63D0\u793A -->
              @if (toast.nextStep) {
                <button 
                  (click)="handleNextStep(toast)"
                  class="mt-2 text-xs text-white/90 hover:text-white flex items-center gap-1 transition-colors">
                  <span>\u2192</span>
                  <span class="underline">{{ toast.nextStep.label }}</span>
                </button>
              }
              
              <!-- \u64CD\u4F5C\u6309\u9215 -->
              @if (toast.actions && toast.actions.length > 0) {
                <div class="flex items-center gap-2 mt-3">
                  @for (action of toast.actions; track action.label) {
                    <button 
                      (click)="handleAction(toast, action)"
                      class="px-3 py-1.5 rounded-lg text-xs font-medium transition-all"
                      [class.bg-white]="action.variant === 'primary'"
                      [class.text-slate-900]="action.variant === 'primary'"
                      [class.hover:bg-white/90]="action.variant === 'primary'"
                      [class.bg-white/20]="action.variant === 'secondary' || !action.variant"
                      [class.text-white]="action.variant === 'secondary' || !action.variant"
                      [class.hover:bg-white/30]="action.variant === 'secondary' || !action.variant"
                      [class.bg-red-600]="action.variant === 'danger'"
                      [class.text-white]="action.variant === 'danger'"
                      [class.hover:bg-red-700]="action.variant === 'danger'">
                      {{ action.label }}
                    </button>
                  }
                </div>
              }
            </div>
            
            <!-- Close button -->
            @if (toast.dismissible !== false) {
              <button 
                (click)="dismiss(toast.id)"
                class="flex-shrink-0 text-white/60 hover:text-white transition-colors p-1 -mr-1 -mt-1">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            }
          </div>
          
          <!-- \u9032\u5EA6\u689D -->
          @if (toast.type === 'progress' && toast.progress !== undefined) {
            <div class="h-1 bg-slate-600">
              <div 
                class="h-full bg-gradient-to-r from-cyan-500 to-blue-500 transition-all duration-300"
                [style.width.%]="toast.progress">
              </div>
            </div>
          }
        </div>
      }
    </div>
  `, styles: ["/* angular:styles/component:css;fb7864e74ad0e60560259ca3953e9e02e0ac8d796678c9d69d33a7d2310d2602;D:/tgkz2026/src/toast.component.ts */\n@keyframes slide-in {\n  from {\n    transform: translateX(100%) scale(0.95);\n    opacity: 0;\n  }\n  to {\n    transform: translateX(0) scale(1);\n    opacity: 1;\n  }\n}\n.animate-slide-in {\n  animation: slide-in 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n}\n/*# sourceMappingURL=toast.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(ToastComponent, { className: "ToastComponent", filePath: "src/toast.component.ts", lineNumber: 120 });
})();

// src/global-confirm-dialog.component.ts
function GlobalConfirmDialogComponent_Conditional_0_Case_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 5);
    \u0275\u0275text(1, "\u2139\uFE0F");
    \u0275\u0275elementEnd();
  }
}
function GlobalConfirmDialogComponent_Conditional_0_Case_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 6);
    \u0275\u0275text(1, "\u26A0\uFE0F");
    \u0275\u0275elementEnd();
  }
}
function GlobalConfirmDialogComponent_Conditional_0_Case_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 7);
    \u0275\u0275text(1, "\u{1F5D1}\uFE0F");
    \u0275\u0275elementEnd();
  }
}
function GlobalConfirmDialogComponent_Conditional_0_Conditional_13_For_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "li", 18);
    \u0275\u0275element(1, "span", 20);
    \u0275\u0275elementStart(2, "span", 21);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const item_r3 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275classProp("bg-yellow-500", ctx_r1.dialogService.state().type === "warning")("bg-red-500", ctx_r1.dialogService.state().type === "danger")("bg-blue-500", ctx_r1.dialogService.state().type === "info");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(item_r3);
  }
}
function GlobalConfirmDialogComponent_Conditional_0_Conditional_13_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "li", 19);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("...\u9084\u6709 ", ctx_r1.dialogService.state().affectedItems.length - 5, " \u9805");
  }
}
function GlobalConfirmDialogComponent_Conditional_0_Conditional_13_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 11)(1, "p", 16);
    \u0275\u0275text(2, "\u5C07\u6703\u53D7\u5230\u5F71\u97FF:");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "ul", 17);
    \u0275\u0275repeaterCreate(4, GlobalConfirmDialogComponent_Conditional_0_Conditional_13_For_5_Template, 4, 7, "li", 18, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275conditionalCreate(6, GlobalConfirmDialogComponent_Conditional_0_Conditional_13_Conditional_6_Template, 2, 1, "li", 19);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(4);
    \u0275\u0275repeater(ctx_r1.dialogService.state().affectedItems.slice(0, 5));
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.dialogService.state().affectedItems.length > 5 ? 6 : -1);
  }
}
function GlobalConfirmDialogComponent_Conditional_0_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 12)(1, "p", 16);
    \u0275\u0275text(2, " \u8F38\u5165\u300C");
    \u0275\u0275elementStart(3, "span", 22);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275text(5, "\u300D\u4EE5\u78BA\u8A8D ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "input", 23);
    \u0275\u0275twoWayListener("ngModelChange", function GlobalConfirmDialogComponent_Conditional_0_Conditional_14_Template_input_ngModelChange_6_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.confirmTextInput, $event) || (ctx_r1.confirmTextInput = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r1.dialogService.state().confirmTextRequired);
    \u0275\u0275advance(2);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.confirmTextInput);
  }
}
function GlobalConfirmDialogComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 0)(1, "div", 1);
    \u0275\u0275listener("click", function GlobalConfirmDialogComponent_Conditional_0_Template_div_click_1_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.dialogService.onCancel());
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "div", 2)(3, "div", 3)(4, "div", 4);
    \u0275\u0275conditionalCreate(5, GlobalConfirmDialogComponent_Conditional_0_Case_5_Template, 2, 0, "span", 5)(6, GlobalConfirmDialogComponent_Conditional_0_Case_6_Template, 2, 0, "span", 6)(7, GlobalConfirmDialogComponent_Conditional_0_Case_7_Template, 2, 0, "span", 7);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(8, "div", 8)(9, "h3", 9);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "p", 10);
    \u0275\u0275text(12);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(13, GlobalConfirmDialogComponent_Conditional_0_Conditional_13_Template, 7, 1, "div", 11);
    \u0275\u0275conditionalCreate(14, GlobalConfirmDialogComponent_Conditional_0_Conditional_14_Template, 7, 2, "div", 12);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "div", 13)(16, "button", 14);
    \u0275\u0275listener("click", function GlobalConfirmDialogComponent_Conditional_0_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.dialogService.onCancel());
    });
    \u0275\u0275text(17);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "button", 15);
    \u0275\u0275listener("click", function GlobalConfirmDialogComponent_Conditional_0_Template_button_click_18_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.onConfirmClick());
    });
    \u0275\u0275text(19);
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    let tmp_4_0;
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(4);
    \u0275\u0275classProp("bg-blue-500/20", ctx_r1.dialogService.state().type === "info")("bg-yellow-500/20", ctx_r1.dialogService.state().type === "warning")("bg-red-500/20", ctx_r1.dialogService.state().type === "danger");
    \u0275\u0275advance();
    \u0275\u0275conditional((tmp_4_0 = ctx_r1.dialogService.state().type) === "info" ? 5 : tmp_4_0 === "warning" ? 6 : tmp_4_0 === "danger" ? 7 : -1);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r1.dialogService.state().title);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r1.dialogService.state().message);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.dialogService.state().affectedItems && ctx_r1.dialogService.state().affectedItems.length > 0 ? 13 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.dialogService.state().requireConfirmText ? 14 : -1);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", ctx_r1.dialogService.state().cancelText, " ");
    \u0275\u0275advance();
    \u0275\u0275classProp("bg-blue-500", ctx_r1.dialogService.state().type === "info")("hover:bg-blue-600", ctx_r1.dialogService.state().type === "info")("bg-yellow-500", ctx_r1.dialogService.state().type === "warning")("hover:bg-yellow-600", ctx_r1.dialogService.state().type === "warning")("text-black", ctx_r1.dialogService.state().type === "warning")("bg-red-500", ctx_r1.dialogService.state().type === "danger")("hover:bg-red-600", ctx_r1.dialogService.state().type === "danger")("text-white", ctx_r1.dialogService.state().type !== "warning");
    \u0275\u0275property("disabled", !ctx_r1.canConfirm());
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.dialogService.state().confirmText, " ");
  }
}
var GlobalConfirmDialogComponent = class _GlobalConfirmDialogComponent {
  constructor() {
    this.dialogService = inject(ConfirmDialogService);
    this.confirmTextInput = "";
  }
  canConfirm() {
    const state = this.dialogService.state();
    if (state.requireConfirmText) {
      return this.confirmTextInput === state.confirmTextRequired;
    }
    return true;
  }
  onConfirmClick() {
    if (this.canConfirm()) {
      this.confirmTextInput = "";
      this.dialogService.onConfirm();
    }
  }
  static {
    this.\u0275fac = function GlobalConfirmDialogComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _GlobalConfirmDialogComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _GlobalConfirmDialogComponent, selectors: [["app-global-confirm-dialog"]], decls: 1, vars: 1, consts: [[1, "fixed", "inset-0", "z-[9999]", "flex", "items-center", "justify-center", "p-4"], [1, "absolute", "inset-0", "bg-black/60", "backdrop-blur-sm", "animate-fade-in", 3, "click"], [1, "relative", "w-full", "max-w-md", "bg-slate-800", "rounded-2xl", "shadow-2xl", "border", "border-slate-700", "transform", "animate-scale-in"], [1, "pt-6", "text-center"], [1, "inline-flex", "w-16", "h-16", "rounded-full", "items-center", "justify-center", "text-3xl"], [1, "text-blue-400"], [1, "text-yellow-400"], [1, "text-red-400"], [1, "p-6", "text-center"], [1, "text-lg", "font-semibold", "text-white", "mb-2"], [1, "text-sm", "text-slate-400", "mb-4", "whitespace-pre-line"], [1, "mt-4", "p-3", "bg-slate-700/50", "rounded-lg", "text-left", "max-h-32", "overflow-y-auto"], [1, "mt-4"], [1, "flex", "gap-3", "p-4", "border-t", "border-slate-700"], [1, "flex-1", "px-4", "py-2.5", "bg-slate-700", "hover:bg-slate-600", "text-white", "rounded-lg", "transition-colors", 3, "click"], [1, "flex-1", "px-4", "py-2.5", "rounded-lg", "transition-colors", "font-medium", "disabled:opacity-50", "disabled:cursor-not-allowed", 3, "click", "disabled"], [1, "text-xs", "text-slate-500", "mb-2"], [1, "space-y-1"], [1, "text-sm", "text-slate-300", "flex", "items-center", "gap-2"], [1, "text-xs", "text-slate-500"], [1, "w-1.5", "h-1.5", "rounded-full", "flex-shrink-0"], [1, "truncate"], [1, "text-red-400", "font-medium"], ["type", "text", "placeholder", "\u8ACB\u8F38\u5165\u78BA\u8A8D\u6587\u5B57", 1, "w-full", "px-3", "py-2", "bg-slate-700", "border", "border-slate-600", "rounded-lg", "text-white", "text-center", "focus:border-red-500", "focus:outline-none", 3, "ngModelChange", "ngModel"]], template: function GlobalConfirmDialogComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, GlobalConfirmDialogComponent_Conditional_0_Template, 20, 30, "div", 0);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.dialogService.state().isOpen ? 0 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, DefaultValueAccessor, NgControlStatus, NgModel], styles: ["\n\n@keyframes _ngcontent-%COMP%_fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n@keyframes _ngcontent-%COMP%_scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n.animate-fade-in[_ngcontent-%COMP%] {\n  animation: _ngcontent-%COMP%_fade-in 0.15s ease-out;\n}\n.animate-scale-in[_ngcontent-%COMP%] {\n  animation: _ngcontent-%COMP%_scale-in 0.2s ease-out;\n}\n/*# sourceMappingURL=global-confirm-dialog.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(GlobalConfirmDialogComponent, [{
    type: Component,
    args: [{ selector: "app-global-confirm-dialog", standalone: true, imports: [CommonModule, FormsModule], template: `
    @if (dialogService.state().isOpen) {
      <div class="fixed inset-0 z-[9999] flex items-center justify-center p-4">
        <!-- \u906E\u7F69 -->
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm animate-fade-in"
             (click)="dialogService.onCancel()">
        </div>
        
        <!-- \u5C0D\u8A71\u6846 -->
        <div class="relative w-full max-w-md bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 
                    transform animate-scale-in">
          <!-- \u5716\u6A19 -->
          <div class="pt-6 text-center">
            <div class="inline-flex w-16 h-16 rounded-full items-center justify-center text-3xl"
                 [class.bg-blue-500/20]="dialogService.state().type === 'info'"
                 [class.bg-yellow-500/20]="dialogService.state().type === 'warning'"
                 [class.bg-red-500/20]="dialogService.state().type === 'danger'">
              @switch (dialogService.state().type) {
                @case ('info') { <span class="text-blue-400">\u2139\uFE0F</span> }
                @case ('warning') { <span class="text-yellow-400">\u26A0\uFE0F</span> }
                @case ('danger') { <span class="text-red-400">\u{1F5D1}\uFE0F</span> }
              }
            </div>
          </div>
          
          <!-- \u5167\u5BB9 -->
          <div class="p-6 text-center">
            <h3 class="text-lg font-semibold text-white mb-2">{{ dialogService.state().title }}</h3>
            <p class="text-sm text-slate-400 mb-4 whitespace-pre-line">{{ dialogService.state().message }}</p>
            
            <!-- \u53D7\u5F71\u97FF\u9805\u76EE\u5217\u8868 -->
            @if (dialogService.state().affectedItems && dialogService.state().affectedItems!.length > 0) {
              <div class="mt-4 p-3 bg-slate-700/50 rounded-lg text-left max-h-32 overflow-y-auto">
                <p class="text-xs text-slate-500 mb-2">\u5C07\u6703\u53D7\u5230\u5F71\u97FF:</p>
                <ul class="space-y-1">
                  @for (item of dialogService.state().affectedItems!.slice(0, 5); track item) {
                    <li class="text-sm text-slate-300 flex items-center gap-2">
                      <span class="w-1.5 h-1.5 rounded-full flex-shrink-0"
                            [class.bg-yellow-500]="dialogService.state().type === 'warning'"
                            [class.bg-red-500]="dialogService.state().type === 'danger'"
                            [class.bg-blue-500]="dialogService.state().type === 'info'">
                      </span>
                      <span class="truncate">{{ item }}</span>
                    </li>
                  }
                  @if (dialogService.state().affectedItems!.length > 5) {
                    <li class="text-xs text-slate-500">...\u9084\u6709 {{ dialogService.state().affectedItems!.length - 5 }} \u9805</li>
                  }
                </ul>
              </div>
            }
            
            <!-- \u5371\u96AA\u64CD\u4F5C\u9700\u8981\u8F38\u5165\u78BA\u8A8D -->
            @if (dialogService.state().requireConfirmText) {
              <div class="mt-4">
                <p class="text-xs text-slate-500 mb-2">
                  \u8F38\u5165\u300C<span class="text-red-400 font-medium">{{ dialogService.state().confirmTextRequired }}</span>\u300D\u4EE5\u78BA\u8A8D
                </p>
                <input type="text"
                       [(ngModel)]="confirmTextInput"
                       class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white text-center
                              focus:border-red-500 focus:outline-none"
                       placeholder="\u8ACB\u8F38\u5165\u78BA\u8A8D\u6587\u5B57">
              </div>
            }
          </div>
          
          <!-- \u6309\u9215 -->
          <div class="flex gap-3 p-4 border-t border-slate-700">
            <button (click)="dialogService.onCancel()"
                    class="flex-1 px-4 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">
              {{ dialogService.state().cancelText }}
            </button>
            <button (click)="onConfirmClick()"
                    [disabled]="!canConfirm()"
                    class="flex-1 px-4 py-2.5 rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed"
                    [class.bg-blue-500]="dialogService.state().type === 'info'"
                    [class.hover:bg-blue-600]="dialogService.state().type === 'info'"
                    [class.bg-yellow-500]="dialogService.state().type === 'warning'"
                    [class.hover:bg-yellow-600]="dialogService.state().type === 'warning'"
                    [class.text-black]="dialogService.state().type === 'warning'"
                    [class.bg-red-500]="dialogService.state().type === 'danger'"
                    [class.hover:bg-red-600]="dialogService.state().type === 'danger'"
                    [class.text-white]="dialogService.state().type !== 'warning'">
              {{ dialogService.state().confirmText }}
            </button>
          </div>
        </div>
      </div>
    }
  `, styles: ["/* angular:styles/component:css;28960841c3dbc0fc51dd41b8f0e56e1bb8e2bcbe62c0010aa6c16e5ea2b0d62d;D:/tgkz2026/src/global-confirm-dialog.component.ts */\n@keyframes fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n.animate-fade-in {\n  animation: fade-in 0.15s ease-out;\n}\n.animate-scale-in {\n  animation: scale-in 0.2s ease-out;\n}\n/*# sourceMappingURL=global-confirm-dialog.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(GlobalConfirmDialogComponent, { className: "GlobalConfirmDialogComponent", filePath: "src/global-confirm-dialog.component.ts", lineNumber: 122 });
})();

// src/global-input-dialog.component.ts
var _c0 = ["inputRef"];
function GlobalInputDialogComponent_Conditional_0_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 6);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_2_0;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate((tmp_2_0 = ctx_r1.dialogService.inputDialog()) == null ? null : tmp_2_0.message);
  }
}
function GlobalInputDialogComponent_Conditional_0_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "textarea", 14, 0);
    \u0275\u0275twoWayListener("ngModelChange", function GlobalInputDialogComponent_Conditional_0_Conditional_10_Template_textarea_ngModelChange_0_listener($event) {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.inputValue, $event) || (ctx_r1.inputValue = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275listener("keydown.enter", function GlobalInputDialogComponent_Conditional_0_Conditional_10_Template_textarea_keydown_enter_0_listener($event) {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.onEnterKey($event));
    });
    \u0275\u0275text(2, "              ");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_4_0;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.inputValue);
    \u0275\u0275property("placeholder", ((tmp_4_0 = ctx_r1.dialogService.inputDialog()) == null ? null : tmp_4_0.placeholder) || "\u8ACB\u8F38\u5165...");
  }
}
function GlobalInputDialogComponent_Conditional_0_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "input", 15, 0);
    \u0275\u0275twoWayListener("ngModelChange", function GlobalInputDialogComponent_Conditional_0_Conditional_11_Template_input_ngModelChange_0_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.inputValue, $event) || (ctx_r1.inputValue = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275listener("keydown.enter", function GlobalInputDialogComponent_Conditional_0_Conditional_11_Template_input_keydown_enter_0_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.onEnterKey($event));
    });
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_4_0;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.inputValue);
    \u0275\u0275property("placeholder", ((tmp_4_0 = ctx_r1.dialogService.inputDialog()) == null ? null : tmp_4_0.placeholder) || "\u8ACB\u8F38\u5165...");
  }
}
function GlobalInputDialogComponent_Conditional_0_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 10)(1, "span");
    \u0275\u0275text(2, "\u26A0\uFE0F");
    \u0275\u0275elementEnd();
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", ctx_r1.dialogService.inputDialogError(), " ");
  }
}
function GlobalInputDialogComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 1)(1, "div", 2);
    \u0275\u0275listener("click", function GlobalInputDialogComponent_Conditional_0_Template_div_click_1_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.cancelDialog());
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "div", 3)(3, "div", 4)(4, "h3", 5)(5, "span");
    \u0275\u0275text(6, "\u270F\uFE0F");
    \u0275\u0275elementEnd();
    \u0275\u0275text(7);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(8, GlobalInputDialogComponent_Conditional_0_Conditional_8_Template, 2, 1, "p", 6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "div", 7);
    \u0275\u0275listener("click", function GlobalInputDialogComponent_Conditional_0_Template_div_click_9_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.focusInput($event));
    });
    \u0275\u0275conditionalCreate(10, GlobalInputDialogComponent_Conditional_0_Conditional_10_Template, 3, 2, "textarea", 8)(11, GlobalInputDialogComponent_Conditional_0_Conditional_11_Template, 2, 2, "input", 9);
    \u0275\u0275conditionalCreate(12, GlobalInputDialogComponent_Conditional_0_Conditional_12_Template, 4, 1, "p", 10);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "div", 11)(14, "button", 12);
    \u0275\u0275listener("click", function GlobalInputDialogComponent_Conditional_0_Template_button_click_14_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.cancelDialog());
    });
    \u0275\u0275text(15);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "button", 13);
    \u0275\u0275listener("click", function GlobalInputDialogComponent_Conditional_0_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.confirmWithValue());
    });
    \u0275\u0275text(17);
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    let tmp_1_0;
    let tmp_2_0;
    let tmp_3_0;
    let tmp_5_0;
    let tmp_6_0;
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(7);
    \u0275\u0275textInterpolate1(" ", (tmp_1_0 = ctx_r1.dialogService.inputDialog()) == null ? null : tmp_1_0.title, " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(((tmp_2_0 = ctx_r1.dialogService.inputDialog()) == null ? null : tmp_2_0.message) ? 8 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(((tmp_3_0 = ctx_r1.dialogService.inputDialog()) == null ? null : tmp_3_0.inputType) === "textarea" ? 10 : 11);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.dialogService.inputDialogError() ? 12 : -1);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", ((tmp_5_0 = ctx_r1.dialogService.inputDialog()) == null ? null : tmp_5_0.cancelText) || "\u53D6\u6D88", " ");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", ((tmp_6_0 = ctx_r1.dialogService.inputDialog()) == null ? null : tmp_6_0.confirmText) || "\u78BA\u5B9A", " ");
  }
}
var GlobalInputDialogComponent = class _GlobalInputDialogComponent {
  constructor() {
    this.dialogService = inject(DialogService);
    this.inputValue = "";
    this.lastDialogState = false;
  }
  ngAfterViewChecked() {
    const isOpen = !!this.dialogService.inputDialog();
    if (isOpen && !this.lastDialogState) {
      this.inputValue = this.dialogService.inputDialog()?.defaultValue || "";
      setTimeout(() => this.focusInput(), 100);
      setTimeout(() => this.focusInput(), 300);
    }
    if (!isOpen && this.lastDialogState) {
      this.inputValue = "";
    }
    this.lastDialogState = isOpen;
  }
  focusInput(event) {
    if (event) {
      event.stopPropagation();
    }
    if (this.inputRef?.nativeElement) {
      this.inputRef.nativeElement.focus();
      console.log("[InputDialog] Focus requested");
    }
  }
  onEnterKey(event) {
    if (this.dialogService.inputDialog()?.inputType !== "textarea") {
      event.preventDefault();
      this.confirmWithValue();
    }
  }
  confirmWithValue() {
    this.dialogService.updateInputValue(this.inputValue);
    this.dialogService.confirmInput();
  }
  cancelDialog() {
    this.inputValue = "";
    this.dialogService.cancelInput();
  }
  static {
    this.\u0275fac = function GlobalInputDialogComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _GlobalInputDialogComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _GlobalInputDialogComponent, selectors: [["app-global-input-dialog"]], viewQuery: function GlobalInputDialogComponent_Query(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275viewQuery(_c0, 5);
      }
      if (rf & 2) {
        let _t;
        \u0275\u0275queryRefresh(_t = \u0275\u0275loadQuery()) && (ctx.inputRef = _t.first);
      }
    }, decls: 1, vars: 1, consts: [["inputRef", ""], [1, "fixed", "inset-0", "z-[9999]", "flex", "items-center", "justify-center", "p-4"], [1, "absolute", "inset-0", "bg-black/60", "backdrop-blur-sm", "animate-fade-in", 3, "click"], [1, "relative", "w-full", "max-w-md", "bg-slate-800", "rounded-2xl", "shadow-2xl", "border", "border-slate-700", "transform", "animate-scale-in"], [1, "p-6", "pb-4"], [1, "text-lg", "font-semibold", "text-white", "flex", "items-center", "gap-2"], [1, "text-sm", "text-slate-400", "mt-2"], [1, "px-6", "pb-4", 3, "click"], ["rows", "4", 1, "w-full", "px-4", "py-3", "bg-slate-700", "border", "border-slate-600", "rounded-xl", "text-white", "placeholder-slate-500", "focus:border-purple-500", "focus:outline-none", "focus:ring-2", "focus:ring-purple-500/20", "resize-none", "transition-all", 3, "ngModel", "placeholder"], ["type", "text", 1, "w-full", "px-4", "py-3", "bg-slate-700", "border", "border-slate-600", "rounded-xl", "text-white", "placeholder-slate-500", "focus:border-purple-500", "focus:outline-none", "focus:ring-2", "focus:ring-purple-500/20", "transition-all", "cursor-text", 3, "ngModel", "placeholder"], [1, "mt-2", "text-sm", "text-red-400", "flex", "items-center", "gap-1"], [1, "flex", "gap-3", "p-4", "border-t", "border-slate-700"], [1, "flex-1", "px-4", "py-2.5", "bg-slate-700", "hover:bg-slate-600", "text-white", "rounded-lg", "transition-colors", 3, "click"], [1, "flex-1", "px-4", "py-2.5", "bg-purple-500", "hover:bg-purple-600", "text-white", "rounded-lg", "transition-colors", "font-medium", 3, "click"], ["rows", "4", 1, "w-full", "px-4", "py-3", "bg-slate-700", "border", "border-slate-600", "rounded-xl", "text-white", "placeholder-slate-500", "focus:border-purple-500", "focus:outline-none", "focus:ring-2", "focus:ring-purple-500/20", "resize-none", "transition-all", 3, "ngModelChange", "keydown.enter", "ngModel", "placeholder"], ["type", "text", 1, "w-full", "px-4", "py-3", "bg-slate-700", "border", "border-slate-600", "rounded-xl", "text-white", "placeholder-slate-500", "focus:border-purple-500", "focus:outline-none", "focus:ring-2", "focus:ring-purple-500/20", "transition-all", "cursor-text", 3, "ngModelChange", "keydown.enter", "ngModel", "placeholder"]], template: function GlobalInputDialogComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, GlobalInputDialogComponent_Conditional_0_Template, 18, 6, "div", 1);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.dialogService.inputDialog() ? 0 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, DefaultValueAccessor, NgControlStatus, NgModel], styles: ["\n\n@keyframes _ngcontent-%COMP%_fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n@keyframes _ngcontent-%COMP%_scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n.animate-fade-in[_ngcontent-%COMP%] {\n  animation: _ngcontent-%COMP%_fade-in 0.15s ease-out;\n}\n.animate-scale-in[_ngcontent-%COMP%] {\n  animation: _ngcontent-%COMP%_scale-in 0.2s ease-out;\n}\n/*# sourceMappingURL=global-input-dialog.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(GlobalInputDialogComponent, [{
    type: Component,
    args: [{ selector: "app-global-input-dialog", standalone: true, imports: [CommonModule, FormsModule], template: `
    @if (dialogService.inputDialog()) {
      <div class="fixed inset-0 z-[9999] flex items-center justify-center p-4">
        <!-- \u906E\u7F69 -->
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm animate-fade-in"
             (click)="cancelDialog()">
        </div>
        
        <!-- \u5C0D\u8A71\u6846 -->
        <div class="relative w-full max-w-md bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 
                    transform animate-scale-in">
          <!-- \u6A19\u984C -->
          <div class="p-6 pb-4">
            <h3 class="text-lg font-semibold text-white flex items-center gap-2">
              <span>\u270F\uFE0F</span>
              {{ dialogService.inputDialog()?.title }}
            </h3>
            @if (dialogService.inputDialog()?.message) {
              <p class="text-sm text-slate-400 mt-2">{{ dialogService.inputDialog()?.message }}</p>
            }
          </div>
          
          <!-- \u8F38\u5165\u5340\u57DF -->
          <div class="px-6 pb-4" (click)="focusInput($event)">
            @if (dialogService.inputDialog()?.inputType === 'textarea') {
              <textarea #inputRef
                        [(ngModel)]="inputValue"
                        (keydown.enter)="onEnterKey($event)"
                        [placeholder]="dialogService.inputDialog()?.placeholder || '\u8ACB\u8F38\u5165...'"
                        rows="4"
                        class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white
                               placeholder-slate-500 focus:border-purple-500 focus:outline-none focus:ring-2 
                               focus:ring-purple-500/20 resize-none transition-all">
              </textarea>
            } @else {
              <input #inputRef
                     type="text"
                     [(ngModel)]="inputValue"
                     (keydown.enter)="onEnterKey($event)"
                     [placeholder]="dialogService.inputDialog()?.placeholder || '\u8ACB\u8F38\u5165...'"
                     class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white
                            placeholder-slate-500 focus:border-purple-500 focus:outline-none focus:ring-2 
                            focus:ring-purple-500/20 transition-all cursor-text">
            }
            
            <!-- \u932F\u8AA4\u63D0\u793A -->
            @if (dialogService.inputDialogError()) {
              <p class="mt-2 text-sm text-red-400 flex items-center gap-1">
                <span>\u26A0\uFE0F</span>
                {{ dialogService.inputDialogError() }}
              </p>
            }
          </div>
          
          <!-- \u6309\u9215 -->
          <div class="flex gap-3 p-4 border-t border-slate-700">
            <button (click)="cancelDialog()"
                    class="flex-1 px-4 py-2.5 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">
              {{ dialogService.inputDialog()?.cancelText || '\u53D6\u6D88' }}
            </button>
            <button (click)="confirmWithValue()"
                    class="flex-1 px-4 py-2.5 bg-purple-500 hover:bg-purple-600 text-white rounded-lg 
                           transition-colors font-medium">
              {{ dialogService.inputDialog()?.confirmText || '\u78BA\u5B9A' }}
            </button>
          </div>
        </div>
      </div>
    }
  `, styles: ["/* angular:styles/component:css;28960841c3dbc0fc51dd41b8f0e56e1bb8e2bcbe62c0010aa6c16e5ea2b0d62d;D:/tgkz2026/src/global-input-dialog.component.ts */\n@keyframes fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n.animate-fade-in {\n  animation: fade-in 0.15s ease-out;\n}\n.animate-scale-in {\n  animation: scale-in 0.2s ease-out;\n}\n/*# sourceMappingURL=global-input-dialog.component.css.map */\n"] }]
  }], null, { inputRef: [{
    type: ViewChild,
    args: ["inputRef"]
  }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(GlobalInputDialogComponent, { className: "GlobalInputDialogComponent", filePath: "src/global-input-dialog.component.ts", lineNumber: 101 });
})();

// src/progress-dialog.component.ts
function ProgressDialogComponent_Conditional_0_Conditional_13_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "p", 9);
    \u0275\u0275text(1);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(ctx_r0.progressSignal().itemName);
  }
}
function ProgressDialogComponent_Conditional_0_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "p", 6);
    \u0275\u0275text(1);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(ctx_r0.progressSignal().message);
  }
}
function ProgressDialogComponent_Conditional_0_Conditional_15_Template(rf, ctx) {
  if (rf & 1) {
    const _r2 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "button", 11);
    \u0275\u0275domListener("click", function ProgressDialogComponent_Conditional_0_Conditional_15_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onCancel());
    });
    \u0275\u0275text(1, " \u53D6\u6D88 ");
    \u0275\u0275domElementEnd();
  }
}
function ProgressDialogComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 0)(1, "div", 1)(2, "div", 2)(3, "h3", 3);
    \u0275\u0275text(4);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(5, "div", 4)(6, "div", 5)(7, "span", 6);
    \u0275\u0275text(8);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(9, "span", 6);
    \u0275\u0275text(10);
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(11, "div", 7);
    \u0275\u0275domElement(12, "div", 8);
    \u0275\u0275domElementEnd()();
    \u0275\u0275conditionalCreate(13, ProgressDialogComponent_Conditional_0_Conditional_13_Template, 2, 1, "p", 9);
    \u0275\u0275conditionalCreate(14, ProgressDialogComponent_Conditional_0_Conditional_14_Template, 2, 1, "p", 6);
    \u0275\u0275conditionalCreate(15, ProgressDialogComponent_Conditional_0_Conditional_15_Template, 2, 0, "button", 10);
    \u0275\u0275domElementEnd()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r0.titleSignal());
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate2("", ctx_r0.progressSignal().current, " / ", ctx_r0.progressSignal().total);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("", ctx_r0.percentage(), "%");
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("width", ctx_r0.percentage(), "%");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.progressSignal().itemName ? 13 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.progressSignal().message ? 14 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.cancellableSignal() ? 15 : -1);
  }
}
var ProgressDialogComponent = class _ProgressDialogComponent {
  constructor() {
    this._show = signal(false, ...ngDevMode ? [{ debugName: "_show" }] : []);
    this._title = signal("\u5904\u7406\u4E2D...", ...ngDevMode ? [{ debugName: "_title" }] : []);
    this._progress = signal({ current: 0, total: 0 }, ...ngDevMode ? [{ debugName: "_progress" }] : []);
    this._cancellable = signal(false, ...ngDevMode ? [{ debugName: "_cancellable" }] : []);
    this.showSignal = computed(() => this._show(), ...ngDevMode ? [{ debugName: "showSignal" }] : []);
    this.titleSignal = computed(() => this._title(), ...ngDevMode ? [{ debugName: "titleSignal" }] : []);
    this.progressSignal = computed(() => this._progress(), ...ngDevMode ? [{ debugName: "progressSignal" }] : []);
    this.cancellableSignal = computed(() => this._cancellable(), ...ngDevMode ? [{ debugName: "cancellableSignal" }] : []);
    this.percentage = computed(() => {
      const p = this._progress();
      return p.total > 0 ? Math.round(p.current / p.total * 100) : 0;
    }, ...ngDevMode ? [{ debugName: "percentage" }] : []);
  }
  set show(value) {
    this._show.set(value);
  }
  set title(value) {
    this._title.set(value);
  }
  set progress(value) {
    this._progress.set(value);
  }
  set cancellable(value) {
    this._cancellable.set(value);
  }
  onCancel() {
    if (this.onCancelCallback) {
      this.onCancelCallback();
    }
  }
  static {
    this.\u0275fac = function ProgressDialogComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _ProgressDialogComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _ProgressDialogComponent, selectors: [["app-progress-dialog"]], inputs: { show: "show", title: "title", progress: "progress", cancellable: "cancellable", onCancelCallback: "onCancelCallback" }, decls: 1, vars: 1, consts: [[1, "fixed", "inset-0", "bg-black/50", "backdrop-blur-sm", "z-50", "flex", "items-center", "justify-center"], [1, "bg-slate-800/90", "dark:bg-slate-900/90", "rounded-lg", "p-6", "shadow-xl", "border", "border-slate-700", "min-w-[400px]"], [1, "flex", "flex-col", "gap-4"], [1, "text-lg", "font-semibold", "text-slate-200"], [1, "w-full"], [1, "flex", "justify-between", "items-center", "mb-2"], [1, "text-sm", "text-slate-300"], [1, "w-full", "bg-slate-700", "rounded-full", "h-3", "overflow-hidden"], [1, "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "h-full", "transition-all", "duration-300", "ease-out"], [1, "text-sm", "text-slate-400", "text-center"], [1, "mt-2", "bg-red-500/20", "hover:bg-red-500/30", "text-red-400", "font-bold", "py-2", "px-4", "rounded-lg", "transition", "duration-200", "text-sm"], [1, "mt-2", "bg-red-500/20", "hover:bg-red-500/30", "text-red-400", "font-bold", "py-2", "px-4", "rounded-lg", "transition", "duration-200", "text-sm", 3, "click"]], template: function ProgressDialogComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, ProgressDialogComponent_Conditional_0_Template, 16, 9, "div", 0);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.showSignal() ? 0 : -1);
      }
    }, dependencies: [CommonModule], styles: ["\n\n.transition-all[_ngcontent-%COMP%] {\n  transition-property: all;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 300ms;\n}\n/*# sourceMappingURL=progress-dialog.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(ProgressDialogComponent, [{
    type: Component,
    args: [{ selector: "app-progress-dialog", standalone: true, imports: [CommonModule], template: `
    @if(showSignal()) {
      <div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center">
        <div class="bg-slate-800/90 dark:bg-slate-900/90 rounded-lg p-6 shadow-xl border border-slate-700 min-w-[400px]">
          <div class="flex flex-col gap-4">
            <!-- Title -->
            <h3 class="text-lg font-semibold text-slate-200">{{ titleSignal() }}</h3>
            
            <!-- Progress Bar -->
            <div class="w-full">
              <div class="flex justify-between items-center mb-2">
                <span class="text-sm text-slate-300">{{ progressSignal().current }} / {{ progressSignal().total }}</span>
                <span class="text-sm text-slate-300">{{ percentage() }}%</span>
              </div>
              <div class="w-full bg-slate-700 rounded-full h-3 overflow-hidden">
                <div 
                  class="bg-gradient-to-r from-cyan-500 to-blue-500 h-full transition-all duration-300 ease-out"
                  [style.width.%]="percentage()">
                </div>
              </div>
            </div>
            
            <!-- Current Item -->
            @if(progressSignal().itemName) {
              <p class="text-sm text-slate-400 text-center">{{ progressSignal().itemName }}</p>
            }
            
            <!-- Message -->
            @if(progressSignal().message) {
              <p class="text-sm text-slate-300">{{ progressSignal().message }}</p>
            }
            
            <!-- Cancel Button (if cancellable) -->
            @if(cancellableSignal()) {
              <button 
                (click)="onCancel()"
                class="mt-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 font-bold py-2 px-4 rounded-lg transition duration-200 text-sm">
                \u53D6\u6D88
              </button>
            }
          </div>
        </div>
      </div>
    }
  `, styles: ["/* angular:styles/component:css;b3193f51e1f3d95e231e60caf2fe1666c69761008fe295527c08271c1d14114a;D:/tgkz2026/src/progress-dialog.component.ts */\n.transition-all {\n  transition-property: all;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 300ms;\n}\n/*# sourceMappingURL=progress-dialog.component.css.map */\n"] }]
  }], null, { show: [{
    type: Input
  }], title: [{
    type: Input
  }], progress: [{
    type: Input
  }], cancellable: [{
    type: Input
  }], onCancelCallback: [{
    type: Input
  }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(ProgressDialogComponent, { className: "ProgressDialogComponent", filePath: "src/progress-dialog.component.ts", lineNumber: 72 });
})();

// src/membership-ui.component.ts
function MembershipBadgeComponent_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "span", 3);
    \u0275\u0275text(1);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r0.membershipService.daysRemaining(), "\u5929 ");
  }
}
function MembershipBadgeComponent_Conditional_6_Conditional_6_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "span");
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "date");
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    let tmp_3_0;
    const ctx_r0 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("\u5230\u671F\u6642\u9593\uFF1A", \u0275\u0275pipeBind2(2, 1, (tmp_3_0 = ctx_r0.membershipService.membership()) == null ? null : tmp_3_0.expiresAt, "yyyy-MM-dd"));
  }
}
function MembershipBadgeComponent_Conditional_6_Conditional_6_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "span", 19);
    \u0275\u0275text(1, "\u6703\u54E1\u5DF2\u904E\u671F");
    \u0275\u0275domElementEnd();
  }
}
function MembershipBadgeComponent_Conditional_6_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 8);
    \u0275\u0275conditionalCreate(1, MembershipBadgeComponent_Conditional_6_Conditional_6_Conditional_1_Template, 3, 4, "span")(2, MembershipBadgeComponent_Conditional_6_Conditional_6_Conditional_2_Template, 2, 0, "span", 19);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.membershipService.daysRemaining() > 0 ? 1 : 2);
  }
}
function MembershipBadgeComponent_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    const _r2 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 4)(1, "div", 5)(2, "span", 6);
    \u0275\u0275text(3);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(4, "span", 7);
    \u0275\u0275text(5);
    \u0275\u0275domElementEnd()();
    \u0275\u0275conditionalCreate(6, MembershipBadgeComponent_Conditional_6_Conditional_6_Template, 3, 1, "div", 8);
    \u0275\u0275domElementStart(7, "div", 9)(8, "div")(9, "div", 10)(10, "span");
    \u0275\u0275text(11, "\u4ECA\u65E5\u6D88\u606F");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(12, "span");
    \u0275\u0275text(13);
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(14, "div", 11);
    \u0275\u0275domElement(15, "div", 12);
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(16, "div")(17, "div", 10)(18, "span");
    \u0275\u0275text(19, "\u4ECA\u65E5 AI");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(20, "span");
    \u0275\u0275text(21);
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(22, "div", 11);
    \u0275\u0275domElement(23, "div", 13);
    \u0275\u0275domElementEnd()()();
    \u0275\u0275domElementStart(24, "div", 14)(25, "button", 15);
    \u0275\u0275domListener("click", function MembershipBadgeComponent_Conditional_6_Template_button_click_25_listener() {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.openActivate());
    });
    \u0275\u0275text(26);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(27, "button", 16);
    \u0275\u0275domListener("click", function MembershipBadgeComponent_Conditional_6_Template_button_click_27_listener() {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.showDetails = false);
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275domElementStart(28, "svg", 17);
    \u0275\u0275domElement(29, "path", 18);
    \u0275\u0275domElementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r0.membershipService.levelIcon());
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r0.membershipService.levelName());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.membershipService.level() !== "bronze" ? 6 : -1);
    \u0275\u0275advance(7);
    \u0275\u0275textInterpolate2("", ctx_r0.usage().todayMessages, " / ", ctx_r0.quotaText("messages"));
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("width", ctx_r0.usagePercent().messages, "%");
    \u0275\u0275advance(6);
    \u0275\u0275textInterpolate2("", ctx_r0.usage().todayAiCalls, " / ", ctx_r0.quotaText("ai"));
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("width", ctx_r0.usagePercent().ai, "%");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", ctx_r0.membershipService.level() === "bronze" ? "\u6FC0\u6D3B\u6703\u54E1" : "\u7E8C\u8CBB/\u5347\u7D1A", " ");
  }
}
var _forTrack02 = ($index, $item) => $item.level;
function MembershipDialogComponent_Conditional_0_Conditional_20_For_2_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 22);
    \u0275\u0275text(1, " \u63A8\u85A6 ");
    \u0275\u0275elementEnd();
  }
}
function MembershipDialogComponent_Conditional_0_Conditional_20_For_2_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 23);
    \u0275\u0275text(1, " \u7576\u524D ");
    \u0275\u0275elementEnd();
  }
}
function MembershipDialogComponent_Conditional_0_Conditional_20_For_2_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 28);
    \u0275\u0275text(1, "\u514D\u8CBB");
    \u0275\u0275elementEnd();
  }
}
function MembershipDialogComponent_Conditional_0_Conditional_20_For_2_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 5);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "span", 33);
    \u0275\u0275text(3, "/\u6708");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const plan_r4 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("", plan_r4.monthlyPrice, " USDT");
  }
}
function MembershipDialogComponent_Conditional_0_Conditional_20_For_2_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 29);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const plan_r4 = \u0275\u0275nextContext().$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" \u5E74\u4ED8 ", plan_r4.yearlyPrice, " USDT (\u7701 ", ctx_r1.Math.round((1 - plan_r4.yearlyPrice / (plan_r4.monthlyPrice * 12)) * 100), "%) ");
  }
}
function MembershipDialogComponent_Conditional_0_Conditional_20_For_2_For_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "li", 31);
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(1, "svg", 34);
    \u0275\u0275element(2, "path", 35);
    \u0275\u0275elementEnd();
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const feature_r5 = ctx.$implicit;
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", feature_r5, " ");
  }
}
function MembershipDialogComponent_Conditional_0_Conditional_20_For_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 21);
    \u0275\u0275conditionalCreate(1, MembershipDialogComponent_Conditional_0_Conditional_20_For_2_Conditional_1_Template, 2, 0, "div", 22);
    \u0275\u0275conditionalCreate(2, MembershipDialogComponent_Conditional_0_Conditional_20_For_2_Conditional_2_Template, 2, 0, "div", 23);
    \u0275\u0275elementStart(3, "div", 24)(4, "span", 25);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "h3", 26);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 27);
    \u0275\u0275conditionalCreate(9, MembershipDialogComponent_Conditional_0_Conditional_20_For_2_Conditional_9_Template, 2, 0, "span", 28)(10, MembershipDialogComponent_Conditional_0_Conditional_20_For_2_Conditional_10_Template, 4, 1);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(11, MembershipDialogComponent_Conditional_0_Conditional_20_For_2_Conditional_11_Template, 2, 2, "div", 29);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "ul", 30);
    \u0275\u0275repeaterCreate(13, MembershipDialogComponent_Conditional_0_Conditional_20_For_2_For_14_Template, 4, 1, "li", 31, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "button", 32);
    \u0275\u0275listener("click", function MembershipDialogComponent_Conditional_0_Conditional_20_For_2_Template_button_click_15_listener() {
      const plan_r4 = \u0275\u0275restoreView(_r3).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.selectPlan(plan_r4));
    });
    \u0275\u0275text(16);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const plan_r4 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275classProp("border-cyan-500", plan_r4.level === ctx_r1.membershipService.level())("border-slate-600", plan_r4.level !== ctx_r1.membershipService.level())("bg-slate-700/50", plan_r4.level === ctx_r1.membershipService.level())("bg-slate-800", plan_r4.level !== ctx_r1.membershipService.level());
    \u0275\u0275advance();
    \u0275\u0275conditional(plan_r4.recommended ? 1 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(plan_r4.level === ctx_r1.membershipService.level() ? 2 : -1);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(plan_r4.icon);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(plan_r4.name);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(plan_r4.monthlyPrice === 0 ? 9 : 10);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(plan_r4.yearlyPrice > 0 ? 11 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275repeater(plan_r4.features);
    \u0275\u0275advance(2);
    \u0275\u0275classProp("bg-gradient-to-r", plan_r4.level !== "bronze")("from-cyan-500", plan_r4.level !== "bronze")("to-blue-500", plan_r4.level !== "bronze")("text-white", plan_r4.level !== "bronze")("bg-slate-700", plan_r4.level === "bronze")("text-slate-400", plan_r4.level === "bronze");
    \u0275\u0275property("disabled", plan_r4.level === "bronze");
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", plan_r4.level === "bronze" ? "\u7576\u524D\u65B9\u6848" : plan_r4.level === ctx_r1.membershipService.level() ? "\u7E8C\u8CBB" : "\u9078\u64C7", " ");
  }
}
function MembershipDialogComponent_Conditional_0_Conditional_20_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 14);
    \u0275\u0275repeaterCreate(1, MembershipDialogComponent_Conditional_0_Conditional_20_For_2_Template, 17, 28, "div", 15, _forTrack02);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 16)(4, "h4", 17);
    \u0275\u0275text(5, "\u{1F4B3} \u8CFC\u8CB7\u65B9\u5F0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "p", 18);
    \u0275\u0275text(7, " \u8ACB\u806F\u7E6B\u5BA2\u670D\u8CFC\u8CB7\u5361\u5BC6\uFF0C\u6216\u901A\u904E\u5B98\u65B9\u6E20\u9053\u7372\u53D6\u3002\u8CFC\u8CB7\u5F8C\u5728\u300C\u6FC0\u6D3B\u5361\u5BC6\u300D\u6A19\u7C64\u4E2D\u8F38\u5165\u6FC0\u6D3B\u78BC\u3002 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 19)(9, "a", 20);
    \u0275\u0275text(10, "\u{1F4F1} \u806F\u7E6B\u5BA2\u670D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "a", 20);
    \u0275\u0275text(12, "\u{1F310} \u5B98\u65B9\u5546\u57CE");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r1.plans);
  }
}
function MembershipDialogComponent_Conditional_0_Conditional_21_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 13)(1, "div", 36)(2, "div", 37);
    \u0275\u0275text(3, "\u{1F511}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "h3", 38);
    \u0275\u0275text(5, "\u6FC0\u6D3B\u6703\u54E1\u5361\u5BC6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "p", 39);
    \u0275\u0275text(7, "\u8F38\u5165\u60A8\u8CFC\u8CB7\u7684\u5361\u5BC6\u6FC0\u6D3B\u6703\u54E1");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(8, "div", 40)(9, "div")(10, "label", 41);
    \u0275\u0275text(11, "\u5361\u5BC6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "input", 42);
    \u0275\u0275twoWayListener("ngModelChange", function MembershipDialogComponent_Conditional_0_Conditional_21_Template_input_ngModelChange_12_listener($event) {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.licenseKey, $event) || (ctx_r1.licenseKey = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(13, "div")(14, "label", 41);
    \u0275\u0275text(15, "\u90F5\u7BB1 (\u7528\u65BC\u63A5\u6536\u901A\u77E5)");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "input", 43);
    \u0275\u0275twoWayListener("ngModelChange", function MembershipDialogComponent_Conditional_0_Conditional_21_Template_input_ngModelChange_16_listener($event) {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.email, $event) || (ctx_r1.email = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(17, "button", 44);
    \u0275\u0275listener("click", function MembershipDialogComponent_Conditional_0_Conditional_21_Template_button_click_17_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.activateLicense());
    });
    \u0275\u0275text(18);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(19, "div", 16)(20, "h4", 17);
    \u0275\u0275text(21, "\u{1F4CB} \u5361\u5BC6\u683C\u5F0F\u8AAA\u660E");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(22, "ul", 45)(23, "li");
    \u0275\u0275text(24, "\u2022 TGAI-B2-XXXX-XXXX-XXXX (\u{1F948} \u767D\u9280\u6708\u5361)");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(25, "li");
    \u0275\u0275text(26, "\u2022 TGAI-G2-XXXX-XXXX-XXXX (\u{1F947} \u9EC3\u91D1\u6708\u5361)");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(27, "li");
    \u0275\u0275text(28, "\u2022 TGAI-D2-XXXX-XXXX-XXXX (\u{1F48E} \u947D\u77F3\u6708\u5361)");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(29, "li");
    \u0275\u0275text(30, "\u2022 TGAI-S2-XXXX-XXXX-XXXX (\u{1F31F} \u661F\u8000\u6708\u5361)");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(31, "li");
    \u0275\u0275text(32, "\u2022 TGAI-K2-XXXX-XXXX-XXXX (\u{1F451} \u738B\u8005\u6708\u5361)");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(12);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.licenseKey);
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.email);
    \u0275\u0275advance();
    \u0275\u0275property("disabled", ctx_r1.isActivating());
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.isActivating() ? "\u6FC0\u6D3B\u4E2D..." : "\u6FC0\u6D3B", " ");
  }
}
function MembershipDialogComponent_Conditional_0_Conditional_22_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 13)(1, "div", 36)(2, "div", 37);
    \u0275\u0275text(3, "\u{1F381}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "h3", 38);
    \u0275\u0275text(5, "\u9080\u8ACB\u597D\u53CB\uFF0C\u96D9\u65B9\u7372\u76CA");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "p", 39);
    \u0275\u0275text(7, "\u5206\u4EAB\u60A8\u7684\u9080\u8ACB\u78BC\uFF0C\u9080\u8ACB\u597D\u53CB\u8A3B\u518A");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(8, "div", 46)(9, "div", 47)(10, "div", 48);
    \u0275\u0275text(11, "\u6211\u7684\u9080\u8ACB\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "div", 49);
    \u0275\u0275text(13);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "button", 50);
    \u0275\u0275listener("click", function MembershipDialogComponent_Conditional_0_Conditional_22_Template_button_click_14_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.copyInviteCode());
    });
    \u0275\u0275text(15, " \u{1F4CB} \u8907\u88FD\u9080\u8ACB\u78BC ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(16, "div", 51)(17, "div", 52)(18, "div", 53);
    \u0275\u0275text(19);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(20, "div", 54);
    \u0275\u0275text(21, "\u5DF2\u9080\u8ACB\u4EBA\u6578");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(22, "div", 52)(23, "div", 28);
    \u0275\u0275text(24);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(25, "div", 54);
    \u0275\u0275text(26, "\u7372\u5F97\u734E\u52F5");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(27, "div", 55)(28, "h4", 56);
    \u0275\u0275text(29, "\u{1F3AF} \u734E\u52F5\u898F\u5247");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(30, "ul", 57)(31, "li", 58)(32, "span", 59);
    \u0275\u0275text(33, "\u2713");
    \u0275\u0275elementEnd();
    \u0275\u0275text(34, " \u9080\u8ACB 1 \u4EBA\u8A3B\u518A\uFF1A\u60A8\u7372\u5F97 3 \u5929\u6703\u54E1 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(35, "li", 58)(36, "span", 59);
    \u0275\u0275text(37, "\u2713");
    \u0275\u0275elementEnd();
    \u0275\u0275text(38, " \u88AB\u9080\u8ACB\u4EBA\u7372\u5F97\uFF1A1 \u5929\u6703\u54E1\u9AD4\u9A57 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(39, "li", 58)(40, "span", 59);
    \u0275\u0275text(41, "\u2713");
    \u0275\u0275elementEnd();
    \u0275\u0275text(42, " \u88AB\u9080\u8ACB\u4EBA\u9996\u6B21\u4ED8\u8CBB\uFF1A\u7372\u5F97\u8C50\u539A\u734E\u52F5 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(43, "li", 58)(44, "span", 59);
    \u0275\u0275text(45, "\u2713");
    \u0275\u0275elementEnd();
    \u0275\u0275text(46, " \u88AB\u9080\u8ACB\u4EBA\u91CD\u8907\u4ED8\u8CBB\uFF1A10% \u8FD4\u50AD ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(47, "div", 60)(48, "h4", 17);
    \u0275\u0275text(49, "\u{1F39F}\uFE0F \u4F7F\u7528\u9080\u8ACB\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(50, "div", 61)(51, "input", 62);
    \u0275\u0275twoWayListener("ngModelChange", function MembershipDialogComponent_Conditional_0_Conditional_22_Template_input_ngModelChange_51_listener($event) {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.inviteCodeInput, $event) || (ctx_r1.inviteCodeInput = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(52, "button", 63);
    \u0275\u0275listener("click", function MembershipDialogComponent_Conditional_0_Conditional_22_Template_button_click_52_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.applyInviteCode());
    });
    \u0275\u0275text(53, " \u4F7F\u7528 ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    let tmp_2_0;
    let tmp_3_0;
    let tmp_4_0;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(13);
    \u0275\u0275textInterpolate1(" ", (tmp_2_0 = ctx_r1.membershipService.membership()) == null ? null : tmp_2_0.inviteCode, " ");
    \u0275\u0275advance(6);
    \u0275\u0275textInterpolate(((tmp_3_0 = ctx_r1.membershipService.membership()) == null ? null : tmp_3_0.inviteCount) || 0);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate1("", ((tmp_4_0 = ctx_r1.membershipService.membership()) == null ? null : tmp_4_0.inviteRewards) || 0, "\u5929");
    \u0275\u0275advance(27);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.inviteCodeInput);
  }
}
function MembershipDialogComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 1);
    \u0275\u0275listener("click", function MembershipDialogComponent_Conditional_0_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.close());
    });
    \u0275\u0275elementStart(1, "div", 2);
    \u0275\u0275listener("click", function MembershipDialogComponent_Conditional_0_Template_div_click_1_listener($event) {
      \u0275\u0275restoreView(_r1);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275elementStart(2, "div", 3)(3, "div", 4)(4, "div")(5, "h2", 5);
    \u0275\u0275text(6, "\u{1F680} \u5347\u7D1A\u60A8\u7684 TG-AI\u667A\u63A7\u738B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "p", 6);
    \u0275\u0275text(8, "\u89E3\u9396\u66F4\u591A\u529F\u80FD\uFF0C\u63D0\u5347\u71DF\u92B7\u6548\u7387");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(9, "button", 7);
    \u0275\u0275listener("click", function MembershipDialogComponent_Conditional_0_Template_button_click_9_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.close());
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(10, "svg", 8);
    \u0275\u0275element(11, "path", 9);
    \u0275\u0275elementEnd()()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(12, "div", 10)(13, "button", 11);
    \u0275\u0275listener("click", function MembershipDialogComponent_Conditional_0_Template_button_click_13_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.activeTab.set("plans"));
    });
    \u0275\u0275text(14, " \u6703\u54E1\u65B9\u6848 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "button", 11);
    \u0275\u0275listener("click", function MembershipDialogComponent_Conditional_0_Template_button_click_15_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.activeTab.set("activate"));
    });
    \u0275\u0275text(16, " \u6FC0\u6D3B\u5361\u5BC6 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(17, "button", 11);
    \u0275\u0275listener("click", function MembershipDialogComponent_Conditional_0_Template_button_click_17_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.activeTab.set("invite"));
    });
    \u0275\u0275text(18, " \u9080\u8ACB\u734E\u52F5 ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(19, "div", 12);
    \u0275\u0275conditionalCreate(20, MembershipDialogComponent_Conditional_0_Conditional_20_Template, 13, 0);
    \u0275\u0275conditionalCreate(21, MembershipDialogComponent_Conditional_0_Conditional_21_Template, 33, 4, "div", 13);
    \u0275\u0275conditionalCreate(22, MembershipDialogComponent_Conditional_0_Conditional_22_Template, 54, 4, "div", 13);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(13);
    \u0275\u0275classProp("text-white", ctx_r1.activeTab() === "plans")("text-white/60", ctx_r1.activeTab() !== "plans")("border-white", ctx_r1.activeTab() === "plans")("border-transparent", ctx_r1.activeTab() !== "plans");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("text-white", ctx_r1.activeTab() === "activate")("text-white/60", ctx_r1.activeTab() !== "activate")("border-white", ctx_r1.activeTab() === "activate")("border-transparent", ctx_r1.activeTab() !== "activate");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("text-white", ctx_r1.activeTab() === "invite")("text-white/60", ctx_r1.activeTab() !== "invite")("border-white", ctx_r1.activeTab() === "invite")("border-transparent", ctx_r1.activeTab() !== "invite");
    \u0275\u0275advance(3);
    \u0275\u0275conditional(ctx_r1.activeTab() === "plans" ? 20 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.activeTab() === "activate" ? 21 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.activeTab() === "invite" ? 22 : -1);
  }
}
function UpgradePromptComponent_Conditional_0_For_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "li");
    \u0275\u0275text(1);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const benefit_r3 = ctx.$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("\u2728 ", benefit_r3);
  }
}
function UpgradePromptComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 0)(1, "button", 1);
    \u0275\u0275domListener("click", function UpgradePromptComponent_Conditional_0_Template_button_click_1_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.dismiss());
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275domElementStart(2, "svg", 2);
    \u0275\u0275domElement(3, "path", 3);
    \u0275\u0275domElementEnd()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275domElementStart(4, "div", 4)(5, "div", 5);
    \u0275\u0275text(6, "\u26A1");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(7, "div", 6)(8, "h4", 7);
    \u0275\u0275text(9);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(10, "p", 8);
    \u0275\u0275text(11);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(12, "ul", 9);
    \u0275\u0275repeaterCreate(13, UpgradePromptComponent_Conditional_0_For_14_Template, 2, 1, "li", null, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(15, "button", 10);
    \u0275\u0275domListener("click", function UpgradePromptComponent_Conditional_0_Template_button_click_15_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.upgrade());
    });
    \u0275\u0275text(16);
    \u0275\u0275domElementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(9);
    \u0275\u0275textInterpolate(ctx_r1.message);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" \u5347\u7D1A\u5230 ", ctx_r1.nextLevelName, " \u7372\u5F97\u66F4\u591A\u914D\u984D ");
    \u0275\u0275advance(2);
    \u0275\u0275repeater(ctx_r1.suggestion.benefits.slice(0, 3));
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" \u7ACB\u5373\u5347\u7D1A ", ctx_r1.suggestion.price, " USDT/\u6708 ");
  }
}
var MembershipBadgeComponent = class _MembershipBadgeComponent {
  constructor() {
    this.membershipService = inject(MembershipService);
    this.showDetails = false;
    this.badgeClass = computed(() => this.membershipService.level(), ...ngDevMode ? [{ debugName: "badgeClass" }] : []);
    this.usage = computed(() => this.membershipService.usage(), ...ngDevMode ? [{ debugName: "usage" }] : []);
    this.usagePercent = computed(() => this.membershipService.getUsagePercentage(), ...ngDevMode ? [{ debugName: "usagePercent" }] : []);
  }
  quotaText(type) {
    const quotas = this.membershipService.quotas();
    const value = type === "messages" ? quotas.dailyMessages : quotas.dailyAiCalls;
    return value === -1 ? "\u221E" : value.toString();
  }
  openActivate() {
    this.showDetails = false;
    window.dispatchEvent(new CustomEvent("open-membership-dialog"));
  }
  static {
    this.\u0275fac = function MembershipBadgeComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _MembershipBadgeComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _MembershipBadgeComponent, selectors: [["app-membership-badge"]], decls: 7, vars: 6, consts: [[1, "membership-badge", "flex", "items-center", "gap-2", "px-3", "py-1.5", "rounded-full", "cursor-pointer", "hover:opacity-80", "transition-opacity", 3, "click"], [1, "text-lg"], [1, "text-sm", "font-medium"], [1, "text-xs", "bg-red-500/50", "px-1.5", "py-0.5", "rounded"], [1, "absolute", "top-full", "right-0", "mt-2", "w-72", "bg-slate-800", "rounded-lg", "shadow-xl", "border", "border-slate-600", "p-4", "z-50"], [1, "flex", "items-center", "justify-between", "mb-3"], [1, "text-2xl"], [1, "text-lg", "font-bold", "text-white"], [1, "text-sm", "text-slate-300", "mb-3"], [1, "space-y-2", "mb-4"], [1, "flex", "justify-between", "text-xs", "text-slate-400", "mb-1"], [1, "w-full", "bg-slate-700", "rounded-full", "h-1.5"], [1, "bg-cyan-500", "h-1.5", "rounded-full", "transition-all"], [1, "bg-purple-500", "h-1.5", "rounded-full", "transition-all"], [1, "flex", "gap-2"], [1, "flex-1", "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "text-white", "text-sm", "py-2", "rounded-lg", "hover:opacity-90", 3, "click"], [1, "px-3", "py-2", "bg-slate-700", "text-slate-300", "rounded-lg", "hover:bg-slate-600", 3, "click"], ["fill", "none", "viewBox", "0 0 24 24", "stroke", "currentColor", 1, "w-4", "h-4"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M6 18L18 6M6 6l12 12"], [1, "text-red-400"]], template: function MembershipBadgeComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275domElementStart(0, "div", 0);
        \u0275\u0275domListener("click", function MembershipBadgeComponent_Template_div_click_0_listener() {
          return ctx.showDetails = !ctx.showDetails;
        });
        \u0275\u0275domElementStart(1, "span", 1);
        \u0275\u0275text(2);
        \u0275\u0275domElementEnd();
        \u0275\u0275domElementStart(3, "span", 2);
        \u0275\u0275text(4);
        \u0275\u0275domElementEnd();
        \u0275\u0275conditionalCreate(5, MembershipBadgeComponent_Conditional_5_Template, 2, 1, "span", 3);
        \u0275\u0275domElementEnd();
        \u0275\u0275conditionalCreate(6, MembershipBadgeComponent_Conditional_6_Template, 30, 12, "div", 4);
      }
      if (rf & 2) {
        \u0275\u0275classMap(ctx.badgeClass());
        \u0275\u0275advance(2);
        \u0275\u0275textInterpolate(ctx.membershipService.levelIcon());
        \u0275\u0275advance(2);
        \u0275\u0275textInterpolate(ctx.membershipService.levelName());
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.membershipService.daysRemaining() > 0 && ctx.membershipService.daysRemaining() <= 7 ? 5 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.showDetails ? 6 : -1);
      }
    }, dependencies: [CommonModule, DatePipe], styles: ["\n\n[_nghost-%COMP%] {\n  position: relative;\n  display: inline-block;\n}\n.membership-badge.bronze[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #CD7F32,\n      #8B4513);\n  color: white;\n}\n.membership-badge.silver[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #C0C0C0,\n      #A8A8A8);\n  color: #1f2937;\n}\n.membership-badge.gold[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #FFD700,\n      #FFA500);\n  color: #1f2937;\n}\n.membership-badge.diamond[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #B9F2FF,\n      #87CEEB);\n  color: #1f2937;\n}\n.membership-badge.star[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #9B59B6,\n      #8E44AD);\n  color: white;\n}\n.membership-badge.king[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #FF6B6B,\n      #EE5A5A);\n  color: white;\n}\n/*# sourceMappingURL=membership-ui.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(MembershipBadgeComponent, [{
    type: Component,
    args: [{ selector: "app-membership-badge", standalone: true, imports: [CommonModule], template: `
    <div class="membership-badge flex items-center gap-2 px-3 py-1.5 rounded-full cursor-pointer hover:opacity-80 transition-opacity"
         [class]="badgeClass()"
         (click)="showDetails = !showDetails">
      <span class="text-lg">{{ membershipService.levelIcon() }}</span>
      <span class="text-sm font-medium">{{ membershipService.levelName() }}</span>
      @if(membershipService.daysRemaining() > 0 && membershipService.daysRemaining() <= 7) {
        <span class="text-xs bg-red-500/50 px-1.5 py-0.5 rounded">
          {{ membershipService.daysRemaining() }}\u5929
        </span>
      }
    </div>
    
    @if(showDetails) {
      <div class="absolute top-full right-0 mt-2 w-72 bg-slate-800 rounded-lg shadow-xl border border-slate-600 p-4 z-50">
        <div class="flex items-center justify-between mb-3">
          <span class="text-2xl">{{ membershipService.levelIcon() }}</span>
          <span class="text-lg font-bold text-white">{{ membershipService.levelName() }}</span>
        </div>
        
        @if(membershipService.level() !== 'bronze') {
          <div class="text-sm text-slate-300 mb-3">
            @if(membershipService.daysRemaining() > 0) {
              <span>\u5230\u671F\u6642\u9593\uFF1A{{ membershipService.membership()?.expiresAt | date:'yyyy-MM-dd' }}</span>
            } @else {
              <span class="text-red-400">\u6703\u54E1\u5DF2\u904E\u671F</span>
            }
          </div>
        }
        
        <!-- \u4F7F\u7528\u91CF -->
        <div class="space-y-2 mb-4">
          <div>
            <div class="flex justify-between text-xs text-slate-400 mb-1">
              <span>\u4ECA\u65E5\u6D88\u606F</span>
              <span>{{ usage().todayMessages }} / {{ quotaText('messages') }}</span>
            </div>
            <div class="w-full bg-slate-700 rounded-full h-1.5">
              <div class="bg-cyan-500 h-1.5 rounded-full transition-all" 
                   [style.width.%]="usagePercent().messages"></div>
            </div>
          </div>
          <div>
            <div class="flex justify-between text-xs text-slate-400 mb-1">
              <span>\u4ECA\u65E5 AI</span>
              <span>{{ usage().todayAiCalls }} / {{ quotaText('ai') }}</span>
            </div>
            <div class="w-full bg-slate-700 rounded-full h-1.5">
              <div class="bg-purple-500 h-1.5 rounded-full transition-all" 
                   [style.width.%]="usagePercent().ai"></div>
            </div>
          </div>
        </div>
        
        <!-- \u6309\u9215 -->
        <div class="flex gap-2">
          <button (click)="openActivate()" 
                  class="flex-1 bg-gradient-to-r from-cyan-500 to-blue-500 text-white text-sm py-2 rounded-lg hover:opacity-90">
            {{ membershipService.level() === 'bronze' ? '\u6FC0\u6D3B\u6703\u54E1' : '\u7E8C\u8CBB/\u5347\u7D1A' }}
          </button>
          <button (click)="showDetails = false" 
                  class="px-3 py-2 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
    }
  `, styles: ["/* angular:styles/component:css;4c2109eb1914fdffd91e6450338f115d0689d111f27b2811e0ed5f1e2c6c0023;D:/tgkz2026/src/membership-ui.component.ts */\n:host {\n  position: relative;\n  display: inline-block;\n}\n.membership-badge.bronze {\n  background:\n    linear-gradient(\n      135deg,\n      #CD7F32,\n      #8B4513);\n  color: white;\n}\n.membership-badge.silver {\n  background:\n    linear-gradient(\n      135deg,\n      #C0C0C0,\n      #A8A8A8);\n  color: #1f2937;\n}\n.membership-badge.gold {\n  background:\n    linear-gradient(\n      135deg,\n      #FFD700,\n      #FFA500);\n  color: #1f2937;\n}\n.membership-badge.diamond {\n  background:\n    linear-gradient(\n      135deg,\n      #B9F2FF,\n      #87CEEB);\n  color: #1f2937;\n}\n.membership-badge.star {\n  background:\n    linear-gradient(\n      135deg,\n      #9B59B6,\n      #8E44AD);\n  color: white;\n}\n.membership-badge.king {\n  background:\n    linear-gradient(\n      135deg,\n      #FF6B6B,\n      #EE5A5A);\n  color: white;\n}\n/*# sourceMappingURL=membership-ui.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(MembershipBadgeComponent, { className: "MembershipBadgeComponent", filePath: "src/membership-ui.component.ts", lineNumber: 100 });
})();
var MembershipDialogComponent = class _MembershipDialogComponent {
  constructor() {
    this.membershipService = inject(MembershipService);
    this.toastService = inject(ToastService);
    this.show = signal(false, ...ngDevMode ? [{ debugName: "show" }] : []);
    this.activeTab = signal("plans", ...ngDevMode ? [{ debugName: "activeTab" }] : []);
    this.isActivating = signal(false, ...ngDevMode ? [{ debugName: "isActivating" }] : []);
    this.licenseKey = "";
    this.email = "";
    this.inviteCodeInput = "";
    this.plans = this.membershipService.getPricingPlans();
    this.Math = Math;
    window.addEventListener("open-membership-dialog", () => {
      this.show.set(true);
    });
  }
  close() {
    this.show.set(false);
  }
  selectPlan(plan) {
    if (plan.level === "bronze")
      return;
    this.activeTab.set("activate");
    this.toastService.info(`\u8ACB\u8CFC\u8CB7 ${plan.name} \u5361\u5BC6\u5F8C\u5728\u6B64\u6FC0\u6D3B`);
  }
  async activateLicense() {
    if (!this.licenseKey.trim()) {
      this.toastService.warning("\u8ACB\u8F38\u5165\u5361\u5BC6");
      return;
    }
    this.isActivating.set(true);
    try {
      const result = await this.membershipService.activateMembership(this.licenseKey.trim(), this.email.trim());
      if (result.success) {
        this.toastService.success(result.message, 5e3);
        this.licenseKey = "";
        this.email = "";
        this.close();
      } else {
        this.toastService.error(result.message);
      }
    } catch (e) {
      this.toastService.error("\u6FC0\u6D3B\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66");
    } finally {
      this.isActivating.set(false);
    }
  }
  copyInviteCode() {
    const code = this.membershipService.membership()?.inviteCode;
    if (code) {
      navigator.clipboard.writeText(code);
      this.toastService.success("\u9080\u8ACB\u78BC\u5DF2\u8907\u88FD");
    }
  }
  async applyInviteCode() {
    if (!this.inviteCodeInput.trim()) {
      this.toastService.warning("\u8ACB\u8F38\u5165\u9080\u8ACB\u78BC");
      return;
    }
    const result = await this.membershipService.applyInviteCode(this.inviteCodeInput.trim());
    if (result.success) {
      this.toastService.success(result.message, 5e3);
      this.inviteCodeInput = "";
    } else {
      this.toastService.error(result.message);
    }
  }
  static {
    this.\u0275fac = function MembershipDialogComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _MembershipDialogComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _MembershipDialogComponent, selectors: [["app-membership-dialog"]], decls: 1, vars: 1, consts: [[1, "fixed", "inset-0", "bg-black/60", "backdrop-blur-sm", "z-50", "flex", "items-center", "justify-center", "p-4"], [1, "fixed", "inset-0", "bg-black/60", "backdrop-blur-sm", "z-50", "flex", "items-center", "justify-center", "p-4", 3, "click"], [1, "bg-slate-800", "rounded-2xl", "shadow-2xl", "border", "border-slate-600", "w-full", "max-w-4xl", "max-h-[90vh]", "overflow-hidden", 3, "click"], [1, "bg-gradient-to-r", "from-cyan-500", "to-purple-600", "p-6"], [1, "flex", "justify-between", "items-center"], [1, "text-2xl", "font-bold", "text-white"], [1, "text-white/80", "mt-1"], [1, "text-white/80", "hover:text-white", "p-2", 3, "click"], ["fill", "none", "viewBox", "0 0 24 24", "stroke", "currentColor", 1, "w-6", "h-6"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M6 18L18 6M6 6l12 12"], [1, "flex", "gap-4", "mt-4"], [1, "font-medium", "pb-2", "border-b-2", "transition-colors", 3, "click"], [1, "p-6", "overflow-y-auto", "max-h-[60vh]"], [1, "max-w-md", "mx-auto"], [1, "grid", "grid-cols-1", "md:grid-cols-2", "lg:grid-cols-4", "gap-4"], [1, "relative", "rounded-xl", "border-2", "p-4", "transition-all", 3, "border-cyan-500", "border-slate-600", "bg-slate-700/50", "bg-slate-800"], [1, "mt-6", "p-4", "bg-slate-700/50", "rounded-lg"], [1, "font-medium", "text-white", "mb-2"], [1, "text-sm", "text-slate-300"], [1, "flex", "gap-4", "mt-3"], ["href", "#", 1, "text-sm", "text-cyan-400", "hover:underline"], [1, "relative", "rounded-xl", "border-2", "p-4", "transition-all"], [1, "absolute", "-top-3", "left-1/2", "-translate-x-1/2", "bg-gradient-to-r", "from-cyan-500", "to-purple-600", "text-white", "text-xs", "px-3", "py-1", "rounded-full"], [1, "absolute", "-top-3", "right-2", "bg-green-500", "text-white", "text-xs", "px-2", "py-1", "rounded-full"], [1, "text-center", "mb-4"], [1, "text-3xl"], [1, "text-lg", "font-bold", "text-white", "mt-2"], [1, "mt-2"], [1, "text-2xl", "font-bold", "text-green-400"], [1, "text-sm", "text-slate-400", "mt-1"], [1, "space-y-2", "text-sm"], [1, "flex", "items-start", "gap-2", "text-slate-300"], [1, "w-full", "mt-4", "py-2", "rounded-lg", "font-medium", "transition-colors", 3, "click", "disabled"], [1, "text-slate-400"], ["fill", "none", "viewBox", "0 0 24 24", "stroke", "currentColor", 1, "w-4", "h-4", "text-green-400", "mt-0.5", "flex-shrink-0"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M5 13l4 4L19 7"], [1, "text-center", "mb-6"], [1, "text-4xl", "mb-2"], [1, "text-xl", "font-bold", "text-white"], [1, "text-slate-400", "mt-1"], [1, "space-y-4"], [1, "block", "text-sm", "text-slate-300", "mb-1"], ["type", "text", "placeholder", "TGAI-XX-XXXX-XXXX-XXXX", 1, "w-full", "bg-slate-700", "border", "border-slate-600", "rounded-lg", "px-4", "py-3", "text-white", "placeholder-slate-500", "focus:border-cyan-500", "focus:outline-none", "uppercase", "tracking-wider", "font-mono", 3, "ngModelChange", "ngModel"], ["type", "email", "placeholder", "your@email.com", 1, "w-full", "bg-slate-700", "border", "border-slate-600", "rounded-lg", "px-4", "py-3", "text-white", "placeholder-slate-500", "focus:border-cyan-500", "focus:outline-none", 3, "ngModelChange", "ngModel"], [1, "w-full", "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "text-white", "font-bold", "py-3", "rounded-lg", "hover:opacity-90", "transition-opacity", "disabled:opacity-50", 3, "click", "disabled"], [1, "text-sm", "text-slate-400", "space-y-1"], [1, "bg-gradient-to-r", "from-cyan-500/20", "to-purple-600/20", "rounded-xl", "p-6", "mb-6"], [1, "text-center"], [1, "text-sm", "text-slate-400", "mb-2"], [1, "text-3xl", "font-mono", "font-bold", "text-white", "tracking-widest", "mb-3"], [1, "bg-white/10", "hover:bg-white/20", "text-white", "px-4", "py-2", "rounded-lg", "transition-colors", 3, "click"], [1, "grid", "grid-cols-2", "gap-4", "mb-6"], [1, "bg-slate-700/50", "rounded-lg", "p-4", "text-center"], [1, "text-2xl", "font-bold", "text-cyan-400"], [1, "text-sm", "text-slate-400"], [1, "bg-slate-700/50", "rounded-lg", "p-4"], [1, "font-medium", "text-white", "mb-3"], [1, "space-y-2", "text-sm", "text-slate-300"], [1, "flex", "items-center", "gap-2"], [1, "text-green-400"], [1, "mt-6", "p-4", "border", "border-dashed", "border-slate-600", "rounded-lg"], [1, "flex", "gap-2"], ["type", "text", "placeholder", "\u8F38\u5165\u597D\u53CB\u7684\u9080\u8ACB\u78BC", 1, "flex-1", "bg-slate-700", "border", "border-slate-600", "rounded-lg", "px-3", "py-2", "text-white", "text-sm", "uppercase", 3, "ngModelChange", "ngModel"], [1, "bg-cyan-500", "hover:bg-cyan-600", "text-white", "px-4", "py-2", "rounded-lg", "text-sm", 3, "click"]], template: function MembershipDialogComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, MembershipDialogComponent_Conditional_0_Template, 23, 27, "div", 0);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.show() ? 0 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, DefaultValueAccessor, NgControlStatus, NgModel], encapsulation: 2 });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(MembershipDialogComponent, [{
    type: Component,
    args: [{
      selector: "app-membership-dialog",
      standalone: true,
      imports: [CommonModule, FormsModule],
      template: `
    @if(show()) {
      <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4"
           (click)="close()">
        <div class="bg-slate-800 rounded-2xl shadow-2xl border border-slate-600 w-full max-w-4xl max-h-[90vh] overflow-hidden"
             (click)="$event.stopPropagation()">
          
          <!-- \u6A19\u984C\u6B04 -->
          <div class="bg-gradient-to-r from-cyan-500 to-purple-600 p-6">
            <div class="flex justify-between items-center">
              <div>
                <h2 class="text-2xl font-bold text-white">\u{1F680} \u5347\u7D1A\u60A8\u7684 TG-AI\u667A\u63A7\u738B</h2>
                <p class="text-white/80 mt-1">\u89E3\u9396\u66F4\u591A\u529F\u80FD\uFF0C\u63D0\u5347\u71DF\u92B7\u6548\u7387</p>
              </div>
              <button (click)="close()" class="text-white/80 hover:text-white p-2">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            
            <!-- \u6A19\u7C64\u5207\u63DB -->
            <div class="flex gap-4 mt-4">
              <button (click)="activeTab.set('plans')"
                      [class.text-white]="activeTab() === 'plans'"
                      [class.text-white/60]="activeTab() !== 'plans'"
                      class="font-medium pb-2 border-b-2 transition-colors"
                      [class.border-white]="activeTab() === 'plans'"
                      [class.border-transparent]="activeTab() !== 'plans'">
                \u6703\u54E1\u65B9\u6848
              </button>
              <button (click)="activeTab.set('activate')"
                      [class.text-white]="activeTab() === 'activate'"
                      [class.text-white/60]="activeTab() !== 'activate'"
                      class="font-medium pb-2 border-b-2 transition-colors"
                      [class.border-white]="activeTab() === 'activate'"
                      [class.border-transparent]="activeTab() !== 'activate'">
                \u6FC0\u6D3B\u5361\u5BC6
              </button>
              <button (click)="activeTab.set('invite')"
                      [class.text-white]="activeTab() === 'invite'"
                      [class.text-white/60]="activeTab() !== 'invite'"
                      class="font-medium pb-2 border-b-2 transition-colors"
                      [class.border-white]="activeTab() === 'invite'"
                      [class.border-transparent]="activeTab() !== 'invite'">
                \u9080\u8ACB\u734E\u52F5
              </button>
            </div>
          </div>
          
          <!-- \u5167\u5BB9\u5340 -->
          <div class="p-6 overflow-y-auto max-h-[60vh]">
            
            <!-- \u6703\u54E1\u65B9\u6848 -->
            @if(activeTab() === 'plans') {
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                @for(plan of plans; track plan.level) {
                  <div class="relative rounded-xl border-2 p-4 transition-all"
                       [class.border-cyan-500]="plan.level === membershipService.level()"
                       [class.border-slate-600]="plan.level !== membershipService.level()"
                       [class.bg-slate-700/50]="plan.level === membershipService.level()"
                       [class.bg-slate-800]="plan.level !== membershipService.level()">
                    
                    @if(plan.recommended) {
                      <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-gradient-to-r from-cyan-500 to-purple-600 text-white text-xs px-3 py-1 rounded-full">
                        \u63A8\u85A6
                      </div>
                    }
                    
                    @if(plan.level === membershipService.level()) {
                      <div class="absolute -top-3 right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full">
                        \u7576\u524D
                      </div>
                    }
                    
                    <div class="text-center mb-4">
                      <span class="text-3xl">{{ plan.icon }}</span>
                      <h3 class="text-lg font-bold text-white mt-2">{{ plan.name }}</h3>
                      <div class="mt-2">
                        @if(plan.monthlyPrice === 0) {
                          <span class="text-2xl font-bold text-green-400">\u514D\u8CBB</span>
                        } @else {
                          <span class="text-2xl font-bold text-white">{{ plan.monthlyPrice }} USDT</span>
                          <span class="text-slate-400">/\u6708</span>
                        }
                      </div>
                      @if(plan.yearlyPrice > 0) {
                        <div class="text-sm text-slate-400 mt-1">
                          \u5E74\u4ED8 {{ plan.yearlyPrice }} USDT (\u7701 {{ Math.round((1 - plan.yearlyPrice / (plan.monthlyPrice * 12)) * 100) }}%)
                        </div>
                      }
                    </div>
                    
                    <ul class="space-y-2 text-sm">
                      @for(feature of plan.features; track feature) {
                        <li class="flex items-start gap-2 text-slate-300">
                          <svg class="w-4 h-4 text-green-400 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                          </svg>
                          {{ feature }}
                        </li>
                      }
                    </ul>
                    
                    <button class="w-full mt-4 py-2 rounded-lg font-medium transition-colors"
                            [class.bg-gradient-to-r]="plan.level !== 'bronze'"
                            [class.from-cyan-500]="plan.level !== 'bronze'"
                            [class.to-blue-500]="plan.level !== 'bronze'"
                            [class.text-white]="plan.level !== 'bronze'"
                            [class.bg-slate-700]="plan.level === 'bronze'"
                            [class.text-slate-400]="plan.level === 'bronze'"
                            [disabled]="plan.level === 'bronze'"
                            (click)="selectPlan(plan)">
                      {{ plan.level === 'bronze' ? '\u7576\u524D\u65B9\u6848' : (plan.level === membershipService.level() ? '\u7E8C\u8CBB' : '\u9078\u64C7') }}
                    </button>
                  </div>
                }
              </div>
              
              <!-- \u652F\u4ED8\u8AAA\u660E -->
              <div class="mt-6 p-4 bg-slate-700/50 rounded-lg">
                <h4 class="font-medium text-white mb-2">\u{1F4B3} \u8CFC\u8CB7\u65B9\u5F0F</h4>
                <p class="text-sm text-slate-300">
                  \u8ACB\u806F\u7E6B\u5BA2\u670D\u8CFC\u8CB7\u5361\u5BC6\uFF0C\u6216\u901A\u904E\u5B98\u65B9\u6E20\u9053\u7372\u53D6\u3002\u8CFC\u8CB7\u5F8C\u5728\u300C\u6FC0\u6D3B\u5361\u5BC6\u300D\u6A19\u7C64\u4E2D\u8F38\u5165\u6FC0\u6D3B\u78BC\u3002
                </p>
                <div class="flex gap-4 mt-3">
                  <a href="#" class="text-sm text-cyan-400 hover:underline">\u{1F4F1} \u806F\u7E6B\u5BA2\u670D</a>
                  <a href="#" class="text-sm text-cyan-400 hover:underline">\u{1F310} \u5B98\u65B9\u5546\u57CE</a>
                </div>
              </div>
            }
            
            <!-- \u6FC0\u6D3B\u5361\u5BC6 -->
            @if(activeTab() === 'activate') {
              <div class="max-w-md mx-auto">
                <div class="text-center mb-6">
                  <div class="text-4xl mb-2">\u{1F511}</div>
                  <h3 class="text-xl font-bold text-white">\u6FC0\u6D3B\u6703\u54E1\u5361\u5BC6</h3>
                  <p class="text-slate-400 mt-1">\u8F38\u5165\u60A8\u8CFC\u8CB7\u7684\u5361\u5BC6\u6FC0\u6D3B\u6703\u54E1</p>
                </div>
                
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm text-slate-300 mb-1">\u5361\u5BC6</label>
                    <input type="text" 
                           [(ngModel)]="licenseKey"
                           placeholder="TGAI-XX-XXXX-XXXX-XXXX"
                           class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:border-cyan-500 focus:outline-none uppercase tracking-wider font-mono">
                  </div>
                  
                  <div>
                    <label class="block text-sm text-slate-300 mb-1">\u90F5\u7BB1 (\u7528\u65BC\u63A5\u6536\u901A\u77E5)</label>
                    <input type="email" 
                           [(ngModel)]="email"
                           placeholder="your@email.com"
                           class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:border-cyan-500 focus:outline-none">
                  </div>
                  
                  <button (click)="activateLicense()"
                          [disabled]="isActivating()"
                          class="w-full bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-3 rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50">
                    {{ isActivating() ? '\u6FC0\u6D3B\u4E2D...' : '\u6FC0\u6D3B' }}
                  </button>
                </div>
                
                <div class="mt-6 p-4 bg-slate-700/50 rounded-lg">
                  <h4 class="font-medium text-white mb-2">\u{1F4CB} \u5361\u5BC6\u683C\u5F0F\u8AAA\u660E</h4>
                  <ul class="text-sm text-slate-400 space-y-1">
                    <li>\u2022 TGAI-B2-XXXX-XXXX-XXXX (\u{1F948} \u767D\u9280\u6708\u5361)</li>
                    <li>\u2022 TGAI-G2-XXXX-XXXX-XXXX (\u{1F947} \u9EC3\u91D1\u6708\u5361)</li>
                    <li>\u2022 TGAI-D2-XXXX-XXXX-XXXX (\u{1F48E} \u947D\u77F3\u6708\u5361)</li>
                    <li>\u2022 TGAI-S2-XXXX-XXXX-XXXX (\u{1F31F} \u661F\u8000\u6708\u5361)</li>
                    <li>\u2022 TGAI-K2-XXXX-XXXX-XXXX (\u{1F451} \u738B\u8005\u6708\u5361)</li>
                  </ul>
                </div>
              </div>
            }
            
            <!-- \u9080\u8ACB\u734E\u52F5 -->
            @if(activeTab() === 'invite') {
              <div class="max-w-md mx-auto">
                <div class="text-center mb-6">
                  <div class="text-4xl mb-2">\u{1F381}</div>
                  <h3 class="text-xl font-bold text-white">\u9080\u8ACB\u597D\u53CB\uFF0C\u96D9\u65B9\u7372\u76CA</h3>
                  <p class="text-slate-400 mt-1">\u5206\u4EAB\u60A8\u7684\u9080\u8ACB\u78BC\uFF0C\u9080\u8ACB\u597D\u53CB\u8A3B\u518A</p>
                </div>
                
                <!-- \u6211\u7684\u9080\u8ACB\u78BC -->
                <div class="bg-gradient-to-r from-cyan-500/20 to-purple-600/20 rounded-xl p-6 mb-6">
                  <div class="text-center">
                    <div class="text-sm text-slate-400 mb-2">\u6211\u7684\u9080\u8ACB\u78BC</div>
                    <div class="text-3xl font-mono font-bold text-white tracking-widest mb-3">
                      {{ membershipService.membership()?.inviteCode }}
                    </div>
                    <button (click)="copyInviteCode()" 
                            class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg transition-colors">
                      \u{1F4CB} \u8907\u88FD\u9080\u8ACB\u78BC
                    </button>
                  </div>
                </div>
                
                <!-- \u9080\u8ACB\u7D71\u8A08 -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                  <div class="bg-slate-700/50 rounded-lg p-4 text-center">
                    <div class="text-2xl font-bold text-cyan-400">{{ membershipService.membership()?.inviteCount || 0 }}</div>
                    <div class="text-sm text-slate-400">\u5DF2\u9080\u8ACB\u4EBA\u6578</div>
                  </div>
                  <div class="bg-slate-700/50 rounded-lg p-4 text-center">
                    <div class="text-2xl font-bold text-green-400">{{ membershipService.membership()?.inviteRewards || 0 }}\u5929</div>
                    <div class="text-sm text-slate-400">\u7372\u5F97\u734E\u52F5</div>
                  </div>
                </div>
                
                <!-- \u734E\u52F5\u898F\u5247 -->
                <div class="bg-slate-700/50 rounded-lg p-4">
                  <h4 class="font-medium text-white mb-3">\u{1F3AF} \u734E\u52F5\u898F\u5247</h4>
                  <ul class="space-y-2 text-sm text-slate-300">
                    <li class="flex items-center gap-2">
                      <span class="text-green-400">\u2713</span>
                      \u9080\u8ACB 1 \u4EBA\u8A3B\u518A\uFF1A\u60A8\u7372\u5F97 3 \u5929\u6703\u54E1
                    </li>
                    <li class="flex items-center gap-2">
                      <span class="text-green-400">\u2713</span>
                      \u88AB\u9080\u8ACB\u4EBA\u7372\u5F97\uFF1A1 \u5929\u6703\u54E1\u9AD4\u9A57
                    </li>
                    <li class="flex items-center gap-2">
                      <span class="text-green-400">\u2713</span>
                      \u88AB\u9080\u8ACB\u4EBA\u9996\u6B21\u4ED8\u8CBB\uFF1A\u7372\u5F97\u8C50\u539A\u734E\u52F5
                    </li>
                    <li class="flex items-center gap-2">
                      <span class="text-green-400">\u2713</span>
                      \u88AB\u9080\u8ACB\u4EBA\u91CD\u8907\u4ED8\u8CBB\uFF1A10% \u8FD4\u50AD
                    </li>
                  </ul>
                </div>
                
                <!-- \u4F7F\u7528\u9080\u8ACB\u78BC -->
                <div class="mt-6 p-4 border border-dashed border-slate-600 rounded-lg">
                  <h4 class="font-medium text-white mb-2">\u{1F39F}\uFE0F \u4F7F\u7528\u9080\u8ACB\u78BC</h4>
                  <div class="flex gap-2">
                    <input type="text" 
                           [(ngModel)]="inviteCodeInput"
                           placeholder="\u8F38\u5165\u597D\u53CB\u7684\u9080\u8ACB\u78BC"
                           class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white text-sm uppercase">
                    <button (click)="applyInviteCode()"
                            class="bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm">
                      \u4F7F\u7528
                    </button>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    }
  `
    }]
  }], () => [], null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(MembershipDialogComponent, { className: "MembershipDialogComponent", filePath: "src/membership-ui.component.ts", lineNumber: 385 });
})();
var UpgradePromptComponent = class _UpgradePromptComponent {
  constructor() {
    this.membershipService = inject(MembershipService);
    this.show = false;
    this.message = "";
    this.suggestion = this.membershipService.getUpgradeSuggestion();
  }
  get nextLevelName() {
    if (!this.suggestion?.nextLevel)
      return "";
    const names = {
      bronze: "\u9752\u9285\u6230\u58EB",
      silver: "\u767D\u9280\u7CBE\u82F1",
      gold: "\u9EC3\u91D1\u5927\u5E2B",
      diamond: "\u947D\u77F3\u738B\u724C",
      star: "\u661F\u8000\u50B3\u8AAA",
      king: "\u69AE\u8000\u738B\u8005"
    };
    return names[this.suggestion.nextLevel];
  }
  showPrompt(message) {
    this.message = message;
    this.suggestion = this.membershipService.getUpgradeSuggestion();
    if (this.suggestion) {
      this.show = true;
    }
  }
  dismiss() {
    this.show = false;
  }
  upgrade() {
    this.dismiss();
    window.dispatchEvent(new CustomEvent("open-membership-dialog"));
  }
  static {
    this.\u0275fac = function UpgradePromptComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _UpgradePromptComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _UpgradePromptComponent, selectors: [["app-upgrade-prompt"]], decls: 1, vars: 1, consts: [[1, "fixed", "bottom-4", "right-4", "max-w-sm", "bg-gradient-to-r", "from-slate-800", "to-slate-700", "rounded-xl", "shadow-2xl", "border", "border-slate-600", "p-4", "z-40", "animate-slide-up"], [1, "absolute", "top-2", "right-2", "text-slate-500", "hover:text-white", 3, "click"], ["fill", "none", "viewBox", "0 0 24 24", "stroke", "currentColor", 1, "w-4", "h-4"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M6 18L18 6M6 6l12 12"], [1, "flex", "items-start", "gap-3"], [1, "text-3xl"], [1, "flex-1"], [1, "font-bold", "text-white", "mb-1"], [1, "text-sm", "text-slate-300", "mb-3"], [1, "text-xs", "text-slate-400", "space-y-1", "mb-3"], [1, "bg-gradient-to-r", "from-cyan-500", "to-purple-600", "text-white", "text-sm", "font-medium", "px-4", "py-2", "rounded-lg", "hover:opacity-90", 3, "click"]], template: function UpgradePromptComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, UpgradePromptComponent_Conditional_0_Template, 17, 3, "div", 0);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.show && ctx.suggestion ? 0 : -1);
      }
    }, dependencies: [CommonModule], styles: ["\n\n@keyframes _ngcontent-%COMP%_slide-up {\n  from {\n    transform: translateY(100%);\n    opacity: 0;\n  }\n  to {\n    transform: translateY(0);\n    opacity: 1;\n  }\n}\n.animate-slide-up[_ngcontent-%COMP%] {\n  animation: _ngcontent-%COMP%_slide-up 0.3s ease-out;\n}\n/*# sourceMappingURL=membership-ui.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(UpgradePromptComponent, [{
    type: Component,
    args: [{ selector: "app-upgrade-prompt", standalone: true, imports: [CommonModule], template: `
    @if(show && suggestion) {
      <div class="fixed bottom-4 right-4 max-w-sm bg-gradient-to-r from-slate-800 to-slate-700 rounded-xl shadow-2xl border border-slate-600 p-4 z-40 animate-slide-up">
        <button (click)="dismiss()" class="absolute top-2 right-2 text-slate-500 hover:text-white">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
        
        <div class="flex items-start gap-3">
          <div class="text-3xl">\u26A1</div>
          <div class="flex-1">
            <h4 class="font-bold text-white mb-1">{{ message }}</h4>
            <p class="text-sm text-slate-300 mb-3">
              \u5347\u7D1A\u5230 {{ nextLevelName }} \u7372\u5F97\u66F4\u591A\u914D\u984D
            </p>
            <ul class="text-xs text-slate-400 space-y-1 mb-3">
              @for(benefit of suggestion.benefits.slice(0, 3); track benefit) {
                <li>\u2728 {{ benefit }}</li>
              }
            </ul>
            <button (click)="upgrade()" 
                    class="bg-gradient-to-r from-cyan-500 to-purple-600 text-white text-sm font-medium px-4 py-2 rounded-lg hover:opacity-90">
              \u7ACB\u5373\u5347\u7D1A {{ suggestion.price }} USDT/\u6708
            </button>
          </div>
        </div>
      </div>
    }
  `, styles: ["/* angular:styles/component:css;3795be331242ee5703bf8f23ff931e0b07a7b9f45a24b8698f70953f8ee6d86e;D:/tgkz2026/src/membership-ui.component.ts */\n@keyframes slide-up {\n  from {\n    transform: translateY(100%);\n    opacity: 0;\n  }\n  to {\n    transform: translateY(0);\n    opacity: 1;\n  }\n}\n.animate-slide-up {\n  animation: slide-up 0.3s ease-out;\n}\n/*# sourceMappingURL=membership-ui.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(UpgradePromptComponent, { className: "UpgradePromptComponent", filePath: "src/membership-ui.component.ts", lineNumber: 515 });
})();

// src/payment.component.ts
var _forTrack03 = ($index, $item) => $item.id;
function PaymentComponent_Conditional_0_Conditional_13_For_2_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 21);
    \u0275\u0275text(1, " \u63A8\u85A6 ");
    \u0275\u0275elementEnd();
  }
}
function PaymentComponent_Conditional_0_Conditional_13_For_2_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 22);
    \u0275\u0275text(1, " \u71B1\u9580 ");
    \u0275\u0275elementEnd();
  }
}
function PaymentComponent_Conditional_0_Conditional_13_For_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 20);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_13_For_2_Template_div_click_0_listener() {
      const product_r5 = \u0275\u0275restoreView(_r4).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.selectProduct(product_r5));
    });
    \u0275\u0275conditionalCreate(1, PaymentComponent_Conditional_0_Conditional_13_For_2_Conditional_1_Template, 2, 0, "div", 21);
    \u0275\u0275conditionalCreate(2, PaymentComponent_Conditional_0_Conditional_13_For_2_Conditional_2_Template, 2, 0, "div", 22);
    \u0275\u0275elementStart(3, "div", 23)(4, "div", 24);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "div", 25);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 26)(9, "span", 27);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(11, "div", 28);
    \u0275\u0275text(12, "TRC20 \u7DB2\u7D61");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    let tmp_12_0;
    let tmp_13_0;
    let tmp_14_0;
    const product_r5 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275classProp("border-cyan-500", ((tmp_12_0 = ctx_r1.selectedProduct()) == null ? null : tmp_12_0.id) === product_r5.id)("bg-cyan-500/10", ((tmp_13_0 = ctx_r1.selectedProduct()) == null ? null : tmp_13_0.id) === product_r5.id)("border-slate-600", ((tmp_14_0 = ctx_r1.selectedProduct()) == null ? null : tmp_14_0.id) !== product_r5.id);
    \u0275\u0275advance();
    \u0275\u0275conditional(product_r5.recommended ? 1 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(product_r5.popular ? 2 : -1);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(product_r5.levelName);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(product_r5.durationName);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("", product_r5.price, " USDT");
  }
}
function PaymentComponent_Conditional_0_Conditional_13_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 15);
    \u0275\u0275repeaterCreate(1, PaymentComponent_Conditional_0_Conditional_13_For_2_Template, 13, 11, "div", 16, _forTrack03);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 17)(4, "button", 18);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_13_Template_button_click_4_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.close());
    });
    \u0275\u0275text(5, " \u53D6\u6D88 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "button", 19);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_13_Template_button_click_6_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.proceedToPayment());
    });
    \u0275\u0275text(7, " \u4E0B\u4E00\u6B65 ");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r1.products);
    \u0275\u0275advance(5);
    \u0275\u0275property("disabled", !ctx_r1.selectedProduct());
  }
}
function PaymentComponent_Conditional_0_Conditional_14_Conditional_35_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 41)(1, "div", 43)(2, "span");
    \u0275\u0275text(3, "\u{1F48E}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span", 44);
    \u0275\u0275text(5, "USDT-TRC20 \u652F\u4ED8\uFF08\u63A8\u85A6\uFF09");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div", 45)(7, "div", 46)(8, "div", 47);
    \u0275\u0275text(9, "\u652F\u4ED8\u91D1\u984D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "div", 48);
    \u0275\u0275text(11);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(12, "div", 46)(13, "div", 47);
    \u0275\u0275text(14, "\u7DB2\u7D61");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "div", 49);
    \u0275\u0275text(16, "TRC20");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(17, "div", 50);
    \u0275\u0275text(18, " \u26A0\uFE0F \u50C5\u652F\u6301 TRC20 \u7DB2\u7D61\uFF0C\u5176\u4ED6\u7DB2\u7D61\u8F49\u8CEC\u5C07\u7121\u6CD5\u5230\u8CEC ");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    let tmp_3_0;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(11);
    \u0275\u0275textInterpolate1("", (tmp_3_0 = ctx_r1.selectedProduct()) == null ? null : tmp_3_0.price, " USDT");
  }
}
function PaymentComponent_Conditional_0_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 29)(1, "div", 30);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 31);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "div", 32);
    \u0275\u0275text(6, "TRC20 \u7DB2\u7D61");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(7, "div", 33)(8, "label", 34);
    \u0275\u0275text(9, "\u90F5\u7BB1 (\u7528\u65BC\u63A5\u6536\u8A02\u55AE\u901A\u77E5)");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "input", 35);
    \u0275\u0275twoWayListener("ngModelChange", function PaymentComponent_Conditional_0_Conditional_14_Template_input_ngModelChange_10_listener($event) {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.email, $event) || (ctx_r1.email = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(11, "div", 36)(12, "label", 34);
    \u0275\u0275text(13, "\u9078\u64C7\u652F\u4ED8\u65B9\u5F0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "div", 37)(15, "button", 38);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_14_Template_button_click_15_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.paymentMethod.set("alipay"));
    });
    \u0275\u0275elementStart(16, "span", 39);
    \u0275\u0275text(17, "\u{1F499}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "span", 40);
    \u0275\u0275text(19, "\u652F\u4ED8\u5BF6");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(20, "button", 38);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_14_Template_button_click_20_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.paymentMethod.set("wechat"));
    });
    \u0275\u0275elementStart(21, "span", 39);
    \u0275\u0275text(22, "\u{1F49A}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(23, "span", 40);
    \u0275\u0275text(24, "\u5FAE\u4FE1\u652F\u4ED8");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(25, "button", 38);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_14_Template_button_click_25_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.paymentMethod.set("stripe"));
    });
    \u0275\u0275elementStart(26, "span", 39);
    \u0275\u0275text(27, "\u{1F4B3}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(28, "span", 40);
    \u0275\u0275text(29, "\u570B\u969B\u5361");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(30, "button", 38);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_14_Template_button_click_30_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.paymentMethod.set("usdt"));
    });
    \u0275\u0275elementStart(31, "span", 39);
    \u0275\u0275text(32, "\u{1F48E}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(33, "span", 40);
    \u0275\u0275text(34, "USDT");
    \u0275\u0275elementEnd()()();
    \u0275\u0275conditionalCreate(35, PaymentComponent_Conditional_0_Conditional_14_Conditional_35_Template, 19, 1, "div", 41);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(36, "div", 42)(37, "button", 18);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_14_Template_button_click_37_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.step.set("select"));
    });
    \u0275\u0275text(38, " \u8FD4\u56DE ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(39, "button", 19);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_14_Template_button_click_39_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.createOrder());
    });
    \u0275\u0275text(40);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    let tmp_2_0;
    let tmp_3_0;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2("", (tmp_2_0 = ctx_r1.selectedProduct()) == null ? null : tmp_2_0.levelName, " - ", (tmp_2_0 = ctx_r1.selectedProduct()) == null ? null : tmp_2_0.durationName);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("", (tmp_3_0 = ctx_r1.selectedProduct()) == null ? null : tmp_3_0.price, " USDT");
    \u0275\u0275advance(6);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.email);
    \u0275\u0275advance(5);
    \u0275\u0275classProp("border-cyan-500", ctx_r1.paymentMethod() === "alipay")("bg-cyan-500/10", ctx_r1.paymentMethod() === "alipay")("border-slate-600", ctx_r1.paymentMethod() !== "alipay");
    \u0275\u0275advance(5);
    \u0275\u0275classProp("border-cyan-500", ctx_r1.paymentMethod() === "wechat")("bg-cyan-500/10", ctx_r1.paymentMethod() === "wechat")("border-slate-600", ctx_r1.paymentMethod() !== "wechat");
    \u0275\u0275advance(5);
    \u0275\u0275classProp("border-cyan-500", ctx_r1.paymentMethod() === "stripe")("bg-cyan-500/10", ctx_r1.paymentMethod() === "stripe")("border-slate-600", ctx_r1.paymentMethod() !== "stripe");
    \u0275\u0275advance(5);
    \u0275\u0275classProp("border-cyan-500", ctx_r1.paymentMethod() === "usdt")("bg-cyan-500/10", ctx_r1.paymentMethod() === "usdt")("border-slate-600", ctx_r1.paymentMethod() !== "usdt");
    \u0275\u0275advance(5);
    \u0275\u0275conditional(ctx_r1.paymentMethod() === "usdt" ? 35 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275property("disabled", ctx_r1.isProcessing());
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.isProcessing() ? "\u8655\u7406\u4E2D..." : "\u7ACB\u5373\u652F\u4ED8", " ");
  }
}
function PaymentComponent_Conditional_0_Conditional_15_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    const _r8 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 57)(1, "div", 60)(2, "div", 27);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 61);
    \u0275\u0275text(5, "TRC20 \u7DB2\u7D61\uFF08TRON\uFF09");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div", 33)(7, "div", 62);
    \u0275\u0275text(8, "\u6536\u6B3E\u5730\u5740\uFF08TRC20\uFF09");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "div", 63)(10, "div", 64)(11, "code", 65);
    \u0275\u0275text(12);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "button", 66);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_15_Conditional_12_Template_button_click_13_listener() {
      \u0275\u0275restoreView(_r8);
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.copyUsdtAddress());
    });
    \u0275\u0275text(14, " \u{1F4CB} \u8907\u88FD ");
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(15, "div", 67)(16, "div", 68)(17, "div", 39);
    \u0275\u0275text(18, "\u{1F4DD}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(19, "div")(20, "div", 69);
    \u0275\u0275text(21, "\u8F49\u8CEC\u6B65\u9A5F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(22, "ol", 70)(23, "li");
    \u0275\u0275text(24, "1. \u6253\u958B\u60A8\u7684\u52A0\u5BC6\u8CA8\u5E63\u9322\u5305\uFF08\u5982 Trust Wallet\u3001TokenPocket\uFF09");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(25, "li");
    \u0275\u0275text(26, "2. \u9078\u64C7 USDT \u8CC7\u7522\uFF0C\u9EDE\u64CA\u300C\u767C\u9001\u300D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(27, "li");
    \u0275\u0275text(28, "3. \u7C98\u8CBC\u4E0A\u65B9\u5730\u5740\uFF0C\u9078\u64C7 ");
    \u0275\u0275elementStart(29, "span", 71);
    \u0275\u0275text(30, "TRC20");
    \u0275\u0275elementEnd();
    \u0275\u0275text(31, " \u7DB2\u7D61");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(32, "li");
    \u0275\u0275text(33, "4. \u8F38\u5165\u91D1\u984D ");
    \u0275\u0275elementStart(34, "span", 71);
    \u0275\u0275text(35);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(36, "li");
    \u0275\u0275text(37, "5. \u78BA\u8A8D\u8F49\u8CEC\uFF0C\u7B49\u5F85\u5340\u584A\u78BA\u8A8D");
    \u0275\u0275elementEnd()()()()();
    \u0275\u0275elementStart(38, "div", 72)(39, "span");
    \u0275\u0275text(40, "\u26A0\uFE0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(41, "div")(42, "strong");
    \u0275\u0275text(43, "\u91CD\u8981\u63D0\u9192\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(44, "ul", 73)(45, "li");
    \u0275\u0275text(46, "\u2022 \u50C5\u652F\u6301 ");
    \u0275\u0275elementStart(47, "strong");
    \u0275\u0275text(48, "TRC20");
    \u0275\u0275elementEnd();
    \u0275\u0275text(49, " \u7DB2\u7D61\uFF0C\u5176\u4ED6\u7DB2\u7D61\u8F49\u8CEC\u5C07\u7121\u6CD5\u5230\u8CEC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(50, "li");
    \u0275\u0275text(51, "\u2022 \u8ACB\u78BA\u4FDD\u8F49\u8CEC\u91D1\u984D\u6B63\u78BA\uFF1A");
    \u0275\u0275elementStart(52, "strong");
    \u0275\u0275text(53);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(54, "li");
    \u0275\u0275text(55, "\u2022 \u8F49\u8CEC\u5F8C\u901A\u5E38 1-5 \u5206\u9418\u5167\u5230\u8CEC");
    \u0275\u0275elementEnd()()()()();
  }
  if (rf & 2) {
    let tmp_3_0;
    let tmp_5_0;
    let tmp_6_0;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("", (tmp_3_0 = ctx_r1.selectedProduct()) == null ? null : tmp_3_0.price, " USDT");
    \u0275\u0275advance(9);
    \u0275\u0275textInterpolate(ctx_r1.USDT_CONFIG.walletAddress);
    \u0275\u0275advance(23);
    \u0275\u0275textInterpolate1("", (tmp_5_0 = ctx_r1.selectedProduct()) == null ? null : tmp_5_0.price, " USDT");
    \u0275\u0275advance(18);
    \u0275\u0275textInterpolate1("", (tmp_6_0 = ctx_r1.selectedProduct()) == null ? null : tmp_6_0.price, " USDT");
  }
}
function PaymentComponent_Conditional_0_Conditional_15_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 11)(1, "div", 51);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "h3", 52);
    \u0275\u0275text(4, "\u7B49\u5F85\u652F\u4ED8");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 53);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div", 54)(8, "div", 55);
    \u0275\u0275text(9, "\u8A02\u55AE\u865F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "div", 56);
    \u0275\u0275text(11);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(12, PaymentComponent_Conditional_0_Conditional_15_Conditional_12_Template, 56, 4, "div", 57);
    \u0275\u0275elementStart(13, "div", 58);
    \u0275\u0275text(14);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "div", 42)(16, "button", 18);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_15_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.cancelPayment());
    });
    \u0275\u0275text(17, " \u53D6\u6D88\u652F\u4ED8 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "button", 59);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_15_Template_button_click_18_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.checkPaymentStatus());
    });
    \u0275\u0275text(19);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    let tmp_4_0;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r1.paymentMethod() === "usdt" ? "\u{1F48E}" : "\u23F3");
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate1(" ", ctx_r1.paymentMethod() === "usdt" ? "\u8ACB\u5411\u4EE5\u4E0B\u5730\u5740\u8F49\u8CEC USDT" : "\u8ACB\u5728\u65B0\u7A97\u53E3\u5B8C\u6210\u652F\u4ED8", " ");
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate((tmp_4_0 = ctx_r1.currentOrder()) == null ? null : tmp_4_0.order_id);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.paymentMethod() === "usdt" ? 12 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", ctx_r1.paymentMethod() === "usdt" ? "\u8F49\u8CEC\u6210\u529F\u5F8C\u9EDE\u64CA\u300C\u6211\u5DF2\u652F\u4ED8\u300D" : "\u652F\u4ED8\u5B8C\u6210\u5F8C\u5C07\u81EA\u52D5\u6FC0\u6D3B\u6703\u54E1", " ");
    \u0275\u0275advance(4);
    \u0275\u0275property("disabled", ctx_r1.isChecking());
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.isChecking() ? "\u6AA2\u67E5\u4E2D..." : "\u6211\u5DF2\u652F\u4ED8", " ");
  }
}
function PaymentComponent_Conditional_0_Conditional_16_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    const _r10 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 74)(1, "div", 55);
    \u0275\u0275text(2, "\u60A8\u7684\u5361\u5BC6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 56);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "button", 76);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_16_Conditional_7_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r10);
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.copyLicenseKey());
    });
    \u0275\u0275text(6, " \u{1F4CB} \u8907\u88FD\u5361\u5BC6 ");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r1.activatedLicenseKey());
  }
}
function PaymentComponent_Conditional_0_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    const _r9 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 11)(1, "div", 51);
    \u0275\u0275text(2, "\u{1F389}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "h3", 52);
    \u0275\u0275text(4, "\u652F\u4ED8\u6210\u529F\uFF01");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 53);
    \u0275\u0275text(6, "\u60A8\u7684\u6703\u54E1\u5DF2\u6FC0\u6D3B");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(7, PaymentComponent_Conditional_0_Conditional_16_Conditional_7_Template, 7, 1, "div", 74);
    \u0275\u0275elementStart(8, "button", 75);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Conditional_16_Template_button_click_8_listener() {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.close());
    });
    \u0275\u0275text(9, " \u958B\u59CB\u4F7F\u7528 ");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(7);
    \u0275\u0275conditional(ctx_r1.activatedLicenseKey() ? 7 : -1);
  }
}
function PaymentComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 1);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.close());
    });
    \u0275\u0275elementStart(1, "div", 2);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Template_div_click_1_listener($event) {
      \u0275\u0275restoreView(_r1);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275elementStart(2, "div", 3)(3, "div", 4)(4, "div")(5, "h2", 5);
    \u0275\u0275text(6, " \u{1F4B3} \u5347\u7D1A\u6703\u54E1 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "p", 6);
    \u0275\u0275text(8, "\u9078\u64C7\u9069\u5408\u60A8\u7684\u65B9\u6848");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(9, "button", 7);
    \u0275\u0275listener("click", function PaymentComponent_Conditional_0_Template_button_click_9_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.close());
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(10, "svg", 8);
    \u0275\u0275element(11, "path", 9);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(12, "div", 10);
    \u0275\u0275conditionalCreate(13, PaymentComponent_Conditional_0_Conditional_13_Template, 8, 1);
    \u0275\u0275conditionalCreate(14, PaymentComponent_Conditional_0_Conditional_14_Template, 41, 31);
    \u0275\u0275conditionalCreate(15, PaymentComponent_Conditional_0_Conditional_15_Template, 20, 7, "div", 11);
    \u0275\u0275conditionalCreate(16, PaymentComponent_Conditional_0_Conditional_16_Template, 10, 1, "div", 11);
    \u0275\u0275elementStart(17, "div", 12)(18, "p", 13);
    \u0275\u0275text(19, " \u9047\u5230\u554F\u984C\uFF1F ");
    \u0275\u0275elementStart(20, "a", 14);
    \u0275\u0275text(21, "\u806F\u7E6B\u5BA2\u670D");
    \u0275\u0275elementEnd();
    \u0275\u0275text(22, " \u6216 ");
    \u0275\u0275elementStart(23, "a", 14);
    \u0275\u0275text(24, "\u67E5\u770B\u5E6B\u52A9");
    \u0275\u0275elementEnd()()()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(13);
    \u0275\u0275conditional(ctx_r1.step() === "select" ? 13 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.step() === "payment" ? 14 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.step() === "pending" ? 15 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.step() === "success" ? 16 : -1);
  }
}
var PaymentComponent = class _PaymentComponent {
  constructor() {
    this.licenseClient = inject(LicenseClientService);
    this.membershipService = inject(MembershipService);
    this.toastService = inject(ToastService);
    this.show = signal(false, ...ngDevMode ? [{ debugName: "show" }] : []);
    this.step = signal("select", ...ngDevMode ? [{ debugName: "step" }] : []);
    this.products = this.licenseClient.products;
    this.selectedProduct = signal(null, ...ngDevMode ? [{ debugName: "selectedProduct" }] : []);
    this.paymentMethod = signal("usdt", ...ngDevMode ? [{ debugName: "paymentMethod" }] : []);
    this.USDT_CONFIG = {
      network: "TRC20",
      // TODO: 替換為您的實際 USDT 收款地址
      walletAddress: "TYourTRC20WalletAddressHere",
      minAmount: 1
      // 最低支付金額
    };
    this.email = "";
    this.isProcessing = signal(false, ...ngDevMode ? [{ debugName: "isProcessing" }] : []);
    this.isChecking = signal(false, ...ngDevMode ? [{ debugName: "isChecking" }] : []);
    this.currentOrder = signal(null, ...ngDevMode ? [{ debugName: "currentOrder" }] : []);
    this.activatedLicenseKey = signal(null, ...ngDevMode ? [{ debugName: "activatedLicenseKey" }] : []);
    this.checkInterval = null;
    window.addEventListener("open-payment-dialog", () => {
      this.open();
    });
  }
  ngOnDestroy() {
    this.stopCheckInterval();
  }
  open() {
    this.show.set(true);
    this.step.set("select");
    this.selectedProduct.set(null);
    this.currentOrder.set(null);
    this.activatedLicenseKey.set(null);
  }
  close() {
    this.show.set(false);
    this.stopCheckInterval();
  }
  selectProduct(product) {
    this.selectedProduct.set(product);
  }
  proceedToPayment() {
    if (this.selectedProduct()) {
      this.step.set("payment");
    }
  }
  // 價格已經是 USDT，不需要轉換
  async createOrder() {
    const product = this.selectedProduct();
    if (!product)
      return;
    this.isProcessing.set(true);
    try {
      const result = await this.licenseClient.createPayment(product.id, this.paymentMethod());
      if (result.success && result.order) {
        this.currentOrder.set(result.order);
        this.step.set("pending");
        window.open(result.order.payment_url, "_blank");
        this.startCheckInterval();
      } else {
        this.toastService.error(result.message);
      }
    } catch (error) {
      this.toastService.error("\u5275\u5EFA\u8A02\u55AE\u5931\u6557");
    } finally {
      this.isProcessing.set(false);
    }
  }
  async checkPaymentStatus() {
    const order = this.currentOrder();
    if (!order)
      return;
    this.isChecking.set(true);
    try {
      const result = await this.licenseClient.checkPaymentStatus(order.orderId);
      if (result.paid) {
        this.stopCheckInterval();
        this.activatedLicenseKey.set(result.licenseKey || null);
        this.step.set("success");
        this.toastService.success("\u{1F389} \u652F\u4ED8\u6210\u529F\uFF0C\u6703\u54E1\u5DF2\u6FC0\u6D3B\uFF01");
        if (result.licenseKey) {
          await this.membershipService.activateMembership(result.licenseKey, this.email);
        }
      } else {
        this.toastService.info("\u652F\u4ED8\u5C1A\u672A\u5B8C\u6210\uFF0C\u8ACB\u7E7C\u7E8C\u652F\u4ED8");
      }
    } catch (error) {
      this.toastService.error("\u6AA2\u67E5\u652F\u4ED8\u72C0\u614B\u5931\u6557");
    } finally {
      this.isChecking.set(false);
    }
  }
  cancelPayment() {
    this.stopCheckInterval();
    this.step.set("select");
    this.currentOrder.set(null);
  }
  copyLicenseKey() {
    const key = this.activatedLicenseKey();
    if (key) {
      navigator.clipboard.writeText(key);
      this.toastService.success("\u5361\u5BC6\u5DF2\u8907\u88FD");
    }
  }
  copyUsdtAddress() {
    navigator.clipboard.writeText(this.USDT_CONFIG.walletAddress);
    this.toastService.success("USDT TRC20 \u5730\u5740\u5DF2\u8907\u88FD");
  }
  startCheckInterval() {
    this.checkInterval = setInterval(() => {
      this.checkPaymentStatus();
    }, 5e3);
  }
  stopCheckInterval() {
    if (this.checkInterval) {
      clearInterval(this.checkInterval);
      this.checkInterval = null;
    }
  }
  static {
    this.\u0275fac = function PaymentComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _PaymentComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _PaymentComponent, selectors: [["app-payment"]], decls: 1, vars: 1, consts: [[1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "z-50", "flex", "items-center", "justify-center", "p-4"], [1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "z-50", "flex", "items-center", "justify-center", "p-4", 3, "click"], [1, "bg-gradient-to-br", "from-slate-900", "to-slate-800", "rounded-2xl", "shadow-2xl", "border", "border-slate-700", "w-full", "max-w-2xl", "max-h-[90vh]", "overflow-hidden", 3, "click"], [1, "bg-gradient-to-r", "from-cyan-500", "via-purple-500", "to-pink-500", "p-6"], [1, "flex", "justify-between", "items-center"], [1, "text-2xl", "font-bold", "text-white", "flex", "items-center", "gap-2"], [1, "text-white/80", "mt-1"], [1, "text-white/80", "hover:text-white", "p-2", "rounded-full", "hover:bg-white/10", 3, "click"], ["fill", "none", "viewBox", "0 0 24 24", "stroke", "currentColor", 1, "w-6", "h-6"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M6 18L18 6M6 6l12 12"], [1, "p-6", "overflow-y-auto", "max-h-[70vh]"], [1, "text-center", "py-8"], [1, "mt-6", "pt-4", "border-t", "border-slate-700", "text-center"], [1, "text-sm", "text-slate-500"], ["href", "#", 1, "text-cyan-400", "hover:underline"], [1, "grid", "grid-cols-2", "gap-4"], [1, "relative", "rounded-xl", "border-2", "p-4", "cursor-pointer", "transition-all", "hover:scale-[1.02]", 3, "border-cyan-500", "bg-cyan-500/10", "border-slate-600"], [1, "mt-6", "flex", "gap-4"], [1, "flex-1", "py-3", "rounded-xl", "bg-slate-700", "text-slate-300", "hover:bg-slate-600", "transition-colors", 3, "click"], [1, "flex-1", "py-3", "rounded-xl", "bg-gradient-to-r", "from-cyan-500", "to-purple-500", "text-white", "font-bold", "hover:opacity-90", "transition-opacity", "disabled:opacity-50", 3, "click", "disabled"], [1, "relative", "rounded-xl", "border-2", "p-4", "cursor-pointer", "transition-all", "hover:scale-[1.02]", 3, "click"], [1, "absolute", "-top-3", "left-1/2", "-translate-x-1/2", "bg-gradient-to-r", "from-pink-500", "to-purple-500", "text-white", "text-xs", "px-3", "py-1", "rounded-full", "font-medium"], [1, "absolute", "-top-3", "right-2", "bg-orange-500", "text-white", "text-xs", "px-2", "py-1", "rounded-full"], [1, "text-center"], [1, "text-lg", "font-bold", "text-white"], [1, "text-xs", "text-slate-400"], [1, "mt-2"], [1, "text-3xl", "font-bold", "text-emerald-400"], [1, "text-xs", "text-slate-500", "mt-1"], [1, "text-center", "mb-6"], [1, "text-lg", "text-slate-300"], [1, "text-4xl", "font-bold", "text-emerald-400", "mt-2"], [1, "text-sm", "text-slate-500", "mt-1"], [1, "mb-4"], [1, "block", "text-sm", "text-slate-400", "mb-2"], ["type", "email", "placeholder", "your@email.com", 1, "w-full", "bg-slate-700", "border", "border-slate-600", "rounded-lg", "px-4", "py-3", "text-white", "placeholder-slate-500", "focus:border-cyan-500", "focus:outline-none", 3, "ngModelChange", "ngModel"], [1, "space-y-3", "mb-6"], [1, "grid", "grid-cols-2", "gap-3"], [1, "flex", "items-center", "justify-center", "gap-2", "p-4", "rounded-xl", "border-2", "transition-all", 3, "click"], [1, "text-2xl"], [1, "text-white", "font-medium"], [1, "mt-3", "p-4", "bg-emerald-500/10", "border", "border-emerald-500/30", "rounded-lg"], [1, "flex", "gap-4"], [1, "flex", "items-center", "gap-2", "text-emerald-400", "text-sm", "mb-3"], [1, "font-medium"], [1, "flex", "items-center", "gap-3", "mb-3"], [1, "flex-1", "p-2", "bg-slate-800", "rounded-lg"], [1, "text-xs", "text-slate-500", "mb-1"], [1, "text-2xl", "font-bold", "text-emerald-400"], [1, "text-lg", "font-bold", "text-cyan-400"], [1, "text-xs", "text-orange-400", "bg-orange-500/10", "rounded-lg", "p-2"], [1, "text-6xl", "mb-4"], [1, "text-xl", "font-bold", "text-white", "mb-2"], [1, "text-slate-400", "mb-4"], [1, "bg-slate-700/50", "rounded-xl", "p-4", "mb-4"], [1, "text-sm", "text-slate-400"], [1, "text-lg", "font-mono", "text-cyan-400"], [1, "bg-emerald-500/10", "border", "border-emerald-500/30", "rounded-xl", "p-5", "mb-4", "text-left"], [1, "text-sm", "text-slate-500", "mb-6"], [1, "flex-1", "py-3", "rounded-xl", "bg-cyan-500", "text-white", "font-bold", "hover:bg-cyan-600", "transition-colors", "disabled:opacity-50", 3, "click", "disabled"], [1, "text-center", "mb-4"], [1, "text-sm", "text-slate-400", "mt-1"], [1, "text-xs", "text-slate-400", "mb-2"], [1, "bg-slate-800", "rounded-lg", "p-3"], [1, "flex", "items-center", "justify-between", "gap-2"], [1, "text-sm", "text-emerald-400", "break-all", "font-mono"], [1, "flex-shrink-0", "bg-emerald-500/20", "hover:bg-emerald-500/30", "text-emerald-400", "px-3", "py-1.5", "rounded-lg", "text-sm", "transition-colors", 3, "click"], [1, "bg-slate-800/50", "rounded-lg", "p-3", "mb-4"], [1, "flex", "items-start", "gap-3"], [1, "text-sm", "text-white", "font-medium", "mb-1"], [1, "text-xs", "text-slate-400", "space-y-1"], [1, "text-emerald-400", "font-medium"], [1, "text-xs", "text-orange-400", "bg-orange-500/10", "rounded-lg", "p-3", "flex", "items-start", "gap-2"], [1, "mt-1", "space-y-0.5"], [1, "bg-gradient-to-r", "from-cyan-500/20", "to-purple-500/20", "rounded-xl", "p-4", "mb-6"], [1, "w-full", "py-3", "rounded-xl", "bg-gradient-to-r", "from-cyan-500", "to-purple-500", "text-white", "font-bold", "hover:opacity-90", "transition-opacity", 3, "click"], [1, "mt-2", "text-sm", "text-cyan-400", "hover:underline", 3, "click"]], template: function PaymentComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, PaymentComponent_Conditional_0_Template, 25, 4, "div", 0);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.show() ? 0 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, DefaultValueAccessor, NgControlStatus, NgModel], encapsulation: 2 });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(PaymentComponent, [{
    type: Component,
    args: [{
      selector: "app-payment",
      standalone: true,
      imports: [CommonModule, FormsModule],
      template: `
    @if(show()) {
      <div class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4"
           (click)="close()">
        <div class="bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl shadow-2xl border border-slate-700 w-full max-w-2xl max-h-[90vh] overflow-hidden"
             (click)="$event.stopPropagation()">
          
          <!-- \u6A19\u984C -->
          <div class="bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 p-6">
            <div class="flex justify-between items-center">
              <div>
                <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                  \u{1F4B3} \u5347\u7D1A\u6703\u54E1
                </h2>
                <p class="text-white/80 mt-1">\u9078\u64C7\u9069\u5408\u60A8\u7684\u65B9\u6848</p>
              </div>
              <button (click)="close()" class="text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>
          
          <div class="p-6 overflow-y-auto max-h-[70vh]">
            
            <!-- \u6B65\u9A5F 1: \u9078\u64C7\u7522\u54C1 -->
            @if(step() === 'select') {
              <div class="grid grid-cols-2 gap-4">
                @for(product of products; track product.id) {
                  <div class="relative rounded-xl border-2 p-4 cursor-pointer transition-all hover:scale-[1.02]"
                       [class.border-cyan-500]="selectedProduct()?.id === product.id"
                       [class.bg-cyan-500/10]="selectedProduct()?.id === product.id"
                       [class.border-slate-600]="selectedProduct()?.id !== product.id"
                       (click)="selectProduct(product)">
                    
                    @if(product.recommended) {
                      <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-gradient-to-r from-pink-500 to-purple-500 text-white text-xs px-3 py-1 rounded-full font-medium">
                        \u63A8\u85A6
                      </div>
                    }
                    
                    @if(product.popular) {
                      <div class="absolute -top-3 right-2 bg-orange-500 text-white text-xs px-2 py-1 rounded-full">
                        \u71B1\u9580
                      </div>
                    }
                    
                    <div class="text-center">
                      <div class="text-lg font-bold text-white">{{ product.levelName }}</div>
                      <div class="text-xs text-slate-400">{{ product.durationName }}</div>
                      <div class="mt-2">
                        <span class="text-3xl font-bold text-emerald-400">{{ product.price }} USDT</span>
                      </div>
                      <div class="text-xs text-slate-500 mt-1">TRC20 \u7DB2\u7D61</div>
                    </div>
                  </div>
                }
              </div>
              
              <div class="mt-6 flex gap-4">
                <button (click)="close()"
                        class="flex-1 py-3 rounded-xl bg-slate-700 text-slate-300 hover:bg-slate-600 transition-colors">
                  \u53D6\u6D88
                </button>
                <button (click)="proceedToPayment()"
                        [disabled]="!selectedProduct()"
                        class="flex-1 py-3 rounded-xl bg-gradient-to-r from-cyan-500 to-purple-500 text-white font-bold hover:opacity-90 transition-opacity disabled:opacity-50">
                  \u4E0B\u4E00\u6B65
                </button>
              </div>
            }
            
            <!-- \u6B65\u9A5F 2: \u9078\u64C7\u652F\u4ED8\u65B9\u5F0F -->
            @if(step() === 'payment') {
              <div class="text-center mb-6">
                <div class="text-lg text-slate-300">{{ selectedProduct()?.levelName }} - {{ selectedProduct()?.durationName }}</div>
                <div class="text-4xl font-bold text-emerald-400 mt-2">{{ selectedProduct()?.price }} USDT</div>
                <div class="text-sm text-slate-500 mt-1">TRC20 \u7DB2\u7D61</div>
              </div>
              
              <div class="mb-4">
                <label class="block text-sm text-slate-400 mb-2">\u90F5\u7BB1 (\u7528\u65BC\u63A5\u6536\u8A02\u55AE\u901A\u77E5)</label>
                <input type="email" 
                       [(ngModel)]="email"
                       placeholder="your@email.com"
                       class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:border-cyan-500 focus:outline-none">
              </div>
              
              <div class="space-y-3 mb-6">
                <label class="block text-sm text-slate-400 mb-2">\u9078\u64C7\u652F\u4ED8\u65B9\u5F0F</label>
                
                <div class="grid grid-cols-2 gap-3">
                  <button (click)="paymentMethod.set('alipay')"
                          class="flex items-center justify-center gap-2 p-4 rounded-xl border-2 transition-all"
                          [class.border-cyan-500]="paymentMethod() === 'alipay'"
                          [class.bg-cyan-500/10]="paymentMethod() === 'alipay'"
                          [class.border-slate-600]="paymentMethod() !== 'alipay'">
                    <span class="text-2xl">\u{1F499}</span>
                    <span class="text-white font-medium">\u652F\u4ED8\u5BF6</span>
                  </button>
                  
                  <button (click)="paymentMethod.set('wechat')"
                          class="flex items-center justify-center gap-2 p-4 rounded-xl border-2 transition-all"
                          [class.border-cyan-500]="paymentMethod() === 'wechat'"
                          [class.bg-cyan-500/10]="paymentMethod() === 'wechat'"
                          [class.border-slate-600]="paymentMethod() !== 'wechat'">
                    <span class="text-2xl">\u{1F49A}</span>
                    <span class="text-white font-medium">\u5FAE\u4FE1\u652F\u4ED8</span>
                  </button>
                  
                  <button (click)="paymentMethod.set('stripe')"
                          class="flex items-center justify-center gap-2 p-4 rounded-xl border-2 transition-all"
                          [class.border-cyan-500]="paymentMethod() === 'stripe'"
                          [class.bg-cyan-500/10]="paymentMethod() === 'stripe'"
                          [class.border-slate-600]="paymentMethod() !== 'stripe'">
                    <span class="text-2xl">\u{1F4B3}</span>
                    <span class="text-white font-medium">\u570B\u969B\u5361</span>
                  </button>
                  
                  <button (click)="paymentMethod.set('usdt')"
                          class="flex items-center justify-center gap-2 p-4 rounded-xl border-2 transition-all"
                          [class.border-cyan-500]="paymentMethod() === 'usdt'"
                          [class.bg-cyan-500/10]="paymentMethod() === 'usdt'"
                          [class.border-slate-600]="paymentMethod() !== 'usdt'">
                    <span class="text-2xl">\u{1F48E}</span>
                    <span class="text-white font-medium">USDT</span>
                  </button>
                </div>
                
                @if(paymentMethod() === 'usdt') {
                  <div class="mt-3 p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-lg">
                    <div class="flex items-center gap-2 text-emerald-400 text-sm mb-3">
                      <span>\u{1F48E}</span>
                      <span class="font-medium">USDT-TRC20 \u652F\u4ED8\uFF08\u63A8\u85A6\uFF09</span>
                    </div>
                    <div class="flex items-center gap-3 mb-3">
                      <div class="flex-1 p-2 bg-slate-800 rounded-lg">
                        <div class="text-xs text-slate-500 mb-1">\u652F\u4ED8\u91D1\u984D</div>
                        <div class="text-2xl font-bold text-emerald-400">{{ selectedProduct()?.price }} USDT</div>
                      </div>
                      <div class="flex-1 p-2 bg-slate-800 rounded-lg">
                        <div class="text-xs text-slate-500 mb-1">\u7DB2\u7D61</div>
                        <div class="text-lg font-bold text-cyan-400">TRC20</div>
                      </div>
                    </div>
                    <div class="text-xs text-orange-400 bg-orange-500/10 rounded-lg p-2">
                      \u26A0\uFE0F \u50C5\u652F\u6301 TRC20 \u7DB2\u7D61\uFF0C\u5176\u4ED6\u7DB2\u7D61\u8F49\u8CEC\u5C07\u7121\u6CD5\u5230\u8CEC
                    </div>
                  </div>
                }
              </div>
              
              <div class="flex gap-4">
                <button (click)="step.set('select')"
                        class="flex-1 py-3 rounded-xl bg-slate-700 text-slate-300 hover:bg-slate-600 transition-colors">
                  \u8FD4\u56DE
                </button>
                <button (click)="createOrder()"
                        [disabled]="isProcessing()"
                        class="flex-1 py-3 rounded-xl bg-gradient-to-r from-cyan-500 to-purple-500 text-white font-bold hover:opacity-90 transition-opacity disabled:opacity-50">
                  {{ isProcessing() ? '\u8655\u7406\u4E2D...' : '\u7ACB\u5373\u652F\u4ED8' }}
                </button>
              </div>
            }
            
            <!-- \u6B65\u9A5F 3: \u7B49\u5F85\u652F\u4ED8 -->
            @if(step() === 'pending') {
              <div class="text-center py-8">
                <div class="text-6xl mb-4">{{ paymentMethod() === 'usdt' ? '\u{1F48E}' : '\u23F3' }}</div>
                <h3 class="text-xl font-bold text-white mb-2">\u7B49\u5F85\u652F\u4ED8</h3>
                <p class="text-slate-400 mb-4">
                  {{ paymentMethod() === 'usdt' ? '\u8ACB\u5411\u4EE5\u4E0B\u5730\u5740\u8F49\u8CEC USDT' : '\u8ACB\u5728\u65B0\u7A97\u53E3\u5B8C\u6210\u652F\u4ED8' }}
                </p>
                
                <div class="bg-slate-700/50 rounded-xl p-4 mb-4">
                  <div class="text-sm text-slate-400">\u8A02\u55AE\u865F</div>
                  <div class="text-lg font-mono text-cyan-400">{{ currentOrder()?.order_id }}</div>
                </div>
                
                @if(paymentMethod() === 'usdt') {
                  <!-- USDT TRC20 \u652F\u4ED8\u4FE1\u606F -->
                  <div class="bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-5 mb-4 text-left">
                    <div class="text-center mb-4">
                      <div class="text-3xl font-bold text-emerald-400">{{ selectedProduct()?.price }} USDT</div>
                      <div class="text-sm text-slate-400 mt-1">TRC20 \u7DB2\u7D61\uFF08TRON\uFF09</div>
                    </div>
                    
                    <div class="mb-4">
                      <div class="text-xs text-slate-400 mb-2">\u6536\u6B3E\u5730\u5740\uFF08TRC20\uFF09</div>
                      <div class="bg-slate-800 rounded-lg p-3">
                        <div class="flex items-center justify-between gap-2">
                          <code class="text-sm text-emerald-400 break-all font-mono">{{ USDT_CONFIG.walletAddress }}</code>
                          <button (click)="copyUsdtAddress()" 
                                  class="flex-shrink-0 bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-400 px-3 py-1.5 rounded-lg text-sm transition-colors">
                            \u{1F4CB} \u8907\u88FD
                          </button>
                        </div>
                      </div>
                    </div>
                    
                    <div class="bg-slate-800/50 rounded-lg p-3 mb-4">
                      <div class="flex items-start gap-3">
                        <div class="text-2xl">\u{1F4DD}</div>
                        <div>
                          <div class="text-sm text-white font-medium mb-1">\u8F49\u8CEC\u6B65\u9A5F</div>
                          <ol class="text-xs text-slate-400 space-y-1">
                            <li>1. \u6253\u958B\u60A8\u7684\u52A0\u5BC6\u8CA8\u5E63\u9322\u5305\uFF08\u5982 Trust Wallet\u3001TokenPocket\uFF09</li>
                            <li>2. \u9078\u64C7 USDT \u8CC7\u7522\uFF0C\u9EDE\u64CA\u300C\u767C\u9001\u300D</li>
                            <li>3. \u7C98\u8CBC\u4E0A\u65B9\u5730\u5740\uFF0C\u9078\u64C7 <span class="text-emerald-400 font-medium">TRC20</span> \u7DB2\u7D61</li>
                            <li>4. \u8F38\u5165\u91D1\u984D <span class="text-emerald-400 font-medium">{{ selectedProduct()?.price }} USDT</span></li>
                            <li>5. \u78BA\u8A8D\u8F49\u8CEC\uFF0C\u7B49\u5F85\u5340\u584A\u78BA\u8A8D</li>
                          </ol>
                        </div>
                      </div>
                    </div>
                    
                    <div class="text-xs text-orange-400 bg-orange-500/10 rounded-lg p-3 flex items-start gap-2">
                      <span>\u26A0\uFE0F</span>
                      <div>
                        <strong>\u91CD\u8981\u63D0\u9192\uFF1A</strong>
                        <ul class="mt-1 space-y-0.5">
                          <li>\u2022 \u50C5\u652F\u6301 <strong>TRC20</strong> \u7DB2\u7D61\uFF0C\u5176\u4ED6\u7DB2\u7D61\u8F49\u8CEC\u5C07\u7121\u6CD5\u5230\u8CEC</li>
                          <li>\u2022 \u8ACB\u78BA\u4FDD\u8F49\u8CEC\u91D1\u984D\u6B63\u78BA\uFF1A<strong>{{ selectedProduct()?.price }} USDT</strong></li>
                          <li>\u2022 \u8F49\u8CEC\u5F8C\u901A\u5E38 1-5 \u5206\u9418\u5167\u5230\u8CEC</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                }
                
                <div class="text-sm text-slate-500 mb-6">
                  {{ paymentMethod() === 'usdt' ? '\u8F49\u8CEC\u6210\u529F\u5F8C\u9EDE\u64CA\u300C\u6211\u5DF2\u652F\u4ED8\u300D' : '\u652F\u4ED8\u5B8C\u6210\u5F8C\u5C07\u81EA\u52D5\u6FC0\u6D3B\u6703\u54E1' }}
                </div>
                
                <div class="flex gap-4">
                  <button (click)="cancelPayment()"
                          class="flex-1 py-3 rounded-xl bg-slate-700 text-slate-300 hover:bg-slate-600 transition-colors">
                    \u53D6\u6D88\u652F\u4ED8
                  </button>
                  <button (click)="checkPaymentStatus()"
                          [disabled]="isChecking()"
                          class="flex-1 py-3 rounded-xl bg-cyan-500 text-white font-bold hover:bg-cyan-600 transition-colors disabled:opacity-50">
                    {{ isChecking() ? '\u6AA2\u67E5\u4E2D...' : '\u6211\u5DF2\u652F\u4ED8' }}
                  </button>
                </div>
              </div>
            }
            
            <!-- \u6B65\u9A5F 4: \u652F\u4ED8\u6210\u529F -->
            @if(step() === 'success') {
              <div class="text-center py-8">
                <div class="text-6xl mb-4">\u{1F389}</div>
                <h3 class="text-xl font-bold text-white mb-2">\u652F\u4ED8\u6210\u529F\uFF01</h3>
                <p class="text-slate-400 mb-4">\u60A8\u7684\u6703\u54E1\u5DF2\u6FC0\u6D3B</p>
                
                @if(activatedLicenseKey()) {
                  <div class="bg-gradient-to-r from-cyan-500/20 to-purple-500/20 rounded-xl p-4 mb-6">
                    <div class="text-sm text-slate-400">\u60A8\u7684\u5361\u5BC6</div>
                    <div class="text-lg font-mono text-cyan-400">{{ activatedLicenseKey() }}</div>
                    <button (click)="copyLicenseKey()"
                            class="mt-2 text-sm text-cyan-400 hover:underline">
                      \u{1F4CB} \u8907\u88FD\u5361\u5BC6
                    </button>
                  </div>
                }
                
                <button (click)="close()"
                        class="w-full py-3 rounded-xl bg-gradient-to-r from-cyan-500 to-purple-500 text-white font-bold hover:opacity-90 transition-opacity">
                  \u958B\u59CB\u4F7F\u7528
                </button>
              </div>
            }
            
            <!-- \u806F\u7E6B\u5BA2\u670D -->
            <div class="mt-6 pt-4 border-t border-slate-700 text-center">
              <p class="text-sm text-slate-500">
                \u9047\u5230\u554F\u984C\uFF1F
                <a href="#" class="text-cyan-400 hover:underline">\u806F\u7E6B\u5BA2\u670D</a>
                \u6216
                <a href="#" class="text-cyan-400 hover:underline">\u67E5\u770B\u5E6B\u52A9</a>
              </p>
            </div>
          </div>
        </div>
      </div>
    }
  `
    }]
  }], () => [], null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(PaymentComponent, { className: "PaymentComponent", filePath: "src/payment.component.ts", lineNumber: 310 });
})();

// src/security.service.ts
var ENCRYPTION_KEY = "TG-AI\u667A\u63A7\u738B-2026-Secure-Key";
var SecurityService = class _SecurityService {
  constructor() {
    this._isSecure = signal(true, ...ngDevMode ? [{ debugName: "_isSecure" }] : []);
    this.isSecure = this._isSecure.asReadonly();
    this.initSecurityChecks();
  }
  /**
   * 初始化安全檢查
   */
  initSecurityChecks() {
    if (this.isProduction()) {
      this.detectDevTools();
      this.preventContextMenu();
      this.preventKeyboardShortcuts();
    }
  }
  /**
   * 檢查是否為生產環境
   */
  isProduction() {
    return !window.location.href.includes("localhost") && !window.location.href.includes("127.0.0.1");
  }
  /**
   * 檢測開發者工具
   */
  detectDevTools() {
    const threshold = 160;
    const checkDevTools = () => {
      const widthThreshold = window.outerWidth - window.innerWidth > threshold;
      const heightThreshold = window.outerHeight - window.innerHeight > threshold;
      if (widthThreshold || heightThreshold) {
        this._isSecure.set(false);
        console.clear();
        console.log("%c\u26A0\uFE0F \u6AA2\u6E2C\u5230\u958B\u767C\u8005\u5DE5\u5177", "color: red; font-size: 20px;");
      } else {
        this._isSecure.set(true);
      }
    };
    setInterval(checkDevTools, 1e3);
    setInterval(() => {
      const start = performance.now();
      const duration = performance.now() - start;
      if (duration > 100) {
        this._isSecure.set(false);
      }
    }, 5e3);
  }
  /**
   * 禁用右鍵菜單
   */
  preventContextMenu() {
    document.addEventListener("contextmenu", (e) => {
      e.preventDefault();
      return false;
    });
  }
  /**
   * 禁用調試快捷鍵
   */
  preventKeyboardShortcuts() {
    document.addEventListener("keydown", (e) => {
      if (e.key === "F12") {
        e.preventDefault();
        return false;
      }
      if (e.ctrlKey && e.shiftKey && e.key === "I") {
        e.preventDefault();
        return false;
      }
      if (e.ctrlKey && e.shiftKey && e.key === "J") {
        e.preventDefault();
        return false;
      }
      if (e.ctrlKey && e.key === "u") {
        e.preventDefault();
        return false;
      }
      return true;
    });
  }
  // ============ 數據加密 ============
  /**
   * 加密敏感數據
   */
  encrypt(data) {
    if (!data)
      return "";
    try {
      const encoded = btoa(unescape(encodeURIComponent(data)));
      const shuffled = this.shuffle(encoded, ENCRYPTION_KEY);
      return "ENC:" + shuffled;
    } catch (e) {
      console.error("Encryption failed:", e);
      return data;
    }
  }
  /**
   * 解密敏感數據
   */
  decrypt(encryptedData) {
    if (!encryptedData)
      return "";
    if (!encryptedData.startsWith("ENC:")) {
      return encryptedData;
    }
    try {
      const data = encryptedData.substring(4);
      const unshuffled = this.unshuffle(data, ENCRYPTION_KEY);
      return decodeURIComponent(escape(atob(unshuffled)));
    } catch (e) {
      console.error("Decryption failed:", e);
      return "";
    }
  }
  /**
   * 簡單混淆
   */
  shuffle(str, key) {
    const keySum = key.split("").reduce((a, b) => a + b.charCodeAt(0), 0);
    const shift = keySum % 26;
    return str.split("").map((char) => {
      const code = char.charCodeAt(0);
      if (code >= 65 && code <= 90) {
        return String.fromCharCode((code - 65 + shift) % 26 + 65);
      }
      if (code >= 97 && code <= 122) {
        return String.fromCharCode((code - 97 + shift) % 26 + 97);
      }
      return char;
    }).join("");
  }
  /**
   * 反混淆
   */
  unshuffle(str, key) {
    const keySum = key.split("").reduce((a, b) => a + b.charCodeAt(0), 0);
    const shift = keySum % 26;
    return str.split("").map((char) => {
      const code = char.charCodeAt(0);
      if (code >= 65 && code <= 90) {
        return String.fromCharCode((code - 65 - shift + 26) % 26 + 65);
      }
      if (code >= 97 && code <= 122) {
        return String.fromCharCode((code - 97 - shift + 26) % 26 + 97);
      }
      return char;
    }).join("");
  }
  // ============ 安全存儲 ============
  /**
   * 安全存儲數據
   */
  secureStore(key, value) {
    const encrypted = this.encrypt(JSON.stringify(value));
    localStorage.setItem(key, encrypted);
  }
  /**
   * 安全讀取數據
   */
  secureRetrieve(key, defaultValue) {
    const encrypted = localStorage.getItem(key);
    if (!encrypted)
      return defaultValue;
    try {
      const decrypted = this.decrypt(encrypted);
      return JSON.parse(decrypted);
    } catch (e) {
      return defaultValue;
    }
  }
  /**
   * 安全刪除數據
   */
  secureRemove(key) {
    localStorage.removeItem(key);
  }
  // ============ API 密鑰保護 ============
  /**
   * 存儲 API 密鑰
   */
  storeApiKey(keyName, apiKey) {
    this.secureStore(`api_${keyName}`, apiKey);
  }
  /**
   * 讀取 API 密鑰
   */
  getApiKey(keyName) {
    return this.secureRetrieve(`api_${keyName}`, "");
  }
  /**
   * 刪除 API 密鑰
   */
  removeApiKey(keyName) {
    this.secureRemove(`api_${keyName}`);
  }
  // ============ 機器指紋 ============
  /**
   * 生成機器指紋
   */
  generateFingerprint() {
    const components = [
      navigator.userAgent,
      navigator.language,
      screen.width + "x" + screen.height,
      screen.colorDepth,
      (/* @__PURE__ */ new Date()).getTimezoneOffset(),
      navigator.hardwareConcurrency || "unknown",
      navigator.deviceMemory || "unknown"
    ];
    const fingerprint = components.join("|");
    return this.hashString(fingerprint);
  }
  /**
   * 簡單哈希
   */
  hashString(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
      const char = str.charCodeAt(i);
      hash = (hash << 5) - hash + char;
      hash = hash & hash;
    }
    return "fp-" + Math.abs(hash).toString(16);
  }
  // ============ 請求簽名 ============
  /**
   * 生成請求簽名
   */
  signRequest(payload, timestamp) {
    const data = JSON.stringify(payload) + timestamp + ENCRYPTION_KEY;
    return this.hashString(data);
  }
  /**
   * 驗證請求簽名
   */
  verifySignature(payload, timestamp, signature) {
    const now = Date.now();
    if (Math.abs(now - timestamp) > 5 * 60 * 1e3) {
      return false;
    }
    const expectedSignature = this.signRequest(payload, timestamp);
    return expectedSignature === signature;
  }
  static {
    this.\u0275fac = function SecurityService_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _SecurityService)();
    };
  }
  static {
    this.\u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({ token: _SecurityService, factory: _SecurityService.\u0275fac, providedIn: "root" });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(SecurityService, [{
    type: Injectable,
    args: [{
      providedIn: "root"
    }]
  }], () => [], null);
})();

// src/loading.service.ts
var LoadingService = class _LoadingService {
  constructor() {
    this.tasks = signal(/* @__PURE__ */ new Map(), ...ngDevMode ? [{ debugName: "tasks" }] : []);
    this.connectionState = signal({
      stage: "connecting",
      progress: 0,
      message: "\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...",
      startTime: Date.now()
    }, ...ngDevMode ? [{ debugName: "connectionState" }] : []);
    this.showConnectionStatus = signal(true, ...ngDevMode ? [{ debugName: "showConnectionStatus" }] : []);
    this.isLoading = computed(() => {
      const taskMap = this.tasks();
      for (const task of taskMap.values()) {
        if (task.blocking !== false) {
          return true;
        }
      }
      return false;
    }, ...ngDevMode ? [{ debugName: "isLoading" }] : []);
    this.currentTask = computed(() => {
      const taskMap = this.tasks();
      if (taskMap.size === 0)
        return null;
      const tasksArray = Array.from(taskMap.values());
      return tasksArray[tasksArray.length - 1];
    }, ...ngDevMode ? [{ debugName: "currentTask" }] : []);
    this.message = computed(() => this.currentTask()?.message || "", ...ngDevMode ? [{ debugName: "message" }] : []);
    this.progress = computed(() => this.currentTask()?.progress, ...ngDevMode ? [{ debugName: "progress" }] : []);
    this.taskCount = computed(() => this.tasks().size, ...ngDevMode ? [{ debugName: "taskCount" }] : []);
    this.connectionProgressTimer = null;
  }
  /**
   * 開始加載
   */
  start(message = "\u8F09\u5165\u4E2D...", id) {
    const taskId = id || this.generateId();
    this.tasks.update((tasks) => {
      const newTasks = new Map(tasks);
      newTasks.set(taskId, {
        id: taskId,
        message,
        startTime: Date.now(),
        type: "spinner"
      });
      return newTasks;
    });
    return taskId;
  }
  /**
   * 開始帶進度的加載
   */
  startWithProgress(message, id) {
    const taskId = id || this.generateId();
    this.tasks.update((tasks) => {
      const newTasks = new Map(tasks);
      newTasks.set(taskId, {
        id: taskId,
        message,
        progress: 0,
        startTime: Date.now(),
        type: "progress"
      });
      return newTasks;
    });
    return taskId;
  }
  /**
   * 更新進度
   */
  updateProgress(taskId, progress, message) {
    this.tasks.update((tasks) => {
      const newTasks = new Map(tasks);
      const task = newTasks.get(taskId);
      if (task) {
        newTasks.set(taskId, __spreadProps(__spreadValues({}, task), {
          progress: Math.min(100, Math.max(0, progress)),
          message: message || task.message
        }));
      }
      return newTasks;
    });
  }
  /**
   * 更新消息
   */
  updateMessage(taskId, message) {
    this.tasks.update((tasks) => {
      const newTasks = new Map(tasks);
      const task = newTasks.get(taskId);
      if (task) {
        newTasks.set(taskId, __spreadProps(__spreadValues({}, task), { message }));
      }
      return newTasks;
    });
  }
  /**
   * 結束加載
   */
  stop(taskId) {
    this.tasks.update((tasks) => {
      const newTasks = new Map(tasks);
      newTasks.delete(taskId);
      return newTasks;
    });
  }
  /**
   * 結束所有加載
   */
  stopAll() {
    this.tasks.set(/* @__PURE__ */ new Map());
  }
  /**
   * 包裝異步操作
   */
  async wrap(promise, message = "\u8F09\u5165\u4E2D...") {
    const taskId = this.start(message);
    try {
      const result = await promise;
      return result;
    } finally {
      this.stop(taskId);
    }
  }
  /**
   * 包裝帶進度的異步操作
   */
  async wrapWithProgress(operation, message = "\u8655\u7406\u4E2D...") {
    const taskId = this.startWithProgress(message);
    try {
      const result = await operation((progress, msg) => {
        this.updateProgress(taskId, progress, msg);
      });
      return result;
    } finally {
      this.stop(taskId);
    }
  }
  generateId() {
    return "load-" + Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
  }
  // ========== 🆕 非阻塞式連接狀態管理 ==========
  /**
   * 開始非阻塞式連接（不顯示全屏遮罩）
   */
  startConnection() {
    this.showConnectionStatus.set(true);
    this.connectionState.set({
      stage: "connecting",
      progress: 5,
      message: "\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...",
      startTime: Date.now()
    });
    this.simulateConnectionProgress();
  }
  simulateConnectionProgress() {
    if (this.connectionProgressTimer) {
      clearInterval(this.connectionProgressTimer);
    }
    this.connectionProgressTimer = setInterval(() => {
      const state = this.connectionState();
      if (state.stage === "connecting" && state.progress < 25) {
        this.connectionState.update((s) => __spreadProps(__spreadValues({}, s), {
          progress: Math.min(25, s.progress + 2)
        }));
      } else if (state.stage === "loading-data" && state.progress < 75) {
        this.connectionState.update((s) => __spreadProps(__spreadValues({}, s), {
          progress: Math.min(75, s.progress + 1)
        }));
      }
    }, 200);
  }
  /**
   * 更新連接階段
   */
  updateConnectionStage(stage, message) {
    const progressMap = {
      "connecting": 10,
      "loading-data": 40,
      "initializing": 70,
      "ready": 100,
      "error": 0
    };
    this.connectionState.update((s) => __spreadProps(__spreadValues({}, s), {
      stage,
      progress: progressMap[stage],
      message: message || this.getStageMessage(stage)
    }));
    if (stage === "ready" || stage === "error") {
      if (this.connectionProgressTimer) {
        clearInterval(this.connectionProgressTimer);
        this.connectionProgressTimer = null;
      }
      if (stage === "ready") {
        setTimeout(() => {
          this.showConnectionStatus.set(false);
        }, 500);
      }
    }
  }
  /**
   * 連接失敗
   */
  connectionError(error) {
    if (this.connectionProgressTimer) {
      clearInterval(this.connectionProgressTimer);
    }
    this.connectionState.set({
      stage: "error",
      progress: 0,
      message: "\u9023\u63A5\u5931\u6557",
      startTime: Date.now(),
      error
    });
  }
  /**
   * 隱藏連接狀態
   */
  hideConnectionStatus() {
    this.showConnectionStatus.set(false);
  }
  getStageMessage(stage) {
    switch (stage) {
      case "connecting":
        return "\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...";
      case "loading-data":
        return "\u6B63\u5728\u8F09\u5165\u6578\u64DA...";
      case "initializing":
        return "\u6B63\u5728\u521D\u59CB\u5316...";
      case "ready":
        return "\u9023\u63A5\u6210\u529F";
      case "error":
        return "\u9023\u63A5\u5931\u6557";
    }
  }
  static {
    this.\u0275fac = function LoadingService_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _LoadingService)();
    };
  }
  static {
    this.\u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({ token: _LoadingService, factory: _LoadingService.\u0275fac, providedIn: "root" });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(LoadingService, [{
    type: Injectable,
    args: [{
      providedIn: "root"
    }]
  }], null, null);
})();

// src/services/offline-cache.service.ts
var DB_NAME = "TgMatrixCache";
var DB_VERSION = 1;
var STORE_STATE = "appState";
var STORE_OPERATIONS = "offlineOperations";
var CACHE_VERSION = "2.1.1";
var CACHE_MAX_AGE_MS = 24 * 60 * 60 * 1e3;
var OfflineCacheService = class _OfflineCacheService {
  constructor(ngZone) {
    this.ngZone = ngZone;
    this.db = null;
    this.dbReady = false;
    this.networkStatus = signal("online", ...ngDevMode ? [{ debugName: "networkStatus" }] : []);
    this.isOnline = computed(() => this.networkStatus() !== "offline", ...ngDevMode ? [{ debugName: "isOnline" }] : []);
    this.isPageVisible = signal(true, ...ngDevMode ? [{ debugName: "isPageVisible" }] : []);
    this.pendingOperations = signal([], ...ngDevMode ? [{ debugName: "pendingOperations" }] : []);
    this.hasPendingOperations = computed(() => this.pendingOperations().length > 0, ...ngDevMode ? [{ debugName: "hasPendingOperations" }] : []);
    this.cachedState = signal(null, ...ngDevMode ? [{ debugName: "cachedState" }] : []);
    this.isCacheValid = computed(() => {
      const cache = this.cachedState();
      if (!cache)
        return false;
      if (cache.version !== CACHE_VERSION)
        return false;
      if (Date.now() - cache.lastUpdated > CACHE_MAX_AGE_MS)
        return false;
      return true;
    }, ...ngDevMode ? [{ debugName: "isCacheValid" }] : []);
    this.initDatabase();
    this.setupNetworkListener();
    this.setupVisibilityListener();
  }
  /**
   * 初始化 IndexedDB
   */
  async initDatabase() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(DB_NAME, DB_VERSION);
      request.onerror = () => {
        console.error("[OfflineCache] Failed to open IndexedDB:", request.error);
        reject(request.error);
      };
      request.onsuccess = () => {
        this.db = request.result;
        this.dbReady = true;
        console.log("[OfflineCache] \u2705 IndexedDB initialized");
        this.loadCachedState();
        this.loadPendingOperations();
        resolve();
      };
      request.onupgradeneeded = (event) => {
        const db = event.target.result;
        if (!db.objectStoreNames.contains(STORE_STATE)) {
          db.createObjectStore(STORE_STATE, { keyPath: "id" });
          console.log("[OfflineCache] Created state store");
        }
        if (!db.objectStoreNames.contains(STORE_OPERATIONS)) {
          const opStore = db.createObjectStore(STORE_OPERATIONS, { keyPath: "id" });
          opStore.createIndex("timestamp", "timestamp", { unique: false });
          console.log("[OfflineCache] Created operations store");
        }
      };
    });
  }
  /**
   * 🆕 P2-2: 設置網絡狀態監聽
   */
  setupNetworkListener() {
    window.addEventListener("online", () => {
      this.ngZone.run(() => {
        console.log("[OfflineCache] \u{1F310} Network online");
        this.networkStatus.set("online");
        this.syncPendingOperations();
      });
    });
    window.addEventListener("offline", () => {
      this.ngZone.run(() => {
        console.log("[OfflineCache] \u{1F4F4} Network offline");
        this.networkStatus.set("offline");
      });
    });
    this.networkStatus.set(navigator.onLine ? "online" : "offline");
    if ("connection" in navigator) {
      const connection = navigator.connection;
      if (connection) {
        connection.addEventListener("change", () => {
          this.ngZone.run(() => {
            const effectiveType = connection.effectiveType;
            if (effectiveType === "slow-2g" || effectiveType === "2g") {
              this.networkStatus.set("slow");
            } else if (navigator.onLine) {
              this.networkStatus.set("online");
            }
          });
        });
      }
    }
  }
  /**
   * 🆕 P2-3: 設置頁面可見性監聽
   */
  setupVisibilityListener() {
    document.addEventListener("visibilitychange", () => {
      this.ngZone.run(() => {
        const visible = document.visibilityState === "visible";
        console.log(`[OfflineCache] \u{1F441}\uFE0F Page visibility: ${visible ? "visible" : "hidden"}`);
        this.isPageVisible.set(visible);
        if (visible && this.isOnline()) {
          window.dispatchEvent(new CustomEvent("page-became-visible"));
        }
      });
    });
  }
  /**
   * 🆕 P2-1: 緩存應用狀態
   */
  async cacheState(state) {
    if (!this.dbReady || !this.db) {
      console.warn("[OfflineCache] Database not ready");
      return;
    }
    const cachedData = {
      accounts: state.accounts || [],
      keywordSets: state.keywordSets || [],
      monitoredGroups: state.monitoredGroups || [],
      campaigns: state.campaigns || [],
      leads: state.leads || [],
      settings: state.settings || {},
      lastUpdated: Date.now(),
      version: CACHE_VERSION
    };
    try {
      const transaction = this.db.transaction([STORE_STATE], "readwrite");
      const store = transaction.objectStore(STORE_STATE);
      await new Promise((resolve, reject) => {
        const request = store.put(__spreadValues({ id: "main" }, cachedData));
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
      });
      this.cachedState.set(cachedData);
      console.log("[OfflineCache] \u2705 State cached");
    } catch (error) {
      console.error("[OfflineCache] Failed to cache state:", error);
    }
  }
  /**
   * 🆕 P2-1: 載入緩存狀態
   */
  async loadCachedState() {
    if (!this.dbReady || !this.db) {
      return null;
    }
    try {
      const transaction = this.db.transaction([STORE_STATE], "readonly");
      const store = transaction.objectStore(STORE_STATE);
      const result = await new Promise((resolve, reject) => {
        const request = store.get("main");
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
      if (result) {
        const _a2 = result, { id } = _a2, state = __objRest(_a2, ["id"]);
        this.cachedState.set(state);
        console.log("[OfflineCache] \u2705 Loaded cached state from", new Date(state.lastUpdated).toLocaleString());
        return state;
      }
      return null;
    } catch (error) {
      console.error("[OfflineCache] Failed to load cached state:", error);
      return null;
    }
  }
  /**
   * 🆕 P2-4: 添加離線操作
   */
  async addOfflineOperation(command, payload) {
    if (!this.dbReady || !this.db) {
      console.warn("[OfflineCache] Database not ready, operation not queued");
      return;
    }
    const operation = {
      id: `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
      command,
      payload,
      timestamp: Date.now(),
      retryCount: 0
    };
    try {
      const transaction = this.db.transaction([STORE_OPERATIONS], "readwrite");
      const store = transaction.objectStore(STORE_OPERATIONS);
      await new Promise((resolve, reject) => {
        const request = store.put(operation);
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
      });
      this.pendingOperations.update((ops) => [...ops, operation]);
      console.log("[OfflineCache] \u2795 Queued offline operation:", command);
    } catch (error) {
      console.error("[OfflineCache] Failed to queue operation:", error);
    }
  }
  /**
   * 🆕 P2-4: 載入待處理操作
   */
  async loadPendingOperations() {
    if (!this.dbReady || !this.db)
      return;
    try {
      const transaction = this.db.transaction([STORE_OPERATIONS], "readonly");
      const store = transaction.objectStore(STORE_OPERATIONS);
      const result = await new Promise((resolve, reject) => {
        const request = store.getAll();
        request.onsuccess = () => resolve(request.result || []);
        request.onerror = () => reject(request.error);
      });
      this.pendingOperations.set(result);
      if (result.length > 0) {
        console.log("[OfflineCache] \u{1F4CB} Loaded", result.length, "pending operations");
      }
    } catch (error) {
      console.error("[OfflineCache] Failed to load pending operations:", error);
    }
  }
  /**
   * 🆕 P2-4: 同步離線操作
   */
  async syncPendingOperations() {
    const operations = this.pendingOperations();
    if (operations.length === 0)
      return;
    console.log("[OfflineCache] \u{1F504} Syncing", operations.length, "pending operations");
    window.dispatchEvent(new CustomEvent("sync-offline-operations", {
      detail: { operations }
    }));
  }
  /**
   * 🆕 P2-4: 移除已完成的操作
   */
  async removeOperation(operationId) {
    if (!this.dbReady || !this.db)
      return;
    try {
      const transaction = this.db.transaction([STORE_OPERATIONS], "readwrite");
      const store = transaction.objectStore(STORE_OPERATIONS);
      await new Promise((resolve, reject) => {
        const request = store.delete(operationId);
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
      });
      this.pendingOperations.update((ops) => ops.filter((op) => op.id !== operationId));
      console.log("[OfflineCache] \u2705 Removed operation:", operationId);
    } catch (error) {
      console.error("[OfflineCache] Failed to remove operation:", error);
    }
  }
  /**
   * 清除所有緩存
   */
  async clearCache() {
    if (!this.dbReady || !this.db)
      return;
    try {
      const transaction = this.db.transaction([STORE_STATE, STORE_OPERATIONS], "readwrite");
      await Promise.all([
        new Promise((resolve, reject) => {
          const request = transaction.objectStore(STORE_STATE).clear();
          request.onsuccess = () => resolve();
          request.onerror = () => reject(request.error);
        }),
        new Promise((resolve, reject) => {
          const request = transaction.objectStore(STORE_OPERATIONS).clear();
          request.onsuccess = () => resolve();
          request.onerror = () => reject(request.error);
        })
      ]);
      this.cachedState.set(null);
      this.pendingOperations.set([]);
      console.log("[OfflineCache] \u{1F5D1}\uFE0F Cache cleared");
    } catch (error) {
      console.error("[OfflineCache] Failed to clear cache:", error);
    }
  }
  /**
   * 獲取緩存統計
   */
  getCacheStats() {
    const cache = this.cachedState();
    return {
      stateAge: cache ? Date.now() - cache.lastUpdated : -1,
      pendingCount: this.pendingOperations().length,
      isValid: this.isCacheValid()
    };
  }
  static {
    this.\u0275fac = function OfflineCacheService_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _OfflineCacheService)(\u0275\u0275inject(NgZone));
    };
  }
  static {
    this.\u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({ token: _OfflineCacheService, factory: _OfflineCacheService.\u0275fac, providedIn: "root" });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(OfflineCacheService, [{
    type: Injectable,
    args: [{
      providedIn: "root"
    }]
  }], () => [{ type: NgZone }], null);
})();

// src/services/sw-manager.service.ts
var SwManagerService = class _SwManagerService {
  constructor(ngZone) {
    this.ngZone = ngZone;
    this.status = signal({
      registered: false,
      active: false,
      waiting: false,
      updateAvailable: false,
      version: null
    }, ...ngDevMode ? [{ debugName: "status" }] : []);
    this.cacheStats = signal({}, ...ngDevMode ? [{ debugName: "cacheStats" }] : []);
    this.isSupported = "serviceWorker" in navigator;
    this.registration = null;
    if (this.isSupported) {
      this.init();
    } else {
      console.log("[SwManager] Service Worker not supported");
    }
  }
  /**
   * 初始化 Service Worker
   */
  async init() {
    if (location.protocol !== "https:" && location.hostname !== "localhost") {
      console.log("[SwManager] Skipping SW registration (not HTTPS)");
      return;
    }
    try {
      navigator.serviceWorker.addEventListener("message", (event) => {
        this.handleSwMessage(event);
      });
      this.registration = await navigator.serviceWorker.register("/sw.js", {
        scope: "/"
      });
      console.log("[SwManager] \u2705 Service Worker registered");
      this.ngZone.run(() => {
        this.status.update((s) => __spreadProps(__spreadValues({}, s), { registered: true }));
      });
      this.monitorRegistration();
      this.checkForUpdates();
    } catch (error) {
      console.error("[SwManager] Registration failed:", error);
    }
  }
  /**
   * 監控 Service Worker 狀態
   */
  monitorRegistration() {
    if (!this.registration)
      return;
    if (this.registration.active) {
      this.ngZone.run(() => {
        this.status.update((s) => __spreadProps(__spreadValues({}, s), { active: true }));
      });
    }
    if (this.registration.waiting) {
      this.ngZone.run(() => {
        this.status.update((s) => __spreadProps(__spreadValues({}, s), { waiting: true, updateAvailable: true }));
      });
    }
    this.registration.addEventListener("updatefound", () => {
      console.log("[SwManager] Update found");
      const installing = this.registration.installing;
      if (!installing)
        return;
      installing.addEventListener("statechange", () => {
        if (installing.state === "installed") {
          if (navigator.serviceWorker.controller) {
            console.log("[SwManager] New version available");
            this.ngZone.run(() => {
              this.status.update((s) => __spreadProps(__spreadValues({}, s), { updateAvailable: true, waiting: true }));
            });
          }
        }
      });
    });
    navigator.serviceWorker.addEventListener("controllerchange", () => {
      console.log("[SwManager] Controller changed");
    });
  }
  /**
   * 處理來自 Service Worker 的消息
   */
  handleSwMessage(event) {
    console.log("[SwManager] Message from SW:", event.data);
    this.ngZone.run(() => {
      switch (event.data.type) {
        case "CACHE_STATS":
          this.cacheStats.set(event.data.stats);
          break;
        case "SYNC_OFFLINE_OPERATIONS":
          window.dispatchEvent(new CustomEvent("sync-offline-operations-from-sw"));
          break;
      }
    });
  }
  /**
   * 檢查更新
   */
  async checkForUpdates() {
    if (!this.registration)
      return false;
    try {
      await this.registration.update();
      console.log("[SwManager] Update check complete");
      return this.status().updateAvailable;
    } catch (error) {
      console.error("[SwManager] Update check failed:", error);
      return false;
    }
  }
  /**
   * 應用更新（激活等待中的 Service Worker）
   */
  async applyUpdate() {
    if (!this.registration?.waiting) {
      console.log("[SwManager] No waiting SW");
      return;
    }
    console.log("[SwManager] Applying update...");
    this.registration.waiting.postMessage({ type: "SKIP_WAITING" });
    navigator.serviceWorker.addEventListener("controllerchange", () => {
      window.location.reload();
    }, { once: true });
  }
  /**
   * 獲取緩存統計
   */
  async getCacheStats() {
    if (!navigator.serviceWorker.controller) {
      return {};
    }
    return new Promise((resolve) => {
      const channel = new MessageChannel();
      channel.port1.onmessage = (event) => {
        if (event.data.type === "CACHE_STATS") {
          resolve(event.data.stats);
        }
      };
      navigator.serviceWorker.controller.postMessage({ type: "GET_CACHE_STATS" }, [channel.port2]);
      setTimeout(() => resolve({}), 3e3);
    });
  }
  /**
   * 清除所有緩存
   */
  async clearCache() {
    if (!navigator.serviceWorker.controller) {
      return;
    }
    navigator.serviceWorker.controller.postMessage({ type: "CLEAR_CACHE" });
    console.log("[SwManager] Cache clear requested");
  }
  /**
   * 觸發後台同步
   */
  async triggerSync(tag = "sync-offline-operations") {
    if (!this.registration)
      return;
    if ("sync" in this.registration) {
      try {
        await this.registration.sync.register(tag);
        console.log("[SwManager] Background sync registered:", tag);
      } catch (error) {
        console.error("[SwManager] Sync registration failed:", error);
      }
    } else {
      console.log("[SwManager] Background sync not supported");
    }
  }
  /**
   * 註銷 Service Worker
   */
  async unregister() {
    if (!this.registration)
      return false;
    try {
      const result = await this.registration.unregister();
      console.log("[SwManager] Unregistered:", result);
      this.ngZone.run(() => {
        this.status.set({
          registered: false,
          active: false,
          waiting: false,
          updateAvailable: false,
          version: null
        });
      });
      return result;
    } catch (error) {
      console.error("[SwManager] Unregister failed:", error);
      return false;
    }
  }
  static {
    this.\u0275fac = function SwManagerService_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _SwManagerService)(\u0275\u0275inject(NgZone));
    };
  }
  static {
    this.\u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({ token: _SwManagerService, factory: _SwManagerService.\u0275fac, providedIn: "root" });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(SwManagerService, [{
    type: Injectable,
    args: [{
      providedIn: "root"
    }]
  }], () => [{ type: NgZone }], null);
})();

// src/onboarding.component.ts
var _forTrack04 = ($index, $item) => $item.id;
function OnboardingComponent_Conditional_0_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElement(0, "div", 22);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275styleProp("left", ctx_r1.highlightRect().left - 8, "px")("top", ctx_r1.highlightRect().top - 8, "px")("width", ctx_r1.highlightRect().width + 16, "px")("height", ctx_r1.highlightRect().height + 16, "px");
  }
}
function OnboardingComponent_Conditional_0_For_7_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 23);
    \u0275\u0275domListener("click", function OnboardingComponent_Conditional_0_For_7_Template_div_click_0_listener() {
      const \u0275$index_15_r4 = \u0275\u0275restoreView(_r3).$index;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.goToStep(\u0275$index_15_r4));
    });
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const \u0275$index_15_r4 = ctx.$index;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275classProp("bg-gradient-to-r", \u0275$index_15_r4 <= ctx_r1.currentIndex())("from-cyan-500", \u0275$index_15_r4 <= ctx_r1.currentIndex())("to-blue-500", \u0275$index_15_r4 <= ctx_r1.currentIndex())("bg-slate-700", \u0275$index_15_r4 > ctx_r1.currentIndex());
  }
}
function OnboardingComponent_Conditional_0_Conditional_14_Conditional_7_For_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "li", 30)(1, "span", 31);
    \u0275\u0275text(2, "\u2713");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(3, "span");
    \u0275\u0275text(4);
    \u0275\u0275domElementEnd()();
  }
  if (rf & 2) {
    const tip_r5 = ctx.$implicit;
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(tip_r5);
  }
}
function OnboardingComponent_Conditional_0_Conditional_14_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 27)(1, "ul", 29);
    \u0275\u0275repeaterCreate(2, OnboardingComponent_Conditional_0_Conditional_14_Conditional_7_For_3_Template, 5, 1, "li", 30, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275domElementEnd()();
  }
  if (rf & 2) {
    const step_r6 = \u0275\u0275nextContext();
    \u0275\u0275advance(2);
    \u0275\u0275repeater(step_r6.tips);
  }
}
function OnboardingComponent_Conditional_0_Conditional_14_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "button", 32);
    \u0275\u0275domListener("click", function OnboardingComponent_Conditional_0_Conditional_14_Conditional_8_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r7);
      const step_r6 = \u0275\u0275nextContext();
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.handleAction(step_r6.actionTarget));
    });
    \u0275\u0275text(1);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const step_r6 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", step_r6.actionLabel, " \u2192 ");
  }
}
function OnboardingComponent_Conditional_0_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 11)(1, "div", 24);
    \u0275\u0275text(2);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(3, "h2", 25);
    \u0275\u0275text(4);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(5, "p", 26);
    \u0275\u0275text(6);
    \u0275\u0275domElementEnd();
    \u0275\u0275conditionalCreate(7, OnboardingComponent_Conditional_0_Conditional_14_Conditional_7_Template, 4, 0, "div", 27);
    \u0275\u0275conditionalCreate(8, OnboardingComponent_Conditional_0_Conditional_14_Conditional_8_Template, 2, 1, "button", 28);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const step_r6 = ctx;
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", step_r6.icon, " ");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", step_r6.title, " ");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", step_r6.description, " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(step_r6.tips && step_r6.tips.length > 0 ? 7 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(step_r6.actionLabel && step_r6.actionTarget ? 8 : -1);
  }
}
function OnboardingComponent_Conditional_0_Conditional_24_Template(rf, ctx) {
  if (rf & 1) {
    const _r8 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "button", 33);
    \u0275\u0275domListener("click", function OnboardingComponent_Conditional_0_Conditional_24_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r8);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.next());
    });
    \u0275\u0275text(1, " \u4E0B\u4E00\u6B65 \u2192 ");
    \u0275\u0275domElementEnd();
  }
}
function OnboardingComponent_Conditional_0_Conditional_25_Template(rf, ctx) {
  if (rf & 1) {
    const _r9 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "button", 34);
    \u0275\u0275domListener("click", function OnboardingComponent_Conditional_0_Conditional_25_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.complete());
    });
    \u0275\u0275text(1, " \u5F00\u59CB\u4F7F\u7528 \u{1F680} ");
    \u0275\u0275domElementEnd();
  }
}
function OnboardingComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 1);
    \u0275\u0275domListener("click", function OnboardingComponent_Conditional_0_Template_div_click_0_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.onBackdropClick($event));
    });
    \u0275\u0275domElement(1, "div", 2);
    \u0275\u0275conditionalCreate(2, OnboardingComponent_Conditional_0_Conditional_2_Template, 1, 8, "div", 3);
    \u0275\u0275domElementStart(3, "div", 4);
    \u0275\u0275domListener("click", function OnboardingComponent_Conditional_0_Template_div_click_3_listener($event) {
      \u0275\u0275restoreView(_r1);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275domElementStart(4, "div", 5)(5, "div", 6);
    \u0275\u0275repeaterCreate(6, OnboardingComponent_Conditional_0_For_7_Template, 1, 8, "div", 7, _forTrack04);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(8, "div", 8)(9, "span");
    \u0275\u0275text(10);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(11, "button", 9);
    \u0275\u0275domListener("click", function OnboardingComponent_Conditional_0_Template_button_click_11_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.skipAll());
    });
    \u0275\u0275text(12, " \u8DF3\u8FC7\u5F15\u5BFC ");
    \u0275\u0275domElementEnd()()();
    \u0275\u0275domElementStart(13, "div", 10);
    \u0275\u0275conditionalCreate(14, OnboardingComponent_Conditional_0_Conditional_14_Template, 9, 5, "div", 11);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(15, "div", 12)(16, "div", 13)(17, "label", 14)(18, "input", 15);
    \u0275\u0275domListener("change", function OnboardingComponent_Conditional_0_Template_input_change_18_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.toggleNeverShow());
    });
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(19, "span");
    \u0275\u0275text(20, "\u4EE5\u540E\u4E0D\u518D\u63D0\u793A");
    \u0275\u0275domElementEnd()()();
    \u0275\u0275domElementStart(21, "div", 16)(22, "button", 17);
    \u0275\u0275domListener("click", function OnboardingComponent_Conditional_0_Template_button_click_22_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.previous());
    });
    \u0275\u0275text(23, " \u2190 \u4E0A\u4E00\u6B65 ");
    \u0275\u0275domElementEnd();
    \u0275\u0275conditionalCreate(24, OnboardingComponent_Conditional_0_Conditional_24_Template, 2, 0, "button", 18)(25, OnboardingComponent_Conditional_0_Conditional_25_Template, 2, 0, "button", 19);
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(26, "div", 20);
    \u0275\u0275text(27, " \u6309 ");
    \u0275\u0275domElementStart(28, "kbd", 21);
    \u0275\u0275text(29, "\u2190");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(30, "kbd", 21);
    \u0275\u0275text(31, "\u2192");
    \u0275\u0275domElementEnd();
    \u0275\u0275text(32, " \u5BFC\u822A \xB7 ");
    \u0275\u0275domElementStart(33, "kbd", 21);
    \u0275\u0275text(34, "ESC");
    \u0275\u0275domElementEnd();
    \u0275\u0275text(35, " \u5173\u95ED ");
    \u0275\u0275domElementEnd()()();
  }
  if (rf & 2) {
    let tmp_1_0;
    let tmp_4_0;
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(2);
    \u0275\u0275conditional(((tmp_1_0 = ctx_r1.currentStep()) == null ? null : tmp_1_0.targetSelector) && ctx_r1.highlightRect() ? 2 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275repeater(ctx_r1.steps);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate2("\u6B65\u9AA4 ", ctx_r1.currentIndex() + 1, " / ", ctx_r1.steps.length);
    \u0275\u0275advance(4);
    \u0275\u0275conditional((tmp_4_0 = ctx_r1.currentStep()) ? 14 : -1, tmp_4_0);
    \u0275\u0275advance(4);
    \u0275\u0275domProperty("checked", ctx_r1.neverShowAgain());
    \u0275\u0275advance(4);
    \u0275\u0275domProperty("disabled", ctx_r1.currentIndex() === 0);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.currentIndex() < ctx_r1.steps.length - 1 ? 24 : 25);
  }
}
function FeatureHighlightComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 1);
    \u0275\u0275domElement(1, "div", 2);
    \u0275\u0275domElementStart(2, "div", 3);
    \u0275\u0275domElement(3, "div", 4);
    \u0275\u0275domElementStart(4, "h4", 5);
    \u0275\u0275text(5);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(6, "p", 6);
    \u0275\u0275text(7);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(8, "button", 7);
    \u0275\u0275domListener("click", function FeatureHighlightComponent_Conditional_0_Template_button_click_8_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.dismiss());
    });
    \u0275\u0275text(9, "\u77E5\u9053\u4E86");
    \u0275\u0275domElementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275styleProp("top", ctx_r1.position.top, "px")("left", ctx_r1.position.left, "px");
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r1.title);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r1.description);
  }
}
var STORAGE_KEY = "tg-ai-onboarding";
var STORAGE_NEVER_SHOW = "tg-ai-onboarding-never-show";
var OnboardingComponent = class _OnboardingComponent {
  constructor() {
    this.show = signal(false, ...ngDevMode ? [{ debugName: "show" }] : []);
    this.currentIndex = signal(0, ...ngDevMode ? [{ debugName: "currentIndex" }] : []);
    this.neverShowAgain = signal(false, ...ngDevMode ? [{ debugName: "neverShowAgain" }] : []);
    this.highlightRect = signal(null, ...ngDevMode ? [{ debugName: "highlightRect" }] : []);
    this.navigateEvent = output();
    this.steps = [
      {
        id: "welcome",
        title: "\u6B22\u8FCE\u4F7F\u7528 TG-AI\u667A\u63A7\u738B",
        description: "\u667A\u80FD Telegram \u8425\u9500\u7CFB\u7EDF\uFF0C\u5E2E\u52A9\u60A8\u9AD8\u6548\u83B7\u5BA2\u3001\u81EA\u52A8\u5316\u8FD0\u8425",
        icon: "\u{1F389}",
        position: "center",
        tips: [
          "\u652F\u6301\u591A\u8D26\u53F7\u7BA1\u7406\u548C\u534F\u4F5C",
          "AI \u667A\u80FD\u8425\u9500\u548C\u81EA\u52A8\u56DE\u590D",
          "\u7FA4\u7EC4\u641C\u7D22\u548C\u8D44\u6E90\u7BA1\u7406"
        ]
      },
      {
        id: "add-account",
        title: "\u7B2C\u4E00\u6B65\uFF1A\u6DFB\u52A0\u8D26\u53F7",
        description: "\u7ED1\u5B9A\u60A8\u7684 Telegram \u8D26\u53F7\uFF0C\u8FD9\u662F\u4F7F\u7528\u6240\u6709\u529F\u80FD\u7684\u524D\u63D0",
        icon: "\u{1F4F1}",
        targetSelector: '[data-tour="accounts"]',
        position: "right",
        tips: [
          "\u652F\u6301\u624B\u673A\u53F7\u9A8C\u8BC1\u767B\u5F55",
          "\u53EF\u6DFB\u52A0\u591A\u4E2A\u8D26\u53F7\u540C\u65F6\u8FD0\u8425",
          "\u5EFA\u8BAE\u4F7F\u7528\u72EC\u7ACB\u8425\u9500\u53F7"
        ],
        actionLabel: "\u53BB\u6DFB\u52A0\u8D26\u53F7",
        actionTarget: "accounts"
      },
      {
        id: "search-discovery",
        title: "\u7B2C\u4E8C\u6B65\uFF1A\u641C\u7D22\u53D1\u73B0",
        description: "\u641C\u7D22\u76EE\u6807\u7FA4\u7EC4\u548C\u9891\u9053\uFF0C\u53D1\u73B0\u6F5C\u5728\u5BA2\u6237\u8D44\u6E90",
        icon: "\u{1F50D}",
        targetSelector: '[data-tour="search-discovery"]',
        position: "right",
        tips: [
          "\u652F\u6301\u591A\u6E20\u9053\u641C\u7D22\uFF08\u5B98\u65B9/\u4E2D\u6587\u641C\u7D22\uFF09",
          "\u4E00\u952E\u52A0\u5165\u76EE\u6807\u7FA4\u7EC4",
          "\u6536\u85CF\u548C\u7BA1\u7406\u641C\u7D22\u7ED3\u679C"
        ],
        actionLabel: "\u53BB\u641C\u7D22\u53D1\u73B0",
        actionTarget: "search-discovery"
      },
      {
        id: "ai-marketing",
        title: "\u7B2C\u4E09\u6B65\uFF1AAI \u667A\u80FD\u8425\u9500",
        description: "\u8BA9 AI \u5E2E\u60A8\u5236\u5B9A\u8425\u9500\u7B56\u7565\uFF0C\u81EA\u52A8\u6267\u884C\u8425\u9500\u4EFB\u52A1",
        icon: "\u{1F916}",
        targetSelector: '[data-tour="ai-assistant"]',
        position: "right",
        tips: [
          "AI \u4E00\u952E\u751F\u6210\u8425\u9500\u7B56\u7565",
          "\u81EA\u52A8\u5316\u6267\u884C\u548C\u8DDF\u8FDB",
          "\u6570\u636E\u5206\u6790\u548C\u6548\u679C\u8FFD\u8E2A"
        ],
        actionLabel: "\u4F53\u9A8C AI \u8425\u9500",
        actionTarget: "ai-assistant"
      },
      {
        id: "complete",
        title: "\u51C6\u5907\u5C31\u7EEA\uFF01",
        description: "\u60A8\u5DF2\u4E86\u89E3\u6838\u5FC3\u529F\u80FD\uFF0C\u73B0\u5728\u53EF\u4EE5\u5F00\u59CB\u60A8\u7684\u8425\u9500\u4E4B\u65C5\u4E86",
        icon: "\u{1F680}",
        position: "center",
        tips: [
          "\u4EEA\u8868\u76D8\u67E5\u770B\u6574\u4F53\u6570\u636E",
          "\u6709\u95EE\u9898\u968F\u65F6\u70B9\u51FB\u53F3\u4E0A\u89D2 \u2753 \u5E2E\u52A9",
          "\u795D\u60A8\u8425\u9500\u987A\u5229\uFF01"
        ]
      }
    ];
    this.currentStep = computed(() => this.steps[this.currentIndex()], ...ngDevMode ? [{ debugName: "currentStep" }] : []);
  }
  ngOnInit() {
    this.checkFirstRun();
    this.loadNeverShowSetting();
  }
  /**
   * 键盘事件处理
   */
  handleKeydown(event) {
    if (!this.show())
      return;
    switch (event.key) {
      case "Escape":
        this.skipAll();
        break;
      case "ArrowRight":
      case "Enter":
        if (this.currentIndex() < this.steps.length - 1) {
          this.next();
        } else {
          this.complete();
        }
        break;
      case "ArrowLeft":
        this.previous();
        break;
    }
  }
  /**
   * 检查是否首次运行
   */
  checkFirstRun() {
    const hasCompleted = localStorage.getItem(STORAGE_KEY);
    const neverShow = localStorage.getItem(STORAGE_NEVER_SHOW);
    if (neverShow === "true") {
      return;
    }
    if (!hasCompleted) {
      setTimeout(() => this.show.set(true), 800);
    }
  }
  /**
   * 加载"以后不再提示"设置
   */
  loadNeverShowSetting() {
    const neverShow = localStorage.getItem(STORAGE_NEVER_SHOW);
    this.neverShowAgain.set(neverShow === "true");
  }
  /**
   * 切换"以后不再提示"
   */
  toggleNeverShow() {
    const newValue = !this.neverShowAgain();
    this.neverShowAgain.set(newValue);
    localStorage.setItem(STORAGE_NEVER_SHOW, String(newValue));
  }
  /**
   * 手动打开引导
   */
  open() {
    this.currentIndex.set(0);
    this.show.set(true);
    this.updateHighlight();
  }
  /**
   * 关闭引导
   */
  close() {
    this.show.set(false);
    this.highlightRect.set(null);
  }
  /**
   * 下一步
   */
  next() {
    if (this.currentIndex() < this.steps.length - 1) {
      this.currentIndex.update((i) => i + 1);
      this.updateHighlight();
    }
  }
  /**
   * 上一步
   */
  previous() {
    if (this.currentIndex() > 0) {
      this.currentIndex.update((i) => i - 1);
      this.updateHighlight();
    }
  }
  /**
   * 跳转到指定步骤
   */
  goToStep(index) {
    if (index >= 0 && index < this.steps.length) {
      this.currentIndex.set(index);
      this.updateHighlight();
    }
  }
  /**
   * 跳过全部引导
   */
  skipAll() {
    this.markAsCompleted();
    this.close();
  }
  /**
   * 完成引导
   */
  complete() {
    this.markAsCompleted();
    this.close();
  }
  /**
   * 标记为已完成
   */
  markAsCompleted() {
    localStorage.setItem(STORAGE_KEY, (/* @__PURE__ */ new Date()).toISOString());
    if (this.neverShowAgain()) {
      localStorage.setItem(STORAGE_NEVER_SHOW, "true");
    }
  }
  /**
   * 处理快捷操作
   */
  handleAction(target) {
    this.navigateEvent.emit(target);
    this.next();
  }
  /**
   * 点击背景关闭（可选）
   */
  onBackdropClick(event) {
  }
  /**
   * 更新高亮元素位置
   */
  updateHighlight() {
    const step = this.currentStep();
    if (step?.targetSelector) {
      setTimeout(() => {
        const element = document.querySelector(step.targetSelector);
        if (element) {
          this.highlightRect.set(element.getBoundingClientRect());
          element.scrollIntoView({ behavior: "smooth", block: "center" });
        } else {
          this.highlightRect.set(null);
        }
      }, 100);
    } else {
      this.highlightRect.set(null);
    }
  }
  /**
   * 重置引导（用于测试或从帮助按钮重新打开）
   */
  reset() {
    localStorage.removeItem(STORAGE_KEY);
    localStorage.removeItem(STORAGE_NEVER_SHOW);
    this.neverShowAgain.set(false);
    this.currentIndex.set(0);
  }
  /**
   * 检查是否需要显示引导
   */
  shouldShowOnboarding() {
    const neverShow = localStorage.getItem(STORAGE_NEVER_SHOW);
    return neverShow !== "true";
  }
  static {
    this.\u0275fac = function OnboardingComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _OnboardingComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _OnboardingComponent, selectors: [["app-onboarding"]], hostBindings: function OnboardingComponent_HostBindings(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275listener("keydown", function OnboardingComponent_keydown_HostBindingHandler($event) {
          return ctx.handleKeydown($event);
        }, \u0275\u0275resolveWindow);
      }
    }, outputs: { navigateEvent: "navigateEvent" }, decls: 1, vars: 1, consts: [[1, "fixed", "inset-0", "z-[10000]", "flex", "items-center", "justify-center"], [1, "fixed", "inset-0", "z-[10000]", "flex", "items-center", "justify-center", 3, "click"], [1, "absolute", "inset-0", "bg-black/80", "backdrop-blur-sm"], [1, "absolute", "border-2", "border-cyan-400", "rounded-xl", "shadow-[0_0_20px_rgba(34,211,238,0.5)]", "animate-pulse", "pointer-events-none", 3, "left", "top", "width", "height"], [1, "relative", "w-full", "max-w-lg", "mx-4", "sm:mx-auto", "bg-gradient-to-br", "from-slate-900", "via-slate-800", "to-slate-900", "rounded-2xl", "sm:rounded-3xl", "shadow-2xl", "border", "border-slate-600/50", "overflow-hidden", 3, "click"], [1, "px-4", "sm:px-6", "pt-4", "sm:pt-5"], [1, "flex", "items-center", "gap-1.5", "sm:gap-2"], [1, "flex-1", "h-1", "sm:h-1.5", "rounded-full", "transition-all", "duration-300", "cursor-pointer", 3, "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "bg-slate-700"], [1, "flex", "justify-between", "items-center", "mt-2", "text-xs", "text-slate-500"], [1, "hover:text-slate-300", "transition-colors", "px-2", "py-1", "-mr-2", 3, "click"], [1, "p-4", "sm:p-6"], [1, "text-center"], [1, "px-4", "sm:px-6", "pb-4", "sm:pb-5"], [1, "flex", "items-center", "justify-center", "mb-4"], [1, "flex", "items-center", "gap-2", "cursor-pointer", "text-sm", "text-slate-500", "hover:text-slate-400", "transition-colors"], ["type", "checkbox", 1, "w-4", "h-4", "rounded", "border-slate-600", "bg-slate-700", "text-cyan-500", "focus:ring-cyan-500/50", 3, "change", "checked"], [1, "flex", "justify-between", "gap-3"], [1, "flex-1", "px-4", "py-2.5", "sm:py-3", "bg-slate-700/80", "text-slate-300", "rounded-xl", "hover:bg-slate-600", "transition-colors", "disabled:opacity-40", "disabled:cursor-not-allowed", "text-sm", "sm:text-base", 3, "click", "disabled"], [1, "flex-1", "px-4", "py-2.5", "sm:py-3", "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "text-white", "rounded-xl", "font-medium", "hover:from-cyan-600", "hover:to-blue-600", "transition-all", "text-sm", "sm:text-base", "shadow-lg", "shadow-cyan-500/25"], [1, "flex-1", "px-4", "py-2.5", "sm:py-3", "bg-gradient-to-r", "from-green-500", "to-emerald-500", "text-white", "rounded-xl", "font-medium", "hover:from-green-600", "hover:to-emerald-600", "transition-all", "text-sm", "sm:text-base", "shadow-lg", "shadow-green-500/25"], [1, "hidden", "sm:block", "px-6", "pb-4", "text-center", "text-xs", "text-slate-600"], [1, "px-1.5", "py-0.5", "bg-slate-700", "rounded", "text-slate-400"], [1, "absolute", "border-2", "border-cyan-400", "rounded-xl", "shadow-[0_0_20px_rgba(34,211,238,0.5)]", "animate-pulse", "pointer-events-none"], [1, "flex-1", "h-1", "sm:h-1.5", "rounded-full", "transition-all", "duration-300", "cursor-pointer", 3, "click"], [1, "text-5xl", "sm:text-6xl", "mb-4", "sm:mb-5", "animate-bounce-slow"], [1, "text-xl", "sm:text-2xl", "font-bold", "text-white", "mb-2", "sm:mb-3"], [1, "text-slate-300", "text-sm", "sm:text-base", "mb-4", "sm:mb-5", "max-w-sm", "mx-auto", "leading-relaxed"], [1, "bg-slate-800/60", "rounded-xl", "p-3", "sm:p-4", "mb-4", "sm:mb-5", "text-left", "max-w-sm", "mx-auto", "border", "border-slate-700/50"], [1, "mb-3", "px-5", "py-2.5", "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "text-white", "rounded-xl", "text-sm", "font-medium", "hover:from-cyan-600", "hover:to-blue-600", "transition-all", "shadow-lg", "shadow-cyan-500/25"], [1, "space-y-2"], [1, "flex", "items-start", "gap-2", "text-slate-400", "text-sm"], [1, "text-cyan-400", "mt-0.5", "flex-shrink-0"], [1, "mb-3", "px-5", "py-2.5", "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "text-white", "rounded-xl", "text-sm", "font-medium", "hover:from-cyan-600", "hover:to-blue-600", "transition-all", "shadow-lg", "shadow-cyan-500/25", 3, "click"], [1, "flex-1", "px-4", "py-2.5", "sm:py-3", "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "text-white", "rounded-xl", "font-medium", "hover:from-cyan-600", "hover:to-blue-600", "transition-all", "text-sm", "sm:text-base", "shadow-lg", "shadow-cyan-500/25", 3, "click"], [1, "flex-1", "px-4", "py-2.5", "sm:py-3", "bg-gradient-to-r", "from-green-500", "to-emerald-500", "text-white", "rounded-xl", "font-medium", "hover:from-green-600", "hover:to-emerald-600", "transition-all", "text-sm", "sm:text-base", "shadow-lg", "shadow-green-500/25", 3, "click"]], template: function OnboardingComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, OnboardingComponent_Conditional_0_Template, 36, 7, "div", 0);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.show() ? 0 : -1);
      }
    }, dependencies: [CommonModule, FormsModule], styles: ["\n\n@keyframes _ngcontent-%COMP%_bounce-slow {\n  0%, 100% {\n    transform: translateY(0);\n  }\n  50% {\n    transform: translateY(-8px);\n  }\n}\n.animate-bounce-slow[_ngcontent-%COMP%] {\n  animation: _ngcontent-%COMP%_bounce-slow 2s ease-in-out infinite;\n}\n/*# sourceMappingURL=onboarding.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(OnboardingComponent, [{
    type: Component,
    args: [{ selector: "app-onboarding", standalone: true, imports: [CommonModule, FormsModule], template: `
    @if (show()) {
      <div class="fixed inset-0 z-[10000] flex items-center justify-center"
           (click)="onBackdropClick($event)">
        <!-- \u80CC\u666F\u906E\u7F69 -->
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
        
        <!-- \u9AD8\u4EAE\u5143\u7D20\uFF08\u5982\u679C\u6709\uFF09 -->
        @if (currentStep()?.targetSelector && highlightRect()) {
          <div class="absolute border-2 border-cyan-400 rounded-xl shadow-[0_0_20px_rgba(34,211,238,0.5)] animate-pulse pointer-events-none"
               [style.left.px]="highlightRect()!.left - 8"
               [style.top.px]="highlightRect()!.top - 8"
               [style.width.px]="highlightRect()!.width + 16"
               [style.height.px]="highlightRect()!.height + 16">
          </div>
        }
        
        <!-- \u5F15\u5BFC\u5361\u7247 - \u79FB\u52A8\u7AEF\u9002\u914D -->
        <div class="relative w-full max-w-lg mx-4 sm:mx-auto bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-2xl sm:rounded-3xl shadow-2xl border border-slate-600/50 overflow-hidden"
             (click)="$event.stopPropagation()">
          
          <!-- \u9876\u90E8\u8FDB\u5EA6\u6761 -->
          <div class="px-4 sm:px-6 pt-4 sm:pt-5">
            <div class="flex items-center gap-1.5 sm:gap-2">
              @for (step of steps; track step.id; let i = $index) {
                <div class="flex-1 h-1 sm:h-1.5 rounded-full transition-all duration-300 cursor-pointer"
                     [class.bg-gradient-to-r]="i <= currentIndex()"
                     [class.from-cyan-500]="i <= currentIndex()"
                     [class.to-blue-500]="i <= currentIndex()"
                     [class.bg-slate-700]="i > currentIndex()"
                     (click)="goToStep(i)">
                </div>
              }
            </div>
            <div class="flex justify-between items-center mt-2 text-xs text-slate-500">
              <span>\u6B65\u9AA4 {{ currentIndex() + 1 }} / {{ steps.length }}</span>
              <button (click)="skipAll()" 
                      class="hover:text-slate-300 transition-colors px-2 py-1 -mr-2">
                \u8DF3\u8FC7\u5F15\u5BFC
              </button>
            </div>
          </div>
          
          <!-- \u5185\u5BB9\u533A - \u79FB\u52A8\u7AEF\u4F18\u5316\u95F4\u8DDD -->
          <div class="p-4 sm:p-6">
            @if (currentStep(); as step) {
              <div class="text-center">
                <!-- \u56FE\u6807 -->
                <div class="text-5xl sm:text-6xl mb-4 sm:mb-5 animate-bounce-slow">
                  {{ step.icon }}
                </div>
                
                <!-- \u6807\u9898 -->
                <h2 class="text-xl sm:text-2xl font-bold text-white mb-2 sm:mb-3">
                  {{ step.title }}
                </h2>
                
                <!-- \u63CF\u8FF0 -->
                <p class="text-slate-300 text-sm sm:text-base mb-4 sm:mb-5 max-w-sm mx-auto leading-relaxed">
                  {{ step.description }}
                </p>
                
                <!-- \u63D0\u793A\u5217\u8868 -->
                @if (step.tips && step.tips.length > 0) {
                  <div class="bg-slate-800/60 rounded-xl p-3 sm:p-4 mb-4 sm:mb-5 text-left max-w-sm mx-auto border border-slate-700/50">
                    <ul class="space-y-2">
                      @for (tip of step.tips; track tip) {
                        <li class="flex items-start gap-2 text-slate-400 text-sm">
                          <span class="text-cyan-400 mt-0.5 flex-shrink-0">\u2713</span>
                          <span>{{ tip }}</span>
                        </li>
                      }
                    </ul>
                  </div>
                }
                
                <!-- \u5FEB\u6377\u64CD\u4F5C\u6309\u94AE -->
                @if (step.actionLabel && step.actionTarget) {
                  <button (click)="handleAction(step.actionTarget)"
                          class="mb-3 px-5 py-2.5 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl text-sm font-medium hover:from-cyan-600 hover:to-blue-600 transition-all shadow-lg shadow-cyan-500/25">
                    {{ step.actionLabel }} \u2192
                  </button>
                }
              </div>
            }
          </div>
          
          <!-- \u5E95\u90E8\u5BFC\u822A -->
          <div class="px-4 sm:px-6 pb-4 sm:pb-5">
            <!-- \u4EE5\u540E\u4E0D\u518D\u63D0\u793A -->
            <div class="flex items-center justify-center mb-4">
              <label class="flex items-center gap-2 cursor-pointer text-sm text-slate-500 hover:text-slate-400 transition-colors">
                <input type="checkbox" 
                       [checked]="neverShowAgain()"
                       (change)="toggleNeverShow()"
                       class="w-4 h-4 rounded border-slate-600 bg-slate-700 text-cyan-500 focus:ring-cyan-500/50">
                <span>\u4EE5\u540E\u4E0D\u518D\u63D0\u793A</span>
              </label>
            </div>
            
            <!-- \u5BFC\u822A\u6309\u94AE -->
            <div class="flex justify-between gap-3">
              <button (click)="previous()"
                      [disabled]="currentIndex() === 0"
                      class="flex-1 px-4 py-2.5 sm:py-3 bg-slate-700/80 text-slate-300 rounded-xl hover:bg-slate-600 transition-colors disabled:opacity-40 disabled:cursor-not-allowed text-sm sm:text-base">
                \u2190 \u4E0A\u4E00\u6B65
              </button>
              
              @if (currentIndex() < steps.length - 1) {
                <button (click)="next()"
                        class="flex-1 px-4 py-2.5 sm:py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:from-cyan-600 hover:to-blue-600 transition-all text-sm sm:text-base shadow-lg shadow-cyan-500/25">
                  \u4E0B\u4E00\u6B65 \u2192
                </button>
              } @else {
                <button (click)="complete()"
                        class="flex-1 px-4 py-2.5 sm:py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl font-medium hover:from-green-600 hover:to-emerald-600 transition-all text-sm sm:text-base shadow-lg shadow-green-500/25">
                  \u5F00\u59CB\u4F7F\u7528 \u{1F680}
                </button>
              }
            </div>
          </div>
          
          <!-- \u952E\u76D8\u5FEB\u6377\u952E\u63D0\u793A - \u4EC5\u684C\u9762\u7AEF\u663E\u793A -->
          <div class="hidden sm:block px-6 pb-4 text-center text-xs text-slate-600">
            \u6309 <kbd class="px-1.5 py-0.5 bg-slate-700 rounded text-slate-400">\u2190</kbd> 
            <kbd class="px-1.5 py-0.5 bg-slate-700 rounded text-slate-400">\u2192</kbd> \u5BFC\u822A \xB7 
            <kbd class="px-1.5 py-0.5 bg-slate-700 rounded text-slate-400">ESC</kbd> \u5173\u95ED
          </div>
        </div>
      </div>
    }
  `, styles: ["/* angular:styles/component:css;9696bea4aad6db1554403469d0f9f92bad766e4d576fd736536d2e08ba05fb81;D:/tgkz2026/src/onboarding.component.ts */\n@keyframes bounce-slow {\n  0%, 100% {\n    transform: translateY(0);\n  }\n  50% {\n    transform: translateY(-8px);\n  }\n}\n.animate-bounce-slow {\n  animation: bounce-slow 2s ease-in-out infinite;\n}\n/*# sourceMappingURL=onboarding.component.css.map */\n"] }]
  }], null, { navigateEvent: [{ type: Output, args: ["navigateEvent"] }], handleKeydown: [{
    type: HostListener,
    args: ["window:keydown", ["$event"]]
  }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(OnboardingComponent, { className: "OnboardingComponent", filePath: "src/onboarding.component.ts", lineNumber: 176 });
})();
var FeatureHighlightComponent = class _FeatureHighlightComponent {
  constructor() {
    this.show = signal(false, ...ngDevMode ? [{ debugName: "show" }] : []);
    this.title = "";
    this.description = "";
    this.position = { top: 0, left: 0 };
  }
  highlight(element, title, description) {
    const rect = element.getBoundingClientRect();
    this.position = {
      top: rect.top,
      left: rect.left
    };
    this.title = title;
    this.description = description;
    this.show.set(true);
  }
  dismiss() {
    this.show.set(false);
  }
  static {
    this.\u0275fac = function FeatureHighlightComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _FeatureHighlightComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _FeatureHighlightComponent, selectors: [["app-feature-highlight"]], decls: 1, vars: 1, consts: [[1, "fixed", "z-[9998]", 3, "top", "left"], [1, "fixed", "z-[9998]"], [1, "absolute", "-inset-2", "bg-cyan-500/20", "rounded-xl", "animate-pulse"], [1, "absolute", "top-full", "left-1/2", "-translate-x-1/2", "mt-4", "w-64", "bg-slate-800", "rounded-xl", "shadow-xl", "border", "border-slate-600", "p-4", "z-10"], [1, "absolute", "-top-2", "left-1/2", "-translate-x-1/2", "w-4", "h-4", "bg-slate-800", "border-l", "border-t", "border-slate-600", "rotate-45"], [1, "font-bold", "text-white", "mb-2"], [1, "text-sm", "text-slate-400", "mb-3"], [1, "text-sm", "text-cyan-400", "hover:underline", 3, "click"]], template: function FeatureHighlightComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, FeatureHighlightComponent_Conditional_0_Template, 10, 6, "div", 0);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.show() ? 0 : -1);
      }
    }, dependencies: [CommonModule], encapsulation: 2 });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(FeatureHighlightComponent, [{
    type: Component,
    args: [{
      selector: "app-feature-highlight",
      standalone: true,
      imports: [CommonModule],
      template: `
    @if(show()) {
      <div class="fixed z-[9998]" [style.top.px]="position.top" [style.left.px]="position.left">
        <!-- \u9AD8\u4EAE\u906E\u7F69 -->
        <div class="absolute -inset-2 bg-cyan-500/20 rounded-xl animate-pulse"></div>
        
        <!-- \u63D0\u793A\u6846 -->
        <div class="absolute top-full left-1/2 -translate-x-1/2 mt-4 w-64 bg-slate-800 rounded-xl shadow-xl border border-slate-600 p-4 z-10">
          <div class="absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-slate-800 border-l border-t border-slate-600 rotate-45"></div>
          <h4 class="font-bold text-white mb-2">{{ title }}</h4>
          <p class="text-sm text-slate-400 mb-3">{{ description }}</p>
          <button (click)="dismiss()" class="text-sm text-cyan-400 hover:underline">\u77E5\u9053\u4E86</button>
        </div>
      </div>
    }
  `
    }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(FeatureHighlightComponent, { className: "FeatureHighlightComponent", filePath: "src/onboarding.component.ts", lineNumber: 483 });
})();

// src/language-switcher.component.ts
var _forTrack05 = ($index, $item) => $item.code;
function LanguageSwitcherCompactComponent_Conditional_8_For_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 7);
    \u0275\u0275domListener("click", function LanguageSwitcherCompactComponent_Conditional_8_For_2_Template_div_click_0_listener() {
      const locale_r2 = \u0275\u0275restoreView(_r1).$implicit;
      const ctx_r2 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r2.selectLocale(locale_r2.code));
    });
    \u0275\u0275domElementStart(1, "span", 2);
    \u0275\u0275text(2);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(3, "span", 8);
    \u0275\u0275text(4);
    \u0275\u0275domElementEnd()();
  }
  if (rf & 2) {
    const locale_r2 = ctx.$implicit;
    const ctx_r2 = \u0275\u0275nextContext(2);
    \u0275\u0275classProp("active", locale_r2.code === ctx_r2.i18n.locale());
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(locale_r2.flag);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(locale_r2.nativeName);
  }
}
function LanguageSwitcherCompactComponent_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 5);
    \u0275\u0275repeaterCreate(1, LanguageSwitcherCompactComponent_Conditional_8_For_2_Template, 5, 4, "div", 6, _forTrack05);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const ctx_r2 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r2.locales);
  }
}
var LanguageSwitcherCompactComponent = class _LanguageSwitcherCompactComponent {
  constructor() {
    this.i18n = inject(I18nService);
    this.locales = SUPPORTED_LOCALES;
    this.isOpen = false;
  }
  toggleDropdown() {
    this.isOpen = !this.isOpen;
  }
  selectLocale(code) {
    this.i18n.setLocale(code);
    this.isOpen = false;
  }
  static {
    this.\u0275fac = function LanguageSwitcherCompactComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _LanguageSwitcherCompactComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _LanguageSwitcherCompactComponent, selectors: [["app-language-switcher-compact"]], decls: 9, vars: 5, consts: [[1, "language-switcher"], [1, "current-language", 3, "click"], [1, "flag"], [1, "lang-name"], [1, "arrow"], [1, "dropdown"], [1, "option", 3, "active"], [1, "option", 3, "click"], [1, "name"]], template: function LanguageSwitcherCompactComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275domElementStart(0, "div", 0)(1, "div", 1);
        \u0275\u0275domListener("click", function LanguageSwitcherCompactComponent_Template_div_click_1_listener() {
          return ctx.toggleDropdown();
        });
        \u0275\u0275domElementStart(2, "span", 2);
        \u0275\u0275text(3);
        \u0275\u0275domElementEnd();
        \u0275\u0275domElementStart(4, "span", 3);
        \u0275\u0275text(5);
        \u0275\u0275domElementEnd();
        \u0275\u0275domElementStart(6, "span", 4);
        \u0275\u0275text(7, "\u25BC");
        \u0275\u0275domElementEnd()();
        \u0275\u0275conditionalCreate(8, LanguageSwitcherCompactComponent_Conditional_8_Template, 3, 0, "div", 5);
        \u0275\u0275domElementEnd();
      }
      if (rf & 2) {
        \u0275\u0275advance(3);
        \u0275\u0275textInterpolate(ctx.i18n.currentLocaleInfo().flag);
        \u0275\u0275advance(2);
        \u0275\u0275textInterpolate(ctx.i18n.currentLocaleInfo().nativeName);
        \u0275\u0275advance();
        \u0275\u0275classProp("open", ctx.isOpen);
        \u0275\u0275advance(2);
        \u0275\u0275conditional(ctx.isOpen ? 8 : -1);
      }
    }, dependencies: [CommonModule], styles: ["\n\n.language-switcher[_ngcontent-%COMP%] {\n  position: relative;\n  display: inline-block;\n}\n.current-language[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  background: var(--card-bg, #1e1e2e);\n  border: 1px solid var(--border-color, #333);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.current-language[_ngcontent-%COMP%]:hover {\n  background: var(--hover-bg, #2a2a3a);\n}\n.flag[_ngcontent-%COMP%] {\n  font-size: 18px;\n}\n.lang-name[_ngcontent-%COMP%] {\n  font-size: 14px;\n  color: var(--text-color, #fff);\n}\n.arrow[_ngcontent-%COMP%] {\n  font-size: 10px;\n  color: var(--text-muted, #888);\n  transition: transform 0.2s ease;\n}\n.arrow.open[_ngcontent-%COMP%] {\n  transform: rotate(180deg);\n}\n.dropdown[_ngcontent-%COMP%] {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  margin-top: 4px;\n  background: var(--card-bg, #1e1e2e);\n  border: 1px solid var(--border-color, #333);\n  border-radius: 8px;\n  overflow: hidden;\n  z-index: 100;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n.option[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 12px;\n  cursor: pointer;\n  transition: background 0.2s ease;\n}\n.option[_ngcontent-%COMP%]:hover {\n  background: var(--hover-bg, #2a2a3a);\n}\n.option.active[_ngcontent-%COMP%] {\n  background: var(--primary-color, #7c3aed);\n}\n.option[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%] {\n  font-size: 14px;\n  color: var(--text-color, #fff);\n}\n/*# sourceMappingURL=language-switcher.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(LanguageSwitcherCompactComponent, [{
    type: Component,
    args: [{ selector: "app-language-switcher-compact", standalone: true, imports: [CommonModule], template: `
    <div class="language-switcher">
      <div class="current-language" (click)="toggleDropdown()">
        <span class="flag">{{ i18n.currentLocaleInfo().flag }}</span>
        <span class="lang-name">{{ i18n.currentLocaleInfo().nativeName }}</span>
        <span class="arrow" [class.open]="isOpen">\u25BC</span>
      </div>
      
      @if (isOpen) {
        <div class="dropdown">
          @for (locale of locales; track locale.code) {
            <div 
              class="option"
              [class.active]="locale.code === i18n.locale()"
              (click)="selectLocale(locale.code)">
              <span class="flag">{{ locale.flag }}</span>
              <span class="name">{{ locale.nativeName }}</span>
            </div>
          }
        </div>
      }
    </div>
  `, styles: ["/* angular:styles/component:css;b7c8d3eb6e72fb52096f2e214704817752643817ccfc2a17d3cf381aa571ca3e;D:/tgkz2026/src/language-switcher.component.ts */\n.language-switcher {\n  position: relative;\n  display: inline-block;\n}\n.current-language {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  background: var(--card-bg, #1e1e2e);\n  border: 1px solid var(--border-color, #333);\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n.current-language:hover {\n  background: var(--hover-bg, #2a2a3a);\n}\n.flag {\n  font-size: 18px;\n}\n.lang-name {\n  font-size: 14px;\n  color: var(--text-color, #fff);\n}\n.arrow {\n  font-size: 10px;\n  color: var(--text-muted, #888);\n  transition: transform 0.2s ease;\n}\n.arrow.open {\n  transform: rotate(180deg);\n}\n.dropdown {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  margin-top: 4px;\n  background: var(--card-bg, #1e1e2e);\n  border: 1px solid var(--border-color, #333);\n  border-radius: 8px;\n  overflow: hidden;\n  z-index: 100;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n.option {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 12px;\n  cursor: pointer;\n  transition: background 0.2s ease;\n}\n.option:hover {\n  background: var(--hover-bg, #2a2a3a);\n}\n.option.active {\n  background: var(--primary-color, #7c3aed);\n}\n.option .name {\n  font-size: 14px;\n  color: var(--text-color, #fff);\n}\n/*# sourceMappingURL=language-switcher.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(LanguageSwitcherCompactComponent, { className: "LanguageSwitcherCompactComponent", filePath: "src/language-switcher.component.ts", lineNumber: 114 });
})();

// src/device.service.ts
var DeviceService = class _DeviceService {
  constructor() {
    this._deviceCode = signal(null, ...ngDevMode ? [{ debugName: "_deviceCode" }] : []);
    this._deviceDetails = signal(null, ...ngDevMode ? [{ debugName: "_deviceDetails" }] : []);
    this.deviceCode = computed(() => this._deviceCode(), ...ngDevMode ? [{ debugName: "deviceCode" }] : []);
    this.deviceDetails = computed(() => this._deviceDetails(), ...ngDevMode ? [{ debugName: "deviceDetails" }] : []);
    this.initDeviceInfo();
  }
  /**
   * 初始化設備信息
   */
  async initDeviceInfo() {
    try {
      const details = await this.collectDeviceDetails();
      this._deviceDetails.set(details);
      const code = await this.generateDeviceCode(details);
      this._deviceCode.set(code);
    } catch (error) {
      console.error("\u521D\u59CB\u5316\u8A2D\u5099\u4FE1\u606F\u5931\u6557:", error);
      this._deviceCode.set(this.generateFallbackDeviceCode());
    }
  }
  /**
   * 獲取設備碼
   */
  async getDeviceCode() {
    if (this._deviceCode()) {
      return this._deviceCode();
    }
    await new Promise((resolve) => {
      const checkInterval = setInterval(() => {
        if (this._deviceCode()) {
          clearInterval(checkInterval);
          resolve();
        }
      }, 100);
      setTimeout(() => {
        clearInterval(checkInterval);
        if (!this._deviceCode()) {
          this._deviceCode.set(this.generateFallbackDeviceCode());
        }
        resolve();
      }, 3e3);
    });
    return this._deviceCode();
  }
  /**
   * 收集設備詳情
   */
  async collectDeviceDetails() {
    const isElectron = typeof window !== "undefined" && window.electronAPI !== void 0;
    if (isElectron) {
      try {
        const systemInfo = await window.electronAPI.invoke("get-system-info");
        if (systemInfo) {
          return {
            platform: systemInfo.platform || "unknown",
            arch: systemInfo.arch || "unknown",
            hostname: systemInfo.hostname || "unknown",
            cpuModel: systemInfo.cpuModel || "unknown",
            cpuCores: systemInfo.cpuCores || 1,
            totalMemory: systemInfo.totalMemory || 0,
            osType: systemInfo.osType || "unknown",
            osVersion: systemInfo.osVersion || "unknown",
            username: systemInfo.username || "unknown",
            screenResolution: `${window.screen.width}x${window.screen.height}`,
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
            language: navigator.language
          };
        }
      } catch (error) {
        console.warn("\u7121\u6CD5\u5F9E Electron \u7372\u53D6\u7CFB\u7D71\u4FE1\u606F:", error);
      }
    }
    return {
      platform: navigator.platform || "web",
      arch: this.detectArch(),
      hostname: "browser",
      cpuModel: "unknown",
      cpuCores: navigator.hardwareConcurrency || 1,
      totalMemory: navigator.deviceMemory || 0,
      osType: this.detectOS(),
      osVersion: "unknown",
      username: "webuser",
      screenResolution: `${window.screen.width}x${window.screen.height}`,
      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
      language: navigator.language
    };
  }
  /**
   * 生成設備碼
   */
  async generateDeviceCode(details) {
    const fingerprint = [
      details.platform,
      details.arch,
      details.hostname,
      details.cpuCores.toString(),
      details.totalMemory.toString(),
      details.osType,
      details.screenResolution,
      details.timezone,
      details.language,
      // 添加一些瀏覽器指紋
      this.getCanvasFingerprint(),
      this.getWebGLFingerprint()
    ].join("|");
    const hash = await this.sha256(fingerprint);
    const shortHash = hash.substr(0, 16).toUpperCase();
    return `TGM-${shortHash.substr(0, 4)}-${shortHash.substr(4, 4)}-${shortHash.substr(8, 4)}-${shortHash.substr(12, 4)}`;
  }
  /**
   * 生成備用設備碼（當無法獲取完整設備信息時）
   */
  generateFallbackDeviceCode() {
    const saved = localStorage.getItem("tgm_device_code");
    if (saved) {
      return saved;
    }
    const random = Math.random().toString(36).substr(2, 16).toUpperCase();
    const code = `TGM-${random.substr(0, 4)}-${random.substr(4, 4)}-${random.substr(8, 4)}-${random.substr(12, 4)}`;
    localStorage.setItem("tgm_device_code", code);
    return code;
  }
  /**
   * SHA-256 哈希
   */
  async sha256(message) {
    if (typeof crypto !== "undefined" && crypto.subtle) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest("SHA-256", msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map((b) => b.toString(16).padStart(2, "0")).join("");
    }
    return this.simpleHash(message);
  }
  /**
   * 簡單哈希（備用）
   */
  simpleHash(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
      const char = str.charCodeAt(i);
      hash = (hash << 5) - hash + char;
      hash = hash & hash;
    }
    return Math.abs(hash).toString(16).padStart(16, "0");
  }
  /**
   * 檢測操作系統
   */
  detectOS() {
    const userAgent = navigator.userAgent;
    if (userAgent.indexOf("Win") !== -1)
      return "Windows";
    if (userAgent.indexOf("Mac") !== -1)
      return "macOS";
    if (userAgent.indexOf("Linux") !== -1)
      return "Linux";
    if (userAgent.indexOf("Android") !== -1)
      return "Android";
    if (userAgent.indexOf("iOS") !== -1)
      return "iOS";
    return "Unknown";
  }
  /**
   * 檢測架構
   */
  detectArch() {
    const platform = navigator.platform;
    if (platform.indexOf("64") !== -1)
      return "x64";
    if (platform.indexOf("ARM") !== -1)
      return "arm";
    return "x86";
  }
  /**
   * Canvas 指紋
   */
  getCanvasFingerprint() {
    try {
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");
      if (!ctx)
        return "no-canvas";
      canvas.width = 200;
      canvas.height = 50;
      ctx.textBaseline = "top";
      ctx.font = "14px Arial";
      ctx.fillStyle = "#f60";
      ctx.fillRect(125, 1, 62, 20);
      ctx.fillStyle = "#069";
      ctx.fillText("TG-AI\u667A\u63A7\u738B", 2, 15);
      ctx.fillStyle = "rgba(102, 204, 0, 0.7)";
      ctx.fillText("fingerprint", 4, 17);
      return canvas.toDataURL().substr(-50);
    } catch {
      return "canvas-error";
    }
  }
  /**
   * WebGL 指紋
   */
  getWebGLFingerprint() {
    try {
      const canvas = document.createElement("canvas");
      const gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
      if (!gl)
        return "no-webgl";
      const debugInfo = gl.getExtension("WEBGL_debug_renderer_info");
      if (debugInfo) {
        const vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
        const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
        return `${vendor}|${renderer}`.substr(0, 50);
      }
      return "webgl-no-debug";
    } catch {
      return "webgl-error";
    }
  }
  /**
   * 獲取設備名稱（友好顯示）
   */
  getDeviceName() {
    const details = this._deviceDetails();
    if (!details) {
      return "\u672A\u77E5\u8A2D\u5099";
    }
    const os = details.osType;
    const platform = details.platform;
    if (os === "Windows") {
      return `Windows PC (${details.cpuCores} \u6838\u5FC3)`;
    } else if (os === "macOS") {
      return `Mac (${details.cpuCores} \u6838\u5FC3)`;
    } else if (os === "Linux") {
      return `Linux (${details.hostname})`;
    }
    return `${platform} \u8A2D\u5099`;
  }
  /**
   * 獲取設備簡短 ID（用於顯示）
   */
  getShortDeviceId() {
    const code = this._deviceCode();
    if (!code)
      return "...";
    return code.substr(4, 9);
  }
  static {
    this.\u0275fac = function DeviceService_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _DeviceService)();
    };
  }
  static {
    this.\u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({ token: _DeviceService, factory: _DeviceService.\u0275fac, providedIn: "root" });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(DeviceService, [{
    type: Injectable,
    args: [{ providedIn: "root" }]
  }], () => [], null);
})();

// src/auth.service.ts
var AuthService2 = class _AuthService {
  constructor() {
    this.deviceService = inject(DeviceService);
    this.injector = inject(Injector);
    this.licenseClient = inject(LicenseClientService);
    this.router = inject(Router);
    this.authEvents = inject(AuthEventsService);
    this.eventSubscription = null;
    this.SKIP_LOGIN = !!window.electronAPI || !!window.electron;
    this.DEFAULT_USER = {
      id: 1,
      username: "Admin",
      email: "admin@tgai.local",
      membershipLevel: "king",
      // 最高等級：榮耀王者
      membershipExpires: new Date(Date.now() + 365 * 100 * 24 * 60 * 60 * 1e3).toISOString(),
      // 100年後過期
      inviteCode: "ADMIN-VIP",
      invitedCount: 0,
      createdAt: (/* @__PURE__ */ new Date()).toISOString(),
      lastLogin: (/* @__PURE__ */ new Date()).toISOString(),
      status: "active"
    };
    this._isAuthenticated = signal(this.SKIP_LOGIN, ...ngDevMode ? [{ debugName: "_isAuthenticated" }] : []);
    this._user = signal(this.SKIP_LOGIN ? this.DEFAULT_USER : null, ...ngDevMode ? [{ debugName: "_user" }] : []);
    this._token = signal(this.SKIP_LOGIN ? "skip-login-token" : null, ...ngDevMode ? [{ debugName: "_token" }] : []);
    this._isLoading = signal(false, ...ngDevMode ? [{ debugName: "_isLoading" }] : []);
    this._devices = signal([], ...ngDevMode ? [{ debugName: "_devices" }] : []);
    this._usageStats = signal(null, ...ngDevMode ? [{ debugName: "_usageStats" }] : []);
    this.isAuthenticated = computed(() => this._isAuthenticated(), ...ngDevMode ? [{ debugName: "isAuthenticated" }] : []);
    this.user = computed(() => this._user(), ...ngDevMode ? [{ debugName: "user" }] : []);
    this.isLoading = computed(() => this._isLoading(), ...ngDevMode ? [{ debugName: "isLoading" }] : []);
    this.devices = computed(() => this._devices(), ...ngDevMode ? [{ debugName: "devices" }] : []);
    this.usageStats = computed(() => this._usageStats(), ...ngDevMode ? [{ debugName: "usageStats" }] : []);
    this.membershipLevel = computed(() => this._user()?.membershipLevel || "bronze", ...ngDevMode ? [{ debugName: "membershipLevel" }] : []);
    this.isPaid = computed(() => ["silver", "gold", "diamond", "star", "king"].includes(this.membershipLevel()), ...ngDevMode ? [{ debugName: "isPaid" }] : []);
    this.isPremium = computed(() => ["diamond", "star", "king"].includes(this.membershipLevel()), ...ngDevMode ? [{ debugName: "isPremium" }] : []);
    this.isElite = computed(() => ["star", "king"].includes(this.membershipLevel()), ...ngDevMode ? [{ debugName: "isElite" }] : []);
    this.isKing = computed(() => this.membershipLevel() === "king", ...ngDevMode ? [{ debugName: "isKing" }] : []);
    this.membershipExpiresSoon = computed(() => {
      const expires = this._user()?.membershipExpires;
      if (!expires)
        return false;
      const daysLeft = Math.floor((new Date(expires).getTime() - Date.now()) / (1e3 * 60 * 60 * 24));
      return daysLeft <= 7 && daysLeft > 0;
    }, ...ngDevMode ? [{ debugName: "membershipExpiresSoon" }] : []);
    this.membershipDaysLeft = computed(() => {
      const expires = this._user()?.membershipExpires;
      if (!expires)
        return 0;
      return Math.max(0, Math.floor((new Date(expires).getTime() - Date.now()) / (1e3 * 60 * 60 * 24)));
    }, ...ngDevMode ? [{ debugName: "membershipDaysLeft" }] : []);
    if (this.SKIP_LOGIN) {
      console.log("[AuthService] \u514D\u767B\u9304\u6A21\u5F0F\u5DF2\u555F\u7528\uFF0C\u9ED8\u8A8D\u70BA\u738B\u8005\u6703\u54E1");
      return;
    }
    this.eventSubscription = this.authEvents.authEvents$.subscribe((event) => {
      if (event.type === "logout") {
        console.log("[LegacyAuthService] Received logout event, clearing state");
        this.clearLocalAuthInternal();
        this._isAuthenticated.set(false);
        this._user.set(null);
        this._token.set(null);
        this._devices.set([]);
        this._usageStats.set(null);
      } else if (event.type === "login") {
        console.log("[LegacyAuthService] Received login event, syncing state");
        this.syncFromStorage();
      } else if (event.type === "user_update") {
        console.log("[LegacyAuthService] Received user_update event");
        this.syncFromStorage();
      }
    });
    setTimeout(() => {
      this.checkLocalAuth().catch((err) => {
        console.error("\u8A8D\u8B49\u521D\u59CB\u5316\u932F\u8AA4:", err);
        this._isAuthenticated.set(false);
      });
    }, 0);
  }
  ngOnDestroy() {
    this.eventSubscription?.unsubscribe();
  }
  /**
   * 檢查本地存儲的認證狀態
   *
   * 🔧 修復：同時支持新版 (tgm_access_token) 和舊版 (tgm_auth_token) Token 格式
   */
  async checkLocalAuth() {
    try {
      if (typeof localStorage === "undefined") {
        return;
      }
      const storedToken = localStorage.getItem("tgm_access_token") || localStorage.getItem("tgm_auth_token");
      const storedUser = localStorage.getItem("tgm_user");
      if (storedToken && storedUser) {
        try {
          const rawUser = JSON.parse(storedUser);
          const user = {
            id: rawUser.id || 0,
            username: rawUser.username || rawUser.display_name || "User",
            email: rawUser.email || void 0,
            phone: rawUser.phone || void 0,
            avatar: rawUser.avatar_url || rawUser.avatar || void 0,
            // 🔧 從 subscription_tier 轉換到 membershipLevel
            membershipLevel: this.tierToLevel(rawUser.subscription_tier || rawUser.membershipLevel || "free"),
            membershipExpires: rawUser.membershipExpires || rawUser.subscription_expires || void 0,
            inviteCode: rawUser.inviteCode || rawUser.invite_code || "",
            invitedCount: rawUser.invitedCount || rawUser.invited_count || 0,
            createdAt: rawUser.createdAt || rawUser.created_at || (/* @__PURE__ */ new Date()).toISOString(),
            lastLogin: rawUser.lastLogin || rawUser.last_login_at || (/* @__PURE__ */ new Date()).toISOString(),
            status: rawUser.status || (rawUser.is_active ? "active" : "suspended")
          };
          this._token.set(storedToken);
          this._user.set(user);
          this._isAuthenticated.set(true);
          console.log("[AuthService] \u5DF2\u5F9E\u672C\u5730\u5B58\u5132\u6062\u5FA9\u7528\u6236:", user.username);
          this.loadDevices().catch((err) => console.error("\u8F09\u5165\u8A2D\u5099\u5217\u8868\u5931\u6557:", err));
          this.loadUsageStats().catch((err) => console.error("\u8F09\u5165\u4F7F\u7528\u7D71\u8A08\u5931\u6557:", err));
        } catch (parseError) {
          console.error("\u89E3\u6790\u7528\u6236\u6578\u64DA\u5931\u6557:", parseError);
          this.clearLocalAuth();
          this._isAuthenticated.set(false);
        }
      } else {
        this._isAuthenticated.set(false);
      }
    } catch (error) {
      console.error("\u6AA2\u67E5\u672C\u5730\u8A8D\u8B49\u5931\u6557:", error);
      this.clearLocalAuth();
      this._isAuthenticated.set(false);
    }
  }
  /**
   * 🆕 從後端獲取當前用戶信息
   * 用於刷新用戶狀態或驗證 Token 有效性
   */
  async fetchCurrentUser() {
    try {
      const token = this._token() || localStorage.getItem("tgm_access_token");
      if (!token) {
        console.log("[AuthService] fetchCurrentUser: No token available");
        return null;
      }
      const apiBaseUrl = this.getApiBaseUrl();
      console.log("[AuthService] fetchCurrentUser: Fetching from", apiBaseUrl);
      const response = await fetch(`${apiBaseUrl}/api/v1/auth/me`, {
        headers: { "Authorization": `Bearer ${token}` }
      });
      if (!response.ok) {
        console.warn(`[AuthService] fetchCurrentUser: HTTP ${response.status}`);
        return null;
      }
      const result = await response.json();
      if (result.success && result.data) {
        const rawUser = result.data;
        const user = {
          id: rawUser.id || 0,
          username: rawUser.username || rawUser.display_name || "User",
          email: rawUser.email || void 0,
          phone: rawUser.phone || void 0,
          avatar: rawUser.avatar_url || rawUser.avatar || void 0,
          membershipLevel: this.tierToLevel(rawUser.subscription_tier || rawUser.membershipLevel || "free"),
          membershipExpires: rawUser.membershipExpires || rawUser.subscription_expires || void 0,
          inviteCode: rawUser.inviteCode || rawUser.invite_code || "",
          invitedCount: rawUser.invitedCount || rawUser.invited_count || 0,
          createdAt: rawUser.createdAt || rawUser.created_at || (/* @__PURE__ */ new Date()).toISOString(),
          lastLogin: rawUser.lastLogin || rawUser.last_login_at || (/* @__PURE__ */ new Date()).toISOString(),
          status: rawUser.status || (rawUser.is_active ? "active" : "suspended")
        };
        console.log("[AuthService] fetchCurrentUser: Success", user.username);
        this._user.set(user);
        localStorage.setItem("tgm_user", JSON.stringify(result.data));
        return user;
      }
      console.warn("[AuthService] fetchCurrentUser: API returned", result);
      return null;
    } catch (e) {
      console.error("[AuthService] fetchCurrentUser error:", e);
      return null;
    }
  }
  /**
   * 獲取 API 基礎 URL
   */
  getApiBaseUrl() {
    if (typeof window !== "undefined") {
      if (window.location.hostname === "localhost" && window.location.port === "4200") {
        return "http://localhost:8000";
      }
    }
    return "";
  }
  /**
   * 🔧 將 subscription_tier 轉換為 membershipLevel
   */
  tierToLevel(tier) {
    const tierMap = {
      "free": "bronze",
      "basic": "silver",
      "pro": "gold",
      "enterprise": "diamond",
      // 直接映射
      "bronze": "bronze",
      "silver": "silver",
      "gold": "gold",
      "diamond": "diamond",
      "star": "star",
      "king": "king"
    };
    return tierMap[tier] || "bronze";
  }
  /**
   * 帳號密碼登入
   */
  async login(username, password) {
    this._isLoading.set(true);
    try {
      const deviceCode = await this.deviceService.getDeviceCode();
      const response = await this.callAuthApi("/api/auth/login", {
        username,
        password,
        deviceCode
      });
      if (response.success && response.user && response.token) {
        await this.handleLoginSuccess(response.user, response.token);
      }
      return response;
    } catch (error) {
      return {
        success: false,
        message: error.message || "\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"
      };
    } finally {
      this._isLoading.set(false);
    }
  }
  /**
   * 卡密激活（新用戶首次使用）
   */
  async activateLicense(licenseKey, username, password) {
    this._isLoading.set(true);
    try {
      const deviceCode = await this.deviceService.getDeviceCode();
      const response = await this.callAuthApi("/api/auth/activate", {
        licenseKey,
        username,
        password,
        deviceCode
      });
      if (response.success && response.user && response.token) {
        await this.handleLoginSuccess(response.user, response.token);
      }
      return response;
    } catch (error) {
      return {
        success: false,
        message: error.message || "\u6FC0\u6D3B\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u5361\u5BC6\u662F\u5426\u6B63\u78BA"
      };
    } finally {
      this._isLoading.set(false);
    }
  }
  /**
   * 邀請碼註冊
   */
  async registerWithInvite(inviteCode, username, password, email) {
    this._isLoading.set(true);
    try {
      const deviceCode = await this.deviceService.getDeviceCode();
      const response = await this.callAuthApi("/api/auth/register", {
        inviteCode,
        username,
        password,
        email,
        deviceCode
      });
      if (response.success && response.user && response.token) {
        await this.handleLoginSuccess(response.user, response.token);
      }
      return response;
    } catch (error) {
      return {
        success: false,
        message: error.message || "\u8A3B\u518A\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"
      };
    } finally {
      this._isLoading.set(false);
    }
  }
  /**
   * 退出
   */
  async logout() {
    try {
      const token = this._token();
      if (token) {
        await this.callAuthApi("/api/auth/logout", { token });
      }
    } catch (error) {
      console.error("\u9000\u51FA API \u8ABF\u7528\u5931\u6557:", error);
    } finally {
      this.authEvents.emitLogout();
      this.clearLocalAuthInternal();
      this._isAuthenticated.set(false);
      this._user.set(null);
      this._token.set(null);
      this._devices.set([]);
      this._usageStats.set(null);
      this.router.navigate(["/auth/login"]);
    }
  }
  /**
   * 修改密碼
   */
  async changePassword(oldPassword, newPassword) {
    try {
      return await this.callAuthApi("/api/auth/change-password", {
        oldPassword,
        newPassword,
        token: this._token()
      });
    } catch (error) {
      return {
        success: false,
        message: error.message || "\u4FEE\u6539\u5BC6\u78BC\u5931\u6557"
      };
    }
  }
  /**
   * 續費/升級會員（使用卡密）
   * 調用後端 API 激活卡密，並同步更新所有相關狀態
   */
  async renewMembership(licenseKey) {
    try {
      const currentUser = this._user();
      const email = currentUser?.email || "";
      const result = await this.licenseClient.activateLicense(licenseKey, email);
      if (result.success) {
        let newLevel = "silver";
        let newExpires = "";
        let levelName = "\u767D\u9280\u7CBE\u82F1";
        let levelIcon = "\u{1F948}";
        if (result.data?.level) {
          newLevel = result.data.level;
          newExpires = result.data.expiresAt || "";
          levelName = result.data.levelName || this.getLevelName(newLevel);
          levelIcon = result.data.levelIcon || this.getLevelIcon(newLevel);
        } else {
          const parsedKey = this.parseLicenseKey(licenseKey);
          if (parsedKey.valid) {
            newLevel = parsedKey.level;
            newExpires = parsedKey.expiresAt;
            levelName = parsedKey.levelName;
            levelIcon = parsedKey.levelIcon;
          }
        }
        if (currentUser) {
          const updatedUser = __spreadProps(__spreadValues({}, currentUser), {
            membershipLevel: newLevel,
            membershipExpires: newExpires
          });
          this._user.set(updatedUser);
          localStorage.setItem("tgm_user", JSON.stringify(updatedUser));
          console.log("[AuthService] \u7528\u6236\u72C0\u614B\u5DF2\u66F4\u65B0:", { level: newLevel, expires: newExpires });
        } else {
          const newUser = {
            id: 1,
            username: email.split("@")[0] || "User",
            email,
            membershipLevel: newLevel,
            membershipExpires: newExpires,
            inviteCode: "",
            invitedCount: 0,
            createdAt: (/* @__PURE__ */ new Date()).toISOString(),
            status: "active"
          };
          this._user.set(newUser);
          localStorage.setItem("tgm_user", JSON.stringify(newUser));
          console.log("[AuthService] \u65B0\u7528\u6236\u5DF2\u5275\u5EFA:", { level: newLevel, expires: newExpires });
        }
        await this.loadUsageStats();
        window.dispatchEvent(new CustomEvent("membership-updated", {
          detail: {
            level: newLevel,
            levelName,
            levelIcon,
            expiresAt: newExpires
          }
        }));
        const successMessage = result.message || `\u{1F389} ${levelIcon} ${levelName} \u6FC0\u6D3B\u6210\u529F\uFF01`;
        return {
          success: true,
          message: successMessage,
          newExpires
        };
      }
      return {
        success: false,
        message: result.message || "\u6FC0\u6D3B\u5931\u6557"
      };
    } catch (error) {
      console.error("\u6FC0\u6D3B\u5361\u5BC6\u5931\u6557:", error);
      return {
        success: false,
        message: error.message || "\u6FC0\u6D3B\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"
      };
    }
  }
  /**
   * 獲取會員等級名稱
   */
  getLevelName(level) {
    const names = {
      bronze: "\u9752\u9285\u6230\u58EB",
      silver: "\u767D\u9280\u7CBE\u82F1",
      gold: "\u9EC3\u91D1\u5927\u5E2B",
      diamond: "\u947D\u77F3\u738B\u724C",
      star: "\u661F\u8000\u50B3\u8AAA",
      king: "\u69AE\u8000\u738B\u8005"
    };
    return names[level] || "\u9752\u9285\u6230\u58EB";
  }
  /**
   * 獲取會員等級圖標
   */
  getLevelIcon(level) {
    const icons = {
      bronze: "\u2694\uFE0F",
      silver: "\u{1F948}",
      gold: "\u{1F947}",
      diamond: "\u{1F48E}",
      star: "\u{1F31F}",
      king: "\u{1F451}"
    };
    return icons[level] || "\u2694\uFE0F";
  }
  /**
   * 綁定新設備
   */
  async bindDevice(deviceCode, deviceName) {
    try {
      const response = await this.callAuthApi("/api/auth/bind-device", {
        deviceCode,
        deviceName,
        token: this._token()
      });
      if (response.success) {
        await this.loadDevices();
      }
      return response;
    } catch (error) {
      return {
        success: false,
        message: error.message || "\u7D81\u5B9A\u8A2D\u5099\u5931\u6557"
      };
    }
  }
  /**
   * 解綁設備
   */
  async unbindDevice(deviceId) {
    try {
      const response = await this.callAuthApi("/api/auth/unbind-device", {
        deviceId,
        token: this._token()
      });
      if (response.success) {
        await this.loadDevices();
      }
      return response;
    } catch (error) {
      return {
        success: false,
        message: error.message || "\u89E3\u7D81\u8A2D\u5099\u5931\u6557"
      };
    }
  }
  /**
   * 載入設備列表
   */
  async loadDevices() {
    try {
      const response = await this.callAuthApi("/api/auth/devices", {
        token: this._token()
      });
      if (response.success && response.devices) {
        const currentDeviceCode = await this.deviceService.getDeviceCode();
        const devices = response.devices.map((d) => __spreadProps(__spreadValues({}, d), {
          isCurrent: d.deviceCode === currentDeviceCode
        }));
        this._devices.set(devices);
      }
    } catch (error) {
      console.error("\u8F09\u5165\u8A2D\u5099\u5217\u8868\u5931\u6557:", error);
    }
  }
  /**
   * 載入使用統計
   */
  async loadUsageStats() {
    try {
      try {
        const { LicenseClientService: LicenseClientService2 } = await import("./chunk-SKFX5KMD.js");
        const licenseClient = this.injector.get(LicenseClientService2);
        const result = await licenseClient.getUsageStats();
        if (result.success && result.stats) {
          this._usageStats.set(result.stats);
          return;
        }
      } catch (e) {
        console.warn("\u4F7F\u7528 LicenseClientService \u8F09\u5165\u7D71\u8A08\u5931\u6557\uFF0C\u5617\u8A66\u4F7F\u7528 mock API:", e);
      }
      const response = await this.callAuthApi("/api/auth/usage-stats", {
        token: this._token()
      });
      if (response.success && response.stats) {
        this._usageStats.set(response.stats);
      }
    } catch (error) {
      console.error("\u8F09\u5165\u4F7F\u7528\u7D71\u8A08\u5931\u6557:", error);
    }
  }
  /**
   * 獲取邀請獎勵信息
   */
  async getInviteRewards() {
    try {
      const response = await this.callAuthApi("/api/auth/invite-rewards", {
        token: this._token()
      });
      return response.success ? response : {
        inviteCode: this._user()?.inviteCode || "",
        invitedCount: 0,
        rewardDays: 0
      };
    } catch (error) {
      return {
        inviteCode: this._user()?.inviteCode || "",
        invitedCount: 0,
        rewardDays: 0
      };
    }
  }
  /**
   * 處理登入成功
   */
  async handleLoginSuccess(user, token) {
    this._user.set(user);
    this._token.set(token);
    this._isAuthenticated.set(true);
    localStorage.setItem("tgm_auth_token", token);
    localStorage.setItem("tgm_user", JSON.stringify(user));
    await this.loadDevices();
    await this.loadUsageStats();
  }
  /**
   * 驗證 Token
   */
  async verifyToken(token, deviceCode) {
    try {
      const response = await this.callAuthApi("/api/auth/verify", {
        token,
        deviceCode
      });
      return response.success === true;
    } catch {
      return false;
    }
  }
  /**
   * 清除本地認證數據（公開，會發送事件）
   */
  clearLocalAuth() {
    this.authEvents.emitLogout();
    this.clearLocalAuthInternal();
  }
  /**
   * 內部清除方法（不發送事件，避免循環）
   */
  clearLocalAuthInternal() {
    this.authEvents.clearAllAuthStorage();
  }
  /**
   * 🔧 P0 修復：從 localStorage 同步狀態
   * 當收到 login 事件時調用，確保老版服務狀態與核心服務同步
   */
  syncFromStorage() {
    try {
      const storedToken = this.authEvents.getStoredToken();
      const storedUser = this.authEvents.getStoredUser();
      if (storedToken && storedUser) {
        const user = {
          id: storedUser.id || 0,
          username: storedUser.username || storedUser.display_name || "User",
          email: storedUser.email || void 0,
          phone: storedUser.phone || void 0,
          avatar: storedUser.avatar_url || storedUser.avatar || void 0,
          membershipLevel: this.tierToLevel(storedUser.subscription_tier || storedUser.membershipLevel || "free"),
          membershipExpires: storedUser.membershipExpires || storedUser.subscription_expires || void 0,
          inviteCode: storedUser.inviteCode || storedUser.invite_code || "",
          invitedCount: storedUser.invitedCount || storedUser.invited_count || 0,
          createdAt: storedUser.createdAt || storedUser.created_at || (/* @__PURE__ */ new Date()).toISOString(),
          lastLogin: storedUser.lastLogin || storedUser.last_login_at || (/* @__PURE__ */ new Date()).toISOString(),
          status: storedUser.status || (storedUser.is_active ? "active" : "suspended")
        };
        this._token.set(storedToken);
        this._user.set(user);
        this._isAuthenticated.set(true);
        console.log("[LegacyAuthService] State synced from storage:", user.username);
        this.loadDevices().catch((err) => console.error("\u8F09\u5165\u8A2D\u5099\u5217\u8868\u5931\u6557:", err));
        this.loadUsageStats().catch((err) => console.error("\u8F09\u5165\u4F7F\u7528\u7D71\u8A08\u5931\u6557:", err));
      } else {
        console.warn("[LegacyAuthService] No valid auth data in storage");
      }
    } catch (error) {
      console.error("[LegacyAuthService] Error syncing from storage:", error);
    }
  }
  /**
   * 調用認證 API（開發模式使用模擬數據）
   */
  async callAuthApi(endpoint, data) {
    if (this.isDevMode()) {
      return this.mockApiResponse(endpoint, data);
    }
    try {
      const response = await fetch(endpoint, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": data.token ? `Bearer ${data.token}` : ""
        },
        body: JSON.stringify(data)
      });
      return await response.json();
    } catch (error) {
      throw new Error("\u7DB2\u7D61\u9023\u63A5\u5931\u6557");
    }
  }
  /**
   * 開發模式檢測
   */
  isDevMode() {
    return typeof window !== "undefined" && (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1");
  }
  /**
   * 模擬 API 響應（開發測試用）
   */
  mockApiResponse(endpoint, data) {
    return new Promise((resolve) => {
      setTimeout(() => {
        switch (endpoint) {
          case "/api/auth/login":
            if (data.username && data.password) {
              resolve({
                success: true,
                message: "\u767B\u5165\u6210\u529F",
                user: this.getMockUser(data.username),
                token: "mock_token_" + Date.now(),
                expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1e3).toISOString()
              });
            } else {
              resolve({ success: false, message: "\u7528\u6236\u540D\u6216\u5BC6\u78BC\u932F\u8AA4" });
            }
            break;
          case "/api/auth/activate":
            if (data.licenseKey && data.licenseKey.length >= 16) {
              resolve({
                success: true,
                message: "\u6FC0\u6D3B\u6210\u529F",
                user: this.getMockUser(data.username, "silver"),
                token: "mock_token_" + Date.now()
              });
            } else {
              resolve({ success: false, message: "\u5361\u5BC6\u7121\u6548\u6216\u5DF2\u4F7F\u7528" });
            }
            break;
          case "/api/auth/register":
            if (data.inviteCode && data.username && data.password) {
              resolve({
                success: true,
                message: "\u8A3B\u518A\u6210\u529F",
                user: this.getMockUser(data.username),
                token: "mock_token_" + Date.now()
              });
            } else {
              resolve({ success: false, message: "\u9080\u8ACB\u78BC\u7121\u6548" });
            }
            break;
          case "/api/auth/verify":
            resolve({ success: true });
            break;
          case "/api/auth/devices":
            resolve({
              success: true,
              devices: [
                {
                  id: 1,
                  deviceCode: data.deviceCode || "TGM-MOCK-001",
                  deviceName: "\u7576\u524D\u8A2D\u5099",
                  boundAt: (/* @__PURE__ */ new Date()).toISOString(),
                  lastSeen: (/* @__PURE__ */ new Date()).toISOString(),
                  status: "active"
                }
              ]
            });
            break;
          case "/api/auth/usage-stats":
            resolve({
              success: true,
              stats: {
                aiCalls: { used: 150, limit: 500 },
                messagesSent: { used: 2340, limit: 1e4 },
                accounts: { used: 5, limit: 10 },
                storage: { used: 45, limit: 100 }
              }
            });
            break;
          case "/api/auth/invite-rewards":
            resolve({
              success: true,
              inviteCode: "INVITE-" + Math.random().toString(36).substr(2, 6).toUpperCase(),
              invitedCount: 3,
              rewardDays: 9
            });
            break;
          case "/api/auth/renew":
            const renewResult = this.parseLicenseKey(data.licenseKey);
            if (renewResult.valid) {
              const currentUser = this._user();
              if (currentUser) {
                const updatedUser = __spreadProps(__spreadValues({}, currentUser), {
                  membershipLevel: renewResult.level,
                  membershipExpires: renewResult.expiresAt
                });
                resolve({
                  success: true,
                  message: `\u{1F389} ${renewResult.levelIcon} ${renewResult.levelName} \u6FC0\u6D3B\u6210\u529F\uFF01\u6709\u6548\u671F\u81F3 ${new Date(renewResult.expiresAt).toLocaleDateString()}`,
                  user: updatedUser,
                  newExpires: renewResult.expiresAt
                });
              } else {
                resolve({ success: false, message: "\u8ACB\u5148\u767B\u5165" });
              }
            } else {
              resolve({ success: false, message: renewResult.message });
            }
            break;
          default:
            resolve({ success: true, message: "OK" });
        }
      }, 500);
    });
  }
  /**
   * 生成模擬用戶數據
   */
  getMockUser(username, level = "silver") {
    return {
      id: 1,
      username,
      email: `${username}@example.com`,
      membershipLevel: level,
      membershipExpires: new Date(Date.now() + 30 * 24 * 60 * 60 * 1e3).toISOString(),
      inviteCode: "INVITE-" + Math.random().toString(36).substr(2, 6).toUpperCase(),
      invitedCount: 3,
      createdAt: (/* @__PURE__ */ new Date()).toISOString(),
      lastLogin: (/* @__PURE__ */ new Date()).toISOString(),
      status: "active"
    };
  }
  /**
   * 解析卡密格式
   * 新格式: TGAI-[等級時長]-[XXXX]-[XXXX]-[XXXX]
   * 舊格式: TGM-[等級時長]-[XXXX]-[XXXX]-[XXXX]
   * 等級: B=白銀/G=黃金/D=鑽石/S=星耀/K=王者
   * 時長: 1=周/2=月/3=季/Y=年/L=終身
   */
  parseLicenseKey(licenseKey) {
    if (!licenseKey) {
      return { valid: false, message: "\u8ACB\u8F38\u5165\u5361\u5BC6", level: "bronze", levelName: "", levelIcon: "", durationDays: 0, expiresAt: "" };
    }
    const newKeyRegex = /^TGAI-([BGDSK][123YL]|EXT)-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/i;
    const oldKeyRegex = /^TGM-([BGDSK][123Y])-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/i;
    let match = licenseKey.toUpperCase().match(newKeyRegex);
    if (!match) {
      match = licenseKey.toUpperCase().match(oldKeyRegex);
    }
    if (!match) {
      return { valid: false, message: "\u2694\uFE0F \u5361\u5BC6\u683C\u5F0F\u4E0D\u6B63\u78BA\uFF0C\u8ACB\u6AA2\u67E5\u5F8C\u91CD\u8A66", level: "bronze", levelName: "", levelIcon: "", durationDays: 0, expiresAt: "" };
    }
    const typeCode = match[1];
    const levelCode = typeCode[0];
    const durationCode = typeCode[1] || "2";
    const levelMap = {
      "B": { level: "silver", name: "\u767D\u9280\u7CBE\u82F1", icon: "\u{1F948}" },
      "G": { level: "gold", name: "\u9EC3\u91D1\u5927\u5E2B", icon: "\u{1F947}" },
      "D": { level: "diamond", name: "\u947D\u77F3\u738B\u724C", icon: "\u{1F48E}" },
      "S": { level: "star", name: "\u661F\u8000\u50B3\u8AAA", icon: "\u{1F31F}" },
      "K": { level: "king", name: "\u69AE\u8000\u738B\u8005", icon: "\u{1F451}" },
      "E": { level: "gold", name: "\u9EC3\u91D1\u5927\u5E2B", icon: "\u{1F947}" }
    };
    const durationMap = {
      "1": 7,
      // 周卡
      "2": 30,
      // 月卡
      "3": 90,
      // 季卡
      "Y": 365,
      // 年卡
      "L": 36500,
      // 終身（100年）
      "X": 30
      // EXT 默認30天
    };
    const levelInfo = levelMap[levelCode] || { level: "silver", name: "\u767D\u9280\u7CBE\u82F1", icon: "\u{1F948}" };
    const durationDays = durationMap[durationCode] || 30;
    const currentUser = this._user();
    let baseDate = /* @__PURE__ */ new Date();
    if (currentUser?.membershipExpires) {
      const currentExpires = new Date(currentUser.membershipExpires);
      if (currentExpires > baseDate) {
        baseDate = currentExpires;
      }
    }
    baseDate.setDate(baseDate.getDate() + durationDays);
    return {
      valid: true,
      message: "\u5361\u5BC6\u6709\u6548",
      level: levelInfo.level,
      levelName: levelInfo.name,
      levelIcon: levelInfo.icon,
      durationDays,
      expiresAt: baseDate.toISOString()
    };
  }
  static {
    this.\u0275fac = function AuthService_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _AuthService)();
    };
  }
  static {
    this.\u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({ token: _AuthService, factory: _AuthService.\u0275fac, providedIn: "root" });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AuthService2, [{
    type: Injectable,
    args: [{ providedIn: "root" }]
  }], () => [], null);
})();

// src/login.component.ts
var _forTrack06 = ($index, $item) => $item.id;
function LoginComponent_Conditional_55_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 50);
    \u0275\u0275text(1, "\u27F3");
    \u0275\u0275elementEnd();
  }
}
function LoginComponent_Conditional_65_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 50);
    \u0275\u0275text(1, "\u27F3");
    \u0275\u0275elementEnd();
  }
}
function LoginComponent_Conditional_78_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 63)(1, "span", 75);
    \u0275\u0275text(2, "\u26A0\uFE0F");
    \u0275\u0275elementEnd();
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", ctx_r0.errorMessage(), " ");
  }
}
function LoginComponent_Conditional_79_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 64)(1, "span", 75);
    \u0275\u0275text(2, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", ctx_r0.successMessage(), " ");
  }
}
function LoginComponent_Conditional_80_Conditional_20_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 89);
    \u0275\u0275text(1, "\u23F3");
    \u0275\u0275elementEnd();
    \u0275\u0275text(2, " \u767B\u5165\u4E2D... ");
  }
}
function LoginComponent_Conditional_80_Conditional_21_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u{1F680} \u767B\u5165 ");
  }
}
function LoginComponent_Conditional_80_Template(rf, ctx) {
  if (rf & 1) {
    const _r2 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "form", 76);
    \u0275\u0275listener("ngSubmit", function LoginComponent_Conditional_80_Template_form_ngSubmit_0_listener() {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.onLogin());
    });
    \u0275\u0275elementStart(1, "div", 77)(2, "label", 78);
    \u0275\u0275text(3, "\u7528\u6236\u540D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "input", 79);
    \u0275\u0275twoWayListener("ngModelChange", function LoginComponent_Conditional_80_Template_input_ngModelChange_4_listener($event) {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r0.loginForm.username, $event) || (ctx_r0.loginForm.username = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(5, "div", 77)(6, "label", 78);
    \u0275\u0275text(7, "\u5BC6\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 80)(9, "input", 81);
    \u0275\u0275twoWayListener("ngModelChange", function LoginComponent_Conditional_80_Template_input_ngModelChange_9_listener($event) {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r0.loginForm.password, $event) || (ctx_r0.loginForm.password = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "button", 82);
    \u0275\u0275listener("click", function LoginComponent_Conditional_80_Template_button_click_10_listener() {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.showPassword.set(!ctx_r0.showPassword()));
    });
    \u0275\u0275text(11);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(12, "div", 83)(13, "label", 84)(14, "input", 85);
    \u0275\u0275twoWayListener("ngModelChange", function LoginComponent_Conditional_80_Template_input_ngModelChange_14_listener($event) {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r0.rememberMe, $event) || (ctx_r0.rememberMe = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "span", 86);
    \u0275\u0275text(16, "\u8A18\u4F4F\u6211");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(17, "a", 87);
    \u0275\u0275text(18, " \u5FD8\u8A18\u5BC6\u78BC\uFF1F ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(19, "button", 88);
    \u0275\u0275conditionalCreate(20, LoginComponent_Conditional_80_Conditional_20_Template, 3, 0)(21, LoginComponent_Conditional_80_Conditional_21_Template, 1, 0);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r0.loginForm.username);
    \u0275\u0275advance(5);
    \u0275\u0275property("type", ctx_r0.showPassword() ? "text" : "password");
    \u0275\u0275twoWayProperty("ngModel", ctx_r0.loginForm.password);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", ctx_r0.showPassword() ? "\u{1F648}" : "\u{1F441}\uFE0F", " ");
    \u0275\u0275advance(3);
    \u0275\u0275twoWayProperty("ngModel", ctx_r0.rememberMe);
    \u0275\u0275advance(5);
    \u0275\u0275property("disabled", ctx_r0.isLoading());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.isLoading() ? 20 : 21);
  }
}
function LoginComponent_Conditional_81_Conditional_20_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 89);
    \u0275\u0275text(1, "\u23F3");
    \u0275\u0275elementEnd();
    \u0275\u0275text(2, " \u6FC0\u6D3B\u4E2D... ");
  }
}
function LoginComponent_Conditional_81_Conditional_21_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u{1F3AB} \u6FC0\u6D3B\u5361\u5BC6 ");
  }
}
function LoginComponent_Conditional_81_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "form", 76);
    \u0275\u0275listener("ngSubmit", function LoginComponent_Conditional_81_Template_form_ngSubmit_0_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.onActivate());
    });
    \u0275\u0275elementStart(1, "div", 77)(2, "label", 78);
    \u0275\u0275text(3, "\u5361\u5BC6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "input", 90);
    \u0275\u0275twoWayListener("ngModelChange", function LoginComponent_Conditional_81_Template_input_ngModelChange_4_listener($event) {
      \u0275\u0275restoreView(_r3);
      const ctx_r0 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r0.activateForm.licenseKey, $event) || (ctx_r0.activateForm.licenseKey = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 91);
    \u0275\u0275text(6, "\u8F38\u5165\u8CFC\u8CB7\u7684\u5361\u5BC6\u9032\u884C\u6FC0\u6D3B");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(7, "div", 77)(8, "label", 78);
    \u0275\u0275text(9, "\u8A2D\u7F6E\u7528\u6236\u540D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "input", 92);
    \u0275\u0275twoWayListener("ngModelChange", function LoginComponent_Conditional_81_Template_input_ngModelChange_10_listener($event) {
      \u0275\u0275restoreView(_r3);
      const ctx_r0 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r0.activateForm.username, $event) || (ctx_r0.activateForm.username = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(11, "div", 77)(12, "label", 78);
    \u0275\u0275text(13, "\u8A2D\u7F6E\u5BC6\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "input", 93);
    \u0275\u0275twoWayListener("ngModelChange", function LoginComponent_Conditional_81_Template_input_ngModelChange_14_listener($event) {
      \u0275\u0275restoreView(_r3);
      const ctx_r0 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r0.activateForm.password, $event) || (ctx_r0.activateForm.password = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(15, "div", 77)(16, "label", 78);
    \u0275\u0275text(17, "\u78BA\u8A8D\u5BC6\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "input", 94);
    \u0275\u0275twoWayListener("ngModelChange", function LoginComponent_Conditional_81_Template_input_ngModelChange_18_listener($event) {
      \u0275\u0275restoreView(_r3);
      const ctx_r0 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r0.activateForm.confirmPassword, $event) || (ctx_r0.activateForm.confirmPassword = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(19, "button", 95);
    \u0275\u0275conditionalCreate(20, LoginComponent_Conditional_81_Conditional_20_Template, 3, 0)(21, LoginComponent_Conditional_81_Conditional_21_Template, 1, 0);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r0.activateForm.licenseKey);
    \u0275\u0275advance(6);
    \u0275\u0275twoWayProperty("ngModel", ctx_r0.activateForm.username);
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r0.activateForm.password);
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r0.activateForm.confirmPassword);
    \u0275\u0275advance();
    \u0275\u0275property("disabled", ctx_r0.isLoading());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.isLoading() ? 20 : 21);
  }
}
function LoginComponent_Conditional_82_Conditional_20_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 89);
    \u0275\u0275text(1, "\u23F3");
    \u0275\u0275elementEnd();
    \u0275\u0275text(2, " \u8A3B\u518A\u4E2D... ");
  }
}
function LoginComponent_Conditional_82_Conditional_21_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u{1F4DD} \u8A3B\u518A\u5E33\u865F ");
  }
}
function LoginComponent_Conditional_82_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "form", 76);
    \u0275\u0275listener("ngSubmit", function LoginComponent_Conditional_82_Template_form_ngSubmit_0_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.onRegister());
    });
    \u0275\u0275elementStart(1, "div", 77)(2, "label", 78);
    \u0275\u0275text(3, "\u9080\u8ACB\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "input", 96);
    \u0275\u0275twoWayListener("ngModelChange", function LoginComponent_Conditional_82_Template_input_ngModelChange_4_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r0.registerForm.inviteCode, $event) || (ctx_r0.registerForm.inviteCode = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 91);
    \u0275\u0275text(6, "\u7531\u597D\u53CB\u5206\u4EAB\u7684\u9080\u8ACB\u78BC");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(7, "div", 77)(8, "label", 78);
    \u0275\u0275text(9, "\u7528\u6236\u540D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "input", 92);
    \u0275\u0275twoWayListener("ngModelChange", function LoginComponent_Conditional_82_Template_input_ngModelChange_10_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r0.registerForm.username, $event) || (ctx_r0.registerForm.username = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(11, "div", 77)(12, "label", 78);
    \u0275\u0275text(13, "\u90F5\u7BB1\uFF08\u9078\u586B\uFF09");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "input", 97);
    \u0275\u0275twoWayListener("ngModelChange", function LoginComponent_Conditional_82_Template_input_ngModelChange_14_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r0.registerForm.email, $event) || (ctx_r0.registerForm.email = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(15, "div", 77)(16, "label", 78);
    \u0275\u0275text(17, "\u5BC6\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "input", 93);
    \u0275\u0275twoWayListener("ngModelChange", function LoginComponent_Conditional_82_Template_input_ngModelChange_18_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r0.registerForm.password, $event) || (ctx_r0.registerForm.password = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(19, "button", 98);
    \u0275\u0275conditionalCreate(20, LoginComponent_Conditional_82_Conditional_20_Template, 3, 0)(21, LoginComponent_Conditional_82_Conditional_21_Template, 1, 0);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r0.registerForm.inviteCode);
    \u0275\u0275advance(6);
    \u0275\u0275twoWayProperty("ngModel", ctx_r0.registerForm.username);
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r0.registerForm.email);
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r0.registerForm.password);
    \u0275\u0275advance();
    \u0275\u0275property("disabled", ctx_r0.isLoading());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.isLoading() ? 20 : 21);
  }
}
function LoginComponent_Conditional_83_For_5_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "img", 104);
  }
  if (rf & 2) {
    const account_r6 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275property("src", account_r6.avatar, \u0275\u0275sanitizeUrl);
  }
}
function LoginComponent_Conditional_83_For_5_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span");
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const account_r6 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(account_r6.name.charAt(0).toUpperCase());
  }
}
function LoginComponent_Conditional_83_For_5_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u{1F4F1} Telegram ");
  }
}
function LoginComponent_Conditional_83_For_5_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u{1F4E7} Google ");
  }
}
function LoginComponent_Conditional_83_For_5_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 102);
    \u0275\u0275listener("click", function LoginComponent_Conditional_83_For_5_Template_button_click_0_listener() {
      const account_r6 = \u0275\u0275restoreView(_r5).$implicit;
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onQuickLogin(account_r6));
    });
    \u0275\u0275elementStart(1, "div", 103);
    \u0275\u0275conditionalCreate(2, LoginComponent_Conditional_83_For_5_Conditional_2_Template, 1, 1, "img", 104)(3, LoginComponent_Conditional_83_For_5_Conditional_3_Template, 2, 1, "span");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 105)(5, "span", 106);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "span", 107);
    \u0275\u0275conditionalCreate(8, LoginComponent_Conditional_83_For_5_Conditional_8_Template, 1, 0)(9, LoginComponent_Conditional_83_For_5_Conditional_9_Template, 1, 0);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const account_r6 = ctx.$implicit;
    \u0275\u0275classProp("telegram", account_r6.provider === "telegram")("google", account_r6.provider === "google");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(account_r6.avatar ? 2 : 3);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(account_r6.name);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(account_r6.provider === "telegram" ? 8 : account_r6.provider === "google" ? 9 : -1);
  }
}
function LoginComponent_Conditional_83_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 66)(1, "p", 99);
    \u0275\u0275text(2, "\u5DF2\u7D81\u5B9A\u5E33\u865F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 100);
    \u0275\u0275repeaterCreate(4, LoginComponent_Conditional_83_For_5_Template, 10, 7, "button", 101, _forTrack06);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(4);
    \u0275\u0275repeater(ctx_r0.linkedAccounts());
  }
}
var LoginComponent = class _LoginComponent {
  constructor() {
    this.authService = inject(AuthService2);
    this.deviceService = inject(DeviceService);
    this.i18n = inject(I18nService);
    this.mode = signal("login", ...ngDevMode ? [{ debugName: "mode" }] : []);
    this.showPassword = signal(false, ...ngDevMode ? [{ debugName: "showPassword" }] : []);
    this.errorMessage = signal("", ...ngDevMode ? [{ debugName: "errorMessage" }] : []);
    this.successMessage = signal("", ...ngDevMode ? [{ debugName: "successMessage" }] : []);
    this.rememberMe = false;
    this.telegramLoading = signal(false, ...ngDevMode ? [{ debugName: "telegramLoading" }] : []);
    this.googleLoading = signal(false, ...ngDevMode ? [{ debugName: "googleLoading" }] : []);
    this.isLoading = computed(() => this.authService.isLoading(), ...ngDevMode ? [{ debugName: "isLoading" }] : []);
    this.isOAuthLoading = computed(() => this.telegramLoading() || this.googleLoading(), ...ngDevMode ? [{ debugName: "isOAuthLoading" }] : []);
    this.deviceCode = computed(() => this.deviceService.getShortDeviceId(), ...ngDevMode ? [{ debugName: "deviceCode" }] : []);
    this.deviceName = computed(() => this.deviceService.getDeviceName(), ...ngDevMode ? [{ debugName: "deviceName" }] : []);
    this.linkedAccounts = signal([], ...ngDevMode ? [{ debugName: "linkedAccounts" }] : []);
    this.loginForm = {
      username: "",
      password: ""
    };
    this.activateForm = {
      licenseKey: "",
      username: "",
      password: "",
      confirmPassword: ""
    };
    this.registerForm = {
      inviteCode: "",
      username: "",
      email: "",
      password: ""
    };
  }
  ngOnInit() {
    const urlParams = new URLSearchParams(window.location.search);
    const inviteCode = urlParams.get("invite");
    if (inviteCode) {
      this.registerForm.inviteCode = inviteCode;
      this.mode.set("register");
    }
    this.loadLinkedAccounts();
    this.handleOAuthCallback();
  }
  /**
   * 載入已綁定帳號
   */
  loadLinkedAccounts() {
    try {
      const saved = localStorage.getItem("tgm_linked_accounts");
      if (saved) {
        this.linkedAccounts.set(JSON.parse(saved));
      }
    } catch (e) {
      console.error("\u8F09\u5165\u5DF2\u7D81\u5B9A\u5E33\u865F\u5931\u6557:", e);
    }
  }
  /**
   * 處理 OAuth 回調
   */
  handleOAuthCallback() {
    const urlParams = new URLSearchParams(window.location.search);
    const oauthToken = urlParams.get("oauth_token");
    const provider = urlParams.get("provider");
    if (oauthToken && provider) {
      this.processOAuthToken(provider, oauthToken);
      window.history.replaceState({}, document.title, window.location.pathname);
    }
  }
  /**
   * Telegram 登入
   */
  async onTelegramLogin() {
    this.clearMessages();
    this.telegramLoading.set(true);
    try {
      if (this.isDevMode()) {
        await this.simulateTelegramLogin();
        return;
      }
      const deviceCode = await this.deviceService.getDeviceCode();
      const callbackUrl = encodeURIComponent(window.location.origin + "?provider=telegram");
      const authUrl = `/api/oauth/telegram/authorize?device=${deviceCode}&callback=${callbackUrl}`;
      window.location.href = authUrl;
    } catch (error) {
      this.errorMessage.set(error.message || "Telegram \u767B\u5165\u5931\u6557");
      this.telegramLoading.set(false);
    }
  }
  /**
   * Google 登入
   */
  async onGoogleLogin() {
    this.clearMessages();
    this.googleLoading.set(true);
    try {
      if (this.isDevMode()) {
        await this.simulateGoogleLogin();
        return;
      }
      const checkProviders = await fetch("/api/v1/oauth/providers");
      const providersData = await checkProviders.json();
      const googleProvider = providersData?.providers?.find((p) => p.id === "google");
      if (!googleProvider) {
        this.errorMessage.set("Google \u767B\u5165\u529F\u80FD\u5373\u5C07\u63A8\u51FA\uFF0C\u8ACB\u4F7F\u7528 Telegram \u6216\u90F5\u7BB1\u767B\u5165");
        this.googleLoading.set(false);
        return;
      }
      const deviceCode = await this.deviceService.getDeviceCode();
      const callbackUrl = encodeURIComponent(window.location.origin + "?provider=google");
      const authUrl = `/api/oauth/google/authorize?device=${deviceCode}&callback=${callbackUrl}`;
      window.location.href = authUrl;
    } catch (error) {
      this.errorMessage.set("Google \u767B\u5165\u529F\u80FD\u5373\u5C07\u63A8\u51FA\uFF0C\u8ACB\u4F7F\u7528 Telegram \u6216\u90F5\u7BB1\u767B\u5165");
      this.googleLoading.set(false);
    }
  }
  /**
   * 快捷登入（使用已綁定帳號）
   */
  async onQuickLogin(account) {
    this.clearMessages();
    try {
      const deviceCode = await this.deviceService.getDeviceCode();
      if (this.isDevMode()) {
        const result2 = await this.authService.login(account.name, "oauth_" + account.id);
        if (result2.success) {
          this.successMessage.set(`\u6B61\u8FCE\u56DE\u4F86\uFF0C${account.name}\uFF01`);
        } else {
          this.errorMessage.set("\u5FEB\u6377\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u5617\u8A66\u91CD\u65B0\u6388\u6B0A");
        }
        return;
      }
      const response = await fetch("/api/oauth/quick-login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          accountId: account.id,
          provider: account.provider,
          deviceCode
        })
      });
      const result = await response.json();
      if (result.success) {
        this.successMessage.set(`\u6B61\u8FCE\u56DE\u4F86\uFF0C${account.name}\uFF01`);
      } else {
        this.errorMessage.set(result.message || "\u5FEB\u6377\u767B\u5165\u5931\u6557");
      }
    } catch (error) {
      this.errorMessage.set(error.message || "\u5FEB\u6377\u767B\u5165\u5931\u6557");
    }
  }
  /**
   * 模擬 Telegram 登入（開發模式）
   */
  async simulateTelegramLogin() {
    await new Promise((resolve) => setTimeout(resolve, 1500));
    const telegramUser = {
      id: "tg_" + Math.random().toString(36).substr(2, 9),
      name: "TG User " + Math.floor(Math.random() * 1e3),
      avatar: null,
      provider: "telegram"
    };
    this.saveLinkedAccount(telegramUser);
    const result = await this.authService.login(telegramUser.name, "oauth_" + telegramUser.id);
    this.telegramLoading.set(false);
    if (result.success) {
      this.successMessage.set("Telegram \u767B\u5165\u6210\u529F\uFF01");
    } else {
      this.errorMessage.set(result.message);
    }
  }
  /**
   * 模擬 Google 登入（開發模式）
   */
  async simulateGoogleLogin() {
    await new Promise((resolve) => setTimeout(resolve, 1500));
    const googleUser = {
      id: "google_" + Math.random().toString(36).substr(2, 9),
      name: "user" + Math.floor(Math.random() * 1e3) + "@gmail.com",
      avatar: null,
      provider: "google"
    };
    this.saveLinkedAccount(googleUser);
    const result = await this.authService.login(googleUser.name.split("@")[0], "oauth_" + googleUser.id);
    this.googleLoading.set(false);
    if (result.success) {
      this.successMessage.set("Google \u767B\u5165\u6210\u529F\uFF01");
    } else {
      this.errorMessage.set(result.message);
    }
  }
  /**
   * 處理 OAuth Token
   */
  async processOAuthToken(provider, token) {
    try {
      const response = await fetch("/api/oauth/verify", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ provider, token })
      });
      const result = await response.json();
      if (result.success && result.user) {
        this.saveLinkedAccount({
          id: result.user.id,
          name: result.user.name,
          avatar: result.user.avatar,
          provider
        });
        this.successMessage.set(`${provider === "telegram" ? "Telegram" : "Google"} \u7D81\u5B9A\u6210\u529F\uFF01`);
      }
    } catch (error) {
      console.error("OAuth \u9A57\u8B49\u5931\u6557:", error);
    }
  }
  /**
   * 保存已綁定帳號
   */
  saveLinkedAccount(account) {
    const accounts = this.linkedAccounts();
    const existingIndex = accounts.findIndex((a) => a.provider === account.provider && a.id === account.id);
    if (existingIndex >= 0) {
      accounts[existingIndex] = account;
    } else {
      accounts.push(account);
    }
    this.linkedAccounts.set([...accounts]);
    localStorage.setItem("tgm_linked_accounts", JSON.stringify(accounts));
  }
  /**
   * 開發模式檢測
   */
  isDevMode() {
    return typeof window !== "undefined" && (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1");
  }
  /**
   * 帳號密碼登入
   */
  async onLogin() {
    this.clearMessages();
    if (!this.loginForm.username || !this.loginForm.password) {
      this.errorMessage.set("\u8ACB\u8F38\u5165\u7528\u6236\u540D\u548C\u5BC6\u78BC");
      return;
    }
    const result = await this.authService.login(this.loginForm.username, this.loginForm.password);
    if (result.success) {
      this.successMessage.set("\u767B\u5165\u6210\u529F\uFF0C\u6B63\u5728\u8DF3\u8F49...");
    } else {
      this.errorMessage.set(result.message);
    }
  }
  /**
   * 卡密激活
   */
  async onActivate() {
    this.clearMessages();
    if (!this.activateForm.licenseKey) {
      this.errorMessage.set("\u8ACB\u8F38\u5165\u5361\u5BC6");
      return;
    }
    if (!this.activateForm.username) {
      this.errorMessage.set("\u8ACB\u8A2D\u7F6E\u7528\u6236\u540D");
      return;
    }
    if (this.activateForm.password.length < 6) {
      this.errorMessage.set("\u5BC6\u78BC\u81F3\u5C11\u9700\u8981 6 \u4F4D");
      return;
    }
    if (this.activateForm.password !== this.activateForm.confirmPassword) {
      this.errorMessage.set("\u5169\u6B21\u8F38\u5165\u7684\u5BC6\u78BC\u4E0D\u4E00\u81F4");
      return;
    }
    const result = await this.authService.activateLicense(this.activateForm.licenseKey, this.activateForm.username, this.activateForm.password);
    if (result.success) {
      this.successMessage.set("\u6FC0\u6D3B\u6210\u529F\uFF0C\u6B63\u5728\u8DF3\u8F49...");
    } else {
      this.errorMessage.set(result.message);
    }
  }
  /**
   * 邀請碼註冊
   */
  async onRegister() {
    this.clearMessages();
    if (!this.registerForm.inviteCode) {
      this.errorMessage.set("\u8ACB\u8F38\u5165\u9080\u8ACB\u78BC");
      return;
    }
    if (!this.registerForm.username) {
      this.errorMessage.set("\u8ACB\u8A2D\u7F6E\u7528\u6236\u540D");
      return;
    }
    if (this.registerForm.password.length < 6) {
      this.errorMessage.set("\u5BC6\u78BC\u81F3\u5C11\u9700\u8981 6 \u4F4D");
      return;
    }
    const result = await this.authService.registerWithInvite(this.registerForm.inviteCode, this.registerForm.username, this.registerForm.password, this.registerForm.email || void 0);
    if (result.success) {
      this.successMessage.set("\u8A3B\u518A\u6210\u529F\uFF0C\u6B63\u5728\u8DF3\u8F49...");
    } else {
      this.errorMessage.set(result.message);
    }
  }
  /**
   * 清除消息
   */
  clearMessages() {
    this.errorMessage.set("");
    this.successMessage.set("");
  }
  static {
    this.\u0275fac = function LoginComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _LoginComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _LoginComponent, selectors: [["app-login"]], decls: 99, vars: 18, consts: [[1, "login-container"], [1, "absolute", "inset-0", "overflow-hidden", "pointer-events-none"], [1, "absolute", "top-1/4", "left-1/4", "w-96", "h-96", "bg-cyan-500/10", "rounded-full", "blur-3xl", "animate-pulse"], [1, "absolute", "bottom-1/4", "right-1/4", "w-96", "h-96", "bg-purple-500/10", "rounded-full", "blur-3xl", "animate-pulse", 2, "animation-delay", "1s"], [1, "absolute", "top-1/2", "right-1/3", "w-64", "h-64", "bg-pink-500/10", "rounded-full", "blur-3xl", "animate-pulse", 2, "animation-delay", "2s"], [1, "login-card"], [1, "text-center", "mb-6"], [1, "logo-container"], [1, "logo-glow"], [1, "logo-inner"], ["viewBox", "0 0 64 64", "fill", "none", 1, "w-12", "h-12"], ["cx", "32", "cy", "32", "r", "28", "fill", "url(#logoGrad1)", "opacity", "0.3"], ["d", "M32 8L52 20V44L32 56L12 44V20L32 8Z", "fill", "url(#logoGrad2)", "stroke", "url(#logoGrad3)", "stroke-width", "1.5"], ["d", "M22 28L40 22L34 36L28 32L22 28Z", "fill", "white", "opacity", "0.95"], ["d", "M28 32L34 36L32 42L28 32Z", "fill", "white", "opacity", "0.8"], ["cx", "20", "cy", "24", "r", "2", "fill", "#22d3ee"], ["cx", "44", "cy", "24", "r", "2", "fill", "#22d3ee"], ["cx", "20", "cy", "40", "r", "2", "fill", "#a78bfa"], ["cx", "44", "cy", "40", "r", "2", "fill", "#a78bfa"], ["x1", "20", "y1", "24", "x2", "32", "y2", "32", "stroke", "#22d3ee", "stroke-width", "0.5", "opacity", "0.6"], ["x1", "44", "y1", "24", "x2", "32", "y2", "32", "stroke", "#22d3ee", "stroke-width", "0.5", "opacity", "0.6"], ["x1", "20", "y1", "40", "x2", "32", "y2", "32", "stroke", "#a78bfa", "stroke-width", "0.5", "opacity", "0.6"], ["x1", "44", "y1", "40", "x2", "32", "y2", "32", "stroke", "#a78bfa", "stroke-width", "0.5", "opacity", "0.6"], ["d", "M24 12L28 8L32 11L36 8L40 12L38 16H26L24 12Z", "fill", "url(#crownGrad)", "stroke", "#fbbf24", "stroke-width", "0.5"], ["cx", "28", "cy", "10", "r", "1", "fill", "#fef3c7"], ["cx", "32", "cy", "8", "r", "1.2", "fill", "#fef3c7"], ["cx", "36", "cy", "10", "r", "1", "fill", "#fef3c7"], ["id", "logoGrad1", "x1", "0%", "y1", "0%", "x2", "100%", "y2", "100%"], ["offset", "0%", "stop-color", "#06b6d4"], ["offset", "100%", "stop-color", "#8b5cf6"], ["id", "logoGrad2", "x1", "0%", "y1", "0%", "x2", "100%", "y2", "100%"], ["offset", "0%", "stop-color", "#0891b2", "stop-opacity", "0.9"], ["offset", "50%", "stop-color", "#0e7490", "stop-opacity", "0.95"], ["offset", "100%", "stop-color", "#7c3aed", "stop-opacity", "0.9"], ["id", "logoGrad3", "x1", "0%", "y1", "0%", "x2", "100%", "y2", "100%"], ["offset", "0%", "stop-color", "#22d3ee"], ["offset", "100%", "stop-color", "#a78bfa"], ["id", "crownGrad", "x1", "0%", "y1", "100%", "x2", "100%", "y2", "0%"], ["offset", "0%", "stop-color", "#f59e0b"], ["offset", "100%", "stop-color", "#fbbf24"], [1, "text-2xl", "font-bold", "bg-gradient-to-r", "from-cyan-400", "via-blue-400", "to-purple-400", "bg-clip-text", "text-transparent", "mt-4"], [1, "text-slate-400", "mt-1"], [1, "oauth-section"], [1, "text-center", "text-sm", "text-slate-500", "mb-4"], [1, "oauth-buttons"], [1, "oauth-btn", "telegram-btn", 3, "click", "disabled"], [1, "oauth-icon", "telegram-icon"], ["viewBox", "0 0 24 24", "fill", "currentColor", 1, "w-5", "h-5"], ["d", "M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"], [1, "oauth-text"], [1, "oauth-loading"], [1, "oauth-btn", "google-btn", 3, "click", "disabled"], [1, "oauth-icon", "google-icon"], ["viewBox", "0 0 24 24", 1, "w-5", "h-5"], ["fill", "#4285F4", "d", "M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"], ["fill", "#34A853", "d", "M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"], ["fill", "#FBBC05", "d", "M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"], ["fill", "#EA4335", "d", "M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"], [1, "divider"], [1, "divider-line"], [1, "divider-text"], [1, "flex", "rounded-lg", "bg-slate-800/50", "p-1", "mb-5"], [1, "mode-tab", 3, "click"], [1, "error-message"], [1, "success-message"], [1, "space-y-4"], [1, "linked-accounts-section"], [1, "mt-5", "pt-4", "border-t", "border-slate-700/50", "text-center"], [1, "text-sm", "text-slate-400"], ["href", "/auth/register", 1, "text-cyan-400", "hover:text-cyan-300", "font-medium", "ml-1"], [1, "mt-3", "text-center"], [1, "text-xs", "text-slate-500"], [1, "font-mono", "text-slate-400"], [1, "text-xs", "text-slate-600", "mt-1"], [1, "mt-3", "text-center", "text-xs", "text-slate-600"], [1, "mr-2"], [1, "space-y-4", 3, "ngSubmit"], [1, "form-group"], [1, "form-label"], ["type", "text", "name", "username", "placeholder", "\u8ACB\u8F38\u5165\u7528\u6236\u540D", "required", "", 1, "form-input", 3, "ngModelChange", "ngModel"], [1, "relative"], ["name", "password", "placeholder", "\u8ACB\u8F38\u5165\u5BC6\u78BC", "required", "", 1, "form-input", "pr-10", 3, "ngModelChange", "type", "ngModel"], ["type", "button", 1, "absolute", "right-3", "top-1/2", "-translate-y-1/2", "text-slate-400", "hover:text-white", 3, "click"], [1, "flex", "items-center", "justify-between", "text-sm"], [1, "flex", "items-center", "gap-2", "cursor-pointer"], ["type", "checkbox", "name", "remember", 1, "accent-cyan-500", 3, "ngModelChange", "ngModel"], [1, "text-slate-400"], ["href", "javascript:void(0)", 1, "text-cyan-400", "hover:text-cyan-300"], ["type", "submit", 1, "submit-button", 3, "disabled"], [1, "animate-spin", "mr-2"], ["type", "text", "name", "licenseKey", "placeholder", "XXXX-XXXX-XXXX-XXXX", "required", "", 1, "form-input", "font-mono", 3, "ngModelChange", "ngModel"], [1, "text-xs", "text-slate-500", "mt-1"], ["type", "text", "name", "username", "placeholder", "\u8ACB\u8A2D\u7F6E\u7528\u6236\u540D", "required", "", 1, "form-input", 3, "ngModelChange", "ngModel"], ["type", "password", "name", "password", "placeholder", "\u8ACB\u8A2D\u7F6E\u5BC6\u78BC\uFF08\u81F3\u5C11 6 \u4F4D\uFF09", "minlength", "6", "required", "", 1, "form-input", 3, "ngModelChange", "ngModel"], ["type", "password", "name", "confirmPassword", "placeholder", "\u8ACB\u518D\u6B21\u8F38\u5165\u5BC6\u78BC", "required", "", 1, "form-input", 3, "ngModelChange", "ngModel"], ["type", "submit", 1, "submit-button", "bg-gradient-to-r", "from-green-500", "to-emerald-600", 3, "disabled"], ["type", "text", "name", "inviteCode", "placeholder", "INVITE-XXXXXX", "required", "", 1, "form-input", "font-mono", 3, "ngModelChange", "ngModel"], ["type", "email", "name", "email", "placeholder", "\u7528\u65BC\u627E\u56DE\u5BC6\u78BC", 1, "form-input", 3, "ngModelChange", "ngModel"], ["type", "submit", 1, "submit-button", "bg-gradient-to-r", "from-purple-500", "to-pink-600", 3, "disabled"], [1, "text-center", "text-xs", "text-slate-500", "mb-3"], [1, "linked-accounts"], [1, "linked-account-btn", 3, "telegram", "google"], [1, "linked-account-btn", 3, "click"], [1, "linked-avatar"], ["alt", "", 1, "w-full", "h-full", "rounded-full", 3, "src"], [1, "linked-info"], [1, "linked-name"], [1, "linked-provider"]], template: function LoginComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0)(1, "div", 1);
        \u0275\u0275element(2, "div", 2)(3, "div", 3)(4, "div", 4);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(5, "div", 5)(6, "div", 6)(7, "div", 7);
        \u0275\u0275element(8, "div", 8);
        \u0275\u0275elementStart(9, "div", 9);
        \u0275\u0275namespaceSVG();
        \u0275\u0275elementStart(10, "svg", 10);
        \u0275\u0275element(11, "circle", 11)(12, "path", 12)(13, "path", 13)(14, "path", 14)(15, "circle", 15)(16, "circle", 16)(17, "circle", 17)(18, "circle", 18)(19, "line", 19)(20, "line", 20)(21, "line", 21)(22, "line", 22)(23, "path", 23)(24, "circle", 24)(25, "circle", 25)(26, "circle", 26);
        \u0275\u0275elementStart(27, "defs")(28, "linearGradient", 27);
        \u0275\u0275element(29, "stop", 28)(30, "stop", 29);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(31, "linearGradient", 30);
        \u0275\u0275element(32, "stop", 31)(33, "stop", 32)(34, "stop", 33);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(35, "linearGradient", 34);
        \u0275\u0275element(36, "stop", 35)(37, "stop", 36);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(38, "linearGradient", 37);
        \u0275\u0275element(39, "stop", 38)(40, "stop", 39);
        \u0275\u0275elementEnd()()()()();
        \u0275\u0275namespaceHTML();
        \u0275\u0275elementStart(41, "h1", 40);
        \u0275\u0275text(42, "TG-AI\u667A\u63A7\u738B");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(43, "p", 41);
        \u0275\u0275text(44, "AI \u9A45\u52D5\u7684 Telegram \u667A\u80FD\u71DF\u92B7\u7CFB\u7D71");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(45, "div", 42)(46, "p", 43);
        \u0275\u0275text(47, "\u5FEB\u6377\u767B\u5165");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(48, "div", 44)(49, "button", 45);
        \u0275\u0275listener("click", function LoginComponent_Template_button_click_49_listener() {
          return ctx.onTelegramLogin();
        });
        \u0275\u0275elementStart(50, "div", 46);
        \u0275\u0275namespaceSVG();
        \u0275\u0275elementStart(51, "svg", 47);
        \u0275\u0275element(52, "path", 48);
        \u0275\u0275elementEnd()();
        \u0275\u0275namespaceHTML();
        \u0275\u0275elementStart(53, "span", 49);
        \u0275\u0275text(54, "Telegram \u767B\u5165");
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(55, LoginComponent_Conditional_55_Template, 2, 0, "span", 50);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(56, "button", 51);
        \u0275\u0275listener("click", function LoginComponent_Template_button_click_56_listener() {
          return ctx.onGoogleLogin();
        });
        \u0275\u0275elementStart(57, "div", 52);
        \u0275\u0275namespaceSVG();
        \u0275\u0275elementStart(58, "svg", 53);
        \u0275\u0275element(59, "path", 54)(60, "path", 55)(61, "path", 56)(62, "path", 57);
        \u0275\u0275elementEnd()();
        \u0275\u0275namespaceHTML();
        \u0275\u0275elementStart(63, "span", 49);
        \u0275\u0275text(64, "Google \u767B\u5165");
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(65, LoginComponent_Conditional_65_Template, 2, 0, "span", 50);
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(66, "div", 58);
        \u0275\u0275element(67, "span", 59);
        \u0275\u0275elementStart(68, "span", 60);
        \u0275\u0275text(69, "\u6216\u4F7F\u7528\u5E33\u865F\u767B\u5165");
        \u0275\u0275elementEnd();
        \u0275\u0275element(70, "span", 59);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(71, "div", 61)(72, "button", 62);
        \u0275\u0275listener("click", function LoginComponent_Template_button_click_72_listener() {
          return ctx.mode.set("login");
        });
        \u0275\u0275text(73, " \u{1F511} \u767B\u5165 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(74, "button", 62);
        \u0275\u0275listener("click", function LoginComponent_Template_button_click_74_listener() {
          return ctx.mode.set("activate");
        });
        \u0275\u0275text(75, " \u{1F3AB} \u5361\u5BC6\u6FC0\u6D3B ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(76, "button", 62);
        \u0275\u0275listener("click", function LoginComponent_Template_button_click_76_listener() {
          return ctx.mode.set("register");
        });
        \u0275\u0275text(77, " \u{1F4DD} \u9080\u8ACB\u8A3B\u518A ");
        \u0275\u0275elementEnd()();
        \u0275\u0275conditionalCreate(78, LoginComponent_Conditional_78_Template, 4, 1, "div", 63);
        \u0275\u0275conditionalCreate(79, LoginComponent_Conditional_79_Template, 4, 1, "div", 64);
        \u0275\u0275conditionalCreate(80, LoginComponent_Conditional_80_Template, 22, 7, "form", 65);
        \u0275\u0275conditionalCreate(81, LoginComponent_Conditional_81_Template, 22, 6, "form", 65);
        \u0275\u0275conditionalCreate(82, LoginComponent_Conditional_82_Template, 22, 6, "form", 65);
        \u0275\u0275conditionalCreate(83, LoginComponent_Conditional_83_Template, 6, 0, "div", 66);
        \u0275\u0275elementStart(84, "div", 67)(85, "p", 68);
        \u0275\u0275text(86, " \u9084\u6C92\u6709\u5E33\u865F\uFF1F ");
        \u0275\u0275elementStart(87, "a", 69);
        \u0275\u0275text(88, " \u7ACB\u5373\u8A3B\u518A \u2192 ");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(89, "div", 70)(90, "p", 71);
        \u0275\u0275text(91, " \u8A2D\u5099\u78BC: ");
        \u0275\u0275elementStart(92, "span", 72);
        \u0275\u0275text(93);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(94, "p", 73);
        \u0275\u0275text(95);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(96, "div", 74)(97, "p");
        \u0275\u0275text(98, "\xA9 2026 TG-AI\u667A\u63A7\u738B. All rights reserved.");
        \u0275\u0275elementEnd()()()();
      }
      if (rf & 2) {
        \u0275\u0275advance(49);
        \u0275\u0275property("disabled", ctx.isOAuthLoading());
        \u0275\u0275advance(6);
        \u0275\u0275conditional(ctx.telegramLoading() ? 55 : -1);
        \u0275\u0275advance();
        \u0275\u0275property("disabled", ctx.isOAuthLoading());
        \u0275\u0275advance(9);
        \u0275\u0275conditional(ctx.googleLoading() ? 65 : -1);
        \u0275\u0275advance(7);
        \u0275\u0275classProp("active", ctx.mode() === "login");
        \u0275\u0275advance(2);
        \u0275\u0275classProp("active", ctx.mode() === "activate");
        \u0275\u0275advance(2);
        \u0275\u0275classProp("active", ctx.mode() === "register");
        \u0275\u0275advance(2);
        \u0275\u0275conditional(ctx.errorMessage() ? 78 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.successMessage() ? 79 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.mode() === "login" ? 80 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.mode() === "activate" ? 81 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.mode() === "register" ? 82 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.linkedAccounts().length > 0 ? 83 : -1);
        \u0275\u0275advance(10);
        \u0275\u0275textInterpolate(ctx.deviceCode());
        \u0275\u0275advance(2);
        \u0275\u0275textInterpolate1(" ", ctx.deviceName(), " ");
      }
    }, dependencies: [CommonModule, FormsModule, \u0275NgNoValidate, DefaultValueAccessor, CheckboxControlValueAccessor, NgControlStatus, NgControlStatusGroup, RequiredValidator, MinLengthValidator, NgModel, NgForm], styles: ["\n\n.login-container[_ngcontent-%COMP%] {\n  min-height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background:\n    linear-gradient(\n      135deg,\n      #0f172a 0%,\n      #1e293b 50%,\n      #0f172a 100%);\n  position: relative;\n  padding: 1rem;\n}\n.login-card[_ngcontent-%COMP%] {\n  width: 100%;\n  max-width: 420px;\n  background: rgba(30, 41, 59, 0.85);\n  -webkit-backdrop-filter: blur(20px);\n  backdrop-filter: blur(20px);\n  border-radius: 1.5rem;\n  padding: 2rem;\n  border: 1px solid rgba(148, 163, 184, 0.1);\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);\n  position: relative;\n  z-index: 10;\n}\n.logo-container[_ngcontent-%COMP%] {\n  position: relative;\n  width: 80px;\n  height: 80px;\n  margin: 0 auto;\n}\n.logo-glow[_ngcontent-%COMP%] {\n  position: absolute;\n  inset: -10px;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6,\n      #8b5cf6);\n  border-radius: 1.5rem;\n  opacity: 0.5;\n  filter: blur(15px);\n  animation: _ngcontent-%COMP%_logoGlow 3s ease-in-out infinite;\n}\n@keyframes _ngcontent-%COMP%_logoGlow {\n  0%, 100% {\n    opacity: 0.3;\n    transform: scale(0.95);\n  }\n  50% {\n    opacity: 0.6;\n    transform: scale(1.05);\n  }\n}\n.logo-inner[_ngcontent-%COMP%] {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border-radius: 1.25rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 10px 30px -10px rgba(6, 182, 212, 0.5);\n}\n.oauth-section[_ngcontent-%COMP%] {\n  margin-bottom: 1.25rem;\n}\n.oauth-buttons[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.75rem;\n}\n.oauth-btn[_ngcontent-%COMP%] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1rem;\n  border-radius: 0.75rem;\n  font-size: 0.875rem;\n  font-weight: 500;\n  transition: all 0.2s;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n.oauth-btn[_ngcontent-%COMP%]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.telegram-btn[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #0088cc,\n      #229ED9);\n  border: 1px solid rgba(34, 158, 217, 0.3);\n  color: white;\n}\n.telegram-btn[_ngcontent-%COMP%]:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 10px 20px -10px rgba(0, 136, 204, 0.5);\n}\n.google-btn[_ngcontent-%COMP%] {\n  background: rgba(255, 255, 255, 0.95);\n  border: 1px solid rgba(0, 0, 0, 0.1);\n  color: #333;\n}\n.google-btn[_ngcontent-%COMP%]:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 10px 20px -10px rgba(0, 0, 0, 0.2);\n}\n.oauth-icon[_ngcontent-%COMP%] {\n  width: 20px;\n  height: 20px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.oauth-text[_ngcontent-%COMP%] {\n  font-weight: 500;\n}\n.oauth-loading[_ngcontent-%COMP%] {\n  animation: _ngcontent-%COMP%_spin 1s linear infinite;\n  margin-left: 0.25rem;\n}\n@keyframes _ngcontent-%COMP%_spin {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n.divider[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  margin-bottom: 1.25rem;\n}\n.divider-line[_ngcontent-%COMP%] {\n  flex: 1;\n  height: 1px;\n  background:\n    linear-gradient(\n      90deg,\n      transparent,\n      rgba(148, 163, 184, 0.3),\n      transparent);\n}\n.divider-text[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: #64748b;\n  white-space: nowrap;\n}\n.mode-tab[_ngcontent-%COMP%] {\n  flex: 1;\n  padding: 0.5rem 0.5rem;\n  font-size: 0.8rem;\n  color: #94a3b8;\n  border-radius: 0.5rem;\n  transition: all 0.2s;\n}\n.mode-tab[_ngcontent-%COMP%]:hover {\n  color: #e2e8f0;\n}\n.mode-tab.active[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  color: white;\n  font-weight: 500;\n}\n.form-group[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.form-label[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: #e2e8f0;\n}\n.form-input[_ngcontent-%COMP%] {\n  width: 100%;\n  padding: 0.75rem 1rem;\n  background: rgba(15, 23, 42, 0.6);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.75rem;\n  color: white;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n}\n.form-input[_ngcontent-%COMP%]:focus {\n  outline: none;\n  border-color: #06b6d4;\n  box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.2);\n}\n.form-input[_ngcontent-%COMP%]::placeholder {\n  color: #64748b;\n}\n.submit-button[_ngcontent-%COMP%] {\n  width: 100%;\n  padding: 0.875rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.75rem;\n  color: white;\n  font-size: 1rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.submit-button[_ngcontent-%COMP%]:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 10px 20px -10px rgba(6, 182, 212, 0.5);\n}\n.submit-button[_ngcontent-%COMP%]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.error-message[_ngcontent-%COMP%] {\n  padding: 0.75rem 1rem;\n  background: rgba(239, 68, 68, 0.15);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  border-radius: 0.75rem;\n  color: #fca5a5;\n  font-size: 0.875rem;\n  margin-bottom: 1rem;\n  display: flex;\n  align-items: center;\n}\n.success-message[_ngcontent-%COMP%] {\n  padding: 0.75rem 1rem;\n  background: rgba(34, 197, 94, 0.15);\n  border: 1px solid rgba(34, 197, 94, 0.3);\n  border-radius: 0.75rem;\n  color: #86efac;\n  font-size: 0.875rem;\n  margin-bottom: 1rem;\n  display: flex;\n  align-items: center;\n}\n.linked-accounts-section[_ngcontent-%COMP%] {\n  margin-top: 1.25rem;\n  padding-top: 1rem;\n  border-top: 1px solid rgba(148, 163, 184, 0.1);\n}\n.linked-accounts[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.linked-account-btn[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.625rem 1rem;\n  background: rgba(15, 23, 42, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.15);\n  border-radius: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.linked-account-btn[_ngcontent-%COMP%]:hover {\n  background: rgba(15, 23, 42, 0.8);\n  border-color: rgba(148, 163, 184, 0.3);\n}\n.linked-account-btn.telegram[_ngcontent-%COMP%]:hover {\n  border-color: rgba(0, 136, 204, 0.5);\n}\n.linked-account-btn.google[_ngcontent-%COMP%]:hover {\n  border-color: rgba(234, 67, 53, 0.5);\n}\n.linked-avatar[_ngcontent-%COMP%] {\n  width: 36px;\n  height: 36px;\n  border-radius: 50%;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  color: white;\n  font-size: 0.875rem;\n  overflow: hidden;\n}\n.linked-info[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n}\n.linked-name[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: #e2e8f0;\n}\n.linked-provider[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: #64748b;\n}\n/*# sourceMappingURL=login.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(LoginComponent, [{
    type: Component,
    args: [{ selector: "app-login", standalone: true, imports: [CommonModule, FormsModule], template: `
    <div class="login-container">
      <!-- \u80CC\u666F\u88DD\u98FE -->
      <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl animate-pulse"></div>
        <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
        <div class="absolute top-1/2 right-1/3 w-64 h-64 bg-pink-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 2s;"></div>
      </div>
      
      <!-- \u767B\u5165\u5361\u7247 -->
      <div class="login-card">
        <!-- Logo \u548C\u6A19\u984C -->
        <div class="text-center mb-6">
          <div class="logo-container">
            <div class="logo-glow"></div>
            <div class="logo-inner">
              <!-- \u65B0 LOGO: AI \u667A\u63A7\u738B - \u878D\u5408 Telegram \u7D19\u98DB\u6A5F + AI \u5927\u8166 + \u7687\u51A0 -->
              <svg viewBox="0 0 64 64" class="w-12 h-12" fill="none">
                <!-- \u5E95\u90E8\u5149\u74B0 -->
                <circle cx="32" cy="32" r="28" fill="url(#logoGrad1)" opacity="0.3"/>
                
                <!-- \u4E2D\u5FC3\u516D\u908A\u5F62 (\u4EE3\u8868 AI \u7DB2\u7D61) -->
                <path d="M32 8L52 20V44L32 56L12 44V20L32 8Z" fill="url(#logoGrad2)" stroke="url(#logoGrad3)" stroke-width="1.5"/>
                
                <!-- \u7D19\u98DB\u6A5F (Telegram \u5143\u7D20) -->
                <path d="M22 28L40 22L34 36L28 32L22 28Z" fill="white" opacity="0.95"/>
                <path d="M28 32L34 36L32 42L28 32Z" fill="white" opacity="0.8"/>
                
                <!-- AI \u795E\u7D93\u9023\u63A5\u7DDA -->
                <circle cx="20" cy="24" r="2" fill="#22d3ee"/>
                <circle cx="44" cy="24" r="2" fill="#22d3ee"/>
                <circle cx="20" cy="40" r="2" fill="#a78bfa"/>
                <circle cx="44" cy="40" r="2" fill="#a78bfa"/>
                <line x1="20" y1="24" x2="32" y2="32" stroke="#22d3ee" stroke-width="0.5" opacity="0.6"/>
                <line x1="44" y1="24" x2="32" y2="32" stroke="#22d3ee" stroke-width="0.5" opacity="0.6"/>
                <line x1="20" y1="40" x2="32" y2="32" stroke="#a78bfa" stroke-width="0.5" opacity="0.6"/>
                <line x1="44" y1="40" x2="32" y2="32" stroke="#a78bfa" stroke-width="0.5" opacity="0.6"/>
                
                <!-- \u9802\u90E8\u7687\u51A0 (\u667A\u63A7\u738B) -->
                <path d="M24 12L28 8L32 11L36 8L40 12L38 16H26L24 12Z" fill="url(#crownGrad)" stroke="#fbbf24" stroke-width="0.5"/>
                <circle cx="28" cy="10" r="1" fill="#fef3c7"/>
                <circle cx="32" cy="8" r="1.2" fill="#fef3c7"/>
                <circle cx="36" cy="10" r="1" fill="#fef3c7"/>
                
                <!-- \u6F38\u8B8A\u5B9A\u7FA9 -->
                <defs>
                  <linearGradient id="logoGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#06b6d4"/>
                    <stop offset="100%" stop-color="#8b5cf6"/>
                  </linearGradient>
                  <linearGradient id="logoGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#0891b2" stop-opacity="0.9"/>
                    <stop offset="50%" stop-color="#0e7490" stop-opacity="0.95"/>
                    <stop offset="100%" stop-color="#7c3aed" stop-opacity="0.9"/>
                  </linearGradient>
                  <linearGradient id="logoGrad3" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#22d3ee"/>
                    <stop offset="100%" stop-color="#a78bfa"/>
                  </linearGradient>
                  <linearGradient id="crownGrad" x1="0%" y1="100%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#f59e0b"/>
                    <stop offset="100%" stop-color="#fbbf24"/>
                  </linearGradient>
                </defs>
              </svg>
            </div>
          </div>
          <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 via-blue-400 to-purple-400 bg-clip-text text-transparent mt-4">TG-AI\u667A\u63A7\u738B</h1>
          <p class="text-slate-400 mt-1">AI \u9A45\u52D5\u7684 Telegram \u667A\u80FD\u71DF\u92B7\u7CFB\u7D71</p>
        </div>
        
        <!-- \u7B2C\u4E09\u65B9\u5FEB\u6377\u767B\u5165 -->
        <div class="oauth-section">
          <p class="text-center text-sm text-slate-500 mb-4">\u5FEB\u6377\u767B\u5165</p>
          <div class="oauth-buttons">
            <!-- Telegram \u767B\u5165 -->
            <button 
              (click)="onTelegramLogin()"
              [disabled]="isOAuthLoading()"
              class="oauth-btn telegram-btn">
              <div class="oauth-icon telegram-icon">
                <svg viewBox="0 0 24 24" class="w-5 h-5" fill="currentColor">
                  <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                </svg>
              </div>
              <span class="oauth-text">Telegram \u767B\u5165</span>
              @if (telegramLoading()) {
                <span class="oauth-loading">\u27F3</span>
              }
            </button>
            
            <!-- Google \u767B\u5165 -->
            <button 
              (click)="onGoogleLogin()"
              [disabled]="isOAuthLoading()"
              class="oauth-btn google-btn">
              <div class="oauth-icon google-icon">
                <svg viewBox="0 0 24 24" class="w-5 h-5">
                  <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                  <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                  <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                  <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
              </div>
              <span class="oauth-text">Google \u767B\u5165</span>
              @if (googleLoading()) {
                <span class="oauth-loading">\u27F3</span>
              }
            </button>
          </div>
        </div>
        
        <!-- \u5206\u9694\u7DDA -->
        <div class="divider">
          <span class="divider-line"></span>
          <span class="divider-text">\u6216\u4F7F\u7528\u5E33\u865F\u767B\u5165</span>
          <span class="divider-line"></span>
        </div>
        
        <!-- \u6A21\u5F0F\u5207\u63DB\u6A19\u7C64 -->
        <div class="flex rounded-lg bg-slate-800/50 p-1 mb-5">
          <button 
            (click)="mode.set('login')"
            [class.active]="mode() === 'login'"
            class="mode-tab">
            \u{1F511} \u767B\u5165
          </button>
          <button 
            (click)="mode.set('activate')"
            [class.active]="mode() === 'activate'"
            class="mode-tab">
            \u{1F3AB} \u5361\u5BC6\u6FC0\u6D3B
          </button>
          <button 
            (click)="mode.set('register')"
            [class.active]="mode() === 'register'"
            class="mode-tab">
            \u{1F4DD} \u9080\u8ACB\u8A3B\u518A
          </button>
        </div>
        
        <!-- \u932F\u8AA4\u63D0\u793A -->
        @if (errorMessage()) {
          <div class="error-message">
            <span class="mr-2">\u26A0\uFE0F</span>
            {{ errorMessage() }}
          </div>
        }
        
        <!-- \u6210\u529F\u63D0\u793A -->
        @if (successMessage()) {
          <div class="success-message">
            <span class="mr-2">\u2705</span>
            {{ successMessage() }}
          </div>
        }
        
        <!-- \u5E33\u865F\u5BC6\u78BC\u767B\u5165\u8868\u55AE -->
        @if (mode() === 'login') {
          <form (ngSubmit)="onLogin()" class="space-y-4">
            <div class="form-group">
              <label class="form-label">\u7528\u6236\u540D</label>
              <input 
                type="text" 
                [(ngModel)]="loginForm.username" 
                name="username"
                class="form-input"
                placeholder="\u8ACB\u8F38\u5165\u7528\u6236\u540D"
                required>
            </div>
            
            <div class="form-group">
              <label class="form-label">\u5BC6\u78BC</label>
              <div class="relative">
                <input 
                  [type]="showPassword() ? 'text' : 'password'" 
                  [(ngModel)]="loginForm.password" 
                  name="password"
                  class="form-input pr-10"
                  placeholder="\u8ACB\u8F38\u5165\u5BC6\u78BC"
                  required>
                <button 
                  type="button"
                  (click)="showPassword.set(!showPassword())"
                  class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white">
                  {{ showPassword() ? '\u{1F648}' : '\u{1F441}\uFE0F' }}
                </button>
              </div>
            </div>
            
            <div class="flex items-center justify-between text-sm">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" [(ngModel)]="rememberMe" name="remember" class="accent-cyan-500">
                <span class="text-slate-400">\u8A18\u4F4F\u6211</span>
              </label>
              <a href="javascript:void(0)" class="text-cyan-400 hover:text-cyan-300">
                \u5FD8\u8A18\u5BC6\u78BC\uFF1F
              </a>
            </div>
            
            <button 
              type="submit" 
              [disabled]="isLoading()"
              class="submit-button">
              @if (isLoading()) {
                <span class="animate-spin mr-2">\u23F3</span> \u767B\u5165\u4E2D...
              } @else {
                \u{1F680} \u767B\u5165
              }
            </button>
          </form>
        }
        
        <!-- \u5361\u5BC6\u6FC0\u6D3B\u8868\u55AE -->
        @if (mode() === 'activate') {
          <form (ngSubmit)="onActivate()" class="space-y-4">
            <div class="form-group">
              <label class="form-label">\u5361\u5BC6</label>
              <input 
                type="text" 
                [(ngModel)]="activateForm.licenseKey" 
                name="licenseKey"
                class="form-input font-mono"
                placeholder="XXXX-XXXX-XXXX-XXXX"
                required>
              <p class="text-xs text-slate-500 mt-1">\u8F38\u5165\u8CFC\u8CB7\u7684\u5361\u5BC6\u9032\u884C\u6FC0\u6D3B</p>
            </div>
            
            <div class="form-group">
              <label class="form-label">\u8A2D\u7F6E\u7528\u6236\u540D</label>
              <input 
                type="text" 
                [(ngModel)]="activateForm.username" 
                name="username"
                class="form-input"
                placeholder="\u8ACB\u8A2D\u7F6E\u7528\u6236\u540D"
                required>
            </div>
            
            <div class="form-group">
              <label class="form-label">\u8A2D\u7F6E\u5BC6\u78BC</label>
              <input 
                type="password" 
                [(ngModel)]="activateForm.password" 
                name="password"
                class="form-input"
                placeholder="\u8ACB\u8A2D\u7F6E\u5BC6\u78BC\uFF08\u81F3\u5C11 6 \u4F4D\uFF09"
                minlength="6"
                required>
            </div>
            
            <div class="form-group">
              <label class="form-label">\u78BA\u8A8D\u5BC6\u78BC</label>
              <input 
                type="password" 
                [(ngModel)]="activateForm.confirmPassword" 
                name="confirmPassword"
                class="form-input"
                placeholder="\u8ACB\u518D\u6B21\u8F38\u5165\u5BC6\u78BC"
                required>
            </div>
            
            <button 
              type="submit" 
              [disabled]="isLoading()"
              class="submit-button bg-gradient-to-r from-green-500 to-emerald-600">
              @if (isLoading()) {
                <span class="animate-spin mr-2">\u23F3</span> \u6FC0\u6D3B\u4E2D...
              } @else {
                \u{1F3AB} \u6FC0\u6D3B\u5361\u5BC6
              }
            </button>
          </form>
        }
        
        <!-- \u9080\u8ACB\u78BC\u8A3B\u518A\u8868\u55AE -->
        @if (mode() === 'register') {
          <form (ngSubmit)="onRegister()" class="space-y-4">
            <div class="form-group">
              <label class="form-label">\u9080\u8ACB\u78BC</label>
              <input 
                type="text" 
                [(ngModel)]="registerForm.inviteCode" 
                name="inviteCode"
                class="form-input font-mono"
                placeholder="INVITE-XXXXXX"
                required>
              <p class="text-xs text-slate-500 mt-1">\u7531\u597D\u53CB\u5206\u4EAB\u7684\u9080\u8ACB\u78BC</p>
            </div>
            
            <div class="form-group">
              <label class="form-label">\u7528\u6236\u540D</label>
              <input 
                type="text" 
                [(ngModel)]="registerForm.username" 
                name="username"
                class="form-input"
                placeholder="\u8ACB\u8A2D\u7F6E\u7528\u6236\u540D"
                required>
            </div>
            
            <div class="form-group">
              <label class="form-label">\u90F5\u7BB1\uFF08\u9078\u586B\uFF09</label>
              <input 
                type="email" 
                [(ngModel)]="registerForm.email" 
                name="email"
                class="form-input"
                placeholder="\u7528\u65BC\u627E\u56DE\u5BC6\u78BC">
            </div>
            
            <div class="form-group">
              <label class="form-label">\u5BC6\u78BC</label>
              <input 
                type="password" 
                [(ngModel)]="registerForm.password" 
                name="password"
                class="form-input"
                placeholder="\u8ACB\u8A2D\u7F6E\u5BC6\u78BC\uFF08\u81F3\u5C11 6 \u4F4D\uFF09"
                minlength="6"
                required>
            </div>
            
            <button 
              type="submit" 
              [disabled]="isLoading()"
              class="submit-button bg-gradient-to-r from-purple-500 to-pink-600">
              @if (isLoading()) {
                <span class="animate-spin mr-2">\u23F3</span> \u8A3B\u518A\u4E2D...
              } @else {
                \u{1F4DD} \u8A3B\u518A\u5E33\u865F
              }
            </button>
          </form>
        }
        
        <!-- \u5DF2\u7D81\u5B9A\u5E33\u865F\u5FEB\u6377\u767B\u5165 -->
        @if (linkedAccounts().length > 0) {
          <div class="linked-accounts-section">
            <p class="text-center text-xs text-slate-500 mb-3">\u5DF2\u7D81\u5B9A\u5E33\u865F</p>
            <div class="linked-accounts">
              @for (account of linkedAccounts(); track account.id) {
                <button 
                  (click)="onQuickLogin(account)"
                  class="linked-account-btn"
                  [class.telegram]="account.provider === 'telegram'"
                  [class.google]="account.provider === 'google'">
                  <div class="linked-avatar">
                    @if (account.avatar) {
                      <img [src]="account.avatar" alt="" class="w-full h-full rounded-full">
                    } @else {
                      <span>{{ account.name.charAt(0).toUpperCase() }}</span>
                    }
                  </div>
                  <div class="linked-info">
                    <span class="linked-name">{{ account.name }}</span>
                    <span class="linked-provider">
                      @if (account.provider === 'telegram') { \u{1F4F1} Telegram }
                      @else if (account.provider === 'google') { \u{1F4E7} Google }
                    </span>
                  </div>
                </button>
              }
            </div>
          </div>
        }
        
        <!-- \u8A3B\u518A\u5165\u53E3 -->
        <div class="mt-5 pt-4 border-t border-slate-700/50 text-center">
          <p class="text-sm text-slate-400">
            \u9084\u6C92\u6709\u5E33\u865F\uFF1F
            <a href="/auth/register" class="text-cyan-400 hover:text-cyan-300 font-medium ml-1">
              \u7ACB\u5373\u8A3B\u518A \u2192
            </a>
          </p>
        </div>
        
        <!-- \u8A2D\u5099\u4FE1\u606F -->
        <div class="mt-3 text-center">
          <p class="text-xs text-slate-500">
            \u8A2D\u5099\u78BC: <span class="font-mono text-slate-400">{{ deviceCode() }}</span>
          </p>
          <p class="text-xs text-slate-600 mt-1">
            {{ deviceName() }}
          </p>
        </div>
        
        <!-- \u7248\u6B0A\u4FE1\u606F -->
        <div class="mt-3 text-center text-xs text-slate-600">
          <p>\xA9 2026 TG-AI\u667A\u63A7\u738B. All rights reserved.</p>
        </div>
      </div>
    </div>
  `, styles: ["/* angular:styles/component:css;9e5296c98a21c04f368d7fa3aaf9719d5df88446fb978b44cfe7bcab280f72e8;D:/tgkz2026/src/login.component.ts */\n.login-container {\n  min-height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background:\n    linear-gradient(\n      135deg,\n      #0f172a 0%,\n      #1e293b 50%,\n      #0f172a 100%);\n  position: relative;\n  padding: 1rem;\n}\n.login-card {\n  width: 100%;\n  max-width: 420px;\n  background: rgba(30, 41, 59, 0.85);\n  -webkit-backdrop-filter: blur(20px);\n  backdrop-filter: blur(20px);\n  border-radius: 1.5rem;\n  padding: 2rem;\n  border: 1px solid rgba(148, 163, 184, 0.1);\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);\n  position: relative;\n  z-index: 10;\n}\n.logo-container {\n  position: relative;\n  width: 80px;\n  height: 80px;\n  margin: 0 auto;\n}\n.logo-glow {\n  position: absolute;\n  inset: -10px;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6,\n      #8b5cf6);\n  border-radius: 1.5rem;\n  opacity: 0.5;\n  filter: blur(15px);\n  animation: logoGlow 3s ease-in-out infinite;\n}\n@keyframes logoGlow {\n  0%, 100% {\n    opacity: 0.3;\n    transform: scale(0.95);\n  }\n  50% {\n    opacity: 0.6;\n    transform: scale(1.05);\n  }\n}\n.logo-inner {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border-radius: 1.25rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 10px 30px -10px rgba(6, 182, 212, 0.5);\n}\n.oauth-section {\n  margin-bottom: 1.25rem;\n}\n.oauth-buttons {\n  display: flex;\n  gap: 0.75rem;\n}\n.oauth-btn {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1rem;\n  border-radius: 0.75rem;\n  font-size: 0.875rem;\n  font-weight: 500;\n  transition: all 0.2s;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n.oauth-btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.telegram-btn {\n  background:\n    linear-gradient(\n      135deg,\n      #0088cc,\n      #229ED9);\n  border: 1px solid rgba(34, 158, 217, 0.3);\n  color: white;\n}\n.telegram-btn:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 10px 20px -10px rgba(0, 136, 204, 0.5);\n}\n.google-btn {\n  background: rgba(255, 255, 255, 0.95);\n  border: 1px solid rgba(0, 0, 0, 0.1);\n  color: #333;\n}\n.google-btn:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 10px 20px -10px rgba(0, 0, 0, 0.2);\n}\n.oauth-icon {\n  width: 20px;\n  height: 20px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.oauth-text {\n  font-weight: 500;\n}\n.oauth-loading {\n  animation: spin 1s linear infinite;\n  margin-left: 0.25rem;\n}\n@keyframes spin {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n.divider {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  margin-bottom: 1.25rem;\n}\n.divider-line {\n  flex: 1;\n  height: 1px;\n  background:\n    linear-gradient(\n      90deg,\n      transparent,\n      rgba(148, 163, 184, 0.3),\n      transparent);\n}\n.divider-text {\n  font-size: 0.75rem;\n  color: #64748b;\n  white-space: nowrap;\n}\n.mode-tab {\n  flex: 1;\n  padding: 0.5rem 0.5rem;\n  font-size: 0.8rem;\n  color: #94a3b8;\n  border-radius: 0.5rem;\n  transition: all 0.2s;\n}\n.mode-tab:hover {\n  color: #e2e8f0;\n}\n.mode-tab.active {\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  color: white;\n  font-weight: 500;\n}\n.form-group {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.form-label {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: #e2e8f0;\n}\n.form-input {\n  width: 100%;\n  padding: 0.75rem 1rem;\n  background: rgba(15, 23, 42, 0.6);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.75rem;\n  color: white;\n  font-size: 0.875rem;\n  transition: all 0.2s;\n}\n.form-input:focus {\n  outline: none;\n  border-color: #06b6d4;\n  box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.2);\n}\n.form-input::placeholder {\n  color: #64748b;\n}\n.submit-button {\n  width: 100%;\n  padding: 0.875rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.75rem;\n  color: white;\n  font-size: 1rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.submit-button:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 10px 20px -10px rgba(6, 182, 212, 0.5);\n}\n.submit-button:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.error-message {\n  padding: 0.75rem 1rem;\n  background: rgba(239, 68, 68, 0.15);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  border-radius: 0.75rem;\n  color: #fca5a5;\n  font-size: 0.875rem;\n  margin-bottom: 1rem;\n  display: flex;\n  align-items: center;\n}\n.success-message {\n  padding: 0.75rem 1rem;\n  background: rgba(34, 197, 94, 0.15);\n  border: 1px solid rgba(34, 197, 94, 0.3);\n  border-radius: 0.75rem;\n  color: #86efac;\n  font-size: 0.875rem;\n  margin-bottom: 1rem;\n  display: flex;\n  align-items: center;\n}\n.linked-accounts-section {\n  margin-top: 1.25rem;\n  padding-top: 1rem;\n  border-top: 1px solid rgba(148, 163, 184, 0.1);\n}\n.linked-accounts {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.linked-account-btn {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.625rem 1rem;\n  background: rgba(15, 23, 42, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.15);\n  border-radius: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.linked-account-btn:hover {\n  background: rgba(15, 23, 42, 0.8);\n  border-color: rgba(148, 163, 184, 0.3);\n}\n.linked-account-btn.telegram:hover {\n  border-color: rgba(0, 136, 204, 0.5);\n}\n.linked-account-btn.google:hover {\n  border-color: rgba(234, 67, 53, 0.5);\n}\n.linked-avatar {\n  width: 36px;\n  height: 36px;\n  border-radius: 50%;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  color: white;\n  font-size: 0.875rem;\n  overflow: hidden;\n}\n.linked-info {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n}\n.linked-name {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: #e2e8f0;\n}\n.linked-provider {\n  font-size: 0.75rem;\n  color: #64748b;\n}\n/*# sourceMappingURL=login.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(LoginComponent, { className: "LoginComponent", filePath: "src/login.component.ts", lineNumber: 741 });
})();

// src/api-selector.component.ts
var _forTrack07 = ($index, $item) => $item.api_id;
function ApiSelectorComponent_Conditional_8_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 5);
    \u0275\u0275domElement(1, "span", 7);
    \u0275\u0275domElementStart(2, "span");
    \u0275\u0275text(3, "\u6B63\u5728\u5206\u6790\u6700\u4F73 API...");
    \u0275\u0275domElementEnd()();
  }
}
function ApiSelectorComponent_Conditional_8_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 8)(1, "div", 9);
    \u0275\u0275text(2, "\u2B50 \u63A8\u85A6");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(3, "div", 10)(4, "div", 11);
    \u0275\u0275text(5);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(6, "div", 12);
    \u0275\u0275text(7);
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(8, "div", 13)(9, "div", 14);
    \u0275\u0275domElement(10, "div", 15);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(11, "span", 16);
    \u0275\u0275text(12);
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(13, "button", 17);
    \u0275\u0275domListener("click", function ApiSelectorComponent_Conditional_8_Conditional_2_Template_button_click_13_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.useRecommended());
    });
    \u0275\u0275text(14, "\u4F7F\u7528\u6B64 API");
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(15, "p", 18);
    \u0275\u0275text(16, "\u{1F4A1} \u6B64 API \u8CA0\u8F09\u6700\u4F4E\uFF0C\u53EF\u7528\u7A7A\u9593\u5145\u8DB3");
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r1.safeDisplayName(ctx_r1.recommendedApi().name, ctx_r1.recommendedApi().api_id));
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("ID: ", ctx_r1.recommendedApi().api_id);
    \u0275\u0275advance(3);
    \u0275\u0275styleProp("width", ctx_r1.recommendedApi().account_count / ctx_r1.recommendedApi().max_accounts * 100, "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2("", ctx_r1.recommendedApi().account_count, "/", ctx_r1.recommendedApi().max_accounts);
  }
}
function ApiSelectorComponent_Conditional_8_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 6)(1, "span", 19);
    \u0275\u0275text(2, "\u{1F4ED}");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(3, "p");
    \u0275\u0275text(4, "\u66AB\u7121\u53EF\u7528\u7684 API");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(5, "p", 20);
    \u0275\u0275text(6, "\u8ACB\u5148\u6DFB\u52A0 API \u5230\u60A8\u7684 API \u6C60");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(7, "button", 21);
    \u0275\u0275domListener("click", function ApiSelectorComponent_Conditional_8_Conditional_3_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.selectMode("manual"));
    });
    \u0275\u0275text(8, "\u2795 \u6DFB\u52A0\u65B0 API");
    \u0275\u0275domElementEnd()();
  }
}
function ApiSelectorComponent_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 3);
    \u0275\u0275conditionalCreate(1, ApiSelectorComponent_Conditional_8_Conditional_1_Template, 4, 0, "div", 5)(2, ApiSelectorComponent_Conditional_8_Conditional_2_Template, 17, 6)(3, ApiSelectorComponent_Conditional_8_Conditional_3_Template, 9, 0, "div", 6);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isLoading() ? 1 : ctx_r1.recommendedApi() ? 2 : 3);
  }
}
function ApiSelectorComponent_Conditional_9_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 6)(1, "span", 19);
    \u0275\u0275text(2, "\u{1F4ED}");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(3, "p");
    \u0275\u0275text(4, "\u60A8\u9084\u6C92\u6709\u6DFB\u52A0\u4EFB\u4F55 API");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(5, "button", 21);
    \u0275\u0275domListener("click", function ApiSelectorComponent_Conditional_9_Conditional_1_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.selectMode("manual"));
    });
    \u0275\u0275text(6, "\u2795 \u6DFB\u52A0\u7B2C\u4E00\u500B API");
    \u0275\u0275domElementEnd()();
  }
}
function ApiSelectorComponent_Conditional_9_Conditional_2_For_2_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "span", 33);
    \u0275\u0275text(1, "\u505C\u7528");
    \u0275\u0275domElementEnd();
  }
}
function ApiSelectorComponent_Conditional_9_Conditional_2_For_2_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "span", 34);
    \u0275\u0275text(1, "\u5DF2\u6EFF");
    \u0275\u0275domElementEnd();
  }
}
function ApiSelectorComponent_Conditional_9_Conditional_2_For_2_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "span", 35);
    \u0275\u0275text(1, "\u63A8\u85A6");
    \u0275\u0275domElementEnd();
  }
}
function ApiSelectorComponent_Conditional_9_Conditional_2_For_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 27);
    \u0275\u0275domListener("click", function ApiSelectorComponent_Conditional_9_Conditional_2_For_2_Template_div_click_0_listener() {
      const api_r7 = \u0275\u0275restoreView(_r6).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.selectPoolApi(api_r7));
    });
    \u0275\u0275domElementStart(1, "div", 28)(2, "span", 29);
    \u0275\u0275text(3);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(4, "span", 30);
    \u0275\u0275text(5);
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(6, "div", 31)(7, "span", 32);
    \u0275\u0275text(8);
    \u0275\u0275domElementEnd();
    \u0275\u0275conditionalCreate(9, ApiSelectorComponent_Conditional_9_Conditional_2_For_2_Conditional_9_Template, 2, 0, "span", 33)(10, ApiSelectorComponent_Conditional_9_Conditional_2_For_2_Conditional_10_Template, 2, 0, "span", 34)(11, ApiSelectorComponent_Conditional_9_Conditional_2_For_2_Conditional_11_Template, 2, 0, "span", 35);
    \u0275\u0275domElementEnd()();
  }
  if (rf & 2) {
    let tmp_19_0;
    const api_r7 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275classProp("selected", ctx_r1.selectedPoolApi() === api_r7.api_id)("disabled", !api_r7.is_active || api_r7.account_count >= api_r7.max_accounts);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r1.safeDisplayName(api_r7.name, api_r7.api_id));
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("ID: ", api_r7.api_id);
    \u0275\u0275advance(2);
    \u0275\u0275classProp("warning", api_r7.account_count >= api_r7.max_accounts * 0.8)("full", api_r7.account_count >= api_r7.max_accounts);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", api_r7.account_count, "/", api_r7.max_accounts, " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(!api_r7.is_active ? 9 : api_r7.account_count >= api_r7.max_accounts ? 10 : ((tmp_19_0 = ctx_r1.recommendedApi()) == null ? null : tmp_19_0.api_id) === api_r7.api_id ? 11 : -1);
  }
}
function ApiSelectorComponent_Conditional_9_Conditional_2_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    const _r8 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "button", 36);
    \u0275\u0275domListener("click", function ApiSelectorComponent_Conditional_9_Conditional_2_Conditional_3_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r8);
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.confirmPoolSelection());
    });
    \u0275\u0275text(1, "\u78BA\u8A8D\u9078\u64C7");
    \u0275\u0275domElementEnd();
  }
}
function ApiSelectorComponent_Conditional_9_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 22);
    \u0275\u0275repeaterCreate(1, ApiSelectorComponent_Conditional_9_Conditional_2_For_2_Template, 12, 13, "div", 23, _forTrack07);
    \u0275\u0275domElementEnd();
    \u0275\u0275conditionalCreate(3, ApiSelectorComponent_Conditional_9_Conditional_2_Conditional_3_Template, 2, 0, "button", 24);
    \u0275\u0275domElementStart(4, "div", 25)(5, "button", 26);
    \u0275\u0275domListener("click", function ApiSelectorComponent_Conditional_9_Conditional_2_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.selectMode("manual"));
    });
    \u0275\u0275text(6, "\u2795 \u6DFB\u52A0\u65B0 API");
    \u0275\u0275domElementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r1.apiList());
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.selectedPoolApi() ? 3 : -1);
  }
}
function ApiSelectorComponent_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 3);
    \u0275\u0275conditionalCreate(1, ApiSelectorComponent_Conditional_9_Conditional_1_Template, 7, 0, "div", 6)(2, ApiSelectorComponent_Conditional_9_Conditional_2_Template, 7, 1);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.apiList().length === 0 ? 1 : 2);
  }
}
function ApiSelectorComponent_Conditional_10_Conditional_17_Template(rf, ctx) {
  if (rf & 1) {
    const _r10 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 37)(1, "label");
    \u0275\u0275text(2, "API \u540D\u7A31\uFF08\u53EF\u9078\uFF09");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(3, "input", 47);
    \u0275\u0275domListener("input", function ApiSelectorComponent_Conditional_10_Conditional_17_Template_input_input_3_listener($event) {
      \u0275\u0275restoreView(_r10);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.manualApiName.set($event.target.value));
    });
    \u0275\u0275domElementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(3);
    \u0275\u0275domProperty("value", ctx_r1.manualApiName());
  }
}
function ApiSelectorComponent_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    const _r9 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 3)(1, "div", 37)(2, "label");
    \u0275\u0275text(3, "API ID ");
    \u0275\u0275domElementStart(4, "span", 38);
    \u0275\u0275text(5, "*");
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(6, "input", 39);
    \u0275\u0275domListener("input", function ApiSelectorComponent_Conditional_10_Template_input_input_6_listener($event) {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.manualApiId.set($event.target.value));
    });
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(7, "div", 37)(8, "label");
    \u0275\u0275text(9, "API Hash ");
    \u0275\u0275domElementStart(10, "span", 38);
    \u0275\u0275text(11, "*");
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(12, "input", 40);
    \u0275\u0275domListener("input", function ApiSelectorComponent_Conditional_10_Template_input_input_12_listener($event) {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.manualApiHash.set($event.target.value));
    });
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(13, "div", 41)(14, "input", 42);
    \u0275\u0275domListener("change", function ApiSelectorComponent_Conditional_10_Template_input_change_14_listener($event) {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.saveToPool.set($event.target.checked));
    });
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(15, "label", 43);
    \u0275\u0275text(16, "\u4FDD\u5B58\u5230\u6211\u7684 API \u6C60\uFF08\u65B9\u4FBF\u4E0B\u6B21\u4F7F\u7528\uFF09");
    \u0275\u0275domElementEnd()();
    \u0275\u0275conditionalCreate(17, ApiSelectorComponent_Conditional_10_Conditional_17_Template, 4, 1, "div", 37);
    \u0275\u0275domElementStart(18, "button", 44);
    \u0275\u0275domListener("click", function ApiSelectorComponent_Conditional_10_Template_button_click_18_listener() {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.confirmManualInput());
    });
    \u0275\u0275text(19, " \u78BA\u8A8D\u4F7F\u7528 ");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(20, "div", 45)(21, "span");
    \u0275\u0275text(22, "\u{1F449}");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(23, "a", 46);
    \u0275\u0275text(24, "\u524D\u5F80\u7533\u8ACB API \u6191\u64DA");
    \u0275\u0275domElementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(6);
    \u0275\u0275domProperty("value", ctx_r1.manualApiId());
    \u0275\u0275advance(6);
    \u0275\u0275domProperty("value", ctx_r1.manualApiHash());
    \u0275\u0275advance(2);
    \u0275\u0275domProperty("checked", ctx_r1.saveToPool());
    \u0275\u0275advance(3);
    \u0275\u0275conditional(ctx_r1.saveToPool() ? 17 : -1);
    \u0275\u0275advance();
    \u0275\u0275domProperty("disabled", !ctx_r1.isManualValid());
  }
}
function ApiSelectorComponent_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    const _r11 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "div", 4)(1, "div", 48)(2, "span", 49);
    \u0275\u0275text(3, "\u5DF2\u9078\u64C7\uFF1A");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(4, "span", 50);
    \u0275\u0275text(5);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(6, "span", 51);
    \u0275\u0275text(7);
    \u0275\u0275domElementEnd()();
    \u0275\u0275domElementStart(8, "button", 52);
    \u0275\u0275domListener("click", function ApiSelectorComponent_Conditional_11_Template_button_click_8_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.clearSelection());
    });
    \u0275\u0275text(9, "\u2715");
    \u0275\u0275domElementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r1.safeDisplayName(ctx_r1.selectedApi().name, ctx_r1.selectedApi().api_id));
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("ID: ", ctx_r1.selectedApi().api_id);
  }
}
var ApiSelectorComponent = class _ApiSelectorComponent {
  constructor() {
    this.ipcService = inject(ElectronIpcService);
    this.toast = inject(ToastService);
    this.membershipService = inject(MembershipService);
    this.showSelected = true;
    this.apiSelected = new EventEmitter();
    this.selectionCleared = new EventEmitter();
    this.currentMode = signal("recommend", ...ngDevMode ? [{ debugName: "currentMode" }] : []);
    this.isLoading = signal(false, ...ngDevMode ? [{ debugName: "isLoading" }] : []);
    this.apiList = signal([], ...ngDevMode ? [{ debugName: "apiList" }] : []);
    this.selectedApi = signal(null, ...ngDevMode ? [{ debugName: "selectedApi" }] : []);
    this.recommendedApi = signal(null, ...ngDevMode ? [{ debugName: "recommendedApi" }] : []);
    this.selectedPoolApi = signal(null, ...ngDevMode ? [{ debugName: "selectedPoolApi" }] : []);
    this.manualApiId = signal("", ...ngDevMode ? [{ debugName: "manualApiId" }] : []);
    this.manualApiHash = signal("", ...ngDevMode ? [{ debugName: "manualApiHash" }] : []);
    this.manualApiName = signal("", ...ngDevMode ? [{ debugName: "manualApiName" }] : []);
    this.saveToPool = signal(true, ...ngDevMode ? [{ debugName: "saveToPool" }] : []);
    this.ipcChannels = [];
    this.isManualValid = computed(() => {
      const apiId = this.manualApiId();
      const apiHash = this.manualApiHash();
      return apiId && /^\d+$/.test(apiId) && apiHash && /^[a-f0-9]{32}$/i.test(apiHash);
    }, ...ngDevMode ? [{ debugName: "isManualValid" }] : []);
  }
  // 🆕 安全顯示 API 名稱（處理編碼問題）
  safeDisplayName(name, apiId) {
    if (!name)
      return `API ${apiId}`;
    const hasGarbledChars = /[\uFFFD\u0000-\u001F]/.test(name) || name.includes("\uFFFD") || // 檢測常見的編碼錯誤模式（如 Big5/GBK 被錯誤解碼）
    /[\uE000-\uF8FF]/.test(name) || // 檢測字符中有過多的私用區字符
    (name.match(/[\u4E00-\u9FFF]/g)?.length || 0) === 0 && /[^\x00-\x7F]/.test(name) && name.length < 10;
    if (hasGarbledChars) {
      return `API ${apiId}`;
    }
    const validChars = name.replace(/[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF\w\s\-_@#$%&*()+=\[\]{}|;:'",.<>?/\\]/g, "");
    if (validChars.length > name.length * 0.3) {
      return `API ${apiId}`;
    }
    return name;
  }
  ngOnInit() {
    this.setupIpcListeners();
    this.loadApiList();
  }
  ngOnDestroy() {
    this.ipcChannels.forEach((ch) => this.ipcService.cleanup(ch));
  }
  setupIpcListeners() {
    this.ipcService.on("api-credentials-updated", (data) => {
      this.isLoading.set(false);
      if (data.credentials) {
        const userApis = data.credentials.filter((c) => !c.is_public && c.is_active);
        this.apiList.set(userApis);
        this.findBestApi(userApis);
      }
    });
    this.ipcChannels.push("api-credentials-updated");
    this.ipcService.on("api-credential-added", (data) => {
      if (data.success) {
        this.toast.success("\u2705 API \u6191\u64DA\u5DF2\u4FDD\u5B58\u5230 API \u6C60");
        this.loadApiList();
      } else {
        this.toast.error(`\u4FDD\u5B58\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
      }
    });
    this.ipcChannels.push("api-credential-added");
  }
  loadApiList() {
    this.isLoading.set(true);
    this.ipcService.send("get-api-credentials", {});
  }
  findBestApi(apis) {
    const available = apis.filter((a) => a.is_active && a.account_count < a.max_accounts);
    if (available.length > 0) {
      available.sort((a, b) => a.account_count / a.max_accounts - b.account_count / b.max_accounts);
      this.recommendedApi.set(available[0]);
    } else {
      this.recommendedApi.set(null);
    }
  }
  selectMode(mode) {
    this.currentMode.set(mode);
  }
  useRecommended() {
    const api = this.recommendedApi();
    if (api && api.api_hash) {
      const safeName = this.safeDisplayName(api.name, api.api_id);
      const selected = {
        api_id: api.api_id,
        api_hash: api.api_hash,
        name: safeName,
        source: "pool"
      };
      this.selectedApi.set(selected);
      this.apiSelected.emit(selected);
      this.toast.success(`\u5DF2\u9078\u64C7 ${safeName}`);
    } else if (api) {
      this.toast.error("\u6B64 API \u7F3A\u5C11 Hash\uFF0C\u8ACB\u91CD\u65B0\u6DFB\u52A0");
    }
  }
  selectPoolApi(api) {
    if (!api.is_active || api.account_count >= api.max_accounts)
      return;
    this.selectedPoolApi.set(api.api_id);
  }
  confirmPoolSelection() {
    const apiId = this.selectedPoolApi();
    const api = this.apiList().find((a) => a.api_id === apiId);
    if (api && api.api_hash) {
      const safeName = this.safeDisplayName(api.name, api.api_id);
      const selected = {
        api_id: api.api_id,
        api_hash: api.api_hash,
        name: safeName,
        source: "pool"
      };
      this.selectedApi.set(selected);
      this.apiSelected.emit(selected);
      this.toast.success(`\u5DF2\u9078\u64C7 ${safeName}`);
    }
  }
  confirmManualInput() {
    if (!this.isManualValid())
      return;
    const apiId = this.manualApiId();
    const apiHash = this.manualApiHash();
    const apiName = this.manualApiName() || `API ${apiId}`;
    if (this.saveToPool()) {
      this.ipcService.send("add-api-credential", {
        api_id: apiId,
        api_hash: apiHash,
        name: apiName,
        source: "manual"
      });
    }
    const selected = {
      api_id: apiId,
      api_hash: apiHash,
      name: apiName,
      source: "manual"
    };
    this.selectedApi.set(selected);
    this.apiSelected.emit(selected);
    this.toast.success("API \u5DF2\u78BA\u8A8D");
  }
  clearSelection() {
    this.selectedApi.set(null);
    this.selectedPoolApi.set(null);
    this.manualApiId.set("");
    this.manualApiHash.set("");
    this.manualApiName.set("");
    this.selectionCleared.emit();
  }
  static {
    this.\u0275fac = function ApiSelectorComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _ApiSelectorComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _ApiSelectorComponent, selectors: [["app-api-selector"]], inputs: { showSelected: "showSelected" }, outputs: { apiSelected: "apiSelected", selectionCleared: "selectionCleared" }, decls: 12, vars: 10, consts: [[1, "api-selector"], [1, "mode-tabs"], [1, "mode-tab", 3, "click"], [1, "mode-content"], [1, "selected-display"], [1, "loading-state"], [1, "empty-state"], [1, "spinner"], [1, "recommended-card"], [1, "recommend-badge"], [1, "api-info"], [1, "api-name"], [1, "api-id"], [1, "api-quota"], [1, "quota-bar"], [1, "quota-fill"], [1, "quota-text"], [1, "use-btn", 3, "click"], [1, "recommend-reason"], [1, "empty-icon"], [1, "hint"], [1, "add-btn", 3, "click"], [1, "api-list"], [1, "api-item", 3, "selected", "disabled"], [1, "confirm-btn"], [1, "pool-footer"], [1, "add-more-btn", 3, "click"], [1, "api-item", 3, "click"], [1, "api-item-info"], [1, "api-item-name"], [1, "api-item-id"], [1, "api-item-right"], [1, "quota-badge"], [1, "status-badge", "inactive"], [1, "status-badge", "full"], [1, "status-badge", "recommend"], [1, "confirm-btn", 3, "click"], [1, "form-group"], [1, "required"], ["type", "text", "placeholder", "\u4F8B\u5982\uFF1A12345678", 1, "form-input", 3, "input", "value"], ["type", "text", "placeholder", "\u4F8B\u5982\uFF1Aa1b2c3d4e5f6g7h8...", 1, "form-input", 3, "input", "value"], [1, "save-option"], ["type", "checkbox", "id", "saveToPool", 3, "change", "checked"], ["for", "saveToPool"], [1, "confirm-btn", 3, "click", "disabled"], [1, "guide-link"], ["href", "https://my.telegram.org", "target", "_blank"], ["type", "text", "placeholder", "\u4F8B\u5982\uFF1A\u4E3B\u529B API", 1, "form-input", 3, "input", "value"], [1, "selected-info"], [1, "selected-label"], [1, "selected-name"], [1, "selected-id"], [1, "clear-btn", 3, "click"]], template: function ApiSelectorComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275domElementStart(0, "div", 0)(1, "div", 1)(2, "button", 2);
        \u0275\u0275domListener("click", function ApiSelectorComponent_Template_button_click_2_listener() {
          return ctx.selectMode("recommend");
        });
        \u0275\u0275text(3, " \u{1F3AF} \u667A\u80FD\u63A8\u85A6 ");
        \u0275\u0275domElementEnd();
        \u0275\u0275domElementStart(4, "button", 2);
        \u0275\u0275domListener("click", function ApiSelectorComponent_Template_button_click_4_listener() {
          return ctx.selectMode("pool");
        });
        \u0275\u0275text(5, " \u{1F4CB} \u6211\u7684 API ");
        \u0275\u0275domElementEnd();
        \u0275\u0275domElementStart(6, "button", 2);
        \u0275\u0275domListener("click", function ApiSelectorComponent_Template_button_click_6_listener() {
          return ctx.selectMode("manual");
        });
        \u0275\u0275text(7, " \u270F\uFE0F \u624B\u52D5\u8F38\u5165 ");
        \u0275\u0275domElementEnd()();
        \u0275\u0275conditionalCreate(8, ApiSelectorComponent_Conditional_8_Template, 4, 1, "div", 3);
        \u0275\u0275conditionalCreate(9, ApiSelectorComponent_Conditional_9_Template, 3, 1, "div", 3);
        \u0275\u0275conditionalCreate(10, ApiSelectorComponent_Conditional_10_Template, 25, 5, "div", 3);
        \u0275\u0275conditionalCreate(11, ApiSelectorComponent_Conditional_11_Template, 10, 2, "div", 4);
        \u0275\u0275domElementEnd();
      }
      if (rf & 2) {
        \u0275\u0275advance(2);
        \u0275\u0275classProp("active", ctx.currentMode() === "recommend");
        \u0275\u0275advance(2);
        \u0275\u0275classProp("active", ctx.currentMode() === "pool");
        \u0275\u0275advance(2);
        \u0275\u0275classProp("active", ctx.currentMode() === "manual");
        \u0275\u0275advance(2);
        \u0275\u0275conditional(ctx.currentMode() === "recommend" ? 8 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.currentMode() === "pool" ? 9 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.currentMode() === "manual" ? 10 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.selectedApi() && ctx.showSelected ? 11 : -1);
      }
    }, dependencies: [CommonModule, FormsModule], styles: ["\n\n.api-selector[_ngcontent-%COMP%] {\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border-radius: 0.75rem;\n  overflow: hidden;\n}\n.mode-tabs[_ngcontent-%COMP%] {\n  display: flex;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  padding: 0.25rem;\n}\n.mode-tab[_ngcontent-%COMP%] {\n  flex: 1;\n  padding: 0.625rem 0.5rem;\n  background: transparent;\n  border: none;\n  border-radius: 0.5rem;\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.8rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.mode-tab[_ngcontent-%COMP%]:hover {\n  color: var(--text-primary, white);\n}\n.mode-tab.active[_ngcontent-%COMP%] {\n  background: var(--primary, #06b6d4);\n  color: white;\n}\n.mode-content[_ngcontent-%COMP%] {\n  padding: 1rem;\n}\n.loading-state[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 2rem;\n  color: var(--text-muted, #94a3b8);\n}\n.empty-state[_ngcontent-%COMP%] {\n  text-align: center;\n  padding: 1.5rem;\n}\n.empty-icon[_ngcontent-%COMP%] {\n  font-size: 2rem;\n  display: block;\n  margin-bottom: 0.5rem;\n}\n.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n  margin: 0 0 0.25rem 0;\n  color: var(--text-secondary, #cbd5e1);\n}\n.empty-state[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n  margin-bottom: 1rem;\n}\n.add-btn[_ngcontent-%COMP%] {\n  padding: 0.5rem 1rem;\n  background: var(--primary, #06b6d4);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-size: 0.8rem;\n  cursor: pointer;\n}\n.recommended-card[_ngcontent-%COMP%] {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 2px solid var(--primary, #06b6d4);\n  border-radius: 0.75rem;\n  padding: 1rem;\n  position: relative;\n}\n.recommend-badge[_ngcontent-%COMP%] {\n  position: absolute;\n  top: -10px;\n  right: 12px;\n  padding: 0.25rem 0.75rem;\n  background: var(--primary, #06b6d4);\n  border-radius: 1rem;\n  font-size: 0.7rem;\n  color: white;\n  font-weight: 600;\n}\n.api-info[_ngcontent-%COMP%] {\n  margin-bottom: 0.75rem;\n}\n.api-name[_ngcontent-%COMP%] {\n  font-weight: 600;\n  color: var(--text-primary, white);\n  font-size: 1rem;\n}\n.api-id[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.api-quota[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  margin-bottom: 0.75rem;\n}\n.quota-bar[_ngcontent-%COMP%] {\n  flex: 1;\n  height: 6px;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 3px;\n  overflow: hidden;\n}\n.quota-fill[_ngcontent-%COMP%] {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #22c55e,\n      #06b6d4);\n  border-radius: 3px;\n}\n.quota-text[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-secondary, #cbd5e1);\n  min-width: 40px;\n}\n.use-btn[_ngcontent-%COMP%] {\n  width: 100%;\n  padding: 0.625rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 500;\n  cursor: pointer;\n}\n.recommend-reason[_ngcontent-%COMP%] {\n  margin: 0.75rem 0 0 0;\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n  text-align: center;\n}\n.api-list[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  max-height: 200px;\n  overflow-y: auto;\n}\n.api-item[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid transparent;\n  border-radius: 0.5rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.api-item[_ngcontent-%COMP%]:hover:not(.disabled) {\n  border-color: var(--primary, #06b6d4);\n}\n.api-item.selected[_ngcontent-%COMP%] {\n  border-color: var(--primary, #06b6d4);\n  background: rgba(6, 182, 212, 0.1);\n}\n.api-item.disabled[_ngcontent-%COMP%] {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.api-item-info[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n}\n.api-item-name[_ngcontent-%COMP%] {\n  font-weight: 500;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n}\n.api-item-id[_ngcontent-%COMP%] {\n  font-size: 0.7rem;\n  color: var(--text-muted, #94a3b8);\n}\n.api-item-right[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.quota-badge[_ngcontent-%COMP%] {\n  padding: 0.125rem 0.5rem;\n  background: rgba(34, 197, 94, 0.2);\n  border-radius: 0.25rem;\n  font-size: 0.7rem;\n  color: #86efac;\n}\n.quota-badge.warning[_ngcontent-%COMP%] {\n  background: rgba(245, 158, 11, 0.2);\n  color: #fcd34d;\n}\n.quota-badge.full[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #fca5a5;\n}\n.status-badge[_ngcontent-%COMP%] {\n  padding: 0.125rem 0.375rem;\n  border-radius: 0.25rem;\n  font-size: 0.65rem;\n  font-weight: 600;\n}\n.status-badge.recommend[_ngcontent-%COMP%] {\n  background: rgba(6, 182, 212, 0.2);\n  color: #67e8f9;\n}\n.status-badge.inactive[_ngcontent-%COMP%] {\n  background: rgba(148, 163, 184, 0.2);\n  color: #94a3b8;\n}\n.status-badge.full[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #fca5a5;\n}\n.confirm-btn[_ngcontent-%COMP%] {\n  width: 100%;\n  padding: 0.625rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 500;\n  cursor: pointer;\n  margin-top: 0.75rem;\n}\n.confirm-btn[_ngcontent-%COMP%]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.pool-footer[_ngcontent-%COMP%] {\n  margin-top: 0.75rem;\n  text-align: center;\n}\n.add-more-btn[_ngcontent-%COMP%] {\n  background: none;\n  border: none;\n  color: var(--primary, #06b6d4);\n  font-size: 0.8rem;\n  cursor: pointer;\n}\n.form-group[_ngcontent-%COMP%] {\n  margin-bottom: 0.75rem;\n}\n.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%] {\n  display: block;\n  margin-bottom: 0.25rem;\n  font-size: 0.8rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.required[_ngcontent-%COMP%] {\n  color: #ef4444;\n}\n.form-input[_ngcontent-%COMP%] {\n  width: 100%;\n  padding: 0.5rem 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n  box-sizing: border-box;\n}\n.form-input[_ngcontent-%COMP%]:focus {\n  outline: none;\n  border-color: var(--primary, #06b6d4);\n}\n.save-option[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 0.75rem;\n  font-size: 0.8rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.save-option[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] {\n  accent-color: var(--primary, #06b6d4);\n}\n.guide-link[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.25rem;\n  margin-top: 0.75rem;\n  font-size: 0.75rem;\n}\n.guide-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] {\n  color: var(--primary, #06b6d4);\n}\n.selected-display[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem 1rem;\n  background: rgba(34, 197, 94, 0.1);\n  border-top: 1px solid rgba(34, 197, 94, 0.2);\n}\n.selected-info[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.selected-label[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.selected-name[_ngcontent-%COMP%] {\n  font-weight: 500;\n  color: #86efac;\n}\n.selected-id[_ngcontent-%COMP%] {\n  font-size: 0.7rem;\n  color: var(--text-muted, #94a3b8);\n}\n.clear-btn[_ngcontent-%COMP%] {\n  background: none;\n  border: none;\n  color: var(--text-muted, #94a3b8);\n  cursor: pointer;\n  font-size: 1rem;\n}\n.spinner[_ngcontent-%COMP%] {\n  width: 16px;\n  height: 16px;\n  border: 2px solid rgba(255, 255, 255, 0.3);\n  border-top-color: var(--primary, #06b6d4);\n  border-radius: 50%;\n  animation: _ngcontent-%COMP%_spin 0.8s linear infinite;\n}\n@keyframes _ngcontent-%COMP%_spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n/*# sourceMappingURL=api-selector.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(ApiSelectorComponent, [{
    type: Component,
    args: [{ selector: "app-api-selector", standalone: true, imports: [CommonModule, FormsModule], template: `
    <div class="api-selector">
      <!-- \u6A21\u5F0F Tab -->
      <div class="mode-tabs">
        <button 
          (click)="selectMode('recommend')"
          [class.active]="currentMode() === 'recommend'"
          class="mode-tab">
          \u{1F3AF} \u667A\u80FD\u63A8\u85A6
        </button>
        <button 
          (click)="selectMode('pool')"
          [class.active]="currentMode() === 'pool'"
          class="mode-tab">
          \u{1F4CB} \u6211\u7684 API
        </button>
        <button 
          (click)="selectMode('manual')"
          [class.active]="currentMode() === 'manual'"
          class="mode-tab">
          \u270F\uFE0F \u624B\u52D5\u8F38\u5165
        </button>
      </div>

      <!-- \u667A\u80FD\u63A8\u85A6\u6A21\u5F0F -->
      @if (currentMode() === 'recommend') {
        <div class="mode-content">
          @if (isLoading()) {
            <div class="loading-state">
              <span class="spinner"></span>
              <span>\u6B63\u5728\u5206\u6790\u6700\u4F73 API...</span>
            </div>
          } @else if (recommendedApi()) {
            <div class="recommended-card">
              <div class="recommend-badge">\u2B50 \u63A8\u85A6</div>
              <div class="api-info">
                <div class="api-name">{{ safeDisplayName(recommendedApi()!.name, recommendedApi()!.api_id) }}</div>
                <div class="api-id">ID: {{ recommendedApi()!.api_id }}</div>
              </div>
              <div class="api-quota">
                <div class="quota-bar">
                  <div class="quota-fill" 
                       [style.width.%]="(recommendedApi()!.account_count / recommendedApi()!.max_accounts) * 100">
                  </div>
                </div>
                <span class="quota-text">{{ recommendedApi()!.account_count }}/{{ recommendedApi()!.max_accounts }}</span>
              </div>
              <button (click)="useRecommended()" class="use-btn">\u4F7F\u7528\u6B64 API</button>
            </div>
            <p class="recommend-reason">\u{1F4A1} \u6B64 API \u8CA0\u8F09\u6700\u4F4E\uFF0C\u53EF\u7528\u7A7A\u9593\u5145\u8DB3</p>
          } @else {
            <div class="empty-state">
              <span class="empty-icon">\u{1F4ED}</span>
              <p>\u66AB\u7121\u53EF\u7528\u7684 API</p>
              <p class="hint">\u8ACB\u5148\u6DFB\u52A0 API \u5230\u60A8\u7684 API \u6C60</p>
              <button (click)="selectMode('manual')" class="add-btn">\u2795 \u6DFB\u52A0\u65B0 API</button>
            </div>
          }
        </div>
      }

      <!-- \u6211\u7684 API \u6C60\u6A21\u5F0F -->
      @if (currentMode() === 'pool') {
        <div class="mode-content">
          @if (apiList().length === 0) {
            <div class="empty-state">
              <span class="empty-icon">\u{1F4ED}</span>
              <p>\u60A8\u9084\u6C92\u6709\u6DFB\u52A0\u4EFB\u4F55 API</p>
              <button (click)="selectMode('manual')" class="add-btn">\u2795 \u6DFB\u52A0\u7B2C\u4E00\u500B API</button>
            </div>
          } @else {
            <div class="api-list">
              @for (api of apiList(); track api.api_id) {
                <div 
                  class="api-item" 
                  [class.selected]="selectedPoolApi() === api.api_id"
                  [class.disabled]="!api.is_active || api.account_count >= api.max_accounts"
                  (click)="selectPoolApi(api)">
                  <div class="api-item-info">
                    <span class="api-item-name">{{ safeDisplayName(api.name, api.api_id) }}</span>
                    <span class="api-item-id">ID: {{ api.api_id }}</span>
                  </div>
                  <div class="api-item-right">
                    <span class="quota-badge" 
                          [class.warning]="api.account_count >= api.max_accounts * 0.8"
                          [class.full]="api.account_count >= api.max_accounts">
                      {{ api.account_count }}/{{ api.max_accounts }}
                    </span>
                    @if (!api.is_active) {
                      <span class="status-badge inactive">\u505C\u7528</span>
                    } @else if (api.account_count >= api.max_accounts) {
                      <span class="status-badge full">\u5DF2\u6EFF</span>
                    } @else if (recommendedApi()?.api_id === api.api_id) {
                      <span class="status-badge recommend">\u63A8\u85A6</span>
                    }
                  </div>
                </div>
              }
            </div>
            
            @if (selectedPoolApi()) {
              <button (click)="confirmPoolSelection()" class="confirm-btn">\u78BA\u8A8D\u9078\u64C7</button>
            }
            
            <div class="pool-footer">
              <button (click)="selectMode('manual')" class="add-more-btn">\u2795 \u6DFB\u52A0\u65B0 API</button>
            </div>
          }
        </div>
      }

      <!-- \u624B\u52D5\u8F38\u5165\u6A21\u5F0F -->
      @if (currentMode() === 'manual') {
        <div class="mode-content">
          <div class="form-group">
            <label>API ID <span class="required">*</span></label>
            <input 
              type="text"
              [value]="manualApiId()"
              (input)="manualApiId.set($any($event.target).value)"
              placeholder="\u4F8B\u5982\uFF1A12345678"
              class="form-input">
          </div>
          
          <div class="form-group">
            <label>API Hash <span class="required">*</span></label>
            <input 
              type="text"
              [value]="manualApiHash()"
              (input)="manualApiHash.set($any($event.target).value)"
              placeholder="\u4F8B\u5982\uFF1Aa1b2c3d4e5f6g7h8..."
              class="form-input">
          </div>
          
          <div class="save-option">
            <input type="checkbox" [checked]="saveToPool()" (change)="saveToPool.set($any($event.target).checked)" id="saveToPool">
            <label for="saveToPool">\u4FDD\u5B58\u5230\u6211\u7684 API \u6C60\uFF08\u65B9\u4FBF\u4E0B\u6B21\u4F7F\u7528\uFF09</label>
          </div>
          
          @if (saveToPool()) {
            <div class="form-group">
              <label>API \u540D\u7A31\uFF08\u53EF\u9078\uFF09</label>
              <input 
                type="text"
                [value]="manualApiName()"
                (input)="manualApiName.set($any($event.target).value)"
                placeholder="\u4F8B\u5982\uFF1A\u4E3B\u529B API"
                class="form-input">
            </div>
          }
          
          <button 
            (click)="confirmManualInput()" 
            [disabled]="!isManualValid()"
            class="confirm-btn">
            \u78BA\u8A8D\u4F7F\u7528
          </button>
          
          <!-- \u7C21\u6F54\u7684\u7533\u8ACB\u6307\u5357 -->
          <div class="guide-link">
            <span>\u{1F449}</span>
            <a href="https://my.telegram.org" target="_blank">\u524D\u5F80\u7533\u8ACB API \u6191\u64DA</a>
          </div>
        </div>
      }

      <!-- \u5DF2\u9078\u64C7\u7684 API \u986F\u793A -->
      @if (selectedApi() && showSelected) {
        <div class="selected-display">
          <div class="selected-info">
            <span class="selected-label">\u5DF2\u9078\u64C7\uFF1A</span>
            <span class="selected-name">{{ safeDisplayName(selectedApi()!.name, selectedApi()!.api_id) }}</span>
            <span class="selected-id">ID: {{ selectedApi()!.api_id }}</span>
          </div>
          <button (click)="clearSelection()" class="clear-btn">\u2715</button>
        </div>
      }
    </div>
  `, styles: ["/* angular:styles/component:css;5e3c74b54d83ee9420d492b807c2e04f9d2a1b63ce0f1c47f9821b26af891f08;D:/tgkz2026/src/api-selector.component.ts */\n.api-selector {\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border-radius: 0.75rem;\n  overflow: hidden;\n}\n.mode-tabs {\n  display: flex;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  padding: 0.25rem;\n}\n.mode-tab {\n  flex: 1;\n  padding: 0.625rem 0.5rem;\n  background: transparent;\n  border: none;\n  border-radius: 0.5rem;\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.8rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.mode-tab:hover {\n  color: var(--text-primary, white);\n}\n.mode-tab.active {\n  background: var(--primary, #06b6d4);\n  color: white;\n}\n.mode-content {\n  padding: 1rem;\n}\n.loading-state {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 2rem;\n  color: var(--text-muted, #94a3b8);\n}\n.empty-state {\n  text-align: center;\n  padding: 1.5rem;\n}\n.empty-icon {\n  font-size: 2rem;\n  display: block;\n  margin-bottom: 0.5rem;\n}\n.empty-state p {\n  margin: 0 0 0.25rem 0;\n  color: var(--text-secondary, #cbd5e1);\n}\n.empty-state .hint {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n  margin-bottom: 1rem;\n}\n.add-btn {\n  padding: 0.5rem 1rem;\n  background: var(--primary, #06b6d4);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-size: 0.8rem;\n  cursor: pointer;\n}\n.recommended-card {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 2px solid var(--primary, #06b6d4);\n  border-radius: 0.75rem;\n  padding: 1rem;\n  position: relative;\n}\n.recommend-badge {\n  position: absolute;\n  top: -10px;\n  right: 12px;\n  padding: 0.25rem 0.75rem;\n  background: var(--primary, #06b6d4);\n  border-radius: 1rem;\n  font-size: 0.7rem;\n  color: white;\n  font-weight: 600;\n}\n.api-info {\n  margin-bottom: 0.75rem;\n}\n.api-name {\n  font-weight: 600;\n  color: var(--text-primary, white);\n  font-size: 1rem;\n}\n.api-id {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.api-quota {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  margin-bottom: 0.75rem;\n}\n.quota-bar {\n  flex: 1;\n  height: 6px;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 3px;\n  overflow: hidden;\n}\n.quota-fill {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #22c55e,\n      #06b6d4);\n  border-radius: 3px;\n}\n.quota-text {\n  font-size: 0.75rem;\n  color: var(--text-secondary, #cbd5e1);\n  min-width: 40px;\n}\n.use-btn {\n  width: 100%;\n  padding: 0.625rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 500;\n  cursor: pointer;\n}\n.recommend-reason {\n  margin: 0.75rem 0 0 0;\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n  text-align: center;\n}\n.api-list {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  max-height: 200px;\n  overflow-y: auto;\n}\n.api-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid transparent;\n  border-radius: 0.5rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.api-item:hover:not(.disabled) {\n  border-color: var(--primary, #06b6d4);\n}\n.api-item.selected {\n  border-color: var(--primary, #06b6d4);\n  background: rgba(6, 182, 212, 0.1);\n}\n.api-item.disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.api-item-info {\n  display: flex;\n  flex-direction: column;\n}\n.api-item-name {\n  font-weight: 500;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n}\n.api-item-id {\n  font-size: 0.7rem;\n  color: var(--text-muted, #94a3b8);\n}\n.api-item-right {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.quota-badge {\n  padding: 0.125rem 0.5rem;\n  background: rgba(34, 197, 94, 0.2);\n  border-radius: 0.25rem;\n  font-size: 0.7rem;\n  color: #86efac;\n}\n.quota-badge.warning {\n  background: rgba(245, 158, 11, 0.2);\n  color: #fcd34d;\n}\n.quota-badge.full {\n  background: rgba(239, 68, 68, 0.2);\n  color: #fca5a5;\n}\n.status-badge {\n  padding: 0.125rem 0.375rem;\n  border-radius: 0.25rem;\n  font-size: 0.65rem;\n  font-weight: 600;\n}\n.status-badge.recommend {\n  background: rgba(6, 182, 212, 0.2);\n  color: #67e8f9;\n}\n.status-badge.inactive {\n  background: rgba(148, 163, 184, 0.2);\n  color: #94a3b8;\n}\n.status-badge.full {\n  background: rgba(239, 68, 68, 0.2);\n  color: #fca5a5;\n}\n.confirm-btn {\n  width: 100%;\n  padding: 0.625rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 500;\n  cursor: pointer;\n  margin-top: 0.75rem;\n}\n.confirm-btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.pool-footer {\n  margin-top: 0.75rem;\n  text-align: center;\n}\n.add-more-btn {\n  background: none;\n  border: none;\n  color: var(--primary, #06b6d4);\n  font-size: 0.8rem;\n  cursor: pointer;\n}\n.form-group {\n  margin-bottom: 0.75rem;\n}\n.form-group label {\n  display: block;\n  margin-bottom: 0.25rem;\n  font-size: 0.8rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.required {\n  color: #ef4444;\n}\n.form-input {\n  width: 100%;\n  padding: 0.5rem 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n  box-sizing: border-box;\n}\n.form-input:focus {\n  outline: none;\n  border-color: var(--primary, #06b6d4);\n}\n.save-option {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-bottom: 0.75rem;\n  font-size: 0.8rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.save-option input {\n  accent-color: var(--primary, #06b6d4);\n}\n.guide-link {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.25rem;\n  margin-top: 0.75rem;\n  font-size: 0.75rem;\n}\n.guide-link a {\n  color: var(--primary, #06b6d4);\n}\n.selected-display {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem 1rem;\n  background: rgba(34, 197, 94, 0.1);\n  border-top: 1px solid rgba(34, 197, 94, 0.2);\n}\n.selected-info {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.selected-label {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.selected-name {\n  font-weight: 500;\n  color: #86efac;\n}\n.selected-id {\n  font-size: 0.7rem;\n  color: var(--text-muted, #94a3b8);\n}\n.clear-btn {\n  background: none;\n  border: none;\n  color: var(--text-muted, #94a3b8);\n  cursor: pointer;\n  font-size: 1rem;\n}\n.spinner {\n  width: 16px;\n  height: 16px;\n  border: 2px solid rgba(255, 255, 255, 0.3);\n  border-top-color: var(--primary, #06b6d4);\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n/*# sourceMappingURL=api-selector.component.css.map */\n"] }]
  }], null, { showSelected: [{
    type: Input
  }], apiSelected: [{
    type: Output
  }], selectionCleared: [{
    type: Output
  }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(ApiSelectorComponent, { className: "ApiSelectorComponent", filePath: "src/api-selector.component.ts", lineNumber: 624 });
})();

// src/qr-login.component.ts
function QrLoginComponent_Conditional_9_Conditional_36_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "span", 21);
    \u0275\u0275text(1, " \u751F\u6210\u4E2D... ");
  }
}
function QrLoginComponent_Conditional_9_Conditional_37_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u{1F4F7} \u751F\u6210\u4E8C\u7DAD\u78BC ");
  }
}
function QrLoginComponent_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 6)(1, "div", 7)(2, "p");
    \u0275\u0275text(3, "\u4F7F\u7528 Telegram App \u6383\u63CF\u4E8C\u7DAD\u78BC\uFF0C\u5FEB\u901F\u6DFB\u52A0\u5E33\u865F\u3002");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(4, "div", 8)(5, "label", 9);
    \u0275\u0275text(6, "\u{1F510} \u9078\u64C7 API \u6191\u64DA");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "app-api-selector", 10);
    \u0275\u0275listener("apiSelected", function QrLoginComponent_Conditional_9_Template_app_api_selector_apiSelected_7_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.onApiSelected($event));
    })("selectionCleared", function QrLoginComponent_Conditional_9_Template_app_api_selector_selectionCleared_7_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.onApiCleared());
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(8, "div", 8)(9, "label", 9);
    \u0275\u0275text(10, "\u{1F4F2} \u8A2D\u5099\u6A21\u64EC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "div", 11)(12, "button", 12);
    \u0275\u0275listener("click", function QrLoginComponent_Conditional_9_Template_button_click_12_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.deviceType.set("random"));
    });
    \u0275\u0275text(13, " \u{1F3B2} \u667A\u80FD\u96A8\u6A5F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "button", 12);
    \u0275\u0275listener("click", function QrLoginComponent_Conditional_9_Template_button_click_14_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.deviceType.set("ios"));
    });
    \u0275\u0275text(15, " \u{1F4F1} iOS ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "button", 12);
    \u0275\u0275listener("click", function QrLoginComponent_Conditional_9_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.deviceType.set("android"));
    });
    \u0275\u0275text(17, " \u{1F916} Android ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "button", 12);
    \u0275\u0275listener("click", function QrLoginComponent_Conditional_9_Template_button_click_18_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.deviceType.set("desktop"));
    });
    \u0275\u0275text(19, " \u{1F4BB} Desktop ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(20, "div", 8)(21, "label", 9);
    \u0275\u0275text(22, "\u{1F310} \u4EE3\u7406\u8A2D\u7F6E\uFF08\u53EF\u9078\uFF09");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(23, "div", 13)(24, "input", 14);
    \u0275\u0275twoWayListener("ngModelChange", function QrLoginComponent_Conditional_9_Template_input_ngModelChange_24_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.proxyInput, $event) || (ctx_r1.proxyInput = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(25, "button", 15);
    \u0275\u0275listener("click", function QrLoginComponent_Conditional_9_Template_button_click_25_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.selectRandomProxy());
    });
    \u0275\u0275text(26, " \u{1F3B2} ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(27, "div", 16)(28, "input", 17);
    \u0275\u0275twoWayListener("ngModelChange", function QrLoginComponent_Conditional_9_Template_input_ngModelChange_28_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.bindProxyToAccount, $event) || (ctx_r1.bindProxyToAccount = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(29, "label", 18);
    \u0275\u0275text(30, "\u70BA\u6B64\u5E33\u865F\u7D81\u5B9A\u6B64\u4EE3\u7406 IP\uFF08\u63A8\u85A6\uFF09");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(31, "div", 8)(32, "label", 9);
    \u0275\u0275text(33, "\u{1F510} \u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF08\u5982\u6709\uFF09");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(34, "input", 19);
    \u0275\u0275twoWayListener("ngModelChange", function QrLoginComponent_Conditional_9_Template_input_ngModelChange_34_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.twoFactorPassword, $event) || (ctx_r1.twoFactorPassword = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(35, "button", 20);
    \u0275\u0275listener("click", function QrLoginComponent_Conditional_9_Template_button_click_35_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.createQRLogin());
    });
    \u0275\u0275conditionalCreate(36, QrLoginComponent_Conditional_9_Conditional_36_Template, 2, 0)(37, QrLoginComponent_Conditional_9_Conditional_37_Template, 1, 0);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(7);
    \u0275\u0275property("showSelected", false);
    \u0275\u0275advance(5);
    \u0275\u0275classProp("active", ctx_r1.deviceType() === "random");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("active", ctx_r1.deviceType() === "ios");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("active", ctx_r1.deviceType() === "android");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("active", ctx_r1.deviceType() === "desktop");
    \u0275\u0275advance(6);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.proxyInput);
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.bindProxyToAccount);
    \u0275\u0275advance(6);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.twoFactorPassword);
    \u0275\u0275advance();
    \u0275\u0275property("disabled", ctx_r1.isCreating() || !ctx_r1.selectedApi());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isCreating() ? 36 : 37);
  }
}
function QrLoginComponent_Conditional_10_Case_1_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "img", 28);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275property("src", "data:image/png;base64," + ctx_r1.session().qrImageBase64, \u0275\u0275sanitizeUrl);
  }
}
function QrLoginComponent_Conditional_10_Case_1_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 29);
    \u0275\u0275element(1, "span", 36);
    \u0275\u0275elementEnd();
  }
}
function QrLoginComponent_Conditional_10_Case_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 27);
    \u0275\u0275conditionalCreate(1, QrLoginComponent_Conditional_10_Case_1_Conditional_1_Template, 1, 1, "img", 28)(2, QrLoginComponent_Conditional_10_Case_1_Conditional_2_Template, 2, 0, "div", 29);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 30)(4, "div", 31);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "p", 32);
    \u0275\u0275text(7, " 1. \u6253\u958B Telegram App");
    \u0275\u0275element(8, "br");
    \u0275\u0275text(9, " 2. \u8A2D\u7F6E \u2192 \u8A2D\u5099 \u2192 \u6383\u63CF\u4E8C\u7DAD\u78BC");
    \u0275\u0275element(10, "br");
    \u0275\u0275text(11, " 3. \u6383\u63CF\u4E0A\u65B9\u4E8C\u7DAD\u78BC\u4E26\u78BA\u8A8D\u767B\u5165 ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(12, "div", 33)(13, "span", 34);
    \u0275\u0275text(14, "\u6A21\u64EC\u8A2D\u5099:");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "span", 35);
    \u0275\u0275text(16);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    let tmp_5_0;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.session().qrImageBase64 ? 1 : 2);
    \u0275\u0275advance(3);
    \u0275\u0275classProp("warning", ctx_r1.countdown() <= 10);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u23F1\uFE0F \u6709\u6548\u671F\uFF1A", ctx_r1.countdown(), " \u79D2 ");
    \u0275\u0275advance(11);
    \u0275\u0275textInterpolate2("", (tmp_5_0 = ctx_r1.session().deviceInfo) == null ? null : tmp_5_0.model, " (", (tmp_5_0 = ctx_r1.session().deviceInfo) == null ? null : tmp_5_0.system, ")");
  }
}
function QrLoginComponent_Conditional_10_Case_2_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "span", 21);
    \u0275\u0275text(1, " \u9A57\u8B49\u4E2D... ");
  }
}
function QrLoginComponent_Conditional_10_Case_2_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u78BA\u8A8D ");
  }
}
function QrLoginComponent_Conditional_10_Case_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 23)(1, "div", 37);
    \u0275\u0275text(2, "\u{1F510}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "h4");
    \u0275\u0275text(4, "\u9700\u8981\u4E8C\u6B65\u9A57\u8B49");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p");
    \u0275\u0275text(6, "\u8ACB\u8F38\u5165\u60A8\u7684\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "input", 38);
    \u0275\u0275twoWayListener("ngModelChange", function QrLoginComponent_Conditional_10_Case_2_Template_input_ngModelChange_7_listener($event) {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.twoFactorInput, $event) || (ctx_r1.twoFactorInput = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275listener("keyup.enter", function QrLoginComponent_Conditional_10_Case_2_Template_input_keyup_enter_7_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.submit2FA());
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "button", 39);
    \u0275\u0275listener("click", function QrLoginComponent_Conditional_10_Case_2_Template_button_click_8_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.submit2FA());
    });
    \u0275\u0275conditionalCreate(9, QrLoginComponent_Conditional_10_Case_2_Conditional_9_Template, 2, 0)(10, QrLoginComponent_Conditional_10_Case_2_Conditional_10_Template, 1, 0);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(7);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.twoFactorInput);
    \u0275\u0275advance();
    \u0275\u0275property("disabled", !ctx_r1.twoFactorInput || ctx_r1.isSubmitting2FA());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isSubmitting2FA() ? 9 : 10);
  }
}
function QrLoginComponent_Conditional_10_Case_3_Conditional_5_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275textInterpolate1(" ", ctx_r1.session().userInfo.lastName, " ");
  }
}
function QrLoginComponent_Conditional_10_Case_3_Conditional_5_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 48);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate("@" + ctx_r1.session().userInfo.username);
  }
}
function QrLoginComponent_Conditional_10_Case_3_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 41)(1, "div", 44);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 45)(4, "div", 46);
    \u0275\u0275text(5);
    \u0275\u0275conditionalCreate(6, QrLoginComponent_Conditional_10_Case_3_Conditional_5_Conditional_6_Template, 1, 1);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div", 47);
    \u0275\u0275text(8);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(9, QrLoginComponent_Conditional_10_Case_3_Conditional_5_Conditional_9_Template, 2, 1, "div", 48);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", (ctx_r1.session().userInfo.firstName || "?").charAt(0).toUpperCase(), " ");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", ctx_r1.session().userInfo.firstName, " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.session().userInfo.lastName ? 6 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r1.session().phone);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.session().userInfo.username ? 9 : -1);
  }
}
function QrLoginComponent_Conditional_10_Case_3_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 24)(1, "div", 40);
    \u0275\u0275text(2, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "h4");
    \u0275\u0275text(4, "\u767B\u5165\u6210\u529F\uFF01");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(5, QrLoginComponent_Conditional_10_Case_3_Conditional_5_Template, 10, 5, "div", 41);
    \u0275\u0275elementStart(6, "p", 42);
    \u0275\u0275text(7, "\u5E33\u865F\u5DF2\u6210\u529F\u6DFB\u52A0\uFF0C\u6B63\u5728\u5F8C\u53F0\u5347\u7D1A\u70BA\u539F\u751F API...");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "button", 43);
    \u0275\u0275listener("click", function QrLoginComponent_Conditional_10_Case_3_Template_button_click_8_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.onClose());
    });
    \u0275\u0275text(9, "\u5B8C\u6210");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(5);
    \u0275\u0275conditional(ctx_r1.session().userInfo ? 5 : -1);
  }
}
function QrLoginComponent_Conditional_10_Case_4_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 25)(1, "div", 37);
    \u0275\u0275text(2, "\u23F0");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "h4");
    \u0275\u0275text(4, "\u4E8C\u7DAD\u78BC\u5DF2\u904E\u671F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p");
    \u0275\u0275text(6, "\u8ACB\u9EDE\u64CA\u4E0B\u65B9\u6309\u9215\u91CD\u65B0\u751F\u6210\u3002");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "button", 49);
    \u0275\u0275listener("click", function QrLoginComponent_Conditional_10_Case_4_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.refreshQR());
    });
    \u0275\u0275text(8, "\u{1F504} \u91CD\u65B0\u751F\u6210");
    \u0275\u0275elementEnd()();
  }
}
function QrLoginComponent_Conditional_10_Case_5_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 25)(1, "div", 50);
    \u0275\u0275text(2, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "h4");
    \u0275\u0275text(4, "\u767B\u5165\u5931\u6557");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p");
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "button", 49);
    \u0275\u0275listener("click", function QrLoginComponent_Conditional_10_Case_5_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.refreshQR());
    });
    \u0275\u0275text(8, "\u{1F504} \u91CD\u8A66");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(6);
    \u0275\u0275textInterpolate(ctx_r1.session().message || "\u672A\u77E5\u932F\u8AA4");
  }
}
function QrLoginComponent_Conditional_10_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 26)(1, "button", 51);
    \u0275\u0275listener("click", function QrLoginComponent_Conditional_10_Conditional_6_Template_button_click_1_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.refreshQR());
    });
    \u0275\u0275text(2, " \u{1F504} \u5237\u65B0\u4E8C\u7DAD\u78BC ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "button", 52);
    \u0275\u0275listener("click", function QrLoginComponent_Conditional_10_Conditional_6_Template_button_click_3_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.cancelLogin());
    });
    \u0275\u0275text(4, " \u274C \u53D6\u6D88 ");
    \u0275\u0275elementEnd()();
  }
}
function QrLoginComponent_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 22);
    \u0275\u0275conditionalCreate(1, QrLoginComponent_Conditional_10_Case_1_Template, 17, 6)(2, QrLoginComponent_Conditional_10_Case_2_Template, 11, 3, "div", 23)(3, QrLoginComponent_Conditional_10_Case_3_Template, 10, 1, "div", 24)(4, QrLoginComponent_Conditional_10_Case_4_Template, 9, 0, "div", 25)(5, QrLoginComponent_Conditional_10_Case_5_Template, 9, 1, "div", 25);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(6, QrLoginComponent_Conditional_10_Conditional_6_Template, 5, 0, "div", 26);
  }
  if (rf & 2) {
    let tmp_1_0;
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275conditional((tmp_1_0 = ctx_r1.session().status) === "pending" ? 1 : tmp_1_0 === "waiting_2fa" ? 2 : tmp_1_0 === "success" ? 3 : tmp_1_0 === "expired" ? 4 : tmp_1_0 === "error" ? 5 : -1);
    \u0275\u0275advance(5);
    \u0275\u0275conditional(ctx_r1.session().status === "pending" ? 6 : -1);
  }
}
var QrLoginComponent = class _QrLoginComponent {
  constructor() {
    this.ipcService = inject(ElectronIpcService);
    this.toast = inject(ToastService);
    this.i18n = inject(I18nService);
    this.closed = new EventEmitter();
    this.loginSuccess = new EventEmitter();
    this.session = signal(null, ...ngDevMode ? [{ debugName: "session" }] : []);
    this.isCreating = signal(false, ...ngDevMode ? [{ debugName: "isCreating" }] : []);
    this.isSubmitting2FA = signal(false, ...ngDevMode ? [{ debugName: "isSubmitting2FA" }] : []);
    this.countdown = signal(60, ...ngDevMode ? [{ debugName: "countdown" }] : []);
    this.deviceType = signal("random", ...ngDevMode ? [{ debugName: "deviceType" }] : []);
    this.proxyInput = "";
    this.twoFactorPassword = "";
    this.twoFactorInput = "";
    this.bindProxyToAccount = true;
    this.selectedApi = signal(null, ...ngDevMode ? [{ debugName: "selectedApi" }] : []);
    this.countdownTimer = null;
    this.statusCheckTimer = null;
    this.createTimeout = null;
    this.ipcChannels = [];
  }
  ngOnInit() {
    this.setupIpcListeners();
  }
  // API 選擇回調
  onApiSelected(api) {
    this.selectedApi.set(api);
  }
  onApiCleared() {
    this.selectedApi.set(null);
  }
  ngOnDestroy() {
    this.clearTimers();
    if (this.createTimeout) {
      clearTimeout(this.createTimeout);
      this.createTimeout = null;
    }
    this.ipcChannels.forEach((channel) => {
      this.ipcService.cleanup(channel);
    });
    this.ipcChannels = [];
  }
  setupIpcListeners() {
    this.ipcService.on("qr-login-created", (result) => {
      if (this.createTimeout) {
        clearTimeout(this.createTimeout);
        this.createTimeout = null;
      }
      this.isCreating.set(false);
      console.log("[QR Login] QR code created successfully", result);
      if (result.success !== false) {
        this.session.set({
          sessionId: result.sessionId,
          qrUrl: result.qrUrl,
          qrImageBase64: result.qrImageBase64,
          expiresAt: result.expiresAt,
          expiresIn: result.expiresIn,
          status: "pending",
          deviceInfo: result.deviceInfo,
          message: result.message
        });
        this.startCountdown(result.expiresIn || 60);
      }
    });
    this.ipcChannels.push("qr-login-created");
    this.ipcService.on("qr-login-status", (data) => {
      const currentSession = this.session();
      if (currentSession && data.sessionId === currentSession.sessionId) {
        this.session.set(__spreadProps(__spreadValues({}, currentSession), {
          status: data.status,
          message: data.message
        }));
      }
    });
    this.ipcChannels.push("qr-login-status");
    this.ipcService.on("qr-login-success", (data) => {
      this.clearTimers();
      const currentSession = this.session();
      if (currentSession) {
        this.session.set(__spreadProps(__spreadValues({}, currentSession), {
          status: "success",
          phone: data.phone,
          userInfo: data.userInfo,
          message: data.message
        }));
      }
      this.toast.success(data.message || "\u767B\u5165\u6210\u529F\uFF01");
      this.loginSuccess.emit(data);
    });
    this.ipcChannels.push("qr-login-success");
    this.ipcService.on("qr-login-refreshed", (result) => {
      const currentSession = this.session();
      if (currentSession && result.success !== false) {
        this.session.set(__spreadProps(__spreadValues({}, currentSession), {
          qrUrl: result.qrUrl,
          qrImageBase64: result.qrImageBase64,
          expiresAt: result.expiresAt,
          status: "pending"
        }));
        this.startCountdown(result.expiresIn || 60);
      }
    });
    this.ipcChannels.push("qr-login-refreshed");
    this.ipcService.on("qr-login-error", (data) => {
      if (this.createTimeout) {
        clearTimeout(this.createTimeout);
        this.createTimeout = null;
      }
      this.isCreating.set(false);
      this.isSubmitting2FA.set(false);
      console.error("[QR Login] Error:", data.error);
      const currentSession = this.session();
      if (currentSession) {
        this.session.set(__spreadProps(__spreadValues({}, currentSession), {
          status: "error",
          message: data.error
        }));
      }
      this.toast.error(data.error || "\u64CD\u4F5C\u5931\u6557");
    });
    this.ipcChannels.push("qr-login-error");
    this.ipcService.on("qr-login-2fa-success", (data) => {
      this.isSubmitting2FA.set(false);
    });
    this.ipcChannels.push("qr-login-2fa-success");
  }
  createQRLogin() {
    const api = this.selectedApi();
    if (!api) {
      this.toast.error("\u8ACB\u5148\u9078\u64C7 API \u6191\u64DA");
      return;
    }
    if (this.createTimeout) {
      clearTimeout(this.createTimeout);
      this.createTimeout = null;
    }
    this.isCreating.set(true);
    const payload = {
      proxy: this.proxyInput || null,
      deviceType: this.deviceType() === "random" ? null : this.deviceType(),
      twoFactorPassword: this.twoFactorPassword || null,
      bindProxy: this.bindProxyToAccount,
      customApiId: api.api_id,
      customApiHash: api.api_hash
    };
    console.log("[QR Login] Creating QR login...", __spreadProps(__spreadValues({}, payload), {
      customApiHash: "***"
      // 隱藏敏感信息
    }));
    this.createTimeout = setTimeout(() => {
      if (this.isCreating()) {
        console.error("[QR Login] Timeout waiting for QR code generation (60s)");
        this.isCreating.set(false);
        this.toast.error("\u751F\u6210\u4E8C\u7DAD\u78BC\u8D85\u6642\uFF0860\u79D2\uFF09\uFF0C\u8ACB\u6AA2\u67E5\uFF1A\n1. \u5F8C\u7AEF\u65E5\u8A8C\u662F\u5426\u6709\u932F\u8AA4\n2. \u7DB2\u7D61\u9023\u63A5\u662F\u5426\u6B63\u5E38\n3. \u4EE3\u7406\u8A2D\u7F6E\u662F\u5426\u6B63\u78BA\n4. \u662F\u5426\u5DF2\u5B89\u88DD telethon \u548C qrcode \u5EAB");
        this.createTimeout = null;
      }
    }, 6e4);
    this.ipcService.send("qr-login-create", payload);
  }
  refreshQR() {
    const currentSession = this.session();
    if (currentSession) {
      this.ipcService.send("qr-login-refresh", {
        sessionId: currentSession.sessionId
      });
    } else {
      this.createQRLogin();
    }
  }
  submit2FA() {
    const currentSession = this.session();
    if (!currentSession || !this.twoFactorInput)
      return;
    this.isSubmitting2FA.set(true);
    this.ipcService.send("qr-login-submit-2fa", {
      sessionId: currentSession.sessionId,
      password: this.twoFactorInput
    });
  }
  cancelLogin() {
    const currentSession = this.session();
    if (currentSession) {
      this.ipcService.send("qr-login-cancel", {
        sessionId: currentSession.sessionId
      });
    }
    this.clearTimers();
    this.session.set(null);
  }
  onClose() {
    this.cancelLogin();
    this.closed.emit();
  }
  selectRandomProxy() {
    this.toast.info("\u4EE3\u7406\u6C60\u529F\u80FD\u5373\u5C07\u63A8\u51FA");
  }
  startCountdown(seconds) {
    this.clearTimers();
    this.countdown.set(seconds);
    this.countdownTimer = setInterval(() => {
      const current = this.countdown();
      if (current <= 1) {
        this.clearTimers();
        const currentSession = this.session();
        if (currentSession && currentSession.status === "pending") {
          this.session.set(__spreadProps(__spreadValues({}, currentSession), {
            status: "expired",
            message: "\u4E8C\u7DAD\u78BC\u5DF2\u904E\u671F"
          }));
        }
      } else {
        this.countdown.set(current - 1);
      }
    }, 1e3);
  }
  clearTimers() {
    if (this.countdownTimer) {
      clearInterval(this.countdownTimer);
      this.countdownTimer = null;
    }
    if (this.statusCheckTimer) {
      clearInterval(this.statusCheckTimer);
      this.statusCheckTimer = null;
    }
  }
  static {
    this.\u0275fac = function QrLoginComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _QrLoginComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _QrLoginComponent, selectors: [["app-qr-login"]], outputs: { closed: "closed", loginSuccess: "loginSuccess" }, decls: 11, vars: 1, consts: [[1, "qr-login-container"], [1, "header"], [1, "title"], [1, "icon"], [1, "close-btn", 3, "click"], [1, "content"], [1, "setup-section"], [1, "info-box"], [1, "option-group"], [1, "option-label"], [3, "apiSelected", "selectionCleared", "showSelected"], [1, "device-options"], [1, "device-btn", 3, "click"], [1, "proxy-input-group"], ["type", "text", "placeholder", "socks5://host:port \u6216\u7559\u7A7A\u4F7F\u7528\u76F4\u9023", 1, "proxy-input", 3, "ngModelChange", "ngModel"], ["title", "\u96A8\u6A5F\u9078\u64C7\u4EE3\u7406", 1, "random-proxy-btn", 3, "click"], [1, "checkbox-option"], ["type", "checkbox", "id", "bindProxy", 3, "ngModelChange", "ngModel"], ["for", "bindProxy"], ["type", "password", "placeholder", "\u53EF\u9078\uFF0C\u5982\u679C\u5E33\u865F\u958B\u555F\u4E86\u4E8C\u6B65\u9A57\u8B49", 1, "form-input", 3, "ngModelChange", "ngModel"], [1, "create-btn", 3, "click", "disabled"], [1, "spinner"], [1, "qr-section"], [1, "tfa-section"], [1, "success-section"], [1, "error-section"], [1, "action-buttons"], [1, "qr-display"], ["alt", "QR Code", 1, "qr-image", 3, "src"], [1, "qr-placeholder"], [1, "qr-info"], [1, "countdown"], [1, "instruction"], [1, "device-info"], [1, "label"], [1, "value"], [1, "spinner", "large"], [1, "status-icon", "warning"], ["type", "password", "placeholder", "\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC", 1, "form-input", "tfa-input", 3, "ngModelChange", "keyup.enter", "ngModel"], [1, "submit-btn", 3, "click", "disabled"], [1, "status-icon", "success"], [1, "user-info-card"], [1, "success-message"], [1, "done-btn", 3, "click"], [1, "user-avatar"], [1, "user-details"], [1, "user-name"], [1, "user-phone"], [1, "user-username"], [1, "refresh-btn", 3, "click"], [1, "status-icon", "error"], [1, "action-btn", "secondary", 3, "click"], [1, "action-btn", "cancel", 3, "click"]], template: function QrLoginComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0)(1, "div", 1)(2, "h3", 2)(3, "span", 3);
        \u0275\u0275text(4, "\u{1F4F1}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(5, " \u6383\u78BC\u5FEB\u901F\u767B\u5165 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(6, "button", 4);
        \u0275\u0275listener("click", function QrLoginComponent_Template_button_click_6_listener() {
          return ctx.onClose();
        });
        \u0275\u0275text(7, "\xD7");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(8, "div", 5);
        \u0275\u0275conditionalCreate(9, QrLoginComponent_Conditional_9_Template, 38, 14, "div", 6)(10, QrLoginComponent_Conditional_10_Template, 7, 2);
        \u0275\u0275elementEnd()();
      }
      if (rf & 2) {
        \u0275\u0275advance(9);
        \u0275\u0275conditional(!ctx.session() ? 9 : 10);
      }
    }, dependencies: [CommonModule, FormsModule, DefaultValueAccessor, CheckboxControlValueAccessor, NgControlStatus, NgModel, ApiSelectorComponent], styles: ["\n\n.qr-login-container[_ngcontent-%COMP%] {\n  background: var(--bg-card, rgba(30, 41, 59, 0.95));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 1rem;\n  width: 420px;\n  max-height: 90vh;\n  overflow-y: auto;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);\n}\n.header[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.5rem;\n  border-bottom: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n}\n.title[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n}\n.icon[_ngcontent-%COMP%] {\n  font-size: 1.25rem;\n}\n.close-btn[_ngcontent-%COMP%] {\n  background: none;\n  border: none;\n  color: var(--text-muted, #94a3b8);\n  font-size: 1.5rem;\n  cursor: pointer;\n  padding: 0.25rem;\n  line-height: 1;\n}\n.close-btn[_ngcontent-%COMP%]:hover {\n  color: var(--text-primary, white);\n}\n.content[_ngcontent-%COMP%] {\n  padding: 1.5rem;\n}\n.setup-section[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.info-box[_ngcontent-%COMP%] {\n  background: rgba(6, 182, 212, 0.1);\n  border: 1px solid rgba(6, 182, 212, 0.2);\n  border-radius: 0.5rem;\n  padding: 1rem;\n}\n.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n  margin: 0;\n  color: var(--text-secondary, #cbd5e1);\n  font-size: 0.875rem;\n}\n.info-box[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%] {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.75rem;\n  margin-top: 0.5rem;\n}\n.option-group[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.option-label[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: var(--text-secondary, #cbd5e1);\n}\n.device-options[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  gap: 0.5rem;\n}\n.device-btn[_ngcontent-%COMP%] {\n  padding: 0.5rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-secondary, #94a3b8);\n  font-size: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.device-btn[_ngcontent-%COMP%]:hover {\n  border-color: var(--primary, #06b6d4);\n  color: var(--text-primary, white);\n}\n.device-btn.active[_ngcontent-%COMP%] {\n  background: rgba(6, 182, 212, 0.2);\n  border-color: var(--primary, #06b6d4);\n  color: var(--primary, #06b6d4);\n}\n.proxy-input-group[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.5rem;\n}\n.proxy-input[_ngcontent-%COMP%] {\n  flex: 1;\n  padding: 0.5rem 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n}\n.proxy-input[_ngcontent-%COMP%]:focus {\n  outline: none;\n  border-color: var(--primary, #06b6d4);\n}\n.random-proxy-btn[_ngcontent-%COMP%] {\n  padding: 0.5rem 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-muted, #94a3b8);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.random-proxy-btn[_ngcontent-%COMP%]:hover {\n  border-color: var(--primary, #06b6d4);\n  color: var(--primary, #06b6d4);\n}\n.checkbox-option[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.checkbox-option[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] {\n  accent-color: var(--primary, #06b6d4);\n}\n.form-input[_ngcontent-%COMP%] {\n  width: 100%;\n  padding: 0.5rem 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n}\n.form-input[_ngcontent-%COMP%]:focus {\n  outline: none;\n  border-color: var(--primary, #06b6d4);\n}\n.create-btn[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  margin-top: 0.5rem;\n}\n.create-btn[_ngcontent-%COMP%]:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);\n}\n.create-btn[_ngcontent-%COMP%]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.qr-section[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 1rem;\n}\n.qr-display[_ngcontent-%COMP%] {\n  padding: 1rem;\n  background: white;\n  border-radius: 0.75rem;\n}\n.qr-image[_ngcontent-%COMP%] {\n  width: 200px;\n  height: 200px;\n  display: block;\n}\n.qr-placeholder[_ngcontent-%COMP%] {\n  width: 200px;\n  height: 200px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.5rem;\n}\n.qr-info[_ngcontent-%COMP%] {\n  text-align: center;\n}\n.countdown[_ngcontent-%COMP%] {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--primary, #06b6d4);\n  margin-bottom: 0.5rem;\n}\n.countdown.warning[_ngcontent-%COMP%] {\n  color: #f59e0b;\n  animation: _ngcontent-%COMP%_pulse 1s infinite;\n}\n@keyframes _ngcontent-%COMP%_pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n.instruction[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n  color: var(--text-muted, #94a3b8);\n  line-height: 1.6;\n  margin: 0;\n}\n.device-info[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-muted, #64748b);\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  padding: 0.5rem 1rem;\n  border-radius: 0.5rem;\n}\n.device-info[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%] {\n  margin-right: 0.5rem;\n}\n.tfa-section[_ngcontent-%COMP%], \n.success-section[_ngcontent-%COMP%], \n.error-section[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  text-align: center;\n  gap: 1rem;\n  padding: 1rem;\n}\n.status-icon[_ngcontent-%COMP%] {\n  font-size: 3rem;\n}\n.status-icon.success[_ngcontent-%COMP%] {\n  color: #22c55e;\n}\n.status-icon.warning[_ngcontent-%COMP%] {\n  color: #f59e0b;\n}\n.status-icon.error[_ngcontent-%COMP%] {\n  color: #ef4444;\n}\n.tfa-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], \n.success-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], \n.error-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%] {\n  margin: 0;\n  color: var(--text-primary, white);\n}\n.tfa-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], \n.success-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], \n.error-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n  margin: 0;\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n}\n.tfa-input[_ngcontent-%COMP%] {\n  max-width: 250px;\n  text-align: center;\n}\n.submit-btn[_ngcontent-%COMP%], \n.done-btn[_ngcontent-%COMP%], \n.refresh-btn[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e,\n      #16a34a);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 500;\n  cursor: pointer;\n}\n.submit-btn[_ngcontent-%COMP%]:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.refresh-btn[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n}\n.user-info-card[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.75rem;\n  width: 100%;\n}\n.user-avatar[_ngcontent-%COMP%] {\n  width: 50px;\n  height: 50px;\n  border-radius: 50%;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.25rem;\n  font-weight: bold;\n  color: white;\n}\n.user-details[_ngcontent-%COMP%] {\n  text-align: left;\n}\n.user-name[_ngcontent-%COMP%] {\n  font-weight: 600;\n  color: var(--text-primary, white);\n}\n.user-phone[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.user-username[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--primary, #06b6d4);\n}\n.success-message[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-muted, #64748b);\n}\n.action-buttons[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 1rem;\n  width: 100%;\n}\n.action-btn[_ngcontent-%COMP%] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  font-size: 0.875rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn.secondary[_ngcontent-%COMP%] {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  color: var(--text-secondary, #cbd5e1);\n}\n.action-btn.secondary[_ngcontent-%COMP%]:hover {\n  border-color: var(--primary, #06b6d4);\n  color: var(--primary, #06b6d4);\n}\n.action-btn.cancel[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.3);\n  color: #fca5a5;\n}\n.action-btn.cancel[_ngcontent-%COMP%]:hover {\n  background: rgba(239, 68, 68, 0.2);\n}\n.spinner[_ngcontent-%COMP%] {\n  width: 16px;\n  height: 16px;\n  border: 2px solid rgba(255, 255, 255, 0.3);\n  border-top-color: white;\n  border-radius: 50%;\n  animation: _ngcontent-%COMP%_spin 0.8s linear infinite;\n}\n.spinner.large[_ngcontent-%COMP%] {\n  width: 40px;\n  height: 40px;\n  border-width: 3px;\n}\n@keyframes _ngcontent-%COMP%_spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n.warning-box[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.15);\n  border: 1px solid rgba(239, 68, 68, 0.4);\n  border-radius: 0.75rem;\n  overflow: hidden;\n}\n.warning-header[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1rem;\n  background: rgba(239, 68, 68, 0.2);\n  border-bottom: 1px solid rgba(239, 68, 68, 0.3);\n}\n.warning-icon[_ngcontent-%COMP%] {\n  font-size: 1.25rem;\n}\n.warning-title[_ngcontent-%COMP%] {\n  flex: 1;\n  font-weight: 600;\n  color: #fca5a5;\n}\n.dismiss-btn[_ngcontent-%COMP%] {\n  background: none;\n  border: none;\n  color: #fca5a5;\n  font-size: 1.25rem;\n  cursor: pointer;\n  padding: 0;\n  line-height: 1;\n}\n.warning-content[_ngcontent-%COMP%] {\n  padding: 0.75rem 1rem;\n}\n.warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n  margin: 0 0 0.5rem 0;\n  color: #fecaca;\n  font-size: 0.8rem;\n}\n.warning-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] {\n  margin: 0.5rem 0;\n  padding-left: 1.25rem;\n  color: #fca5a5;\n  font-size: 0.75rem;\n}\n.warning-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] {\n  margin-bottom: 0.25rem;\n}\n.warning-action[_ngcontent-%COMP%] {\n  margin-top: 0.75rem !important;\n  padding-top: 0.5rem;\n  border-top: 1px solid rgba(239, 68, 68, 0.2);\n}\n.warning-action[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] {\n  color: #60a5fa;\n  text-decoration: underline;\n}\n.api-section[_ngcontent-%COMP%] {\n  background: rgba(6, 182, 212, 0.05);\n  border: 1px solid rgba(6, 182, 212, 0.2);\n  border-radius: 0.5rem;\n  padding: 0.75rem;\n}\n.option-header[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n}\n.checkbox-option.inline[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n}\n.api-inputs[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.api-input-row[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.input-label[_ngcontent-%COMP%] {\n  width: 70px;\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.api-input-row[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%] {\n  flex: 1;\n}\n.api-hint[_ngcontent-%COMP%] {\n  margin: 0;\n  font-size: 0.7rem;\n  color: var(--text-muted, #64748b);\n}\n.api-hint[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] {\n  color: var(--primary, #06b6d4);\n}\n.public-api-warning[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem;\n  background: rgba(239, 68, 68, 0.1);\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n  color: #fca5a5;\n}\n.warning-badge[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.3);\n  padding: 0.125rem 0.375rem;\n  border-radius: 0.25rem;\n  font-size: 0.65rem;\n  font-weight: 600;\n}\n/*# sourceMappingURL=qr-login.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(QrLoginComponent, [{
    type: Component,
    args: [{ selector: "app-qr-login", standalone: true, imports: [CommonModule, FormsModule, ApiSelectorComponent], template: `
    <div class="qr-login-container">
      <!-- \u6A19\u984C -->
      <div class="header">
        <h3 class="title">
          <span class="icon">\u{1F4F1}</span>
          \u6383\u78BC\u5FEB\u901F\u767B\u5165
        </h3>
        <button (click)="onClose()" class="close-btn">\xD7</button>
      </div>
      
      <!-- \u4E3B\u8981\u5167\u5BB9\u5340 -->
      <div class="content">
        @if (!session()) {
          <!-- \u521D\u59CB\u72C0\u614B\uFF1A\u986F\u793A\u914D\u7F6E\u9078\u9805 -->
          <div class="setup-section">
            <div class="info-box">
              <p>\u4F7F\u7528 Telegram App \u6383\u63CF\u4E8C\u7DAD\u78BC\uFF0C\u5FEB\u901F\u6DFB\u52A0\u5E33\u865F\u3002</p>
            </div>
            
            <!-- API \u9078\u64C7\u5668 -->
            <div class="option-group">
              <label class="option-label">\u{1F510} \u9078\u64C7 API \u6191\u64DA</label>
              <app-api-selector 
                [showSelected]="false"
                (apiSelected)="onApiSelected($event)"
                (selectionCleared)="onApiCleared()">
              </app-api-selector>
            </div>
            
            <!-- \u8A2D\u5099\u985E\u578B\u9078\u64C7 -->
            <div class="option-group">
              <label class="option-label">\u{1F4F2} \u8A2D\u5099\u6A21\u64EC</label>
              <div class="device-options">
                <button 
                  (click)="deviceType.set('random')"
                  [class.active]="deviceType() === 'random'"
                  class="device-btn">
                  \u{1F3B2} \u667A\u80FD\u96A8\u6A5F
                </button>
                <button 
                  (click)="deviceType.set('ios')"
                  [class.active]="deviceType() === 'ios'"
                  class="device-btn">
                  \u{1F4F1} iOS
                </button>
                <button 
                  (click)="deviceType.set('android')"
                  [class.active]="deviceType() === 'android'"
                  class="device-btn">
                  \u{1F916} Android
                </button>
                <button 
                  (click)="deviceType.set('desktop')"
                  [class.active]="deviceType() === 'desktop'"
                  class="device-btn">
                  \u{1F4BB} Desktop
                </button>
              </div>
            </div>
            
            <!-- \u4EE3\u7406\u8A2D\u7F6E -->
            <div class="option-group">
              <label class="option-label">\u{1F310} \u4EE3\u7406\u8A2D\u7F6E\uFF08\u53EF\u9078\uFF09</label>
              <div class="proxy-input-group">
                <input 
                  type="text" 
                  [(ngModel)]="proxyInput"
                  placeholder="socks5://host:port \u6216\u7559\u7A7A\u4F7F\u7528\u76F4\u9023"
                  class="proxy-input">
                <button (click)="selectRandomProxy()" class="random-proxy-btn" title="\u96A8\u6A5F\u9078\u64C7\u4EE3\u7406">
                  \u{1F3B2}
                </button>
              </div>
              <div class="checkbox-option">
                <input type="checkbox" [(ngModel)]="bindProxyToAccount" id="bindProxy">
                <label for="bindProxy">\u70BA\u6B64\u5E33\u865F\u7D81\u5B9A\u6B64\u4EE3\u7406 IP\uFF08\u63A8\u85A6\uFF09</label>
              </div>
            </div>
            
            <!-- \u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF08\u9810\u8A2D\uFF09 -->
            <div class="option-group">
              <label class="option-label">\u{1F510} \u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF08\u5982\u6709\uFF09</label>
              <input 
                type="password" 
                [(ngModel)]="twoFactorPassword"
                placeholder="\u53EF\u9078\uFF0C\u5982\u679C\u5E33\u865F\u958B\u555F\u4E86\u4E8C\u6B65\u9A57\u8B49"
                class="form-input">
            </div>
            
            <!-- \u751F\u6210\u6309\u9215 -->
            <button 
              (click)="createQRLogin()" 
              [disabled]="isCreating() || !selectedApi()"
              class="create-btn">
              @if (isCreating()) {
                <span class="spinner"></span> \u751F\u6210\u4E2D...
              } @else {
                \u{1F4F7} \u751F\u6210\u4E8C\u7DAD\u78BC
              }
            </button>
          </div>
        } @else {
          <!-- QR \u78BC\u986F\u793A\u5340 -->
          <div class="qr-section">
            @switch (session()!.status) {
              @case ('pending') {
                <div class="qr-display">
                  @if (session()!.qrImageBase64) {
                    <img 
                      [src]="'data:image/png;base64,' + session()!.qrImageBase64" 
                      alt="QR Code"
                      class="qr-image">
                  } @else {
                    <div class="qr-placeholder">
                      <span class="spinner large"></span>
                    </div>
                  }
                </div>
                
                <div class="qr-info">
                  <div class="countdown" [class.warning]="countdown() <= 10">
                    \u23F1\uFE0F \u6709\u6548\u671F\uFF1A{{ countdown() }} \u79D2
                  </div>
                  <p class="instruction">
                    1. \u6253\u958B Telegram App<br>
                    2. \u8A2D\u7F6E \u2192 \u8A2D\u5099 \u2192 \u6383\u63CF\u4E8C\u7DAD\u78BC<br>
                    3. \u6383\u63CF\u4E0A\u65B9\u4E8C\u7DAD\u78BC\u4E26\u78BA\u8A8D\u767B\u5165
                  </p>
                </div>
                
                <div class="device-info">
                  <span class="label">\u6A21\u64EC\u8A2D\u5099:</span>
                  <span class="value">{{ session()!.deviceInfo?.model }} ({{ session()!.deviceInfo?.system }})</span>
                </div>
              }
              
              @case ('waiting_2fa') {
                <div class="tfa-section">
                  <div class="status-icon warning">\u{1F510}</div>
                  <h4>\u9700\u8981\u4E8C\u6B65\u9A57\u8B49</h4>
                  <p>\u8ACB\u8F38\u5165\u60A8\u7684\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF1A</p>
                  
                  <input 
                    type="password" 
                    [(ngModel)]="twoFactorInput"
                    placeholder="\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC"
                    class="form-input tfa-input"
                    (keyup.enter)="submit2FA()">
                  
                  <button 
                    (click)="submit2FA()" 
                    [disabled]="!twoFactorInput || isSubmitting2FA()"
                    class="submit-btn">
                    @if (isSubmitting2FA()) {
                      <span class="spinner"></span> \u9A57\u8B49\u4E2D...
                    } @else {
                      \u78BA\u8A8D
                    }
                  </button>
                </div>
              }
              
              @case ('success') {
                <div class="success-section">
                  <div class="status-icon success">\u2705</div>
                  <h4>\u767B\u5165\u6210\u529F\uFF01</h4>
                  
                  @if (session()!.userInfo) {
                    <div class="user-info-card">
                      <div class="user-avatar">
                        {{ (session()!.userInfo!.firstName || '?').charAt(0).toUpperCase() }}
                      </div>
                      <div class="user-details">
                        <div class="user-name">
                          {{ session()!.userInfo!.firstName }}
                          @if (session()!.userInfo!.lastName) {
                            {{ session()!.userInfo!.lastName }}
                          }
                        </div>
                        <div class="user-phone">{{ session()!.phone }}</div>
                        @if (session()!.userInfo!.username) {
                          <div class="user-username">{{ '@' + session()!.userInfo!.username }}</div>
                        }
                      </div>
                    </div>
                  }
                  
                  <p class="success-message">\u5E33\u865F\u5DF2\u6210\u529F\u6DFB\u52A0\uFF0C\u6B63\u5728\u5F8C\u53F0\u5347\u7D1A\u70BA\u539F\u751F API...</p>
                  
                  <button (click)="onClose()" class="done-btn">\u5B8C\u6210</button>
                </div>
              }
              
              @case ('expired') {
                <div class="error-section">
                  <div class="status-icon warning">\u23F0</div>
                  <h4>\u4E8C\u7DAD\u78BC\u5DF2\u904E\u671F</h4>
                  <p>\u8ACB\u9EDE\u64CA\u4E0B\u65B9\u6309\u9215\u91CD\u65B0\u751F\u6210\u3002</p>
                  <button (click)="refreshQR()" class="refresh-btn">\u{1F504} \u91CD\u65B0\u751F\u6210</button>
                </div>
              }
              
              @case ('error') {
                <div class="error-section">
                  <div class="status-icon error">\u274C</div>
                  <h4>\u767B\u5165\u5931\u6557</h4>
                  <p>{{ session()!.message || '\u672A\u77E5\u932F\u8AA4' }}</p>
                  <button (click)="refreshQR()" class="refresh-btn">\u{1F504} \u91CD\u8A66</button>
                </div>
              }
            }
          </div>
          
          <!-- \u5E95\u90E8\u64CD\u4F5C\u6309\u9215 -->
          @if (session()!.status === 'pending') {
            <div class="action-buttons">
              <button (click)="refreshQR()" class="action-btn secondary">
                \u{1F504} \u5237\u65B0\u4E8C\u7DAD\u78BC
              </button>
              <button (click)="cancelLogin()" class="action-btn cancel">
                \u274C \u53D6\u6D88
              </button>
            </div>
          }
        }
      </div>
    </div>
  `, styles: ["/* angular:styles/component:css;0a8e791d7d57ccf484d440513127c55b2b8bc3f819b04d609d8b65c6f891247c;D:/tgkz2026/src/qr-login.component.ts */\n.qr-login-container {\n  background: var(--bg-card, rgba(30, 41, 59, 0.95));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 1rem;\n  width: 420px;\n  max-height: 90vh;\n  overflow-y: auto;\n  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);\n}\n.header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.5rem;\n  border-bottom: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n}\n.title {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n}\n.icon {\n  font-size: 1.25rem;\n}\n.close-btn {\n  background: none;\n  border: none;\n  color: var(--text-muted, #94a3b8);\n  font-size: 1.5rem;\n  cursor: pointer;\n  padding: 0.25rem;\n  line-height: 1;\n}\n.close-btn:hover {\n  color: var(--text-primary, white);\n}\n.content {\n  padding: 1.5rem;\n}\n.setup-section {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.info-box {\n  background: rgba(6, 182, 212, 0.1);\n  border: 1px solid rgba(6, 182, 212, 0.2);\n  border-radius: 0.5rem;\n  padding: 1rem;\n}\n.info-box p {\n  margin: 0;\n  color: var(--text-secondary, #cbd5e1);\n  font-size: 0.875rem;\n}\n.info-box .hint {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.75rem;\n  margin-top: 0.5rem;\n}\n.option-group {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.option-label {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: var(--text-secondary, #cbd5e1);\n}\n.device-options {\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  gap: 0.5rem;\n}\n.device-btn {\n  padding: 0.5rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-secondary, #94a3b8);\n  font-size: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.device-btn:hover {\n  border-color: var(--primary, #06b6d4);\n  color: var(--text-primary, white);\n}\n.device-btn.active {\n  background: rgba(6, 182, 212, 0.2);\n  border-color: var(--primary, #06b6d4);\n  color: var(--primary, #06b6d4);\n}\n.proxy-input-group {\n  display: flex;\n  gap: 0.5rem;\n}\n.proxy-input {\n  flex: 1;\n  padding: 0.5rem 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n}\n.proxy-input:focus {\n  outline: none;\n  border-color: var(--primary, #06b6d4);\n}\n.random-proxy-btn {\n  padding: 0.5rem 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-muted, #94a3b8);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.random-proxy-btn:hover {\n  border-color: var(--primary, #06b6d4);\n  color: var(--primary, #06b6d4);\n}\n.checkbox-option {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.checkbox-option input {\n  accent-color: var(--primary, #06b6d4);\n}\n.form-input {\n  width: 100%;\n  padding: 0.5rem 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n}\n.form-input:focus {\n  outline: none;\n  border-color: var(--primary, #06b6d4);\n}\n.create-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  margin-top: 0.5rem;\n}\n.create-btn:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);\n}\n.create-btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.qr-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 1rem;\n}\n.qr-display {\n  padding: 1rem;\n  background: white;\n  border-radius: 0.75rem;\n}\n.qr-image {\n  width: 200px;\n  height: 200px;\n  display: block;\n}\n.qr-placeholder {\n  width: 200px;\n  height: 200px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.5rem;\n}\n.qr-info {\n  text-align: center;\n}\n.countdown {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--primary, #06b6d4);\n  margin-bottom: 0.5rem;\n}\n.countdown.warning {\n  color: #f59e0b;\n  animation: pulse 1s infinite;\n}\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n.instruction {\n  font-size: 0.875rem;\n  color: var(--text-muted, #94a3b8);\n  line-height: 1.6;\n  margin: 0;\n}\n.device-info {\n  font-size: 0.75rem;\n  color: var(--text-muted, #64748b);\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  padding: 0.5rem 1rem;\n  border-radius: 0.5rem;\n}\n.device-info .label {\n  margin-right: 0.5rem;\n}\n.tfa-section,\n.success-section,\n.error-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  text-align: center;\n  gap: 1rem;\n  padding: 1rem;\n}\n.status-icon {\n  font-size: 3rem;\n}\n.status-icon.success {\n  color: #22c55e;\n}\n.status-icon.warning {\n  color: #f59e0b;\n}\n.status-icon.error {\n  color: #ef4444;\n}\n.tfa-section h4,\n.success-section h4,\n.error-section h4 {\n  margin: 0;\n  color: var(--text-primary, white);\n}\n.tfa-section p,\n.success-section p,\n.error-section p {\n  margin: 0;\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n}\n.tfa-input {\n  max-width: 250px;\n  text-align: center;\n}\n.submit-btn,\n.done-btn,\n.refresh-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e,\n      #16a34a);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 500;\n  cursor: pointer;\n}\n.submit-btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.refresh-btn {\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n}\n.user-info-card {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.75rem;\n  width: 100%;\n}\n.user-avatar {\n  width: 50px;\n  height: 50px;\n  border-radius: 50%;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.25rem;\n  font-weight: bold;\n  color: white;\n}\n.user-details {\n  text-align: left;\n}\n.user-name {\n  font-weight: 600;\n  color: var(--text-primary, white);\n}\n.user-phone {\n  font-size: 0.875rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.user-username {\n  font-size: 0.75rem;\n  color: var(--primary, #06b6d4);\n}\n.success-message {\n  font-size: 0.75rem;\n  color: var(--text-muted, #64748b);\n}\n.action-buttons {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 1rem;\n  width: 100%;\n}\n.action-btn {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  font-size: 0.875rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn.secondary {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  color: var(--text-secondary, #cbd5e1);\n}\n.action-btn.secondary:hover {\n  border-color: var(--primary, #06b6d4);\n  color: var(--primary, #06b6d4);\n}\n.action-btn.cancel {\n  background: rgba(239, 68, 68, 0.1);\n  border-color: rgba(239, 68, 68, 0.3);\n  color: #fca5a5;\n}\n.action-btn.cancel:hover {\n  background: rgba(239, 68, 68, 0.2);\n}\n.spinner {\n  width: 16px;\n  height: 16px;\n  border: 2px solid rgba(255, 255, 255, 0.3);\n  border-top-color: white;\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n.spinner.large {\n  width: 40px;\n  height: 40px;\n  border-width: 3px;\n}\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n.warning-box {\n  background: rgba(239, 68, 68, 0.15);\n  border: 1px solid rgba(239, 68, 68, 0.4);\n  border-radius: 0.75rem;\n  overflow: hidden;\n}\n.warning-header {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1rem;\n  background: rgba(239, 68, 68, 0.2);\n  border-bottom: 1px solid rgba(239, 68, 68, 0.3);\n}\n.warning-icon {\n  font-size: 1.25rem;\n}\n.warning-title {\n  flex: 1;\n  font-weight: 600;\n  color: #fca5a5;\n}\n.dismiss-btn {\n  background: none;\n  border: none;\n  color: #fca5a5;\n  font-size: 1.25rem;\n  cursor: pointer;\n  padding: 0;\n  line-height: 1;\n}\n.warning-content {\n  padding: 0.75rem 1rem;\n}\n.warning-content p {\n  margin: 0 0 0.5rem 0;\n  color: #fecaca;\n  font-size: 0.8rem;\n}\n.warning-content ul {\n  margin: 0.5rem 0;\n  padding-left: 1.25rem;\n  color: #fca5a5;\n  font-size: 0.75rem;\n}\n.warning-content li {\n  margin-bottom: 0.25rem;\n}\n.warning-action {\n  margin-top: 0.75rem !important;\n  padding-top: 0.5rem;\n  border-top: 1px solid rgba(239, 68, 68, 0.2);\n}\n.warning-action a {\n  color: #60a5fa;\n  text-decoration: underline;\n}\n.api-section {\n  background: rgba(6, 182, 212, 0.05);\n  border: 1px solid rgba(6, 182, 212, 0.2);\n  border-radius: 0.5rem;\n  padding: 0.75rem;\n}\n.option-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5rem;\n}\n.checkbox-option.inline {\n  font-size: 0.75rem;\n}\n.api-inputs {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.api-input-row {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.input-label {\n  width: 70px;\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.api-input-row .form-input {\n  flex: 1;\n}\n.api-hint {\n  margin: 0;\n  font-size: 0.7rem;\n  color: var(--text-muted, #64748b);\n}\n.api-hint a {\n  color: var(--primary, #06b6d4);\n}\n.public-api-warning {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem;\n  background: rgba(239, 68, 68, 0.1);\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n  color: #fca5a5;\n}\n.warning-badge {\n  background: rgba(239, 68, 68, 0.3);\n  padding: 0.125rem 0.375rem;\n  border-radius: 0.25rem;\n  font-size: 0.65rem;\n  font-weight: 600;\n}\n/*# sourceMappingURL=qr-login.component.css.map */\n"] }]
  }], null, { closed: [{
    type: Output
  }], loginSuccess: [{
    type: Output
  }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(QrLoginComponent, { className: "QrLoginComponent", filePath: "src/qr-login.component.ts", lineNumber: 854 });
})();

// src/add-account-page.component.ts
var _c02 = () => [];
var _forTrack08 = ($index, $item) => $item.index;
function AddAccountPageComponent_Conditional_24_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 9)(1, "div", 13)(2, "h2");
    \u0275\u0275text(3, "\u{1F510} \u9078\u64C7 API \u6191\u64DA");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "p");
    \u0275\u0275text(5, "\u9078\u64C7\u6216\u6DFB\u52A0 API \u6191\u64DA\u4EE5\u9023\u63A5 Telegram");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "app-api-selector", 14);
    \u0275\u0275listener("apiSelected", function AddAccountPageComponent_Conditional_24_Template_app_api_selector_apiSelected_6_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.onApiSelected($event));
    })("selectionCleared", function AddAccountPageComponent_Conditional_24_Template_app_api_selector_selectionCleared_6_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.onApiCleared());
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div", 15)(8, "button", 16);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_24_Template_button_click_8_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.goBack());
    });
    \u0275\u0275text(9, "\u2190 \u8FD4\u56DE");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "button", 17);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_24_Template_button_click_10_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.proceedToLogin());
    });
    \u0275\u0275text(11, " \u4E0B\u4E00\u6B65\uFF1A\u9078\u64C7\u767B\u5165\u65B9\u5F0F \u2192 ");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(6);
    \u0275\u0275property("showSelected", true);
    \u0275\u0275advance(4);
    \u0275\u0275property("disabled", !ctx_r1.selectedApiCredential());
  }
}
function AddAccountPageComponent_Conditional_25_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 10)(1, "div", 13)(2, "h2");
    \u0275\u0275text(3, "\u9078\u64C7\u767B\u5165\u65B9\u5F0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "p");
    \u0275\u0275text(5, "\u9078\u64C7\u6700\u9069\u5408\u60A8\u7684\u5E33\u865F\u767B\u5165\u65B9\u5F0F");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div", 18)(7, "div", 19);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_25_Template_div_click_7_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.selectLoginMethod("code"));
    });
    \u0275\u0275elementStart(8, "div", 20);
    \u0275\u0275text(9, "\u2705 \u63A8\u85A6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "div", 21);
    \u0275\u0275text(11, "\u{1F4AC}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "h3");
    \u0275\u0275text(13, "\u9A57\u8B49\u78BC\u767B\u5165");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "p");
    \u0275\u0275text(15, "\u8F38\u5165\u624B\u6A5F\u865F\uFF0C\u63A5\u6536\u9A57\u8B49\u78BC\u5B8C\u6210\u767B\u5165");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "ul")(17, "li");
    \u0275\u0275text(18, "\u{1F7E2} \u6A19\u6E96\u5B98\u65B9\u767B\u5165\u65B9\u5F0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(19, "li");
    \u0275\u0275text(20, "\u{1F7E2} \u98A8\u96AA\u6700\u4F4E");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(21, "li");
    \u0275\u0275text(22, "\u{1F7E1} \u9700\u8981\u80FD\u6536\u5230\u9A57\u8B49\u78BC");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(23, "div", 22);
    \u0275\u0275text(24, "\u98A8\u96AA\uFF1A\u4F4E");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(25, "div", 23);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_25_Template_div_click_25_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.selectLoginMethod("tdata"));
    });
    \u0275\u0275elementStart(26, "div", 20);
    \u0275\u0275text(27, "\u{1F6E1}\uFE0F \u6700\u5B89\u5168");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(28, "div", 21);
    \u0275\u0275text(29, "\u{1F4C2}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(30, "h3");
    \u0275\u0275text(31, "TData \u5C0E\u5165");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(32, "p");
    \u0275\u0275text(33, "\u5C0E\u5165\u5DF2\u6709\u7684 Session \u6587\u4EF6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(34, "ul")(35, "li");
    \u0275\u0275text(36, "\u{1F7E2} \u7121\u9700\u91CD\u65B0\u767B\u5165");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(37, "li");
    \u0275\u0275text(38, "\u{1F7E2} \u98A8\u96AA\u6700\u4F4E");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(39, "li");
    \u0275\u0275text(40, "\u{1F7E2} \u652F\u6301\u6279\u91CF\u5C0E\u5165");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(41, "div", 24);
    \u0275\u0275text(42, "\u98A8\u96AA\uFF1A\u6700\u4F4E");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(43, "div", 25);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_25_Template_div_click_43_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.selectLoginMethod("qr"));
    });
    \u0275\u0275elementStart(44, "div", 20);
    \u0275\u0275text(45, "\u26A0\uFE0F \u9700\u8B39\u614E");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(46, "div", 21);
    \u0275\u0275text(47, "\u{1F4F1}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(48, "h3");
    \u0275\u0275text(49, "\u6383\u78BC\u767B\u5165");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(50, "p");
    \u0275\u0275text(51, "\u4F7F\u7528 Telegram APP \u6383\u63CF\u4E8C\u7DAD\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(52, "ul")(53, "li");
    \u0275\u0275text(54, "\u{1F7E2} \u7121\u9700\u9A57\u8B49\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(55, "li");
    \u0275\u0275text(56, "\u{1F7E1} \u9700\u8981\u624B\u6A5F\u5728\u65C1");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(57, "li");
    \u0275\u0275text(58, "\u{1F534} \u7B2C\u4E09\u65B9\u7279\u5FB5\uFF0C\u98A8\u96AA\u8F03\u9AD8");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(59, "div", 26);
    \u0275\u0275text(60, "\u98A8\u96AA\uFF1A\u8F03\u9AD8");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(61, "div", 15)(62, "button", 16);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_25_Template_button_click_62_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.currentStep.set(1));
    });
    \u0275\u0275text(63, "\u2190 \u8FD4\u56DE");
    \u0275\u0275elementEnd()()();
  }
}
function AddAccountPageComponent_Conditional_26_Conditional_5_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 32);
    \u0275\u0275text(1, "\u2713");
    \u0275\u0275elementEnd();
  }
}
function AddAccountPageComponent_Conditional_26_Conditional_5_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 33);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(ctx_r1.phoneError());
  }
}
function AddAccountPageComponent_Conditional_26_Conditional_5_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 34);
    \u0275\u0275text(1, "\u8ACB\u5305\u542B\u570B\u5BB6\u4EE3\u78BC\uFF0C\u4F8B\u5982 +63, +86, +1");
    \u0275\u0275elementEnd();
  }
}
function AddAccountPageComponent_Conditional_26_Conditional_5_Conditional_44_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "input", 45);
    \u0275\u0275twoWayListener("ngModelChange", function AddAccountPageComponent_Conditional_26_Conditional_5_Conditional_44_Template_input_ngModelChange_0_listener($event) {
      \u0275\u0275restoreView(_r5);
      const ctx_r1 = \u0275\u0275nextContext(3);
      \u0275\u0275twoWayBindingSet(ctx_r1.proxyAddress, $event) || (ctx_r1.proxyAddress = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.proxyAddress);
  }
}
function AddAccountPageComponent_Conditional_26_Conditional_5_Conditional_53_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "span", 46);
    \u0275\u0275text(1, " \u767C\u9001\u4E2D... ");
  }
}
function AddAccountPageComponent_Conditional_26_Conditional_5_Conditional_54_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u767C\u9001\u9A57\u8B49\u78BC \u2192 ");
  }
}
function AddAccountPageComponent_Conditional_26_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 28)(1, "label");
    \u0275\u0275text(2, "\u624B\u6A5F\u865F\u78BC ");
    \u0275\u0275elementStart(3, "span", 29);
    \u0275\u0275text(4, "*");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(5, "div", 30)(6, "input", 31);
    \u0275\u0275listener("ngModelChange", function AddAccountPageComponent_Conditional_26_Conditional_5_Template_input_ngModelChange_6_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.onPhoneChange($event));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(7, AddAccountPageComponent_Conditional_26_Conditional_5_Conditional_7_Template, 2, 0, "span", 32);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(8, AddAccountPageComponent_Conditional_26_Conditional_5_Conditional_8_Template, 2, 1, "span", 33)(9, AddAccountPageComponent_Conditional_26_Conditional_5_Conditional_9_Template, 2, 0, "span", 34);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "div", 28)(11, "label");
    \u0275\u0275text(12, "\u4EE3\u7406\u8A2D\u7F6E");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "div", 35)(14, "label", 36)(15, "input", 37);
    \u0275\u0275twoWayListener("ngModelChange", function AddAccountPageComponent_Conditional_26_Conditional_5_Template_input_ngModelChange_15_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.proxyMode, $event) || (ctx_r1.proxyMode = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "span", 38)(17, "span", 39);
    \u0275\u0275text(18, "\u{1F310}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(19, "span", 40)(20, "strong");
    \u0275\u0275text(21, "\u81EA\u52D5\u5206\u914D\u975C\u614B\u4EE3\u7406");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(22, "small");
    \u0275\u0275text(23, "\u5F9E\u4EE3\u7406\u6C60\u81EA\u52D5\u5206\u914D\uFF0C\u9632\u5C01\u63A8\u85A6");
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(24, "label", 36)(25, "input", 41);
    \u0275\u0275twoWayListener("ngModelChange", function AddAccountPageComponent_Conditional_26_Conditional_5_Template_input_ngModelChange_25_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.proxyMode, $event) || (ctx_r1.proxyMode = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(26, "span", 38)(27, "span", 39);
    \u0275\u0275text(28, "\u270F\uFE0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(29, "span", 40)(30, "strong");
    \u0275\u0275text(31, "\u624B\u52D5\u8F38\u5165\u4EE3\u7406");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(32, "small");
    \u0275\u0275text(33, "\u4F7F\u7528\u81EA\u5DF1\u7684\u4EE3\u7406\u5730\u5740");
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(34, "label", 36)(35, "input", 42);
    \u0275\u0275twoWayListener("ngModelChange", function AddAccountPageComponent_Conditional_26_Conditional_5_Template_input_ngModelChange_35_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.proxyMode, $event) || (ctx_r1.proxyMode = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(36, "span", 38)(37, "span", 39);
    \u0275\u0275text(38, "\u{1F6AB}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(39, "span", 40)(40, "strong");
    \u0275\u0275text(41, "\u4E0D\u4F7F\u7528\u4EE3\u7406");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(42, "small");
    \u0275\u0275text(43, "\u76F4\u63A5\u9023\u63A5\uFF0C\u6709\u5C01\u865F\u98A8\u96AA");
    \u0275\u0275elementEnd()()()()();
    \u0275\u0275conditionalCreate(44, AddAccountPageComponent_Conditional_26_Conditional_5_Conditional_44_Template, 1, 1, "input", 43);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(45, "div", 28)(46, "label");
    \u0275\u0275text(47, "\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF08\u5982\u6709\uFF09");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(48, "input", 44);
    \u0275\u0275twoWayListener("ngModelChange", function AddAccountPageComponent_Conditional_26_Conditional_5_Template_input_ngModelChange_48_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.twoFactorPassword, $event) || (ctx_r1.twoFactorPassword = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(49, "div", 15)(50, "button", 16);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_26_Conditional_5_Template_button_click_50_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.currentLoginMethod.set("select"));
    });
    \u0275\u0275text(51, "\u2190 \u8FD4\u56DE");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(52, "button", 17);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_26_Conditional_5_Template_button_click_52_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.sendVerificationCode());
    });
    \u0275\u0275conditionalCreate(53, AddAccountPageComponent_Conditional_26_Conditional_5_Conditional_53_Template, 2, 0)(54, AddAccountPageComponent_Conditional_26_Conditional_5_Conditional_54_Template, 1, 0);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(6);
    \u0275\u0275classProp("error", ctx_r1.phoneError())("valid", ctx_r1.phoneValid());
    \u0275\u0275property("ngModel", ctx_r1.phoneNumber);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.phoneValid() ? 7 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.phoneError() ? 8 : 9);
    \u0275\u0275advance(7);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.proxyMode);
    \u0275\u0275advance(10);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.proxyMode);
    \u0275\u0275advance(10);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.proxyMode);
    \u0275\u0275advance(9);
    \u0275\u0275conditional(ctx_r1.proxyMode === "manual" ? 44 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.twoFactorPassword);
    \u0275\u0275advance(4);
    \u0275\u0275property("disabled", !ctx_r1.phoneValid() || ctx_r1.isSending());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isSending() ? 53 : 54);
  }
}
function AddAccountPageComponent_Conditional_26_Conditional_6_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 28)(1, "label");
    \u0275\u0275text(2, "\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC ");
    \u0275\u0275elementStart(3, "span", 29);
    \u0275\u0275text(4, "*");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(5, "input", 52);
    \u0275\u0275twoWayListener("ngModelChange", function AddAccountPageComponent_Conditional_26_Conditional_6_Conditional_10_Template_input_ngModelChange_5_listener($event) {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(3);
      \u0275\u0275twoWayBindingSet(ctx_r1.twoFactorPassword, $event) || (ctx_r1.twoFactorPassword = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(5);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.twoFactorPassword);
  }
}
function AddAccountPageComponent_Conditional_26_Conditional_6_Conditional_13_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275textInterpolate1(" ", ctx_r1.resendCooldown(), "\u79D2\u5F8C\u53EF\u91CD\u767C ");
  }
}
function AddAccountPageComponent_Conditional_26_Conditional_6_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u91CD\u65B0\u767C\u9001\u9A57\u8B49\u78BC ");
  }
}
function AddAccountPageComponent_Conditional_26_Conditional_6_Conditional_19_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "span", 46);
    \u0275\u0275text(1, " \u9A57\u8B49\u4E2D... ");
  }
}
function AddAccountPageComponent_Conditional_26_Conditional_6_Conditional_20_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u9A57\u8B49\u4E26\u767B\u5165 \u2192 ");
  }
}
function AddAccountPageComponent_Conditional_26_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 47)(1, "span", 48);
    \u0275\u0275text(2, "\u{1F4F1}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 28)(5, "label");
    \u0275\u0275text(6, "\u9A57\u8B49\u78BC ");
    \u0275\u0275elementStart(7, "span", 29);
    \u0275\u0275text(8, "*");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(9, "input", 49);
    \u0275\u0275twoWayListener("ngModelChange", function AddAccountPageComponent_Conditional_26_Conditional_6_Template_input_ngModelChange_9_listener($event) {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.verificationCode, $event) || (ctx_r1.verificationCode = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(10, AddAccountPageComponent_Conditional_26_Conditional_6_Conditional_10_Template, 6, 1, "div", 28);
    \u0275\u0275elementStart(11, "div", 50)(12, "button", 51);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_26_Conditional_6_Template_button_click_12_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.resendCode());
    });
    \u0275\u0275conditionalCreate(13, AddAccountPageComponent_Conditional_26_Conditional_6_Conditional_13_Template, 1, 1)(14, AddAccountPageComponent_Conditional_26_Conditional_6_Conditional_14_Template, 1, 0);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(15, "div", 15)(16, "button", 16);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_26_Conditional_6_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.codeStep.set(false));
    });
    \u0275\u0275text(17, "\u2190 \u8FD4\u56DE");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "button", 17);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_26_Conditional_6_Template_button_click_18_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.submitVerificationCode());
    });
    \u0275\u0275conditionalCreate(19, AddAccountPageComponent_Conditional_26_Conditional_6_Conditional_19_Template, 2, 0)(20, AddAccountPageComponent_Conditional_26_Conditional_6_Conditional_20_Template, 1, 0);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" \u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3 ", ctx_r1.phoneNumber, " ");
    \u0275\u0275advance(6);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.verificationCode);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.needs2FA() ? 10 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275property("disabled", ctx_r1.resendCooldown() > 0);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.resendCooldown() > 0 ? 13 : 14);
    \u0275\u0275advance(5);
    \u0275\u0275property("disabled", !ctx_r1.verificationCode || ctx_r1.isVerifying());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isVerifying() ? 19 : 20);
  }
}
function AddAccountPageComponent_Conditional_26_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 11)(1, "div", 13)(2, "h2");
    \u0275\u0275text(3, "\u{1F4AC} \u9A57\u8B49\u78BC\u767B\u5165");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(4, "div", 27);
    \u0275\u0275conditionalCreate(5, AddAccountPageComponent_Conditional_26_Conditional_5_Template, 55, 14)(6, AddAccountPageComponent_Conditional_26_Conditional_6_Template, 21, 7);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(5);
    \u0275\u0275conditional(!ctx_r1.codeStep() ? 5 : 6);
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_23_Conditional_0_For_5_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 78);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const account_r11 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(account_r11.first_name || account_r11.username);
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_23_Conditional_0_For_5_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 79);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const account_r11 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(account_r11.error || "\u7121\u6CD5\u5C0E\u5165");
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_23_Conditional_0_For_5_Template(rf, ctx) {
  if (rf & 1) {
    const _r10 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "label", 74)(1, "input", 75);
    \u0275\u0275listener("change", function AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_23_Conditional_0_For_5_Template_input_change_1_listener() {
      const account_r11 = \u0275\u0275restoreView(_r10).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(5);
      return \u0275\u0275resetView(ctx_r1.toggleTdataAccount(account_r11.index));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "div", 76)(3, "span", 77);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(5, AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_23_Conditional_0_For_5_Conditional_5_Template, 2, 1, "span", 78);
    \u0275\u0275conditionalCreate(6, AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_23_Conditional_0_For_5_Conditional_6_Template, 2, 1, "span", 79);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const account_r11 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(5);
    \u0275\u0275classProp("disabled", !account_r11.can_import);
    \u0275\u0275advance();
    \u0275\u0275property("checked", ctx_r1.selectedTdataAccounts().includes(account_r11.index))("disabled", !account_r11.can_import);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(account_r11.phone);
    \u0275\u0275advance();
    \u0275\u0275conditional(account_r11.first_name || account_r11.username ? 5 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(!account_r11.can_import ? 6 : -1);
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_23_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 70)(1, "h4");
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 72);
    \u0275\u0275repeaterCreate(4, AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_23_Conditional_0_For_5_Template, 7, 7, "label", 73, _forTrack08);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    let tmp_4_0;
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u{1F4CB} \u6AA2\u6E2C\u5230 ", ((tmp_4_0 = ctx_r1.tdataScanResult().accounts) == null ? null : tmp_4_0.length) || 0, " \u500B\u5E33\u865F");
    \u0275\u0275advance(2);
    \u0275\u0275repeater(ctx_r1.tdataScanResult().accounts || \u0275\u0275pureFunction0(1, _c02));
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_23_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 71)(1, "span", 80);
    \u0275\u0275text(2, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span");
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r1.tdataScanResult().error || "\u6383\u63CF\u5931\u6557");
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_23_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275conditionalCreate(0, AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_23_Conditional_0_Template, 6, 2, "div", 70)(1, AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_23_Conditional_1_Template, 5, 1, "div", 71);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275conditional(ctx_r1.tdataScanResult().success ? 0 : 1);
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_24_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 69);
    \u0275\u0275element(1, "span", 46);
    \u0275\u0275elementStart(2, "span");
    \u0275\u0275text(3, "\u6B63\u5728\u6383\u63CF TData...");
    \u0275\u0275elementEnd()();
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    const _r9 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 57)(1, "h4");
    \u0275\u0275text(2, "\u{1F4CD} TData \u4F4D\u7F6E");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 58)(4, "code");
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "div", 59)(7, "button", 60);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_27_Conditional_12_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.copyTdataPath());
    });
    \u0275\u0275text(8, "\u{1F4CB}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "button", 61);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_27_Conditional_12_Template_button_click_9_listener() {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.openTdataFolder());
    });
    \u0275\u0275text(10, "\u{1F4C2}");
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(11, "div", 62);
    \u0275\u0275listener("dragover", function AddAccountPageComponent_Conditional_27_Conditional_12_Template_div_dragover_11_listener($event) {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.onDragOver($event));
    })("dragleave", function AddAccountPageComponent_Conditional_27_Conditional_12_Template_div_dragleave_11_listener($event) {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.onDragLeave($event));
    })("drop", function AddAccountPageComponent_Conditional_27_Conditional_12_Template_div_drop_11_listener($event) {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.onDropTdata($event));
    });
    \u0275\u0275elementStart(12, "div", 63);
    \u0275\u0275text(13, "\u{1F4C1}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "p", 64);
    \u0275\u0275text(15, "\u62D6\u653E tdata \u6587\u4EF6\u593E\u5230\u9019\u88E1");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "p", 65);
    \u0275\u0275text(17, "\u652F\u6301\uFF1A\u6574\u500B\u6587\u4EF6\u593E / ZIP \u58D3\u7E2E\u5305");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "div", 66)(19, "button", 67);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_27_Conditional_12_Template_button_click_19_listener() {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.selectTdataFolder());
    });
    \u0275\u0275text(20, "\u9078\u64C7\u6587\u4EF6\u593E");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(21, "button", 68);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_27_Conditional_12_Template_button_click_21_listener() {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.selectTdataZip());
    });
    \u0275\u0275text(22, "\u9078\u64C7 ZIP");
    \u0275\u0275elementEnd()()();
    \u0275\u0275conditionalCreate(23, AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_23_Template, 2, 1);
    \u0275\u0275conditionalCreate(24, AddAccountPageComponent_Conditional_27_Conditional_12_Conditional_24_Template, 4, 0, "div", 69);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r1.getDefaultTdataPath());
    \u0275\u0275advance(6);
    \u0275\u0275classProp("dragging", ctx_r1.isDragging());
    \u0275\u0275advance(12);
    \u0275\u0275conditional(ctx_r1.tdataScanResult() ? 23 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isScanningTdata() ? 24 : -1);
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_13_Conditional_23_Template(rf, ctx) {
  if (rf & 1) {
    const _r13 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 83)(1, "span", 84);
    \u0275\u0275text(2, "\u{1F4C4}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 85);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "button", 86);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_27_Conditional_13_Conditional_23_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r13);
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.clearSelectedFile());
    });
    \u0275\u0275text(6, "\xD7");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r1.selectedFilePath());
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_13_Template(rf, ctx) {
  if (rf & 1) {
    const _r12 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 81)(1, "h4");
    \u0275\u0275text(2, "\u652F\u6301\u7684\u683C\u5F0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "ul")(4, "li")(5, "strong");
    \u0275\u0275text(6, ".tgpkg");
    \u0275\u0275elementEnd();
    \u0275\u0275text(7, " - TG-Matrix \u5C0E\u51FA\u5305\uFF08\u63A8\u85A6\uFF09");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "li")(9, "strong");
    \u0275\u0275text(10, ".session");
    \u0275\u0275elementEnd();
    \u0275\u0275text(11, " - Pyrogram Session \u6587\u4EF6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "li")(13, "strong");
    \u0275\u0275text(14, ".telethon.session");
    \u0275\u0275elementEnd();
    \u0275\u0275text(15, " - Telethon Session \u6587\u4EF6");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(16, "div", 82);
    \u0275\u0275listener("dragover", function AddAccountPageComponent_Conditional_27_Conditional_13_Template_div_dragover_16_listener($event) {
      \u0275\u0275restoreView(_r12);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.onDragOver($event));
    })("dragleave", function AddAccountPageComponent_Conditional_27_Conditional_13_Template_div_dragleave_16_listener($event) {
      \u0275\u0275restoreView(_r12);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.onDragLeave($event));
    })("drop", function AddAccountPageComponent_Conditional_27_Conditional_13_Template_div_drop_16_listener($event) {
      \u0275\u0275restoreView(_r12);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.onDrop($event));
    })("click", function AddAccountPageComponent_Conditional_27_Conditional_13_Template_div_click_16_listener() {
      \u0275\u0275restoreView(_r12);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.selectSessionFile());
    });
    \u0275\u0275elementStart(17, "div", 63);
    \u0275\u0275text(18, "\u{1F4C4}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(19, "p", 64);
    \u0275\u0275text(20, "\u62D6\u653E Session \u6587\u4EF6\u5230\u9019\u88E1");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(21, "p", 65);
    \u0275\u0275text(22, "\u6216\u9EDE\u64CA\u9078\u64C7\u6587\u4EF6");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(23, AddAccountPageComponent_Conditional_27_Conditional_13_Conditional_23_Template, 7, 1, "div", 83);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(16);
    \u0275\u0275classProp("dragging", ctx_r1.isDragging());
    \u0275\u0275advance(7);
    \u0275\u0275conditional(ctx_r1.selectedFilePath() ? 23 : -1);
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_17_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "span", 46);
    \u0275\u0275text(1, " \u5C0E\u5165\u4E2D... ");
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_17_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275textInterpolate1(" \u5C0E\u5165 ", ctx_r1.selectedTdataAccounts().length, " \u500B\u5E33\u865F \u2192 ");
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_17_Template(rf, ctx) {
  if (rf & 1) {
    const _r14 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 17);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_27_Conditional_17_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r14);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.importTdataAccounts());
    });
    \u0275\u0275conditionalCreate(1, AddAccountPageComponent_Conditional_27_Conditional_17_Conditional_1_Template, 2, 0)(2, AddAccountPageComponent_Conditional_27_Conditional_17_Conditional_2_Template, 1, 1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275property("disabled", ctx_r1.selectedTdataAccounts().length === 0 || ctx_r1.isImporting());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isImporting() ? 1 : 2);
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_18_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "span", 46);
    \u0275\u0275text(1, " \u5C0E\u5165\u4E2D... ");
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_18_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u5C0E\u5165 Session \u2192 ");
  }
}
function AddAccountPageComponent_Conditional_27_Conditional_18_Template(rf, ctx) {
  if (rf & 1) {
    const _r15 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 17);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_27_Conditional_18_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r15);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.importSession());
    });
    \u0275\u0275conditionalCreate(1, AddAccountPageComponent_Conditional_27_Conditional_18_Conditional_1_Template, 2, 0)(2, AddAccountPageComponent_Conditional_27_Conditional_18_Conditional_2_Template, 1, 0);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275property("disabled", !ctx_r1.selectedFilePath() || ctx_r1.isImporting());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isImporting() ? 1 : 2);
  }
}
function AddAccountPageComponent_Conditional_27_Template(rf, ctx) {
  if (rf & 1) {
    const _r8 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 11)(1, "div", 13)(2, "h2");
    \u0275\u0275text(3, "\u{1F4C2} TData / Session \u5C0E\u5165");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(4, "div", 27)(5, "div", 53)(6, "button", 54);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_27_Template_button_click_6_listener() {
      \u0275\u0275restoreView(_r8);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.tdataImportMode.set("tdata"));
    });
    \u0275\u0275text(7, " \u{1F4C2} TData \u6587\u4EF6\u593E ");
    \u0275\u0275elementStart(8, "span", 55);
    \u0275\u0275text(9, "\u63A8\u85A6");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(10, "button", 54);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_27_Template_button_click_10_listener() {
      \u0275\u0275restoreView(_r8);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.tdataImportMode.set("session"));
    });
    \u0275\u0275text(11, " \u{1F4C4} Session \u6587\u4EF6 ");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(12, AddAccountPageComponent_Conditional_27_Conditional_12_Template, 25, 5);
    \u0275\u0275conditionalCreate(13, AddAccountPageComponent_Conditional_27_Conditional_13_Template, 24, 3);
    \u0275\u0275elementStart(14, "div", 15)(15, "button", 16);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_27_Template_button_click_15_listener() {
      \u0275\u0275restoreView(_r8);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.currentLoginMethod.set("select"));
    });
    \u0275\u0275text(16, "\u2190 \u8FD4\u56DE");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(17, AddAccountPageComponent_Conditional_27_Conditional_17_Template, 3, 2, "button", 56)(18, AddAccountPageComponent_Conditional_27_Conditional_18_Template, 3, 2, "button", 56);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(6);
    \u0275\u0275classProp("active", ctx_r1.tdataImportMode() === "tdata");
    \u0275\u0275advance(4);
    \u0275\u0275classProp("active", ctx_r1.tdataImportMode() === "session");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.tdataImportMode() === "tdata" ? 12 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.tdataImportMode() === "session" ? 13 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275conditional(ctx_r1.tdataImportMode() === "tdata" ? 17 : 18);
  }
}
function AddAccountPageComponent_Conditional_28_Conditional_19_Template(rf, ctx) {
  if (rf & 1) {
    const _r17 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 15)(1, "button", 16);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_28_Conditional_19_Template_button_click_1_listener() {
      \u0275\u0275restoreView(_r17);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.currentLoginMethod.set("select"));
    });
    \u0275\u0275text(2, "\u2190 \u8FD4\u56DE");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "button", 90);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_28_Conditional_19_Template_button_click_3_listener() {
      \u0275\u0275restoreView(_r17);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.generateQRCode());
    });
    \u0275\u0275text(4, "\u751F\u6210\u4E8C\u7DAD\u78BC \u2192");
    \u0275\u0275elementEnd()();
  }
}
function AddAccountPageComponent_Conditional_28_Conditional_20_Template(rf, ctx) {
  if (rf & 1) {
    const _r18 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 91)(1, "div", 92);
    \u0275\u0275element(2, "img", 93);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 94);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "div", 95)(6, "p");
    \u0275\u0275text(7, "1. \u6253\u958B\u624B\u6A5F Telegram APP");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "p");
    \u0275\u0275text(9, "2. \u524D\u5F80 \u8A2D\u7F6E \u2192 \u8A2D\u5099 \u2192 \u6383\u63CF\u4E8C\u7DAD\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "p");
    \u0275\u0275text(11, "3. \u6383\u63CF\u4E0A\u65B9\u4E8C\u7DAD\u78BC\u4E26\u78BA\u8A8D\u6388\u6B0A");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(12, "div", 15)(13, "button", 16);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_28_Conditional_20_Template_button_click_13_listener() {
      \u0275\u0275restoreView(_r18);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.currentLoginMethod.set("select"));
    });
    \u0275\u0275text(14, "\u2190 \u8FD4\u56DE");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "button", 90);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_28_Conditional_20_Template_button_click_15_listener() {
      \u0275\u0275restoreView(_r18);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.refreshQRCode());
    });
    \u0275\u0275text(16, "\u{1F504} \u5237\u65B0\u4E8C\u7DAD\u78BC");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(2);
    \u0275\u0275property("src", "data:image/png;base64," + ctx_r1.qrImageBase64(), \u0275\u0275sanitizeUrl);
    \u0275\u0275advance();
    \u0275\u0275classProp("warning", ctx_r1.qrCountdown() <= 10);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u23F1\uFE0F \u6709\u6548\u671F\uFF1A", ctx_r1.qrCountdown(), " \u79D2 ");
  }
}
function AddAccountPageComponent_Conditional_28_Template(rf, ctx) {
  if (rf & 1) {
    const _r16 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 11)(1, "div", 13)(2, "h2");
    \u0275\u0275text(3, "\u{1F4F1} \u6383\u78BC\u767B\u5165");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(4, "div", 27)(5, "div", 28)(6, "label");
    \u0275\u0275text(7, "\u8A2D\u5099\u6A21\u64EC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 87)(9, "button", 88);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_28_Template_button_click_9_listener() {
      \u0275\u0275restoreView(_r16);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.deviceType.set("random"));
    });
    \u0275\u0275text(10, "\u{1F3B2} \u96A8\u6A5F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "button", 88);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_28_Template_button_click_11_listener() {
      \u0275\u0275restoreView(_r16);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.deviceType.set("ios"));
    });
    \u0275\u0275text(12, "\u{1F4F1} iOS");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "button", 88);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_28_Template_button_click_13_listener() {
      \u0275\u0275restoreView(_r16);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.deviceType.set("android"));
    });
    \u0275\u0275text(14, "\u{1F916} Android");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(15, "div", 28)(16, "label");
    \u0275\u0275text(17, "\u4EE3\u7406\u8A2D\u7F6E\uFF08\u53EF\u9078\uFF09");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "input", 89);
    \u0275\u0275twoWayListener("ngModelChange", function AddAccountPageComponent_Conditional_28_Template_input_ngModelChange_18_listener($event) {
      \u0275\u0275restoreView(_r16);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.proxyAddress, $event) || (ctx_r1.proxyAddress = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(19, AddAccountPageComponent_Conditional_28_Conditional_19_Template, 5, 0, "div", 15)(20, AddAccountPageComponent_Conditional_28_Conditional_20_Template, 17, 4);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(9);
    \u0275\u0275classProp("active", ctx_r1.deviceType() === "random");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("active", ctx_r1.deviceType() === "ios");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("active", ctx_r1.deviceType() === "android");
    \u0275\u0275advance(5);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.proxyAddress);
    \u0275\u0275advance();
    \u0275\u0275conditional(!ctx_r1.qrImageBase64() ? 19 : 20);
  }
}
function AddAccountPageComponent_Conditional_29_Conditional_5_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 101);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate("@" + ctx_r1.addedAccountInfo().username);
  }
}
function AddAccountPageComponent_Conditional_29_Conditional_5_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 102)(1, "span", 103);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u{1F510} ", ctx_r1.selectedApiCredential().name || "API " + ctx_r1.selectedApiCredential().api_id);
  }
}
function AddAccountPageComponent_Conditional_29_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 98)(1, "div", 99);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 100)(4, "div", 78);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "div", 77);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(8, AddAccountPageComponent_Conditional_29_Conditional_5_Conditional_8_Template, 2, 1, "div", 101);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(9, AddAccountPageComponent_Conditional_29_Conditional_5_Conditional_9_Template, 3, 1, "div", 102);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", (ctx_r1.addedAccountInfo().firstName || ctx_r1.addedAccountInfo().phone || "?").charAt(0).toUpperCase(), " ");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate2(" ", ctx_r1.addedAccountInfo().firstName || "", " ", ctx_r1.addedAccountInfo().lastName || "", " ");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r1.addedAccountInfo().phone);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.addedAccountInfo().username ? 8 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.selectedApiCredential() ? 9 : -1);
  }
}
function AddAccountPageComponent_Conditional_29_Template(rf, ctx) {
  if (rf & 1) {
    const _r19 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 12)(1, "div", 96);
    \u0275\u0275text(2, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "h2");
    \u0275\u0275text(4, "\u5E33\u6236\u6DFB\u52A0\u6210\u529F\uFF01");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(5, AddAccountPageComponent_Conditional_29_Conditional_5_Template, 10, 6);
    \u0275\u0275elementStart(6, "div", 97)(7, "button", 16);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_29_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r19);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.addAnother());
    });
    \u0275\u0275text(8, "\u2795 \u7E7C\u7E8C\u6DFB\u52A0");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "button", 90);
    \u0275\u0275listener("click", function AddAccountPageComponent_Conditional_29_Template_button_click_9_listener() {
      \u0275\u0275restoreView(_r19);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.goBack());
    });
    \u0275\u0275text(10, "\u8FD4\u56DE\u5E33\u6236\u5217\u8868 \u2192");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(5);
    \u0275\u0275conditional(ctx_r1.addedAccountInfo() ? 5 : -1);
  }
}
var AddAccountPageComponent = class _AddAccountPageComponent {
  constructor() {
    this.ipcService = inject(ElectronIpcService);
    this.toast = inject(ToastService);
    this.membershipService = inject(MembershipService);
    this.back = new EventEmitter();
    this.accountAdded = new EventEmitter();
    this.currentStep = signal(1, ...ngDevMode ? [{ debugName: "currentStep" }] : []);
    this.currentLoginMethod = signal("select", ...ngDevMode ? [{ debugName: "currentLoginMethod" }] : []);
    this.selectedApiCredential = signal(null, ...ngDevMode ? [{ debugName: "selectedApiCredential" }] : []);
    this.phoneCodeHash = "";
    this.loginAccountId = "";
    this.phoneNumber = "";
    this.verificationCode = "";
    this.twoFactorPassword = "";
    this.proxyAddress = "";
    this.proxyMode = "auto";
    this.codeStep = signal(false, ...ngDevMode ? [{ debugName: "codeStep" }] : []);
    this.isSending = signal(false, ...ngDevMode ? [{ debugName: "isSending" }] : []);
    this.isVerifying = signal(false, ...ngDevMode ? [{ debugName: "isVerifying" }] : []);
    this.needs2FA = signal(false, ...ngDevMode ? [{ debugName: "needs2FA" }] : []);
    this.resendCooldown = signal(0, ...ngDevMode ? [{ debugName: "resendCooldown" }] : []);
    this.phoneError = signal("", ...ngDevMode ? [{ debugName: "phoneError" }] : []);
    this.phoneValid = signal(false, ...ngDevMode ? [{ debugName: "phoneValid" }] : []);
    this.deviceType = signal("random", ...ngDevMode ? [{ debugName: "deviceType" }] : []);
    this.qrImageBase64 = signal("", ...ngDevMode ? [{ debugName: "qrImageBase64" }] : []);
    this.qrCountdown = signal(60, ...ngDevMode ? [{ debugName: "qrCountdown" }] : []);
    this.isDragging = signal(false, ...ngDevMode ? [{ debugName: "isDragging" }] : []);
    this.selectedFilePath = signal("", ...ngDevMode ? [{ debugName: "selectedFilePath" }] : []);
    this.isImporting = signal(false, ...ngDevMode ? [{ debugName: "isImporting" }] : []);
    this.tdataImportMode = signal("tdata", ...ngDevMode ? [{ debugName: "tdataImportMode" }] : []);
    this.tdataScanResult = signal(null, ...ngDevMode ? [{ debugName: "tdataScanResult" }] : []);
    this.selectedTdataAccounts = signal([], ...ngDevMode ? [{ debugName: "selectedTdataAccounts" }] : []);
    this.isScanningTdata = signal(false, ...ngDevMode ? [{ debugName: "isScanningTdata" }] : []);
    this.defaultTdataPath = signal("", ...ngDevMode ? [{ debugName: "defaultTdataPath" }] : []);
    this.addedAccountInfo = signal(null, ...ngDevMode ? [{ debugName: "addedAccountInfo" }] : []);
    this.resendTimer = null;
    this.qrTimer = null;
    this.sendTimeout = null;
    this.verifyTimeout = null;
    this.ipcChannels = [];
  }
  ngOnInit() {
    this.setupIpcListeners();
  }
  ngOnDestroy() {
    if (this.resendTimer)
      clearInterval(this.resendTimer);
    if (this.qrTimer)
      clearInterval(this.qrTimer);
    if (this.sendTimeout)
      clearTimeout(this.sendTimeout);
    if (this.verifyTimeout)
      clearTimeout(this.verifyTimeout);
    this.ipcChannels.forEach((ch) => this.ipcService.cleanup(ch));
  }
  setupIpcListeners() {
    this.ipcService.on("login-requires-code", (result) => {
      this.isSending.set(false);
      if (this.sendTimeout) {
        clearTimeout(this.sendTimeout);
        this.sendTimeout = null;
      }
      if (result.phone === this.phoneNumber || result.accountId) {
        this.phoneCodeHash = result.phoneCodeHash;
        this.loginAccountId = result.accountId;
        this.codeStep.set(true);
        this.startResendCooldown();
        const sendType = result.sendType || "app";
        if (sendType === "sms") {
          this.toast.success("\u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3\u624B\u6A5F\u77ED\u4FE1");
        } else {
          this.toast.success("\u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3 Telegram App");
        }
      }
    });
    this.ipcChannels.push("login-requires-code");
    this.ipcService.on("login-success", (result) => {
      this.isVerifying.set(false);
      if (this.verifyTimeout) {
        clearTimeout(this.verifyTimeout);
        this.verifyTimeout = null;
      }
      this.addedAccountInfo.set(result.userInfo || { phone: this.phoneNumber });
      this.currentStep.set(3);
      this.accountAdded.emit(result);
      this.toast.success("\u767B\u5165\u6210\u529F\uFF01");
    });
    this.ipcChannels.push("login-success");
    this.ipcService.on("login-requires-2fa", (result) => {
      this.isVerifying.set(false);
      if (this.verifyTimeout) {
        clearTimeout(this.verifyTimeout);
        this.verifyTimeout = null;
      }
      this.needs2FA.set(true);
      this.toast.info("\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC");
    });
    this.ipcChannels.push("login-requires-2fa");
    this.ipcService.on("login-error", (result) => {
      this.handleLoginError(result);
    });
    this.ipcChannels.push("login-error");
    this.ipcService.on("account-login-error", (result) => {
      this.handleLoginError(result);
    });
    this.ipcChannels.push("account-login-error");
    this.ipcService.on("qr-login-created", (result) => {
      if (result.success !== false && result.qrImageBase64) {
        this.qrImageBase64.set(result.qrImageBase64);
        this.startQRCountdown();
      } else {
        this.toast.error(result.error || "\u751F\u6210\u4E8C\u7DAD\u78BC\u5931\u6557");
      }
    });
    this.ipcChannels.push("qr-login-created");
    this.ipcService.on("qr-login-success", (data) => {
      this.stopQRCountdown();
      this.addedAccountInfo.set(data.userInfo || data);
      this.currentStep.set(3);
      this.accountAdded.emit(data);
      this.toast.success("\u767B\u5165\u6210\u529F\uFF01");
    });
    this.ipcChannels.push("qr-login-success");
    this.ipcService.on("session-imported", (result) => {
      this.isImporting.set(false);
      if (result.success) {
        this.addedAccountInfo.set(result.account || { phone: result.phone });
        this.currentStep.set(3);
        this.accountAdded.emit(result);
        this.toast.success("\u5C0E\u5165\u6210\u529F\uFF01");
      } else {
        this.toast.error(result.error || "\u5C0E\u5165\u5931\u6557");
      }
    });
    this.ipcChannels.push("session-imported");
    this.ipcService.on("session-file-selected", (result) => {
      if (result.path) {
        this.selectedFilePath.set(result.path);
      }
    });
    this.ipcChannels.push("session-file-selected");
    this.ipcService.on("tdata-folder-selected", (result) => {
      if (result.path) {
        this.scanTdata(result.path);
      }
    });
    this.ipcChannels.push("tdata-folder-selected");
    this.ipcService.on("tdata-zip-selected", (result) => {
      if (result.path) {
        this.scanTdata(result.path);
      }
    });
    this.ipcChannels.push("tdata-zip-selected");
    this.ipcService.on("tdata-scan-result", (result) => {
      this.isScanningTdata.set(false);
      this.tdataScanResult.set(result);
      if (result.success && result.accounts?.length > 0) {
        const importableIndices = result.accounts.filter((a) => a.can_import).map((a) => a.index);
        this.selectedTdataAccounts.set(importableIndices);
        this.toast.success(`\u627E\u5230 ${result.accounts.length} \u500B\u5E33\u865F`);
      } else if (result.error) {
        this.toast.error(result.error);
      }
    });
    this.ipcChannels.push("tdata-scan-result");
    this.ipcService.on("tdata-import-result", (result) => {
      this.isImporting.set(false);
      if (result.success) {
        this.addedAccountInfo.set({
          phone: result.phone,
          first_name: result.first_name,
          last_name: result.last_name,
          username: result.username
        });
        this.currentStep.set(3);
        this.accountAdded.emit(result);
        this.toast.success(`\u5E33\u865F ${result.phone} \u5C0E\u5165\u6210\u529F\uFF01`);
      } else {
        this.toast.error(result.error || "\u5C0E\u5165\u5931\u6557");
      }
    });
    this.ipcChannels.push("tdata-import-result");
    this.ipcService.on("tdata-batch-result", (result) => {
      this.isImporting.set(false);
      if (result.success_count > 0) {
        this.currentStep.set(3);
        this.addedAccountInfo.set({
          batch: true,
          count: result.success_count,
          failed: result.fail_count
        });
        this.toast.success(`\u6210\u529F\u5C0E\u5165 ${result.success_count} \u500B\u5E33\u865F`);
        if (result.fail_count > 0) {
          this.toast.warning(`${result.fail_count} \u500B\u5E33\u865F\u5C0E\u5165\u5931\u6557`);
        }
      } else {
        this.toast.error(result.error || "\u6240\u6709\u5E33\u865F\u5C0E\u5165\u5931\u6557");
      }
    });
    this.ipcChannels.push("tdata-batch-result");
    this.ipcService.on("tdata-import-progress", (result) => {
      console.log(`TData import progress: ${result.current}/${result.total}`);
    });
    this.ipcChannels.push("tdata-import-progress");
  }
  // API 選擇回調
  onApiSelected(api) {
    this.selectedApiCredential.set(api);
  }
  onApiCleared() {
    this.selectedApiCredential.set(null);
  }
  proceedToLogin() {
    if (this.selectedApiCredential()) {
      this.currentStep.set(2);
    }
  }
  selectLoginMethod(method) {
    this.currentLoginMethod.set(method);
  }
  goBack() {
    this.back.emit();
  }
  addAnother() {
    this.currentStep.set(1);
    this.currentLoginMethod.set("select");
    this.selectedApiCredential.set(null);
    this.resetForm();
  }
  openUpgrade() {
    window.dispatchEvent(new CustomEvent("open-membership-dialog"));
  }
  resetForm() {
    this.phoneNumber = "";
    this.verificationCode = "";
    this.twoFactorPassword = "";
    this.proxyAddress = "";
    this.proxyMode = "auto";
    this.phoneCodeHash = "";
    this.loginAccountId = "";
    this.codeStep.set(false);
    this.qrImageBase64.set("");
    this.selectedFilePath.set("");
    this.needs2FA.set(false);
    this.addedAccountInfo.set(null);
  }
  // 🆕 手機號碼即時驗證
  validatePhone(phone) {
    if (!phone) {
      return { valid: false, error: "" };
    }
    const trimmed = phone.trim();
    if (!trimmed.startsWith("+")) {
      return { valid: false, error: "\u865F\u78BC\u5FC5\u9808\u4EE5 + \u958B\u982D\uFF0C\u4F8B\u5982 +63\u3001+86\u3001+1" };
    }
    const numbersOnly = trimmed.slice(1);
    if (!/^\d+$/.test(numbersOnly)) {
      return { valid: false, error: "\u865F\u78BC\u53EA\u80FD\u5305\u542B\u6578\u5B57\uFF08+ \u865F\u5F8C\u9762\uFF09" };
    }
    if (numbersOnly.length < 8) {
      return { valid: false, error: "\u865F\u78BC\u9577\u5EA6\u4E0D\u8DB3\uFF08\u81F3\u5C11\u9700\u8981 8 \u4F4D\u6578\u5B57\uFF09" };
    }
    if (numbersOnly.length > 15) {
      return { valid: false, error: "\u865F\u78BC\u9577\u5EA6\u904E\u9577\uFF08\u6700\u591A 15 \u4F4D\u6578\u5B57\uFF09" };
    }
    return { valid: true, error: "" };
  }
  // 🆕 手機輸入變更處理
  onPhoneChange(value) {
    this.phoneNumber = value;
    const result = this.validatePhone(value);
    this.phoneValid.set(result.valid);
    this.phoneError.set(result.error);
  }
  // 驗證碼登入
  sendVerificationCode() {
    const selectedApi = this.selectedApiCredential();
    if (!selectedApi) {
      this.toast.error("\u8ACB\u5148\u9078\u64C7 API");
      return;
    }
    if (!this.phoneNumber) {
      this.phoneError.set("\u8ACB\u8F38\u5165\u624B\u6A5F\u865F\u78BC");
      this.toast.error("\u8ACB\u8F38\u5165\u624B\u6A5F\u865F\u78BC");
      return;
    }
    const validation = this.validatePhone(this.phoneNumber);
    if (!validation.valid) {
      this.phoneError.set(validation.error);
      this.toast.error(validation.error);
      return;
    }
    if (this.sendTimeout) {
      clearTimeout(this.sendTimeout);
    }
    this.isSending.set(true);
    this.phoneError.set("");
    const proxyValue = this.getProxyValue();
    this.ipcService.send("add-account", {
      phone: this.phoneNumber,
      apiId: selectedApi.api_id,
      apiHash: selectedApi.api_hash,
      proxy: proxyValue,
      twoFactorPassword: this.twoFactorPassword || null
    });
    setTimeout(() => {
      this.ipcService.send("login-account", {
        phone: this.phoneNumber,
        apiId: selectedApi.api_id,
        apiHash: selectedApi.api_hash,
        proxy: proxyValue,
        twoFactorPassword: this.twoFactorPassword || null
      });
    }, 500);
    this.sendTimeout = setTimeout(() => {
      if (this.isSending()) {
        this.isSending.set(false);
        this.phoneError.set("\u8ACB\u6C42\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5\u5F8C\u91CD\u8A66");
        this.toast.error("\u767C\u9001\u9A57\u8B49\u78BC\u8D85\u6642\uFF0C\u8ACB\u91CD\u8A66");
      }
    }, 3e4);
  }
  submitVerificationCode() {
    if (!this.verificationCode) {
      this.toast.error("\u8ACB\u8F38\u5165\u9A57\u8B49\u78BC");
      return;
    }
    if (this.needs2FA() && !this.twoFactorPassword) {
      this.toast.error("\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC");
      return;
    }
    if (this.verifyTimeout) {
      clearTimeout(this.verifyTimeout);
      this.verifyTimeout = null;
    }
    this.isVerifying.set(true);
    const selectedApi = this.selectedApiCredential();
    this.ipcService.send("login-account", {
      phone: this.phoneNumber,
      phoneCode: this.verificationCode,
      phoneCodeHash: this.phoneCodeHash,
      twoFactorPassword: this.twoFactorPassword || null,
      apiId: selectedApi?.api_id,
      apiHash: selectedApi?.api_hash
    });
    this.verifyTimeout = setTimeout(() => {
      if (this.isVerifying()) {
        this.isVerifying.set(false);
        this.toast.error("\u9A57\u8B49\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5\u5F8C\u91CD\u8A66");
      }
    }, 3e4);
  }
  /**
   * 根據代理模式獲取代理值
   * - 'auto': 返回 'auto'，後端自動從代理池分配
   * - 'manual': 返回用戶輸入的代理地址
   * - 'none': 返回 null，不使用代理
   */
  getProxyValue() {
    switch (this.proxyMode) {
      case "auto":
        return "auto";
      // 後端會識別這個特殊值並自動分配
      case "manual":
        return this.proxyAddress || null;
      case "none":
      default:
        return null;
    }
  }
  resendCode() {
    this.sendVerificationCode();
  }
  // 🆕 統一處理登入錯誤
  handleLoginError(result) {
    this.isSending.set(false);
    this.isVerifying.set(false);
    if (this.sendTimeout) {
      clearTimeout(this.sendTimeout);
      this.sendTimeout = null;
    }
    if (this.verifyTimeout) {
      clearTimeout(this.verifyTimeout);
      this.verifyTimeout = null;
    }
    const errorMessage = result.friendlyMessage || result.error || result.message || "\u767B\u5165\u5931\u6557";
    if (errorMessage.includes("2FA") && errorMessage.includes("\u5BC6\u78BC")) {
      this.toast.error("\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\u932F\u8AA4\uFF0C\u8ACB\u91CD\u65B0\u8F38\u5165");
      this.twoFactorPassword = "";
      return;
    }
    if (result.codeExpired) {
      this.toast.error("\u9A57\u8B49\u78BC\u5DF2\u904E\u671F\uFF0C\u8ACB\u91CD\u65B0\u767C\u9001");
      this.codeStep.set(false);
      this.verificationCode = "";
      this.phoneCodeHash = "";
      return;
    }
    this.toast.error(errorMessage);
  }
  startResendCooldown() {
    this.resendCooldown.set(60);
    this.resendTimer = setInterval(() => {
      const current = this.resendCooldown();
      if (current <= 1) {
        clearInterval(this.resendTimer);
        this.resendCooldown.set(0);
      } else {
        this.resendCooldown.set(current - 1);
      }
    }, 1e3);
  }
  // QR 登入
  generateQRCode() {
    const selectedApi = this.selectedApiCredential();
    if (!selectedApi) {
      this.toast.error("\u8ACB\u5148\u9078\u64C7 API");
      return;
    }
    this.ipcService.send("qr-login-create", {
      proxy: this.getProxyValue(),
      deviceType: this.deviceType() === "random" ? null : this.deviceType(),
      customApiId: selectedApi.api_id,
      customApiHash: selectedApi.api_hash
    });
  }
  refreshQRCode() {
    this.qrImageBase64.set("");
    this.generateQRCode();
  }
  startQRCountdown() {
    this.qrCountdown.set(60);
    this.qrTimer = setInterval(() => {
      const current = this.qrCountdown();
      if (current <= 1) {
        this.stopQRCountdown();
      } else {
        this.qrCountdown.set(current - 1);
      }
    }, 1e3);
  }
  stopQRCountdown() {
    if (this.qrTimer) {
      clearInterval(this.qrTimer);
      this.qrTimer = null;
    }
  }
  // TData 導入
  onDragOver(event) {
    event.preventDefault();
    this.isDragging.set(true);
  }
  onDragLeave(event) {
    event.preventDefault();
    this.isDragging.set(false);
  }
  onDrop(event) {
    event.preventDefault();
    this.isDragging.set(false);
    const files = event.dataTransfer?.files;
    if (files && files.length > 0) {
      const path2 = files[0].path;
      if (path2) {
        this.selectedFilePath.set(path2);
      }
    }
  }
  onDropTdata(event) {
    event.preventDefault();
    this.isDragging.set(false);
    const files = event.dataTransfer?.files;
    if (files && files.length > 0) {
      const path2 = files[0].path;
      if (path2) {
        this.scanTdata(path2);
      }
    }
  }
  selectSessionFile() {
    this.ipcService.send("select-session-file", {});
  }
  selectTdataFolder() {
    this.ipcService.send("select-tdata-folder", {});
  }
  selectTdataZip() {
    this.ipcService.send("select-tdata-zip", {});
  }
  scanTdata(path2) {
    this.isScanningTdata.set(true);
    this.tdataScanResult.set(null);
    this.selectedTdataAccounts.set([]);
    this.ipcService.send("scan-tdata", { path: path2 });
  }
  toggleTdataAccount(index) {
    this.selectedTdataAccounts.update((current) => {
      if (current.includes(index)) {
        return current.filter((i) => i !== index);
      } else {
        return [...current, index];
      }
    });
  }
  getDefaultTdataPath() {
    const isWin = navigator.userAgent.includes("Windows");
    const isMac = navigator.userAgent.includes("Mac");
    if (isWin) {
      return "%APPDATA%\\Telegram Desktop\\tdata";
    } else if (isMac) {
      return "~/Library/Application Support/Telegram Desktop/tdata";
    } else {
      return "~/.local/share/TelegramDesktop/tdata";
    }
  }
  copyTdataPath() {
    const path2 = this.getDefaultTdataPath();
    navigator.clipboard.writeText(path2.replace("%APPDATA%", "").replace("~", ""));
    this.toast.success("\u8DEF\u5F91\u5DF2\u8907\u88FD");
  }
  openTdataFolder() {
    this.ipcService.send("open-default-tdata-folder", {});
  }
  importTdataAccounts() {
    const selectedApi = this.selectedApiCredential();
    if (!selectedApi) {
      this.toast.error("\u8ACB\u5148\u9078\u64C7 API");
      return;
    }
    const scanResult = this.tdataScanResult();
    if (!scanResult?.tdata_path) {
      this.toast.error("\u8ACB\u5148\u6383\u63CF TData");
      return;
    }
    const indices = this.selectedTdataAccounts();
    if (indices.length === 0) {
      this.toast.error("\u8ACB\u9078\u64C7\u8981\u5C0E\u5165\u7684\u5E33\u865F");
      return;
    }
    this.isImporting.set(true);
    if (indices.length === 1) {
      this.ipcService.send("import-tdata-account", {
        tdataPath: scanResult.tdata_path,
        accountIndex: indices[0],
        apiId: selectedApi.api_id,
        apiHash: selectedApi.api_hash
      });
    } else {
      this.ipcService.send("import-tdata-batch", {
        tdataPath: scanResult.tdata_path,
        accountIndices: indices,
        apiId: selectedApi.api_id,
        apiHash: selectedApi.api_hash
      });
    }
  }
  clearSelectedFile() {
    this.selectedFilePath.set("");
  }
  importSession() {
    const selectedApi = this.selectedApiCredential();
    if (!selectedApi) {
      this.toast.error("\u8ACB\u5148\u9078\u64C7 API");
      return;
    }
    this.isImporting.set(true);
    this.ipcService.send("import-session", {
      filePath: this.selectedFilePath(),
      apiId: selectedApi.api_id,
      apiHash: selectedApi.api_hash
    });
  }
  static {
    this.\u0275fac = function AddAccountPageComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _AddAccountPageComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _AddAccountPageComponent, selectors: [["app-add-account-page"]], outputs: { back: "back", accountAdded: "accountAdded" }, decls: 30, vars: 20, consts: [[1, "add-account-page"], [1, "page-header"], [1, "back-btn", 3, "click"], [1, "page-title"], [1, "step-indicator"], [1, "step"], [1, "step-number"], [1, "step-label"], [1, "step-line"], [1, "config-section"], [1, "login-selection"], [1, "login-form"], [1, "success-section"], [1, "section-header"], [3, "apiSelected", "selectionCleared", "showSelected"], [1, "form-actions"], [1, "btn-secondary", 3, "click"], [1, "btn-primary", 3, "click", "disabled"], [1, "login-cards"], [1, "login-card", "recommended", 3, "click"], [1, "login-badge"], [1, "login-icon"], [1, "login-risk", "low"], [1, "login-card", "safe", 3, "click"], [1, "login-risk", "lowest"], [1, "login-card", "warning", 3, "click"], [1, "login-risk", "high"], [1, "form-card"], [1, "form-group"], [1, "required"], [1, "input-with-prefix"], ["type", "tel", "placeholder", "+639952947692", 1, "form-input", 3, "ngModelChange", "ngModel"], [1, "input-status", "valid"], [1, "error-text"], [1, "hint"], [1, "proxy-options"], [1, "proxy-option"], ["type", "radio", "name", "proxyMode", "value", "auto", 3, "ngModelChange", "ngModel"], [1, "option-content"], [1, "option-icon"], [1, "option-text"], ["type", "radio", "name", "proxyMode", "value", "manual", 3, "ngModelChange", "ngModel"], ["type", "radio", "name", "proxyMode", "value", "none", 3, "ngModelChange", "ngModel"], ["type", "text", "placeholder", "socks5://user:pass@host:port", 1, "form-input", "mt-2", 3, "ngModel"], ["type", "password", "placeholder", "\u5982\u679C\u5E33\u865F\u958B\u555F\u4E86\u4E8C\u6B65\u9A57\u8B49", 1, "form-input", 3, "ngModelChange", "ngModel"], ["type", "text", "placeholder", "socks5://user:pass@host:port", 1, "form-input", "mt-2", 3, "ngModelChange", "ngModel"], [1, "spinner"], [1, "code-sent-info"], [1, "info-icon"], ["type", "text", "placeholder", "\u8F38\u5165\u6536\u5230\u7684\u9A57\u8B49\u78BC", "maxlength", "6", 1, "form-input", "code-input", 3, "ngModelChange", "ngModel"], [1, "resend-section"], [1, "resend-btn", 3, "click", "disabled"], ["type", "password", "placeholder", "\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC", 1, "form-input", 3, "ngModelChange", "ngModel"], [1, "import-mode-tabs"], [1, "mode-tab", 3, "click"], [1, "badge-recommend"], [1, "btn-primary", 3, "disabled"], [1, "tdata-path-hint"], [1, "path-box"], [1, "path-actions"], ["title", "\u8907\u88FD\u8DEF\u5F91", 1, "icon-btn", 3, "click"], ["title", "\u6253\u958B\u6587\u4EF6\u593E", 1, "icon-btn", 3, "click"], [1, "drop-zone", "large", 3, "dragover", "dragleave", "drop"], [1, "drop-icon"], [1, "drop-text"], [1, "drop-hint"], [1, "drop-buttons"], [1, "select-btn", 3, "click"], [1, "select-btn", "secondary", 3, "click"], [1, "scanning-indicator"], [1, "scan-result", "success"], [1, "scan-result", "error"], [1, "accounts-list"], [1, "account-item", 3, "disabled"], [1, "account-item"], ["type", "checkbox", 3, "change", "checked", "disabled"], [1, "account-info"], [1, "account-phone"], [1, "account-name"], [1, "account-error"], [1, "error-icon"], [1, "tdata-info"], [1, "drop-zone", 3, "dragover", "dragleave", "drop", "click"], [1, "selected-file"], [1, "file-icon"], [1, "file-path"], [1, "clear-btn", 3, "click"], [1, "device-options"], [1, "device-btn", 3, "click"], ["type", "text", "placeholder", "socks5://host:port", 1, "form-input", 3, "ngModelChange", "ngModel"], [1, "btn-primary", 3, "click"], [1, "qr-section"], [1, "qr-container"], ["alt", "QR Code", 1, "qr-image", 3, "src"], [1, "qr-countdown"], [1, "qr-instructions"], [1, "success-icon"], [1, "form-actions", "center"], [1, "account-card"], [1, "account-avatar"], [1, "account-details"], [1, "account-username"], [1, "api-info"], [1, "api-badge", "expert"]], template: function AddAccountPageComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0)(1, "div", 1)(2, "button", 2);
        \u0275\u0275listener("click", function AddAccountPageComponent_Template_button_click_2_listener() {
          return ctx.goBack();
        });
        \u0275\u0275text(3, " \u2190 \u8FD4\u56DE\u5E33\u6236\u5217\u8868 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(4, "h1", 3);
        \u0275\u0275text(5, "\u2795 \u6DFB\u52A0\u65B0\u5E33\u6236");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(6, "div", 4)(7, "div", 5)(8, "span", 6);
        \u0275\u0275text(9, "1");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(10, "span", 7);
        \u0275\u0275text(11, "\u9078\u64C7 API");
        \u0275\u0275elementEnd()();
        \u0275\u0275element(12, "div", 8);
        \u0275\u0275elementStart(13, "div", 5)(14, "span", 6);
        \u0275\u0275text(15, "2");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(16, "span", 7);
        \u0275\u0275text(17, "\u767B\u5165\u5E33\u865F");
        \u0275\u0275elementEnd()();
        \u0275\u0275element(18, "div", 8);
        \u0275\u0275elementStart(19, "div", 5)(20, "span", 6);
        \u0275\u0275text(21, "3");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(22, "span", 7);
        \u0275\u0275text(23, "\u5B8C\u6210");
        \u0275\u0275elementEnd()()();
        \u0275\u0275conditionalCreate(24, AddAccountPageComponent_Conditional_24_Template, 12, 2, "div", 9);
        \u0275\u0275conditionalCreate(25, AddAccountPageComponent_Conditional_25_Template, 64, 0, "div", 10);
        \u0275\u0275conditionalCreate(26, AddAccountPageComponent_Conditional_26_Template, 7, 1, "div", 11);
        \u0275\u0275conditionalCreate(27, AddAccountPageComponent_Conditional_27_Template, 19, 7, "div", 11);
        \u0275\u0275conditionalCreate(28, AddAccountPageComponent_Conditional_28_Template, 21, 8, "div", 11);
        \u0275\u0275conditionalCreate(29, AddAccountPageComponent_Conditional_29_Template, 11, 1, "div", 12);
        \u0275\u0275elementEnd();
      }
      if (rf & 2) {
        \u0275\u0275advance(7);
        \u0275\u0275classProp("active", ctx.currentStep() >= 1)("completed", ctx.currentStep() > 1);
        \u0275\u0275advance(5);
        \u0275\u0275classProp("active", ctx.currentStep() > 1);
        \u0275\u0275advance();
        \u0275\u0275classProp("active", ctx.currentStep() >= 2)("completed", ctx.currentStep() > 2);
        \u0275\u0275advance(5);
        \u0275\u0275classProp("active", ctx.currentStep() > 2);
        \u0275\u0275advance();
        \u0275\u0275classProp("active", ctx.currentStep() >= 3);
        \u0275\u0275advance(5);
        \u0275\u0275conditional(ctx.currentStep() === 1 ? 24 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.currentStep() === 2 && ctx.currentLoginMethod() === "select" ? 25 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.currentStep() === 2 && ctx.currentLoginMethod() === "code" ? 26 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.currentStep() === 2 && ctx.currentLoginMethod() === "tdata" ? 27 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.currentStep() === 2 && ctx.currentLoginMethod() === "qr" ? 28 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.currentStep() === 3 ? 29 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, DefaultValueAccessor, RadioControlValueAccessor, NgControlStatus, MaxLengthValidator, NgModel, ApiSelectorComponent], styles: ["\n\n.add-account-page[_ngcontent-%COMP%] {\n  max-width: 900px;\n  margin: 0 auto;\n  padding: 2rem;\n}\n.page-header[_ngcontent-%COMP%] {\n  margin-bottom: 2rem;\n}\n.back-btn[_ngcontent-%COMP%] {\n  background: none;\n  border: none;\n  color: var(--primary, #06b6d4);\n  cursor: pointer;\n  font-size: 0.875rem;\n  margin-bottom: 0.5rem;\n  padding: 0;\n}\n.back-btn[_ngcontent-%COMP%]:hover {\n  text-decoration: underline;\n}\n.page-title[_ngcontent-%COMP%] {\n  margin: 0;\n  font-size: 2rem;\n  color: var(--text-primary, white);\n}\n.step-indicator[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 2rem;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.step[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.step-number[_ngcontent-%COMP%] {\n  width: 28px;\n  height: 28px;\n  border-radius: 50%;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--text-muted, #94a3b8);\n}\n.step.active[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%] {\n  background: var(--primary, #06b6d4);\n  color: white;\n}\n.step.completed[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%] {\n  background: #22c55e;\n  color: white;\n}\n.step-label[_ngcontent-%COMP%] {\n  font-size: 0.8rem;\n  color: var(--text-muted, #94a3b8);\n}\n.step.active[_ngcontent-%COMP%]   .step-label[_ngcontent-%COMP%] {\n  color: var(--text-primary, white);\n}\n.step-line[_ngcontent-%COMP%] {\n  width: 40px;\n  height: 2px;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n}\n.step-line.active[_ngcontent-%COMP%] {\n  background: var(--primary, #06b6d4);\n}\n.mode-selection[_ngcontent-%COMP%], \n.login-selection[_ngcontent-%COMP%] {\n  text-align: center;\n}\n.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], \n.selection-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%] {\n  margin: 0 0 0.5rem 0;\n  color: var(--text-primary, white);\n  font-size: 1.5rem;\n}\n.section-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], \n.selection-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n  margin: 0 0 2rem 0;\n  color: var(--text-muted, #94a3b8);\n}\n.mode-cards[_ngcontent-%COMP%], \n.login-cards[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1.5rem;\n  margin-bottom: 2rem;\n}\n@media (max-width: 700px) {\n  .mode-cards[_ngcontent-%COMP%], \n   .login-cards[_ngcontent-%COMP%] {\n    grid-template-columns: 1fr;\n  }\n}\n.login-cards[_ngcontent-%COMP%] {\n  grid-template-columns: repeat(3, 1fr);\n}\n@media (max-width: 800px) {\n  .login-cards[_ngcontent-%COMP%] {\n    grid-template-columns: 1fr;\n  }\n}\n.mode-card[_ngcontent-%COMP%], \n.login-card[_ngcontent-%COMP%] {\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 2px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 1rem;\n  padding: 1.5rem;\n  cursor: pointer;\n  transition: all 0.2s;\n  position: relative;\n  text-align: left;\n}\n.mode-card[_ngcontent-%COMP%]:hover, \n.login-card[_ngcontent-%COMP%]:hover {\n  transform: translateY(-4px);\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);\n}\n.mode-card.expert[_ngcontent-%COMP%]:hover {\n  border-color: #22c55e;\n}\n.mode-card.platform[_ngcontent-%COMP%]:hover {\n  border-color: #06b6d4;\n}\n.mode-card.disabled[_ngcontent-%COMP%] {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.mode-card.disabled[_ngcontent-%COMP%]:hover {\n  transform: none;\n}\n.login-card.recommended[_ngcontent-%COMP%]:hover {\n  border-color: #22c55e;\n}\n.login-card.safe[_ngcontent-%COMP%]:hover {\n  border-color: #06b6d4;\n}\n.login-card.warning[_ngcontent-%COMP%]:hover {\n  border-color: #f59e0b;\n}\n.mode-badge[_ngcontent-%COMP%], \n.login-badge[_ngcontent-%COMP%] {\n  position: absolute;\n  top: -10px;\n  right: 1rem;\n  padding: 0.25rem 0.75rem;\n  border-radius: 1rem;\n  font-size: 0.7rem;\n  font-weight: 600;\n}\n.mode-card.expert[_ngcontent-%COMP%]   .mode-badge[_ngcontent-%COMP%] {\n  background: #22c55e;\n  color: white;\n}\n.mode-card.platform[_ngcontent-%COMP%]   .mode-badge[_ngcontent-%COMP%] {\n  background: #06b6d4;\n  color: white;\n}\n.login-card.recommended[_ngcontent-%COMP%]   .login-badge[_ngcontent-%COMP%] {\n  background: #22c55e;\n  color: white;\n}\n.login-card.safe[_ngcontent-%COMP%]   .login-badge[_ngcontent-%COMP%] {\n  background: #06b6d4;\n  color: white;\n}\n.login-card.warning[_ngcontent-%COMP%]   .login-badge[_ngcontent-%COMP%] {\n  background: #f59e0b;\n  color: black;\n}\n.mode-icon[_ngcontent-%COMP%], \n.login-icon[_ngcontent-%COMP%] {\n  font-size: 2.5rem;\n  margin-bottom: 0.75rem;\n}\n.mode-title[_ngcontent-%COMP%], \n.login-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%] {\n  margin: 0 0 0.25rem 0;\n  color: var(--text-primary, white);\n  font-size: 1.25rem;\n}\n.mode-subtitle[_ngcontent-%COMP%], \n.login-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n  margin: 0 0 1rem 0;\n  font-size: 0.875rem;\n  color: var(--text-muted, #94a3b8);\n}\n.mode-features[_ngcontent-%COMP%], \n.login-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] {\n  list-style: none;\n  padding: 0;\n  margin: 0 0 1rem 0;\n  font-size: 0.8rem;\n}\n.mode-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], \n.login-card[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] {\n  margin-bottom: 0.375rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.mode-suitable[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-muted, #64748b);\n  margin-bottom: 1rem;\n}\n.mode-risk[_ngcontent-%COMP%], \n.login-risk[_ngcontent-%COMP%] {\n  padding: 0.375rem 0.75rem;\n  border-radius: 0.5rem;\n  font-size: 0.7rem;\n  font-weight: 500;\n  display: inline-block;\n  margin-bottom: 1rem;\n}\n.mode-risk.safe[_ngcontent-%COMP%], \n.login-risk.lowest[_ngcontent-%COMP%] {\n  background: rgba(6, 182, 212, 0.2);\n  color: #67e8f9;\n}\n.mode-risk.medium[_ngcontent-%COMP%], \n.login-risk.low[_ngcontent-%COMP%] {\n  background: rgba(34, 197, 94, 0.2);\n  color: #86efac;\n}\n.login-risk.high[_ngcontent-%COMP%] {\n  background: rgba(245, 158, 11, 0.2);\n  color: #fcd34d;\n}\n.quota-info[_ngcontent-%COMP%] {\n  margin-bottom: 1rem;\n}\n.quota-bar[_ngcontent-%COMP%] {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  padding: 0.75rem;\n  border-radius: 0.5rem;\n}\n.quota-label[_ngcontent-%COMP%] {\n  font-size: 0.7rem;\n  color: var(--text-muted, #94a3b8);\n  margin-bottom: 0.375rem;\n}\n.quota-progress[_ngcontent-%COMP%] {\n  height: 6px;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.8));\n  border-radius: 3px;\n  overflow: hidden;\n  margin-bottom: 0.375rem;\n}\n.quota-fill[_ngcontent-%COMP%] {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #06b6d4,\n      #22c55e);\n  border-radius: 3px;\n}\n.quota-text[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.quota-locked[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  background: rgba(245, 158, 11, 0.1);\n  border-radius: 0.5rem;\n  font-size: 0.75rem;\n  color: #fcd34d;\n}\n.mode-btn[_ngcontent-%COMP%] {\n  width: 100%;\n  padding: 0.75rem;\n  border: none;\n  border-radius: 0.5rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.mode-card.expert[_ngcontent-%COMP%]   .mode-btn[_ngcontent-%COMP%] {\n  background: #22c55e;\n  color: white;\n}\n.mode-card.platform[_ngcontent-%COMP%]   .mode-btn[_ngcontent-%COMP%] {\n  background: #06b6d4;\n  color: white;\n}\n.mode-btn.upgrade[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #f59e0b,\n      #ef4444);\n}\n.help-section[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1rem;\n  text-align: left;\n}\n@media (max-width: 600px) {\n  .help-section[_ngcontent-%COMP%] {\n    grid-template-columns: 1fr;\n  }\n}\n.help-card[_ngcontent-%COMP%] {\n  background: var(--bg-card, rgba(30, 41, 59, 0.5));\n  padding: 1rem;\n  border-radius: 0.75rem;\n}\n.help-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%] {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.875rem;\n  color: var(--text-primary, white);\n}\n.help-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.8rem;\n  color: var(--text-muted, #94a3b8);\n}\n.config-section[_ngcontent-%COMP%] {\n  max-width: 600px;\n  margin: 0 auto;\n}\n.form-card[_ngcontent-%COMP%] {\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border-radius: 1rem;\n  padding: 1.5rem;\n  margin-bottom: 1.5rem;\n}\n.form-group[_ngcontent-%COMP%] {\n  margin-bottom: 1.25rem;\n}\n.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%] {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-size: 0.875rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.required[_ngcontent-%COMP%] {\n  color: #ef4444;\n}\n.proxy-options[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  margin-top: 0.5rem;\n}\n.proxy-option[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  padding: 0.75rem 1rem;\n  background: var(--bg-secondary, #1e293b);\n  border: 2px solid transparent;\n  border-radius: 0.5rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.proxy-option[_ngcontent-%COMP%]:hover {\n  background: var(--bg-tertiary, #334155);\n}\n.proxy-option[_ngcontent-%COMP%]:has(input:checked) {\n  border-color: var(--accent-color, #8b5cf6);\n  background: rgba(139, 92, 246, 0.1);\n}\n.proxy-option[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%] {\n  display: none;\n}\n.proxy-option[_ngcontent-%COMP%]   .option-content[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.proxy-option[_ngcontent-%COMP%]   .option-icon[_ngcontent-%COMP%] {\n  font-size: 1.5rem;\n}\n.proxy-option[_ngcontent-%COMP%]   .option-text[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n}\n.proxy-option[_ngcontent-%COMP%]   .option-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%] {\n  font-size: 0.9rem;\n  color: var(--text-primary, #f1f5f9);\n}\n.proxy-option[_ngcontent-%COMP%]   .option-text[_ngcontent-%COMP%]   small[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-secondary, #94a3b8);\n}\n.mt-2[_ngcontent-%COMP%] {\n  margin-top: 0.5rem;\n}\n.form-input[_ngcontent-%COMP%] {\n  width: 100%;\n  padding: 0.75rem 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n  box-sizing: border-box;\n}\n.form-input[_ngcontent-%COMP%]:focus {\n  outline: none;\n  border-color: var(--primary, #06b6d4);\n}\n.form-input.error[_ngcontent-%COMP%] {\n  border-color: #ef4444;\n  background: rgba(239, 68, 68, 0.05);\n}\n.form-input.valid[_ngcontent-%COMP%] {\n  border-color: #22c55e;\n}\n.input-with-prefix[_ngcontent-%COMP%] {\n  position: relative;\n  display: flex;\n  align-items: center;\n}\n.input-with-prefix[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%] {\n  flex: 1;\n  padding-right: 2.5rem;\n}\n.input-status[_ngcontent-%COMP%] {\n  position: absolute;\n  right: 0.75rem;\n  font-size: 1rem;\n}\n.input-status.valid[_ngcontent-%COMP%] {\n  color: #22c55e;\n}\n.form-input.code-input[_ngcontent-%COMP%] {\n  text-align: center;\n  font-size: 1.5rem;\n  letter-spacing: 0.5rem;\n}\n.hint[_ngcontent-%COMP%] {\n  display: block;\n  margin-top: 0.375rem;\n  font-size: 0.75rem;\n  color: var(--text-muted, #64748b);\n}\n.error-text[_ngcontent-%COMP%] {\n  display: block;\n  margin-top: 0.375rem;\n  font-size: 0.75rem;\n  color: #ef4444;\n}\n.guide-box[_ngcontent-%COMP%] {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  padding: 1rem;\n  border-radius: 0.5rem;\n  margin-bottom: 1rem;\n}\n.guide-box[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%] {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.875rem;\n  color: var(--text-primary, white);\n}\n.guide-box[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%] {\n  margin: 0;\n  padding-left: 1.25rem;\n  font-size: 0.8rem;\n  color: var(--text-muted, #94a3b8);\n}\n.guide-box[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] {\n  margin-bottom: 0.375rem;\n}\n.guide-box[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] {\n  color: var(--primary, #06b6d4);\n}\n.warning-box[_ngcontent-%COMP%], \n.risk-warning[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.75rem;\n  padding: 1rem;\n  background: rgba(245, 158, 11, 0.1);\n  border: 1px solid rgba(245, 158, 11, 0.3);\n  border-radius: 0.5rem;\n}\n.warning-icon[_ngcontent-%COMP%] {\n  font-size: 1.25rem;\n}\n.warning-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%] {\n  display: block;\n  color: #fcd34d;\n  margin-bottom: 0.375rem;\n  font-size: 0.875rem;\n}\n.warning-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], \n.warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n  margin: 0;\n  padding-left: 1rem;\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n  padding-left: 0;\n}\n.quota-card[_ngcontent-%COMP%] {\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border-radius: 1rem;\n  padding: 1.5rem;\n  margin-bottom: 1.5rem;\n}\n.membership-info[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n}\n.level-icon[_ngcontent-%COMP%] {\n  font-size: 2rem;\n}\n.level-details[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n}\n.level-name[_ngcontent-%COMP%] {\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n}\n.level-label[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.quota-item[_ngcontent-%COMP%] {\n  margin-bottom: 1rem;\n}\n.quota-header[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 0.5rem;\n}\n.quota-title[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.quota-value[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n}\n.quota-bar-large[_ngcontent-%COMP%] {\n  height: 8px;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 4px;\n  overflow: hidden;\n}\n.quota-bar-large[_ngcontent-%COMP%]   .quota-fill[_ngcontent-%COMP%] {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #06b6d4,\n      #22c55e);\n}\n.quota-summary[_ngcontent-%COMP%] {\n  margin-top: 1rem;\n  padding: 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.5rem;\n  text-align: center;\n}\n.summary-good[_ngcontent-%COMP%] {\n  color: #22c55e;\n}\n.summary-bad[_ngcontent-%COMP%] {\n  color: #ef4444;\n}\n.upgrade-prompt[_ngcontent-%COMP%] {\n  margin-top: 1rem;\n  text-align: center;\n  padding: 1rem;\n  background:\n    linear-gradient(\n      135deg,\n      rgba(245, 158, 11, 0.1),\n      rgba(239, 68, 68, 0.1));\n  border-radius: 0.5rem;\n}\n.upgrade-prompt[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n  margin: 0 0 0.75rem 0;\n  color: #fcd34d;\n}\n.btn-upgrade[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #f59e0b,\n      #ef4444);\n  color: white;\n  border: none;\n  padding: 0.5rem 1.5rem;\n  border-radius: 0.5rem;\n  cursor: pointer;\n}\n.form-actions[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.75rem;\n  margin-top: 1.5rem;\n}\n.form-actions.center[_ngcontent-%COMP%] {\n  justify-content: center;\n}\n.btn-primary[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled) {\n  transform: translateY(-1px);\n}\n.btn-primary[_ngcontent-%COMP%]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.btn-secondary[_ngcontent-%COMP%] {\n  padding: 0.75rem 1.5rem;\n  background: transparent;\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.3));\n  border-radius: 0.5rem;\n  color: var(--text-secondary, #cbd5e1);\n  cursor: pointer;\n}\n.device-options[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 0.5rem;\n}\n.device-btn[_ngcontent-%COMP%] {\n  padding: 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-secondary, #94a3b8);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.device-btn[_ngcontent-%COMP%]:hover, \n.device-btn.active[_ngcontent-%COMP%] {\n  border-color: var(--primary, #06b6d4);\n  color: var(--primary, #06b6d4);\n}\n.drop-zone[_ngcontent-%COMP%] {\n  border: 2px dashed var(--border-default, rgba(148, 163, 184, 0.3));\n  border-radius: 0.75rem;\n  padding: 3rem;\n  text-align: center;\n  cursor: pointer;\n  transition: all 0.2s;\n  margin-bottom: 1rem;\n}\n.drop-zone[_ngcontent-%COMP%]:hover, \n.drop-zone.dragging[_ngcontent-%COMP%] {\n  border-color: var(--primary, #06b6d4);\n  background: rgba(6, 182, 212, 0.05);\n}\n.drop-icon[_ngcontent-%COMP%] {\n  font-size: 2.5rem;\n  margin-bottom: 0.75rem;\n}\n.drop-text[_ngcontent-%COMP%] {\n  margin: 0;\n  color: var(--text-primary, white);\n}\n.drop-hint[_ngcontent-%COMP%] {\n  margin: 0.5rem 0 0 0;\n  font-size: 0.8rem;\n  color: var(--text-muted, #94a3b8);\n}\n.selected-file[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.5rem;\n}\n.file-path[_ngcontent-%COMP%] {\n  flex: 1;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n  word-break: break-all;\n}\n.clear-btn[_ngcontent-%COMP%] {\n  background: none;\n  border: none;\n  color: var(--text-muted, #94a3b8);\n  cursor: pointer;\n  font-size: 1.25rem;\n}\n.qr-section[_ngcontent-%COMP%] {\n  text-align: center;\n  margin: 1rem 0;\n}\n.qr-container[_ngcontent-%COMP%] {\n  padding: 1rem;\n  background: white;\n  border-radius: 0.75rem;\n  display: inline-block;\n  margin-bottom: 0.75rem;\n}\n.qr-image[_ngcontent-%COMP%] {\n  width: 180px;\n  height: 180px;\n  display: block;\n}\n.qr-countdown[_ngcontent-%COMP%] {\n  font-size: 1rem;\n  color: var(--primary, #06b6d4);\n  margin-bottom: 0.75rem;\n}\n.qr-countdown.warning[_ngcontent-%COMP%] {\n  color: #f59e0b;\n  animation: _ngcontent-%COMP%_pulse 1s infinite;\n}\n@keyframes _ngcontent-%COMP%_pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n.qr-instructions[_ngcontent-%COMP%] {\n  text-align: left;\n  display: inline-block;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  padding: 0.75rem 1.25rem;\n  border-radius: 0.5rem;\n}\n.qr-instructions[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n  margin: 0.25rem 0;\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.8rem;\n}\n.code-sent-info[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1rem;\n  background: rgba(34, 197, 94, 0.1);\n  border-radius: 0.5rem;\n  margin-bottom: 1rem;\n  color: #86efac;\n}\n.resend-section[_ngcontent-%COMP%] {\n  text-align: center;\n  margin: 1rem 0;\n}\n.resend-btn[_ngcontent-%COMP%] {\n  background: none;\n  border: none;\n  color: var(--primary, #06b6d4);\n  cursor: pointer;\n  font-size: 0.875rem;\n}\n.resend-btn[_ngcontent-%COMP%]:disabled {\n  color: var(--text-muted, #94a3b8);\n  cursor: not-allowed;\n}\n.tdata-info[_ngcontent-%COMP%] {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  padding: 1rem;\n  border-radius: 0.5rem;\n  margin-bottom: 1rem;\n}\n.tdata-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%] {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.875rem;\n  color: var(--text-primary, white);\n}\n.tdata-info[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] {\n  margin: 0;\n  padding-left: 1rem;\n  font-size: 0.8rem;\n  color: var(--text-muted, #94a3b8);\n}\n.import-mode-tabs[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 1rem;\n}\n.mode-tab[_ngcontent-%COMP%] {\n  flex: 1;\n  padding: 0.75rem 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 2px solid transparent;\n  border-radius: 0.5rem;\n  color: var(--text-muted, #94a3b8);\n  cursor: pointer;\n  transition: all 0.2s;\n  position: relative;\n}\n.mode-tab[_ngcontent-%COMP%]:hover {\n  background: var(--bg-secondary, rgba(30, 41, 59, 0.8));\n  color: var(--text-primary, white);\n}\n.mode-tab.active[_ngcontent-%COMP%] {\n  background: var(--bg-secondary, rgba(30, 41, 59, 0.8));\n  border-color: var(--primary, #06b6d4);\n  color: var(--text-primary, white);\n}\n.badge-recommend[_ngcontent-%COMP%] {\n  position: absolute;\n  top: -8px;\n  right: -8px;\n  background:\n    linear-gradient(\n      135deg,\n      #10b981,\n      #059669);\n  color: white;\n  font-size: 0.65rem;\n  padding: 2px 6px;\n  border-radius: 4px;\n}\n.tdata-path-hint[_ngcontent-%COMP%] {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border, rgba(100, 116, 139, 0.3));\n  border-radius: 0.5rem;\n  padding: 1rem;\n  margin-bottom: 1rem;\n}\n.tdata-path-hint[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%] {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.875rem;\n  color: var(--text-primary, white);\n}\n.path-box[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: var(--bg-primary, rgba(2, 6, 23, 0.8));\n  padding: 0.5rem 1rem;\n  border-radius: 0.375rem;\n}\n.path-box[_ngcontent-%COMP%]   code[_ngcontent-%COMP%] {\n  font-size: 0.8rem;\n  color: var(--primary, #06b6d4);\n  word-break: break-all;\n}\n.path-actions[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.25rem;\n}\n.icon-btn[_ngcontent-%COMP%] {\n  padding: 0.25rem 0.5rem;\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  opacity: 0.7;\n  transition: opacity 0.2s;\n}\n.icon-btn[_ngcontent-%COMP%]:hover {\n  opacity: 1;\n}\n.drop-zone.large[_ngcontent-%COMP%] {\n  padding: 2rem;\n  min-height: 180px;\n}\n.drop-buttons[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 1rem;\n}\n.select-btn[_ngcontent-%COMP%] {\n  padding: 0.5rem 1rem;\n  background: var(--primary, #06b6d4);\n  color: white;\n  border: none;\n  border-radius: 0.375rem;\n  cursor: pointer;\n  transition: background 0.2s;\n}\n.select-btn[_ngcontent-%COMP%]:hover {\n  background: var(--primary-dark, #0891b2);\n}\n.select-btn.secondary[_ngcontent-%COMP%] {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border, rgba(100, 116, 139, 0.3));\n}\n.select-btn.secondary[_ngcontent-%COMP%]:hover {\n  background: var(--bg-secondary, rgba(30, 41, 59, 0.8));\n}\n.scan-result[_ngcontent-%COMP%] {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.5rem;\n  padding: 1rem;\n  margin: 1rem 0;\n}\n.scan-result.success[_ngcontent-%COMP%] {\n  border: 1px solid rgba(16, 185, 129, 0.3);\n}\n.scan-result.error[_ngcontent-%COMP%] {\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  color: #f87171;\n}\n.scan-result[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%] {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.875rem;\n  color: var(--text-primary, white);\n}\n.accounts-list[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  max-height: 200px;\n  overflow-y: auto;\n}\n.account-item[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.5rem;\n  background: var(--bg-primary, rgba(2, 6, 23, 0.8));\n  border-radius: 0.375rem;\n  cursor: pointer;\n  transition: background 0.2s;\n}\n.account-item[_ngcontent-%COMP%]:hover {\n  background: var(--bg-secondary, rgba(30, 41, 59, 0.8));\n}\n.account-item.disabled[_ngcontent-%COMP%] {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.account-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%] {\n  width: 1rem;\n  height: 1rem;\n}\n.account-info[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.125rem;\n}\n.account-phone[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n  color: var(--text-primary, white);\n}\n.account-name[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.account-error[_ngcontent-%COMP%] {\n  font-size: 0.7rem;\n  color: #f87171;\n}\n.scanning-indicator[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 1rem;\n  color: var(--text-muted, #94a3b8);\n}\n.success-section[_ngcontent-%COMP%] {\n  text-align: center;\n  padding: 2rem;\n}\n.success-icon[_ngcontent-%COMP%] {\n  font-size: 4rem;\n  margin-bottom: 1rem;\n}\n.success-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%] {\n  margin: 0 0 1.5rem 0;\n  color: var(--text-primary, white);\n}\n.account-card[_ngcontent-%COMP%] {\n  display: inline-flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem 2rem;\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border-radius: 0.75rem;\n  margin-bottom: 1rem;\n}\n.account-avatar[_ngcontent-%COMP%] {\n  width: 56px;\n  height: 56px;\n  border-radius: 50%;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.5rem;\n  font-weight: bold;\n  color: white;\n}\n.account-name[_ngcontent-%COMP%] {\n  font-weight: 600;\n  color: var(--text-primary, white);\n}\n.account-phone[_ngcontent-%COMP%] {\n  color: var(--text-secondary, #cbd5e1);\n}\n.account-username[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n  color: var(--primary, #06b6d4);\n}\n.api-info[_ngcontent-%COMP%] {\n  margin: 1rem 0;\n}\n.api-badge[_ngcontent-%COMP%] {\n  display: inline-block;\n  padding: 0.5rem 1rem;\n  border-radius: 2rem;\n  font-size: 0.8rem;\n}\n.api-badge.expert[_ngcontent-%COMP%] {\n  background: rgba(34, 197, 94, 0.2);\n  color: #86efac;\n}\n.api-badge.platform[_ngcontent-%COMP%] {\n  background: rgba(6, 182, 212, 0.2);\n  color: #67e8f9;\n}\n.spinner[_ngcontent-%COMP%] {\n  width: 16px;\n  height: 16px;\n  border: 2px solid rgba(255, 255, 255, 0.3);\n  border-top-color: white;\n  border-radius: 50%;\n  animation: _ngcontent-%COMP%_spin 0.8s linear infinite;\n}\n@keyframes _ngcontent-%COMP%_spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n/*# sourceMappingURL=add-account-page.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AddAccountPageComponent, [{
    type: Component,
    args: [{ selector: "app-add-account-page", standalone: true, imports: [CommonModule, FormsModule, ApiSelectorComponent], template: `
    <div class="add-account-page">
      <!-- \u9802\u90E8\u5C0E\u822A -->
      <div class="page-header">
        <button (click)="goBack()" class="back-btn">
          \u2190 \u8FD4\u56DE\u5E33\u6236\u5217\u8868
        </button>
        <h1 class="page-title">\u2795 \u6DFB\u52A0\u65B0\u5E33\u6236</h1>
      </div>

      <!-- \u6B65\u9A5F\u6307\u793A\u5668 -->
      <div class="step-indicator">
        <div class="step" [class.active]="currentStep() >= 1" [class.completed]="currentStep() > 1">
          <span class="step-number">1</span>
          <span class="step-label">\u9078\u64C7 API</span>
        </div>
        <div class="step-line" [class.active]="currentStep() > 1"></div>
        <div class="step" [class.active]="currentStep() >= 2" [class.completed]="currentStep() > 2">
          <span class="step-number">2</span>
          <span class="step-label">\u767B\u5165\u5E33\u865F</span>
        </div>
        <div class="step-line" [class.active]="currentStep() > 2"></div>
        <div class="step" [class.active]="currentStep() >= 3">
          <span class="step-number">3</span>
          <span class="step-label">\u5B8C\u6210</span>
        </div>
      </div>

      <!-- Step 1: \u9078\u64C7 API -->
      @if (currentStep() === 1) {
        <div class="config-section">
          <div class="section-header">
            <h2>\u{1F510} \u9078\u64C7 API \u6191\u64DA</h2>
            <p>\u9078\u64C7\u6216\u6DFB\u52A0 API \u6191\u64DA\u4EE5\u9023\u63A5 Telegram</p>
          </div>

          <app-api-selector 
            [showSelected]="true"
            (apiSelected)="onApiSelected($event)"
            (selectionCleared)="onApiCleared()">
          </app-api-selector>

          <div class="form-actions">
            <button (click)="goBack()" class="btn-secondary">\u2190 \u8FD4\u56DE</button>
            <button 
              (click)="proceedToLogin()" 
              [disabled]="!selectedApiCredential()"
              class="btn-primary">
              \u4E0B\u4E00\u6B65\uFF1A\u9078\u64C7\u767B\u5165\u65B9\u5F0F \u2192
            </button>
          </div>
        </div>
      }

      <!-- Step 2: \u9078\u64C7\u767B\u5165\u65B9\u5F0F -->
      @if (currentStep() === 2 && currentLoginMethod() === 'select') {
        <div class="login-selection">
          <div class="section-header">
            <h2>\u9078\u64C7\u767B\u5165\u65B9\u5F0F</h2>
            <p>\u9078\u64C7\u6700\u9069\u5408\u60A8\u7684\u5E33\u865F\u767B\u5165\u65B9\u5F0F</p>
          </div>

          <div class="login-cards">
            <!-- \u9A57\u8B49\u78BC\u767B\u5165 -->
            <div class="login-card recommended" (click)="selectLoginMethod('code')">
              <div class="login-badge">\u2705 \u63A8\u85A6</div>
              <div class="login-icon">\u{1F4AC}</div>
              <h3>\u9A57\u8B49\u78BC\u767B\u5165</h3>
              <p>\u8F38\u5165\u624B\u6A5F\u865F\uFF0C\u63A5\u6536\u9A57\u8B49\u78BC\u5B8C\u6210\u767B\u5165</p>
              <ul>
                <li>\u{1F7E2} \u6A19\u6E96\u5B98\u65B9\u767B\u5165\u65B9\u5F0F</li>
                <li>\u{1F7E2} \u98A8\u96AA\u6700\u4F4E</li>
                <li>\u{1F7E1} \u9700\u8981\u80FD\u6536\u5230\u9A57\u8B49\u78BC</li>
              </ul>
              <div class="login-risk low">\u98A8\u96AA\uFF1A\u4F4E</div>
            </div>

            <!-- TData \u5C0E\u5165 -->
            <div class="login-card safe" (click)="selectLoginMethod('tdata')">
              <div class="login-badge">\u{1F6E1}\uFE0F \u6700\u5B89\u5168</div>
              <div class="login-icon">\u{1F4C2}</div>
              <h3>TData \u5C0E\u5165</h3>
              <p>\u5C0E\u5165\u5DF2\u6709\u7684 Session \u6587\u4EF6</p>
              <ul>
                <li>\u{1F7E2} \u7121\u9700\u91CD\u65B0\u767B\u5165</li>
                <li>\u{1F7E2} \u98A8\u96AA\u6700\u4F4E</li>
                <li>\u{1F7E2} \u652F\u6301\u6279\u91CF\u5C0E\u5165</li>
              </ul>
              <div class="login-risk lowest">\u98A8\u96AA\uFF1A\u6700\u4F4E</div>
            </div>

            <!-- \u6383\u78BC\u767B\u5165 -->
            <div class="login-card warning" (click)="selectLoginMethod('qr')">
              <div class="login-badge">\u26A0\uFE0F \u9700\u8B39\u614E</div>
              <div class="login-icon">\u{1F4F1}</div>
              <h3>\u6383\u78BC\u767B\u5165</h3>
              <p>\u4F7F\u7528 Telegram APP \u6383\u63CF\u4E8C\u7DAD\u78BC</p>
              <ul>
                <li>\u{1F7E2} \u7121\u9700\u9A57\u8B49\u78BC</li>
                <li>\u{1F7E1} \u9700\u8981\u624B\u6A5F\u5728\u65C1</li>
                <li>\u{1F534} \u7B2C\u4E09\u65B9\u7279\u5FB5\uFF0C\u98A8\u96AA\u8F03\u9AD8</li>
              </ul>
              <div class="login-risk high">\u98A8\u96AA\uFF1A\u8F03\u9AD8</div>
            </div>
          </div>

          <div class="form-actions">
            <button (click)="currentStep.set(1)" class="btn-secondary">\u2190 \u8FD4\u56DE</button>
          </div>
        </div>
      }

      <!-- Step 2: \u9A57\u8B49\u78BC\u767B\u5165\u6D41\u7A0B -->
      @if (currentStep() === 2 && currentLoginMethod() === 'code') {
        <div class="login-form">
          <div class="section-header">
            <h2>\u{1F4AC} \u9A57\u8B49\u78BC\u767B\u5165</h2>
          </div>

          <div class="form-card">
            @if (!codeStep()) {
              <!-- \u8F38\u5165\u624B\u6A5F\u865F -->
              <div class="form-group">
                <label>\u624B\u6A5F\u865F\u78BC <span class="required">*</span></label>
                <div class="input-with-prefix">
                  <input 
                    type="tel" 
                    [ngModel]="phoneNumber"
                    (ngModelChange)="onPhoneChange($event)"
                    placeholder="+639952947692"
                    class="form-input"
                    [class.error]="phoneError()"
                    [class.valid]="phoneValid()">
                  @if (phoneValid()) {
                    <span class="input-status valid">\u2713</span>
                  }
                </div>
                @if (phoneError()) {
                  <span class="error-text">{{ phoneError() }}</span>
                } @else {
                  <span class="hint">\u8ACB\u5305\u542B\u570B\u5BB6\u4EE3\u78BC\uFF0C\u4F8B\u5982 +63, +86, +1</span>
                }
              </div>

              <div class="form-group">
                <label>\u4EE3\u7406\u8A2D\u7F6E</label>
                <div class="proxy-options">
                  <label class="proxy-option">
                    <input type="radio" name="proxyMode" value="auto" [(ngModel)]="proxyMode">
                    <span class="option-content">
                      <span class="option-icon">\u{1F310}</span>
                      <span class="option-text">
                        <strong>\u81EA\u52D5\u5206\u914D\u975C\u614B\u4EE3\u7406</strong>
                        <small>\u5F9E\u4EE3\u7406\u6C60\u81EA\u52D5\u5206\u914D\uFF0C\u9632\u5C01\u63A8\u85A6</small>
                      </span>
                    </span>
                  </label>
                  <label class="proxy-option">
                    <input type="radio" name="proxyMode" value="manual" [(ngModel)]="proxyMode">
                    <span class="option-content">
                      <span class="option-icon">\u270F\uFE0F</span>
                      <span class="option-text">
                        <strong>\u624B\u52D5\u8F38\u5165\u4EE3\u7406</strong>
                        <small>\u4F7F\u7528\u81EA\u5DF1\u7684\u4EE3\u7406\u5730\u5740</small>
                      </span>
                    </span>
                  </label>
                  <label class="proxy-option">
                    <input type="radio" name="proxyMode" value="none" [(ngModel)]="proxyMode">
                    <span class="option-content">
                      <span class="option-icon">\u{1F6AB}</span>
                      <span class="option-text">
                        <strong>\u4E0D\u4F7F\u7528\u4EE3\u7406</strong>
                        <small>\u76F4\u63A5\u9023\u63A5\uFF0C\u6709\u5C01\u865F\u98A8\u96AA</small>
                      </span>
                    </span>
                  </label>
                </div>
                @if (proxyMode === 'manual') {
                  <input 
                    type="text" 
                    [(ngModel)]="proxyAddress"
                    placeholder="socks5://user:pass@host:port"
                    class="form-input mt-2">
                }
              </div>

              <div class="form-group">
                <label>\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC\uFF08\u5982\u6709\uFF09</label>
                <input 
                  type="password" 
                  [(ngModel)]="twoFactorPassword"
                  placeholder="\u5982\u679C\u5E33\u865F\u958B\u555F\u4E86\u4E8C\u6B65\u9A57\u8B49"
                  class="form-input">
              </div>

              <div class="form-actions">
                <button (click)="currentLoginMethod.set('select')" class="btn-secondary">\u2190 \u8FD4\u56DE</button>
                <button 
                  (click)="sendVerificationCode()" 
                  [disabled]="!phoneValid() || isSending()"
                  class="btn-primary">
                  @if (isSending()) {
                    <span class="spinner"></span> \u767C\u9001\u4E2D...
                  } @else {
                    \u767C\u9001\u9A57\u8B49\u78BC \u2192
                  }
                </button>
              </div>
            } @else {
              <!-- \u8F38\u5165\u9A57\u8B49\u78BC -->
              <div class="code-sent-info">
                <span class="info-icon">\u{1F4F1}</span>
                \u9A57\u8B49\u78BC\u5DF2\u767C\u9001\u81F3 {{ phoneNumber }}
              </div>

              <div class="form-group">
                <label>\u9A57\u8B49\u78BC <span class="required">*</span></label>
                <input 
                  type="text" 
                  [(ngModel)]="verificationCode"
                  placeholder="\u8F38\u5165\u6536\u5230\u7684\u9A57\u8B49\u78BC"
                  class="form-input code-input"
                  maxlength="6">
              </div>

              @if (needs2FA()) {
                <div class="form-group">
                  <label>\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC <span class="required">*</span></label>
                  <input 
                    type="password" 
                    [(ngModel)]="twoFactorPassword"
                    placeholder="\u8ACB\u8F38\u5165\u4E8C\u6B65\u9A57\u8B49\u5BC6\u78BC"
                    class="form-input">
                </div>
              }

              <div class="resend-section">
                <button (click)="resendCode()" [disabled]="resendCooldown() > 0" class="resend-btn">
                  @if (resendCooldown() > 0) {
                    {{ resendCooldown() }}\u79D2\u5F8C\u53EF\u91CD\u767C
                  } @else {
                    \u91CD\u65B0\u767C\u9001\u9A57\u8B49\u78BC
                  }
                </button>
              </div>

              <div class="form-actions">
                <button (click)="codeStep.set(false)" class="btn-secondary">\u2190 \u8FD4\u56DE</button>
                <button 
                  (click)="submitVerificationCode()" 
                  [disabled]="!verificationCode || isVerifying()"
                  class="btn-primary">
                  @if (isVerifying()) {
                    <span class="spinner"></span> \u9A57\u8B49\u4E2D...
                  } @else {
                    \u9A57\u8B49\u4E26\u767B\u5165 \u2192
                  }
                </button>
              </div>
            }
          </div>
        </div>
      }

      <!-- Step 2: TData \u5C0E\u5165\u6D41\u7A0B -->
      @if (currentStep() === 2 && currentLoginMethod() === 'tdata') {
        <div class="login-form">
          <div class="section-header">
            <h2>\u{1F4C2} TData / Session \u5C0E\u5165</h2>
          </div>

          <div class="form-card">
            <!-- \u5C0E\u5165\u6A21\u5F0F\u9078\u64C7 -->
            <div class="import-mode-tabs">
              <button 
                [class.active]="tdataImportMode() === 'tdata'"
                (click)="tdataImportMode.set('tdata')"
                class="mode-tab">
                \u{1F4C2} TData \u6587\u4EF6\u593E
                <span class="badge-recommend">\u63A8\u85A6</span>
              </button>
              <button 
                [class.active]="tdataImportMode() === 'session'"
                (click)="tdataImportMode.set('session')"
                class="mode-tab">
                \u{1F4C4} Session \u6587\u4EF6
              </button>
            </div>

            <!-- TData \u6587\u4EF6\u593E\u5C0E\u5165 -->
            @if (tdataImportMode() === 'tdata') {
              <!-- TData \u8DEF\u5F91\u63D0\u793A -->
              <div class="tdata-path-hint">
                <h4>\u{1F4CD} TData \u4F4D\u7F6E</h4>
                <div class="path-box">
                  <code>{{ getDefaultTdataPath() }}</code>
                  <div class="path-actions">
                    <button (click)="copyTdataPath()" class="icon-btn" title="\u8907\u88FD\u8DEF\u5F91">\u{1F4CB}</button>
                    <button (click)="openTdataFolder()" class="icon-btn" title="\u6253\u958B\u6587\u4EF6\u593E">\u{1F4C2}</button>
                  </div>
                </div>
              </div>

              <div 
                class="drop-zone large"
                [class.dragging]="isDragging()"
                (dragover)="onDragOver($event)"
                (dragleave)="onDragLeave($event)"
                (drop)="onDropTdata($event)">
                <div class="drop-icon">\u{1F4C1}</div>
                <p class="drop-text">\u62D6\u653E tdata \u6587\u4EF6\u593E\u5230\u9019\u88E1</p>
                <p class="drop-hint">\u652F\u6301\uFF1A\u6574\u500B\u6587\u4EF6\u593E / ZIP \u58D3\u7E2E\u5305</p>
                <div class="drop-buttons">
                  <button (click)="selectTdataFolder()" class="select-btn">\u9078\u64C7\u6587\u4EF6\u593E</button>
                  <button (click)="selectTdataZip()" class="select-btn secondary">\u9078\u64C7 ZIP</button>
                </div>
              </div>

              <!-- \u6383\u63CF\u7D50\u679C -->
              @if (tdataScanResult()) {
                @if (tdataScanResult()!.success) {
                  <div class="scan-result success">
                    <h4>\u{1F4CB} \u6AA2\u6E2C\u5230 {{ tdataScanResult()!.accounts?.length || 0 }} \u500B\u5E33\u865F</h4>
                    <div class="accounts-list">
                      @for (account of tdataScanResult()!.accounts || []; track account.index) {
                        <label class="account-item" [class.disabled]="!account.can_import">
                          <input 
                            type="checkbox" 
                            [checked]="selectedTdataAccounts().includes(account.index)"
                            [disabled]="!account.can_import"
                            (change)="toggleTdataAccount(account.index)">
                          <div class="account-info">
                            <span class="account-phone">{{ account.phone }}</span>
                            @if (account.first_name || account.username) {
                              <span class="account-name">{{ account.first_name || account.username }}</span>
                            }
                            @if (!account.can_import) {
                              <span class="account-error">{{ account.error || '\u7121\u6CD5\u5C0E\u5165' }}</span>
                            }
                          </div>
                        </label>
                      }
                    </div>
                  </div>
                } @else {
                  <div class="scan-result error">
                    <span class="error-icon">\u274C</span>
                    <span>{{ tdataScanResult()!.error || '\u6383\u63CF\u5931\u6557' }}</span>
                  </div>
                }
              }

              @if (isScanningTdata()) {
                <div class="scanning-indicator">
                  <span class="spinner"></span>
                  <span>\u6B63\u5728\u6383\u63CF TData...</span>
                </div>
              }
            }

            <!-- Session \u6587\u4EF6\u5C0E\u5165 -->
            @if (tdataImportMode() === 'session') {
              <div class="tdata-info">
                <h4>\u652F\u6301\u7684\u683C\u5F0F</h4>
                <ul>
                  <li><strong>.tgpkg</strong> - TG-Matrix \u5C0E\u51FA\u5305\uFF08\u63A8\u85A6\uFF09</li>
                  <li><strong>.session</strong> - Pyrogram Session \u6587\u4EF6</li>
                  <li><strong>.telethon.session</strong> - Telethon Session \u6587\u4EF6</li>
                </ul>
              </div>

              <div 
                class="drop-zone"
                [class.dragging]="isDragging()"
                (dragover)="onDragOver($event)"
                (dragleave)="onDragLeave($event)"
                (drop)="onDrop($event)"
                (click)="selectSessionFile()">
                <div class="drop-icon">\u{1F4C4}</div>
                <p class="drop-text">\u62D6\u653E Session \u6587\u4EF6\u5230\u9019\u88E1</p>
                <p class="drop-hint">\u6216\u9EDE\u64CA\u9078\u64C7\u6587\u4EF6</p>
              </div>

              @if (selectedFilePath()) {
                <div class="selected-file">
                  <span class="file-icon">\u{1F4C4}</span>
                  <span class="file-path">{{ selectedFilePath() }}</span>
                  <button (click)="clearSelectedFile()" class="clear-btn">\xD7</button>
                </div>
              }
            }

            <div class="form-actions">
              <button (click)="currentLoginMethod.set('select')" class="btn-secondary">\u2190 \u8FD4\u56DE</button>
              @if (tdataImportMode() === 'tdata') {
                <button 
                  (click)="importTdataAccounts()" 
                  [disabled]="selectedTdataAccounts().length === 0 || isImporting()"
                  class="btn-primary">
                  @if (isImporting()) {
                    <span class="spinner"></span> \u5C0E\u5165\u4E2D...
                  } @else {
                    \u5C0E\u5165 {{ selectedTdataAccounts().length }} \u500B\u5E33\u865F \u2192
                  }
                </button>
              } @else {
                <button 
                  (click)="importSession()" 
                  [disabled]="!selectedFilePath() || isImporting()"
                  class="btn-primary">
                  @if (isImporting()) {
                    <span class="spinner"></span> \u5C0E\u5165\u4E2D...
                  } @else {
                    \u5C0E\u5165 Session \u2192
                  }
                </button>
              }
            </div>
          </div>
        </div>
      }

      <!-- Step 2: \u6383\u78BC\u767B\u5165\u6D41\u7A0B -->
      @if (currentStep() === 2 && currentLoginMethod() === 'qr') {
        <div class="login-form">
          <div class="section-header">
            <h2>\u{1F4F1} \u6383\u78BC\u767B\u5165</h2>
          </div>

          <div class="form-card">
            <div class="form-group">
              <label>\u8A2D\u5099\u6A21\u64EC</label>
              <div class="device-options">
                <button 
                  (click)="deviceType.set('random')"
                  [class.active]="deviceType() === 'random'"
                  class="device-btn">\u{1F3B2} \u96A8\u6A5F</button>
                <button 
                  (click)="deviceType.set('ios')"
                  [class.active]="deviceType() === 'ios'"
                  class="device-btn">\u{1F4F1} iOS</button>
                <button 
                  (click)="deviceType.set('android')"
                  [class.active]="deviceType() === 'android'"
                  class="device-btn">\u{1F916} Android</button>
              </div>
            </div>

            <div class="form-group">
              <label>\u4EE3\u7406\u8A2D\u7F6E\uFF08\u53EF\u9078\uFF09</label>
              <input type="text" [(ngModel)]="proxyAddress" placeholder="socks5://host:port" class="form-input">
            </div>

            @if (!qrImageBase64()) {
              <div class="form-actions">
                <button (click)="currentLoginMethod.set('select')" class="btn-secondary">\u2190 \u8FD4\u56DE</button>
                <button (click)="generateQRCode()" class="btn-primary">\u751F\u6210\u4E8C\u7DAD\u78BC \u2192</button>
              </div>
            } @else {
              <div class="qr-section">
                <div class="qr-container">
                  <img [src]="'data:image/png;base64,' + qrImageBase64()" alt="QR Code" class="qr-image">
                </div>
                <div class="qr-countdown" [class.warning]="qrCountdown() <= 10">
                  \u23F1\uFE0F \u6709\u6548\u671F\uFF1A{{ qrCountdown() }} \u79D2
                </div>
                <div class="qr-instructions">
                  <p>1. \u6253\u958B\u624B\u6A5F Telegram APP</p>
                  <p>2. \u524D\u5F80 \u8A2D\u7F6E \u2192 \u8A2D\u5099 \u2192 \u6383\u63CF\u4E8C\u7DAD\u78BC</p>
                  <p>3. \u6383\u63CF\u4E0A\u65B9\u4E8C\u7DAD\u78BC\u4E26\u78BA\u8A8D\u6388\u6B0A</p>
                </div>
              </div>

              <div class="form-actions">
                <button (click)="currentLoginMethod.set('select')" class="btn-secondary">\u2190 \u8FD4\u56DE</button>
                <button (click)="refreshQRCode()" class="btn-primary">\u{1F504} \u5237\u65B0\u4E8C\u7DAD\u78BC</button>
              </div>
            }
          </div>
        </div>
      }

      <!-- Step 3: \u5B8C\u6210 -->
      @if (currentStep() === 3) {
        <div class="success-section">
          <div class="success-icon">\u2705</div>
          <h2>\u5E33\u6236\u6DFB\u52A0\u6210\u529F\uFF01</h2>
          
          @if (addedAccountInfo()) {
            <div class="account-card">
              <div class="account-avatar">
                {{ (addedAccountInfo()!.firstName || addedAccountInfo()!.phone || '?').charAt(0).toUpperCase() }}
              </div>
              <div class="account-details">
                <div class="account-name">
                  {{ addedAccountInfo()!.firstName || '' }} {{ addedAccountInfo()!.lastName || '' }}
                </div>
                <div class="account-phone">{{ addedAccountInfo()!.phone }}</div>
                @if (addedAccountInfo()!.username) {
                  <div class="account-username">{{ '@' + addedAccountInfo()!.username }}</div>
                }
              </div>
            </div>

            @if (selectedApiCredential()) {
              <div class="api-info">
                <span class="api-badge expert">\u{1F510} {{ selectedApiCredential()!.name || 'API ' + selectedApiCredential()!.api_id }}</span>
              </div>
            }
          }

          <div class="form-actions center">
            <button (click)="addAnother()" class="btn-secondary">\u2795 \u7E7C\u7E8C\u6DFB\u52A0</button>
            <button (click)="goBack()" class="btn-primary">\u8FD4\u56DE\u5E33\u6236\u5217\u8868 \u2192</button>
          </div>
        </div>
      }
    </div>
  `, styles: ["/* angular:styles/component:css;318728f95a326ef191c2266bbc24aa533fd366dd5698267ab6753a3197a46d15;D:/tgkz2026/src/add-account-page.component.ts */\n.add-account-page {\n  max-width: 900px;\n  margin: 0 auto;\n  padding: 2rem;\n}\n.page-header {\n  margin-bottom: 2rem;\n}\n.back-btn {\n  background: none;\n  border: none;\n  color: var(--primary, #06b6d4);\n  cursor: pointer;\n  font-size: 0.875rem;\n  margin-bottom: 0.5rem;\n  padding: 0;\n}\n.back-btn:hover {\n  text-decoration: underline;\n}\n.page-title {\n  margin: 0;\n  font-size: 2rem;\n  color: var(--text-primary, white);\n}\n.step-indicator {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 2rem;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.step {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.step-number {\n  width: 28px;\n  height: 28px;\n  border-radius: 50%;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--text-muted, #94a3b8);\n}\n.step.active .step-number {\n  background: var(--primary, #06b6d4);\n  color: white;\n}\n.step.completed .step-number {\n  background: #22c55e;\n  color: white;\n}\n.step-label {\n  font-size: 0.8rem;\n  color: var(--text-muted, #94a3b8);\n}\n.step.active .step-label {\n  color: var(--text-primary, white);\n}\n.step-line {\n  width: 40px;\n  height: 2px;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n}\n.step-line.active {\n  background: var(--primary, #06b6d4);\n}\n.mode-selection,\n.login-selection {\n  text-align: center;\n}\n.section-header h2,\n.selection-header h2 {\n  margin: 0 0 0.5rem 0;\n  color: var(--text-primary, white);\n  font-size: 1.5rem;\n}\n.section-header p,\n.selection-header p {\n  margin: 0 0 2rem 0;\n  color: var(--text-muted, #94a3b8);\n}\n.mode-cards,\n.login-cards {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1.5rem;\n  margin-bottom: 2rem;\n}\n@media (max-width: 700px) {\n  .mode-cards,\n  .login-cards {\n    grid-template-columns: 1fr;\n  }\n}\n.login-cards {\n  grid-template-columns: repeat(3, 1fr);\n}\n@media (max-width: 800px) {\n  .login-cards {\n    grid-template-columns: 1fr;\n  }\n}\n.mode-card,\n.login-card {\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 2px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 1rem;\n  padding: 1.5rem;\n  cursor: pointer;\n  transition: all 0.2s;\n  position: relative;\n  text-align: left;\n}\n.mode-card:hover,\n.login-card:hover {\n  transform: translateY(-4px);\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);\n}\n.mode-card.expert:hover {\n  border-color: #22c55e;\n}\n.mode-card.platform:hover {\n  border-color: #06b6d4;\n}\n.mode-card.disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.mode-card.disabled:hover {\n  transform: none;\n}\n.login-card.recommended:hover {\n  border-color: #22c55e;\n}\n.login-card.safe:hover {\n  border-color: #06b6d4;\n}\n.login-card.warning:hover {\n  border-color: #f59e0b;\n}\n.mode-badge,\n.login-badge {\n  position: absolute;\n  top: -10px;\n  right: 1rem;\n  padding: 0.25rem 0.75rem;\n  border-radius: 1rem;\n  font-size: 0.7rem;\n  font-weight: 600;\n}\n.mode-card.expert .mode-badge {\n  background: #22c55e;\n  color: white;\n}\n.mode-card.platform .mode-badge {\n  background: #06b6d4;\n  color: white;\n}\n.login-card.recommended .login-badge {\n  background: #22c55e;\n  color: white;\n}\n.login-card.safe .login-badge {\n  background: #06b6d4;\n  color: white;\n}\n.login-card.warning .login-badge {\n  background: #f59e0b;\n  color: black;\n}\n.mode-icon,\n.login-icon {\n  font-size: 2.5rem;\n  margin-bottom: 0.75rem;\n}\n.mode-title,\n.login-card h3 {\n  margin: 0 0 0.25rem 0;\n  color: var(--text-primary, white);\n  font-size: 1.25rem;\n}\n.mode-subtitle,\n.login-card p {\n  margin: 0 0 1rem 0;\n  font-size: 0.875rem;\n  color: var(--text-muted, #94a3b8);\n}\n.mode-features,\n.login-card ul {\n  list-style: none;\n  padding: 0;\n  margin: 0 0 1rem 0;\n  font-size: 0.8rem;\n}\n.mode-features li,\n.login-card li {\n  margin-bottom: 0.375rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.mode-suitable {\n  font-size: 0.75rem;\n  color: var(--text-muted, #64748b);\n  margin-bottom: 1rem;\n}\n.mode-risk,\n.login-risk {\n  padding: 0.375rem 0.75rem;\n  border-radius: 0.5rem;\n  font-size: 0.7rem;\n  font-weight: 500;\n  display: inline-block;\n  margin-bottom: 1rem;\n}\n.mode-risk.safe,\n.login-risk.lowest {\n  background: rgba(6, 182, 212, 0.2);\n  color: #67e8f9;\n}\n.mode-risk.medium,\n.login-risk.low {\n  background: rgba(34, 197, 94, 0.2);\n  color: #86efac;\n}\n.login-risk.high {\n  background: rgba(245, 158, 11, 0.2);\n  color: #fcd34d;\n}\n.quota-info {\n  margin-bottom: 1rem;\n}\n.quota-bar {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  padding: 0.75rem;\n  border-radius: 0.5rem;\n}\n.quota-label {\n  font-size: 0.7rem;\n  color: var(--text-muted, #94a3b8);\n  margin-bottom: 0.375rem;\n}\n.quota-progress {\n  height: 6px;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.8));\n  border-radius: 3px;\n  overflow: hidden;\n  margin-bottom: 0.375rem;\n}\n.quota-fill {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #06b6d4,\n      #22c55e);\n  border-radius: 3px;\n}\n.quota-text {\n  font-size: 0.75rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.quota-locked {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem;\n  background: rgba(245, 158, 11, 0.1);\n  border-radius: 0.5rem;\n  font-size: 0.75rem;\n  color: #fcd34d;\n}\n.mode-btn {\n  width: 100%;\n  padding: 0.75rem;\n  border: none;\n  border-radius: 0.5rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.mode-card.expert .mode-btn {\n  background: #22c55e;\n  color: white;\n}\n.mode-card.platform .mode-btn {\n  background: #06b6d4;\n  color: white;\n}\n.mode-btn.upgrade {\n  background:\n    linear-gradient(\n      135deg,\n      #f59e0b,\n      #ef4444);\n}\n.help-section {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1rem;\n  text-align: left;\n}\n@media (max-width: 600px) {\n  .help-section {\n    grid-template-columns: 1fr;\n  }\n}\n.help-card {\n  background: var(--bg-card, rgba(30, 41, 59, 0.5));\n  padding: 1rem;\n  border-radius: 0.75rem;\n}\n.help-card h4 {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.875rem;\n  color: var(--text-primary, white);\n}\n.help-card p {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.8rem;\n  color: var(--text-muted, #94a3b8);\n}\n.config-section {\n  max-width: 600px;\n  margin: 0 auto;\n}\n.form-card {\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border-radius: 1rem;\n  padding: 1.5rem;\n  margin-bottom: 1.5rem;\n}\n.form-group {\n  margin-bottom: 1.25rem;\n}\n.form-group label {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-size: 0.875rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.required {\n  color: #ef4444;\n}\n.proxy-options {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  margin-top: 0.5rem;\n}\n.proxy-option {\n  display: flex;\n  align-items: center;\n  padding: 0.75rem 1rem;\n  background: var(--bg-secondary, #1e293b);\n  border: 2px solid transparent;\n  border-radius: 0.5rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.proxy-option:hover {\n  background: var(--bg-tertiary, #334155);\n}\n.proxy-option:has(input:checked) {\n  border-color: var(--accent-color, #8b5cf6);\n  background: rgba(139, 92, 246, 0.1);\n}\n.proxy-option input[type=radio] {\n  display: none;\n}\n.proxy-option .option-content {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.proxy-option .option-icon {\n  font-size: 1.5rem;\n}\n.proxy-option .option-text {\n  display: flex;\n  flex-direction: column;\n}\n.proxy-option .option-text strong {\n  font-size: 0.9rem;\n  color: var(--text-primary, #f1f5f9);\n}\n.proxy-option .option-text small {\n  font-size: 0.75rem;\n  color: var(--text-secondary, #94a3b8);\n}\n.mt-2 {\n  margin-top: 0.5rem;\n}\n.form-input {\n  width: 100%;\n  padding: 0.75rem 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n  box-sizing: border-box;\n}\n.form-input:focus {\n  outline: none;\n  border-color: var(--primary, #06b6d4);\n}\n.form-input.error {\n  border-color: #ef4444;\n  background: rgba(239, 68, 68, 0.05);\n}\n.form-input.valid {\n  border-color: #22c55e;\n}\n.input-with-prefix {\n  position: relative;\n  display: flex;\n  align-items: center;\n}\n.input-with-prefix .form-input {\n  flex: 1;\n  padding-right: 2.5rem;\n}\n.input-status {\n  position: absolute;\n  right: 0.75rem;\n  font-size: 1rem;\n}\n.input-status.valid {\n  color: #22c55e;\n}\n.form-input.code-input {\n  text-align: center;\n  font-size: 1.5rem;\n  letter-spacing: 0.5rem;\n}\n.hint {\n  display: block;\n  margin-top: 0.375rem;\n  font-size: 0.75rem;\n  color: var(--text-muted, #64748b);\n}\n.error-text {\n  display: block;\n  margin-top: 0.375rem;\n  font-size: 0.75rem;\n  color: #ef4444;\n}\n.guide-box {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  padding: 1rem;\n  border-radius: 0.5rem;\n  margin-bottom: 1rem;\n}\n.guide-box h4 {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.875rem;\n  color: var(--text-primary, white);\n}\n.guide-box ol {\n  margin: 0;\n  padding-left: 1.25rem;\n  font-size: 0.8rem;\n  color: var(--text-muted, #94a3b8);\n}\n.guide-box li {\n  margin-bottom: 0.375rem;\n}\n.guide-box a {\n  color: var(--primary, #06b6d4);\n}\n.warning-box,\n.risk-warning {\n  display: flex;\n  gap: 0.75rem;\n  padding: 1rem;\n  background: rgba(245, 158, 11, 0.1);\n  border: 1px solid rgba(245, 158, 11, 0.3);\n  border-radius: 0.5rem;\n}\n.warning-icon {\n  font-size: 1.25rem;\n}\n.warning-content strong {\n  display: block;\n  color: #fcd34d;\n  margin-bottom: 0.375rem;\n  font-size: 0.875rem;\n}\n.warning-content ul,\n.warning-content p {\n  margin: 0;\n  padding-left: 1rem;\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.warning-content p {\n  padding-left: 0;\n}\n.quota-card {\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border-radius: 1rem;\n  padding: 1.5rem;\n  margin-bottom: 1.5rem;\n}\n.membership-info {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n}\n.level-icon {\n  font-size: 2rem;\n}\n.level-details {\n  display: flex;\n  flex-direction: column;\n}\n.level-name {\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n}\n.level-label {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.quota-item {\n  margin-bottom: 1rem;\n}\n.quota-header {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 0.5rem;\n}\n.quota-title {\n  font-size: 0.875rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.quota-value {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n}\n.quota-bar-large {\n  height: 8px;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 4px;\n  overflow: hidden;\n}\n.quota-bar-large .quota-fill {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #06b6d4,\n      #22c55e);\n}\n.quota-summary {\n  margin-top: 1rem;\n  padding: 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.5rem;\n  text-align: center;\n}\n.summary-good {\n  color: #22c55e;\n}\n.summary-bad {\n  color: #ef4444;\n}\n.upgrade-prompt {\n  margin-top: 1rem;\n  text-align: center;\n  padding: 1rem;\n  background:\n    linear-gradient(\n      135deg,\n      rgba(245, 158, 11, 0.1),\n      rgba(239, 68, 68, 0.1));\n  border-radius: 0.5rem;\n}\n.upgrade-prompt p {\n  margin: 0 0 0.75rem 0;\n  color: #fcd34d;\n}\n.btn-upgrade {\n  background:\n    linear-gradient(\n      135deg,\n      #f59e0b,\n      #ef4444);\n  color: white;\n  border: none;\n  padding: 0.5rem 1.5rem;\n  border-radius: 0.5rem;\n  cursor: pointer;\n}\n.form-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.75rem;\n  margin-top: 1.5rem;\n}\n.form-actions.center {\n  justify-content: center;\n}\n.btn-primary {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.btn-primary:hover:not(:disabled) {\n  transform: translateY(-1px);\n}\n.btn-primary:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.btn-secondary {\n  padding: 0.75rem 1.5rem;\n  background: transparent;\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.3));\n  border-radius: 0.5rem;\n  color: var(--text-secondary, #cbd5e1);\n  cursor: pointer;\n}\n.device-options {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 0.5rem;\n}\n.device-btn {\n  padding: 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-secondary, #94a3b8);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.device-btn:hover,\n.device-btn.active {\n  border-color: var(--primary, #06b6d4);\n  color: var(--primary, #06b6d4);\n}\n.drop-zone {\n  border: 2px dashed var(--border-default, rgba(148, 163, 184, 0.3));\n  border-radius: 0.75rem;\n  padding: 3rem;\n  text-align: center;\n  cursor: pointer;\n  transition: all 0.2s;\n  margin-bottom: 1rem;\n}\n.drop-zone:hover,\n.drop-zone.dragging {\n  border-color: var(--primary, #06b6d4);\n  background: rgba(6, 182, 212, 0.05);\n}\n.drop-icon {\n  font-size: 2.5rem;\n  margin-bottom: 0.75rem;\n}\n.drop-text {\n  margin: 0;\n  color: var(--text-primary, white);\n}\n.drop-hint {\n  margin: 0.5rem 0 0 0;\n  font-size: 0.8rem;\n  color: var(--text-muted, #94a3b8);\n}\n.selected-file {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.5rem;\n}\n.file-path {\n  flex: 1;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n  word-break: break-all;\n}\n.clear-btn {\n  background: none;\n  border: none;\n  color: var(--text-muted, #94a3b8);\n  cursor: pointer;\n  font-size: 1.25rem;\n}\n.qr-section {\n  text-align: center;\n  margin: 1rem 0;\n}\n.qr-container {\n  padding: 1rem;\n  background: white;\n  border-radius: 0.75rem;\n  display: inline-block;\n  margin-bottom: 0.75rem;\n}\n.qr-image {\n  width: 180px;\n  height: 180px;\n  display: block;\n}\n.qr-countdown {\n  font-size: 1rem;\n  color: var(--primary, #06b6d4);\n  margin-bottom: 0.75rem;\n}\n.qr-countdown.warning {\n  color: #f59e0b;\n  animation: pulse 1s infinite;\n}\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n.qr-instructions {\n  text-align: left;\n  display: inline-block;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  padding: 0.75rem 1.25rem;\n  border-radius: 0.5rem;\n}\n.qr-instructions p {\n  margin: 0.25rem 0;\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.8rem;\n}\n.code-sent-info {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.75rem 1rem;\n  background: rgba(34, 197, 94, 0.1);\n  border-radius: 0.5rem;\n  margin-bottom: 1rem;\n  color: #86efac;\n}\n.resend-section {\n  text-align: center;\n  margin: 1rem 0;\n}\n.resend-btn {\n  background: none;\n  border: none;\n  color: var(--primary, #06b6d4);\n  cursor: pointer;\n  font-size: 0.875rem;\n}\n.resend-btn:disabled {\n  color: var(--text-muted, #94a3b8);\n  cursor: not-allowed;\n}\n.tdata-info {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  padding: 1rem;\n  border-radius: 0.5rem;\n  margin-bottom: 1rem;\n}\n.tdata-info h4 {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.875rem;\n  color: var(--text-primary, white);\n}\n.tdata-info ul {\n  margin: 0;\n  padding-left: 1rem;\n  font-size: 0.8rem;\n  color: var(--text-muted, #94a3b8);\n}\n.import-mode-tabs {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 1rem;\n}\n.mode-tab {\n  flex: 1;\n  padding: 0.75rem 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 2px solid transparent;\n  border-radius: 0.5rem;\n  color: var(--text-muted, #94a3b8);\n  cursor: pointer;\n  transition: all 0.2s;\n  position: relative;\n}\n.mode-tab:hover {\n  background: var(--bg-secondary, rgba(30, 41, 59, 0.8));\n  color: var(--text-primary, white);\n}\n.mode-tab.active {\n  background: var(--bg-secondary, rgba(30, 41, 59, 0.8));\n  border-color: var(--primary, #06b6d4);\n  color: var(--text-primary, white);\n}\n.badge-recommend {\n  position: absolute;\n  top: -8px;\n  right: -8px;\n  background:\n    linear-gradient(\n      135deg,\n      #10b981,\n      #059669);\n  color: white;\n  font-size: 0.65rem;\n  padding: 2px 6px;\n  border-radius: 4px;\n}\n.tdata-path-hint {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border, rgba(100, 116, 139, 0.3));\n  border-radius: 0.5rem;\n  padding: 1rem;\n  margin-bottom: 1rem;\n}\n.tdata-path-hint h4 {\n  margin: 0 0 0.5rem 0;\n  font-size: 0.875rem;\n  color: var(--text-primary, white);\n}\n.path-box {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: var(--bg-primary, rgba(2, 6, 23, 0.8));\n  padding: 0.5rem 1rem;\n  border-radius: 0.375rem;\n}\n.path-box code {\n  font-size: 0.8rem;\n  color: var(--primary, #06b6d4);\n  word-break: break-all;\n}\n.path-actions {\n  display: flex;\n  gap: 0.25rem;\n}\n.icon-btn {\n  padding: 0.25rem 0.5rem;\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  opacity: 0.7;\n  transition: opacity 0.2s;\n}\n.icon-btn:hover {\n  opacity: 1;\n}\n.drop-zone.large {\n  padding: 2rem;\n  min-height: 180px;\n}\n.drop-buttons {\n  display: flex;\n  gap: 0.5rem;\n  margin-top: 1rem;\n}\n.select-btn {\n  padding: 0.5rem 1rem;\n  background: var(--primary, #06b6d4);\n  color: white;\n  border: none;\n  border-radius: 0.375rem;\n  cursor: pointer;\n  transition: background 0.2s;\n}\n.select-btn:hover {\n  background: var(--primary-dark, #0891b2);\n}\n.select-btn.secondary {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border, rgba(100, 116, 139, 0.3));\n}\n.select-btn.secondary:hover {\n  background: var(--bg-secondary, rgba(30, 41, 59, 0.8));\n}\n.scan-result {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.5rem;\n  padding: 1rem;\n  margin: 1rem 0;\n}\n.scan-result.success {\n  border: 1px solid rgba(16, 185, 129, 0.3);\n}\n.scan-result.error {\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  color: #f87171;\n}\n.scan-result h4 {\n  margin: 0 0 0.75rem 0;\n  font-size: 0.875rem;\n  color: var(--text-primary, white);\n}\n.accounts-list {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  max-height: 200px;\n  overflow-y: auto;\n}\n.account-item {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.5rem;\n  background: var(--bg-primary, rgba(2, 6, 23, 0.8));\n  border-radius: 0.375rem;\n  cursor: pointer;\n  transition: background 0.2s;\n}\n.account-item:hover {\n  background: var(--bg-secondary, rgba(30, 41, 59, 0.8));\n}\n.account-item.disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.account-item input[type=checkbox] {\n  width: 1rem;\n  height: 1rem;\n}\n.account-info {\n  display: flex;\n  flex-direction: column;\n  gap: 0.125rem;\n}\n.account-phone {\n  font-size: 0.875rem;\n  color: var(--text-primary, white);\n}\n.account-name {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.account-error {\n  font-size: 0.7rem;\n  color: #f87171;\n}\n.scanning-indicator {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  padding: 1rem;\n  color: var(--text-muted, #94a3b8);\n}\n.success-section {\n  text-align: center;\n  padding: 2rem;\n}\n.success-icon {\n  font-size: 4rem;\n  margin-bottom: 1rem;\n}\n.success-section h2 {\n  margin: 0 0 1.5rem 0;\n  color: var(--text-primary, white);\n}\n.account-card {\n  display: inline-flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem 2rem;\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border-radius: 0.75rem;\n  margin-bottom: 1rem;\n}\n.account-avatar {\n  width: 56px;\n  height: 56px;\n  border-radius: 50%;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.5rem;\n  font-weight: bold;\n  color: white;\n}\n.account-name {\n  font-weight: 600;\n  color: var(--text-primary, white);\n}\n.account-phone {\n  color: var(--text-secondary, #cbd5e1);\n}\n.account-username {\n  font-size: 0.875rem;\n  color: var(--primary, #06b6d4);\n}\n.api-info {\n  margin: 1rem 0;\n}\n.api-badge {\n  display: inline-block;\n  padding: 0.5rem 1rem;\n  border-radius: 2rem;\n  font-size: 0.8rem;\n}\n.api-badge.expert {\n  background: rgba(34, 197, 94, 0.2);\n  color: #86efac;\n}\n.api-badge.platform {\n  background: rgba(6, 182, 212, 0.2);\n  color: #67e8f9;\n}\n.spinner {\n  width: 16px;\n  height: 16px;\n  border: 2px solid rgba(255, 255, 255, 0.3);\n  border-top-color: white;\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n/*# sourceMappingURL=add-account-page.component.css.map */\n"] }]
  }], null, { back: [{
    type: Output
  }], accountAdded: [{
    type: Output
  }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(AddAccountPageComponent, { className: "AddAccountPageComponent", filePath: "src/add-account-page.component.ts", lineNumber: 1675 });
})();

// src/dialogs/batch-send-dialog.component.ts
var _forTrack09 = ($index, $item) => $item.key;
var _forTrack12 = ($index, $item) => $item.id;
var _forTrack2 = ($index, $item) => $item.name;
function BatchSendDialogComponent_Conditional_0_Conditional_26_For_8_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 53);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Conditional_26_For_8_Template_button_click_0_listener() {
      const cat_r5 = \u0275\u0275restoreView(_r4).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.filterTemplateCategory.set(cat_r5.key));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const cat_r5 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275classProp("bg-blue-500", ctx_r1.filterTemplateCategory() === cat_r5.key)("text-white", ctx_r1.filterTemplateCategory() === cat_r5.key)("bg-slate-700", ctx_r1.filterTemplateCategory() !== cat_r5.key)("text-slate-400", ctx_r1.filterTemplateCategory() !== cat_r5.key);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", cat_r5.icon, " ", cat_r5.label, " ");
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_26_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 50);
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(1, "svg", 54);
    \u0275\u0275element(2, "circle", 55)(3, "path", 56);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(4, "span", 57);
    \u0275\u0275text(5, "\u8F09\u5165\u6A21\u677F...");
    \u0275\u0275elementEnd()();
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_26_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 51)(1, "p");
    \u0275\u0275text(2, "\u6C92\u6709\u627E\u5230\u6A21\u677F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 58);
    \u0275\u0275text(4, "\u8ACB\u5148\u5230\u300C\u804A\u5929\u6A21\u677F\u300D\u9801\u9762\u5275\u5EFA\u6A21\u677F");
    \u0275\u0275elementEnd()();
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_26_Conditional_11_For_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 60);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Conditional_26_Conditional_11_For_2_Template_button_click_0_listener() {
      const template_r7 = \u0275\u0275restoreView(_r6).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r1.selectTemplate(template_r7));
    });
    \u0275\u0275elementStart(1, "div", 61)(2, "span", 62);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span", 23);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "p", 63);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    let tmp_13_0;
    let tmp_14_0;
    let tmp_15_0;
    let tmp_16_0;
    let tmp_17_0;
    const template_r7 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275classProp("border-blue-500", ((tmp_13_0 = ctx_r1.selectedTemplate()) == null ? null : tmp_13_0.id) === template_r7.id)("bg-blue-500/10", ((tmp_14_0 = ctx_r1.selectedTemplate()) == null ? null : tmp_14_0.id) === template_r7.id)("border-slate-600", ((tmp_15_0 = ctx_r1.selectedTemplate()) == null ? null : tmp_15_0.id) !== template_r7.id)("bg-slate-800/50", ((tmp_16_0 = ctx_r1.selectedTemplate()) == null ? null : tmp_16_0.id) !== template_r7.id)("hover:border-slate-500", ((tmp_17_0 = ctx_r1.selectedTemplate()) == null ? null : tmp_17_0.id) !== template_r7.id);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(template_r7.name);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u4F7F\u7528 ", template_r7.usageCount, " \u6B21");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(template_r7.content);
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_26_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 52);
    \u0275\u0275repeaterCreate(1, BatchSendDialogComponent_Conditional_0_Conditional_26_Conditional_11_For_2_Template, 8, 13, "button", 59, _forTrack12);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r1.filteredTemplates());
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_26_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 17)(1, "div", 45)(2, "label", 46);
    \u0275\u0275text(3, "\u9078\u64C7\u804A\u5929\u6A21\u677F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "button", 47);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Conditional_26_Template_button_click_4_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.loadTemplates());
    });
    \u0275\u0275text(5, " \u{1F504} \u5237\u65B0 ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div", 48);
    \u0275\u0275repeaterCreate(7, BatchSendDialogComponent_Conditional_0_Conditional_26_For_8_Template, 2, 10, "button", 49, _forTrack09);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(9, BatchSendDialogComponent_Conditional_0_Conditional_26_Conditional_9_Template, 6, 0, "div", 50)(10, BatchSendDialogComponent_Conditional_0_Conditional_26_Conditional_10_Template, 5, 0, "div", 51)(11, BatchSendDialogComponent_Conditional_0_Conditional_26_Conditional_11_Template, 3, 0, "div", 52);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(7);
    \u0275\u0275repeater(ctx_r1.templateCategories);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.isLoadingTemplates() ? 9 : ctx_r1.filteredTemplates().length === 0 ? 10 : 11);
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_4_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "span", 73);
    \u0275\u0275elementStart(1, "span");
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u5DF2\u9023\u63A5 ", ctx_r1.aiStatus().model);
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_4_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "span", 74);
    \u0275\u0275elementStart(1, "span");
    \u0275\u0275text(2, "\u4F7F\u7528\u672C\u5730\u6A21\u677F");
    \u0275\u0275elementEnd();
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 72);
    \u0275\u0275conditionalCreate(1, BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_4_Conditional_1_Template, 3, 1)(2, BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_4_Conditional_2_Template, 3, 0);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275classProp("bg-green-500/20", ctx_r1.aiStatus().connected)("text-green-400", ctx_r1.aiStatus().connected)("bg-amber-500/20", !ctx_r1.aiStatus().connected)("text-amber-400", !ctx_r1.aiStatus().connected);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.aiStatus().connected ? 1 : 2);
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_27_For_11_Template(rf, ctx) {
  if (rf & 1) {
    const _r9 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 75);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Conditional_27_For_11_Template_button_click_0_listener() {
      const style_r10 = \u0275\u0275restoreView(_r9).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.selectedAiStyle.set(style_r10.key));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const style_r10 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275classProp("bg-purple-500", ctx_r1.selectedAiStyle() === style_r10.key)("text-white", ctx_r1.selectedAiStyle() === style_r10.key)("bg-slate-700", ctx_r1.selectedAiStyle() !== style_r10.key)("text-slate-400", ctx_r1.selectedAiStyle() !== style_r10.key);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", style_r10.label, " ");
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_17_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(0, "svg", 76);
    \u0275\u0275element(1, "circle", 55)(2, "path", 56);
    \u0275\u0275elementEnd();
    \u0275\u0275text(3, " \u751F\u6210\u4E2D... ");
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_18_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u2728 \u751F\u6210 5 \u7A2E\u4E0D\u540C\u8868\u9054 ");
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_19_For_10_Template(rf, ctx) {
  if (rf & 1) {
    const _r12 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "label", 82)(1, "input", 83);
    \u0275\u0275listener("change", function BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_19_For_10_Template_input_change_1_listener() {
      const msg_r13 = \u0275\u0275restoreView(_r12).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r1.toggleMessageSelection(msg_r13));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "span", 84);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const msg_r13 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275classProp("border-purple-500", ctx_r1.isMessageSelected(msg_r13))("bg-purple-500/10", ctx_r1.isMessageSelected(msg_r13))("border-slate-600", !ctx_r1.isMessageSelected(msg_r13))("bg-slate-800/50", !ctx_r1.isMessageSelected(msg_r13));
    \u0275\u0275advance();
    \u0275\u0275property("checked", ctx_r1.isMessageSelected(msg_r13));
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(msg_r13);
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_19_Conditional_11_For_5_Template(rf, ctx) {
  if (rf & 1) {
    const _r14 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 89);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_19_Conditional_11_For_5_Template_button_click_0_listener() {
      const strategy_r15 = \u0275\u0275restoreView(_r14).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(5);
      return \u0275\u0275resetView(ctx_r1.setSendStrategy(strategy_r15.key));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const strategy_r15 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(5);
    \u0275\u0275classProp("bg-purple-500", ctx_r1.sendStrategy() === strategy_r15.key)("text-white", ctx_r1.sendStrategy() === strategy_r15.key)("bg-slate-700", ctx_r1.sendStrategy() !== strategy_r15.key)("text-slate-400", ctx_r1.sendStrategy() !== strategy_r15.key);
    \u0275\u0275property("title", strategy_r15.desc);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", strategy_r15.label, " ");
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_19_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 81)(1, "span", 85);
    \u0275\u0275text(2, "\u{1F4E4} \u767C\u9001\u7B56\u7565\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 86);
    \u0275\u0275repeaterCreate(4, BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_19_Conditional_11_For_5_Template, 2, 10, "button", 87, _forTrack09);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "p", 88);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(4);
    \u0275\u0275repeater(ctx_r1.sendStrategies);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", ctx_r1.getStrategyDescription(), " ");
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_19_Template(rf, ctx) {
  if (rf & 1) {
    const _r11 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 71)(1, "div", 5)(2, "span", 77);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 15)(5, "button", 78);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_19_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.selectAllMessages());
    });
    \u0275\u0275text(6, " \u5168\u9078 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "button", 79);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_19_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.clearSelectedMessages());
    });
    \u0275\u0275text(8, " \u6E05\u9664 ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275repeaterCreate(9, BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_19_For_10_Template, 4, 10, "label", 80, \u0275\u0275repeaterTrackByIndex);
    \u0275\u0275conditionalCreate(11, BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_19_Conditional_11_Template, 8, 1, "div", 81);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("\u53EF\u591A\u9078\u6A21\u677F\uFF08\u5DF2\u9078 ", ctx_r1.selectedMessages().size, " \u500B\uFF09\uFF1A");
    \u0275\u0275advance(6);
    \u0275\u0275repeater(ctx_r1.aiGeneratedMessages());
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.selectedMessages().size > 1 ? 11 : -1);
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_27_Template(rf, ctx) {
  if (rf & 1) {
    const _r8 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 18)(1, "div", 45)(2, "label", 64);
    \u0275\u0275text(3, "\u{1F916} AI \u667A\u80FD\u751F\u6210");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(4, BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_4_Template, 3, 9, "div", 65);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "div", 66)(6, "div")(7, "span", 67);
    \u0275\u0275text(8, "\u8A9E\u8A00\u98A8\u683C\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "div", 37);
    \u0275\u0275repeaterCreate(10, BatchSendDialogComponent_Conditional_0_Conditional_27_For_11_Template, 2, 9, "button", 68, _forTrack09);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(12, "div")(13, "span", 67);
    \u0275\u0275text(14, "\u6D88\u606F\u4E3B\u984C\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "input", 69);
    \u0275\u0275twoWayListener("ngModelChange", function BatchSendDialogComponent_Conditional_0_Conditional_27_Template_input_ngModelChange_15_listener($event) {
      \u0275\u0275restoreView(_r8);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.aiTopic, $event) || (ctx_r1.aiTopic = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(16, "button", 70);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Conditional_27_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r8);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.generateAiMessage());
    });
    \u0275\u0275conditionalCreate(17, BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_17_Template, 4, 0)(18, BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_18_Template, 1, 0);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(19, BatchSendDialogComponent_Conditional_0_Conditional_27_Conditional_19_Template, 12, 2, "div", 71);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(4);
    \u0275\u0275conditional(ctx_r1.aiStatus().source !== "unknown" ? 4 : -1);
    \u0275\u0275advance(6);
    \u0275\u0275repeater(ctx_r1.aiStyles);
    \u0275\u0275advance(5);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.aiTopic);
    \u0275\u0275advance();
    \u0275\u0275property("disabled", ctx_r1.isGeneratingAi() || !ctx_r1.aiTopic.trim());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isGeneratingAi() ? 17 : 18);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.aiGeneratedMessages().length > 0 ? 19 : -1);
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_31_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 20);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_2_0;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("\uFF08\u4F7F\u7528\u6A21\u677F\uFF1A", (tmp_2_0 = ctx_r1.selectedTemplate()) == null ? null : tmp_2_0.name, "\uFF09");
  }
}
function BatchSendDialogComponent_Conditional_0_For_38_Template(rf, ctx) {
  if (rf & 1) {
    const _r16 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 90);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_For_38_Template_button_click_0_listener() {
      const variable_r17 = \u0275\u0275restoreView(_r16).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.insertVariable(variable_r17.key));
    });
    \u0275\u0275elementStart(1, "span", 31);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 91);
    \u0275\u0275text(4, "|");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "span", 92);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const variable_r17 = ctx.$implicit;
    \u0275\u0275property("title", "\u63D2\u5165 " + variable_r17.key);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(variable_r17.key);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(variable_r17.label);
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_47_For_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r18 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 93)(1, "span", 94);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 95);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "button", 96);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Conditional_47_For_2_Template_button_click_5_listener() {
      const \u0275$index_241_r19 = \u0275\u0275restoreView(_r18).$index;
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.removeAttachment(\u0275$index_241_r19));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(6, "svg", 97);
    \u0275\u0275element(7, "path", 12);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const attachment_r20 = ctx.$implicit;
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(attachment_r20.type.startsWith("image") ? "\u{1F5BC}\uFE0F" : "\u{1F4C4}");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(attachment_r20.name);
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_47_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 27);
    \u0275\u0275repeaterCreate(1, BatchSendDialogComponent_Conditional_0_Conditional_47_For_2_Template, 8, 2, "div", 93, _forTrack2);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r1.attachments());
  }
}
function BatchSendDialogComponent_Conditional_0_For_75_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 38);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const target_r21 = ctx.$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", target_r21.displayName || target_r21.firstName || target_r21.username || target_r21.telegramId, " ");
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_76_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 39);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" +", ctx_r1.targets().length - 20, " \u66F4\u591A... ");
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_77_Conditional_15_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 103);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u{1F4E8} \u6B63\u5728\u767C\u9001\u7D66: ", ctx_r1.currentTarget(), " ");
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_77_Conditional_16_For_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 106);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const reason_r22 = ctx.$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", reason_r22.label, ": ", reason_r22.count, " ");
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_77_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 104)(1, "div", 105);
    \u0275\u0275text(2, "\u5931\u6557\u539F\u56E0\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 37);
    \u0275\u0275repeaterCreate(4, BatchSendDialogComponent_Conditional_0_Conditional_77_Conditional_16_For_5_Template, 2, 2, "span", 106, \u0275\u0275repeaterTrackByIndex);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(4);
    \u0275\u0275repeater(ctx_r1.failureReasonsList());
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_77_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 40)(1, "div", 98)(2, "span", 99);
    \u0275\u0275text(3, "\u767C\u9001\u9032\u5EA6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span", 9);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div", 100);
    \u0275\u0275element(7, "div", 101);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 102)(9, "span");
    \u0275\u0275text(10);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "span");
    \u0275\u0275text(12);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "span");
    \u0275\u0275text(14);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(15, BatchSendDialogComponent_Conditional_0_Conditional_77_Conditional_15_Template, 2, 1, "div", 103);
    \u0275\u0275conditionalCreate(16, BatchSendDialogComponent_Conditional_0_Conditional_77_Conditional_16_Template, 6, 0, "div", 104);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate2("", ctx_r1.sentCount(), " / ", ctx_r1.targets().length);
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("width", ctx_r1.progressPercent(), "%");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("\u2705 \u6210\u529F: ", ctx_r1.successCount());
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u274C \u5931\u6557: ", ctx_r1.failedCount());
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u23F3 \u9810\u8A08\u5269\u9918: ", ctx_r1.estimatedRemaining());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.currentTarget() ? 15 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.failedCount() > 0 && ctx_r1.failureReasonsList().length > 0 ? 16 : -1);
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_84_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 107);
    \u0275\u0275text(1, "\u23F3");
    \u0275\u0275elementEnd();
    \u0275\u0275text(2, " \u767C\u9001\u4E2D... ");
  }
}
function BatchSendDialogComponent_Conditional_0_Conditional_85_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275textInterpolate1(" \u{1F4E8} \u958B\u59CB\u767C\u9001 (", ctx_r1.targets().length, " \u4EBA) ");
  }
}
function BatchSendDialogComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 2);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Template_div_click_0_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.onBackdropClick($event));
    });
    \u0275\u0275elementStart(1, "div", 3)(2, "div", 4)(3, "div", 5)(4, "div", 6)(5, "div", 7);
    \u0275\u0275text(6, " \u{1F4E8} ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div")(8, "h2", 8);
    \u0275\u0275text(9, "\u6279\u91CF\u767C\u9001\u6D88\u606F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "p", 9);
    \u0275\u0275text(11);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(12, "button", 10);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Template_button_click_12_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.close());
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(13, "svg", 11);
    \u0275\u0275element(14, "path", 12);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(15, "div", 13)(16, "div")(17, "label", 14);
    \u0275\u0275text(18, " \u{1F4DD} \u6D88\u606F\u4F86\u6E90 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(19, "div", 15)(20, "button", 16);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Template_button_click_20_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.setMessageSource("template"));
    });
    \u0275\u0275text(21, " \u{1F4C4} \u804A\u5929\u6A21\u677F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(22, "button", 16);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Template_button_click_22_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.setMessageSource("custom"));
    });
    \u0275\u0275text(23, " \u270F\uFE0F \u81EA\u5B9A\u7FA9 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(24, "button", 16);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Template_button_click_24_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.setMessageSource("ai"));
    });
    \u0275\u0275text(25, " \u{1F916} AI \u751F\u6210 ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275conditionalCreate(26, BatchSendDialogComponent_Conditional_0_Conditional_26_Template, 12, 1, "div", 17);
    \u0275\u0275conditionalCreate(27, BatchSendDialogComponent_Conditional_0_Conditional_27_Template, 20, 5, "div", 18);
    \u0275\u0275elementStart(28, "div")(29, "label", 19);
    \u0275\u0275text(30, " \u{1F4DD} \u6D88\u606F\u5167\u5BB9 ");
    \u0275\u0275conditionalCreate(31, BatchSendDialogComponent_Conditional_0_Conditional_31_Template, 2, 1, "span", 20);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(32, "textarea", 21);
    \u0275\u0275twoWayListener("ngModelChange", function BatchSendDialogComponent_Conditional_0_Template_textarea_ngModelChange_32_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.messageContent, $event) || (ctx_r1.messageContent = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275text(33, "              ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(34, "div", 22)(35, "span", 23);
    \u0275\u0275text(36, "\u53EF\u7528\u8B8A\u91CF\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275repeaterCreate(37, BatchSendDialogComponent_Conditional_0_For_38_Template, 7, 3, "button", 24, _forTrack09);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(39, "div")(40, "label", 19);
    \u0275\u0275text(41, " \u{1F4CE} \u9644\u4EF6\uFF08\u53EF\u9078\uFF09 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(42, "div", 25)(43, "button", 26);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Template_button_click_43_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.selectImages());
    });
    \u0275\u0275text(44, " \u{1F5BC}\uFE0F \u6DFB\u52A0\u5716\u7247 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(45, "button", 26);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Template_button_click_45_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.selectFiles());
    });
    \u0275\u0275text(46, " \u{1F4C4} \u6DFB\u52A0\u6587\u4EF6 ");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(47, BatchSendDialogComponent_Conditional_0_Conditional_47_Template, 3, 0, "div", 27);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(48, "div", 17)(49, "label", 14);
    \u0275\u0275text(50, " \u2699\uFE0F \u767C\u9001\u8A2D\u7F6E ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(51, "div", 28)(52, "div", 6)(53, "span", 29);
    \u0275\u0275text(54, "\u767C\u9001\u9593\u9694\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(55, "input", 30);
    \u0275\u0275twoWayListener("ngModelChange", function BatchSendDialogComponent_Conditional_0_Template_input_ngModelChange_55_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.minInterval, $event) || (ctx_r1.minInterval = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(56, "span", 31);
    \u0275\u0275text(57, "-");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(58, "input", 32);
    \u0275\u0275twoWayListener("ngModelChange", function BatchSendDialogComponent_Conditional_0_Template_input_ngModelChange_58_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.maxInterval, $event) || (ctx_r1.maxInterval = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(59, "span", 9);
    \u0275\u0275text(60, "\u79D2\uFF08\u96A8\u6A5F\uFF09");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(61, "div", 6)(62, "span", 29);
    \u0275\u0275text(63, "\u5E33\u865F\u8F2A\u63DB\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(64, "label", 33)(65, "input", 34);
    \u0275\u0275twoWayListener("ngModelChange", function BatchSendDialogComponent_Conditional_0_Template_input_ngModelChange_65_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.accountRotation, $event) || (ctx_r1.accountRotation = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275element(66, "div", 35);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(67, "span", 9);
    \u0275\u0275text(68, "\u555F\u7528\u591A\u5E33\u865F\u8F2A\u63DB\u767C\u9001");
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(69, "div")(70, "label", 19);
    \u0275\u0275text(71);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(72, "div", 36)(73, "div", 37);
    \u0275\u0275repeaterCreate(74, BatchSendDialogComponent_Conditional_0_For_75_Template, 2, 1, "span", 38, \u0275\u0275repeaterTrackByIndex);
    \u0275\u0275conditionalCreate(76, BatchSendDialogComponent_Conditional_0_Conditional_76_Template, 2, 1, "span", 39);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275conditionalCreate(77, BatchSendDialogComponent_Conditional_0_Conditional_77_Template, 17, 9, "div", 40);
    \u0275\u0275elementStart(78, "div", 41)(79, "button", 42);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Template_button_click_79_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.close());
    });
    \u0275\u0275text(80);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(81, "button", 43);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Template_button_click_81_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.previewMessage());
    });
    \u0275\u0275text(82, " \u{1F441}\uFE0F \u9810\u89BD ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(83, "button", 44);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_0_Template_button_click_83_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.startSending());
    });
    \u0275\u0275conditionalCreate(84, BatchSendDialogComponent_Conditional_0_Conditional_84_Template, 3, 0)(85, BatchSendDialogComponent_Conditional_0_Conditional_85_Template, 1, 1);
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(11);
    \u0275\u0275textInterpolate1("\u5411 ", ctx_r1.targets().length, " \u500B\u7528\u6236\u767C\u9001\u6D88\u606F");
    \u0275\u0275advance(9);
    \u0275\u0275classProp("border-blue-500", ctx_r1.messageSource() === "template")("bg-blue-500/20", ctx_r1.messageSource() === "template")("text-blue-400", ctx_r1.messageSource() === "template")("border-slate-600", ctx_r1.messageSource() !== "template")("bg-slate-800/50", ctx_r1.messageSource() !== "template")("text-slate-400", ctx_r1.messageSource() !== "template");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("border-cyan-500", ctx_r1.messageSource() === "custom")("bg-cyan-500/20", ctx_r1.messageSource() === "custom")("text-cyan-400", ctx_r1.messageSource() === "custom")("border-slate-600", ctx_r1.messageSource() !== "custom")("bg-slate-800/50", ctx_r1.messageSource() !== "custom")("text-slate-400", ctx_r1.messageSource() !== "custom");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("border-purple-500", ctx_r1.messageSource() === "ai")("bg-purple-500/20", ctx_r1.messageSource() === "ai")("text-purple-400", ctx_r1.messageSource() === "ai")("border-slate-600", ctx_r1.messageSource() !== "ai")("bg-slate-800/50", ctx_r1.messageSource() !== "ai")("text-slate-400", ctx_r1.messageSource() !== "ai");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.messageSource() === "template" ? 26 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.messageSource() === "ai" ? 27 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275conditional(ctx_r1.messageSource() === "template" && ctx_r1.selectedTemplate() ? 31 : -1);
    \u0275\u0275advance();
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.messageContent);
    \u0275\u0275advance(5);
    \u0275\u0275repeater(ctx_r1.availableVariables);
    \u0275\u0275advance(10);
    \u0275\u0275conditional(ctx_r1.attachments().length > 0 ? 47 : -1);
    \u0275\u0275advance(8);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.minInterval);
    \u0275\u0275advance(3);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.maxInterval);
    \u0275\u0275advance(7);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.accountRotation);
    \u0275\u0275advance(6);
    \u0275\u0275textInterpolate1(" \u{1F465} \u767C\u9001\u76EE\u6A19\uFF08", ctx_r1.targets().length, " \u4EBA\uFF09 ");
    \u0275\u0275advance(3);
    \u0275\u0275repeater(ctx_r1.targets().slice(0, 20));
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.targets().length > 20 ? 76 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isSending() ? 77 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275property("disabled", ctx_r1.isSending());
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.isSending() ? "\u23F3 \u9032\u884C\u4E2D" : "\u53D6\u6D88", " ");
    \u0275\u0275advance();
    \u0275\u0275property("disabled", !ctx_r1.canSend() || ctx_r1.isSending());
    \u0275\u0275advance(2);
    \u0275\u0275property("disabled", !ctx_r1.canSend() || ctx_r1.isSending());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isSending() ? 84 : 85);
  }
}
function BatchSendDialogComponent_Conditional_1_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 111);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u{1F4CE} \u5305\u542B ", ctx_r1.attachments().length, " \u500B\u9644\u4EF6 ");
  }
}
function BatchSendDialogComponent_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    const _r23 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 1)(1, "div", 108)(2, "h3", 109);
    \u0275\u0275text(3, "\u{1F4F1} \u6D88\u606F\u9810\u89BD");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 110);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(6, BatchSendDialogComponent_Conditional_1_Conditional_6_Template, 2, 1, "div", 111);
    \u0275\u0275elementStart(7, "button", 112);
    \u0275\u0275listener("click", function BatchSendDialogComponent_Conditional_1_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r23);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.showPreview.set(false));
    });
    \u0275\u0275text(8, " \u95DC\u9589 ");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate1(" ", ctx_r1.previewText(), " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.attachments().length > 0 ? 6 : -1);
  }
}
var BatchSendDialogComponent = class _BatchSendDialogComponent {
  constructor() {
    this.ipc = inject(ElectronIpcService);
    this.toast = inject(ToastService);
    this.listeners = [];
    this.isOpen = input(false, ...ngDevMode ? [{ debugName: "isOpen" }] : []);
    this.targets = input([], ...ngDevMode ? [{ debugName: "targets" }] : []);
    this.closeDialog = output();
    this.sendComplete = output();
    this.messageSource = signal("custom", ...ngDevMode ? [{ debugName: "messageSource" }] : []);
    this.chatTemplates = signal([], ...ngDevMode ? [{ debugName: "chatTemplates" }] : []);
    this.isLoadingTemplates = signal(false, ...ngDevMode ? [{ debugName: "isLoadingTemplates" }] : []);
    this.selectedTemplate = signal(null, ...ngDevMode ? [{ debugName: "selectedTemplate" }] : []);
    this.filterTemplateCategory = signal("all", ...ngDevMode ? [{ debugName: "filterTemplateCategory" }] : []);
    this.templateCategories = [
      { key: "all", icon: "\u{1F4CB}", label: "\u5168\u90E8" },
      { key: "greeting", icon: "\u{1F44B}", label: "\u554F\u5019\u8A9E" },
      { key: "follow_up", icon: "\u{1F4E9}", label: "\u8DDF\u9032\u6D88\u606F" },
      { key: "promotion", icon: "\u{1F4E2}", label: "\u63A8\u5EE3\u6D88\u606F" },
      { key: "custom", icon: "\u270F\uFE0F", label: "\u81EA\u5B9A\u7FA9" }
    ];
    this.filteredTemplates = computed(() => {
      const category = this.filterTemplateCategory();
      const templates = this.chatTemplates();
      if (category === "all")
        return templates.filter((t) => t.isEnabled);
      return templates.filter((t) => t.isEnabled && t.category === category);
    }, ...ngDevMode ? [{ debugName: "filteredTemplates" }] : []);
    this.selectedAiStyle = signal("friendly", ...ngDevMode ? [{ debugName: "selectedAiStyle" }] : []);
    this.aiTopic = "";
    this.isGeneratingAi = signal(false, ...ngDevMode ? [{ debugName: "isGeneratingAi" }] : []);
    this.aiGeneratedMessages = signal([], ...ngDevMode ? [{ debugName: "aiGeneratedMessages" }] : []);
    this.aiStatus = signal({
      connected: false,
      model: null,
      source: "unknown"
    }, ...ngDevMode ? [{ debugName: "aiStatus" }] : []);
    this.selectedMessages = signal(/* @__PURE__ */ new Set(), ...ngDevMode ? [{ debugName: "selectedMessages" }] : []);
    this.sendStrategy = signal("random", ...ngDevMode ? [{ debugName: "sendStrategy" }] : []);
    this.sendStrategies = [
      { key: "random", label: "\u{1F3B2} \u96A8\u6A5F\u767C\u9001", desc: "\u6BCF\u500B\u7528\u6236\u96A8\u6A5F\u9078\u64C7\u4E00\u500B\u6A21\u677F" },
      { key: "rotate", label: "\u{1F504} \u8F2A\u8F49\u767C\u9001", desc: "\u4F9D\u6B21\u4F7F\u7528\u6A21\u677F\uFF081\u21922\u21923\u21921...\uFF09" },
      { key: "sequential", label: "\u{1F4CB} \u9806\u5E8F\u767C\u9001", desc: "\u6309\u9806\u5E8F\u7528\u5B8C\u518D\u91CD\u8907" }
    ];
    this.aiStyles = [
      { key: "friendly", label: "\u53CB\u597D\u89AA\u5207" },
      { key: "formal", label: "\u6B63\u5F0F\u5546\u52D9" },
      { key: "humorous", label: "\u8F15\u9B06\u5E7D\u9ED8" },
      { key: "concise", label: "\u7C21\u6F54\u660E\u4E86" },
      { key: "enthusiastic", label: "\u71B1\u60C5\u6D0B\u6EA2" }
    ];
    this.messageContent = "";
    this.attachments = signal([], ...ngDevMode ? [{ debugName: "attachments" }] : []);
    this.minInterval = 30;
    this.maxInterval = 60;
    this.accountRotation = true;
    this.availableVariables = [
      { key: "{firstName}", label: "\u540D\u5B57" },
      { key: "{lastName}", label: "\u59D3\u6C0F" },
      { key: "{username}", label: "\u7528\u6236\u540D" },
      { key: "{name}", label: "\u986F\u793A\u540D" },
      { key: "{fullName}", label: "\u5168\u540D" },
      { key: "{groupName}", label: "\u4F86\u6E90\u7FA4\u7D44" },
      { key: "{keyword}", label: "\u89F8\u767C\u95DC\u9375\u8A5E" },
      { key: "{source}", label: "\u4F86\u6E90\u6E20\u9053" },
      { key: "{greeting}", label: "\u554F\u5019\u8A9E" },
      { key: "{date}", label: "\u65E5\u671F" },
      { key: "{time}", label: "\u6642\u9593" },
      { key: "{day}", label: "\u661F\u671F" }
    ];
    this.isSending = signal(false, ...ngDevMode ? [{ debugName: "isSending" }] : []);
    this.sentCount = signal(0, ...ngDevMode ? [{ debugName: "sentCount" }] : []);
    this.successCount = signal(0, ...ngDevMode ? [{ debugName: "successCount" }] : []);
    this.failedCount = signal(0, ...ngDevMode ? [{ debugName: "failedCount" }] : []);
    this.currentTarget = signal("", ...ngDevMode ? [{ debugName: "currentTarget" }] : []);
    this.failureReasons = signal({}, ...ngDevMode ? [{ debugName: "failureReasons" }] : []);
    this.failureReasonLabels = {
      "privacy_restricted": "\u{1F512} \u96B1\u79C1\u9650\u5236",
      "flood_wait": "\u23F1\uFE0F API \u9650\u5236",
      "user_not_found": "\u2753 \u7528\u6236\u4E0D\u5B58\u5728",
      "user_blocked": "\u{1F6AB} \u88AB\u5C01\u9396",
      "invalid_id": "\u26A0\uFE0F \u7121\u6548 ID",
      "no_account": "\u{1F4F1} \u7121\u53EF\u7528\u5E33\u865F",
      "cancelled": "\u23F9\uFE0F \u5DF2\u53D6\u6D88",
      "other": "\u274C \u5176\u4ED6\u932F\u8AA4"
    };
    this.showPreview = signal(false, ...ngDevMode ? [{ debugName: "showPreview" }] : []);
    this.progressPercent = computed(() => {
      const total = this.targets().length;
      return total > 0 ? this.sentCount() / total * 100 : 0;
    }, ...ngDevMode ? [{ debugName: "progressPercent" }] : []);
    this.failureReasonsList = computed(() => {
      const reasons = this.failureReasons();
      return Object.keys(reasons).map((key) => ({
        key,
        label: this.failureReasonLabels[key] || key,
        count: reasons[key]
      }));
    }, ...ngDevMode ? [{ debugName: "failureReasonsList" }] : []);
    this.estimatedRemaining = computed(() => {
      const remaining = this.targets().length - this.sentCount();
      const avgInterval = (this.minInterval + this.maxInterval) / 2;
      const seconds = remaining * avgInterval;
      if (seconds < 60)
        return `${Math.round(seconds)} \u79D2`;
      if (seconds < 3600)
        return `${Math.round(seconds / 60)} \u5206\u9418`;
      return `${Math.round(seconds / 3600)} \u5C0F\u6642`;
    }, ...ngDevMode ? [{ debugName: "estimatedRemaining" }] : []);
    this.previewText = computed(() => {
      const sample = this.targets()[0] || {};
      return this.replaceVariables(this.messageContent, sample);
    }, ...ngDevMode ? [{ debugName: "previewText" }] : []);
    this.aiGenerateTimeout = null;
  }
  ngOnInit() {
    this.setupIpcListeners();
    this.loadTemplates();
  }
  ngOnDestroy() {
    this.listeners.forEach((cleanup) => cleanup());
  }
  setupIpcListeners() {
    const cleanup1 = this.ipc.on("batch-send:progress", (data) => {
      this.sentCount.set(data.sent);
      this.successCount.set(data.success);
      this.failedCount.set(data.failed);
      if (data.currentTarget) {
        this.currentTarget.set(data.currentTarget);
      }
      if (data.failureReasons) {
        this.failureReasons.set(data.failureReasons);
      }
    });
    this.listeners.push(cleanup1);
    const cleanup2 = this.ipc.on("batch-send:complete", (data) => {
      this.isSending.set(false);
      this.sendComplete.emit({ success: data.success, failed: data.failed });
      if (data.error) {
        this.toast.error(`\u274C \u767C\u9001\u5931\u6557\uFF1A${data.error}`);
      } else if (data.failed > 0) {
        const summary = data.failureSummary || `\u5931\u6557 ${data.failed} \u500B`;
        this.toast.warning(`\u26A0\uFE0F \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${data.success}\uFF0C${summary}`);
      } else {
        this.toast.success(`\u2705 \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${data.success} \u500B`);
      }
      if (data.failureReasons) {
        this.failureReasons.set(data.failureReasons);
      }
    });
    this.listeners.push(cleanup2);
    const cleanup3 = this.ipc.on("get-chat-templates-result", (data) => {
      this.isLoadingTemplates.set(false);
      if (data.templates) {
        this.chatTemplates.set(data.templates);
      }
    });
    this.listeners.push(cleanup3);
    const cleanup4 = this.ipc.on("ai-generate-message-result", (data) => {
      console.log("[AI] \u6536\u5230\u751F\u6210\u7D50\u679C:", data);
      if (this.aiGenerateTimeout) {
        clearTimeout(this.aiGenerateTimeout);
        this.aiGenerateTimeout = null;
      }
      this.isGeneratingAi.set(false);
      if (data.success && data.messages) {
        this.aiGeneratedMessages.set(data.messages);
        if (data.source === "ai" && data.model) {
          this.aiStatus.set({ connected: true, model: data.model, source: "ai" });
          this.toast.success(`\u{1F916} ${data.model} \u751F\u6210\u4E86 ${data.messages.length} \u689D\u6D88\u606F\uFF01`);
        } else {
          this.aiStatus.set({ connected: false, model: null, source: "local" });
          this.toast.info("\u{1F4CB} \u5DF2\u4F7F\u7528\u672C\u5730\u6A21\u677F\u751F\u6210\u6D88\u606F");
        }
      } else {
        this.toast.error(data.error || "AI \u751F\u6210\u5931\u6557");
      }
    });
    this.listeners.push(cleanup4);
  }
  // 設置消息來源
  setMessageSource(source) {
    this.messageSource.set(source);
    if (source === "template") {
      this.loadTemplates();
    }
  }
  // 載入聊天模板
  loadTemplates() {
    this.isLoadingTemplates.set(true);
    this.ipc.send("get-chat-templates", {});
  }
  // 選擇模板
  selectTemplate(template) {
    this.selectedTemplate.set(template);
    this.messageContent = template.content;
    this.toast.info(`\u5DF2\u9078\u64C7\u6A21\u677F\uFF1A${template.name}`);
  }
  // 生成 AI 消息
  generateAiMessage() {
    if (!this.aiTopic.trim()) {
      this.toast.warning("\u8ACB\u8F38\u5165\u6D88\u606F\u4E3B\u984C");
      return;
    }
    this.isGeneratingAi.set(true);
    this.aiGeneratedMessages.set([]);
    if (this.aiGenerateTimeout) {
      clearTimeout(this.aiGenerateTimeout);
    }
    this.aiGenerateTimeout = setTimeout(() => {
      if (this.isGeneratingAi()) {
        this.isGeneratingAi.set(false);
        this.toast.warning("AI \u751F\u6210\u8D85\u6642\uFF0C\u5DF2\u4F7F\u7528\u672C\u5730\u6A21\u677F");
        this.useLocalAiTemplates();
      }
    }, 1e4);
    console.log("[AI] \u767C\u9001\u751F\u6210\u8ACB\u6C42:", {
      topic: this.aiTopic,
      style: this.selectedAiStyle()
    });
    this.ipc.send("ai-generate-message", {
      topic: this.aiTopic,
      style: this.selectedAiStyle(),
      count: 5,
      context: {
        targetCount: this.targets().length,
        sampleTarget: this.targets()[0]
      }
    });
  }
  // 本地 AI 模板回退方案
  useLocalAiTemplates() {
    const topic = this.aiTopic || "\u6253\u62DB\u547C";
    const style2 = this.selectedAiStyle();
    const templates = {
      "friendly": [
        `{greeting}\uFF01\u6211\u662F\u5728\u7FA4\u88E1\u770B\u5230\u4F60\u7684\uFF0C\u60F3\u8A8D\u8B58\u4E00\u4E0B~`,
        `Hi {name}\uFF01\u5F88\u9AD8\u8208\u80FD\u8A8D\u8B58\u4F60\uFF0C\u5E0C\u671B\u4EE5\u5F8C\u591A\u591A\u4EA4\u6D41 \u{1F60A}`,
        `{greeting}{name}\uFF0C\u6211\u89BA\u5F97\u6211\u5011\u53EF\u80FD\u6709\u5171\u540C\u8A71\u984C\uFF0C\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F`,
        `\u55E8\uFF01\u770B\u5230\u4F60\u7684\u8CC7\u6599\u89BA\u5F97\u5F88\u6709\u8DA3\uFF0C\u60F3\u8DDF\u4F60\u4EA4\u500B\u670B\u53CB~`,
        `{greeting}\uFF01\u6211\u662F${topic}\u76F8\u95DC\u7684\uFF0C\u770B\u5230\u4F60\u4E5F\u5C0D\u9019\u500B\u611F\u8208\u8DA3\uFF1F`
      ],
      "formal": [
        `{greeting}\uFF0C\u5F88\u9AD8\u8208\u8A8D\u8B58\u60A8\u3002\u6211\u6CE8\u610F\u5230\u6211\u5011\u53EF\u80FD\u6709\u5171\u540C\u7684\u8208\u8DA3\u9EDE\uFF0C\u4E0D\u77E5\u662F\u5426\u65B9\u4FBF\u4EA4\u6D41\uFF1F`,
        `\u60A8\u597D {name}\uFF0C\u5192\u6627\u6253\u64FE\u3002\u6211\u5C08\u6CE8\u65BC${topic}\u9818\u57DF\uFF0C\u5E0C\u671B\u80FD\u8207\u60A8\u5EFA\u7ACB\u806F\u7E6B\u3002`,
        `{greeting}\uFF0C\u6211\u662F\u901A\u904E\u7FA4\u7D44\u8A8D\u8B58\u5230\u60A8\u7684\u3002\u5982\u6709\u5408\u4F5C\u6A5F\u6703\uFF0C\u671F\u5F85\u9032\u4E00\u6B65\u6E9D\u901A\u3002`,
        `\u5C0A\u656C\u7684 {name}\uFF0C\u5F88\u69AE\u5E78\u80FD\u5920\u8207\u60A8\u53D6\u5F97\u806F\u7E6B\u3002\u671F\u5F85\u672A\u4F86\u6709\u6A5F\u6703\u5408\u4F5C\u3002`,
        `{greeting}\uFF0C\u6211\u5C0D${topic}\u5F88\u611F\u8208\u8DA3\uFF0C\u770B\u5230\u60A8\u4E5F\u5728\u9019\u500B\u9818\u57DF\uFF0C\u60F3\u5411\u60A8\u8ACB\u6559\u3002`
      ],
      "humorous": [
        `{greeting}\uFF01\u6211\u4E0D\u662F\u63A8\u92B7\u54E1\uFF0C\u53EA\u662F\u89BA\u5F97\u4F60\u770B\u8D77\u4F86\u5F88\u9177\u60F3\u8A8D\u8B58\u4E00\u4E0B \u{1F60E}`,
        `Hi {name}\uFF01\u5225\u64D4\u5FC3\uFF0C\u6211\u53EA\u662F\u60F3\u804A\u804A${topic}\u800C\u5DF2\uFF0C\u4E0D\u6703\u63A8\u92B7\u4EFB\u4F55\u6771\u897F \u{1F923}`,
        `{greeting}\uFF01\u80FD\u9047\u5230\u5C0D${topic}\u611F\u8208\u8DA3\u7684\u4EBA\u771F\u662F\u592A\u96E3\u5F97\u4E86\uFF01`,
        `\u55E8\uFF01\u770B\u5230\u4F60\u5728\u7FA4\u88E1\u7684\u767C\u8A00\u89BA\u5F97\u5F88\u6709\u8DA3\uFF0C\u5FCD\u4E0D\u4F4F\u4F86\u6253\u500B\u62DB\u547C~`,
        `{greeting}\uFF01\u96E3\u5F97\u9047\u5230\u540C\u597D\uFF0C\u5FC5\u9808\u8A8D\u8B58\u4E00\u4E0B\uFF01`
      ],
      "concise": [
        `{greeting}\uFF0C\u60F3\u8A8D\u8B58\u4E00\u4E0B\u3002`,
        `Hi {name}\uFF0C\u95DC\u65BC${topic}\u60F3\u548C\u4F60\u804A\u804A\u3002`,
        `\u60A8\u597D\uFF0C\u770B\u5230\u4F60\u5C0D${topic}\u611F\u8208\u8DA3\uFF0C\u65B9\u4FBF\u4EA4\u6D41\u55CE\uFF1F`,
        `{greeting}\uFF0C\u6211\u4E5F\u95DC\u6CE8${topic}\uFF0C\u4EA4\u500B\u670B\u53CB\uFF1F`,
        `Hi\uFF0C\u60F3\u8ACB\u6559\u4E00\u4E0B${topic}\u76F8\u95DC\u7684\u554F\u984C\u3002`
      ],
      "enthusiastic": [
        `{greeting}\uFF01\uFF01\u592A\u958B\u5FC3\u80FD\u8A8D\u8B58\u4F60\u4E86\uFF01\u{1F389}`,
        `\u54C7\uFF01{name}\uFF01\u7D42\u65BC\u627E\u5230\u540C\u6A23\u559C\u6B61${topic}\u7684\u4EBA\u4E86\uFF01\u2728`,
        `{greeting}\uFF01\u770B\u5230\u4F60\u7684\u8CC7\u6599\u8D85\u8208\u596E\u7684\uFF01\u6211\u5011\u4E00\u5B9A\u6709\u5F88\u591A\u5171\u540C\u8A71\u984C\uFF01`,
        `Hi {name}\uFF01\u2764\uFE0F \u8D85\u7D1A\u671F\u5F85\u548C\u4F60\u804A${topic}\uFF01`,
        `{greeting}\uFF01\u9047\u5230\u4F60\u7C21\u76F4\u592A\u68D2\u4E86\uFF01\u{1F31F}`
      ]
    };
    const messages = templates[style2] || templates["friendly"];
    this.aiGeneratedMessages.set(messages);
    this.toast.info("\u5DF2\u751F\u6210\u672C\u5730\u6A21\u677F\u4F9B\u9078\u64C7");
  }
  // 選擇 AI 生成的消息（單選模式 - 兼容）
  selectAiMessage(message) {
    this.messageContent = message;
  }
  // 多選相關方法
  isMessageSelected(msg) {
    return this.selectedMessages().has(msg);
  }
  toggleMessageSelection(msg) {
    const current = new Set(this.selectedMessages());
    if (current.has(msg)) {
      current.delete(msg);
    } else {
      current.add(msg);
    }
    this.selectedMessages.set(current);
    if (current.size === 1) {
      this.messageContent = Array.from(current)[0];
    } else if (current.size > 1) {
      this.messageContent = `[\u591A\u6A21\u677F\u6A21\u5F0F] \u5DF2\u9078\u64C7 ${current.size} \u500B\u6A21\u677F`;
    } else {
      this.messageContent = "";
    }
  }
  selectAllMessages() {
    const all = new Set(this.aiGeneratedMessages());
    this.selectedMessages.set(all);
    this.messageContent = `[\u591A\u6A21\u677F\u6A21\u5F0F] \u5DF2\u9078\u64C7 ${all.size} \u500B\u6A21\u677F`;
  }
  clearSelectedMessages() {
    this.selectedMessages.set(/* @__PURE__ */ new Set());
    this.messageContent = "";
  }
  setSendStrategy(strategy) {
    this.sendStrategy.set(strategy);
  }
  getStrategyDescription() {
    const descs = {
      "random": `\u5C07\u96A8\u6A5F\u9078\u64C7\u6A21\u677F\u767C\u9001\u7D66 ${this.targets().length} \u500B\u7528\u6236\uFF0C\u589E\u52A0\u6D88\u606F\u591A\u6A23\u6027`,
      "rotate": `\u6A21\u677F\u5C07\u8F2A\u6D41\u4F7F\u7528\uFF0C\u78BA\u4FDD\u6BCF\u500B\u6A21\u677F\u88AB\u5747\u52FB\u4F7F\u7528`,
      "sequential": `\u6309\u9806\u5E8F\u4F9D\u6B21\u4F7F\u7528\u6BCF\u500B\u6A21\u677F`
    };
    return descs[this.sendStrategy()] || "";
  }
  canSend() {
    if (this.selectedMessages().size > 0)
      return true;
    return this.messageContent.trim().length > 0 || this.attachments().length > 0;
  }
  insertVariable(variable) {
    this.messageContent += variable;
  }
  async selectImages() {
    try {
      const result = await this.ipc.invoke("select-file-for-attachment", {
        filters: [{ name: "Images", extensions: ["jpg", "jpeg", "png", "gif", "webp"] }],
        multiSelections: true
      });
      if (result && result.length > 0) {
        const newAttachments = result.map((file) => ({
          name: file.fileName,
          path: file.filePath,
          type: file.fileType
        }));
        this.attachments.update((arr) => [...arr, ...newAttachments]);
      }
    } catch (e) {
      console.error("Select images failed:", e);
    }
  }
  async selectFiles() {
    try {
      const result = await this.ipc.invoke("select-file-for-attachment", {
        filters: [{ name: "All Files", extensions: ["*"] }],
        multiSelections: true
      });
      if (result && result.length > 0) {
        const newAttachments = result.map((file) => ({
          name: file.fileName,
          path: file.filePath,
          type: file.fileType
        }));
        this.attachments.update((arr) => [...arr, ...newAttachments]);
      }
    } catch (e) {
      console.error("Select files failed:", e);
    }
  }
  removeAttachment(index) {
    this.attachments.update((arr) => arr.filter((_, i) => i !== index));
  }
  previewMessage() {
    this.showPreview.set(true);
  }
  replaceVariables(template, user) {
    let result = template;
    const firstName = user.firstName || user.first_name || "";
    const lastName = user.lastName || user.last_name || "";
    const username = user.username || "";
    const displayName = user.displayName || user.name || firstName || username || "\u670B\u53CB";
    const fullName = `${firstName} ${lastName}`.trim() || displayName;
    const groupName = user.groupName || user.sourceGroup || user.source || "\u7FA4\u7D44";
    const keyword = user.keyword || user.triggeredKeyword || user.matchedKeyword || "";
    const source = user.source || user.sourceType || "";
    result = result.replace(/{firstName}/g, firstName);
    result = result.replace(/{first_name}/g, firstName);
    result = result.replace(/{lastName}/g, lastName);
    result = result.replace(/{last_name}/g, lastName);
    result = result.replace(/{username}/g, username);
    result = result.replace(/{displayName}/g, displayName);
    result = result.replace(/{name}/g, displayName);
    result = result.replace(/{fullName}/g, fullName);
    result = result.replace(/{full_name}/g, fullName);
    result = result.replace(/{groupName}/g, groupName);
    result = result.replace(/{group_name}/g, groupName);
    result = result.replace(/{keyword}/g, keyword);
    result = result.replace(/{source}/g, source);
    const now = /* @__PURE__ */ new Date();
    const hour = now.getHours();
    let greeting = "\u60A8\u597D";
    if (hour >= 5 && hour < 12)
      greeting = "\u65E9\u4E0A\u597D";
    else if (hour >= 12 && hour < 14)
      greeting = "\u4E2D\u5348\u597D";
    else if (hour >= 14 && hour < 18)
      greeting = "\u4E0B\u5348\u597D";
    else if (hour >= 18 && hour < 22)
      greeting = "\u665A\u4E0A\u597D";
    else
      greeting = "\u591C\u6DF1\u4E86";
    const days = ["\u661F\u671F\u65E5", "\u661F\u671F\u4E00", "\u661F\u671F\u4E8C", "\u661F\u671F\u4E09", "\u661F\u671F\u56DB", "\u661F\u671F\u4E94", "\u661F\u671F\u516D"];
    const dateStr = `${now.getMonth() + 1}\u6708${now.getDate()}\u65E5`;
    const timeStr = `${now.getHours().toString().padStart(2, "0")}:${now.getMinutes().toString().padStart(2, "0")}`;
    const dayStr = days[now.getDay()];
    result = result.replace(/{greeting}/g, greeting);
    result = result.replace(/{date}/g, dateStr);
    result = result.replace(/{time}/g, timeStr);
    result = result.replace(/{day}/g, dayStr);
    return result;
  }
  startSending() {
    if (!this.canSend())
      return;
    this.isSending.set(true);
    this.sentCount.set(0);
    this.successCount.set(0);
    this.failedCount.set(0);
    this.currentTarget.set("");
    this.failureReasons.set({});
    const selectedMsgs = Array.from(this.selectedMessages());
    const isMultiTemplate = selectedMsgs.length > 1;
    const sendData = {
      targets: this.targets().map((t) => ({
        telegramId: t.telegramId,
        username: t.username,
        firstName: t.firstName,
        lastName: t.lastName,
        displayName: t.displayName,
        // 添加來源信息
        groupName: t.groupName,
        keyword: t.keyword,
        source: t.source
      })),
      attachments: this.attachments(),
      config: {
        minInterval: this.minInterval,
        maxInterval: this.maxInterval,
        accountRotation: this.accountRotation
      }
    };
    if (isMultiTemplate) {
      sendData.messages = selectedMsgs;
      sendData.sendStrategy = this.sendStrategy();
      sendData.message = "";
      this.toast.info(`\u{1F4E8} \u4F7F\u7528 ${selectedMsgs.length} \u500B\u6A21\u677F${this.sendStrategy() === "random" ? "\u96A8\u6A5F" : this.sendStrategy() === "rotate" ? "\u8F2A\u8F49" : "\u9806\u5E8F"}\u767C\u9001...`);
    } else if (selectedMsgs.length === 1) {
      sendData.message = selectedMsgs[0];
    } else {
      sendData.message = this.messageContent;
    }
    this.ipc.send("batch-send:start", sendData);
    if (!isMultiTemplate) {
      this.toast.info(`\u{1F4E8} \u958B\u59CB\u6279\u91CF\u767C\u9001 ${this.targets().length} \u689D\u6D88\u606F...`);
    }
  }
  close() {
    if (this.isSending()) {
      if (!confirm("\u767C\u9001\u6B63\u5728\u9032\u884C\u4E2D\uFF0C\u78BA\u5B9A\u8981\u53D6\u6D88\u55CE\uFF1F")) {
        return;
      }
      this.ipc.send("batch-send:cancel", {});
    }
    this.closeDialog.emit();
  }
  onBackdropClick(event) {
    if (event.target === event.currentTarget && !this.isSending()) {
      this.close();
    }
  }
  static {
    this.\u0275fac = function BatchSendDialogComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _BatchSendDialogComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _BatchSendDialogComponent, selectors: [["app-batch-send-dialog"]], inputs: { isOpen: [1, "isOpen"], targets: [1, "targets"] }, outputs: { closeDialog: "closeDialog", sendComplete: "sendComplete" }, decls: 2, vars: 2, consts: [[1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-50", "p-4"], [1, "fixed", "inset-0", "bg-black/80", "flex", "items-center", "justify-center", "z-[60]", "p-4"], [1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-50", "p-4", 3, "click"], [1, "bg-slate-900", "rounded-2xl", "w-full", "max-w-2xl", "shadow-2xl", "border", "border-slate-700/50", "overflow-hidden", "max-h-[90vh]", "flex", "flex-col"], [1, "p-5", "border-b", "border-slate-700/50", "bg-gradient-to-r", "from-blue-500/10", "to-cyan-500/10"], [1, "flex", "items-center", "justify-between"], [1, "flex", "items-center", "gap-3"], [1, "w-10", "h-10", "rounded-xl", "bg-gradient-to-br", "from-blue-500", "to-cyan-500", "flex", "items-center", "justify-center", "text-xl"], [1, "text-lg", "font-bold", "text-white"], [1, "text-sm", "text-slate-400"], [1, "p-2", "hover:bg-slate-800", "rounded-lg", "transition-colors", "text-slate-400", "hover:text-white", 3, "click"], ["fill", "none", "stroke", "currentColor", "viewBox", "0 0 24 24", 1, "w-5", "h-5"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M6 18L18 6M6 6l12 12"], [1, "flex-1", "overflow-y-auto", "p-5", "pb-8", "space-y-5"], [1, "block", "text-sm", "font-medium", "text-slate-300", "mb-3"], [1, "flex", "gap-2"], [1, "flex-1", "py-3", "rounded-xl", "border", "transition-all", "flex", "items-center", "justify-center", "gap-2", 3, "click"], [1, "p-4", "bg-slate-800/30", "rounded-xl", "border", "border-slate-700/50"], [1, "p-4", "bg-purple-500/10", "rounded-xl", "border", "border-purple-500/30"], [1, "block", "text-sm", "font-medium", "text-slate-300", "mb-2"], [1, "text-xs", "text-blue-400", "ml-2"], ["rows", "5", "placeholder", "\u8F38\u5165\u6D88\u606F\u5167\u5BB9...\n\n\u9EDE\u64CA\u4E0B\u65B9\u8B8A\u91CF\u6309\u9215\u53EF\u5FEB\u901F\u63D2\u5165\uFF0C\u4F8B\u5982\uFF1A\n{greeting}{name}\uFF0C\u5F88\u9AD8\u8208\u8A8D\u8B58\u4F60\uFF01", 1, "w-full", "bg-slate-800/50", "border", "border-slate-600", "rounded-xl", "p-4", "text-white", "placeholder-slate-500", "resize-none", "focus:ring-2", "focus:ring-blue-500", "focus:border-transparent", 3, "ngModelChange", "ngModel"], [1, "mt-2", "flex", "flex-wrap", "gap-2", "items-center"], [1, "text-xs", "text-slate-500"], [1, "px-2.5", "py-1", "text-xs", "bg-slate-700/80", "text-cyan-400", "rounded-lg", "hover:bg-cyan-500/20", "hover:text-cyan-300", "transition-all", "border", "border-slate-600", "hover:border-cyan-500/50", "flex", "items-center", "gap-1", 3, "title"], [1, "flex", "gap-3"], [1, "flex-1", "py-3", "bg-slate-800/50", "border", "border-dashed", "border-slate-600", "rounded-xl", "text-slate-400", "hover:text-white", "hover:border-slate-500", "transition-colors", "flex", "items-center", "justify-center", "gap-2", 3, "click"], [1, "mt-3", "flex", "flex-wrap", "gap-2"], [1, "space-y-4"], [1, "text-sm", "text-slate-400", "w-24"], ["type", "number", "min", "10", "max", "300", 1, "w-20", "px-3", "py-2", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "text-white", "text-center", "focus:ring-2", "focus:ring-blue-500", 3, "ngModelChange", "ngModel"], [1, "text-slate-400"], ["type", "number", "min", "10", "max", "600", 1, "w-20", "px-3", "py-2", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "text-white", "text-center", "focus:ring-2", "focus:ring-blue-500", 3, "ngModelChange", "ngModel"], [1, "relative", "inline-flex", "items-center", "cursor-pointer"], ["type", "checkbox", 1, "sr-only", "peer", 3, "ngModelChange", "ngModel"], [1, "w-11", "h-6", "bg-slate-700", "peer-focus:ring-2", "peer-focus:ring-blue-500", "rounded-full", "peer", "peer-checked:after:translate-x-full", "after:content-['']", "after:absolute", "after:top-[2px]", "after:left-[2px]", "after:bg-white", "after:rounded-full", "after:h-5", "after:w-5", "after:transition-all", "peer-checked:bg-blue-500"], [1, "max-h-32", "overflow-y-auto", "p-3", "bg-slate-800/30", "rounded-xl", "border", "border-slate-700/50"], [1, "flex", "flex-wrap", "gap-2"], [1, "px-2", "py-1", "bg-slate-700", "text-slate-300", "rounded", "text-xs"], [1, "px-2", "py-1", "text-slate-400", "text-xs"], [1, "p-4", "bg-slate-800/50", "border-t", "border-slate-700/50"], [1, "sticky", "bottom-0", "left-0", "right-0", "p-4", "border-t", "border-slate-700/50", "bg-slate-900", "flex", "gap-3", "z-10", "shadow-[0_-4px_12px_rgba(0,0,0,0.3)]"], [1, "px-4", "py-3", "bg-slate-700", "text-slate-300", "rounded-xl", "hover:bg-slate-600", "transition-colors", "disabled:opacity-50", 3, "click", "disabled"], [1, "px-4", "py-3", "bg-slate-700", "text-white", "rounded-xl", "hover:bg-slate-600", "transition-colors", "disabled:opacity-50", 3, "click", "disabled"], [1, "flex-1", "py-3", "bg-gradient-to-r", "from-blue-500", "to-cyan-500", "text-white", "font-bold", "rounded-xl", "hover:opacity-90", "transition-opacity", "disabled:opacity-50", "flex", "items-center", "justify-center", "gap-2", "text-base", "shadow-lg", "shadow-blue-500/20", 3, "click", "disabled"], [1, "flex", "items-center", "justify-between", "mb-3"], [1, "text-sm", "font-medium", "text-slate-300"], [1, "text-xs", "text-cyan-400", "hover:text-cyan-300", 3, "click"], [1, "flex", "gap-2", "mb-3", "flex-wrap"], [1, "px-3", "py-1", "text-xs", "rounded-lg", "transition-all", 3, "bg-blue-500", "text-white", "bg-slate-700", "text-slate-400"], [1, "flex", "items-center", "justify-center", "py-6"], [1, "text-center", "py-6", "text-slate-500"], [1, "space-y-2", "max-h-40", "overflow-y-auto"], [1, "px-3", "py-1", "text-xs", "rounded-lg", "transition-all", 3, "click"], ["fill", "none", "viewBox", "0 0 24 24", 1, "animate-spin", "h-5", "w-5", "text-blue-400"], ["cx", "12", "cy", "12", "r", "10", "stroke", "currentColor", "stroke-width", "4", 1, "opacity-25"], ["fill", "currentColor", "d", "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z", 1, "opacity-75"], [1, "ml-2", "text-slate-400", "text-sm"], [1, "text-xs", "mt-1"], [1, "w-full", "p-3", "rounded-lg", "border", "transition-all", "text-left", 3, "border-blue-500", "bg-blue-500/10", "border-slate-600", "bg-slate-800/50", "hover:border-slate-500"], [1, "w-full", "p-3", "rounded-lg", "border", "transition-all", "text-left", 3, "click"], [1, "flex", "items-center", "justify-between", "mb-1"], [1, "font-medium", "text-white", "text-sm"], [1, "text-xs", "text-slate-400", "line-clamp-2"], [1, "text-sm", "font-medium", "text-purple-300"], [1, "flex", "items-center", "gap-2", "px-2", "py-1", "rounded-lg", "text-xs", 3, "bg-green-500/20", "text-green-400", "bg-amber-500/20", "text-amber-400"], [1, "space-y-3"], [1, "text-xs", "text-slate-400", "mb-2", "block"], [1, "px-3", "py-1.5", "text-xs", "rounded-lg", "transition-all", 3, "bg-purple-500", "text-white", "bg-slate-700", "text-slate-400"], ["type", "text", "placeholder", "\u4F8B\u5982\uFF1A\u6253\u500B\u62DB\u547C\u3001\u4ECB\u7D39\u7522\u54C1\u3001\u9080\u8ACB\u52A0\u7FA4...", 1, "w-full", "px-3", "py-2", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "text-white", "text-sm", "placeholder-slate-500", "focus:ring-2", "focus:ring-purple-500", 3, "ngModelChange", "ngModel"], [1, "w-full", "py-2.5", "bg-gradient-to-r", "from-purple-500", "to-pink-500", "text-white", "rounded-lg", "hover:opacity-90", "transition-opacity", "disabled:opacity-50", "flex", "items-center", "justify-center", "gap-2", 3, "click", "disabled"], [1, "space-y-3", "mt-3"], [1, "flex", "items-center", "gap-2", "px-2", "py-1", "rounded-lg", "text-xs"], [1, "w-2", "h-2", "bg-green-500", "rounded-full", "animate-pulse"], [1, "w-2", "h-2", "bg-amber-500", "rounded-full"], [1, "px-3", "py-1.5", "text-xs", "rounded-lg", "transition-all", 3, "click"], ["fill", "none", "viewBox", "0 0 24 24", 1, "animate-spin", "h-4", "w-4"], [1, "text-xs", "text-slate-400"], [1, "text-xs", "px-2", "py-1", "bg-purple-500/20", "text-purple-400", "rounded", "hover:bg-purple-500/30", 3, "click"], [1, "text-xs", "px-2", "py-1", "bg-slate-700", "text-slate-400", "rounded", "hover:bg-slate-600", 3, "click"], [1, "flex", "items-start", "gap-3", "w-full", "p-3", "rounded-lg", "border", "transition-all", "cursor-pointer", 3, "border-purple-500", "bg-purple-500/10", "border-slate-600", "bg-slate-800/50"], [1, "mt-4", "p-3", "bg-slate-800/50", "rounded-lg", "border", "border-slate-700"], [1, "flex", "items-start", "gap-3", "w-full", "p-3", "rounded-lg", "border", "transition-all", "cursor-pointer"], ["type", "checkbox", 1, "mt-1", "w-4", "h-4", "rounded", "bg-slate-700", "border-slate-500", "text-purple-500", "focus:ring-purple-500", 3, "change", "checked"], [1, "flex-1", "text-sm", "text-slate-300"], [1, "text-xs", "text-slate-400", "block", "mb-2"], [1, "flex", "gap-2", "flex-wrap"], [1, "px-3", "py-1.5", "rounded-lg", "text-xs", "transition-all", 3, "bg-purple-500", "text-white", "bg-slate-700", "text-slate-400", "title"], [1, "text-xs", "text-slate-500", "mt-2"], [1, "px-3", "py-1.5", "rounded-lg", "text-xs", "transition-all", 3, "click", "title"], [1, "px-2.5", "py-1", "text-xs", "bg-slate-700/80", "text-cyan-400", "rounded-lg", "hover:bg-cyan-500/20", "hover:text-cyan-300", "transition-all", "border", "border-slate-600", "hover:border-cyan-500/50", "flex", "items-center", "gap-1", 3, "click", "title"], [1, "text-slate-500"], [1, "text-white"], [1, "flex", "items-center", "gap-2", "px-3", "py-2", "bg-slate-800/50", "rounded-lg", "border", "border-slate-700"], [1, "text-lg"], [1, "text-sm", "text-white", "max-w-[150px]", "truncate"], [1, "text-slate-400", "hover:text-red-400", 3, "click"], ["fill", "none", "stroke", "currentColor", "viewBox", "0 0 24 24", 1, "w-4", "h-4"], [1, "flex", "items-center", "justify-between", "mb-2"], [1, "text-sm", "text-white"], [1, "w-full", "h-2", "bg-slate-700", "rounded-full", "overflow-hidden"], [1, "h-full", "bg-gradient-to-r", "from-blue-500", "to-cyan-500", "transition-all", "duration-300"], [1, "mt-2", "flex", "items-center", "gap-4", "text-xs", "text-slate-400"], [1, "mt-2", "text-xs", "text-cyan-400"], [1, "mt-3", "p-2", "bg-red-500/10", "border", "border-red-500/20", "rounded-lg"], [1, "text-xs", "text-red-400", "font-medium", "mb-1"], [1, "text-xs", "px-2", "py-0.5", "bg-red-500/20", "text-red-300", "rounded"], [1, "animate-spin"], [1, "bg-slate-900", "rounded-xl", "p-6", "max-w-md", "w-full", "border", "border-slate-700"], [1, "text-lg", "font-bold", "text-white", "mb-4"], [1, "p-4", "bg-slate-800", "rounded-lg", "text-white", "whitespace-pre-wrap"], [1, "mt-3", "text-sm", "text-slate-400"], [1, "mt-4", "w-full", "py-2", "bg-slate-700", "text-white", "rounded-lg", "hover:bg-slate-600", "transition-colors", 3, "click"]], template: function BatchSendDialogComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, BatchSendDialogComponent_Conditional_0_Template, 86, 53, "div", 0);
        \u0275\u0275conditionalCreate(1, BatchSendDialogComponent_Conditional_1_Template, 9, 2, "div", 1);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.isOpen() ? 0 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.showPreview() ? 1 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, DefaultValueAccessor, NumberValueAccessor, CheckboxControlValueAccessor, NgControlStatus, MinValidator, MaxValidator, NgModel], encapsulation: 2 });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(BatchSendDialogComponent, [{
    type: Component,
    args: [{
      selector: "app-batch-send-dialog",
      standalone: true,
      imports: [CommonModule, FormsModule],
      template: `
    @if (isOpen()) {
      <div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4"
           (click)="onBackdropClick($event)">
        <div class="bg-slate-900 rounded-2xl w-full max-w-2xl shadow-2xl border border-slate-700/50 overflow-hidden max-h-[90vh] flex flex-col">
          
          <!-- \u982D\u90E8 -->
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-blue-500/10 to-cyan-500/10">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-xl">
                  \u{1F4E8}
                </div>
                <div>
                  <h2 class="text-lg font-bold text-white">\u6279\u91CF\u767C\u9001\u6D88\u606F</h2>
                  <p class="text-sm text-slate-400">\u5411 {{ targets().length }} \u500B\u7528\u6236\u767C\u9001\u6D88\u606F</p>
                </div>
              </div>
              <button (click)="close()" class="p-2 hover:bg-slate-800 rounded-lg transition-colors text-slate-400 hover:text-white">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
          </div>
          
          <!-- \u5167\u5BB9 - \u589E\u52A0\u5E95\u90E8 padding \u9632\u6B62\u88AB\u5E95\u90E8\u6309\u9215\u64CB\u4F4F -->
          <div class="flex-1 overflow-y-auto p-5 pb-8 space-y-5">
            
            <!-- \u6D88\u606F\u4F86\u6E90\u9078\u64C7 -->
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-3">
                \u{1F4DD} \u6D88\u606F\u4F86\u6E90
              </label>
              <div class="flex gap-2">
                <button 
                  (click)="setMessageSource('template')"
                  class="flex-1 py-3 rounded-xl border transition-all flex items-center justify-center gap-2"
                  [class.border-blue-500]="messageSource() === 'template'"
                  [class.bg-blue-500/20]="messageSource() === 'template'"
                  [class.text-blue-400]="messageSource() === 'template'"
                  [class.border-slate-600]="messageSource() !== 'template'"
                  [class.bg-slate-800/50]="messageSource() !== 'template'"
                  [class.text-slate-400]="messageSource() !== 'template'">
                  \u{1F4C4} \u804A\u5929\u6A21\u677F
                </button>
                <button 
                  (click)="setMessageSource('custom')"
                  class="flex-1 py-3 rounded-xl border transition-all flex items-center justify-center gap-2"
                  [class.border-cyan-500]="messageSource() === 'custom'"
                  [class.bg-cyan-500/20]="messageSource() === 'custom'"
                  [class.text-cyan-400]="messageSource() === 'custom'"
                  [class.border-slate-600]="messageSource() !== 'custom'"
                  [class.bg-slate-800/50]="messageSource() !== 'custom'"
                  [class.text-slate-400]="messageSource() !== 'custom'">
                  \u270F\uFE0F \u81EA\u5B9A\u7FA9
                </button>
                <button 
                  (click)="setMessageSource('ai')"
                  class="flex-1 py-3 rounded-xl border transition-all flex items-center justify-center gap-2"
                  [class.border-purple-500]="messageSource() === 'ai'"
                  [class.bg-purple-500/20]="messageSource() === 'ai'"
                  [class.text-purple-400]="messageSource() === 'ai'"
                  [class.border-slate-600]="messageSource() !== 'ai'"
                  [class.bg-slate-800/50]="messageSource() !== 'ai'"
                  [class.text-slate-400]="messageSource() !== 'ai'">
                  \u{1F916} AI \u751F\u6210
                </button>
              </div>
            </div>
            
            <!-- \u6A21\u677F\u9078\u64C7\u5340\u57DF -->
            @if (messageSource() === 'template') {
              <div class="p-4 bg-slate-800/30 rounded-xl border border-slate-700/50">
                <div class="flex items-center justify-between mb-3">
                  <label class="text-sm font-medium text-slate-300">\u9078\u64C7\u804A\u5929\u6A21\u677F</label>
                  <button (click)="loadTemplates()" class="text-xs text-cyan-400 hover:text-cyan-300">
                    \u{1F504} \u5237\u65B0
                  </button>
                </div>
                
                <!-- \u6A21\u677F\u5206\u985E\u904E\u6FFE -->
                <div class="flex gap-2 mb-3 flex-wrap">
                  @for (cat of templateCategories; track cat.key) {
                    <button 
                      (click)="filterTemplateCategory.set(cat.key)"
                      class="px-3 py-1 text-xs rounded-lg transition-all"
                      [class.bg-blue-500]="filterTemplateCategory() === cat.key"
                      [class.text-white]="filterTemplateCategory() === cat.key"
                      [class.bg-slate-700]="filterTemplateCategory() !== cat.key"
                      [class.text-slate-400]="filterTemplateCategory() !== cat.key">
                      {{ cat.icon }} {{ cat.label }}
                    </button>
                  }
                </div>
                
                <!-- \u6A21\u677F\u5217\u8868 -->
                @if (isLoadingTemplates()) {
                  <div class="flex items-center justify-center py-6">
                    <svg class="animate-spin h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                    </svg>
                    <span class="ml-2 text-slate-400 text-sm">\u8F09\u5165\u6A21\u677F...</span>
                  </div>
                } @else if (filteredTemplates().length === 0) {
                  <div class="text-center py-6 text-slate-500">
                    <p>\u6C92\u6709\u627E\u5230\u6A21\u677F</p>
                    <p class="text-xs mt-1">\u8ACB\u5148\u5230\u300C\u804A\u5929\u6A21\u677F\u300D\u9801\u9762\u5275\u5EFA\u6A21\u677F</p>
                  </div>
                } @else {
                  <div class="space-y-2 max-h-40 overflow-y-auto">
                    @for (template of filteredTemplates(); track template.id) {
                      <button 
                        (click)="selectTemplate(template)"
                        class="w-full p-3 rounded-lg border transition-all text-left"
                        [class.border-blue-500]="selectedTemplate()?.id === template.id"
                        [class.bg-blue-500/10]="selectedTemplate()?.id === template.id"
                        [class.border-slate-600]="selectedTemplate()?.id !== template.id"
                        [class.bg-slate-800/50]="selectedTemplate()?.id !== template.id"
                        [class.hover:border-slate-500]="selectedTemplate()?.id !== template.id">
                        <div class="flex items-center justify-between mb-1">
                          <span class="font-medium text-white text-sm">{{ template.name }}</span>
                          <span class="text-xs text-slate-500">\u4F7F\u7528 {{ template.usageCount }} \u6B21</span>
                        </div>
                        <p class="text-xs text-slate-400 line-clamp-2">{{ template.content }}</p>
                      </button>
                    }
                  </div>
                }
              </div>
            }
            
            <!-- AI \u751F\u6210\u5340\u57DF -->
            @if (messageSource() === 'ai') {
              <div class="p-4 bg-purple-500/10 rounded-xl border border-purple-500/30">
                <div class="flex items-center justify-between mb-3">
                  <label class="text-sm font-medium text-purple-300">\u{1F916} AI \u667A\u80FD\u751F\u6210</label>
                  
                  <!-- AI \u72C0\u614B\u6307\u793A\u5668 -->
                  @if (aiStatus().source !== 'unknown') {
                    <div class="flex items-center gap-2 px-2 py-1 rounded-lg text-xs"
                         [class.bg-green-500/20]="aiStatus().connected"
                         [class.text-green-400]="aiStatus().connected"
                         [class.bg-amber-500/20]="!aiStatus().connected"
                         [class.text-amber-400]="!aiStatus().connected">
                      @if (aiStatus().connected) {
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                        <span>\u5DF2\u9023\u63A5 {{ aiStatus().model }}</span>
                      } @else {
                        <span class="w-2 h-2 bg-amber-500 rounded-full"></span>
                        <span>\u4F7F\u7528\u672C\u5730\u6A21\u677F</span>
                      }
                    </div>
                  }
                </div>
                
                <div class="space-y-3">
                  <!-- \u8A9E\u8A00\u98A8\u683C -->
                  <div>
                    <span class="text-xs text-slate-400 mb-2 block">\u8A9E\u8A00\u98A8\u683C\uFF1A</span>
                    <div class="flex flex-wrap gap-2">
                      @for (style of aiStyles; track style.key) {
                        <button 
                          (click)="selectedAiStyle.set(style.key)"
                          class="px-3 py-1.5 text-xs rounded-lg transition-all"
                          [class.bg-purple-500]="selectedAiStyle() === style.key"
                          [class.text-white]="selectedAiStyle() === style.key"
                          [class.bg-slate-700]="selectedAiStyle() !== style.key"
                          [class.text-slate-400]="selectedAiStyle() !== style.key">
                          {{ style.label }}
                        </button>
                      }
                    </div>
                  </div>
                  
                  <!-- \u4E3B\u984C\u8F38\u5165 -->
                  <div>
                    <span class="text-xs text-slate-400 mb-2 block">\u6D88\u606F\u4E3B\u984C\uFF1A</span>
                    <input 
                      type="text"
                      [(ngModel)]="aiTopic"
                      placeholder="\u4F8B\u5982\uFF1A\u6253\u500B\u62DB\u547C\u3001\u4ECB\u7D39\u7522\u54C1\u3001\u9080\u8ACB\u52A0\u7FA4..."
                      class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-sm placeholder-slate-500 focus:ring-2 focus:ring-purple-500">
                  </div>
                  
                  <!-- \u751F\u6210\u6309\u9215 -->
                  <button 
                    (click)="generateAiMessage()"
                    [disabled]="isGeneratingAi() || !aiTopic.trim()"
                    class="w-full py-2.5 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 flex items-center justify-center gap-2">
                    @if (isGeneratingAi()) {
                      <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                      </svg>
                      \u751F\u6210\u4E2D...
                    } @else {
                      \u2728 \u751F\u6210 5 \u7A2E\u4E0D\u540C\u8868\u9054
                    }
                  </button>
                  
                  <!-- AI \u751F\u6210\u7D50\u679C\uFF08\u652F\u6301\u591A\u9078\uFF09 -->
                  @if (aiGeneratedMessages().length > 0) {
                    <div class="space-y-3 mt-3">
                      <div class="flex items-center justify-between">
                        <span class="text-xs text-slate-400">\u53EF\u591A\u9078\u6A21\u677F\uFF08\u5DF2\u9078 {{ selectedMessages().size }} \u500B\uFF09\uFF1A</span>
                        <div class="flex gap-2">
                          <button 
                            (click)="selectAllMessages()"
                            class="text-xs px-2 py-1 bg-purple-500/20 text-purple-400 rounded hover:bg-purple-500/30">
                            \u5168\u9078
                          </button>
                          <button 
                            (click)="clearSelectedMessages()"
                            class="text-xs px-2 py-1 bg-slate-700 text-slate-400 rounded hover:bg-slate-600">
                            \u6E05\u9664
                          </button>
                        </div>
                      </div>
                      @for (msg of aiGeneratedMessages(); track $index) {
                        <label 
                          class="flex items-start gap-3 w-full p-3 rounded-lg border transition-all cursor-pointer"
                          [class.border-purple-500]="isMessageSelected(msg)"
                          [class.bg-purple-500/10]="isMessageSelected(msg)"
                          [class.border-slate-600]="!isMessageSelected(msg)"
                          [class.bg-slate-800/50]="!isMessageSelected(msg)">
                          <input 
                            type="checkbox" 
                            [checked]="isMessageSelected(msg)"
                            (change)="toggleMessageSelection(msg)"
                            class="mt-1 w-4 h-4 rounded bg-slate-700 border-slate-500 text-purple-500 focus:ring-purple-500">
                          <span class="flex-1 text-sm text-slate-300">{{ msg }}</span>
                        </label>
                      }
                      
                      <!-- \u767C\u9001\u7B56\u7565\u9078\u64C7 -->
                      @if (selectedMessages().size > 1) {
                        <div class="mt-4 p-3 bg-slate-800/50 rounded-lg border border-slate-700">
                          <span class="text-xs text-slate-400 block mb-2">\u{1F4E4} \u767C\u9001\u7B56\u7565\uFF1A</span>
                          <div class="flex gap-2 flex-wrap">
                            @for (strategy of sendStrategies; track strategy.key) {
                              <button 
                                (click)="setSendStrategy(strategy.key)"
                                class="px-3 py-1.5 rounded-lg text-xs transition-all"
                                [class.bg-purple-500]="sendStrategy() === strategy.key"
                                [class.text-white]="sendStrategy() === strategy.key"
                                [class.bg-slate-700]="sendStrategy() !== strategy.key"
                                [class.text-slate-400]="sendStrategy() !== strategy.key"
                                [title]="strategy.desc">
                                {{ strategy.label }}
                              </button>
                            }
                          </div>
                          <p class="text-xs text-slate-500 mt-2">
                            {{ getStrategyDescription() }}
                          </p>
                        </div>
                      }
                    </div>
                  }
                </div>
              </div>
            }
            
            <!-- \u6D88\u606F\u7DE8\u8F2F\u5340\u57DF -->
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">
                \u{1F4DD} \u6D88\u606F\u5167\u5BB9 
                @if (messageSource() === 'template' && selectedTemplate()) {
                  <span class="text-xs text-blue-400 ml-2">\uFF08\u4F7F\u7528\u6A21\u677F\uFF1A{{ selectedTemplate()?.name }}\uFF09</span>
                }
              </label>
              <textarea 
                [(ngModel)]="messageContent"
                rows="5"
                class="w-full bg-slate-800/50 border border-slate-600 rounded-xl p-4 text-white placeholder-slate-500 resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                placeholder="\u8F38\u5165\u6D88\u606F\u5167\u5BB9...&#10;&#10;\u9EDE\u64CA\u4E0B\u65B9\u8B8A\u91CF\u6309\u9215\u53EF\u5FEB\u901F\u63D2\u5165\uFF0C\u4F8B\u5982\uFF1A&#10;{greeting}{name}\uFF0C\u5F88\u9AD8\u8208\u8A8D\u8B58\u4F60\uFF01">
              </textarea>
              
              <!-- \u8B8A\u91CF\u63D0\u793A -->
              <div class="mt-2 flex flex-wrap gap-2 items-center">
                <span class="text-xs text-slate-500">\u53EF\u7528\u8B8A\u91CF\uFF1A</span>
                @for (variable of availableVariables; track variable.key) {
                  <button 
                    (click)="insertVariable(variable.key)"
                    class="px-2.5 py-1 text-xs bg-slate-700/80 text-cyan-400 rounded-lg hover:bg-cyan-500/20 hover:text-cyan-300 transition-all border border-slate-600 hover:border-cyan-500/50 flex items-center gap-1"
                    [title]="'\u63D2\u5165 ' + variable.key">
                    <span class="text-slate-400">{{ variable.key }}</span>
                    <span class="text-slate-500">|</span>
                    <span class="text-white">{{ variable.label }}</span>
                  </button>
                }
              </div>
            </div>
            
            <!-- \u9644\u4EF6 -->
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">
                \u{1F4CE} \u9644\u4EF6\uFF08\u53EF\u9078\uFF09
              </label>
              <div class="flex gap-3">
                <button 
                  (click)="selectImages()"
                  class="flex-1 py-3 bg-slate-800/50 border border-dashed border-slate-600 rounded-xl text-slate-400 hover:text-white hover:border-slate-500 transition-colors flex items-center justify-center gap-2">
                  \u{1F5BC}\uFE0F \u6DFB\u52A0\u5716\u7247
                </button>
                <button 
                  (click)="selectFiles()"
                  class="flex-1 py-3 bg-slate-800/50 border border-dashed border-slate-600 rounded-xl text-slate-400 hover:text-white hover:border-slate-500 transition-colors flex items-center justify-center gap-2">
                  \u{1F4C4} \u6DFB\u52A0\u6587\u4EF6
                </button>
              </div>
              
              <!-- \u9644\u4EF6\u5217\u8868 -->
              @if (attachments().length > 0) {
                <div class="mt-3 flex flex-wrap gap-2">
                  @for (attachment of attachments(); track attachment.name; let i = $index) {
                    <div class="flex items-center gap-2 px-3 py-2 bg-slate-800/50 rounded-lg border border-slate-700">
                      <span class="text-lg">{{ attachment.type.startsWith('image') ? '\u{1F5BC}\uFE0F' : '\u{1F4C4}' }}</span>
                      <span class="text-sm text-white max-w-[150px] truncate">{{ attachment.name }}</span>
                      <button (click)="removeAttachment(i)" class="text-slate-400 hover:text-red-400">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                      </button>
                    </div>
                  }
                </div>
              }
            </div>
            
            <!-- \u767C\u9001\u8A2D\u7F6E -->
            <div class="p-4 bg-slate-800/30 rounded-xl border border-slate-700/50">
              <label class="block text-sm font-medium text-slate-300 mb-3">
                \u2699\uFE0F \u767C\u9001\u8A2D\u7F6E
              </label>
              
              <div class="space-y-4">
                <!-- \u767C\u9001\u9593\u9694 -->
                <div class="flex items-center gap-3">
                  <span class="text-sm text-slate-400 w-24">\u767C\u9001\u9593\u9694\uFF1A</span>
                  <input 
                    type="number" 
                    [(ngModel)]="minInterval"
                    min="10" max="300"
                    class="w-20 px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-center focus:ring-2 focus:ring-blue-500">
                  <span class="text-slate-400">-</span>
                  <input 
                    type="number" 
                    [(ngModel)]="maxInterval"
                    min="10" max="600"
                    class="w-20 px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-center focus:ring-2 focus:ring-blue-500">
                  <span class="text-sm text-slate-400">\u79D2\uFF08\u96A8\u6A5F\uFF09</span>
                </div>
                
                <!-- \u5E33\u865F\u8F2A\u63DB -->
                <div class="flex items-center gap-3">
                  <span class="text-sm text-slate-400 w-24">\u5E33\u865F\u8F2A\u63DB\uFF1A</span>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" [(ngModel)]="accountRotation" class="sr-only peer">
                    <div class="w-11 h-6 bg-slate-700 peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div>
                  </label>
                  <span class="text-sm text-slate-400">\u555F\u7528\u591A\u5E33\u865F\u8F2A\u63DB\u767C\u9001</span>
                </div>
              </div>
            </div>
            
            <!-- \u76EE\u6A19\u7528\u6236\u9810\u89BD -->
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">
                \u{1F465} \u767C\u9001\u76EE\u6A19\uFF08{{ targets().length }} \u4EBA\uFF09
              </label>
              <div class="max-h-32 overflow-y-auto p-3 bg-slate-800/30 rounded-xl border border-slate-700/50">
                <div class="flex flex-wrap gap-2">
                  @for (target of targets().slice(0, 20); track $index) {
                    <span class="px-2 py-1 bg-slate-700 text-slate-300 rounded text-xs">
                      {{ target.displayName || target.firstName || target.username || target.telegramId }}
                    </span>
                  }
                  @if (targets().length > 20) {
                    <span class="px-2 py-1 text-slate-400 text-xs">
                      +{{ targets().length - 20 }} \u66F4\u591A...
                    </span>
                  }
                </div>
              </div>
            </div>
            
          </div>
          
          <!-- \u767C\u9001\u9032\u5EA6 -->
          @if (isSending()) {
            <div class="p-4 bg-slate-800/50 border-t border-slate-700/50">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-white">\u767C\u9001\u9032\u5EA6</span>
                <span class="text-sm text-slate-400">{{ sentCount() }} / {{ targets().length }}</span>
              </div>
              <div class="w-full h-2 bg-slate-700 rounded-full overflow-hidden">
                <div 
                  class="h-full bg-gradient-to-r from-blue-500 to-cyan-500 transition-all duration-300"
                  [style.width.%]="progressPercent()">
                </div>
              </div>
              <div class="mt-2 flex items-center gap-4 text-xs text-slate-400">
                <span>\u2705 \u6210\u529F: {{ successCount() }}</span>
                <span>\u274C \u5931\u6557: {{ failedCount() }}</span>
                <span>\u23F3 \u9810\u8A08\u5269\u9918: {{ estimatedRemaining() }}</span>
              </div>
              @if (currentTarget()) {
                <div class="mt-2 text-xs text-cyan-400">
                  \u{1F4E8} \u6B63\u5728\u767C\u9001\u7D66: {{ currentTarget() }}
                </div>
              }
              <!-- \u5931\u6557\u539F\u56E0\u7D71\u8A08 -->
              @if (failedCount() > 0 && failureReasonsList().length > 0) {
                <div class="mt-3 p-2 bg-red-500/10 border border-red-500/20 rounded-lg">
                  <div class="text-xs text-red-400 font-medium mb-1">\u5931\u6557\u539F\u56E0\uFF1A</div>
                  <div class="flex flex-wrap gap-2">
                    @for (reason of failureReasonsList(); track $index) {
                      <span class="text-xs px-2 py-0.5 bg-red-500/20 text-red-300 rounded">
                        {{ reason.label }}: {{ reason.count }}
                      </span>
                    }
                  </div>
                </div>
              }
            </div>
          }
          
          <!-- \u5E95\u90E8\u6309\u9215 - \u56FA\u5B9A\u5728\u5E95\u90E8\uFF0C\u4F7F\u7528\u66F4\u9AD8\u7684z-index\u78BA\u4FDD\u53EF\u898B -->
          <div class="sticky bottom-0 left-0 right-0 p-4 border-t border-slate-700/50 bg-slate-900 flex gap-3 z-10 shadow-[0_-4px_12px_rgba(0,0,0,0.3)]">
            <button 
              (click)="close()"
              [disabled]="isSending()"
              class="px-4 py-3 bg-slate-700 text-slate-300 rounded-xl hover:bg-slate-600 transition-colors disabled:opacity-50">
              {{ isSending() ? '\u23F3 \u9032\u884C\u4E2D' : '\u53D6\u6D88' }}
            </button>
            <button 
              (click)="previewMessage()"
              [disabled]="!canSend() || isSending()"
              class="px-4 py-3 bg-slate-700 text-white rounded-xl hover:bg-slate-600 transition-colors disabled:opacity-50">
              \u{1F441}\uFE0F \u9810\u89BD
            </button>
            <button 
              (click)="startSending()"
              [disabled]="!canSend() || isSending()"
              class="flex-1 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-bold rounded-xl hover:opacity-90 transition-opacity disabled:opacity-50 flex items-center justify-center gap-2 text-base shadow-lg shadow-blue-500/20">
              @if (isSending()) {
                <span class="animate-spin">\u23F3</span> \u767C\u9001\u4E2D...
              } @else {
                \u{1F4E8} \u958B\u59CB\u767C\u9001 ({{ targets().length }} \u4EBA)
              }
            </button>
          </div>
          
        </div>
      </div>
    }
    
    <!-- \u9810\u89BD\u5C0D\u8A71\u6846 -->
    @if (showPreview()) {
      <div class="fixed inset-0 bg-black/80 flex items-center justify-center z-[60] p-4">
        <div class="bg-slate-900 rounded-xl p-6 max-w-md w-full border border-slate-700">
          <h3 class="text-lg font-bold text-white mb-4">\u{1F4F1} \u6D88\u606F\u9810\u89BD</h3>
          <div class="p-4 bg-slate-800 rounded-lg text-white whitespace-pre-wrap">
            {{ previewText() }}
          </div>
          @if (attachments().length > 0) {
            <div class="mt-3 text-sm text-slate-400">
              \u{1F4CE} \u5305\u542B {{ attachments().length }} \u500B\u9644\u4EF6
            </div>
          }
          <button 
            (click)="showPreview.set(false)"
            class="mt-4 w-full py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors">
            \u95DC\u9589
          </button>
        </div>
      </div>
    }
  `
    }]
  }], null, { isOpen: [{ type: Input, args: [{ isSignal: true, alias: "isOpen", required: false }] }], targets: [{ type: Input, args: [{ isSignal: true, alias: "targets", required: false }] }], closeDialog: [{ type: Output, args: ["closeDialog"] }], sendComplete: [{ type: Output, args: ["sendComplete"] }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(BatchSendDialogComponent, { className: "BatchSendDialogComponent", filePath: "src/dialogs/batch-send-dialog.component.ts", lineNumber: 536 });
})();

// src/dialogs/batch-invite-dialog.component.ts
var _forTrack010 = ($index, $item) => $item.telegramId;
var _forTrack13 = ($index, $item) => $item.id;
var _forTrack22 = ($index, $item) => $item.key;
function BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 42);
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(1, "svg", 45);
    \u0275\u0275element(2, "circle", 46)(3, "path", 47);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(4, "span", 48);
    \u0275\u0275text(5, "\u8F09\u5165\u7FA4\u7D44\u5217\u8868...");
    \u0275\u0275elementEnd()();
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 43)(1, "p", 49);
    \u0275\u0275text(2, "\u{1F605} \u6C92\u6709\u53EF\u7528\u7684\u7FA4\u7D44");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 50);
    \u0275\u0275text(4, "\u8ACB\u78BA\u4FDD\u5E33\u865F\u5DF2\u52A0\u5165\u7FA4\u7D44\u4E26\u4E14\u64C1\u6709\u9080\u8ACB\u6B0A\u9650");
    \u0275\u0275elementEnd()();
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_5_For_2_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 57);
    \u0275\u0275text(1, "\u7BA1\u7406\u54E1");
    \u0275\u0275elementEnd();
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_5_For_2_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 58);
    \u0275\u0275text(1, "\u6210\u54E1");
    \u0275\u0275elementEnd();
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_5_For_2_Conditional_17_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(0, "svg", 61);
    \u0275\u0275element(1, "path", 62);
    \u0275\u0275elementEnd();
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_5_For_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 52);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_5_For_2_Template_button_click_0_listener() {
      const group_r4 = \u0275\u0275restoreView(_r3).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r1.selectGroup(group_r4));
    });
    \u0275\u0275elementStart(1, "div", 53);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 54)(4, "div", 55)(5, "span", 56);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(7, BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_5_For_2_Conditional_7_Template, 2, 0, "span", 57)(8, BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_5_For_2_Conditional_8_Template, 2, 0, "span", 58);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "div", 59)(10, "span");
    \u0275\u0275text(11);
    \u0275\u0275pipe(12, "number");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "span");
    \u0275\u0275text(14, "\u2022");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "span", 60);
    \u0275\u0275text(16);
    \u0275\u0275elementEnd()()();
    \u0275\u0275conditionalCreate(17, BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_5_For_2_Conditional_17_Template, 2, 0, ":svg:svg", 61);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_13_0;
    let tmp_14_0;
    let tmp_15_0;
    let tmp_16_0;
    let tmp_17_0;
    let tmp_29_0;
    const group_r4 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275classProp("border-emerald-500", ((tmp_13_0 = ctx_r1.selectedGroup()) == null ? null : tmp_13_0.id) === group_r4.id)("bg-emerald-500/10", ((tmp_14_0 = ctx_r1.selectedGroup()) == null ? null : tmp_14_0.id) === group_r4.id)("border-slate-600", ((tmp_15_0 = ctx_r1.selectedGroup()) == null ? null : tmp_15_0.id) !== group_r4.id)("bg-slate-800/50", ((tmp_16_0 = ctx_r1.selectedGroup()) == null ? null : tmp_16_0.id) !== group_r4.id)("hover:border-slate-500", ((tmp_17_0 = ctx_r1.selectedGroup()) == null ? null : tmp_17_0.id) !== group_r4.id);
    \u0275\u0275advance();
    \u0275\u0275classProp("from-blue-500", group_r4.type === "group")("to-cyan-500", group_r4.type === "group")("from-purple-500", group_r4.type === "supergroup")("to-pink-500", group_r4.type === "supergroup")("from-amber-500", group_r4.type === "channel")("to-orange-500", group_r4.type === "channel");
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", group_r4.type === "channel" ? "\u{1F4E2}" : "\u{1F465}", " ");
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(group_r4.name);
    \u0275\u0275advance();
    \u0275\u0275conditional(group_r4.isAdmin ? 7 : 8);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate1("\u{1F464} ", \u0275\u0275pipeBind1(12, 28, group_r4.memberCount), " \u6210\u54E1");
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(group_r4.url);
    \u0275\u0275advance();
    \u0275\u0275conditional(((tmp_29_0 = ctx_r1.selectedGroup()) == null ? null : tmp_29_0.id) === group_r4.id ? 17 : -1);
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 44);
    \u0275\u0275repeaterCreate(1, BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_5_For_2_Template, 18, 30, "button", 51, _forTrack13);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r1.availableGroups());
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_24_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div")(1, "label", 30);
    \u0275\u0275text(2, " \u9078\u64C7\u76EE\u6A19\u7FA4\u7D44 ");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(3, BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_3_Template, 6, 0, "div", 42)(4, BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_4_Template, 5, 0, "div", 43)(5, BatchInviteDialogComponent_Conditional_0_Conditional_24_Conditional_5_Template, 3, 0, "div", 44);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(3);
    \u0275\u0275conditional(ctx_r1.isLoadingGroups() ? 3 : ctx_r1.availableGroups().length === 0 ? 4 : 5);
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div")(1, "span", 64);
    \u0275\u0275text(2, "\u7FA4\u7D44\u540D\u7A31\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "input", 71);
    \u0275\u0275twoWayListener("ngModelChange", function BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_11_Template_input_ngModelChange_3_listener($event) {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(3);
      \u0275\u0275twoWayBindingSet(ctx_r1.newGroupName, $event) || (ctx_r1.newGroupName = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span", 72);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(3);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.newGroupName);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("", ctx_r1.newGroupName.length, "/128");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_For_10_Template(rf, ctx) {
  if (rf & 1) {
    const _r8 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 76);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_For_10_Template_button_click_0_listener() {
      const style_r9 = \u0275\u0275restoreView(_r8).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r1.selectedGroupNameStyle.set(style_r9.key));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const style_r9 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275classProp("bg-purple-500", ctx_r1.selectedGroupNameStyle() === style_r9.key)("text-white", ctx_r1.selectedGroupNameStyle() === style_r9.key)("bg-slate-700", ctx_r1.selectedGroupNameStyle() !== style_r9.key)("text-slate-400", ctx_r1.selectedGroupNameStyle() !== style_r9.key);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", style_r9.label, " ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(0, "svg", 77);
    \u0275\u0275element(1, "circle", 46)(2, "path", 78);
    \u0275\u0275elementEnd();
    \u0275\u0275text(3, " \u751F\u6210\u4E2D... ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_Conditional_13_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u2728 \u751F\u6210\u7FA4\u540D ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_Conditional_14_For_4_Template(rf, ctx) {
  if (rf & 1) {
    const _r10 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 81);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_Conditional_14_For_4_Template_button_click_0_listener() {
      const name_r11 = \u0275\u0275restoreView(_r10).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(5);
      return \u0275\u0275resetView(ctx_r1.selectGeneratedName(name_r11));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const name_r11 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(5);
    \u0275\u0275classProp("border-purple-500", ctx_r1.newGroupName === name_r11)("bg-purple-500/10", ctx_r1.newGroupName === name_r11)("border-slate-600", ctx_r1.newGroupName !== name_r11)("bg-slate-800/50", ctx_r1.newGroupName !== name_r11);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", name_r11, " ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 26)(1, "span", 79);
    \u0275\u0275text(2, "\u9078\u64C7\u4E00\u500B\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275repeaterCreate(3, BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_Conditional_14_For_4_Template, 2, 9, "button", 80, \u0275\u0275repeaterTrackByIndex);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(3);
    \u0275\u0275repeater(ctx_r1.generatedGroupNames());
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 27)(1, "div")(2, "span", 64);
    \u0275\u0275text(3, "\u4E3B\u984C/\u95DC\u9375\u8A5E\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "input", 73);
    \u0275\u0275twoWayListener("ngModelChange", function BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_Template_input_ngModelChange_4_listener($event) {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(3);
      \u0275\u0275twoWayBindingSet(ctx_r1.aiGroupKeywords, $event) || (ctx_r1.aiGroupKeywords = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(5, "div")(6, "span", 64);
    \u0275\u0275text(7, "\u98A8\u683C\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 32);
    \u0275\u0275repeaterCreate(9, BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_For_10_Template, 2, 9, "button", 74, _forTrack22);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(11, "button", 75);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_Template_button_click_11_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.generateGroupNames());
    });
    \u0275\u0275conditionalCreate(12, BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_Conditional_12_Template, 4, 0)(13, BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_Conditional_13_Template, 1, 0);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(14, BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_Conditional_14_Template, 5, 0, "div", 26);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.aiGroupKeywords);
    \u0275\u0275advance(5);
    \u0275\u0275repeater(ctx_r1.groupNameStyles);
    \u0275\u0275advance(2);
    \u0275\u0275property("disabled", ctx_r1.isGeneratingNames() || !ctx_r1.aiGroupKeywords.trim());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isGeneratingNames() ? 12 : 13);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.generatedGroupNames().length > 0 ? 14 : -1);
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_25_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 16)(1, "label", 63);
    \u0275\u0275text(2, "\u{1F4DD} \u65B0\u7FA4\u7D44\u4FE1\u606F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div")(4, "span", 64);
    \u0275\u0275text(5, "\u7FA4\u540D\u751F\u6210\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "div", 14)(7, "button", 25);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Conditional_25_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.groupNameMode.set("manual"));
    });
    \u0275\u0275text(8, " \u270F\uFE0F \u624B\u52D5\u8F38\u5165 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "button", 25);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Conditional_25_Template_button_click_9_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.groupNameMode.set("ai"));
    });
    \u0275\u0275text(10, " \u{1F916} AI \u751F\u6210 ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275conditionalCreate(11, BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_11_Template, 6, 2, "div");
    \u0275\u0275conditionalCreate(12, BatchInviteDialogComponent_Conditional_0_Conditional_25_Conditional_12_Template, 15, 4, "div", 27);
    \u0275\u0275elementStart(13, "div")(14, "span", 64);
    \u0275\u0275text(15, "\u7FA4\u7D44\u985E\u578B\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "div", 65)(17, "label", 66)(18, "input", 67);
    \u0275\u0275twoWayListener("ngModelChange", function BatchInviteDialogComponent_Conditional_0_Conditional_25_Template_input_ngModelChange_18_listener($event) {
      \u0275\u0275restoreView(_r5);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.newGroupType, $event) || (ctx_r1.newGroupType = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(19, "span", 68);
    \u0275\u0275text(20, "\u666E\u901A\u7FA4\u7D44 (\u6700\u591A 200 \u4EBA)");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(21, "label", 66)(22, "input", 69);
    \u0275\u0275twoWayListener("ngModelChange", function BatchInviteDialogComponent_Conditional_0_Conditional_25_Template_input_ngModelChange_22_listener($event) {
      \u0275\u0275restoreView(_r5);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.newGroupType, $event) || (ctx_r1.newGroupType = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(23, "span", 68);
    \u0275\u0275text(24, "\u8D85\u7D1A\u7FA4\u7D44 (\u6700\u591A 20 \u842C\u4EBA)");
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(25, "div")(26, "span", 64);
    \u0275\u0275text(27, "\u7FA4\u7D44\u63CF\u8FF0\uFF08\u53EF\u9078\uFF09\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(28, "textarea", 70);
    \u0275\u0275twoWayListener("ngModelChange", function BatchInviteDialogComponent_Conditional_0_Conditional_25_Template_textarea_ngModelChange_28_listener($event) {
      \u0275\u0275restoreView(_r5);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.newGroupDescription, $event) || (ctx_r1.newGroupDescription = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275text(29, "                  ");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(7);
    \u0275\u0275classProp("bg-cyan-500", ctx_r1.groupNameMode() === "manual")("text-white", ctx_r1.groupNameMode() === "manual")("bg-slate-700", ctx_r1.groupNameMode() !== "manual")("text-slate-400", ctx_r1.groupNameMode() !== "manual");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("bg-purple-500", ctx_r1.groupNameMode() === "ai")("text-white", ctx_r1.groupNameMode() === "ai")("bg-slate-700", ctx_r1.groupNameMode() !== "ai")("text-slate-400", ctx_r1.groupNameMode() !== "ai");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.groupNameMode() === "manual" ? 11 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.groupNameMode() === "ai" ? 12 : -1);
    \u0275\u0275advance(6);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.newGroupType);
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.newGroupType);
    \u0275\u0275advance(6);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.newGroupDescription);
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_55_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 82);
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(1, "svg", 85);
    \u0275\u0275element(2, "circle", 46)(3, "path", 78);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(4, "span", 86);
    \u0275\u0275text(5, "\u8F09\u5165\u6A21\u677F...");
    \u0275\u0275elementEnd()();
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_55_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 83);
    \u0275\u0275text(1, "\u6C92\u6709\u53EF\u7528\u7684\u6A21\u677F");
    \u0275\u0275elementEnd();
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_55_Conditional_3_For_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r12 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 81);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Conditional_55_Conditional_3_For_2_Template_button_click_0_listener() {
      const template_r13 = \u0275\u0275restoreView(_r12).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r1.selectWelcomeTemplate(template_r13));
    });
    \u0275\u0275elementStart(1, "span", 88);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 89);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    let tmp_13_0;
    let tmp_14_0;
    let tmp_15_0;
    let tmp_16_0;
    const template_r13 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275classProp("border-blue-500", ((tmp_13_0 = ctx_r1.selectedWelcomeTemplate()) == null ? null : tmp_13_0.id) === template_r13.id)("bg-blue-500/10", ((tmp_14_0 = ctx_r1.selectedWelcomeTemplate()) == null ? null : tmp_14_0.id) === template_r13.id)("border-slate-600", ((tmp_15_0 = ctx_r1.selectedWelcomeTemplate()) == null ? null : tmp_15_0.id) !== template_r13.id)("bg-slate-800/50", ((tmp_16_0 = ctx_r1.selectedWelcomeTemplate()) == null ? null : tmp_16_0.id) !== template_r13.id);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(template_r13.name);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(template_r13.content);
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_55_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 84);
    \u0275\u0275repeaterCreate(1, BatchInviteDialogComponent_Conditional_0_Conditional_55_Conditional_3_For_2_Template, 5, 10, "button", 87, _forTrack13);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r1.welcomeTemplates());
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_55_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 26);
    \u0275\u0275conditionalCreate(1, BatchInviteDialogComponent_Conditional_0_Conditional_55_Conditional_1_Template, 6, 0, "div", 82)(2, BatchInviteDialogComponent_Conditional_0_Conditional_55_Conditional_2_Template, 2, 0, "p", 83)(3, BatchInviteDialogComponent_Conditional_0_Conditional_55_Conditional_3_Template, 3, 0, "div", 84);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isLoadingTemplates() ? 1 : ctx_r1.welcomeTemplates().length === 0 ? 2 : 3);
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_56_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(0, "svg", 77);
    \u0275\u0275element(1, "circle", 46)(2, "path", 78);
    \u0275\u0275elementEnd();
    \u0275\u0275text(3, " \u751F\u6210\u4E2D... ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_56_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u2728 \u751F\u6210\u6B61\u8FCE\u6D88\u606F ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_56_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 91)(1, "p", 92);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r1.generatedWelcomeMessage());
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_56_Template(rf, ctx) {
  if (rf & 1) {
    const _r14 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 27)(1, "input", 90);
    \u0275\u0275twoWayListener("ngModelChange", function BatchInviteDialogComponent_Conditional_0_Conditional_56_Template_input_ngModelChange_1_listener($event) {
      \u0275\u0275restoreView(_r14);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.aiWelcomeTopic, $event) || (ctx_r1.aiWelcomeTopic = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "button", 75);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Conditional_56_Template_button_click_2_listener() {
      \u0275\u0275restoreView(_r14);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.generateWelcomeMessage());
    });
    \u0275\u0275conditionalCreate(3, BatchInviteDialogComponent_Conditional_0_Conditional_56_Conditional_3_Template, 4, 0)(4, BatchInviteDialogComponent_Conditional_0_Conditional_56_Conditional_4_Template, 1, 0);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(5, BatchInviteDialogComponent_Conditional_0_Conditional_56_Conditional_5_Template, 3, 1, "div", 91);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.aiWelcomeTopic);
    \u0275\u0275advance();
    \u0275\u0275property("disabled", ctx_r1.isGeneratingWelcome() || !ctx_r1.aiWelcomeTopic.trim());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isGeneratingWelcome() ? 3 : 4);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.generatedWelcomeMessage() ? 5 : -1);
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_57_Template(rf, ctx) {
  if (rf & 1) {
    const _r15 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 28)(1, "span", 64);
    \u0275\u0275text(2, "\u6D88\u606F\u5167\u5BB9\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "textarea", 93);
    \u0275\u0275twoWayListener("ngModelChange", function BatchInviteDialogComponent_Conditional_0_Conditional_57_Template_textarea_ngModelChange_3_listener($event) {
      \u0275\u0275restoreView(_r15);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.welcomeMessageContent, $event) || (ctx_r1.welcomeMessageContent = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275text(4, "                  ");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(3);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.welcomeMessageContent);
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_58_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 98);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("\u26A0\uFE0F \u5DF2\u5728\u7FA4\u5167: ", ctx_r1.permissionCheck().alreadyInGroup, " \u4EBA");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_58_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 99);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("\u274C \u96B1\u79C1\u9650\u5236: ", ctx_r1.permissionCheck().privacyRestricted, " \u4EBA");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_58_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 94)(1, "h4", 95);
    \u0275\u0275text(2, "\u{1F4CA} \u6B0A\u9650\u6AA2\u67E5\u7D50\u679C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 96)(4, "span", 97);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(6, BatchInviteDialogComponent_Conditional_0_Conditional_58_Conditional_6_Template, 2, 1, "span", 98);
    \u0275\u0275conditionalCreate(7, BatchInviteDialogComponent_Conditional_0_Conditional_58_Conditional_7_Template, 2, 1, "span", 99);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275classProp("bg-emerald-500/10", ctx_r1.permissionCheck().canInvite > 0)("border", true)("border-emerald-500/30", ctx_r1.permissionCheck().canInvite > 0)("bg-amber-500/10", ctx_r1.permissionCheck().canInvite === 0)("border-amber-500/30", ctx_r1.permissionCheck().canInvite === 0);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate1("\u2705 \u53EF\u62C9\u5165: ", ctx_r1.permissionCheck().canInvite, " \u4EBA");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.permissionCheck().alreadyInGroup > 0 ? 6 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.permissionCheck().privacyRestricted > 0 ? 7 : -1);
  }
}
function BatchInviteDialogComponent_Conditional_0_For_65_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 33);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const target_r16 = ctx.$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", target_r16.displayName || target_r16.firstName || target_r16.username || target_r16.telegramId, " ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_66_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 34);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" +", ctx_r1.targets().length - 20, " \u66F4\u591A... ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_67_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 35)(1, "div", 100)(2, "span", 92);
    \u0275\u0275text(3, "\u62C9\u7FA4\u9032\u5EA6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span", 8);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div", 101);
    \u0275\u0275element(7, "div", 102);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 103)(9, "span", 104);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "span", 98);
    \u0275\u0275text(12);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "span", 99);
    \u0275\u0275text(14);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "span");
    \u0275\u0275text(16);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(17, "p", 105);
    \u0275\u0275text(18, " \u{1F4A1} \u6210\u529F\u5305\u542B\uFF1A\u76F4\u63A5\u9080\u8ACB + \u5DF2\u767C\u9001\u9080\u8ACB\u93C8\u63A5 ");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate2("", ctx_r1.invitedCount(), " / ", ctx_r1.targets().length);
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("width", ctx_r1.progressPercent(), "%");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("\u2705 \u6210\u529F: ", ctx_r1.successCount());
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u26A0\uFE0F \u8DF3\u904E: ", ctx_r1.skippedCount());
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u274C \u5931\u6557: ", ctx_r1.failedCount());
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u23F3 \u9810\u8A08\u5269\u9918: ", ctx_r1.estimatedRemaining());
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_68_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 36)(1, "div", 106)(2, "span");
    \u0275\u0275text(3, "\u26A0\uFE0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span");
    \u0275\u0275text(5, "\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F\u5F8C\u518D\u9032\u884C\u62C9\u7FA4\u64CD\u4F5C");
    \u0275\u0275elementEnd()()();
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_69_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 37)(1, "div", 107)(2, "span");
    \u0275\u0275text(3, "\u{1F517}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span");
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "span", 108);
    \u0275\u0275text(7, "|");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "span");
    \u0275\u0275text(9);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    let tmp_3_0;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate1("\u53EF\u7528\u5E33\u865F: ", ctx_r1.onlineAccountsCount(), " \u500B\u5728\u7DDA");
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate1("\u5C07\u4F7F\u7528: ", ((tmp_3_0 = ctx_r1.preferredAccount()) == null ? null : tmp_3_0.firstName) || ((tmp_3_0 = ctx_r1.preferredAccount()) == null ? null : tmp_3_0.phone) || "\u81EA\u52D5\u9078\u64C7");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_70_Conditional_5_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u2192 \u767C\u9001\u6B61\u8FCE\u6D88\u606F ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_70_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275conditionalCreate(1, BatchInviteDialogComponent_Conditional_0_Conditional_70_Conditional_5_Conditional_1_Template, 1, 0);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275textInterpolate2(" \u5275\u5EFA\u7FA4\u7D44\u300C", ctx_r1.newGroupName, "\u300D\u2192 \u62C9\u5165 ", ctx_r1.targets().length, " \u4EBA ");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.welcomeMessageSource() !== "none" ? 1 : -1);
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_70_Conditional_6_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u2192 \u767C\u9001\u6B61\u8FCE\u6D88\u606F ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_70_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275conditionalCreate(1, BatchInviteDialogComponent_Conditional_0_Conditional_70_Conditional_6_Conditional_1_Template, 1, 0);
  }
  if (rf & 2) {
    let tmp_3_0;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275textInterpolate2(" \u62C9\u5165\u7FA4\u7D44\u300C", (tmp_3_0 = ctx_r1.selectedGroup()) == null ? null : tmp_3_0.name, "\u300D\u2192 ", ctx_r1.targets().length, " \u4EBA ");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.welcomeMessageSource() !== "none" ? 1 : -1);
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_70_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 38)(1, "div", 109)(2, "span");
    \u0275\u0275text(3, "\u{1F4CB}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span");
    \u0275\u0275conditionalCreate(5, BatchInviteDialogComponent_Conditional_0_Conditional_70_Conditional_5_Template, 2, 3)(6, BatchInviteDialogComponent_Conditional_0_Conditional_70_Conditional_6_Template, 2, 3);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(5);
    \u0275\u0275conditional(ctx_r1.groupSource() === "create" ? 5 : 6);
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_75_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 110);
    \u0275\u0275text(1, "\u23F3");
    \u0275\u0275elementEnd();
    \u0275\u0275text(2);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", ctx_r1.createGroupProgressMessage() || "\u5275\u5EFA\u7FA4\u7D44\u4E2D...", " ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_76_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 110);
    \u0275\u0275text(1, "\u23F3");
    \u0275\u0275elementEnd();
    \u0275\u0275text(2, " \u62C9\u7FA4\u4E2D... ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_77_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275textInterpolate1(" \u{1F680} \u5275\u5EFA\u4E26\u62C9\u4EBA (", ctx_r1.targets().length, " \u4EBA) ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Conditional_78_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275textInterpolate1(" \u{1F465} \u958B\u59CB\u62C9\u7FA4 (", ctx_r1.targets().length, " \u4EBA) ");
  }
}
function BatchInviteDialogComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 1);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Template_div_click_0_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.onBackdropClick($event));
    });
    \u0275\u0275elementStart(1, "div", 2)(2, "div", 3)(3, "div", 4)(4, "div", 5)(5, "div", 6);
    \u0275\u0275text(6, " \u{1F465} ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div")(8, "h2", 7);
    \u0275\u0275text(9, "\u6279\u91CF\u62C9\u5165\u7FA4\u7D44");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "p", 8);
    \u0275\u0275text(11);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(12, "button", 9);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Template_button_click_12_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.close());
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(13, "svg", 10);
    \u0275\u0275element(14, "path", 11);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(15, "div", 12)(16, "div")(17, "label", 13);
    \u0275\u0275text(18, " \u{1F3AF} \u7FA4\u7D44\u4F86\u6E90 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(19, "div", 14)(20, "button", 15);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Template_button_click_20_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.setGroupSource("existing"));
    });
    \u0275\u0275text(21, " \u{1F3E0} \u73FE\u6709\u7FA4\u7D44 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(22, "button", 15);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Template_button_click_22_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.setGroupSource("create"));
    });
    \u0275\u0275text(23, " \u2795 \u5275\u5EFA\u65B0\u7FA4 ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275conditionalCreate(24, BatchInviteDialogComponent_Conditional_0_Conditional_24_Template, 6, 1, "div");
    \u0275\u0275conditionalCreate(25, BatchInviteDialogComponent_Conditional_0_Conditional_25_Template, 30, 21, "div", 16);
    \u0275\u0275elementStart(26, "div", 17)(27, "label", 13);
    \u0275\u0275text(28, " \u2699\uFE0F \u62C9\u7FA4\u8A2D\u7F6E ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(29, "div", 18)(30, "div", 5)(31, "span", 19);
    \u0275\u0275text(32, "\u6BCF\u6279\u6B21\u4EBA\u6578\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(33, "input", 20);
    \u0275\u0275twoWayListener("ngModelChange", function BatchInviteDialogComponent_Conditional_0_Template_input_ngModelChange_33_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.batchSize, $event) || (ctx_r1.batchSize = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(34, "span", 8);
    \u0275\u0275text(35, "\u4EBA");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(36, "div", 5)(37, "span", 19);
    \u0275\u0275text(38, "\u6279\u6B21\u9593\u9694\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(39, "input", 21);
    \u0275\u0275twoWayListener("ngModelChange", function BatchInviteDialogComponent_Conditional_0_Template_input_ngModelChange_39_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.minInterval, $event) || (ctx_r1.minInterval = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(40, "span", 22);
    \u0275\u0275text(41, "-");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(42, "input", 23);
    \u0275\u0275twoWayListener("ngModelChange", function BatchInviteDialogComponent_Conditional_0_Template_input_ngModelChange_42_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.maxInterval, $event) || (ctx_r1.maxInterval = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(43, "span", 8);
    \u0275\u0275text(44, "\u79D2");
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(45, "div", 17)(46, "label", 13);
    \u0275\u0275text(47, " \u{1F4AC} \u6B61\u8FCE\u6D88\u606F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(48, "div", 24)(49, "button", 25);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Template_button_click_49_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.welcomeMessageSource.set("none"));
    });
    \u0275\u0275text(50, " \u274C \u4E0D\u767C\u9001 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(51, "button", 25);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Template_button_click_51_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.welcomeMessageSource.set("template"));
    });
    \u0275\u0275text(52, " \u{1F4C4} \u9078\u6A21\u677F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(53, "button", 25);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Template_button_click_53_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.welcomeMessageSource.set("ai"));
    });
    \u0275\u0275text(54, " \u{1F916} AI \u751F\u6210 ");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(55, BatchInviteDialogComponent_Conditional_0_Conditional_55_Template, 4, 1, "div", 26);
    \u0275\u0275conditionalCreate(56, BatchInviteDialogComponent_Conditional_0_Conditional_56_Template, 6, 4, "div", 27);
    \u0275\u0275conditionalCreate(57, BatchInviteDialogComponent_Conditional_0_Conditional_57_Template, 5, 1, "div", 28);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(58, BatchInviteDialogComponent_Conditional_0_Conditional_58_Template, 8, 13, "div", 29);
    \u0275\u0275elementStart(59, "div")(60, "label", 30);
    \u0275\u0275text(61);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(62, "div", 31)(63, "div", 32);
    \u0275\u0275repeaterCreate(64, BatchInviteDialogComponent_Conditional_0_For_65_Template, 2, 1, "span", 33, _forTrack010);
    \u0275\u0275conditionalCreate(66, BatchInviteDialogComponent_Conditional_0_Conditional_66_Template, 2, 1, "span", 34);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275conditionalCreate(67, BatchInviteDialogComponent_Conditional_0_Conditional_67_Template, 19, 8, "div", 35);
    \u0275\u0275conditionalCreate(68, BatchInviteDialogComponent_Conditional_0_Conditional_68_Template, 6, 0, "div", 36)(69, BatchInviteDialogComponent_Conditional_0_Conditional_69_Template, 10, 2, "div", 37);
    \u0275\u0275conditionalCreate(70, BatchInviteDialogComponent_Conditional_0_Conditional_70_Template, 7, 1, "div", 38);
    \u0275\u0275elementStart(71, "div", 39)(72, "button", 40);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Template_button_click_72_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.close());
    });
    \u0275\u0275text(73);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(74, "button", 41);
    \u0275\u0275listener("click", function BatchInviteDialogComponent_Conditional_0_Template_button_click_74_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.startInviting());
    });
    \u0275\u0275conditionalCreate(75, BatchInviteDialogComponent_Conditional_0_Conditional_75_Template, 3, 1)(76, BatchInviteDialogComponent_Conditional_0_Conditional_76_Template, 3, 0)(77, BatchInviteDialogComponent_Conditional_0_Conditional_77_Template, 1, 1)(78, BatchInviteDialogComponent_Conditional_0_Conditional_78_Template, 1, 1);
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(11);
    \u0275\u0275textInterpolate1("\u5C07 ", ctx_r1.targets().length, " \u500B\u7528\u6236\u62C9\u5165\u7FA4\u7D44");
    \u0275\u0275advance(9);
    \u0275\u0275classProp("border-emerald-500", ctx_r1.groupSource() === "existing")("bg-emerald-500/20", ctx_r1.groupSource() === "existing")("text-emerald-400", ctx_r1.groupSource() === "existing")("border-slate-600", ctx_r1.groupSource() !== "existing")("bg-slate-800/50", ctx_r1.groupSource() !== "existing")("text-slate-400", ctx_r1.groupSource() !== "existing");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("border-cyan-500", ctx_r1.groupSource() === "create")("bg-cyan-500/20", ctx_r1.groupSource() === "create")("text-cyan-400", ctx_r1.groupSource() === "create")("border-slate-600", ctx_r1.groupSource() !== "create")("bg-slate-800/50", ctx_r1.groupSource() !== "create")("text-slate-400", ctx_r1.groupSource() !== "create");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.groupSource() === "existing" ? 24 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.groupSource() === "create" ? 25 : -1);
    \u0275\u0275advance(8);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.batchSize);
    \u0275\u0275advance(6);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.minInterval);
    \u0275\u0275advance(3);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.maxInterval);
    \u0275\u0275advance(7);
    \u0275\u0275classProp("bg-slate-600", ctx_r1.welcomeMessageSource() === "none")("text-white", ctx_r1.welcomeMessageSource() === "none")("bg-slate-700", ctx_r1.welcomeMessageSource() !== "none")("text-slate-400", ctx_r1.welcomeMessageSource() !== "none");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("bg-blue-500", ctx_r1.welcomeMessageSource() === "template")("text-white", ctx_r1.welcomeMessageSource() === "template")("bg-slate-700", ctx_r1.welcomeMessageSource() !== "template")("text-slate-400", ctx_r1.welcomeMessageSource() !== "template");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("bg-purple-500", ctx_r1.welcomeMessageSource() === "ai")("text-white", ctx_r1.welcomeMessageSource() === "ai")("bg-slate-700", ctx_r1.welcomeMessageSource() !== "ai")("text-slate-400", ctx_r1.welcomeMessageSource() !== "ai");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.welcomeMessageSource() === "template" ? 55 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.welcomeMessageSource() === "ai" ? 56 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.welcomeMessageSource() !== "none" ? 57 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.selectedGroup() ? 58 : -1);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" \u{1F465} \u76EE\u6A19\u7528\u6236\uFF08", ctx_r1.targets().length, " \u4EBA\uFF09 ");
    \u0275\u0275advance(3);
    \u0275\u0275repeater(ctx_r1.targets().slice(0, 20));
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.targets().length > 20 ? 66 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isInviting() ? 67 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.onlineAccountsCount() === 0 ? 68 : 69);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.canInvite() ? 70 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275property("disabled", ctx_r1.isInviting() || ctx_r1.isCreatingGroup());
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.isInviting() || ctx_r1.isCreatingGroup() ? "\u23F3 \u9032\u884C\u4E2D" : "\u53D6\u6D88", " ");
    \u0275\u0275advance();
    \u0275\u0275property("disabled", !ctx_r1.canInvite() || ctx_r1.isInviting() || ctx_r1.isCreatingGroup());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isCreatingGroup() ? 75 : ctx_r1.isInviting() ? 76 : ctx_r1.groupSource() === "create" ? 77 : 78);
  }
}
var BatchInviteDialogComponent = class _BatchInviteDialogComponent {
  constructor() {
    this.ipc = inject(ElectronIpcService);
    this.toast = inject(ToastService);
    this.isOpen = input(false, ...ngDevMode ? [{ debugName: "isOpen" }] : []);
    this.targets = input([], ...ngDevMode ? [{ debugName: "targets" }] : []);
    this.accounts = input([], ...ngDevMode ? [{ debugName: "accounts" }] : []);
    this.closeDialog = output();
    this.inviteComplete = output();
    this._currentInviteId = signal(null, ...ngDevMode ? [{ debugName: "_currentInviteId" }] : []);
    this.groupSource = signal("existing", ...ngDevMode ? [{ debugName: "groupSource" }] : []);
    this.availableGroups = signal([], ...ngDevMode ? [{ debugName: "availableGroups" }] : []);
    this.isLoadingGroups = signal(false, ...ngDevMode ? [{ debugName: "isLoadingGroups" }] : []);
    this.selectedGroup = signal(null, ...ngDevMode ? [{ debugName: "selectedGroup" }] : []);
    this.groupNameMode = signal("manual", ...ngDevMode ? [{ debugName: "groupNameMode" }] : []);
    this.newGroupName = "";
    this.newGroupType = "supergroup";
    this.newGroupDescription = "";
    this.aiGroupKeywords = "";
    this.selectedGroupNameStyle = signal("professional", ...ngDevMode ? [{ debugName: "selectedGroupNameStyle" }] : []);
    this.isGeneratingNames = signal(false, ...ngDevMode ? [{ debugName: "isGeneratingNames" }] : []);
    this.generatedGroupNames = signal([], ...ngDevMode ? [{ debugName: "generatedGroupNames" }] : []);
    this.groupNameStyles = [
      { key: "professional", label: "\u5C08\u696D\u6B63\u5F0F" },
      { key: "lively", label: "\u6D3B\u6F51\u6709\u8DA3" },
      { key: "mysterious", label: "\u795E\u79D8\u9AD8\u7AEF" },
      { key: "simple", label: "\u7C21\u7D04\u660E\u4E86" }
    ];
    this.welcomeMessageSource = signal("none", ...ngDevMode ? [{ debugName: "welcomeMessageSource" }] : []);
    this.welcomeTemplates = signal([], ...ngDevMode ? [{ debugName: "welcomeTemplates" }] : []);
    this.isLoadingTemplates = signal(false, ...ngDevMode ? [{ debugName: "isLoadingTemplates" }] : []);
    this.selectedWelcomeTemplate = signal(null, ...ngDevMode ? [{ debugName: "selectedWelcomeTemplate" }] : []);
    this.welcomeMessageContent = "";
    this.aiWelcomeTopic = "";
    this.isGeneratingWelcome = signal(false, ...ngDevMode ? [{ debugName: "isGeneratingWelcome" }] : []);
    this.generatedWelcomeMessage = signal("", ...ngDevMode ? [{ debugName: "generatedWelcomeMessage" }] : []);
    this.batchSize = 10;
    this.minInterval = 60;
    this.maxInterval = 120;
    this.isInviting = signal(false, ...ngDevMode ? [{ debugName: "isInviting" }] : []);
    this.invitedCount = signal(0, ...ngDevMode ? [{ debugName: "invitedCount" }] : []);
    this.successCount = signal(0, ...ngDevMode ? [{ debugName: "successCount" }] : []);
    this.failedCount = signal(0, ...ngDevMode ? [{ debugName: "failedCount" }] : []);
    this.skippedCount = signal(0, ...ngDevMode ? [{ debugName: "skippedCount" }] : []);
    this.isCreatingGroup = signal(false, ...ngDevMode ? [{ debugName: "isCreatingGroup" }] : []);
    this.createdGroupId = signal(null, ...ngDevMode ? [{ debugName: "createdGroupId" }] : []);
    this.createGroupProgressMessage = signal("", ...ngDevMode ? [{ debugName: "createGroupProgressMessage" }] : []);
    this.listeners = [];
    this.progressPercent = computed(() => {
      const total = this.targets().length;
      return total > 0 ? this.invitedCount() / total * 100 : 0;
    }, ...ngDevMode ? [{ debugName: "progressPercent" }] : []);
    this.estimatedRemaining = computed(() => {
      const remaining = this.targets().length - this.invitedCount();
      const avgInterval = (this.minInterval + this.maxInterval) / 2;
      const batches = Math.ceil(remaining / this.batchSize);
      const seconds = batches * avgInterval;
      if (seconds < 60)
        return `${Math.round(seconds)} \u79D2`;
      if (seconds < 3600)
        return `${Math.round(seconds / 60)} \u5206\u9418`;
      return `${Math.round(seconds / 3600)} \u5C0F\u6642`;
    }, ...ngDevMode ? [{ debugName: "estimatedRemaining" }] : []);
    this.permissionCheck = computed(() => {
      const total = this.targets().length;
      return {
        canInvite: Math.floor(total * 0.8),
        alreadyInGroup: Math.floor(total * 0.1),
        privacyRestricted: Math.floor(total * 0.1)
      };
    }, ...ngDevMode ? [{ debugName: "permissionCheck" }] : []);
    this.onlineAccountsCount = computed(() => {
      return this.accounts().filter((a) => a.status === "Online").length;
    }, ...ngDevMode ? [{ debugName: "onlineAccountsCount" }] : []);
    this.preferredAccount = computed(() => {
      const online = this.accounts().filter((a) => a.status === "Online");
      const sender = online.find((a) => a.role === "Sender");
      return sender || online[0] || null;
    }, ...ngDevMode ? [{ debugName: "preferredAccount" }] : []);
    this.createGroupTimeout = null;
  }
  ngOnInit() {
    this.setupIpcListeners();
    this.loadAvailableGroups();
    this.loadWelcomeTemplates();
  }
  ngOnDestroy() {
    this.listeners.forEach((cleanup) => cleanup());
  }
  setupIpcListeners() {
    const cleanup1 = this.ipc.on("batch-invite:progress", (data) => {
      this.invitedCount.set(data.invited);
      this.successCount.set(data.success);
      this.failedCount.set(data.failed);
      this.skippedCount.set(data.skipped);
    });
    this.listeners.push(cleanup1);
    const cleanup2 = this.ipc.on("batch-invite:complete", (data) => {
      const currentInviteId = this._currentInviteId();
      if (data.inviteId && currentInviteId && data.inviteId !== currentInviteId) {
        console.log("[BatchInvite] \u5FFD\u7565\u5B8C\u6210\u4E8B\u4EF6\uFF08inviteId \u4E0D\u5339\u914D\uFF09:", data.inviteId, "!=", currentInviteId);
        return;
      }
      if (!this.isOpen() && !this.isInviting() && !currentInviteId) {
        console.log("[BatchInvite] \u5FFD\u7565\u5B8C\u6210\u4E8B\u4EF6\uFF08\u5C0D\u8A71\u6846\u672A\u6253\u958B\u4E14\u7121\u6D3B\u8E8D\u9080\u8ACB\uFF09");
        return;
      }
      this._currentInviteId.set(null);
      this.isInviting.set(false);
      this.isCreatingGroup.set(false);
      this.inviteComplete.emit({
        success: data.success,
        failed: data.failed,
        skipped: data.skipped
      });
      if (data.success > 0) {
        this.toast.success(`\u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u2705 \u6210\u529F/\u5DF2\u767C\u9001\u9080\u8ACB ${data.success} \u4EBA\uFF0C\u26A0\uFE0F \u8DF3\u904E ${data.skipped}\uFF0C\u274C \u5931\u6557 ${data.failed}`);
      } else if (data.skipped > 0) {
        this.toast.warning(`\u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u6240\u6709\u7528\u6236\u5DF2\u5728\u7FA4\u5167\u6216\u96B1\u79C1\u9650\u5236`);
      } else {
        this.toast.error(`\u6279\u91CF\u62C9\u7FA4\u5931\u6557\uFF1A\u7121\u6CD5\u9080\u8ACB\u4EFB\u4F55\u7528\u6236\uFF0C\u8ACB\u6AA2\u67E5\u5E33\u865F\u72C0\u614B`);
      }
    });
    this.listeners.push(cleanup2);
    const cleanup3 = this.ipc.on("get-admin-groups-result", (data) => {
      this.isLoadingGroups.set(false);
      if (data.groups) {
        this.availableGroups.set(data.groups);
      }
    });
    this.listeners.push(cleanup3);
    const cleanup4 = this.ipc.on("get-chat-templates-result", (data) => {
      this.isLoadingTemplates.set(false);
      if (data.templates) {
        this.welcomeTemplates.set(data.templates.filter((t) => t.isEnabled));
      }
    });
    this.listeners.push(cleanup4);
    const cleanup5 = this.ipc.on("ai-generate-group-names-result", (data) => {
      this.isGeneratingNames.set(false);
      if (data.success && data.names) {
        this.generatedGroupNames.set(data.names);
        this.toast.success("\u7FA4\u540D\u751F\u6210\u6210\u529F\uFF01");
      } else {
        this.toast.error(data.error || "AI \u751F\u6210\u5931\u6557");
      }
    });
    this.listeners.push(cleanup5);
    const cleanup6 = this.ipc.on("ai-generate-welcome-result", (data) => {
      this.isGeneratingWelcome.set(false);
      if (data.success && data.message) {
        this.generatedWelcomeMessage.set(data.message);
        this.welcomeMessageContent = data.message;
        this.toast.success("\u6B61\u8FCE\u6D88\u606F\u751F\u6210\u6210\u529F\uFF01");
      } else {
        this.toast.error(data.error || "AI \u751F\u6210\u5931\u6557");
      }
    });
    this.listeners.push(cleanup6);
    const cleanup6b = this.ipc.on("create-group-progress", (data) => {
      console.log("[BatchInvite] \u5275\u5EFA\u9032\u5EA6:", data);
      this.createGroupProgressMessage.set(data.message);
    });
    this.listeners.push(cleanup6b);
    const cleanup7 = this.ipc.on("create-group-result", (data) => {
      console.log("[BatchInvite] \u6536\u5230\u5275\u5EFA\u7FA4\u7D44\u7D50\u679C:", data);
      if (this.createGroupTimeout) {
        clearTimeout(this.createGroupTimeout);
        this.createGroupTimeout = null;
      }
      this.isCreatingGroup.set(false);
      if (data.success && data.groupId) {
        this.createdGroupId.set(data.groupId);
        this.toast.success(`\u7FA4\u7D44\u300C${this.newGroupName}\u300D\u5275\u5EFA\u6210\u529F\uFF01`);
        this.startInvitingToGroup(data.groupId, data.groupUrl || "");
      } else {
        const errorMsg = data.error || "\u5275\u5EFA\u7FA4\u7D44\u5931\u6557";
        if (errorMsg.includes("FLOOD")) {
          this.toast.error("\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66");
        } else if (errorMsg.includes("not connected") || errorMsg.includes("Offline")) {
          this.toast.error("\u5E33\u865F\u672A\u9023\u63A5\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F");
        } else if (errorMsg.includes("PEER_FLOOD")) {
          this.toast.error("\u5E33\u865F\u88AB\u9650\u5236\uFF0C\u8ACB\u66F4\u63DB\u5E33\u865F\u6216\u7A0D\u5F8C\u518D\u8A66");
        } else {
          this.toast.error(errorMsg);
        }
      }
    });
    this.listeners.push(cleanup7);
  }
  // 設置群組來源
  setGroupSource(source) {
    this.groupSource.set(source);
    if (source === "existing") {
      this.loadAvailableGroups();
    }
  }
  loadAvailableGroups() {
    this.isLoadingGroups.set(true);
    this.ipc.send("get-admin-groups", {});
  }
  loadWelcomeTemplates() {
    this.isLoadingTemplates.set(true);
    this.ipc.send("get-chat-templates", {});
  }
  selectGroup(group) {
    this.selectedGroup.set(group);
  }
  // 選擇生成的群名
  selectGeneratedName(name) {
    this.newGroupName = name;
  }
  // 生成群名
  generateGroupNames() {
    if (!this.aiGroupKeywords.trim()) {
      this.toast.warning("\u8ACB\u8F38\u5165\u4E3B\u984C\u95DC\u9375\u8A5E");
      return;
    }
    this.isGeneratingNames.set(true);
    this.generatedGroupNames.set([]);
    this.ipc.send("ai-generate-group-names", {
      keywords: this.aiGroupKeywords,
      style: this.selectedGroupNameStyle(),
      count: 5
    });
  }
  // 選擇歡迎模板
  selectWelcomeTemplate(template) {
    this.selectedWelcomeTemplate.set(template);
    this.welcomeMessageContent = template.content;
  }
  // 生成歡迎消息
  generateWelcomeMessage() {
    if (!this.aiWelcomeTopic.trim()) {
      this.toast.warning("\u8ACB\u8F38\u5165\u6D88\u606F\u4E3B\u984C");
      return;
    }
    this.isGeneratingWelcome.set(true);
    this.generatedWelcomeMessage.set("");
    this.ipc.send("ai-generate-welcome", {
      topic: this.aiWelcomeTopic,
      groupName: this.newGroupName || this.selectedGroup()?.name || ""
    });
  }
  canInvite() {
    if (this.groupSource() === "existing") {
      return this.selectedGroup() !== null && this.targets().length > 0;
    } else {
      return this.newGroupName.trim().length > 0 && this.targets().length > 0;
    }
  }
  startInviting() {
    if (!this.canInvite())
      return;
    if (this.groupSource() === "create") {
      this.createGroupAndInvite();
    } else {
      this.startInvitingToGroup(this.selectedGroup().id, this.selectedGroup().url);
    }
  }
  // 創建群組然後拉人
  async createGroupAndInvite() {
    const onlineAccounts = await this.checkOnlineAccounts();
    if (onlineAccounts.length === 0) {
      this.toast.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F");
      return;
    }
    this.isCreatingGroup.set(true);
    this.createGroupProgressMessage.set("\u6B63\u5728\u6E96\u5099\u5275\u5EFA\u7FA4\u7D44...");
    if (this.createGroupTimeout) {
      clearTimeout(this.createGroupTimeout);
    }
    this.createGroupTimeout = setTimeout(() => {
      if (this.isCreatingGroup()) {
        this.isCreatingGroup.set(false);
        this.toast.error("\u5275\u5EFA\u7FA4\u7D44\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u7D61\u9023\u63A5\u6216\u5E33\u865F\u72C0\u614B\uFF0C\u6216\u5617\u8A66\u5275\u5EFA\u666E\u901A\u7FA4\u7D44");
      }
    }, 6e4);
    console.log("[BatchInvite] \u958B\u59CB\u5275\u5EFA\u7FA4\u7D44:", {
      name: this.newGroupName,
      type: this.newGroupType,
      account: onlineAccounts[0]?.phone
    });
    this.ipc.send("create-group", {
      name: this.newGroupName,
      description: this.newGroupDescription,
      type: this.newGroupType,
      accountPhone: onlineAccounts[0]?.phone
      // 指定使用哪個帳號創建
    });
    this.toast.info(`\u6B63\u5728\u4F7F\u7528\u5E33\u865F ${onlineAccounts[0]?.firstName || onlineAccounts[0]?.phone} \u5275\u5EFA\u7FA4\u7D44...`);
  }
  // 檢查在線帳號 - 使用從父組件傳入的帳號數據
  async checkOnlineAccounts() {
    const allAccounts = this.accounts();
    const onlineAccounts = allAccounts.filter((a) => a.status === "Online");
    console.log("[BatchInvite] \u6AA2\u67E5\u5E33\u865F: \u7E3D\u6578", allAccounts.length, ", \u5728\u7DDA", onlineAccounts.length);
    if (onlineAccounts.length === 0) {
      this.toast.warning("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F");
    }
    return onlineAccounts;
  }
  // 開始拉人到群組
  startInvitingToGroup(groupId, groupUrl) {
    const inviteId = `batch_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    this._currentInviteId.set(inviteId);
    this.isInviting.set(true);
    this.invitedCount.set(0);
    this.successCount.set(0);
    this.failedCount.set(0);
    this.skippedCount.set(0);
    this.ipc.send("batch-invite:start", {
      inviteId,
      // 🔧 Phase 2: 添加邀請 ID
      groupId,
      groupUrl,
      targets: this.targets().map((t) => ({
        telegramId: t.telegramId,
        username: t.username,
        firstName: t.firstName,
        displayName: t.displayName
      })),
      config: {
        batchSize: this.batchSize,
        minInterval: this.minInterval,
        maxInterval: this.maxInterval,
        sendWelcomeMessage: this.welcomeMessageSource() !== "none",
        welcomeMessage: this.welcomeMessageContent
      }
    });
    this.toast.info("\u958B\u59CB\u6279\u91CF\u62C9\u7FA4...");
    console.log("[BatchInvite] \u958B\u59CB\u9080\u8ACB\uFF0CinviteId:", inviteId);
  }
  close() {
    if (this.isInviting()) {
      if (!confirm("\u62C9\u7FA4\u6B63\u5728\u9032\u884C\u4E2D\uFF0C\u78BA\u5B9A\u8981\u53D6\u6D88\u55CE\uFF1F")) {
        return;
      }
      this.ipc.send("batch-invite:cancel", {});
    }
    this.closeDialog.emit();
  }
  onBackdropClick(event) {
    if (event.target === event.currentTarget && !this.isInviting()) {
      this.close();
    }
  }
  static {
    this.\u0275fac = function BatchInviteDialogComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _BatchInviteDialogComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _BatchInviteDialogComponent, selectors: [["app-batch-invite-dialog"]], inputs: { isOpen: [1, "isOpen"], targets: [1, "targets"], accounts: [1, "accounts"] }, outputs: { closeDialog: "closeDialog", inviteComplete: "inviteComplete" }, decls: 1, vars: 1, consts: [[1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-50", "p-4"], [1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-50", "p-4", 3, "click"], [1, "bg-slate-900", "rounded-2xl", "w-full", "max-w-2xl", "shadow-2xl", "border", "border-slate-700/50", "overflow-hidden", "max-h-[90vh]", "flex", "flex-col"], [1, "p-5", "border-b", "border-slate-700/50", "bg-gradient-to-r", "from-emerald-500/10", "to-cyan-500/10"], [1, "flex", "items-center", "justify-between"], [1, "flex", "items-center", "gap-3"], [1, "w-10", "h-10", "rounded-xl", "bg-gradient-to-br", "from-emerald-500", "to-cyan-500", "flex", "items-center", "justify-center", "text-xl"], [1, "text-lg", "font-bold", "text-white"], [1, "text-sm", "text-slate-400"], [1, "p-2", "hover:bg-slate-800", "rounded-lg", "transition-colors", "text-slate-400", "hover:text-white", 3, "click"], ["fill", "none", "stroke", "currentColor", "viewBox", "0 0 24 24", 1, "w-5", "h-5"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M6 18L18 6M6 6l12 12"], [1, "flex-1", "overflow-y-auto", "p-5", "pb-8", "space-y-5"], [1, "block", "text-sm", "font-medium", "text-slate-300", "mb-3"], [1, "flex", "gap-2"], [1, "flex-1", "py-3", "rounded-xl", "border", "transition-all", "flex", "items-center", "justify-center", "gap-2", 3, "click"], [1, "p-4", "bg-cyan-500/10", "rounded-xl", "border", "border-cyan-500/30", "space-y-4"], [1, "p-4", "bg-slate-800/30", "rounded-xl", "border", "border-slate-700/50"], [1, "space-y-4"], [1, "text-sm", "text-slate-400", "w-24"], ["type", "number", "min", "1", "max", "50", 1, "w-20", "px-3", "py-2", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "text-white", "text-center", "focus:ring-2", "focus:ring-emerald-500", 3, "ngModelChange", "ngModel"], ["type", "number", "min", "30", "max", "300", 1, "w-20", "px-3", "py-2", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "text-white", "text-center", "focus:ring-2", "focus:ring-emerald-500", 3, "ngModelChange", "ngModel"], [1, "text-slate-400"], ["type", "number", "min", "30", "max", "600", 1, "w-20", "px-3", "py-2", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "text-white", "text-center", "focus:ring-2", "focus:ring-emerald-500", 3, "ngModelChange", "ngModel"], [1, "flex", "gap-2", "mb-3"], [1, "flex-1", "py-2", "rounded-lg", "text-sm", "transition-all", 3, "click"], [1, "space-y-2"], [1, "space-y-3"], [1, "mt-3"], [1, "p-4", "rounded-xl", 3, "bg-emerald-500/10", "border", "border-emerald-500/30", "bg-amber-500/10", "border-amber-500/30"], [1, "block", "text-sm", "font-medium", "text-slate-300", "mb-2"], [1, "max-h-32", "overflow-y-auto", "p-3", "bg-slate-800/30", "rounded-xl", "border", "border-slate-700/50"], [1, "flex", "flex-wrap", "gap-2"], [1, "px-2", "py-1", "bg-slate-700", "text-slate-300", "rounded", "text-xs"], [1, "px-2", "py-1", "text-slate-400", "text-xs"], [1, "p-4", "bg-slate-800/50", "border-t", "border-slate-700/50"], [1, "px-5", "py-3", "bg-red-500/10", "border-t", "border-red-500/30"], [1, "px-5", "py-2", "bg-slate-800/30", "border-t", "border-slate-700/50"], [1, "px-5", "py-3", "bg-slate-800/50", "border-t", "border-slate-700/50"], [1, "sticky", "bottom-0", "left-0", "right-0", "p-4", "border-t", "border-slate-700/50", "bg-slate-900", "flex", "gap-3", "z-10", "shadow-[0_-4px_12px_rgba(0,0,0,0.3)]"], [1, "px-4", "py-3", "bg-slate-700", "text-slate-300", "rounded-xl", "hover:bg-slate-600", "transition-colors", "disabled:opacity-50", 3, "click", "disabled"], [1, "flex-1", "py-3", "bg-gradient-to-r", "from-emerald-500", "to-cyan-500", "text-white", "font-bold", "rounded-xl", "hover:opacity-90", "transition-opacity", "disabled:opacity-50", "flex", "items-center", "justify-center", "gap-2", "text-base", "shadow-lg", "shadow-emerald-500/20", 3, "click", "disabled"], [1, "flex", "items-center", "justify-center", "py-8"], [1, "text-center", "py-8", "text-slate-400"], [1, "space-y-2", "max-h-48", "overflow-y-auto", "pr-2"], ["fill", "none", "viewBox", "0 0 24 24", 1, "animate-spin", "h-6", "w-6", "text-cyan-400"], ["cx", "12", "cy", "12", "r", "10", "stroke", "currentColor", "stroke-width", "4", 1, "opacity-25"], ["fill", "currentColor", "d", "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z", 1, "opacity-75"], [1, "ml-2", "text-slate-400"], [1, "text-lg", "mb-2"], [1, "text-sm"], [1, "w-full", "flex", "items-center", "gap-3", "p-3", "rounded-xl", "border", "transition-all", "text-left", 3, "border-emerald-500", "bg-emerald-500/10", "border-slate-600", "bg-slate-800/50", "hover:border-slate-500"], [1, "w-full", "flex", "items-center", "gap-3", "p-3", "rounded-xl", "border", "transition-all", "text-left", 3, "click"], [1, "w-10", "h-10", "rounded-lg", "bg-gradient-to-br", "flex", "items-center", "justify-center", "text-lg"], [1, "flex-1", "min-w-0"], [1, "flex", "items-center", "gap-2"], [1, "font-medium", "text-white", "truncate"], [1, "px-1.5", "py-0.5", "bg-emerald-500/20", "text-emerald-400", "text-xs", "rounded"], [1, "px-1.5", "py-0.5", "bg-slate-600", "text-slate-400", "text-xs", "rounded"], [1, "text-xs", "text-slate-400", "flex", "items-center", "gap-2"], [1, "truncate"], ["fill", "none", "stroke", "currentColor", "viewBox", "0 0 24 24", 1, "w-5", "h-5", "text-emerald-400", "flex-shrink-0"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M5 13l4 4L19 7"], [1, "block", "text-sm", "font-medium", "text-cyan-300"], [1, "text-xs", "text-slate-400", "mb-2", "block"], [1, "flex", "gap-3"], [1, "flex", "items-center", "gap-2", "cursor-pointer"], ["type", "radio", "name", "groupType", "value", "group", 1, "w-4", "h-4", "text-cyan-500", "border-slate-600", "focus:ring-cyan-500", 3, "ngModelChange", "ngModel"], [1, "text-sm", "text-slate-300"], ["type", "radio", "name", "groupType", "value", "supergroup", 1, "w-4", "h-4", "text-cyan-500", "border-slate-600", "focus:ring-cyan-500", 3, "ngModelChange", "ngModel"], ["rows", "2", "placeholder", "\u7C21\u77ED\u4ECB\u7D39\u7FA4\u7D44\u76EE\u7684...", 1, "w-full", "px-3", "py-2", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "text-white", "placeholder-slate-500", "resize-none", "focus:ring-2", "focus:ring-cyan-500", "text-sm", 3, "ngModelChange", "ngModel"], ["type", "text", "placeholder", "\u8F38\u5165\u7FA4\u7D44\u540D\u7A31...", "maxlength", "128", 1, "w-full", "px-3", "py-2", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "text-white", "placeholder-slate-500", "focus:ring-2", "focus:ring-cyan-500", 3, "ngModelChange", "ngModel"], [1, "text-xs", "text-slate-500", "mt-1", "block"], ["type", "text", "placeholder", "\u4F8B\u5982\uFF1A\u5E63\u5708\u3001\u4EA4\u6D41\u3001VIP...", 1, "w-full", "px-3", "py-2", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "text-white", "placeholder-slate-500", "focus:ring-2", "focus:ring-purple-500", 3, "ngModelChange", "ngModel"], [1, "px-3", "py-1", "text-xs", "rounded-lg", "transition-all", 3, "bg-purple-500", "text-white", "bg-slate-700", "text-slate-400"], [1, "w-full", "py-2", "bg-gradient-to-r", "from-purple-500", "to-pink-500", "text-white", "rounded-lg", "hover:opacity-90", "transition-opacity", "disabled:opacity-50", "flex", "items-center", "justify-center", "gap-2", "text-sm", 3, "click", "disabled"], [1, "px-3", "py-1", "text-xs", "rounded-lg", "transition-all", 3, "click"], ["fill", "none", "viewBox", "0 0 24 24", 1, "animate-spin", "h-4", "w-4"], ["fill", "currentColor", "d", "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z", 1, "opacity-75"], [1, "text-xs", "text-slate-400"], [1, "w-full", "p-2", "rounded-lg", "border", "transition-all", "text-left", "text-sm", 3, "border-purple-500", "bg-purple-500/10", "border-slate-600", "bg-slate-800/50"], [1, "w-full", "p-2", "rounded-lg", "border", "transition-all", "text-left", "text-sm", 3, "click"], [1, "flex", "items-center", "justify-center", "py-4"], [1, "text-sm", "text-slate-500", "text-center", "py-4"], [1, "max-h-32", "overflow-y-auto", "space-y-2"], ["fill", "none", "viewBox", "0 0 24 24", 1, "animate-spin", "h-5", "w-5", "text-blue-400"], [1, "ml-2", "text-slate-400", "text-sm"], [1, "w-full", "p-2", "rounded-lg", "border", "transition-all", "text-left", "text-sm", 3, "border-blue-500", "bg-blue-500/10", "border-slate-600", "bg-slate-800/50"], [1, "font-medium", "text-white"], [1, "text-xs", "text-slate-400", "truncate", "mt-1"], ["type", "text", "placeholder", "\u6B61\u8FCE\u6D88\u606F\u4E3B\u984C\uFF0C\u4F8B\u5982\uFF1A\u6B61\u8FCE\u52A0\u5165\u3001\u793E\u7FA4\u4ECB\u7D39...", 1, "w-full", "px-3", "py-2", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "text-white", "text-sm", "placeholder-slate-500", "focus:ring-2", "focus:ring-purple-500", 3, "ngModelChange", "ngModel"], [1, "p-3", "bg-slate-800/50", "rounded-lg", "border", "border-purple-500/30"], [1, "text-sm", "text-white"], ["rows", "2", "placeholder", "\u8F38\u5165\u6B61\u8FCE\u6D88\u606F\u5167\u5BB9...", 1, "w-full", "px-3", "py-2", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "text-white", "placeholder-slate-500", "resize-none", "focus:ring-2", "focus:ring-emerald-500", "text-sm", 3, "ngModelChange", "ngModel"], [1, "p-4", "rounded-xl"], [1, "text-sm", "font-medium", "text-slate-300", "mb-2"], [1, "flex", "items-center", "gap-6", "text-sm"], [1, "text-emerald-400"], [1, "text-amber-400"], [1, "text-red-400"], [1, "flex", "items-center", "justify-between", "mb-2"], [1, "w-full", "h-2", "bg-slate-700", "rounded-full", "overflow-hidden"], [1, "h-full", "bg-gradient-to-r", "from-emerald-500", "to-cyan-500", "transition-all", "duration-300"], [1, "mt-2", "flex", "items-center", "gap-4", "text-xs", "text-slate-400"], [1, "text-green-400"], [1, "mt-1", "text-xs", "text-slate-500"], [1, "flex", "items-center", "gap-2", "text-sm", "text-red-400"], [1, "flex", "items-center", "gap-2", "text-xs", "text-slate-400"], [1, "text-slate-500"], [1, "flex", "items-center", "gap-2", "text-sm", "text-slate-400"], [1, "animate-spin"]], template: function BatchInviteDialogComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, BatchInviteDialogComponent_Conditional_0_Template, 79, 67, "div", 0);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.isOpen() ? 0 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, DefaultValueAccessor, NumberValueAccessor, RadioControlValueAccessor, NgControlStatus, MaxLengthValidator, MinValidator, MaxValidator, NgModel, DecimalPipe], encapsulation: 2 });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(BatchInviteDialogComponent, [{
    type: Component,
    args: [{
      selector: "app-batch-invite-dialog",
      standalone: true,
      imports: [CommonModule, FormsModule],
      template: `
    @if (isOpen()) {
      <div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4"
           (click)="onBackdropClick($event)">
        <div class="bg-slate-900 rounded-2xl w-full max-w-2xl shadow-2xl border border-slate-700/50 overflow-hidden max-h-[90vh] flex flex-col">
          
          <!-- \u982D\u90E8 -->
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-emerald-500/10 to-cyan-500/10">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center text-xl">
                  \u{1F465}
                </div>
                <div>
                  <h2 class="text-lg font-bold text-white">\u6279\u91CF\u62C9\u5165\u7FA4\u7D44</h2>
                  <p class="text-sm text-slate-400">\u5C07 {{ targets().length }} \u500B\u7528\u6236\u62C9\u5165\u7FA4\u7D44</p>
                </div>
              </div>
              <button (click)="close()" class="p-2 hover:bg-slate-800 rounded-lg transition-colors text-slate-400 hover:text-white">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
          </div>
          
          <!-- \u5167\u5BB9 - \u589E\u52A0\u5E95\u90E8 padding \u9632\u6B62\u88AB\u5E95\u90E8\u6309\u9215\u64CB\u4F4F -->
          <div class="flex-1 overflow-y-auto p-5 pb-8 space-y-5">
            
            <!-- \u7FA4\u7D44\u4F86\u6E90\u9078\u64C7 -->
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-3">
                \u{1F3AF} \u7FA4\u7D44\u4F86\u6E90
              </label>
              <div class="flex gap-2">
                <button 
                  (click)="setGroupSource('existing')"
                  class="flex-1 py-3 rounded-xl border transition-all flex items-center justify-center gap-2"
                  [class.border-emerald-500]="groupSource() === 'existing'"
                  [class.bg-emerald-500/20]="groupSource() === 'existing'"
                  [class.text-emerald-400]="groupSource() === 'existing'"
                  [class.border-slate-600]="groupSource() !== 'existing'"
                  [class.bg-slate-800/50]="groupSource() !== 'existing'"
                  [class.text-slate-400]="groupSource() !== 'existing'">
                  \u{1F3E0} \u73FE\u6709\u7FA4\u7D44
                </button>
                <button 
                  (click)="setGroupSource('create')"
                  class="flex-1 py-3 rounded-xl border transition-all flex items-center justify-center gap-2"
                  [class.border-cyan-500]="groupSource() === 'create'"
                  [class.bg-cyan-500/20]="groupSource() === 'create'"
                  [class.text-cyan-400]="groupSource() === 'create'"
                  [class.border-slate-600]="groupSource() !== 'create'"
                  [class.bg-slate-800/50]="groupSource() !== 'create'"
                  [class.text-slate-400]="groupSource() !== 'create'">
                  \u2795 \u5275\u5EFA\u65B0\u7FA4
                </button>
              </div>
            </div>
            
            <!-- \u9078\u64C7\u73FE\u6709\u7FA4\u7D44 -->
            @if (groupSource() === 'existing') {
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">
                  \u9078\u64C7\u76EE\u6A19\u7FA4\u7D44
                </label>
                
                @if (isLoadingGroups()) {
                  <div class="flex items-center justify-center py-8">
                    <svg class="animate-spin h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="ml-2 text-slate-400">\u8F09\u5165\u7FA4\u7D44\u5217\u8868...</span>
                  </div>
                } @else if (availableGroups().length === 0) {
                  <div class="text-center py-8 text-slate-400">
                    <p class="text-lg mb-2">\u{1F605} \u6C92\u6709\u53EF\u7528\u7684\u7FA4\u7D44</p>
                    <p class="text-sm">\u8ACB\u78BA\u4FDD\u5E33\u865F\u5DF2\u52A0\u5165\u7FA4\u7D44\u4E26\u4E14\u64C1\u6709\u9080\u8ACB\u6B0A\u9650</p>
                  </div>
                } @else {
                  <div class="space-y-2 max-h-48 overflow-y-auto pr-2">
                    @for (group of availableGroups(); track group.id) {
                      <button 
                        (click)="selectGroup(group)"
                        class="w-full flex items-center gap-3 p-3 rounded-xl border transition-all text-left"
                        [class.border-emerald-500]="selectedGroup()?.id === group.id"
                        [class.bg-emerald-500/10]="selectedGroup()?.id === group.id"
                        [class.border-slate-600]="selectedGroup()?.id !== group.id"
                        [class.bg-slate-800/50]="selectedGroup()?.id !== group.id"
                        [class.hover:border-slate-500]="selectedGroup()?.id !== group.id">
                        
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br flex items-center justify-center text-lg"
                             [class.from-blue-500]="group.type === 'group'"
                             [class.to-cyan-500]="group.type === 'group'"
                             [class.from-purple-500]="group.type === 'supergroup'"
                             [class.to-pink-500]="group.type === 'supergroup'"
                             [class.from-amber-500]="group.type === 'channel'"
                             [class.to-orange-500]="group.type === 'channel'">
                          {{ group.type === 'channel' ? '\u{1F4E2}' : '\u{1F465}' }}
                        </div>
                        
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center gap-2">
                            <span class="font-medium text-white truncate">{{ group.name }}</span>
                            @if (group.isAdmin) {
                              <span class="px-1.5 py-0.5 bg-emerald-500/20 text-emerald-400 text-xs rounded">\u7BA1\u7406\u54E1</span>
                            } @else {
                              <span class="px-1.5 py-0.5 bg-slate-600 text-slate-400 text-xs rounded">\u6210\u54E1</span>
                            }
                          </div>
                          <div class="text-xs text-slate-400 flex items-center gap-2">
                            <span>\u{1F464} {{ group.memberCount | number }} \u6210\u54E1</span>
                            <span>\u2022</span>
                            <span class="truncate">{{ group.url }}</span>
                          </div>
                        </div>
                        
                        @if (selectedGroup()?.id === group.id) {
                          <svg class="w-5 h-5 text-emerald-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                          </svg>
                        }
                      </button>
                    }
                  </div>
                }
              </div>
            }
            
            <!-- \u5275\u5EFA\u65B0\u7FA4\u7D44 -->
            @if (groupSource() === 'create') {
              <div class="p-4 bg-cyan-500/10 rounded-xl border border-cyan-500/30 space-y-4">
                <label class="block text-sm font-medium text-cyan-300">\u{1F4DD} \u65B0\u7FA4\u7D44\u4FE1\u606F</label>
                
                <!-- \u7FA4\u540D\u751F\u6210\u65B9\u5F0F -->
                <div>
                  <span class="text-xs text-slate-400 mb-2 block">\u7FA4\u540D\u751F\u6210\uFF1A</span>
                  <div class="flex gap-2">
                    <button 
                      (click)="groupNameMode.set('manual')"
                      class="flex-1 py-2 rounded-lg text-sm transition-all"
                      [class.bg-cyan-500]="groupNameMode() === 'manual'"
                      [class.text-white]="groupNameMode() === 'manual'"
                      [class.bg-slate-700]="groupNameMode() !== 'manual'"
                      [class.text-slate-400]="groupNameMode() !== 'manual'">
                      \u270F\uFE0F \u624B\u52D5\u8F38\u5165
                    </button>
                    <button 
                      (click)="groupNameMode.set('ai')"
                      class="flex-1 py-2 rounded-lg text-sm transition-all"
                      [class.bg-purple-500]="groupNameMode() === 'ai'"
                      [class.text-white]="groupNameMode() === 'ai'"
                      [class.bg-slate-700]="groupNameMode() !== 'ai'"
                      [class.text-slate-400]="groupNameMode() !== 'ai'">
                      \u{1F916} AI \u751F\u6210
                    </button>
                  </div>
                </div>
                
                <!-- \u624B\u52D5\u8F38\u5165\u7FA4\u540D -->
                @if (groupNameMode() === 'manual') {
                  <div>
                    <span class="text-xs text-slate-400 mb-2 block">\u7FA4\u7D44\u540D\u7A31\uFF1A</span>
                    <input 
                      type="text"
                      [(ngModel)]="newGroupName"
                      placeholder="\u8F38\u5165\u7FA4\u7D44\u540D\u7A31..."
                      maxlength="128"
                      class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:ring-2 focus:ring-cyan-500">
                    <span class="text-xs text-slate-500 mt-1 block">{{ newGroupName.length }}/128</span>
                  </div>
                }
                
                <!-- AI \u751F\u6210\u7FA4\u540D -->
                @if (groupNameMode() === 'ai') {
                  <div class="space-y-3">
                    <div>
                      <span class="text-xs text-slate-400 mb-2 block">\u4E3B\u984C/\u95DC\u9375\u8A5E\uFF1A</span>
                      <input 
                        type="text"
                        [(ngModel)]="aiGroupKeywords"
                        placeholder="\u4F8B\u5982\uFF1A\u5E63\u5708\u3001\u4EA4\u6D41\u3001VIP..."
                        class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:ring-2 focus:ring-purple-500">
                    </div>
                    
                    <div>
                      <span class="text-xs text-slate-400 mb-2 block">\u98A8\u683C\uFF1A</span>
                      <div class="flex flex-wrap gap-2">
                        @for (style of groupNameStyles; track style.key) {
                          <button 
                            (click)="selectedGroupNameStyle.set(style.key)"
                            class="px-3 py-1 text-xs rounded-lg transition-all"
                            [class.bg-purple-500]="selectedGroupNameStyle() === style.key"
                            [class.text-white]="selectedGroupNameStyle() === style.key"
                            [class.bg-slate-700]="selectedGroupNameStyle() !== style.key"
                            [class.text-slate-400]="selectedGroupNameStyle() !== style.key">
                            {{ style.label }}
                          </button>
                        }
                      </div>
                    </div>
                    
                    <button 
                      (click)="generateGroupNames()"
                      [disabled]="isGeneratingNames() || !aiGroupKeywords.trim()"
                      class="w-full py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 flex items-center justify-center gap-2 text-sm">
                      @if (isGeneratingNames()) {
                        <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                        </svg>
                        \u751F\u6210\u4E2D...
                      } @else {
                        \u2728 \u751F\u6210\u7FA4\u540D
                      }
                    </button>
                    
                    <!-- AI \u751F\u6210\u7D50\u679C -->
                    @if (generatedGroupNames().length > 0) {
                      <div class="space-y-2">
                        <span class="text-xs text-slate-400">\u9078\u64C7\u4E00\u500B\uFF1A</span>
                        @for (name of generatedGroupNames(); track $index) {
                          <button 
                            (click)="selectGeneratedName(name)"
                            class="w-full p-2 rounded-lg border transition-all text-left text-sm"
                            [class.border-purple-500]="newGroupName === name"
                            [class.bg-purple-500/10]="newGroupName === name"
                            [class.border-slate-600]="newGroupName !== name"
                            [class.bg-slate-800/50]="newGroupName !== name">
                            {{ name }}
                          </button>
                        }
                      </div>
                    }
                  </div>
                }
                
                <!-- \u7FA4\u7D44\u985E\u578B -->
                <div>
                  <span class="text-xs text-slate-400 mb-2 block">\u7FA4\u7D44\u985E\u578B\uFF1A</span>
                  <div class="flex gap-3">
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="radio" name="groupType" value="group" [(ngModel)]="newGroupType" 
                             class="w-4 h-4 text-cyan-500 border-slate-600 focus:ring-cyan-500">
                      <span class="text-sm text-slate-300">\u666E\u901A\u7FA4\u7D44 (\u6700\u591A 200 \u4EBA)</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="radio" name="groupType" value="supergroup" [(ngModel)]="newGroupType"
                             class="w-4 h-4 text-cyan-500 border-slate-600 focus:ring-cyan-500">
                      <span class="text-sm text-slate-300">\u8D85\u7D1A\u7FA4\u7D44 (\u6700\u591A 20 \u842C\u4EBA)</span>
                    </label>
                  </div>
                </div>
                
                <!-- \u7FA4\u7D44\u63CF\u8FF0 -->
                <div>
                  <span class="text-xs text-slate-400 mb-2 block">\u7FA4\u7D44\u63CF\u8FF0\uFF08\u53EF\u9078\uFF09\uFF1A</span>
                  <textarea 
                    [(ngModel)]="newGroupDescription"
                    rows="2"
                    placeholder="\u7C21\u77ED\u4ECB\u7D39\u7FA4\u7D44\u76EE\u7684..."
                    class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-slate-500 resize-none focus:ring-2 focus:ring-cyan-500 text-sm">
                  </textarea>
                </div>
              </div>
            }
            
            <!-- \u62C9\u7FA4\u8A2D\u7F6E -->
            <div class="p-4 bg-slate-800/30 rounded-xl border border-slate-700/50">
              <label class="block text-sm font-medium text-slate-300 mb-3">
                \u2699\uFE0F \u62C9\u7FA4\u8A2D\u7F6E
              </label>
              
              <div class="space-y-4">
                <!-- \u6BCF\u6279\u6B21\u4EBA\u6578 -->
                <div class="flex items-center gap-3">
                  <span class="text-sm text-slate-400 w-24">\u6BCF\u6279\u6B21\u4EBA\u6578\uFF1A</span>
                  <input 
                    type="number" 
                    [(ngModel)]="batchSize"
                    min="1" max="50"
                    class="w-20 px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-center focus:ring-2 focus:ring-emerald-500">
                  <span class="text-sm text-slate-400">\u4EBA</span>
                </div>
                
                <!-- \u9593\u9694\u6642\u9593 -->
                <div class="flex items-center gap-3">
                  <span class="text-sm text-slate-400 w-24">\u6279\u6B21\u9593\u9694\uFF1A</span>
                  <input 
                    type="number" 
                    [(ngModel)]="minInterval"
                    min="30" max="300"
                    class="w-20 px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-center focus:ring-2 focus:ring-emerald-500">
                  <span class="text-slate-400">-</span>
                  <input 
                    type="number" 
                    [(ngModel)]="maxInterval"
                    min="30" max="600"
                    class="w-20 px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-center focus:ring-2 focus:ring-emerald-500">
                  <span class="text-sm text-slate-400">\u79D2</span>
                </div>
              </div>
            </div>
            
            <!-- \u6B61\u8FCE\u6D88\u606F\u8A2D\u7F6E -->
            <div class="p-4 bg-slate-800/30 rounded-xl border border-slate-700/50">
              <label class="block text-sm font-medium text-slate-300 mb-3">
                \u{1F4AC} \u6B61\u8FCE\u6D88\u606F
              </label>
              
              <!-- \u6B61\u8FCE\u6D88\u606F\u4F86\u6E90 -->
              <div class="flex gap-2 mb-3">
                <button 
                  (click)="welcomeMessageSource.set('none')"
                  class="flex-1 py-2 rounded-lg text-sm transition-all"
                  [class.bg-slate-600]="welcomeMessageSource() === 'none'"
                  [class.text-white]="welcomeMessageSource() === 'none'"
                  [class.bg-slate-700]="welcomeMessageSource() !== 'none'"
                  [class.text-slate-400]="welcomeMessageSource() !== 'none'">
                  \u274C \u4E0D\u767C\u9001
                </button>
                <button 
                  (click)="welcomeMessageSource.set('template')"
                  class="flex-1 py-2 rounded-lg text-sm transition-all"
                  [class.bg-blue-500]="welcomeMessageSource() === 'template'"
                  [class.text-white]="welcomeMessageSource() === 'template'"
                  [class.bg-slate-700]="welcomeMessageSource() !== 'template'"
                  [class.text-slate-400]="welcomeMessageSource() !== 'template'">
                  \u{1F4C4} \u9078\u6A21\u677F
                </button>
                <button 
                  (click)="welcomeMessageSource.set('ai')"
                  class="flex-1 py-2 rounded-lg text-sm transition-all"
                  [class.bg-purple-500]="welcomeMessageSource() === 'ai'"
                  [class.text-white]="welcomeMessageSource() === 'ai'"
                  [class.bg-slate-700]="welcomeMessageSource() !== 'ai'"
                  [class.text-slate-400]="welcomeMessageSource() !== 'ai'">
                  \u{1F916} AI \u751F\u6210
                </button>
              </div>
              
              <!-- \u6A21\u677F\u9078\u64C7 -->
              @if (welcomeMessageSource() === 'template') {
                <div class="space-y-2">
                  @if (isLoadingTemplates()) {
                    <div class="flex items-center justify-center py-4">
                      <svg class="animate-spin h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                      </svg>
                      <span class="ml-2 text-slate-400 text-sm">\u8F09\u5165\u6A21\u677F...</span>
                    </div>
                  } @else if (welcomeTemplates().length === 0) {
                    <p class="text-sm text-slate-500 text-center py-4">\u6C92\u6709\u53EF\u7528\u7684\u6A21\u677F</p>
                  } @else {
                    <div class="max-h-32 overflow-y-auto space-y-2">
                      @for (template of welcomeTemplates(); track template.id) {
                        <button 
                          (click)="selectWelcomeTemplate(template)"
                          class="w-full p-2 rounded-lg border transition-all text-left text-sm"
                          [class.border-blue-500]="selectedWelcomeTemplate()?.id === template.id"
                          [class.bg-blue-500/10]="selectedWelcomeTemplate()?.id === template.id"
                          [class.border-slate-600]="selectedWelcomeTemplate()?.id !== template.id"
                          [class.bg-slate-800/50]="selectedWelcomeTemplate()?.id !== template.id">
                          <span class="font-medium text-white">{{ template.name }}</span>
                          <p class="text-xs text-slate-400 truncate mt-1">{{ template.content }}</p>
                        </button>
                      }
                    </div>
                  }
                </div>
              }
              
              <!-- AI \u751F\u6210\u6B61\u8FCE\u6D88\u606F -->
              @if (welcomeMessageSource() === 'ai') {
                <div class="space-y-3">
                  <input 
                    type="text"
                    [(ngModel)]="aiWelcomeTopic"
                    placeholder="\u6B61\u8FCE\u6D88\u606F\u4E3B\u984C\uFF0C\u4F8B\u5982\uFF1A\u6B61\u8FCE\u52A0\u5165\u3001\u793E\u7FA4\u4ECB\u7D39..."
                    class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white text-sm placeholder-slate-500 focus:ring-2 focus:ring-purple-500">
                  
                  <button 
                    (click)="generateWelcomeMessage()"
                    [disabled]="isGeneratingWelcome() || !aiWelcomeTopic.trim()"
                    class="w-full py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 flex items-center justify-center gap-2 text-sm">
                    @if (isGeneratingWelcome()) {
                      <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                      </svg>
                      \u751F\u6210\u4E2D...
                    } @else {
                      \u2728 \u751F\u6210\u6B61\u8FCE\u6D88\u606F
                    }
                  </button>
                  
                  @if (generatedWelcomeMessage()) {
                    <div class="p-3 bg-slate-800/50 rounded-lg border border-purple-500/30">
                      <p class="text-sm text-white">{{ generatedWelcomeMessage() }}</p>
                    </div>
                  }
                </div>
              }
              
              <!-- \u81EA\u5B9A\u7FA9\u6B61\u8FCE\u6D88\u606F\u7DE8\u8F2F -->
              @if (welcomeMessageSource() !== 'none') {
                <div class="mt-3">
                  <span class="text-xs text-slate-400 mb-2 block">\u6D88\u606F\u5167\u5BB9\uFF1A</span>
                  <textarea 
                    [(ngModel)]="welcomeMessageContent"
                    rows="2"
                    placeholder="\u8F38\u5165\u6B61\u8FCE\u6D88\u606F\u5167\u5BB9..."
                    class="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-slate-500 resize-none focus:ring-2 focus:ring-emerald-500 text-sm">
                  </textarea>
                </div>
              }
            </div>
            
            <!-- \u6B0A\u9650\u6AA2\u67E5\u7D50\u679C -->
            @if (selectedGroup()) {
              <div class="p-4 rounded-xl"
                   [class.bg-emerald-500/10]="permissionCheck().canInvite > 0"
                   [class.border]="true"
                   [class.border-emerald-500/30]="permissionCheck().canInvite > 0"
                   [class.bg-amber-500/10]="permissionCheck().canInvite === 0"
                   [class.border-amber-500/30]="permissionCheck().canInvite === 0">
                <h4 class="text-sm font-medium text-slate-300 mb-2">\u{1F4CA} \u6B0A\u9650\u6AA2\u67E5\u7D50\u679C</h4>
                <div class="flex items-center gap-6 text-sm">
                  <span class="text-emerald-400">\u2705 \u53EF\u62C9\u5165: {{ permissionCheck().canInvite }} \u4EBA</span>
                  @if (permissionCheck().alreadyInGroup > 0) {
                    <span class="text-amber-400">\u26A0\uFE0F \u5DF2\u5728\u7FA4\u5167: {{ permissionCheck().alreadyInGroup }} \u4EBA</span>
                  }
                  @if (permissionCheck().privacyRestricted > 0) {
                    <span class="text-red-400">\u274C \u96B1\u79C1\u9650\u5236: {{ permissionCheck().privacyRestricted }} \u4EBA</span>
                  }
                </div>
              </div>
            }
            
            <!-- \u76EE\u6A19\u7528\u6236\u9810\u89BD -->
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">
                \u{1F465} \u76EE\u6A19\u7528\u6236\uFF08{{ targets().length }} \u4EBA\uFF09
              </label>
              <div class="max-h-32 overflow-y-auto p-3 bg-slate-800/30 rounded-xl border border-slate-700/50">
                <div class="flex flex-wrap gap-2">
                  @for (target of targets().slice(0, 20); track target.telegramId) {
                    <span class="px-2 py-1 bg-slate-700 text-slate-300 rounded text-xs">
                      {{ target.displayName || target.firstName || target.username || target.telegramId }}
                    </span>
                  }
                  @if (targets().length > 20) {
                    <span class="px-2 py-1 text-slate-400 text-xs">
                      +{{ targets().length - 20 }} \u66F4\u591A...
                    </span>
                  }
                </div>
              </div>
            </div>
            
          </div>
          
          <!-- \u9032\u5EA6\u986F\u793A -->
          @if (isInviting()) {
            <div class="p-4 bg-slate-800/50 border-t border-slate-700/50">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-white">\u62C9\u7FA4\u9032\u5EA6</span>
                <span class="text-sm text-slate-400">{{ invitedCount() }} / {{ targets().length }}</span>
              </div>
              <div class="w-full h-2 bg-slate-700 rounded-full overflow-hidden">
                <div 
                  class="h-full bg-gradient-to-r from-emerald-500 to-cyan-500 transition-all duration-300"
                  [style.width.%]="progressPercent()">
                </div>
              </div>
              <div class="mt-2 flex items-center gap-4 text-xs text-slate-400">
                <span class="text-green-400">\u2705 \u6210\u529F: {{ successCount() }}</span>
                <span class="text-amber-400">\u26A0\uFE0F \u8DF3\u904E: {{ skippedCount() }}</span>
                <span class="text-red-400">\u274C \u5931\u6557: {{ failedCount() }}</span>
                <span>\u23F3 \u9810\u8A08\u5269\u9918: {{ estimatedRemaining() }}</span>
              </div>
              <p class="mt-1 text-xs text-slate-500">
                \u{1F4A1} \u6210\u529F\u5305\u542B\uFF1A\u76F4\u63A5\u9080\u8ACB + \u5DF2\u767C\u9001\u9080\u8ACB\u93C8\u63A5
              </p>
            </div>
          }
          
          <!-- \u5E33\u865F\u72C0\u614B\u63D0\u793A -->
          @if (onlineAccountsCount() === 0) {
            <div class="px-5 py-3 bg-red-500/10 border-t border-red-500/30">
              <div class="flex items-center gap-2 text-sm text-red-400">
                <span>\u26A0\uFE0F</span>
                <span>\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F\u5F8C\u518D\u9032\u884C\u62C9\u7FA4\u64CD\u4F5C</span>
              </div>
            </div>
          } @else {
            <!-- \u5E33\u865F\u72C0\u614B -->
            <div class="px-5 py-2 bg-slate-800/30 border-t border-slate-700/50">
              <div class="flex items-center gap-2 text-xs text-slate-400">
                <span>\u{1F517}</span>
                <span>\u53EF\u7528\u5E33\u865F: {{ onlineAccountsCount() }} \u500B\u5728\u7DDA</span>
                <span class="text-slate-500">|</span>
                <span>\u5C07\u4F7F\u7528: {{ preferredAccount()?.firstName || preferredAccount()?.phone || '\u81EA\u52D5\u9078\u64C7' }}</span>
              </div>
            </div>
          }
          
          <!-- \u64CD\u4F5C\u6458\u8981 -->
          @if (canInvite()) {
            <div class="px-5 py-3 bg-slate-800/50 border-t border-slate-700/50">
              <div class="flex items-center gap-2 text-sm text-slate-400">
                <span>\u{1F4CB}</span>
                <span>
                  @if (groupSource() === 'create') {
                    \u5275\u5EFA\u7FA4\u7D44\u300C{{ newGroupName }}\u300D\u2192 \u62C9\u5165 {{ targets().length }} \u4EBA
                    @if (welcomeMessageSource() !== 'none') {
                      \u2192 \u767C\u9001\u6B61\u8FCE\u6D88\u606F
                    }
                  } @else {
                    \u62C9\u5165\u7FA4\u7D44\u300C{{ selectedGroup()?.name }}\u300D\u2192 {{ targets().length }} \u4EBA
                    @if (welcomeMessageSource() !== 'none') {
                      \u2192 \u767C\u9001\u6B61\u8FCE\u6D88\u606F
                    }
                  }
                </span>
              </div>
            </div>
          }
          
          <!-- \u5E95\u90E8\u6309\u9215 - \u56FA\u5B9A\u5728\u5E95\u90E8\uFF0C\u78BA\u4FDD\u59CB\u7D42\u53EF\u898B -->
          <div class="sticky bottom-0 left-0 right-0 p-4 border-t border-slate-700/50 bg-slate-900 flex gap-3 z-10 shadow-[0_-4px_12px_rgba(0,0,0,0.3)]">
            <button 
              (click)="close()"
              [disabled]="isInviting() || isCreatingGroup()"
              class="px-4 py-3 bg-slate-700 text-slate-300 rounded-xl hover:bg-slate-600 transition-colors disabled:opacity-50">
              {{ (isInviting() || isCreatingGroup()) ? '\u23F3 \u9032\u884C\u4E2D' : '\u53D6\u6D88' }}
            </button>
            <button 
              (click)="startInviting()"
              [disabled]="!canInvite() || isInviting() || isCreatingGroup()"
              class="flex-1 py-3 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white font-bold rounded-xl hover:opacity-90 transition-opacity disabled:opacity-50 flex items-center justify-center gap-2 text-base shadow-lg shadow-emerald-500/20">
              @if (isCreatingGroup()) {
                <span class="animate-spin">\u23F3</span> {{ createGroupProgressMessage() || '\u5275\u5EFA\u7FA4\u7D44\u4E2D...' }}
              } @else if (isInviting()) {
                <span class="animate-spin">\u23F3</span> \u62C9\u7FA4\u4E2D...
              } @else if (groupSource() === 'create') {
                \u{1F680} \u5275\u5EFA\u4E26\u62C9\u4EBA ({{ targets().length }} \u4EBA)
              } @else {
                \u{1F465} \u958B\u59CB\u62C9\u7FA4 ({{ targets().length }} \u4EBA)
              }
            </button>
          </div>
          
        </div>
      </div>
    }
  `
    }]
  }], null, { isOpen: [{ type: Input, args: [{ isSignal: true, alias: "isOpen", required: false }] }], targets: [{ type: Input, args: [{ isSignal: true, alias: "targets", required: false }] }], accounts: [{ type: Input, args: [{ isSignal: true, alias: "accounts", required: false }] }], closeDialog: [{ type: Output, args: ["closeDialog"] }], inviteComplete: [{ type: Output, args: ["inviteComplete"] }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(BatchInviteDialogComponent, { className: "BatchInviteDialogComponent", filePath: "src/dialogs/batch-invite-dialog.component.ts", lineNumber: 618 });
})();

// src/dialogs/member-extraction-dialog.component.ts
var _forTrack011 = ($index, $item) => $item.value;
function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 30);
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "number");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 31);
    \u0275\u0275text(4, "\u6210\u54E1\u6578");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(2, 1, ctx_r1.group().memberCount));
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 32);
    \u0275\u0275text(1, "?");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "p", 33);
    \u0275\u0275text(3, "\u7121\u6578\u64DA");
    \u0275\u0275elementEnd();
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_12_Conditional_20_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 41);
    \u0275\u0275text(1, "\u23F3");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "span");
    \u0275\u0275text(3, "\u7372\u53D6\u4E2D...");
    \u0275\u0275elementEnd();
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_12_Conditional_21_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span");
    \u0275\u0275text(1, "\u{1F504}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "span");
    \u0275\u0275text(3, "\u91CD\u65B0\u7372\u53D6\u6210\u54E1\u6578");
    \u0275\u0275elementEnd();
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 27)(1, "div", 34)(2, "span", 35);
    \u0275\u0275text(3, "\u26A0\uFE0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 24)(5, "p", 36);
    \u0275\u0275text(6, "\u7121\u6CD5\u7372\u53D6\u6210\u54E1\u6578\u64DA");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "p", 37);
    \u0275\u0275text(8, "\u53EF\u80FD\u539F\u56E0\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "ul", 38)(10, "li");
    \u0275\u0275text(11, "\u5C1A\u672A\u52A0\u5165\u8A72\u7FA4\u7D44");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "li");
    \u0275\u0275text(13, "\u7FA4\u7D44\u5DF2\u8B8A\u70BA\u79C1\u6709");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "li");
    \u0275\u0275text(15, "\u983B\u9053\u985E\u578B\u4E0D\u652F\u6301\u63D0\u53D6\u6210\u54E1");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "li");
    \u0275\u0275text(17, "\u5E33\u865F\u88AB\u8E22\u51FA\u7FA4\u7D44");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(18, "div", 39)(19, "button", 40);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_12_Template_button_click_19_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.refreshMemberCount());
    });
    \u0275\u0275conditionalCreate(20, MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_12_Conditional_20_Template, 4, 0)(21, MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_12_Conditional_21_Template, 4, 0);
    \u0275\u0275elementEnd()()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(19);
    \u0275\u0275property("disabled", ctx_r1.isRefreshingCount());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isRefreshingCount() ? 20 : 21);
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_13_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 28)(1, "div", 34)(2, "span", 35);
    \u0275\u0275text(3, "\u{1F6AB}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 24)(5, "p", 42);
    \u0275\u0275text(6, "\u983B\u9053\u4E0D\u652F\u6301\u6210\u54E1\u63D0\u53D6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "p", 8);
    \u0275\u0275text(8, " Telegram \u983B\u9053\uFF08Channel\uFF09\u6C92\u6709\u6210\u54E1\u5217\u8868\uFF0C\u53EA\u6709\u8A02\u95B1\u8005\u3002 \u5982\u9700\u7372\u53D6\u8A02\u95B1\u8005\u4FE1\u606F\uFF0C\u8ACB\u4F7F\u7528\u983B\u9053\u5206\u6790\u529F\u80FD\u3002 ");
    \u0275\u0275elementEnd()()()();
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_14_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 48)(1, "p", 49);
    \u0275\u0275text(2, "\u{1F4CB} \u66FF\u4EE3\u65B9\u6848\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "ul", 50)(4, "li", 51)(5, "span", 52);
    \u0275\u0275text(6, "1.");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "span");
    \u0275\u0275text(8, "\u78BA\u4FDD\u7FA4\u7D44\u76E3\u63A7\u5DF2\u958B\u555F\uFF0C\u7CFB\u7D71\u6703\u81EA\u52D5\u8A18\u9304\u767C\u8A00\u7528\u6236");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(9, "li", 51)(10, "span", 52);
    \u0275\u0275text(11, "2.");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "span");
    \u0275\u0275text(13, "\u5728\u300C\u5DF2\u6536\u96C6\u7528\u6236\u300D\u6A19\u7C64\u9801\u67E5\u770B\u76E3\u63A7\u671F\u9593\u6536\u96C6\u7684\u7528\u6236");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(14, "li", 51)(15, "span", 52);
    \u0275\u0275text(16, "3.");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(17, "span");
    \u0275\u0275text(18, "\u6216\u806F\u7E6B\u7FA4\u4E3B\u7372\u53D6\u7BA1\u7406\u54E1\u6B0A\u9650");
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(19, "div", 53)(20, "button", 54);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_14_Conditional_9_Template_button_click_20_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r1.checkMonitoringStatus());
    });
    \u0275\u0275elementStart(21, "span");
    \u0275\u0275text(22, "\u{1F4E1}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(23, "span");
    \u0275\u0275text(24, "\u78BA\u8A8D\u76E3\u63A7\u72C0\u614B");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(25, "button", 55);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_14_Conditional_9_Template_button_click_25_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r1.collectFromHistory());
    });
    \u0275\u0275elementStart(26, "span");
    \u0275\u0275text(27, "\u{1F504}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(28, "span");
    \u0275\u0275text(29, "\u5F9E\u6B77\u53F2\u6536\u96C6");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(30, "button", 56);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_14_Conditional_9_Template_button_click_30_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r1.viewCollectedUsers());
    });
    \u0275\u0275elementStart(31, "span");
    \u0275\u0275text(32, "\u{1F465}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(33, "span");
    \u0275\u0275text(34);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(34);
    \u0275\u0275textInterpolate1("\u67E5\u770B\u5DF2\u6536\u96C6 (", ctx_r1.collectedUsersCount(), ")");
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_14_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 46)(1, "p", 57)(2, "span");
    \u0275\u0275text(3, "\u{1F4A1}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span");
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r1.extractionError().suggestion);
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_14_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 58);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_14_Conditional_11_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r1 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r1.joinGroup());
    });
    \u0275\u0275elementStart(1, "span");
    \u0275\u0275text(2, "\u2795");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span");
    \u0275\u0275text(4, "\u52A0\u5165\u7FA4\u7D44");
    \u0275\u0275elementEnd()();
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 43)(1, "div", 34)(2, "span", 35);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 24)(5, "p", 44);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "p", 45);
    \u0275\u0275text(8);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(9, MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_14_Conditional_9_Template, 35, 1)(10, MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_14_Conditional_10_Template, 6, 1, "div", 46);
    \u0275\u0275conditionalCreate(11, MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_14_Conditional_11_Template, 5, 0, "button", 47);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275classProp("bg-red-500/10", ctx_r1.extractionError().code === "ADMIN_REQUIRED")("border-red-500/30", ctx_r1.extractionError().code === "ADMIN_REQUIRED")("bg-amber-500/10", ctx_r1.extractionError().code !== "ADMIN_REQUIRED")("border-amber-500/30", ctx_r1.extractionError().code !== "ADMIN_REQUIRED");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r1.extractionError().code === "ADMIN_REQUIRED" ? "\u{1F512}" : "\u26A0\uFE0F");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("text-red-400", ctx_r1.extractionError().code === "ADMIN_REQUIRED")("text-amber-400", ctx_r1.extractionError().code !== "ADMIN_REQUIRED");
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.extractionError().title, " ");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r1.extractionError().reason);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.extractionError().code === "ADMIN_REQUIRED" ? 9 : 10);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.extractionError().canAutoJoin ? 11 : -1);
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 22)(1, "div", 5)(2, "div", 23);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 24)(5, "h3", 25);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "p", 8);
    \u0275\u0275text(8);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(9, "div", 26);
    \u0275\u0275conditionalCreate(10, MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_10_Template, 5, 3)(11, MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_11_Template, 4, 0);
    \u0275\u0275elementEnd()()();
    \u0275\u0275conditionalCreate(12, MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_12_Template, 22, 2, "div", 27);
    \u0275\u0275conditionalCreate(13, MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_13_Template, 9, 0, "div", 28);
    \u0275\u0275conditionalCreate(14, MemberExtractionDialogComponent_Conditional_0_Conditional_16_Conditional_14_Template, 12, 17, "div", 29);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", ctx_r1.group().name[0], " ");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r1.group().name);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r1.group().url || "\u79C1\u5BC6\u7FA4\u7D44");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.group().memberCount > 0 ? 10 : 11);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.group().memberCount === 0 ? 12 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isChannel() ? 13 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.extractionError() ? 14 : -1);
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_17_For_30_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 79);
    \u0275\u0275text(1, "\u{1F512}");
    \u0275\u0275elementEnd();
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_17_For_30_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 78);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_For_30_Template_button_click_0_listener() {
      const option_r8 = \u0275\u0275restoreView(_r7).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.setLimit(option_r8.value));
    });
    \u0275\u0275text(1);
    \u0275\u0275conditionalCreate(2, MemberExtractionDialogComponent_Conditional_0_Conditional_17_For_30_Conditional_2_Template, 2, 0, "span", 79);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const option_r8 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275classProp("border-emerald-500", ctx_r1.config().limit === option_r8.value)("bg-emerald-500/20", ctx_r1.config().limit === option_r8.value)("text-emerald-400", ctx_r1.config().limit === option_r8.value)("border-slate-700", ctx_r1.config().limit !== option_r8.value)("bg-slate-800/50", ctx_r1.config().limit !== option_r8.value)("text-slate-400", ctx_r1.config().limit !== option_r8.value);
    \u0275\u0275property("disabled", option_r8.value > ctx_r1.maxLimit());
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", option_r8.label, " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(option_r8.value > ctx_r1.maxLimit() ? 2 : -1);
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_17_For_36_Template(rf, ctx) {
  if (rf & 1) {
    const _r9 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 80);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_For_36_Template_button_click_0_listener() {
      const option_r10 = \u0275\u0275restoreView(_r9).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.setOnlineStatus(option_r10.value));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const option_r10 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275classProp("border-cyan-500", ctx_r1.config().filters.onlineStatus === option_r10.value)("bg-cyan-500/20", ctx_r1.config().filters.onlineStatus === option_r10.value)("text-cyan-400", ctx_r1.config().filters.onlineStatus === option_r10.value)("border-slate-700", ctx_r1.config().filters.onlineStatus !== option_r10.value)("bg-slate-800/50", ctx_r1.config().filters.onlineStatus !== option_r10.value)("text-slate-400", ctx_r1.config().filters.onlineStatus !== option_r10.value);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", option_r10.icon, " ", option_r10.label, " ");
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Conditional_75_Template(rf, ctx) {
  if (rf & 1) {
    const _r11 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 77)(1, "div")(2, "label", 81);
    \u0275\u0275text(3, "\u23F0 \u6D3B\u8E8D\u5EA6\u7BE9\u9078");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 82)(5, "span", 83);
    \u0275\u0275text(6, "\u6700\u8FD1");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "select", 84);
    \u0275\u0275listener("change", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Conditional_75_Template_select_change_7_listener($event) {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.setActivityDays($event));
    });
    \u0275\u0275elementStart(8, "option", 85);
    \u0275\u0275text(9, "\u4E0D\u9650");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "option", 86);
    \u0275\u0275text(11, "3 \u5929");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "option", 87);
    \u0275\u0275text(13, "7 \u5929");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "option", 88);
    \u0275\u0275text(15, "14 \u5929");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "option", 89);
    \u0275\u0275text(17, "30 \u5929");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(18, "span", 83);
    \u0275\u0275text(19, "\u5167\u6D3B\u52D5");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(20, "div", 68)(21, "label", 90)(22, "input", 70);
    \u0275\u0275listener("change", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Conditional_75_Template_input_change_22_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.toggleAdvanced("autoSaveToResources"));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(23, "div")(24, "p", 71);
    \u0275\u0275text(25, "\u81EA\u52D5\u4FDD\u5B58");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(26, "p", 31);
    \u0275\u0275text(27, "\u540C\u6B65\u5230\u8CC7\u6E90\u4E2D\u5FC3");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(28, "label", 90)(29, "input", 70);
    \u0275\u0275listener("change", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Conditional_75_Template_input_change_29_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.toggleAdvanced("skipDuplicates"));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(30, "div")(31, "p", 71);
    \u0275\u0275text(32, "\u8DF3\u904E\u91CD\u8907");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(33, "p", 31);
    \u0275\u0275text(34, "\u5DF2\u5B58\u5728\u7684\u6210\u54E1");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(35, "label", 90)(36, "input", 70);
    \u0275\u0275listener("change", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Conditional_75_Template_input_change_36_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.toggleFilter("excludeAdmins"));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(37, "div")(38, "p", 71);
    \u0275\u0275text(39, "\u6392\u9664\u7BA1\u7406\u54E1");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(40, "p", 31);
    \u0275\u0275text(41, "\u7FA4\u4E3B\u548C\u7BA1\u7406\u54E1");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(42, "label", 90)(43, "input", 70);
    \u0275\u0275listener("change", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Conditional_75_Template_input_change_43_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.toggleAdvanced("shuffleOrder"));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(44, "div")(45, "p", 71);
    \u0275\u0275text(46, "\u96A8\u6A5F\u9806\u5E8F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(47, "p", 31);
    \u0275\u0275text(48, "\u6253\u4E82\u63D0\u53D6\u9806\u5E8F");
    \u0275\u0275elementEnd()()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(7);
    \u0275\u0275property("value", ctx_r1.config().filters.minActivityDays || "");
    \u0275\u0275advance(15);
    \u0275\u0275property("checked", ctx_r1.config().advanced.autoSaveToResources);
    \u0275\u0275advance(7);
    \u0275\u0275property("checked", ctx_r1.config().advanced.skipDuplicates);
    \u0275\u0275advance(7);
    \u0275\u0275property("checked", ctx_r1.config().filters.excludeAdmins);
    \u0275\u0275advance(7);
    \u0275\u0275property("checked", ctx_r1.config().advanced.shuffleOrder);
  }
}
function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div")(1, "label", 59);
    \u0275\u0275text(2, " \u26A1 \u5FEB\u901F\u6A21\u677F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 60)(4, "button", 61);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Template_button_click_4_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.selectTemplate("quick"));
    });
    \u0275\u0275elementStart(5, "div", 62);
    \u0275\u0275text(6, "\u26A1");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "p", 63);
    \u0275\u0275text(8, "\u5FEB\u901F\u63D0\u53D6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "p", 64);
    \u0275\u0275text(10, "100\u4EBA \xB7 \u50C5\u5728\u7DDA");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(11, "button", 61);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Template_button_click_11_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.selectTemplate("deep"));
    });
    \u0275\u0275elementStart(12, "div", 62);
    \u0275\u0275text(13, "\u{1F50D}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "p", 63);
    \u0275\u0275text(15, "\u6DF1\u5EA6\u63D0\u53D6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "p", 64);
    \u0275\u0275text(17, "500\u4EBA \xB7 \u5168\u72C0\u614B");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(18, "button", 61);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Template_button_click_18_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.selectTemplate("precise"));
    });
    \u0275\u0275elementStart(19, "div", 62);
    \u0275\u0275text(20, "\u{1F3AF}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(21, "p", 63);
    \u0275\u0275text(22, "\u7CBE\u6E96\u63D0\u53D6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(23, "p", 64);
    \u0275\u0275text(24, "\u81EA\u5B9A\u7FA9\u689D\u4EF6");
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(25, "div")(26, "label", 59);
    \u0275\u0275text(27, " \u{1F522} \u63D0\u53D6\u6578\u91CF ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(28, "div", 53);
    \u0275\u0275repeaterCreate(29, MemberExtractionDialogComponent_Conditional_0_Conditional_17_For_30_Template, 3, 15, "button", 65, _forTrack011);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(31, "div")(32, "label", 59);
    \u0275\u0275text(33, " \u{1F4CD} \u5728\u7DDA\u72C0\u614B ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(34, "div", 66);
    \u0275\u0275repeaterCreate(35, MemberExtractionDialogComponent_Conditional_0_Conditional_17_For_36_Template, 2, 14, "button", 67, _forTrack011);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(37, "div")(38, "label", 59);
    \u0275\u0275text(39, " \u{1F3F7}\uFE0F \u6210\u54E1\u5C6C\u6027 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(40, "div", 68)(41, "label", 69)(42, "input", 70);
    \u0275\u0275listener("change", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Template_input_change_42_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.toggleFilter("excludeBots"));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(43, "div")(44, "p", 71);
    \u0275\u0275text(45, "\u6392\u9664\u6A5F\u5668\u4EBA");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(46, "p", 31);
    \u0275\u0275text(47, "\u904E\u6FFE Bot \u5E33\u865F");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(48, "label", 69)(49, "input", 70);
    \u0275\u0275listener("change", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Template_input_change_49_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.toggleFilter("hasUsername"));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(50, "div")(51, "p", 71);
    \u0275\u0275text(52, "\u9700\u6709\u7528\u6236\u540D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(53, "p", 31);
    \u0275\u0275text(54, "\u50C5\u63D0\u53D6\u6709 @username");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(55, "label", 69)(56, "input", 70);
    \u0275\u0275listener("change", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Template_input_change_56_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.toggleFilter("hasChinese"));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(57, "div")(58, "p", 71);
    \u0275\u0275text(59, "\u50C5\u83EF\u4EBA\u7528\u6236");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(60, "p", 31);
    \u0275\u0275text(61, "\u4E2D\u6587\u540D\u7A31\u512A\u5148");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(62, "label", 69)(63, "input", 70);
    \u0275\u0275listener("change", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Template_input_change_63_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.toggleFilter("isPremium"));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(64, "div")(65, "p", 71);
    \u0275\u0275text(66, "Premium \u7528\u6236");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(67, "p", 31);
    \u0275\u0275text(68, "\u50C5\u4ED8\u8CBB\u6703\u54E1 \u2B50");
    \u0275\u0275elementEnd()()()()();
    \u0275\u0275elementStart(69, "div", 72)(70, "button", 73);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Conditional_17_Template_button_click_70_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.showAdvanced.set(!ctx_r1.showAdvanced()));
    });
    \u0275\u0275elementStart(71, "span", 74);
    \u0275\u0275text(72, "\u2699\uFE0F \u9AD8\u7D1A\u9078\u9805");
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(73, "svg", 75);
    \u0275\u0275element(74, "path", 76);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(75, MemberExtractionDialogComponent_Conditional_0_Conditional_17_Conditional_75_Template, 49, 5, "div", 77);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(4);
    \u0275\u0275classProp("border-emerald-500", ctx_r1.selectedTemplate() === "quick")("bg-emerald-500/20", ctx_r1.selectedTemplate() === "quick")("border-slate-700", ctx_r1.selectedTemplate() !== "quick")("bg-slate-800/50", ctx_r1.selectedTemplate() !== "quick");
    \u0275\u0275advance(7);
    \u0275\u0275classProp("border-blue-500", ctx_r1.selectedTemplate() === "deep")("bg-blue-500/20", ctx_r1.selectedTemplate() === "deep")("border-slate-700", ctx_r1.selectedTemplate() !== "deep")("bg-slate-800/50", ctx_r1.selectedTemplate() !== "deep");
    \u0275\u0275advance(7);
    \u0275\u0275classProp("border-purple-500", ctx_r1.selectedTemplate() === "precise")("bg-purple-500/20", ctx_r1.selectedTemplate() === "precise")("border-slate-700", ctx_r1.selectedTemplate() !== "precise")("bg-slate-800/50", ctx_r1.selectedTemplate() !== "precise");
    \u0275\u0275advance(11);
    \u0275\u0275repeater(ctx_r1.limitOptions);
    \u0275\u0275advance(6);
    \u0275\u0275repeater(ctx_r1.onlineStatusOptions);
    \u0275\u0275advance(7);
    \u0275\u0275property("checked", ctx_r1.config().filters.excludeBots);
    \u0275\u0275advance(7);
    \u0275\u0275property("checked", ctx_r1.config().filters.hasUsername === true);
    \u0275\u0275advance(7);
    \u0275\u0275property("checked", ctx_r1.config().filters.hasChinese === true);
    \u0275\u0275advance(7);
    \u0275\u0275property("checked", ctx_r1.config().filters.isPremium === true);
    \u0275\u0275advance(10);
    \u0275\u0275classProp("rotate-180", ctx_r1.showAdvanced());
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.showAdvanced() ? 75 : -1);
  }
}
function MemberExtractionDialogComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 1);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Template_div_click_0_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.onBackdropClick($event));
    });
    \u0275\u0275elementStart(1, "div", 2);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Template_div_click_1_listener($event) {
      \u0275\u0275restoreView(_r1);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275elementStart(2, "div", 3)(3, "div", 4)(4, "div", 5)(5, "div", 6);
    \u0275\u0275text(6, " \u{1F465} ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div")(8, "h2", 7);
    \u0275\u0275text(9, "\u63D0\u53D6\u7FA4\u7D44\u6210\u54E1");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "p", 8);
    \u0275\u0275text(11, "\u914D\u7F6E\u63D0\u53D6\u9078\u9805\u548C\u7BE9\u9078\u689D\u4EF6");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(12, "button", 9);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Template_button_click_12_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.close());
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(13, "svg", 10);
    \u0275\u0275element(14, "path", 11);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(15, "div", 12);
    \u0275\u0275conditionalCreate(16, MemberExtractionDialogComponent_Conditional_0_Conditional_16_Template, 15, 7);
    \u0275\u0275conditionalCreate(17, MemberExtractionDialogComponent_Conditional_0_Conditional_17_Template, 76, 31);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "div", 13)(19, "div", 14)(20, "div", 15)(21, "span", 16);
    \u0275\u0275text(22, " \u{1F4A1} \u9810\u8A08\u63D0\u53D6\uFF1A ");
    \u0275\u0275elementStart(23, "span", 17);
    \u0275\u0275text(24);
    \u0275\u0275elementEnd();
    \u0275\u0275text(25, " \u4EBA ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(26, "div", 16);
    \u0275\u0275text(27, " \u{1F4CA} \u4ECA\u65E5\u914D\u984D\uFF1A ");
    \u0275\u0275elementStart(28, "span", 18);
    \u0275\u0275text(29);
    \u0275\u0275elementEnd();
    \u0275\u0275text(30);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(31, "div", 19)(32, "button", 20);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Template_button_click_32_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.close());
    });
    \u0275\u0275text(33, " \u53D6\u6D88 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(34, "button", 21);
    \u0275\u0275listener("click", function MemberExtractionDialogComponent_Conditional_0_Template_button_click_34_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.startExtraction());
    });
    \u0275\u0275elementStart(35, "span");
    \u0275\u0275text(36, "\u{1F465}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(37, "span");
    \u0275\u0275text(38);
    \u0275\u0275elementEnd()()()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(16);
    \u0275\u0275conditional(ctx_r1.group() ? 16 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(!ctx_r1.isChannel() ? 17 : -1);
    \u0275\u0275advance(7);
    \u0275\u0275textInterpolate(ctx_r1.estimatedCount());
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r1.remainingQuota());
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" / ", ctx_r1.dailyQuota(), " ");
    \u0275\u0275advance(4);
    \u0275\u0275property("disabled", !ctx_r1.canStart());
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate1("\u958B\u59CB\u63D0\u53D6 (", ctx_r1.config().limit, " \u4EBA)");
  }
}
var MemberExtractionDialogComponent = class _MemberExtractionDialogComponent {
  constructor() {
    this.isOpen = input(false, ...ngDevMode ? [{ debugName: "isOpen" }] : []);
    this.group = input(null, ...ngDevMode ? [{ debugName: "group" }] : []);
    this.closeDialog = output();
    this.startExtractionEvent = output();
    this.memberCountRefreshed = output();
    this.enableMonitoringEvent = output();
    this.joinGroupEvent = output();
    this.viewCollectedUsersEvent = output();
    this.ipcService = inject(ElectronIpcService);
    this.toast = inject(ToastService);
    this.showAdvanced = signal(false, ...ngDevMode ? [{ debugName: "showAdvanced" }] : []);
    this.selectedTemplate = signal("quick", ...ngDevMode ? [{ debugName: "selectedTemplate" }] : []);
    this.isRefreshingCount = signal(false, ...ngDevMode ? [{ debugName: "isRefreshingCount" }] : []);
    this.extractionError = signal(null, ...ngDevMode ? [{ debugName: "extractionError" }] : []);
    this.collectedUsersCount = signal(0, ...ngDevMode ? [{ debugName: "collectedUsersCount" }] : []);
    this.isMonitoring = signal(false, ...ngDevMode ? [{ debugName: "isMonitoring" }] : []);
    this.config = signal({
      limit: 100,
      filters: {
        onlineStatus: "all",
        // 🔧 FIX: 默認提取所有成員，而非只提取在線
        hasChinese: null,
        hasUsername: null,
        isPremium: null,
        excludeBots: true,
        excludeAdmins: false,
        minActivityDays: null
      },
      advanced: {
        shuffleOrder: false,
        skipDuplicates: true,
        autoSaveToResources: true,
        extractAvatar: false
      }
    }, ...ngDevMode ? [{ debugName: "config" }] : []);
    this.limitOptions = [
      { value: 50, label: "50" },
      { value: 100, label: "100" },
      { value: 200, label: "200" },
      { value: 500, label: "500" },
      { value: -1, label: "\u5168\u90E8" }
    ];
    this.onlineStatusOptions = [
      { value: "all", label: "\u5168\u90E8", icon: "\u{1F4CA}" },
      { value: "online", label: "\u5728\u7DDA", icon: "\u{1F7E2}" },
      { value: "recently", label: "\u6700\u8FD1", icon: "\u{1F7E1}" },
      { value: "offline", label: "\u96E2\u7DDA", icon: "\u26AB" }
    ];
    this.maxLimit = computed(() => {
      const groupSize = this.group()?.memberCount || 0;
      return Math.min(groupSize, 1e4);
    }, ...ngDevMode ? [{ debugName: "maxLimit" }] : []);
    this.dailyQuota = signal(1e3, ...ngDevMode ? [{ debugName: "dailyQuota" }] : []);
    this.remainingQuota = signal(800, ...ngDevMode ? [{ debugName: "remainingQuota" }] : []);
    this.estimatedCount = computed(() => {
      const limit = this.config().limit;
      const groupSize = this.group()?.memberCount || 0;
      if (limit === -1) {
        return Math.min(groupSize, this.remainingQuota());
      }
      return Math.min(limit, groupSize, this.remainingQuota());
    }, ...ngDevMode ? [{ debugName: "estimatedCount" }] : []);
    this.isChannel = computed(() => {
      return this.group()?.resourceType === "channel";
    }, ...ngDevMode ? [{ debugName: "isChannel" }] : []);
    this.canStart = computed(() => {
      const group = this.group();
      if (!group)
        return false;
      if (this.isChannel())
        return false;
      return this.estimatedCount() > 0;
    }, ...ngDevMode ? [{ debugName: "canStart" }] : []);
    this.listeners = [];
  }
  ngOnInit() {
    this.loadQuota();
    this.listenForExtractionErrors();
    this.loadCollectedUsersCount();
  }
  ngOnDestroy() {
    this.listeners.forEach((fn) => fn());
  }
  // 載入配額信息
  loadQuota() {
    const cleanup = this.ipcService.on("extraction-quota", (data) => {
      if (data) {
        this.dailyQuota.set(data.daily || 1e3);
        this.remainingQuota.set(data.remaining || 800);
      }
    });
    this.listeners.push(cleanup);
    this.ipcService.send("get-extraction-quota", {});
  }
  // 🆕 監聽提取錯誤
  listenForExtractionErrors() {
    const cleanup = this.ipcService.on("members-extracted", (data) => {
      const group = this.group();
      if (!group || String(data.resourceId) !== String(group.id))
        return;
      if (!data.success && data.error_code) {
        const details = data.error_details || {};
        const errorMap = {
          "ADMIN_REQUIRED": {
            title: "\u9700\u8981\u7BA1\u7406\u54E1\u6B0A\u9650",
            defaultReason: "\u6B64\u7FA4\u7D44\u8A2D\u7F6E\u4E86\u6210\u54E1\u5217\u8868\u53EA\u5C0D\u7BA1\u7406\u54E1\u53EF\u898B"
          },
          "PEER_ID_INVALID": {
            title: "\u5E33\u865F\u5C1A\u672A\u9023\u63A5\u6B64\u7FA4\u7D44",
            defaultReason: "Telegram \u8981\u6C42\u5E33\u865F\u5FC5\u9808\u5148\u52A0\u5165\u7FA4\u7D44"
          },
          "NOT_PARTICIPANT": {
            title: "\u5E33\u865F\u4E0D\u662F\u7FA4\u7D44\u6210\u54E1",
            defaultReason: "\u7576\u524D\u5E33\u865F\u5C1A\u672A\u52A0\u5165\u6B64\u7FA4\u7D44"
          },
          "CHANNEL_PRIVATE": {
            title: "\u79C1\u6709\u7FA4\u7D44",
            defaultReason: "\u9019\u662F\u4E00\u500B\u79C1\u6709\u7FA4\u7D44\uFF0C\u9700\u8981\u5148\u52A0\u5165"
          },
          "CHANNEL_INVALID": {
            title: "\u7121\u6548\u7684\u7FA4\u7D44",
            defaultReason: "\u7FA4\u7D44\u53EF\u80FD\u5DF2\u88AB\u522A\u9664\u6216 ID \u7121\u6548"
          },
          "USERNAME_NOT_OCCUPIED": {
            title: "\u7121\u6CD5\u89E3\u6790\u7FA4\u7D44",
            defaultReason: "\u9019\u53EF\u80FD\u662F\u79C1\u6709\u7FA4\u7D44\uFF0C\u6C92\u6709\u516C\u958B\u7684 username"
          }
        };
        const errorInfo = errorMap[data.error_code] || {
          title: "\u63D0\u53D6\u5931\u6557",
          defaultReason: data.error || "\u672A\u77E5\u932F\u8AA4"
        };
        this.extractionError.set({
          code: data.error_code,
          title: errorInfo.title,
          reason: details.reason || errorInfo.defaultReason,
          suggestion: details.suggestion || "\u8ACB\u7A0D\u5F8C\u91CD\u8A66\u6216\u5617\u8A66\u5176\u4ED6\u65B9\u5F0F",
          alternative: details.alternative === "monitor_messages" ? "monitor" : void 0,
          canAutoJoin: details.can_auto_join
        });
      } else if (data.success) {
        this.extractionError.set(null);
      }
    });
    this.listeners.push(cleanup);
  }
  // 🆕 開啟消息監控（替代方案）
  enableMonitoring() {
    const group = this.group();
    if (group) {
      this.enableMonitoringEvent.emit(group);
      this.toast.info("\u{1F4E1} \u6B63\u5728\u958B\u555F\u6D88\u606F\u76E3\u63A7\uFF0C\u5C07\u81EA\u52D5\u6536\u96C6\u767C\u8A00\u7528\u6236");
      this.close();
    }
  }
  // 🆕 加入群組
  joinGroup() {
    const group = this.group();
    if (group) {
      this.joinGroupEvent.emit(group);
      this.toast.info("\u2795 \u6B63\u5728\u5617\u8A66\u52A0\u5165\u7FA4\u7D44...");
    }
  }
  // 選擇快速模板
  selectTemplate(template) {
    this.selectedTemplate.set(template);
    switch (template) {
      case "quick":
        this.config.update((c) => __spreadProps(__spreadValues({}, c), {
          limit: 100,
          filters: __spreadProps(__spreadValues({}, c.filters), {
            onlineStatus: "online",
            excludeBots: true
          })
        }));
        break;
      case "deep":
        this.config.update((c) => __spreadProps(__spreadValues({}, c), {
          limit: 500,
          filters: __spreadProps(__spreadValues({}, c.filters), {
            onlineStatus: "all",
            excludeBots: true
          })
        }));
        break;
      case "precise":
        break;
    }
  }
  // 設置提取數量
  setLimit(limit) {
    this.selectedTemplate.set("precise");
    this.config.update((c) => __spreadProps(__spreadValues({}, c), { limit }));
  }
  // 設置在線狀態
  setOnlineStatus(status) {
    this.selectedTemplate.set("precise");
    this.config.update((c) => __spreadProps(__spreadValues({}, c), {
      filters: __spreadProps(__spreadValues({}, c.filters), { onlineStatus: status })
    }));
  }
  // 切換篩選條件
  toggleFilter(key) {
    this.selectedTemplate.set("precise");
    this.config.update((c) => {
      const filters = __spreadValues({}, c.filters);
      if (key === "excludeBots" || key === "excludeAdmins") {
        filters[key] = !filters[key];
      } else {
        if (filters[key] === null || filters[key] === void 0) {
          filters[key] = true;
        } else if (filters[key] === true) {
          filters[key] = false;
        } else {
          filters[key] = null;
        }
      }
      return __spreadProps(__spreadValues({}, c), { filters });
    });
  }
  // 切換高級選項
  toggleAdvanced(key) {
    this.config.update((c) => __spreadProps(__spreadValues({}, c), {
      advanced: __spreadProps(__spreadValues({}, c.advanced), { [key]: !c.advanced[key] })
    }));
  }
  // 設置活躍度天數
  setActivityDays(event) {
    const value = event.target.value;
    const days = value ? parseInt(value, 10) : null;
    this.selectedTemplate.set("precise");
    this.config.update((c) => __spreadProps(__spreadValues({}, c), {
      filters: __spreadProps(__spreadValues({}, c.filters), { minActivityDays: days })
    }));
  }
  // 🆕 刷新成員數
  refreshMemberCount() {
    const groupInfo = this.group();
    if (!groupInfo)
      return;
    this.isRefreshingCount.set(true);
    const cleanup = this.ipcService.on("group-member-count-result", (data) => {
      this.isRefreshingCount.set(false);
      cleanup();
      if (data.success && data.memberCount > 0) {
        this.toast.success(`\u2705 \u6210\u529F\u7372\u53D6\u6210\u54E1\u6578\uFF1A${data.memberCount} \u4EBA`);
        this.memberCountRefreshed.emit({
          groupId: groupInfo.id,
          memberCount: data.memberCount
        });
      } else {
        this.toast.error(data.error || "\u7121\u6CD5\u7372\u53D6\u6210\u54E1\u6578\uFF0C\u8ACB\u78BA\u8A8D\u5DF2\u52A0\u5165\u8A72\u7FA4\u7D44");
      }
    });
    this.listeners.push(cleanup);
    this.ipcService.send("get-group-member-count", {
      groupId: groupInfo.id,
      url: groupInfo.url,
      telegramId: groupInfo.telegramId || groupInfo.id,
      accountPhone: groupInfo.accountPhone
    });
    setTimeout(() => {
      if (this.isRefreshingCount()) {
        this.isRefreshingCount.set(false);
        this.toast.error("\u7372\u53D6\u6210\u54E1\u6578\u8D85\u6642\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66");
      }
    }, 15e3);
  }
  // 開始提取
  startExtraction() {
    const groupInfo = this.group();
    if (!groupInfo) {
      this.toast.error("\u7FA4\u7D44\u4FE1\u606F\u4E0D\u5B58\u5728");
      return;
    }
    if (this.estimatedCount() === 0) {
      this.toast.warning("\u6210\u54E1\u6578\u64DA\u4E0D\u53EF\u7528\uFF0C\u8ACB\u5148\u9EDE\u64CA\u300C\u91CD\u65B0\u7372\u53D6\u6210\u54E1\u6578\u300D");
      return;
    }
    this.startExtractionEvent.emit({
      group: groupInfo,
      config: this.config()
    });
    this.close();
  }
  // 關閉對話框
  close() {
    this.closeDialog.emit();
  }
  // 背景點擊關閉
  onBackdropClick(event) {
    if (event.target === event.currentTarget) {
      this.close();
    }
  }
  // 🆕 確認監控狀態
  checkMonitoringStatus() {
    const group = this.group();
    if (!group)
      return;
    this.ipcService.send("get-group-monitoring-status", {
      groupId: group.id,
      telegramId: group.telegramId
    });
    const cleanup = this.ipcService.on("group-monitoring-status", (data) => {
      if (String(data.groupId) === String(group.id)) {
        this.isMonitoring.set(data.isMonitoring);
        this.collectedUsersCount.set(data.collectedUsers || 0);
        if (data.isMonitoring) {
          this.toast.success(`\u2705 \u76E3\u63A7\u5DF2\u958B\u555F\uFF0C\u5DF2\u6536\u96C6 ${data.collectedUsers} \u4F4D\u7528\u6236`);
        } else {
          this.toast.warning("\u26A0\uFE0F \u76E3\u63A7\u672A\u958B\u555F\uFF0C\u8ACB\u5728\u7FA4\u7D44\u8A73\u60C5\u4E2D\u958B\u555F\u76E3\u63A7");
        }
        cleanup();
      }
    });
    this.listeners.push(cleanup);
    this.toast.info("\u{1F50D} \u6B63\u5728\u6AA2\u67E5\u76E3\u63A7\u72C0\u614B...");
  }
  // 🆕 查看已收集用戶
  viewCollectedUsers() {
    const group = this.group();
    if (group) {
      this.viewCollectedUsersEvent.emit(group);
      this.close();
    }
  }
  // 🆕 從歷史消息收集用戶
  collectFromHistory() {
    const group = this.group();
    if (!group)
      return;
    this.toast.info("\u{1F504} \u6B63\u5728\u5F9E\u6B77\u53F2\u6D88\u606F\u4E2D\u6536\u96C6\u7528\u6236...");
    this.ipcService.send("collect-users-from-history", {
      groupId: group.id,
      telegramId: group.telegramId,
      limit: 500
    });
    const cleanup = this.ipcService.on("collect-from-history-result", (data) => {
      if (String(data.groupId) === String(group.id)) {
        cleanup();
        if (data.success) {
          this.toast.success(`\u2705 \u6536\u96C6\u5B8C\u6210\uFF01\u5171 ${data.collected} \u4F4D\u7528\u6236\uFF0C\u65B0\u589E ${data.newUsers || 0} \u4F4D`);
          this.collectedUsersCount.update((c) => c + (data.newUsers || 0));
        } else {
          this.toast.error(data.error || "\u6536\u96C6\u5931\u6557");
        }
      }
    });
    this.listeners.push(cleanup);
  }
  // 🆕 加載已收集用戶數量
  loadCollectedUsersCount() {
    const group = this.group();
    if (!group)
      return;
    this.ipcService.send("get-collected-users-count", {
      groupId: group.id,
      sourceType: "monitoring"
    });
    const cleanup = this.ipcService.on("collected-users-count", (data) => {
      if (String(data.groupId) === String(group.id)) {
        this.collectedUsersCount.set(data.count || 0);
        cleanup();
      }
    });
    this.listeners.push(cleanup);
  }
  static {
    this.\u0275fac = function MemberExtractionDialogComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _MemberExtractionDialogComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _MemberExtractionDialogComponent, selectors: [["app-member-extraction-dialog"]], inputs: { isOpen: [1, "isOpen"], group: [1, "group"] }, outputs: { closeDialog: "closeDialog", startExtractionEvent: "startExtractionEvent", memberCountRefreshed: "memberCountRefreshed", enableMonitoringEvent: "enableMonitoringEvent", joinGroupEvent: "joinGroupEvent", viewCollectedUsersEvent: "viewCollectedUsersEvent" }, decls: 1, vars: 1, consts: [[1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-[60]", "p-4"], [1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-[60]", "p-4", 3, "click"], [1, "bg-slate-900", "rounded-2xl", "w-full", "max-w-xl", "shadow-2xl", "border", "border-slate-700/50", "overflow-hidden", "max-h-[90vh]", "flex", "flex-col", 3, "click"], [1, "p-5", "border-b", "border-slate-700/50", "bg-gradient-to-r", "from-emerald-500/10", "to-cyan-500/10"], [1, "flex", "items-center", "justify-between"], [1, "flex", "items-center", "gap-3"], [1, "w-10", "h-10", "rounded-xl", "bg-gradient-to-br", "from-emerald-500", "to-cyan-500", "flex", "items-center", "justify-center", "text-xl"], [1, "text-lg", "font-bold", "text-white"], [1, "text-sm", "text-slate-400"], [1, "p-2", "hover:bg-slate-800", "rounded-lg", "transition-colors", "text-slate-400", "hover:text-white", 3, "click"], ["fill", "none", "stroke", "currentColor", "viewBox", "0 0 24 24", 1, "w-5", "h-5"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M6 18L18 6M6 6l12 12"], [1, "flex-1", "overflow-y-auto", "p-5", "space-y-5"], [1, "p-5", "border-t", "border-slate-700/50", "bg-slate-800/30"], [1, "flex", "items-center", "justify-between", "mb-4", "text-sm"], [1, "flex", "items-center", "gap-4"], [1, "text-slate-400"], [1, "text-emerald-400", "font-medium"], [1, "text-cyan-400", "font-medium"], [1, "flex", "gap-3"], [1, "flex-1", "py-3", "bg-slate-700", "hover:bg-slate-600", "text-slate-300", "rounded-xl", "transition-colors", "font-medium", 3, "click"], [1, "flex-1", "py-3", "bg-gradient-to-r", "from-emerald-500", "to-cyan-500", "hover:from-emerald-600", "hover:to-cyan-600", "text-white", "rounded-xl", "transition-all", "font-medium", "disabled:opacity-50", "disabled:cursor-not-allowed", "flex", "items-center", "justify-center", "gap-2", 3, "click", "disabled"], [1, "p-4", "bg-slate-800/50", "rounded-xl", "border", "border-slate-700/50"], [1, "w-12", "h-12", "rounded-xl", "bg-gradient-to-br", "from-emerald-500/20", "to-cyan-500/20", "flex", "items-center", "justify-center", "text-2xl"], [1, "flex-1"], [1, "font-medium", "text-white"], [1, "text-right"], [1, "p-4", "bg-amber-500/10", "border", "border-amber-500/30", "rounded-xl"], [1, "p-4", "bg-red-500/10", "border", "border-red-500/30", "rounded-xl"], [1, "border", 3, "bg-red-500/10", "border-red-500/30", "bg-amber-500/10", "border-amber-500/30"], [1, "text-lg", "font-bold", "text-emerald-400"], [1, "text-xs", "text-slate-500"], [1, "text-lg", "font-bold", "text-amber-400"], [1, "text-xs", "text-amber-400"], [1, "flex", "items-start", "gap-3"], [1, "text-xl"], [1, "font-medium", "text-amber-400", "mb-1"], [1, "text-sm", "text-slate-400", "mb-3"], [1, "text-sm", "text-slate-400", "space-y-1", "list-disc", "list-inside", "mb-3"], [1, "flex", "gap-2"], [1, "px-3", "py-1.5", "bg-amber-500/20", "hover:bg-amber-500/30", "text-amber-400", "rounded-lg", "text-sm", "transition-colors", "flex", "items-center", "gap-1", 3, "click", "disabled"], [1, "animate-spin"], [1, "font-medium", "text-red-400", "mb-1"], [1, "border"], [1, "font-medium", "mb-1"], [1, "text-sm", "text-slate-400", "mb-2"], [1, "p-3", "bg-slate-800/50", "rounded-lg"], [1, "mt-3", "px-4", "py-2", "bg-emerald-500/20", "hover:bg-emerald-500/30", "text-emerald-400", "rounded-lg", "text-sm", "transition-colors", "flex", "items-center", "gap-2"], [1, "p-3", "bg-slate-800/50", "rounded-lg", "mb-3"], [1, "text-sm", "text-slate-300", "mb-2"], [1, "text-sm", "text-slate-400", "space-y-1.5"], [1, "flex", "items-start", "gap-2"], [1, "text-emerald-400"], [1, "flex", "flex-wrap", "gap-2"], [1, "px-4", "py-2", "bg-emerald-500/20", "hover:bg-emerald-500/30", "text-emerald-400", "rounded-lg", "text-sm", "transition-colors", "flex", "items-center", "gap-2", 3, "click"], [1, "px-4", "py-2", "bg-orange-500/20", "hover:bg-orange-500/30", "text-orange-400", "rounded-lg", "text-sm", "transition-colors", "flex", "items-center", "gap-2", 3, "click"], [1, "px-4", "py-2", "bg-cyan-500/20", "hover:bg-cyan-500/30", "text-cyan-400", "rounded-lg", "text-sm", "transition-colors", "flex", "items-center", "gap-2", 3, "click"], [1, "text-sm", "text-cyan-400", "flex", "items-center", "gap-2"], [1, "mt-3", "px-4", "py-2", "bg-emerald-500/20", "hover:bg-emerald-500/30", "text-emerald-400", "rounded-lg", "text-sm", "transition-colors", "flex", "items-center", "gap-2", 3, "click"], [1, "block", "text-sm", "font-medium", "text-slate-300", "mb-3"], [1, "grid", "grid-cols-3", "gap-3"], [1, "p-4", "rounded-xl", "border", "transition-all", "text-center", "group", 3, "click"], [1, "text-2xl", "mb-1"], [1, "font-medium", "text-white", "text-sm"], [1, "text-xs", "text-slate-400", "mt-1"], [1, "px-4", "py-2", "rounded-lg", "border", "transition-all", "text-sm", 3, "border-emerald-500", "bg-emerald-500/20", "text-emerald-400", "border-slate-700", "bg-slate-800/50", "text-slate-400", "disabled"], [1, "grid", "grid-cols-4", "gap-2"], [1, "px-3", "py-2", "rounded-lg", "border", "transition-all", "text-sm", "text-center", 3, "border-cyan-500", "bg-cyan-500/20", "text-cyan-400", "border-slate-700", "bg-slate-800/50", "text-slate-400"], [1, "grid", "grid-cols-2", "gap-3"], [1, "flex", "items-center", "gap-3", "p-3", "bg-slate-800/50", "rounded-xl", "border", "border-slate-700/50", "cursor-pointer", "hover:bg-slate-800", "transition-colors"], ["type", "checkbox", 1, "rounded", "bg-slate-700", "border-slate-600", "text-emerald-500", "focus:ring-emerald-500", 3, "change", "checked"], [1, "text-sm", "text-white"], [1, "border", "border-slate-700/50", "rounded-xl", "overflow-hidden"], [1, "w-full", "p-4", "bg-slate-800/30", "flex", "items-center", "justify-between", "hover:bg-slate-800/50", "transition-colors", 3, "click"], [1, "text-sm", "font-medium", "text-slate-300"], ["fill", "none", "stroke", "currentColor", "viewBox", "0 0 24 24", 1, "w-4", "h-4", "text-slate-400", "transition-transform"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M19 9l-7 7-7-7"], [1, "p-4", "space-y-4", "border-t", "border-slate-700/50"], [1, "px-4", "py-2", "rounded-lg", "border", "transition-all", "text-sm", 3, "click", "disabled"], [1, "ml-1", "text-xs", "text-orange-400"], [1, "px-3", "py-2", "rounded-lg", "border", "transition-all", "text-sm", "text-center", 3, "click"], [1, "block", "text-sm", "text-slate-400", "mb-2"], [1, "flex", "items-center", "gap-2"], [1, "text-sm", "text-slate-300"], [1, "px-3", "py-1.5", "bg-slate-700", "border", "border-slate-600", "rounded-lg", "text-sm", "text-white", "focus:ring-emerald-500", "focus:border-emerald-500", 3, "change", "value"], ["value", ""], ["value", "3"], ["value", "7"], ["value", "14"], ["value", "30"], [1, "flex", "items-center", "gap-3", "cursor-pointer", "p-2", "bg-slate-700/30", "rounded-lg", "hover:bg-slate-700/50"]], template: function MemberExtractionDialogComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, MemberExtractionDialogComponent_Conditional_0_Template, 39, 7, "div", 0);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.isOpen() ? 0 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, NgSelectOption, \u0275NgSelectMultipleOption, DecimalPipe], encapsulation: 2 });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(MemberExtractionDialogComponent, [{
    type: Component,
    args: [{
      selector: "app-member-extraction-dialog",
      standalone: true,
      imports: [CommonModule, FormsModule],
      template: `
    @if (isOpen()) {
      <div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[60] p-4"
           (click)="onBackdropClick($event)">
        <div class="bg-slate-900 rounded-2xl w-full max-w-xl shadow-2xl border border-slate-700/50 overflow-hidden max-h-[90vh] flex flex-col"
             (click)="$event.stopPropagation()">
          
          <!-- \u982D\u90E8 -->
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-emerald-500/10 to-cyan-500/10">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center text-xl">
                  \u{1F465}
                </div>
                <div>
                  <h2 class="text-lg font-bold text-white">\u63D0\u53D6\u7FA4\u7D44\u6210\u54E1</h2>
                  <p class="text-sm text-slate-400">\u914D\u7F6E\u63D0\u53D6\u9078\u9805\u548C\u7BE9\u9078\u689D\u4EF6</p>
                </div>
              </div>
              <button (click)="close()" 
                      class="p-2 hover:bg-slate-800 rounded-lg transition-colors text-slate-400 hover:text-white">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
          </div>
          
          <!-- \u5167\u5BB9\u5340\u57DF -->
          <div class="flex-1 overflow-y-auto p-5 space-y-5">
            
            <!-- \u7FA4\u7D44\u4FE1\u606F -->
            @if (group()) {
              <div class="p-4 bg-slate-800/50 rounded-xl border border-slate-700/50">
                <div class="flex items-center gap-3">
                  <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500/20 to-cyan-500/20 flex items-center justify-center text-2xl">
                    {{ group()!.name[0] }}
                  </div>
                  <div class="flex-1">
                    <h3 class="font-medium text-white">{{ group()!.name }}</h3>
                    <p class="text-sm text-slate-400">{{ group()!.url || '\u79C1\u5BC6\u7FA4\u7D44' }}</p>
                  </div>
                  <div class="text-right">
                    @if (group()!.memberCount > 0) {
                      <p class="text-lg font-bold text-emerald-400">{{ group()!.memberCount | number }}</p>
                      <p class="text-xs text-slate-500">\u6210\u54E1\u6578</p>
                    } @else {
                      <p class="text-lg font-bold text-amber-400">?</p>
                      <p class="text-xs text-amber-400">\u7121\u6578\u64DA</p>
                    }
                  </div>
                </div>
              </div>
              
              <!-- \u{1F195} \u6210\u54E1\u6578\u70BA 0 \u6642\u7684\u932F\u8AA4\u63D0\u793A -->
              @if (group()!.memberCount === 0) {
                <div class="p-4 bg-amber-500/10 border border-amber-500/30 rounded-xl">
                  <div class="flex items-start gap-3">
                    <span class="text-xl">\u26A0\uFE0F</span>
                    <div class="flex-1">
                      <p class="font-medium text-amber-400 mb-1">\u7121\u6CD5\u7372\u53D6\u6210\u54E1\u6578\u64DA</p>
                      <p class="text-sm text-slate-400 mb-3">\u53EF\u80FD\u539F\u56E0\uFF1A</p>
                      <ul class="text-sm text-slate-400 space-y-1 list-disc list-inside mb-3">
                        <li>\u5C1A\u672A\u52A0\u5165\u8A72\u7FA4\u7D44</li>
                        <li>\u7FA4\u7D44\u5DF2\u8B8A\u70BA\u79C1\u6709</li>
                        <li>\u983B\u9053\u985E\u578B\u4E0D\u652F\u6301\u63D0\u53D6\u6210\u54E1</li>
                        <li>\u5E33\u865F\u88AB\u8E22\u51FA\u7FA4\u7D44</li>
                      </ul>
                      <div class="flex gap-2">
                        <button (click)="refreshMemberCount()"
                                [disabled]="isRefreshingCount()"
                                class="px-3 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 rounded-lg text-sm transition-colors flex items-center gap-1">
                          @if (isRefreshingCount()) {
                            <span class="animate-spin">\u23F3</span>
                            <span>\u7372\u53D6\u4E2D...</span>
                          } @else {
                            <span>\u{1F504}</span>
                            <span>\u91CD\u65B0\u7372\u53D6\u6210\u54E1\u6578</span>
                          }
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              }
              
              <!-- \u{1F195} \u983B\u9053\u985E\u578B\u8B66\u544A -->
              @if (isChannel()) {
                <div class="p-4 bg-red-500/10 border border-red-500/30 rounded-xl">
                  <div class="flex items-start gap-3">
                    <span class="text-xl">\u{1F6AB}</span>
                    <div class="flex-1">
                      <p class="font-medium text-red-400 mb-1">\u983B\u9053\u4E0D\u652F\u6301\u6210\u54E1\u63D0\u53D6</p>
                      <p class="text-sm text-slate-400">
                        Telegram \u983B\u9053\uFF08Channel\uFF09\u6C92\u6709\u6210\u54E1\u5217\u8868\uFF0C\u53EA\u6709\u8A02\u95B1\u8005\u3002
                        \u5982\u9700\u7372\u53D6\u8A02\u95B1\u8005\u4FE1\u606F\uFF0C\u8ACB\u4F7F\u7528\u983B\u9053\u5206\u6790\u529F\u80FD\u3002
                      </p>
                    </div>
                  </div>
                </div>
              }
              
              <!-- \u{1F195} \u6B0A\u9650\u932F\u8AA4\u63D0\u793A\uFF08API \u8FD4\u56DE\u7684\u932F\u8AA4\uFF09 -->
              @if (extractionError()) {
                <div class="p-4 rounded-xl"
                     [class.bg-red-500/10]="extractionError()!.code === 'ADMIN_REQUIRED'"
                     [class.border-red-500/30]="extractionError()!.code === 'ADMIN_REQUIRED'"
                     [class.bg-amber-500/10]="extractionError()!.code !== 'ADMIN_REQUIRED'"
                     [class.border-amber-500/30]="extractionError()!.code !== 'ADMIN_REQUIRED'"
                     class="border">
                  <div class="flex items-start gap-3">
                    <span class="text-xl">{{ extractionError()!.code === 'ADMIN_REQUIRED' ? '\u{1F512}' : '\u26A0\uFE0F' }}</span>
                    <div class="flex-1">
                      <p class="font-medium mb-1"
                         [class.text-red-400]="extractionError()!.code === 'ADMIN_REQUIRED'"
                         [class.text-amber-400]="extractionError()!.code !== 'ADMIN_REQUIRED'">
                        {{ extractionError()!.title }}
                      </p>
                      <p class="text-sm text-slate-400 mb-2">{{ extractionError()!.reason }}</p>
                      
                      <!-- \u{1F527} \u4FEE\u6539\uFF1A\u63D0\u4F9B\u5BE6\u969B\u53EF\u884C\u7684\u66FF\u4EE3\u65B9\u6848 -->
                      @if (extractionError()!.code === 'ADMIN_REQUIRED') {
                        <div class="p-3 bg-slate-800/50 rounded-lg mb-3">
                          <p class="text-sm text-slate-300 mb-2">\u{1F4CB} \u66FF\u4EE3\u65B9\u6848\uFF1A</p>
                          <ul class="text-sm text-slate-400 space-y-1.5">
                            <li class="flex items-start gap-2">
                              <span class="text-emerald-400">1.</span>
                              <span>\u78BA\u4FDD\u7FA4\u7D44\u76E3\u63A7\u5DF2\u958B\u555F\uFF0C\u7CFB\u7D71\u6703\u81EA\u52D5\u8A18\u9304\u767C\u8A00\u7528\u6236</span>
                            </li>
                            <li class="flex items-start gap-2">
                              <span class="text-emerald-400">2.</span>
                              <span>\u5728\u300C\u5DF2\u6536\u96C6\u7528\u6236\u300D\u6A19\u7C64\u9801\u67E5\u770B\u76E3\u63A7\u671F\u9593\u6536\u96C6\u7684\u7528\u6236</span>
                            </li>
                            <li class="flex items-start gap-2">
                              <span class="text-emerald-400">3.</span>
                              <span>\u6216\u806F\u7E6B\u7FA4\u4E3B\u7372\u53D6\u7BA1\u7406\u54E1\u6B0A\u9650</span>
                            </li>
                          </ul>
                        </div>
                        <div class="flex flex-wrap gap-2">
                          <button (click)="checkMonitoringStatus()"
                                  class="px-4 py-2 bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-400 rounded-lg text-sm transition-colors flex items-center gap-2">
                            <span>\u{1F4E1}</span>
                            <span>\u78BA\u8A8D\u76E3\u63A7\u72C0\u614B</span>
                          </button>
                          <button (click)="collectFromHistory()"
                                  class="px-4 py-2 bg-orange-500/20 hover:bg-orange-500/30 text-orange-400 rounded-lg text-sm transition-colors flex items-center gap-2">
                            <span>\u{1F504}</span>
                            <span>\u5F9E\u6B77\u53F2\u6536\u96C6</span>
                          </button>
                          <button (click)="viewCollectedUsers()"
                                  class="px-4 py-2 bg-cyan-500/20 hover:bg-cyan-500/30 text-cyan-400 rounded-lg text-sm transition-colors flex items-center gap-2">
                            <span>\u{1F465}</span>
                            <span>\u67E5\u770B\u5DF2\u6536\u96C6 ({{ collectedUsersCount() }})</span>
                          </button>
                        </div>
                      } @else {
                        <div class="p-3 bg-slate-800/50 rounded-lg">
                          <p class="text-sm text-cyan-400 flex items-center gap-2">
                            <span>\u{1F4A1}</span>
                            <span>{{ extractionError()!.suggestion }}</span>
                          </p>
                        </div>
                      }
                      
                      @if (extractionError()!.canAutoJoin) {
                        <button (click)="joinGroup()"
                                class="mt-3 px-4 py-2 bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-400 rounded-lg text-sm transition-colors flex items-center gap-2">
                          <span>\u2795</span>
                          <span>\u52A0\u5165\u7FA4\u7D44</span>
                        </button>
                      }
                    </div>
                  </div>
                </div>
              }
            }
            
            <!-- \u5FEB\u901F\u6A21\u677F -->
            @if (!isChannel()) {
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-3">
                \u26A1 \u5FEB\u901F\u6A21\u677F
              </label>
              <div class="grid grid-cols-3 gap-3">
                <button (click)="selectTemplate('quick')"
                        class="p-4 rounded-xl border transition-all text-center group"
                        [class.border-emerald-500]="selectedTemplate() === 'quick'"
                        [class.bg-emerald-500/20]="selectedTemplate() === 'quick'"
                        [class.border-slate-700]="selectedTemplate() !== 'quick'"
                        [class.bg-slate-800/50]="selectedTemplate() !== 'quick'">
                  <div class="text-2xl mb-1">\u26A1</div>
                  <p class="font-medium text-white text-sm">\u5FEB\u901F\u63D0\u53D6</p>
                  <p class="text-xs text-slate-400 mt-1">100\u4EBA \xB7 \u50C5\u5728\u7DDA</p>
                </button>
                <button (click)="selectTemplate('deep')"
                        class="p-4 rounded-xl border transition-all text-center group"
                        [class.border-blue-500]="selectedTemplate() === 'deep'"
                        [class.bg-blue-500/20]="selectedTemplate() === 'deep'"
                        [class.border-slate-700]="selectedTemplate() !== 'deep'"
                        [class.bg-slate-800/50]="selectedTemplate() !== 'deep'">
                  <div class="text-2xl mb-1">\u{1F50D}</div>
                  <p class="font-medium text-white text-sm">\u6DF1\u5EA6\u63D0\u53D6</p>
                  <p class="text-xs text-slate-400 mt-1">500\u4EBA \xB7 \u5168\u72C0\u614B</p>
                </button>
                <button (click)="selectTemplate('precise')"
                        class="p-4 rounded-xl border transition-all text-center group"
                        [class.border-purple-500]="selectedTemplate() === 'precise'"
                        [class.bg-purple-500/20]="selectedTemplate() === 'precise'"
                        [class.border-slate-700]="selectedTemplate() !== 'precise'"
                        [class.bg-slate-800/50]="selectedTemplate() !== 'precise'">
                  <div class="text-2xl mb-1">\u{1F3AF}</div>
                  <p class="font-medium text-white text-sm">\u7CBE\u6E96\u63D0\u53D6</p>
                  <p class="text-xs text-slate-400 mt-1">\u81EA\u5B9A\u7FA9\u689D\u4EF6</p>
                </button>
              </div>
            </div>
            
            <!-- \u63D0\u53D6\u6578\u91CF -->
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-3">
                \u{1F522} \u63D0\u53D6\u6578\u91CF
              </label>
              <div class="flex flex-wrap gap-2">
                @for (option of limitOptions; track option.value) {
                  <button (click)="setLimit(option.value)"
                          class="px-4 py-2 rounded-lg border transition-all text-sm"
                          [class.border-emerald-500]="config().limit === option.value"
                          [class.bg-emerald-500/20]="config().limit === option.value"
                          [class.text-emerald-400]="config().limit === option.value"
                          [class.border-slate-700]="config().limit !== option.value"
                          [class.bg-slate-800/50]="config().limit !== option.value"
                          [class.text-slate-400]="config().limit !== option.value"
                          [disabled]="option.value > maxLimit()">
                    {{ option.label }}
                    @if (option.value > maxLimit()) {
                      <span class="ml-1 text-xs text-orange-400">\u{1F512}</span>
                    }
                  </button>
                }
              </div>
            </div>
            
            <!-- \u5728\u7DDA\u72C0\u614B -->
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-3">
                \u{1F4CD} \u5728\u7DDA\u72C0\u614B
              </label>
              <div class="grid grid-cols-4 gap-2">
                @for (option of onlineStatusOptions; track option.value) {
                  <button (click)="setOnlineStatus(option.value)"
                          class="px-3 py-2 rounded-lg border transition-all text-sm text-center"
                          [class.border-cyan-500]="config().filters.onlineStatus === option.value"
                          [class.bg-cyan-500/20]="config().filters.onlineStatus === option.value"
                          [class.text-cyan-400]="config().filters.onlineStatus === option.value"
                          [class.border-slate-700]="config().filters.onlineStatus !== option.value"
                          [class.bg-slate-800/50]="config().filters.onlineStatus !== option.value"
                          [class.text-slate-400]="config().filters.onlineStatus !== option.value">
                    {{ option.icon }} {{ option.label }}
                  </button>
                }
              </div>
            </div>
            
            <!-- \u6210\u54E1\u5C6C\u6027\u7BE9\u9078 -->
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-3">
                \u{1F3F7}\uFE0F \u6210\u54E1\u5C6C\u6027
              </label>
              <div class="grid grid-cols-2 gap-3">
                <label class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-xl border border-slate-700/50 cursor-pointer hover:bg-slate-800 transition-colors">
                  <input type="checkbox"
                         [checked]="config().filters.excludeBots"
                         (change)="toggleFilter('excludeBots')"
                         class="rounded bg-slate-700 border-slate-600 text-emerald-500 focus:ring-emerald-500">
                  <div>
                    <p class="text-sm text-white">\u6392\u9664\u6A5F\u5668\u4EBA</p>
                    <p class="text-xs text-slate-500">\u904E\u6FFE Bot \u5E33\u865F</p>
                  </div>
                </label>
                
                <label class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-xl border border-slate-700/50 cursor-pointer hover:bg-slate-800 transition-colors">
                  <input type="checkbox"
                         [checked]="config().filters.hasUsername === true"
                         (change)="toggleFilter('hasUsername')"
                         class="rounded bg-slate-700 border-slate-600 text-emerald-500 focus:ring-emerald-500">
                  <div>
                    <p class="text-sm text-white">\u9700\u6709\u7528\u6236\u540D</p>
                    <p class="text-xs text-slate-500">\u50C5\u63D0\u53D6\u6709 &#64;username</p>
                  </div>
                </label>
                
                <label class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-xl border border-slate-700/50 cursor-pointer hover:bg-slate-800 transition-colors">
                  <input type="checkbox"
                         [checked]="config().filters.hasChinese === true"
                         (change)="toggleFilter('hasChinese')"
                         class="rounded bg-slate-700 border-slate-600 text-emerald-500 focus:ring-emerald-500">
                  <div>
                    <p class="text-sm text-white">\u50C5\u83EF\u4EBA\u7528\u6236</p>
                    <p class="text-xs text-slate-500">\u4E2D\u6587\u540D\u7A31\u512A\u5148</p>
                  </div>
                </label>
                
                <label class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-xl border border-slate-700/50 cursor-pointer hover:bg-slate-800 transition-colors">
                  <input type="checkbox"
                         [checked]="config().filters.isPremium === true"
                         (change)="toggleFilter('isPremium')"
                         class="rounded bg-slate-700 border-slate-600 text-emerald-500 focus:ring-emerald-500">
                  <div>
                    <p class="text-sm text-white">Premium \u7528\u6236</p>
                    <p class="text-xs text-slate-500">\u50C5\u4ED8\u8CBB\u6703\u54E1 \u2B50</p>
                  </div>
                </label>
              </div>
            </div>
            
            <!-- \u9AD8\u7D1A\u9078\u9805 (\u53EF\u6298\u758A) -->
            <div class="border border-slate-700/50 rounded-xl overflow-hidden">
              <button (click)="showAdvanced.set(!showAdvanced())"
                      class="w-full p-4 bg-slate-800/30 flex items-center justify-between hover:bg-slate-800/50 transition-colors">
                <span class="text-sm font-medium text-slate-300">\u2699\uFE0F \u9AD8\u7D1A\u9078\u9805</span>
                <svg class="w-4 h-4 text-slate-400 transition-transform"
                     [class.rotate-180]="showAdvanced()"
                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </button>
              @if (showAdvanced()) {
                <div class="p-4 space-y-4 border-t border-slate-700/50">
                  <!-- \u6D3B\u8E8D\u5EA6\u7BE9\u9078 -->
                  <div>
                    <label class="block text-sm text-slate-400 mb-2">\u23F0 \u6D3B\u8E8D\u5EA6\u7BE9\u9078</label>
                    <div class="flex items-center gap-2">
                      <span class="text-sm text-slate-300">\u6700\u8FD1</span>
                      <select [value]="config().filters.minActivityDays || ''"
                              (change)="setActivityDays($event)"
                              class="px-3 py-1.5 bg-slate-700 border border-slate-600 rounded-lg text-sm text-white focus:ring-emerald-500 focus:border-emerald-500">
                        <option value="">\u4E0D\u9650</option>
                        <option value="3">3 \u5929</option>
                        <option value="7">7 \u5929</option>
                        <option value="14">14 \u5929</option>
                        <option value="30">30 \u5929</option>
                      </select>
                      <span class="text-sm text-slate-300">\u5167\u6D3B\u52D5</span>
                    </div>
                  </div>
                  
                  <!-- \u5176\u4ED6\u9078\u9805 -->
                  <div class="grid grid-cols-2 gap-3">
                    <label class="flex items-center gap-3 cursor-pointer p-2 bg-slate-700/30 rounded-lg hover:bg-slate-700/50">
                      <input type="checkbox"
                             [checked]="config().advanced.autoSaveToResources"
                             (change)="toggleAdvanced('autoSaveToResources')"
                             class="rounded bg-slate-700 border-slate-600 text-emerald-500 focus:ring-emerald-500">
                      <div>
                        <p class="text-sm text-white">\u81EA\u52D5\u4FDD\u5B58</p>
                        <p class="text-xs text-slate-500">\u540C\u6B65\u5230\u8CC7\u6E90\u4E2D\u5FC3</p>
                      </div>
                    </label>
                    
                    <label class="flex items-center gap-3 cursor-pointer p-2 bg-slate-700/30 rounded-lg hover:bg-slate-700/50">
                      <input type="checkbox"
                             [checked]="config().advanced.skipDuplicates"
                             (change)="toggleAdvanced('skipDuplicates')"
                             class="rounded bg-slate-700 border-slate-600 text-emerald-500 focus:ring-emerald-500">
                      <div>
                        <p class="text-sm text-white">\u8DF3\u904E\u91CD\u8907</p>
                        <p class="text-xs text-slate-500">\u5DF2\u5B58\u5728\u7684\u6210\u54E1</p>
                      </div>
                    </label>
                    
                    <label class="flex items-center gap-3 cursor-pointer p-2 bg-slate-700/30 rounded-lg hover:bg-slate-700/50">
                      <input type="checkbox"
                             [checked]="config().filters.excludeAdmins"
                             (change)="toggleFilter('excludeAdmins')"
                             class="rounded bg-slate-700 border-slate-600 text-emerald-500 focus:ring-emerald-500">
                      <div>
                        <p class="text-sm text-white">\u6392\u9664\u7BA1\u7406\u54E1</p>
                        <p class="text-xs text-slate-500">\u7FA4\u4E3B\u548C\u7BA1\u7406\u54E1</p>
                      </div>
                    </label>
                    
                    <label class="flex items-center gap-3 cursor-pointer p-2 bg-slate-700/30 rounded-lg hover:bg-slate-700/50">
                      <input type="checkbox"
                             [checked]="config().advanced.shuffleOrder"
                             (change)="toggleAdvanced('shuffleOrder')"
                             class="rounded bg-slate-700 border-slate-600 text-emerald-500 focus:ring-emerald-500">
                      <div>
                        <p class="text-sm text-white">\u96A8\u6A5F\u9806\u5E8F</p>
                        <p class="text-xs text-slate-500">\u6253\u4E82\u63D0\u53D6\u9806\u5E8F</p>
                      </div>
                    </label>
                  </div>
                </div>
              }
            </div>
            }
            
          </div>
          
          <!-- \u5E95\u90E8\u9810\u4F30\u548C\u6309\u9215 -->
          <div class="p-5 border-t border-slate-700/50 bg-slate-800/30">
            <!-- \u9810\u4F30\u4FE1\u606F -->
            <div class="flex items-center justify-between mb-4 text-sm">
              <div class="flex items-center gap-4">
                <span class="text-slate-400">
                  \u{1F4A1} \u9810\u8A08\u63D0\u53D6\uFF1A
                  <span class="text-emerald-400 font-medium">{{ estimatedCount() }}</span> \u4EBA
                </span>
              </div>
              <div class="text-slate-400">
                \u{1F4CA} \u4ECA\u65E5\u914D\u984D\uFF1A
                <span class="text-cyan-400 font-medium">{{ remainingQuota() }}</span> / {{ dailyQuota() }}
              </div>
            </div>
            
            <!-- \u6309\u9215 -->
            <div class="flex gap-3">
              <button (click)="close()"
                      class="flex-1 py-3 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-xl transition-colors font-medium">
                \u53D6\u6D88
              </button>
              <button (click)="startExtraction()"
                      [disabled]="!canStart()"
                      class="flex-1 py-3 bg-gradient-to-r from-emerald-500 to-cyan-500 hover:from-emerald-600 hover:to-cyan-600 text-white rounded-xl transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                <span>\u{1F465}</span>
                <span>\u958B\u59CB\u63D0\u53D6 ({{ config().limit }} \u4EBA)</span>
              </button>
            </div>
          </div>
          
        </div>
      </div>
    }
  `
    }]
  }], null, { isOpen: [{ type: Input, args: [{ isSignal: true, alias: "isOpen", required: false }] }], group: [{ type: Input, args: [{ isSignal: true, alias: "group", required: false }] }], closeDialog: [{ type: Output, args: ["closeDialog"] }], startExtractionEvent: [{ type: Output, args: ["startExtractionEvent"] }], memberCountRefreshed: [{ type: Output, args: ["memberCountRefreshed"] }], enableMonitoringEvent: [{ type: Output, args: ["enableMonitoringEvent"] }], joinGroupEvent: [{ type: Output, args: ["joinGroupEvent"] }], viewCollectedUsersEvent: [{ type: Output, args: ["viewCollectedUsersEvent"] }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(MemberExtractionDialogComponent, { className: "MemberExtractionDialogComponent", filePath: "src/dialogs/member-extraction-dialog.component.ts", lineNumber: 512 });
})();

// src/components/command-palette.component.ts
var _forTrack012 = ($index, $item) => $item.title;
var _forTrack14 = ($index, $item) => $item.id;
function CommandPaletteComponent_Conditional_0_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 11)(1, "div", 16);
    \u0275\u0275text(2, "\u{1F50D}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 17);
    \u0275\u0275text(4, "\u672A\u627E\u5230\u5339\u914D\u7684\u7D50\u679C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 18);
    \u0275\u0275text(6, "\u5617\u8A66\u5176\u4ED6\u95DC\u9375\u8A5E");
    \u0275\u0275elementEnd()();
  }
}
function CommandPaletteComponent_Conditional_0_Conditional_12_For_1_For_4_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 26);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const item_r4 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(item_r4.subtitle);
  }
}
function CommandPaletteComponent_Conditional_0_Conditional_12_For_1_For_4_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "kbd", 9);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const item_r4 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", item_r4.shortcut, " ");
  }
}
function CommandPaletteComponent_Conditional_0_Conditional_12_For_1_For_4_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 22);
    \u0275\u0275listener("click", function CommandPaletteComponent_Conditional_0_Conditional_12_For_1_For_4_Template_div_click_0_listener() {
      const item_r4 = \u0275\u0275restoreView(_r3).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r1.executeCommand(item_r4));
    })("mouseenter", function CommandPaletteComponent_Conditional_0_Conditional_12_For_1_For_4_Template_div_mouseenter_0_listener() {
      const \u0275$index_40_r5 = \u0275\u0275restoreView(_r3).$index;
      const group_r6 = \u0275\u0275nextContext().$implicit;
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.selectedIndex.set(ctx_r1.getGlobalIndex(group_r6, \u0275$index_40_r5)));
    });
    \u0275\u0275elementStart(1, "div", 23);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 24)(4, "div", 25);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(6, CommandPaletteComponent_Conditional_0_Conditional_12_For_1_For_4_Conditional_6_Template, 2, 1, "div", 26);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "span", 27);
    \u0275\u0275text(8);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(9, CommandPaletteComponent_Conditional_0_Conditional_12_For_1_For_4_Conditional_9_Template, 2, 1, "kbd", 9);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const item_r4 = ctx.$implicit;
    const \u0275$index_40_r5 = ctx.$index;
    const group_r6 = \u0275\u0275nextContext().$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275classProp("bg-cyan-500/20", ctx_r1.isSelected(group_r6, \u0275$index_40_r5))("hover:bg-slate-800", !ctx_r1.isSelected(group_r6, \u0275$index_40_r5));
    \u0275\u0275advance();
    \u0275\u0275classProp("bg-cyan-500/20", ctx_r1.isSelected(group_r6, \u0275$index_40_r5))("bg-slate-800", !ctx_r1.isSelected(group_r6, \u0275$index_40_r5));
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", item_r4.icon, " ");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(item_r4.title);
    \u0275\u0275advance();
    \u0275\u0275conditional(item_r4.subtitle ? 6 : -1);
    \u0275\u0275advance();
    \u0275\u0275classProp("bg-blue-500/20", item_r4.type === "page")("text-blue-400", item_r4.type === "page")("bg-green-500/20", item_r4.type === "action")("text-green-400", item_r4.type === "action")("bg-purple-500/20", item_r4.type === "contact")("text-purple-400", item_r4.type === "contact")("bg-amber-500/20", item_r4.type === "recent")("text-amber-400", item_r4.type === "recent");
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.getTypeLabel(item_r4.type), " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(item_r4.shortcut ? 9 : -1);
  }
}
function CommandPaletteComponent_Conditional_0_Conditional_12_For_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 19)(1, "div", 20);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275repeaterCreate(3, CommandPaletteComponent_Conditional_0_Conditional_12_For_1_For_4_Template, 10, 29, "div", 21, _forTrack14);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const group_r6 = ctx.$implicit;
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", group_r6.title, " ");
    \u0275\u0275advance();
    \u0275\u0275repeater(group_r6.items);
  }
}
function CommandPaletteComponent_Conditional_0_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275repeaterCreate(0, CommandPaletteComponent_Conditional_0_Conditional_12_For_1_Template, 5, 1, "div", 19, _forTrack012);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275repeater(ctx_r1.filteredGroups());
  }
}
function CommandPaletteComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 2);
    \u0275\u0275listener("click", function CommandPaletteComponent_Conditional_0_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.close());
    });
    \u0275\u0275element(1, "div", 3);
    \u0275\u0275elementStart(2, "div", 4);
    \u0275\u0275listener("click", function CommandPaletteComponent_Conditional_0_Template_div_click_2_listener($event) {
      \u0275\u0275restoreView(_r1);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275elementStart(3, "div", 5);
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(4, "svg", 6);
    \u0275\u0275element(5, "path", 7);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(6, "input", 8, 0);
    \u0275\u0275twoWayListener("ngModelChange", function CommandPaletteComponent_Conditional_0_Template_input_ngModelChange_6_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.query, $event) || (ctx_r1.query = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275listener("ngModelChange", function CommandPaletteComponent_Conditional_0_Template_input_ngModelChange_6_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.onQueryChange($event));
    })("keydown", function CommandPaletteComponent_Conditional_0_Template_input_keydown_6_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.onKeyDown($event));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "kbd", 9);
    \u0275\u0275text(9, "ESC");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(10, "div", 10);
    \u0275\u0275conditionalCreate(11, CommandPaletteComponent_Conditional_0_Conditional_11_Template, 7, 0, "div", 11)(12, CommandPaletteComponent_Conditional_0_Conditional_12_Template, 2, 0);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "div", 12)(14, "div", 13)(15, "span", 14)(16, "kbd", 15);
    \u0275\u0275text(17, "\u2191");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "kbd", 15);
    \u0275\u0275text(19, "\u2193");
    \u0275\u0275elementEnd();
    \u0275\u0275text(20, " \u5C0E\u822A ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(21, "span", 14)(22, "kbd", 15);
    \u0275\u0275text(23, "\u21B5");
    \u0275\u0275elementEnd();
    \u0275\u0275text(24, " \u9078\u64C7 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(25, "span", 14)(26, "kbd", 15);
    \u0275\u0275text(27, "ESC");
    \u0275\u0275elementEnd();
    \u0275\u0275text(28, " \u95DC\u9589 ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(29, "span");
    \u0275\u0275text(30, "TG-Matrix \u547D\u4EE4\u9762\u677F");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275classProp("animate-fade-in", ctx_r1.animateIn());
    \u0275\u0275advance(2);
    \u0275\u0275classProp("animate-slide-down", ctx_r1.animateIn());
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.query);
    \u0275\u0275advance(5);
    \u0275\u0275conditional(ctx_r1.filteredGroups().length === 0 ? 11 : 12);
  }
}
var CommandPaletteComponent = class _CommandPaletteComponent {
  constructor() {
    this.navigate = output();
    this.isOpen = signal(false, ...ngDevMode ? [{ debugName: "isOpen" }] : []);
    this.animateIn = signal(true, ...ngDevMode ? [{ debugName: "animateIn" }] : []);
    this.query = "";
    this.selectedIndex = signal(0, ...ngDevMode ? [{ debugName: "selectedIndex" }] : []);
    this.recentPages = signal([], ...ngDevMode ? [{ debugName: "recentPages" }] : []);
    this.commands = signal([], ...ngDevMode ? [{ debugName: "commands" }] : []);
    this.filteredGroups = computed(() => {
      const q = this.query.toLowerCase().trim();
      const commands = this.commands();
      if (!q) {
        return this.getDefaultGroups(commands);
      }
      const matched = commands.filter((cmd) => cmd.title.toLowerCase().includes(q) || cmd.subtitle?.toLowerCase().includes(q) || cmd.keywords.some((kw) => kw.toLowerCase().includes(q)));
      return this.groupByType(matched);
    }, ...ngDevMode ? [{ debugName: "filteredGroups" }] : []);
  }
  ngOnInit() {
    this.initCommands();
    this.loadRecentPages();
  }
  ngOnDestroy() {
  }
  /**
   * 初始化命令列表
   */
  initCommands() {
    const commands = [
      // 頁面導航
      { id: "nav-dashboard", type: "page", icon: "\u{1F4CA}", title: "\u5100\u8868\u677F", subtitle: "\u67E5\u770B\u7CFB\u7D71\u6982\u89BD", keywords: ["dashboard", "\u9996\u9801", "\u6982\u89BD"], action: () => this.navigateTo("dashboard") },
      { id: "nav-accounts", type: "page", icon: "\u{1F464}", title: "\u5E33\u865F\u7BA1\u7406", subtitle: "\u7BA1\u7406 Telegram \u5E33\u865F", keywords: ["accounts", "\u5E33\u6236", "\u767B\u9304"], action: () => this.navigateTo("accounts") },
      { id: "nav-resource", type: "page", icon: "\u{1F4C7}", title: "\u8CC7\u6E90\u4E2D\u5FC3", subtitle: "\u7BA1\u7406\u806F\u7E6B\u4EBA\u548C\u7FA4\u7D44", keywords: ["resource", "\u806F\u7E6B\u4EBA", "\u7FA4\u7D44", "contacts"], action: () => this.navigateTo("resource-center") },
      { id: "nav-ai-assistant", type: "page", icon: "\u{1F3AF}", title: "\u7B56\u7565\u898F\u5283", subtitle: "AI \u71DF\u92B7\u52A9\u624B", keywords: ["ai", "\u71DF\u92B7", "\u7B56\u7565", "marketing"], action: () => this.navigateTo("ai-assistant") },
      { id: "nav-ai-team", type: "page", icon: "\u{1F916}", title: "\u81EA\u52D5\u57F7\u884C", subtitle: "AI \u5718\u968A\u92B7\u552E", keywords: ["ai", "\u5718\u968A", "\u81EA\u52D5", "team"], action: () => this.navigateTo("ai-team") },
      { id: "nav-analytics", type: "page", icon: "\u{1F4C8}", title: "\u6578\u64DA\u6D1E\u5BDF", subtitle: "\u667A\u80FD\u5206\u6790\u5831\u544A", keywords: ["analytics", "\u5206\u6790", "\u5831\u544A", "\u7D71\u8A08"], action: () => this.navigateTo("analytics") },
      { id: "nav-automation", type: "page", icon: "\u26A1", title: "\u81EA\u52D5\u5316\u4E2D\u5FC3", subtitle: "\u76E3\u63A7\u548C\u81EA\u52D5\u56DE\u8986", keywords: ["automation", "\u81EA\u52D5\u5316", "\u76E3\u63A7"], action: () => this.navigateTo("automation") },
      { id: "nav-leads", type: "page", icon: "\u{1F3AF}", title: "\u6F5B\u5728\u5BA2\u6236", subtitle: "\u5BA2\u6236\u7BA1\u7406", keywords: ["leads", "\u5BA2\u6236", "crm"], action: () => this.navigateTo("leads") },
      { id: "nav-settings", type: "page", icon: "\u2699\uFE0F", title: "\u7CFB\u7D71\u8A2D\u7F6E", subtitle: "\u914D\u7F6E\u7CFB\u7D71\u9078\u9805", keywords: ["settings", "\u8A2D\u7F6E", "\u914D\u7F6E"], action: () => this.navigateTo("settings") },
      // 快速操作
      { id: "action-add-account", type: "action", icon: "\u2795", title: "\u6DFB\u52A0\u5E33\u865F", subtitle: "\u6DFB\u52A0\u65B0\u7684 Telegram \u5E33\u865F", keywords: ["add", "account", "\u65B0\u589E"], shortcut: "\u2318N", action: () => this.navigateTo("add-account") },
      { id: "action-send-message", type: "action", icon: "\u2709\uFE0F", title: "\u767C\u9001\u6D88\u606F", subtitle: "\u5411\u806F\u7E6B\u4EBA\u767C\u9001\u6D88\u606F", keywords: ["send", "message", "\u767C\u9001"], action: () => this.emitAction("send-message") },
      { id: "action-extract", type: "action", icon: "\u{1F4E5}", title: "\u63D0\u53D6\u6210\u54E1", subtitle: "\u5F9E\u7FA4\u7D44\u63D0\u53D6\u6210\u54E1", keywords: ["extract", "member", "\u63D0\u53D6"], action: () => this.emitAction("extract-members") },
      { id: "action-search-group", type: "action", icon: "\u{1F50D}", title: "\u641C\u7D22\u7FA4\u7D44", subtitle: "\u641C\u7D22 Telegram \u7FA4\u7D44", keywords: ["search", "group", "\u641C\u7D22"], action: () => this.emitAction("search-groups") },
      { id: "action-start-monitor", type: "action", icon: "\u{1F4E1}", title: "\u555F\u52D5\u76E3\u63A7", subtitle: "\u958B\u59CB\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F", keywords: ["monitor", "start", "\u76E3\u63A7"], action: () => this.emitAction("start-monitor") },
      { id: "action-refresh", type: "action", icon: "\u{1F504}", title: "\u5237\u65B0\u6578\u64DA", subtitle: "\u91CD\u65B0\u52A0\u8F09\u6578\u64DA", keywords: ["refresh", "reload", "\u5237\u65B0"], shortcut: "\u2318R", action: () => this.emitAction("refresh") },
      // 幫助
      { id: "help-docs", type: "help", icon: "\u{1F4D6}", title: "\u5E6B\u52A9\u6587\u6A94", subtitle: "\u67E5\u770B\u4F7F\u7528\u6307\u5357", keywords: ["help", "docs", "\u5E6B\u52A9", "\u6587\u6A94"], action: () => this.emitAction("open-docs") },
      { id: "help-shortcuts", type: "help", icon: "\u2328\uFE0F", title: "\u5FEB\u6377\u9375", subtitle: "\u67E5\u770B\u6240\u6709\u5FEB\u6377\u9375", keywords: ["shortcuts", "keyboard", "\u5FEB\u6377\u9375"], action: () => this.emitAction("show-shortcuts") },
      { id: "help-feedback", type: "help", icon: "\u{1F4AC}", title: "\u610F\u898B\u53CD\u994B", subtitle: "\u63D0\u4EA4\u554F\u984C\u6216\u5EFA\u8B70", keywords: ["feedback", "\u53CD\u994B", "\u5EFA\u8B70"], action: () => this.emitAction("open-feedback") }
    ];
    this.commands.set(commands);
  }
  /**
   * 獲取默認分組
   */
  getDefaultGroups(commands) {
    const recent = this.recentPages();
    const groups = [];
    if (recent.length > 0) {
      const recentItems = commands.filter((cmd) => recent.includes(cmd.id)).sort((a, b) => recent.indexOf(a.id) - recent.indexOf(b.id)).slice(0, 5).map((cmd) => __spreadProps(__spreadValues({}, cmd), { type: "recent" }));
      if (recentItems.length > 0) {
        groups.push({ title: "\u6700\u8FD1\u8A2A\u554F", items: recentItems });
      }
    }
    const recommended = commands.filter((cmd) => cmd.type === "page").slice(0, 6);
    groups.push({ title: "\u9801\u9762", items: recommended });
    const actions = commands.filter((cmd) => cmd.type === "action").slice(0, 4);
    groups.push({ title: "\u5FEB\u901F\u64CD\u4F5C", items: actions });
    return groups;
  }
  /**
   * 按類型分組
   */
  groupByType(items) {
    const groups = [];
    const pages = items.filter((i) => i.type === "page");
    const actions = items.filter((i) => i.type === "action");
    const contacts = items.filter((i) => i.type === "contact");
    const help = items.filter((i) => i.type === "help");
    if (pages.length > 0)
      groups.push({ title: "\u9801\u9762", items: pages });
    if (actions.length > 0)
      groups.push({ title: "\u64CD\u4F5C", items: actions });
    if (contacts.length > 0)
      groups.push({ title: "\u806F\u7E6B\u4EBA", items: contacts });
    if (help.length > 0)
      groups.push({ title: "\u5E6B\u52A9", items: help });
    return groups;
  }
  /**
   * 監聽全局鍵盤事件
   */
  onGlobalKeyDown(event) {
    if ((event.metaKey || event.ctrlKey) && event.key === "k") {
      event.preventDefault();
      this.toggle();
    }
    if (event.key === "Escape" && this.isOpen()) {
      event.preventDefault();
      this.close();
    }
  }
  /**
   * 輸入框鍵盤事件
   */
  onKeyDown(event) {
    const groups = this.filteredGroups();
    const totalItems = groups.reduce((sum, g) => sum + g.items.length, 0);
    switch (event.key) {
      case "ArrowDown":
        event.preventDefault();
        this.selectedIndex.update((i) => (i + 1) % totalItems);
        break;
      case "ArrowUp":
        event.preventDefault();
        this.selectedIndex.update((i) => (i - 1 + totalItems) % totalItems);
        break;
      case "Enter":
        event.preventDefault();
        const item = this.getSelectedItem();
        if (item) {
          this.executeCommand(item);
        }
        break;
    }
  }
  /**
   * 搜索變更
   */
  onQueryChange(value) {
    this.selectedIndex.set(0);
  }
  /**
   * 獲取選中的項目
   */
  getSelectedItem() {
    const groups = this.filteredGroups();
    let currentIndex = 0;
    for (const group of groups) {
      for (const item of group.items) {
        if (currentIndex === this.selectedIndex()) {
          return item;
        }
        currentIndex++;
      }
    }
    return null;
  }
  /**
   * 獲取全局索引
   */
  getGlobalIndex(group, itemIndex) {
    const groups = this.filteredGroups();
    let globalIndex = 0;
    for (const g of groups) {
      if (g === group) {
        return globalIndex + itemIndex;
      }
      globalIndex += g.items.length;
    }
    return 0;
  }
  /**
   * 判斷是否選中
   */
  isSelected(group, itemIndex) {
    return this.getGlobalIndex(group, itemIndex) === this.selectedIndex();
  }
  /**
   * 獲取類型標籤
   */
  getTypeLabel(type) {
    const labels = {
      page: "\u9801\u9762",
      action: "\u64CD\u4F5C",
      contact: "\u806F\u7E6B\u4EBA",
      recent: "\u6700\u8FD1",
      help: "\u5E6B\u52A9"
    };
    return labels[type];
  }
  /**
   * 打開/關閉
   */
  toggle() {
    if (this.isOpen()) {
      this.close();
    } else {
      this.open();
    }
  }
  /**
   * 打開
   */
  open() {
    this.query = "";
    this.selectedIndex.set(0);
    this.animateIn.set(true);
    this.isOpen.set(true);
  }
  /**
   * 關閉
   */
  close() {
    this.animateIn.set(false);
    setTimeout(() => {
      this.isOpen.set(false);
    }, 150);
  }
  /**
   * 執行命令
   */
  executeCommand(item) {
    if (item.type === "page") {
      this.addToRecent(item.id);
    }
    item.action();
    this.close();
  }
  /**
   * 導航到頁面
   */
  navigateTo(view) {
    this.navigate.emit(view);
  }
  /**
   * 發出動作事件
   */
  emitAction(action) {
    this.navigate.emit(`action:${action}`);
  }
  /**
   * 添加到最近訪問
   */
  addToRecent(id) {
    this.recentPages.update((recent) => {
      const filtered = recent.filter((r) => r !== id);
      return [id, ...filtered].slice(0, 10);
    });
    this.saveRecentPages();
  }
  /**
   * 載入最近訪問
   */
  loadRecentPages() {
    try {
      const stored = localStorage.getItem("tg-matrix-recent-pages");
      if (stored) {
        this.recentPages.set(JSON.parse(stored));
      }
    } catch {
    }
  }
  /**
   * 保存最近訪問
   */
  saveRecentPages() {
    try {
      localStorage.setItem("tg-matrix-recent-pages", JSON.stringify(this.recentPages()));
    } catch {
    }
  }
  /**
   * 添加自定義命令
   */
  addCommand(command) {
    this.commands.update((commands) => [...commands, command]);
  }
  /**
   * 添加聯繫人命令
   */
  addContactCommands(contacts) {
    const contactCommands = contacts.map((c) => ({
      id: `contact-${c.id}`,
      type: "contact",
      icon: "\u{1F464}",
      title: c.name,
      subtitle: c.username ? `@${c.username}` : void 0,
      keywords: [c.name, c.username || ""].filter(Boolean),
      action: () => this.navigate.emit(`contact:${c.id}`)
    }));
    this.commands.update((commands) => [
      ...commands.filter((c) => c.type !== "contact"),
      ...contactCommands
    ]);
  }
  static {
    this.\u0275fac = function CommandPaletteComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _CommandPaletteComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _CommandPaletteComponent, selectors: [["app-command-palette"]], hostBindings: function CommandPaletteComponent_HostBindings(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275listener("keydown", function CommandPaletteComponent_keydown_HostBindingHandler($event) {
          return ctx.onGlobalKeyDown($event);
        }, \u0275\u0275resolveDocument);
      }
    }, outputs: { navigate: "navigate" }, decls: 1, vars: 1, consts: [["searchInput", ""], [1, "command-palette-overlay", "fixed", "inset-0", "z-[9999]", "flex", "items-start", "justify-center", "pt-[15vh]", 3, "animate-fade-in"], [1, "command-palette-overlay", "fixed", "inset-0", "z-[9999]", "flex", "items-start", "justify-center", "pt-[15vh]", 3, "click"], [1, "absolute", "inset-0", "bg-black/50", "backdrop-blur-sm"], [1, "command-palette", "relative", "w-full", "max-w-2xl", "mx-4", "bg-slate-900", "rounded-2xl", "shadow-2xl", "border", "border-slate-700/50", "overflow-hidden", 3, "click"], [1, "flex", "items-center", "gap-3", "p-4", "border-b", "border-slate-700/50"], ["fill", "none", "stroke", "currentColor", "viewBox", "0 0 24 24", 1, "w-5", "h-5", "text-slate-400"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"], ["type", "text", "placeholder", "\u641C\u7D22\u9801\u9762\u3001\u529F\u80FD\u3001\u806F\u7E6B\u4EBA...", "autofocus", "", 1, "flex-1", "bg-transparent", "text-white", "placeholder-slate-500", "outline-none", "text-lg", 3, "ngModelChange", "keydown", "ngModel"], [1, "px-2", "py-1", "text-xs", "text-slate-400", "bg-slate-800", "rounded", "border", "border-slate-700"], [1, "max-h-[60vh]", "overflow-y-auto"], [1, "p-8", "text-center"], [1, "flex", "items-center", "justify-between", "px-4", "py-3", "border-t", "border-slate-700/50", "text-xs", "text-slate-500"], [1, "flex", "items-center", "gap-4"], [1, "flex", "items-center", "gap-1"], [1, "px-1.5", "py-0.5", "bg-slate-800", "rounded"], [1, "text-4xl", "mb-3"], [1, "text-slate-400"], [1, "text-sm", "text-slate-500", "mt-1"], [1, "py-2"], [1, "px-4", "py-2", "text-xs", "font-semibold", "text-slate-500", "uppercase", "tracking-wider"], [1, "flex", "items-center", "gap-3", "px-4", "py-3", "mx-2", "rounded-lg", "cursor-pointer", "transition-colors", 3, "bg-cyan-500/20", "hover:bg-slate-800"], [1, "flex", "items-center", "gap-3", "px-4", "py-3", "mx-2", "rounded-lg", "cursor-pointer", "transition-colors", 3, "click", "mouseenter"], [1, "w-10", "h-10", "rounded-lg", "flex", "items-center", "justify-center", "text-xl"], [1, "flex-1", "min-w-0"], [1, "text-white", "font-medium", "truncate"], [1, "text-sm", "text-slate-400", "truncate"], [1, "px-2", "py-0.5", "text-xs", "rounded-full"]], template: function CommandPaletteComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, CommandPaletteComponent_Conditional_0_Template, 31, 6, "div", 1);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.isOpen() ? 0 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, DefaultValueAccessor, NgControlStatus, NgModel], styles: ["\n\n.animate-fade-in[_ngcontent-%COMP%] {\n  animation: _ngcontent-%COMP%_fade-in 0.15s ease-out;\n}\n@keyframes _ngcontent-%COMP%_fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n.animate-slide-down[_ngcontent-%COMP%] {\n  animation: _ngcontent-%COMP%_slide-down 0.2s cubic-bezier(0.16, 1, 0.3, 1);\n}\n@keyframes _ngcontent-%COMP%_slide-down {\n  from {\n    opacity: 0;\n    transform: translateY(-20px) scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar {\n  width: 6px;\n}\n.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-track {\n  background: transparent;\n}\n.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb {\n  background: rgb(71, 85, 105);\n  border-radius: 3px;\n}\n.command-palette[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover {\n  background: rgb(100, 116, 139);\n}\n/*# sourceMappingURL=command-palette.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(CommandPaletteComponent, [{
    type: Component,
    args: [{ selector: "app-command-palette", standalone: true, imports: [CommonModule, FormsModule], template: `
    @if (isOpen()) {
      <div class="command-palette-overlay fixed inset-0 z-[9999] flex items-start justify-center pt-[15vh]"
           (click)="close()"
           [class.animate-fade-in]="animateIn()">
        
        <!-- \u80CC\u666F\u906E\u7F69 -->
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        
        <!-- \u547D\u4EE4\u9762\u677F -->
        <div class="command-palette relative w-full max-w-2xl mx-4 bg-slate-900 rounded-2xl shadow-2xl border border-slate-700/50 overflow-hidden"
             [class.animate-slide-down]="animateIn()"
             (click)="$event.stopPropagation()">
          
          <!-- \u641C\u7D22\u8F38\u5165 -->
          <div class="flex items-center gap-3 p-4 border-b border-slate-700/50">
            <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
            <input
              #searchInput
              type="text"
              [(ngModel)]="query"
              (ngModelChange)="onQueryChange($event)"
              (keydown)="onKeyDown($event)"
              placeholder="\u641C\u7D22\u9801\u9762\u3001\u529F\u80FD\u3001\u806F\u7E6B\u4EBA..."
              class="flex-1 bg-transparent text-white placeholder-slate-500 outline-none text-lg"
              autofocus
            />
            <kbd class="px-2 py-1 text-xs text-slate-400 bg-slate-800 rounded border border-slate-700">ESC</kbd>
          </div>
          
          <!-- \u641C\u7D22\u7D50\u679C -->
          <div class="max-h-[60vh] overflow-y-auto">
            @if (filteredGroups().length === 0) {
              <div class="p-8 text-center">
                <div class="text-4xl mb-3">\u{1F50D}</div>
                <p class="text-slate-400">\u672A\u627E\u5230\u5339\u914D\u7684\u7D50\u679C</p>
                <p class="text-sm text-slate-500 mt-1">\u5617\u8A66\u5176\u4ED6\u95DC\u9375\u8A5E</p>
              </div>
            } @else {
              @for (group of filteredGroups(); track group.title) {
                <div class="py-2">
                  <!-- \u5206\u7D44\u6A19\u984C -->
                  <div class="px-4 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider">
                    {{ group.title }}
                  </div>
                  
                  <!-- \u547D\u4EE4\u5217\u8868 -->
                  @for (item of group.items; track item.id; let i = $index) {
                    <div
                      (click)="executeCommand(item)"
                      (mouseenter)="selectedIndex.set(getGlobalIndex(group, i))"
                      class="flex items-center gap-3 px-4 py-3 mx-2 rounded-lg cursor-pointer transition-colors"
                      [class.bg-cyan-500/20]="isSelected(group, i)"
                      [class.hover:bg-slate-800]="!isSelected(group, i)">
                      
                      <!-- \u5716\u6A19 -->
                      <div class="w-10 h-10 rounded-lg flex items-center justify-center text-xl"
                           [class.bg-cyan-500/20]="isSelected(group, i)"
                           [class.bg-slate-800]="!isSelected(group, i)">
                        {{ item.icon }}
                      </div>
                      
                      <!-- \u5167\u5BB9 -->
                      <div class="flex-1 min-w-0">
                        <div class="text-white font-medium truncate">{{ item.title }}</div>
                        @if (item.subtitle) {
                          <div class="text-sm text-slate-400 truncate">{{ item.subtitle }}</div>
                        }
                      </div>
                      
                      <!-- \u985E\u578B\u6A19\u7C64 -->
                      <span class="px-2 py-0.5 text-xs rounded-full"
                            [class.bg-blue-500/20]="item.type === 'page'"
                            [class.text-blue-400]="item.type === 'page'"
                            [class.bg-green-500/20]="item.type === 'action'"
                            [class.text-green-400]="item.type === 'action'"
                            [class.bg-purple-500/20]="item.type === 'contact'"
                            [class.text-purple-400]="item.type === 'contact'"
                            [class.bg-amber-500/20]="item.type === 'recent'"
                            [class.text-amber-400]="item.type === 'recent'">
                        {{ getTypeLabel(item.type) }}
                      </span>
                      
                      <!-- \u5FEB\u6377\u9375 -->
                      @if (item.shortcut) {
                        <kbd class="px-2 py-1 text-xs text-slate-400 bg-slate-800 rounded border border-slate-700">
                          {{ item.shortcut }}
                        </kbd>
                      }
                    </div>
                  }
                </div>
              }
            }
          </div>
          
          <!-- \u5E95\u90E8\u63D0\u793A -->
          <div class="flex items-center justify-between px-4 py-3 border-t border-slate-700/50 text-xs text-slate-500">
            <div class="flex items-center gap-4">
              <span class="flex items-center gap-1">
                <kbd class="px-1.5 py-0.5 bg-slate-800 rounded">\u2191</kbd>
                <kbd class="px-1.5 py-0.5 bg-slate-800 rounded">\u2193</kbd>
                \u5C0E\u822A
              </span>
              <span class="flex items-center gap-1">
                <kbd class="px-1.5 py-0.5 bg-slate-800 rounded">\u21B5</kbd>
                \u9078\u64C7
              </span>
              <span class="flex items-center gap-1">
                <kbd class="px-1.5 py-0.5 bg-slate-800 rounded">ESC</kbd>
                \u95DC\u9589
              </span>
            </div>
            <span>TG-Matrix \u547D\u4EE4\u9762\u677F</span>
          </div>
        </div>
      </div>
    }
  `, styles: ["/* angular:styles/component:css;f9e40973bea23250af50121ae43b81b03e247ef8ee60364def8126ed273ff709;D:/tgkz2026/src/components/command-palette.component.ts */\n.animate-fade-in {\n  animation: fade-in 0.15s ease-out;\n}\n@keyframes fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n.animate-slide-down {\n  animation: slide-down 0.2s cubic-bezier(0.16, 1, 0.3, 1);\n}\n@keyframes slide-down {\n  from {\n    opacity: 0;\n    transform: translateY(-20px) scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n.command-palette ::-webkit-scrollbar {\n  width: 6px;\n}\n.command-palette ::-webkit-scrollbar-track {\n  background: transparent;\n}\n.command-palette ::-webkit-scrollbar-thumb {\n  background: rgb(71, 85, 105);\n  border-radius: 3px;\n}\n.command-palette ::-webkit-scrollbar-thumb:hover {\n  background: rgb(100, 116, 139);\n}\n/*# sourceMappingURL=command-palette.component.css.map */\n"] }]
  }], null, { navigate: [{ type: Output, args: ["navigate"] }], onGlobalKeyDown: [{
    type: HostListener,
    args: ["document:keydown", ["$event"]]
  }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(CommandPaletteComponent, { className: "CommandPaletteComponent", filePath: "src/components/command-palette.component.ts", lineNumber: 207 });
})();

// src/core/network.service.ts
var NetworkService = class _NetworkService {
  constructor() {
    this._isOnline = signal(navigator.onLine, ...ngDevMode ? [{ debugName: "_isOnline" }] : []);
    this._status = signal(navigator.onLine ? "online" : "offline", ...ngDevMode ? [{ debugName: "_status" }] : []);
    this._lastOfflineTime = signal(null, ...ngDevMode ? [{ debugName: "_lastOfflineTime" }] : []);
    this._networkEvents = new Subject();
    this.isOnline = computed(() => this._isOnline(), ...ngDevMode ? [{ debugName: "isOnline" }] : []);
    this.status = computed(() => this._status(), ...ngDevMode ? [{ debugName: "status" }] : []);
    this.isOffline = computed(() => !this._isOnline(), ...ngDevMode ? [{ debugName: "isOffline" }] : []);
    this.networkEvents$ = this._networkEvents.asObservable();
    this.online$ = merge(fromEvent(window, "online").pipe(map(() => true)), fromEvent(window, "offline").pipe(map(() => false))).pipe(startWith(navigator.onLine), distinctUntilChanged());
    this.online$.subscribe((isOnline) => {
      this._isOnline.set(isOnline);
      this._status.set(isOnline ? "online" : "offline");
      if (!isOnline) {
        this._lastOfflineTime.set(Date.now());
        this._networkEvents.next({
          status: "offline",
          timestamp: Date.now(),
          message: "\u7DB2\u7D61\u9023\u63A5\u5DF2\u65B7\u958B"
        });
        console.warn("[NetworkService] Network offline");
      } else {
        const offlineDuration = this._lastOfflineTime() ? Math.round((Date.now() - this._lastOfflineTime()) / 1e3) : 0;
        this._networkEvents.next({
          status: "online",
          timestamp: Date.now(),
          message: offlineDuration > 0 ? `\u7DB2\u7D61\u5DF2\u6062\u5FA9\uFF08\u96E2\u7DDA ${offlineDuration} \u79D2\uFF09` : "\u7DB2\u7D61\u5DF2\u9023\u63A5"
        });
        console.log("[NetworkService] Network online");
      }
    });
    this.checkNetworkSpeed();
  }
  ngOnDestroy() {
    this._networkEvents.complete();
  }
  /**
   * 檢測網絡速度（使用 Navigator Connection API）
   */
  checkNetworkSpeed() {
    const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
    if (connection) {
      connection.addEventListener("change", () => {
        const effectiveType = connection.effectiveType;
        if (["slow-2g", "2g"].includes(effectiveType)) {
          this._status.set("slow");
          this._networkEvents.next({
            status: "slow",
            timestamp: Date.now(),
            message: "\u7DB2\u7D61\u9023\u63A5\u8F03\u6162\uFF0C\u90E8\u5206\u529F\u80FD\u53EF\u80FD\u5EF6\u9072"
          });
        } else if (this._status() === "slow" && this._isOnline()) {
          this._status.set("online");
        }
      });
    }
  }
  /**
   * 手動觸發網絡檢查
   */
  async checkConnection() {
    try {
      const response = await fetch("/api/health", {
        method: "HEAD",
        cache: "no-store"
      });
      const isOnline = response.ok;
      this._isOnline.set(isOnline);
      this._status.set(isOnline ? "online" : "offline");
      return isOnline;
    } catch {
      this._isOnline.set(false);
      this._status.set("offline");
      return false;
    }
  }
  /**
   * 獲取友好的狀態消息
   */
  getStatusMessage() {
    switch (this._status()) {
      case "online":
        return "\u7DB2\u7D61\u9023\u63A5\u6B63\u5E38";
      case "offline":
        return "\u7DB2\u7D61\u5DF2\u65B7\u958B\uFF0C\u8ACB\u6AA2\u67E5\u60A8\u7684\u7DB2\u7D61\u9023\u63A5";
      case "slow":
        return "\u7DB2\u7D61\u9023\u63A5\u8F03\u6162\uFF0C\u8ACB\u8010\u5FC3\u7B49\u5F85";
      default:
        return "";
    }
  }
  /**
   * 獲取狀態圖標
   */
  getStatusIcon() {
    switch (this._status()) {
      case "online":
        return "\u{1F7E2}";
      case "offline":
        return "\u{1F534}";
      case "slow":
        return "\u{1F7E1}";
      default:
        return "";
    }
  }
  static {
    this.\u0275fac = function NetworkService_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _NetworkService)();
    };
  }
  static {
    this.\u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({ token: _NetworkService, factory: _NetworkService.\u0275fac, providedIn: "root" });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(NetworkService, [{
    type: Injectable,
    args: [{
      providedIn: "root"
    }]
  }], () => [], null);
})();

// src/core/network-status.component.ts
function NetworkStatusComponent_Conditional_0_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275domElementStart(0, "button", 5);
    \u0275\u0275domListener("click", function NetworkStatusComponent_Conditional_0_Conditional_5_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.dismiss());
    });
    \u0275\u0275text(1, "\u2715");
    \u0275\u0275domElementEnd();
  }
}
function NetworkStatusComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 1)(1, "span", 2);
    \u0275\u0275text(2);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(3, "span", 3);
    \u0275\u0275text(4);
    \u0275\u0275domElementEnd();
    \u0275\u0275conditionalCreate(5, NetworkStatusComponent_Conditional_0_Conditional_5_Template, 2, 0, "button", 4);
    \u0275\u0275domElementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275classMap("status-" + ctx_r1.status());
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r1.getIcon());
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r1.message());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.status() === "online" ? 5 : -1);
  }
}
var NetworkStatusComponent = class _NetworkStatusComponent {
  constructor() {
    this.networkService = inject(NetworkService);
    this.subscription = null;
    this.showBanner = signal(false, ...ngDevMode ? [{ debugName: "showBanner" }] : []);
    this.status = signal("online", ...ngDevMode ? [{ debugName: "status" }] : []);
    this.message = signal("", ...ngDevMode ? [{ debugName: "message" }] : []);
    this.dismissTimer = null;
  }
  ngOnInit() {
    this.subscription = this.networkService.networkEvents$.subscribe((event) => {
      this.status.set(event.status);
      this.message.set(event.message || "");
      this.showBanner.set(true);
      if (this.dismissTimer) {
        clearTimeout(this.dismissTimer);
      }
      if (event.status === "online") {
        this.dismissTimer = setTimeout(() => {
          this.showBanner.set(false);
        }, 3e3);
      }
    });
  }
  ngOnDestroy() {
    this.subscription?.unsubscribe();
    if (this.dismissTimer) {
      clearTimeout(this.dismissTimer);
    }
  }
  getIcon() {
    return this.networkService.getStatusIcon();
  }
  dismiss() {
    this.showBanner.set(false);
  }
  static {
    this.\u0275fac = function NetworkStatusComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _NetworkStatusComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _NetworkStatusComponent, selectors: [["app-network-status"]], decls: 1, vars: 1, consts: [[1, "network-banner", 3, "class"], [1, "network-banner"], [1, "icon"], [1, "message"], [1, "dismiss-btn"], [1, "dismiss-btn", 3, "click"]], template: function NetworkStatusComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, NetworkStatusComponent_Conditional_0_Template, 6, 5, "div", 0);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.showBanner() ? 0 : -1);
      }
    }, dependencies: [CommonModule], styles: ["\n\n.network-banner[_ngcontent-%COMP%] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  z-index: 9999;\n  padding: 0.75rem 1rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  font-size: 0.875rem;\n  font-weight: 500;\n  animation: _ngcontent-%COMP%_slideDown 0.3s ease-out;\n}\n@keyframes _ngcontent-%COMP%_slideDown {\n  from {\n    transform: translateY(-100%);\n    opacity: 0;\n  }\n  to {\n    transform: translateY(0);\n    opacity: 1;\n  }\n}\n.status-offline[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #ef4444 0%,\n      #dc2626 100%);\n  color: white;\n}\n.status-online[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e 0%,\n      #16a34a 100%);\n  color: white;\n}\n.status-slow[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #f59e0b 0%,\n      #d97706 100%);\n  color: white;\n}\n.icon[_ngcontent-%COMP%] {\n  font-size: 1rem;\n}\n.message[_ngcontent-%COMP%] {\n  flex: 1;\n  text-align: center;\n}\n.dismiss-btn[_ngcontent-%COMP%] {\n  background: transparent;\n  border: none;\n  color: white;\n  opacity: 0.8;\n  cursor: pointer;\n  padding: 0.25rem;\n  font-size: 0.875rem;\n}\n.dismiss-btn[_ngcontent-%COMP%]:hover {\n  opacity: 1;\n}\n/*# sourceMappingURL=network-status.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(NetworkStatusComponent, [{
    type: Component,
    args: [{ selector: "app-network-status", standalone: true, imports: [CommonModule], template: `
    @if (showBanner()) {
      <div class="network-banner" [class]="'status-' + status()">
        <span class="icon">{{ getIcon() }}</span>
        <span class="message">{{ message() }}</span>
        @if (status() === 'online') {
          <button class="dismiss-btn" (click)="dismiss()">\u2715</button>
        }
      </div>
    }
  `, styles: ["/* angular:styles/component:css;77048c89b3a60400314e1216b10172e0232c465c2089f209828918cd120d87a8;D:/tgkz2026/src/core/network-status.component.ts */\n.network-banner {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  z-index: 9999;\n  padding: 0.75rem 1rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  font-size: 0.875rem;\n  font-weight: 500;\n  animation: slideDown 0.3s ease-out;\n}\n@keyframes slideDown {\n  from {\n    transform: translateY(-100%);\n    opacity: 0;\n  }\n  to {\n    transform: translateY(0);\n    opacity: 1;\n  }\n}\n.status-offline {\n  background:\n    linear-gradient(\n      135deg,\n      #ef4444 0%,\n      #dc2626 100%);\n  color: white;\n}\n.status-online {\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e 0%,\n      #16a34a 100%);\n  color: white;\n}\n.status-slow {\n  background:\n    linear-gradient(\n      135deg,\n      #f59e0b 0%,\n      #d97706 100%);\n  color: white;\n}\n.icon {\n  font-size: 1rem;\n}\n.message {\n  flex: 1;\n  text-align: center;\n}\n.dismiss-btn {\n  background: transparent;\n  border: none;\n  color: white;\n  opacity: 0.8;\n  cursor: pointer;\n  padding: 0.25rem;\n  font-size: 0.875rem;\n}\n.dismiss-btn:hover {\n  opacity: 1;\n}\n/*# sourceMappingURL=network-status.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(NetworkStatusComponent, { className: "NetworkStatusComponent", filePath: "src/core/network-status.component.ts", lineNumber: 97 });
})();

// src/core/auth-transition.component.ts
function AuthTransitionComponent_Conditional_0_Case_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 6);
    \u0275\u0275text(1, "\u2713");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(2, "h2", 7);
    \u0275\u0275text(3, "\u6B61\u8FCE\u56DE\u4F86");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(4, "p", 8);
    \u0275\u0275text(5, "\u6B63\u5728\u9032\u5165\u7CFB\u7D71...");
    \u0275\u0275domElementEnd();
  }
}
function AuthTransitionComponent_Conditional_0_Case_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 9);
    \u0275\u0275text(1, "\u{1F44B}");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(2, "h2", 7);
    \u0275\u0275text(3, "\u5DF2\u5B89\u5168\u767B\u51FA");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(4, "p", 8);
    \u0275\u0275text(5, "\u671F\u5F85\u60A8\u7684\u518D\u6B21\u8A2A\u554F");
    \u0275\u0275domElementEnd();
  }
}
function AuthTransitionComponent_Conditional_0_Case_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 10);
    \u0275\u0275text(1, "\u26A0\uFE0F");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(2, "h2", 7);
    \u0275\u0275text(3, "\u6703\u8A71\u5DF2\u904E\u671F");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(4, "p", 8);
    \u0275\u0275text(5, "\u8ACB\u91CD\u65B0\u767B\u5165");
    \u0275\u0275domElementEnd();
  }
}
function AuthTransitionComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275domElementStart(0, "div", 1)(1, "div", 2);
    \u0275\u0275conditionalCreate(2, AuthTransitionComponent_Conditional_0_Case_2_Template, 6, 0)(3, AuthTransitionComponent_Conditional_0_Case_3_Template, 6, 0)(4, AuthTransitionComponent_Conditional_0_Case_4_Template, 6, 0);
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(5, "div", 3)(6, "span", 4);
    \u0275\u0275text(7, "\u{1F916}");
    \u0275\u0275domElementEnd();
    \u0275\u0275domElementStart(8, "span", 5);
    \u0275\u0275text(9, "TG-AI \u667A\u63A7\u738B");
    \u0275\u0275domElementEnd()()();
  }
  if (rf & 2) {
    let tmp_2_0;
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275classMap("type-" + ctx_r0.type());
    \u0275\u0275advance(2);
    \u0275\u0275conditional((tmp_2_0 = ctx_r0.type()) === "login" ? 2 : tmp_2_0 === "logout" ? 3 : tmp_2_0 === "session_expired" ? 4 : -1);
  }
}
var AuthTransitionComponent = class _AuthTransitionComponent {
  constructor() {
    this.authEvents = inject(AuthEventsService);
    this.subscription = null;
    this.show = signal(false, ...ngDevMode ? [{ debugName: "show" }] : []);
    this.type = signal("none", ...ngDevMode ? [{ debugName: "type" }] : []);
    this.hideTimer = null;
  }
  ngOnInit() {
    this.subscription = this.authEvents.authEvents$.subscribe((event) => {
      this.handleEvent(event);
    });
  }
  ngOnDestroy() {
    this.subscription?.unsubscribe();
    if (this.hideTimer) {
      clearTimeout(this.hideTimer);
    }
  }
  handleEvent(event) {
    if (this.hideTimer) {
      clearTimeout(this.hideTimer);
    }
    switch (event.type) {
      case "login":
        this.type.set("login");
        this.show.set(true);
        this.hideTimer = setTimeout(() => {
          this.show.set(false);
        }, 1500);
        break;
      case "logout":
        this.type.set("logout");
        this.show.set(true);
        this.hideTimer = setTimeout(() => {
          this.show.set(false);
        }, 1e3);
        break;
      case "session_expired":
        this.type.set("session_expired");
        this.show.set(true);
        this.hideTimer = setTimeout(() => {
          this.show.set(false);
        }, 2e3);
        break;
    }
  }
  static {
    this.\u0275fac = function AuthTransitionComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _AuthTransitionComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _AuthTransitionComponent, selectors: [["app-auth-transition"]], decls: 1, vars: 1, consts: [[1, "transition-overlay", 3, "class"], [1, "transition-overlay"], [1, "transition-content"], [1, "brand-footer"], [1, "brand-icon"], [1, "brand-name"], [1, "success-icon"], [1, "title"], [1, "subtitle"], [1, "logout-icon"], [1, "warning-icon"]], template: function AuthTransitionComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275conditionalCreate(0, AuthTransitionComponent_Conditional_0_Template, 10, 3, "div", 0);
      }
      if (rf & 2) {
        \u0275\u0275conditional(ctx.show() ? 0 : -1);
      }
    }, dependencies: [CommonModule], styles: ["\n\n.transition-overlay[_ngcontent-%COMP%] {\n  position: fixed;\n  inset: 0;\n  z-index: 99999;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  animation: _ngcontent-%COMP%_fadeIn 0.3s ease-out;\n}\n@keyframes _ngcontent-%COMP%_fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n.type-login[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #0f172a 0%,\n      #1e3a5f 50%,\n      #0f172a 100%);\n}\n.type-logout[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #1e293b 0%,\n      #334155 50%,\n      #1e293b 100%);\n}\n.type-session_expired[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #1e293b 0%,\n      #422006 50%,\n      #1e293b 100%);\n}\n.transition-content[_ngcontent-%COMP%] {\n  text-align: center;\n  animation: _ngcontent-%COMP%_scaleIn 0.4s ease-out;\n}\n@keyframes _ngcontent-%COMP%_scaleIn {\n  from {\n    transform: scale(0.8);\n    opacity: 0;\n  }\n  to {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n.success-icon[_ngcontent-%COMP%] {\n  width: 80px;\n  height: 80px;\n  margin: 0 auto 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e 0%,\n      #16a34a 100%);\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 2.5rem;\n  color: white;\n  animation: _ngcontent-%COMP%_bounceIn 0.5s ease-out;\n}\n.logout-icon[_ngcontent-%COMP%], \n.warning-icon[_ngcontent-%COMP%] {\n  font-size: 4rem;\n  margin-bottom: 1.5rem;\n  animation: _ngcontent-%COMP%_bounceIn 0.5s ease-out;\n}\n@keyframes _ngcontent-%COMP%_bounceIn {\n  0% {\n    transform: scale(0);\n    opacity: 0;\n  }\n  50% {\n    transform: scale(1.1);\n  }\n  100% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n.title[_ngcontent-%COMP%] {\n  font-size: 1.75rem;\n  font-weight: 600;\n  color: white;\n  margin: 0 0 0.5rem;\n}\n.subtitle[_ngcontent-%COMP%] {\n  font-size: 1rem;\n  color: rgba(255, 255, 255, 0.7);\n  margin: 0;\n}\n.brand-footer[_ngcontent-%COMP%] {\n  position: absolute;\n  bottom: 2rem;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  color: rgba(255, 255, 255, 0.5);\n  font-size: 0.875rem;\n}\n.brand-icon[_ngcontent-%COMP%] {\n  font-size: 1.25rem;\n}\n.brand-name[_ngcontent-%COMP%] {\n  font-weight: 500;\n}\n/*# sourceMappingURL=auth-transition.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AuthTransitionComponent, [{
    type: Component,
    args: [{ selector: "app-auth-transition", standalone: true, imports: [CommonModule], template: `
    @if (show()) {
      <div class="transition-overlay" [class]="'type-' + type()">
        <div class="transition-content">
          @switch (type()) {
            @case ('login') {
              <div class="success-icon">\u2713</div>
              <h2 class="title">\u6B61\u8FCE\u56DE\u4F86</h2>
              <p class="subtitle">\u6B63\u5728\u9032\u5165\u7CFB\u7D71...</p>
            }
            @case ('logout') {
              <div class="logout-icon">\u{1F44B}</div>
              <h2 class="title">\u5DF2\u5B89\u5168\u767B\u51FA</h2>
              <p class="subtitle">\u671F\u5F85\u60A8\u7684\u518D\u6B21\u8A2A\u554F</p>
            }
            @case ('session_expired') {
              <div class="warning-icon">\u26A0\uFE0F</div>
              <h2 class="title">\u6703\u8A71\u5DF2\u904E\u671F</h2>
              <p class="subtitle">\u8ACB\u91CD\u65B0\u767B\u5165</p>
            }
          }
        </div>
        <div class="brand-footer">
          <span class="brand-icon">\u{1F916}</span>
          <span class="brand-name">TG-AI \u667A\u63A7\u738B</span>
        </div>
      </div>
    }
  `, styles: ["/* angular:styles/component:css;3fd6dd592654040cd8160f898c355745fe8f0015b3342c50c968bd3435a20f40;D:/tgkz2026/src/core/auth-transition.component.ts */\n.transition-overlay {\n  position: fixed;\n  inset: 0;\n  z-index: 99999;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  animation: fadeIn 0.3s ease-out;\n}\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n.type-login {\n  background:\n    linear-gradient(\n      135deg,\n      #0f172a 0%,\n      #1e3a5f 50%,\n      #0f172a 100%);\n}\n.type-logout {\n  background:\n    linear-gradient(\n      135deg,\n      #1e293b 0%,\n      #334155 50%,\n      #1e293b 100%);\n}\n.type-session_expired {\n  background:\n    linear-gradient(\n      135deg,\n      #1e293b 0%,\n      #422006 50%,\n      #1e293b 100%);\n}\n.transition-content {\n  text-align: center;\n  animation: scaleIn 0.4s ease-out;\n}\n@keyframes scaleIn {\n  from {\n    transform: scale(0.8);\n    opacity: 0;\n  }\n  to {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n.success-icon {\n  width: 80px;\n  height: 80px;\n  margin: 0 auto 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e 0%,\n      #16a34a 100%);\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 2.5rem;\n  color: white;\n  animation: bounceIn 0.5s ease-out;\n}\n.logout-icon,\n.warning-icon {\n  font-size: 4rem;\n  margin-bottom: 1.5rem;\n  animation: bounceIn 0.5s ease-out;\n}\n@keyframes bounceIn {\n  0% {\n    transform: scale(0);\n    opacity: 0;\n  }\n  50% {\n    transform: scale(1.1);\n  }\n  100% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n.title {\n  font-size: 1.75rem;\n  font-weight: 600;\n  color: white;\n  margin: 0 0 0.5rem;\n}\n.subtitle {\n  font-size: 1rem;\n  color: rgba(255, 255, 255, 0.7);\n  margin: 0;\n}\n.brand-footer {\n  position: absolute;\n  bottom: 2rem;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  color: rgba(255, 255, 255, 0.5);\n  font-size: 0.875rem;\n}\n.brand-icon {\n  font-size: 1.25rem;\n}\n.brand-name {\n  font-weight: 500;\n}\n/*# sourceMappingURL=auth-transition.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(AuthTransitionComponent, { className: "AuthTransitionComponent", filePath: "src/core/auth-transition.component.ts", lineNumber: 162 });
})();

// src/views/api-credentials-view.component.ts
var _forTrack013 = ($index, $item) => $item.api_id;
function ApiCredentialsViewComponent_Conditional_60_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 37);
    \u0275\u0275text(1, "\u23F3");
    \u0275\u0275elementEnd();
    \u0275\u0275text(2, " \u4FDD\u5B58\u4E2D... ");
  }
}
function ApiCredentialsViewComponent_Conditional_61_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span");
    \u0275\u0275text(1, "\u2795");
    \u0275\u0275elementEnd();
    \u0275\u0275text(2, " \u6DFB\u52A0 ");
  }
}
function ApiCredentialsViewComponent_Conditional_76_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 34)(1, "div", 38);
    \u0275\u0275text(2, "\u23F3");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 39);
    \u0275\u0275text(4, "\u6B63\u5728\u52A0\u8F09...");
    \u0275\u0275elementEnd()();
  }
}
function ApiCredentialsViewComponent_Conditional_77_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 34)(1, "div", 40);
    \u0275\u0275text(2, "\u{1F4ED}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 41);
    \u0275\u0275text(4, "\u9084\u6C92\u6709\u4EFB\u4F55 API \u6191\u64DA");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 39);
    \u0275\u0275text(6, "\u8ACB\u5728\u4E0A\u65B9\u8868\u55AE\u6DFB\u52A0\u60A8\u7684\u7B2C\u4E00\u500B API");
    \u0275\u0275elementEnd()();
  }
}
function ApiCredentialsViewComponent_Conditional_78_For_2_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 46);
    \u0275\u0275text(1, "\u516C\u5171");
    \u0275\u0275elementEnd();
  }
}
function ApiCredentialsViewComponent_Conditional_78_For_2_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 47);
    \u0275\u0275text(1, "\u624B\u52D5\u6DFB\u52A0");
    \u0275\u0275elementEnd();
  }
}
function ApiCredentialsViewComponent_Conditional_78_For_2_Conditional_18_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 52);
    \u0275\u0275listener("click", function ApiCredentialsViewComponent_Conditional_78_For_2_Conditional_18_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r1);
      const cred_r2 = \u0275\u0275nextContext().$implicit;
      const ctx_r2 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r2.toggleCredential(cred_r2.api_id, !cred_r2.is_active));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "button", 53);
    \u0275\u0275listener("click", function ApiCredentialsViewComponent_Conditional_78_For_2_Conditional_18_Template_button_click_2_listener() {
      \u0275\u0275restoreView(_r1);
      const cred_r2 = \u0275\u0275nextContext().$implicit;
      const ctx_r2 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r2.confirmDelete(cred_r2));
    });
    \u0275\u0275text(3, " \u522A\u9664 ");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const cred_r2 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275classProp("bg-green-500/20", !cred_r2.is_active)("text-green-400", !cred_r2.is_active)("hover:bg-green-500/30", !cred_r2.is_active)("bg-amber-500/20", cred_r2.is_active)("text-amber-400", cred_r2.is_active)("hover:bg-amber-500/30", cred_r2.is_active);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", cred_r2.is_active ? "\u505C\u7528" : "\u555F\u7528", " ");
  }
}
function ApiCredentialsViewComponent_Conditional_78_For_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 42)(1, "div", 2);
    \u0275\u0275element(2, "div", 43);
    \u0275\u0275elementStart(3, "div")(4, "div", 44)(5, "span", 45);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(7, ApiCredentialsViewComponent_Conditional_78_For_2_Conditional_7_Template, 2, 0, "span", 46);
    \u0275\u0275conditionalCreate(8, ApiCredentialsViewComponent_Conditional_78_For_2_Conditional_8_Template, 2, 0, "span", 47);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "div", 12);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(11, "div", 2)(12, "div", 48)(13, "div", 49);
    \u0275\u0275text(14);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "div", 50);
    \u0275\u0275element(16, "div", 51);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(17, "div", 44);
    \u0275\u0275conditionalCreate(18, ApiCredentialsViewComponent_Conditional_78_For_2_Conditional_18_Template, 4, 13);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const cred_r2 = ctx.$implicit;
    \u0275\u0275advance(2);
    \u0275\u0275classProp("bg-green-500", cred_r2.is_active)("bg-slate-500", !cred_r2.is_active);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(cred_r2.name);
    \u0275\u0275advance();
    \u0275\u0275conditional(cred_r2.is_public ? 7 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(cred_r2.source === "manual" ? 8 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate3(" ID: ", cred_r2.api_id, " \u2022 Hash: ", cred_r2.api_hash.slice(0, 8), "...", cred_r2.api_hash.slice(-4), " ");
    \u0275\u0275advance(3);
    \u0275\u0275classProp("text-green-400", cred_r2.account_count < cred_r2.max_accounts * 0.8)("text-amber-400", cred_r2.account_count >= cred_r2.max_accounts * 0.8 && cred_r2.account_count < cred_r2.max_accounts)("text-red-400", cred_r2.account_count >= cred_r2.max_accounts);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", cred_r2.account_count, "/", cred_r2.max_accounts, " \u5E33\u865F ");
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("width", cred_r2.account_count / cred_r2.max_accounts * 100, "%");
    \u0275\u0275classProp("bg-green-500", cred_r2.account_count < cred_r2.max_accounts * 0.8)("bg-amber-500", cred_r2.account_count >= cred_r2.max_accounts * 0.8 && cred_r2.account_count < cred_r2.max_accounts)("bg-red-500", cred_r2.account_count >= cred_r2.max_accounts);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(!cred_r2.is_public ? 18 : -1);
  }
}
function ApiCredentialsViewComponent_Conditional_78_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 35);
    \u0275\u0275repeaterCreate(1, ApiCredentialsViewComponent_Conditional_78_For_2_Template, 19, 27, "div", 42, _forTrack013);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r2 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r2.credentials());
  }
}
function ApiCredentialsViewComponent_Conditional_79_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "br");
    \u0275\u0275elementStart(1, "span", 62);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r2 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u26A0\uFE0F \u6B64 API \u76EE\u524D\u6709 ", ctx_r2.deleteTarget().account_count, " \u500B\u5E33\u865F\u5728\u4F7F\u7528\u3002");
  }
}
function ApiCredentialsViewComponent_Conditional_79_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 54);
    \u0275\u0275listener("click", function ApiCredentialsViewComponent_Conditional_79_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r2 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r2.cancelDelete());
    });
    \u0275\u0275elementStart(1, "div", 55);
    \u0275\u0275listener("click", function ApiCredentialsViewComponent_Conditional_79_Template_div_click_1_listener($event) {
      \u0275\u0275restoreView(_r4);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275elementStart(2, "h3", 56);
    \u0275\u0275text(3, "\u78BA\u8A8D\u522A\u9664");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "p", 57);
    \u0275\u0275text(5, " \u78BA\u5B9A\u8981\u522A\u9664 API\u300C");
    \u0275\u0275elementStart(6, "span", 58);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd();
    \u0275\u0275text(8, "\u300D\u55CE\uFF1F ");
    \u0275\u0275conditionalCreate(9, ApiCredentialsViewComponent_Conditional_79_Conditional_9_Template, 3, 1);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "div", 59)(11, "button", 60);
    \u0275\u0275listener("click", function ApiCredentialsViewComponent_Conditional_79_Template_button_click_11_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r2 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r2.cancelDelete());
    });
    \u0275\u0275text(12, " \u53D6\u6D88 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "button", 61);
    \u0275\u0275listener("click", function ApiCredentialsViewComponent_Conditional_79_Template_button_click_13_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r2 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r2.doDelete());
    });
    \u0275\u0275text(14, " \u78BA\u8A8D\u522A\u9664 ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r2 = \u0275\u0275nextContext();
    \u0275\u0275advance(7);
    \u0275\u0275textInterpolate(ctx_r2.deleteTarget().name);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r2.deleteTarget().account_count > 0 ? 9 : -1);
  }
}
var ApiCredentialsViewComponent = class _ApiCredentialsViewComponent {
  constructor() {
    this.ipc = inject(ElectronIpcService);
    this.toast = inject(ToastService);
    this.nav = inject(NavBridgeService);
    this.credentials = signal([], ...ngDevMode ? [{ debugName: "credentials" }] : []);
    this.isLoading = signal(true, ...ngDevMode ? [{ debugName: "isLoading" }] : []);
    this.isSaving = signal(false, ...ngDevMode ? [{ debugName: "isSaving" }] : []);
    this.deleteTarget = signal(null, ...ngDevMode ? [{ debugName: "deleteTarget" }] : []);
    this.newApiId = "";
    this.newApiHash = "";
    this.newApiName = "";
    this.activeCount = () => this.credentials().filter((c) => c.is_active && !c.is_public).length;
    this.totalAccountsUsed = () => this.credentials().reduce((sum, c) => sum + c.account_count, 0);
    this.totalCapacity = () => this.credentials().filter((c) => !c.is_public).reduce((sum, c) => sum + c.max_accounts, 0);
    this.ipcCleanup = [];
  }
  ngOnInit() {
    this.setupIpcListeners();
    this.refreshList();
  }
  ngOnDestroy() {
    this.ipcCleanup.forEach((fn) => fn());
  }
  setupIpcListeners() {
    const cleanup1 = this.ipc.on("api-credentials-updated", (data) => {
      this.isLoading.set(false);
      if (data.credentials) {
        this.credentials.set(data.credentials);
      }
    });
    const cleanup2 = this.ipc.on("api-credential-added", (data) => {
      this.isSaving.set(false);
      if (data.success) {
        this.toast.success("\u2705 API \u6191\u64DA\u6DFB\u52A0\u6210\u529F\uFF01");
        this.clearForm();
      } else {
        this.toast.error(`\u6DFB\u52A0\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
      }
    });
    const cleanup3 = this.ipc.on("api-credential-removed", (data) => {
      if (data.success) {
        this.toast.success("\u{1F5D1}\uFE0F API \u6191\u64DA\u5DF2\u522A\u9664");
      } else {
        this.toast.error(`\u522A\u9664\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
      }
    });
    const cleanup4 = this.ipc.on("api-credential-toggled", (data) => {
      if (data.success) {
        this.toast.success("\u72C0\u614B\u5DF2\u66F4\u65B0");
      } else {
        this.toast.error(`\u64CD\u4F5C\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
      }
    });
    this.ipcCleanup.push(cleanup1, cleanup2, cleanup3, cleanup4);
  }
  refreshList() {
    this.isLoading.set(true);
    this.ipc.send("get-api-credentials", {});
  }
  isFormValid() {
    const apiId = this.newApiId.trim();
    const apiHash = this.newApiHash.trim();
    return apiId.length > 0 && /^\d+$/.test(apiId) && apiHash.length === 32 && /^[a-f0-9]{32}$/i.test(apiHash);
  }
  addCredential() {
    if (!this.isFormValid()) {
      this.toast.error("\u8ACB\u6AA2\u67E5 API ID \u548C API Hash \u683C\u5F0F");
      return;
    }
    this.isSaving.set(true);
    this.ipc.send("add-api-credential", {
      api_id: this.newApiId.trim(),
      api_hash: this.newApiHash.trim(),
      name: this.newApiName.trim() || `API_${this.newApiId.slice(-4)}`,
      source: "manual",
      max_accounts: 5
    });
  }
  clearForm() {
    this.newApiId = "";
    this.newApiHash = "";
    this.newApiName = "";
  }
  toggleCredential(apiId, isActive) {
    this.ipc.send("toggle-api-credential", { api_id: apiId, is_active: isActive });
  }
  confirmDelete(cred) {
    this.deleteTarget.set(cred);
  }
  cancelDelete() {
    this.deleteTarget.set(null);
  }
  doDelete() {
    const target = this.deleteTarget();
    if (target) {
      this.ipc.send("remove-api-credential", { api_id: target.api_id });
      this.deleteTarget.set(null);
    }
  }
  goBack() {
    this.nav.navigateTo("accounts");
  }
  static {
    this.\u0275fac = function ApiCredentialsViewComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _ApiCredentialsViewComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _ApiCredentialsViewComponent, selectors: [["app-api-credentials-view"]], decls: 80, vars: 14, consts: [[1, "max-w-6xl", "mx-auto"], [1, "flex", "items-center", "justify-between", "mb-8"], [1, "flex", "items-center", "gap-4"], [1, "flex", "items-center", "gap-2", "text-slate-400", "hover:text-white", "transition-colors", 3, "click"], ["fill", "none", "stroke", "currentColor", "viewBox", "0 0 24 24", 1, "w-5", "h-5"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M15 19l-7-7 7-7"], [1, "flex", "items-center", "gap-2", "px-4", "py-2", "bg-slate-800", "hover:bg-slate-700", "rounded-lg", "transition-colors", 3, "click", "disabled"], [1, "text-3xl", "font-bold", "text-white", "mb-2"], [1, "text-slate-400", "mb-8"], [1, "grid", "grid-cols-4", "gap-4", "mb-8"], [1, "bg-gradient-to-br", "from-cyan-500/10", "to-blue-500/10", "border", "border-cyan-500/20", "rounded-xl", "p-4"], [1, "text-2xl", "font-bold", "text-cyan-400"], [1, "text-sm", "text-slate-400"], [1, "bg-gradient-to-br", "from-green-500/10", "to-emerald-500/10", "border", "border-green-500/20", "rounded-xl", "p-4"], [1, "text-2xl", "font-bold", "text-green-400"], [1, "bg-gradient-to-br", "from-amber-500/10", "to-orange-500/10", "border", "border-amber-500/20", "rounded-xl", "p-4"], [1, "text-2xl", "font-bold", "text-amber-400"], [1, "bg-gradient-to-br", "from-purple-500/10", "to-pink-500/10", "border", "border-purple-500/20", "rounded-xl", "p-4"], [1, "text-2xl", "font-bold", "text-purple-400"], [1, "bg-slate-900/50", "backdrop-blur-sm", "border", "border-slate-700", "rounded-xl", "p-6", "mb-8"], [1, "text-lg", "font-semibold", "text-white", "mb-4", "flex", "items-center", "gap-2"], [1, "grid", "grid-cols-1", "md:grid-cols-4", "gap-4"], [1, "block", "text-sm", "font-medium", "text-slate-400", "mb-1"], [1, "text-red-400"], ["type", "text", "placeholder", "\u4F8B\u5982: 12345678", 1, "w-full", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "px-4", "py-2", "text-white", "placeholder-slate-500", "focus:border-cyan-500", "focus:outline-none", 3, "ngModelChange", "ngModel"], ["type", "text", "placeholder", "32\u4F4D\u5341\u516D\u9032\u5236\u5B57\u7B26\u4E32", 1, "w-full", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "px-4", "py-2", "text-white", "placeholder-slate-500", "focus:border-cyan-500", "focus:outline-none", 3, "ngModelChange", "ngModel"], ["type", "text", "placeholder", "\u4F8B\u5982: \u4E3B\u529B API", 1, "w-full", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "px-4", "py-2", "text-white", "placeholder-slate-500", "focus:border-cyan-500", "focus:outline-none", 3, "ngModelChange", "ngModel"], [1, "flex", "items-end"], [1, "w-full", "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "hover:from-cyan-600", "hover:to-blue-600", "disabled:from-slate-600", "disabled:to-slate-600", "disabled:cursor-not-allowed", "text-white", "font-bold", "py-2", "px-4", "rounded-lg", "transition-all", "flex", "items-center", "justify-center", "gap-2", 3, "click", "disabled"], [1, "mt-3", "text-sm", "text-slate-500", "flex", "items-center", "gap-2"], ["href", "https://my.telegram.org", "target", "_blank", 1, "text-cyan-400", "hover:underline"], [1, "bg-slate-900/50", "backdrop-blur-sm", "border", "border-slate-700", "rounded-xl", "overflow-hidden"], [1, "p-4", "border-b", "border-slate-700"], [1, "text-lg", "font-semibold", "text-white", "flex", "items-center", "gap-2"], [1, "p-12", "text-center"], [1, "divide-y", "divide-slate-700"], [1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-50"], [1, "animate-spin"], [1, "animate-spin", "text-4xl", "mb-4"], [1, "text-slate-400"], [1, "text-6xl", "mb-4"], [1, "text-xl", "font-medium", "text-white", "mb-2"], [1, "p-4", "hover:bg-slate-800/50", "transition-colors", "flex", "items-center", "justify-between"], [1, "w-3", "h-3", "rounded-full"], [1, "flex", "items-center", "gap-2"], [1, "font-medium", "text-white"], [1, "text-xs", "bg-amber-500/20", "text-amber-400", "px-2", "py-0.5", "rounded"], [1, "text-xs", "bg-cyan-500/20", "text-cyan-400", "px-2", "py-0.5", "rounded"], [1, "text-right"], [1, "text-sm", "font-medium"], [1, "w-24", "h-1.5", "bg-slate-700", "rounded-full", "overflow-hidden"], [1, "h-full", "transition-all"], [1, "px-3", "py-1.5", "rounded-lg", "text-sm", "transition-colors", 3, "click"], [1, "px-3", "py-1.5", "bg-red-500/20", "text-red-400", "hover:bg-red-500/30", "rounded-lg", "text-sm", "transition-colors", 3, "click"], [1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-50", 3, "click"], [1, "bg-slate-900", "border", "border-slate-700", "rounded-xl", "p-6", "max-w-md", "w-full", "mx-4", 3, "click"], [1, "text-xl", "font-bold", "text-white", "mb-4"], [1, "text-slate-400", "mb-6"], [1, "text-white"], [1, "flex", "gap-3"], [1, "flex-1", "px-4", "py-2", "bg-slate-700", "hover:bg-slate-600", "text-white", "rounded-lg", "transition-colors", 3, "click"], [1, "flex-1", "px-4", "py-2", "bg-red-500", "hover:bg-red-600", "text-white", "rounded-lg", "transition-colors", 3, "click"], [1, "text-amber-400"]], template: function ApiCredentialsViewComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0)(1, "div", 1)(2, "div", 2)(3, "button", 3);
        \u0275\u0275listener("click", function ApiCredentialsViewComponent_Template_button_click_3_listener() {
          return ctx.goBack();
        });
        \u0275\u0275namespaceSVG();
        \u0275\u0275elementStart(4, "svg", 4);
        \u0275\u0275element(5, "path", 5);
        \u0275\u0275elementEnd();
        \u0275\u0275text(6, " \u8FD4\u56DE\u5E33\u865F\u7BA1\u7406 ");
        \u0275\u0275elementEnd()();
        \u0275\u0275namespaceHTML();
        \u0275\u0275elementStart(7, "button", 6);
        \u0275\u0275listener("click", function ApiCredentialsViewComponent_Template_button_click_7_listener() {
          return ctx.refreshList();
        });
        \u0275\u0275elementStart(8, "span");
        \u0275\u0275text(9, "\u{1F504}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(10, " \u5237\u65B0 ");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(11, "h1", 7);
        \u0275\u0275text(12, "\u{1F510} API \u6191\u64DA\u6C60");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(13, "p", 8);
        \u0275\u0275text(14, "\u7BA1\u7406\u60A8\u7684 Telegram API \u6191\u64DA\uFF0C\u6DFB\u52A0\u81EA\u5B9A\u7FA9 API \u4EE5\u7372\u5F97\u66F4\u597D\u7684\u7A69\u5B9A\u6027");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(15, "div", 9)(16, "div", 10)(17, "div", 11);
        \u0275\u0275text(18);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(19, "div", 12);
        \u0275\u0275text(20, "\u7E3D API \u6578\u91CF");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(21, "div", 13)(22, "div", 14);
        \u0275\u0275text(23);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(24, "div", 12);
        \u0275\u0275text(25, "\u6D3B\u8E8D\u4E2D");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(26, "div", 15)(27, "div", 16);
        \u0275\u0275text(28);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(29, "div", 12);
        \u0275\u0275text(30, "\u5DF2\u7D81\u5B9A\u5E33\u865F");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(31, "div", 17)(32, "div", 18);
        \u0275\u0275text(33);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(34, "div", 12);
        \u0275\u0275text(35, "\u7E3D\u5BB9\u91CF");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(36, "div", 19)(37, "h3", 20)(38, "span");
        \u0275\u0275text(39, "\u2795");
        \u0275\u0275elementEnd();
        \u0275\u0275text(40, " \u6DFB\u52A0\u65B0 API \u6191\u64DA ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(41, "div", 21)(42, "div")(43, "label", 22);
        \u0275\u0275text(44, "API ID ");
        \u0275\u0275elementStart(45, "span", 23);
        \u0275\u0275text(46, "*");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(47, "input", 24);
        \u0275\u0275twoWayListener("ngModelChange", function ApiCredentialsViewComponent_Template_input_ngModelChange_47_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.newApiId, $event) || (ctx.newApiId = $event);
          return $event;
        });
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(48, "div")(49, "label", 22);
        \u0275\u0275text(50, "API Hash ");
        \u0275\u0275elementStart(51, "span", 23);
        \u0275\u0275text(52, "*");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(53, "input", 25);
        \u0275\u0275twoWayListener("ngModelChange", function ApiCredentialsViewComponent_Template_input_ngModelChange_53_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.newApiHash, $event) || (ctx.newApiHash = $event);
          return $event;
        });
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(54, "div")(55, "label", 22);
        \u0275\u0275text(56, "\u540D\u7A31\uFF08\u53EF\u9078\uFF09");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(57, "input", 26);
        \u0275\u0275twoWayListener("ngModelChange", function ApiCredentialsViewComponent_Template_input_ngModelChange_57_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.newApiName, $event) || (ctx.newApiName = $event);
          return $event;
        });
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(58, "div", 27)(59, "button", 28);
        \u0275\u0275listener("click", function ApiCredentialsViewComponent_Template_button_click_59_listener() {
          return ctx.addCredential();
        });
        \u0275\u0275conditionalCreate(60, ApiCredentialsViewComponent_Conditional_60_Template, 3, 0)(61, ApiCredentialsViewComponent_Conditional_61_Template, 3, 0);
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(62, "div", 29)(63, "span");
        \u0275\u0275text(64, "\u{1F4A1}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(65, "span");
        \u0275\u0275text(66, "\u524D\u5F80 ");
        \u0275\u0275elementStart(67, "a", 30);
        \u0275\u0275text(68, "my.telegram.org");
        \u0275\u0275elementEnd();
        \u0275\u0275text(69, " \u7533\u8ACB\u60A8\u81EA\u5DF1\u7684 API \u6191\u64DA");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(70, "div", 31)(71, "div", 32)(72, "h3", 33)(73, "span");
        \u0275\u0275text(74, "\u{1F4CB}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(75, " \u6211\u7684 API \u5217\u8868 ");
        \u0275\u0275elementEnd()();
        \u0275\u0275conditionalCreate(76, ApiCredentialsViewComponent_Conditional_76_Template, 5, 0, "div", 34)(77, ApiCredentialsViewComponent_Conditional_77_Template, 7, 0, "div", 34)(78, ApiCredentialsViewComponent_Conditional_78_Template, 3, 0, "div", 35);
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(79, ApiCredentialsViewComponent_Conditional_79_Template, 15, 2, "div", 36);
        \u0275\u0275elementEnd();
      }
      if (rf & 2) {
        \u0275\u0275advance(7);
        \u0275\u0275property("disabled", ctx.isLoading());
        \u0275\u0275advance();
        \u0275\u0275classProp("animate-spin", ctx.isLoading());
        \u0275\u0275advance(10);
        \u0275\u0275textInterpolate(ctx.credentials().length);
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate(ctx.activeCount());
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate(ctx.totalAccountsUsed());
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate(ctx.totalCapacity());
        \u0275\u0275advance(14);
        \u0275\u0275twoWayProperty("ngModel", ctx.newApiId);
        \u0275\u0275advance(6);
        \u0275\u0275twoWayProperty("ngModel", ctx.newApiHash);
        \u0275\u0275advance(4);
        \u0275\u0275twoWayProperty("ngModel", ctx.newApiName);
        \u0275\u0275advance(2);
        \u0275\u0275property("disabled", !ctx.isFormValid() || ctx.isSaving());
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.isSaving() ? 60 : 61);
        \u0275\u0275advance(16);
        \u0275\u0275conditional(ctx.isLoading() ? 76 : ctx.credentials().length === 0 ? 77 : 78);
        \u0275\u0275advance(3);
        \u0275\u0275conditional(ctx.deleteTarget() ? 79 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, DefaultValueAccessor, NgControlStatus, NgModel], styles: ["\n\n[_nghost-%COMP%] {\n  display: block;\n}\n/*# sourceMappingURL=api-credentials-view.component.css.map */"], changeDetection: 0 });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(ApiCredentialsViewComponent, [{
    type: Component,
    args: [{ selector: "app-api-credentials-view", standalone: true, changeDetection: ChangeDetectionStrategy.OnPush, imports: [CommonModule, FormsModule], template: `
    <div class="max-w-6xl mx-auto">
      <!-- \u9801\u9762\u6A19\u984C -->
      <div class="flex items-center justify-between mb-8">
        <div class="flex items-center gap-4">
          <button (click)="goBack()" class="flex items-center gap-2 text-slate-400 hover:text-white transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            \u8FD4\u56DE\u5E33\u865F\u7BA1\u7406
          </button>
        </div>
        <button (click)="refreshList()" 
                class="flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors"
                [disabled]="isLoading()">
          <span [class.animate-spin]="isLoading()">\u{1F504}</span>
          \u5237\u65B0
        </button>
      </div>

      <h1 class="text-3xl font-bold text-white mb-2">\u{1F510} API \u6191\u64DA\u6C60</h1>
      <p class="text-slate-400 mb-8">\u7BA1\u7406\u60A8\u7684 Telegram API \u6191\u64DA\uFF0C\u6DFB\u52A0\u81EA\u5B9A\u7FA9 API \u4EE5\u7372\u5F97\u66F4\u597D\u7684\u7A69\u5B9A\u6027</p>

      <!-- \u7D71\u8A08\u5361\u7247 -->
      <div class="grid grid-cols-4 gap-4 mb-8">
        <div class="bg-gradient-to-br from-cyan-500/10 to-blue-500/10 border border-cyan-500/20 rounded-xl p-4">
          <div class="text-2xl font-bold text-cyan-400">{{ credentials().length }}</div>
          <div class="text-sm text-slate-400">\u7E3D API \u6578\u91CF</div>
        </div>
        <div class="bg-gradient-to-br from-green-500/10 to-emerald-500/10 border border-green-500/20 rounded-xl p-4">
          <div class="text-2xl font-bold text-green-400">{{ activeCount() }}</div>
          <div class="text-sm text-slate-400">\u6D3B\u8E8D\u4E2D</div>
        </div>
        <div class="bg-gradient-to-br from-amber-500/10 to-orange-500/10 border border-amber-500/20 rounded-xl p-4">
          <div class="text-2xl font-bold text-amber-400">{{ totalAccountsUsed() }}</div>
          <div class="text-sm text-slate-400">\u5DF2\u7D81\u5B9A\u5E33\u865F</div>
        </div>
        <div class="bg-gradient-to-br from-purple-500/10 to-pink-500/10 border border-purple-500/20 rounded-xl p-4">
          <div class="text-2xl font-bold text-purple-400">{{ totalCapacity() }}</div>
          <div class="text-sm text-slate-400">\u7E3D\u5BB9\u91CF</div>
        </div>
      </div>

      <!-- \u6DFB\u52A0\u65B0 API \u8868\u55AE -->
      <div class="bg-slate-900/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 mb-8">
        <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
          <span>\u2795</span> \u6DFB\u52A0\u65B0 API \u6191\u64DA
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-400 mb-1">API ID <span class="text-red-400">*</span></label>
            <input type="text" 
                   [(ngModel)]="newApiId"
                   placeholder="\u4F8B\u5982: 12345678"
                   class="w-full bg-slate-800 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-500 focus:border-cyan-500 focus:outline-none">
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-400 mb-1">API Hash <span class="text-red-400">*</span></label>
            <input type="text" 
                   [(ngModel)]="newApiHash"
                   placeholder="32\u4F4D\u5341\u516D\u9032\u5236\u5B57\u7B26\u4E32"
                   class="w-full bg-slate-800 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-500 focus:border-cyan-500 focus:outline-none">
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-400 mb-1">\u540D\u7A31\uFF08\u53EF\u9078\uFF09</label>
            <input type="text" 
                   [(ngModel)]="newApiName"
                   placeholder="\u4F8B\u5982: \u4E3B\u529B API"
                   class="w-full bg-slate-800 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-500 focus:border-cyan-500 focus:outline-none">
          </div>
          <div class="flex items-end">
            <button (click)="addCredential()" 
                    [disabled]="!isFormValid() || isSaving()"
                    class="w-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 disabled:from-slate-600 disabled:to-slate-600 disabled:cursor-not-allowed text-white font-bold py-2 px-4 rounded-lg transition-all flex items-center justify-center gap-2">
              @if (isSaving()) {
                <span class="animate-spin">\u23F3</span> \u4FDD\u5B58\u4E2D...
              } @else {
                <span>\u2795</span> \u6DFB\u52A0
              }
            </button>
          </div>
        </div>
        
        <div class="mt-3 text-sm text-slate-500 flex items-center gap-2">
          <span>\u{1F4A1}</span>
          <span>\u524D\u5F80 <a href="https://my.telegram.org" target="_blank" class="text-cyan-400 hover:underline">my.telegram.org</a> \u7533\u8ACB\u60A8\u81EA\u5DF1\u7684 API \u6191\u64DA</span>
        </div>
      </div>

      <!-- API \u5217\u8868 -->
      <div class="bg-slate-900/50 backdrop-blur-sm border border-slate-700 rounded-xl overflow-hidden">
        <div class="p-4 border-b border-slate-700">
          <h3 class="text-lg font-semibold text-white flex items-center gap-2">
            <span>\u{1F4CB}</span> \u6211\u7684 API \u5217\u8868
          </h3>
        </div>
        
        @if (isLoading()) {
          <div class="p-12 text-center">
            <div class="animate-spin text-4xl mb-4">\u23F3</div>
            <p class="text-slate-400">\u6B63\u5728\u52A0\u8F09...</p>
          </div>
        } @else if (credentials().length === 0) {
          <div class="p-12 text-center">
            <div class="text-6xl mb-4">\u{1F4ED}</div>
            <p class="text-xl font-medium text-white mb-2">\u9084\u6C92\u6709\u4EFB\u4F55 API \u6191\u64DA</p>
            <p class="text-slate-400">\u8ACB\u5728\u4E0A\u65B9\u8868\u55AE\u6DFB\u52A0\u60A8\u7684\u7B2C\u4E00\u500B API</p>
          </div>
        } @else {
          <div class="divide-y divide-slate-700">
            @for (cred of credentials(); track cred.api_id) {
              <div class="p-4 hover:bg-slate-800/50 transition-colors flex items-center justify-between">
                <div class="flex items-center gap-4">
                  <!-- \u72C0\u614B\u6307\u793A\u5668 -->
                  <div class="w-3 h-3 rounded-full" 
                       [class.bg-green-500]="cred.is_active"
                       [class.bg-slate-500]="!cred.is_active">
                  </div>
                  
                  <!-- API \u4FE1\u606F -->
                  <div>
                    <div class="flex items-center gap-2">
                      <span class="font-medium text-white">{{ cred.name }}</span>
                      @if (cred.is_public) {
                        <span class="text-xs bg-amber-500/20 text-amber-400 px-2 py-0.5 rounded">\u516C\u5171</span>
                      }
                      @if (cred.source === 'manual') {
                        <span class="text-xs bg-cyan-500/20 text-cyan-400 px-2 py-0.5 rounded">\u624B\u52D5\u6DFB\u52A0</span>
                      }
                    </div>
                    <div class="text-sm text-slate-400">
                      ID: {{ cred.api_id }} \u2022 Hash: {{ cred.api_hash.slice(0, 8) }}...{{ cred.api_hash.slice(-4) }}
                    </div>
                  </div>
                </div>
                
                <div class="flex items-center gap-4">
                  <!-- \u4F7F\u7528\u91CF -->
                  <div class="text-right">
                    <div class="text-sm font-medium" 
                         [class.text-green-400]="cred.account_count < cred.max_accounts * 0.8"
                         [class.text-amber-400]="cred.account_count >= cred.max_accounts * 0.8 && cred.account_count < cred.max_accounts"
                         [class.text-red-400]="cred.account_count >= cred.max_accounts">
                      {{ cred.account_count }}/{{ cred.max_accounts }} \u5E33\u865F
                    </div>
                    <div class="w-24 h-1.5 bg-slate-700 rounded-full overflow-hidden">
                      <div class="h-full transition-all"
                           [class.bg-green-500]="cred.account_count < cred.max_accounts * 0.8"
                           [class.bg-amber-500]="cred.account_count >= cred.max_accounts * 0.8 && cred.account_count < cred.max_accounts"
                           [class.bg-red-500]="cred.account_count >= cred.max_accounts"
                           [style.width.%]="(cred.account_count / cred.max_accounts) * 100">
                      </div>
                    </div>
                  </div>
                  
                  <!-- \u64CD\u4F5C\u6309\u9215 -->
                  <div class="flex items-center gap-2">
                    @if (!cred.is_public) {
                      <button (click)="toggleCredential(cred.api_id, !cred.is_active)"
                              class="px-3 py-1.5 rounded-lg text-sm transition-colors"
                              [class.bg-green-500/20]="!cred.is_active"
                              [class.text-green-400]="!cred.is_active"
                              [class.hover:bg-green-500/30]="!cred.is_active"
                              [class.bg-amber-500/20]="cred.is_active"
                              [class.text-amber-400]="cred.is_active"
                              [class.hover:bg-amber-500/30]="cred.is_active">
                        {{ cred.is_active ? '\u505C\u7528' : '\u555F\u7528' }}
                      </button>
                      <button (click)="confirmDelete(cred)"
                              class="px-3 py-1.5 bg-red-500/20 text-red-400 hover:bg-red-500/30 rounded-lg text-sm transition-colors">
                        \u522A\u9664
                      </button>
                    }
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- \u522A\u9664\u78BA\u8A8D\u5C0D\u8A71\u6846 -->
      @if (deleteTarget()) {
        <div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50" (click)="cancelDelete()">
          <div class="bg-slate-900 border border-slate-700 rounded-xl p-6 max-w-md w-full mx-4" (click)="$event.stopPropagation()">
            <h3 class="text-xl font-bold text-white mb-4">\u78BA\u8A8D\u522A\u9664</h3>
            <p class="text-slate-400 mb-6">
              \u78BA\u5B9A\u8981\u522A\u9664 API\u300C<span class="text-white">{{ deleteTarget()!.name }}</span>\u300D\u55CE\uFF1F
              @if (deleteTarget()!.account_count > 0) {
                <br><span class="text-amber-400">\u26A0\uFE0F \u6B64 API \u76EE\u524D\u6709 {{ deleteTarget()!.account_count }} \u500B\u5E33\u865F\u5728\u4F7F\u7528\u3002</span>
              }
            </p>
            <div class="flex gap-3">
              <button (click)="cancelDelete()" class="flex-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">
                \u53D6\u6D88
              </button>
              <button (click)="doDelete()" class="flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors">
                \u78BA\u8A8D\u522A\u9664
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  `, styles: ["/* angular:styles/component:css;219558ef63f119a92210704329b58a3cdceaa4fb296db559e672f74512827dc7;D:/tgkz2026/src/views/api-credentials-view.component.ts */\n:host {\n  display: block;\n}\n/*# sourceMappingURL=api-credentials-view.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(ApiCredentialsViewComponent, { className: "ApiCredentialsViewComponent", filePath: "src/views/api-credentials-view.component.ts", lineNumber: 243 });
})();

// src/membership-center.component.ts
var _c03 = () => ["bronze", "silver"];
var _c1 = () => ["bronze", "silver", "gold"];
var _forTrack014 = ($index, $item) => $item.id;
function MembershipCenterComponent_Conditional_15_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 10);
    \u0275\u0275text(1);
    \u0275\u0275elementStart(2, "span", 34);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u6709\u6548\u671F\u81F3 ", ctx_r0.formatDate(ctx_r0.membershipExpires()), " ");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("(\u5269\u9918 ", ctx_r0.membershipDaysLeft(), " \u5929)");
  }
}
function MembershipCenterComponent_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 10);
    \u0275\u0275text(1, "\u6C38\u4E45\u514D\u8CBB\u7248");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_18_Template(rf, ctx) {
  if (rf & 1) {
    const _r2 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 35);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_18_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.activeTab.set("upgrade"));
    });
    \u0275\u0275text(1, " \u{1F680} \u7ACB\u5373\u5347\u7D1A ");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_div_29_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 36);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u8D08\u9001: ", ctx_r0.walletBonusDisplay(), " ");
  }
}
function MembershipCenterComponent_Conditional_82_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 33)(1, "div", 37)(2, "h3", 38);
    \u0275\u0275text(3, "\u{1F4CA} \u672C\u6708\u4F7F\u7528\u8A73\u60C5");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 39)(5, "div", 40)(6, "span", 41);
    \u0275\u0275text(7, "\u{1F916} AI \u8ABF\u7528\u6B21\u6578");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 42)(9, "div", 43);
    \u0275\u0275element(10, "div", 44);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(11, "span", 45);
    \u0275\u0275text(12);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(13, "div", 40)(14, "span", 41);
    \u0275\u0275text(15, "\u{1F4E8} \u6D88\u606F\u767C\u9001");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "div", 42)(17, "div", 43);
    \u0275\u0275element(18, "div", 44);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(19, "span", 45);
    \u0275\u0275text(20);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(21, "div", 40)(22, "span", 41);
    \u0275\u0275text(23, "\u{1F465} \u5E33\u865F\u6578\u91CF");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(24, "div", 42)(25, "div", 43);
    \u0275\u0275element(26, "div", 44);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(27, "span", 45);
    \u0275\u0275text(28);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(29, "div", 40)(30, "span", 41);
    \u0275\u0275text(31, "\u{1F4BE} \u5B58\u5132\u7A7A\u9593");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(32, "div", 42)(33, "div", 43);
    \u0275\u0275element(34, "div", 44);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(35, "span", 45);
    \u0275\u0275text(36);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(37, "div", 46)(38, "h3", 38);
    \u0275\u0275text(39, "\u{1F381} \u9080\u8ACB\u597D\u53CB\u5F97\u734E\u52F5");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(40, "p", 47);
    \u0275\u0275text(41, "\u6BCF\u9080\u8ACB 1 \u4F4D\u597D\u53CB\u8A3B\u518A\u4E26\u6FC0\u6D3B\uFF0C\u60A8\u5C07\u7372\u5F97 ");
    \u0275\u0275elementStart(42, "strong");
    \u0275\u0275text(43, "3 \u5929\u767D\u9280\u7CBE\u82F1");
    \u0275\u0275elementEnd();
    \u0275\u0275text(44, " \u734E\u52F5\uFF01");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(45, "div", 48)(46, "span", 49);
    \u0275\u0275text(47, "\u6211\u7684\u9080\u8ACB\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(48, "span", 50);
    \u0275\u0275text(49);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(50, "button", 51);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_82_Template_button_click_50_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.copyInviteCode());
    });
    \u0275\u0275text(51, "\u{1F4CB} \u8907\u88FD");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(52, "div", 52)(53, "div", 53)(54, "span", 54);
    \u0275\u0275text(55);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(56, "span", 49);
    \u0275\u0275text(57, "\u5DF2\u9080\u8ACB\u4EBA\u6578");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(58, "div", 53)(59, "span", 54);
    \u0275\u0275text(60);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(61, "span", 49);
    \u0275\u0275text(62, "\u7372\u5F97\u734E\u52F5\u5929\u6578");
    \u0275\u0275elementEnd()()()()();
  }
  if (rf & 2) {
    let tmp_2_0;
    let tmp_4_0;
    let tmp_6_0;
    let tmp_8_0;
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(10);
    \u0275\u0275styleProp("width", ctx_r0.getAiUsagePercent(), "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2("", ((tmp_2_0 = ctx_r0.usageStats()) == null ? null : tmp_2_0.aiCalls == null ? null : tmp_2_0.aiCalls.used) || 0, " / ", ((tmp_2_0 = ctx_r0.usageStats()) == null ? null : tmp_2_0.aiCalls == null ? null : tmp_2_0.aiCalls.limit) || 50);
    \u0275\u0275advance(6);
    \u0275\u0275styleProp("width", ctx_r0.getMessageUsagePercent(), "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2("", ((tmp_4_0 = ctx_r0.usageStats()) == null ? null : tmp_4_0.messagesSent == null ? null : tmp_4_0.messagesSent.used) || 0, " / ", ((tmp_4_0 = ctx_r0.usageStats()) == null ? null : tmp_4_0.messagesSent == null ? null : tmp_4_0.messagesSent.limit) || 100);
    \u0275\u0275advance(6);
    \u0275\u0275styleProp("width", ctx_r0.getAccountUsagePercent(), "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2("", ((tmp_6_0 = ctx_r0.usageStats()) == null ? null : tmp_6_0.accounts == null ? null : tmp_6_0.accounts.used) || 0, " / ", ((tmp_6_0 = ctx_r0.usageStats()) == null ? null : tmp_6_0.accounts == null ? null : tmp_6_0.accounts.limit) || 2);
    \u0275\u0275advance(6);
    \u0275\u0275styleProp("width", ctx_r0.getStorageUsagePercent(), "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2("", ((tmp_8_0 = ctx_r0.usageStats()) == null ? null : tmp_8_0.storage == null ? null : tmp_8_0.storage.used) || 0, " MB / ", ((tmp_8_0 = ctx_r0.usageStats()) == null ? null : tmp_8_0.storage == null ? null : tmp_8_0.storage.limit) || 10, " MB");
    \u0275\u0275advance(13);
    \u0275\u0275textInterpolate(ctx_r0.inviteCode());
    \u0275\u0275advance(6);
    \u0275\u0275textInterpolate(ctx_r0.invitedCount());
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r0.rewardDays());
  }
}
function MembershipCenterComponent_Conditional_83_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 33)(1, "div", 55)(2, "table", 56)(3, "thead")(4, "tr")(5, "th", 57);
    \u0275\u0275text(6, "\u529F\u80FD");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "th", 58);
    \u0275\u0275text(8, "\u2694\uFE0F \u9752\u9285");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "th", 59);
    \u0275\u0275text(10, "\u{1F948} \u767D\u9280");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "th", 60);
    \u0275\u0275text(12, "\u{1F947} \u9EC3\u91D1");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "th", 61);
    \u0275\u0275text(14, "\u{1F48E} \u947D\u77F3");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "th", 62);
    \u0275\u0275text(16, "\u{1F31F} \u661F\u8000");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(17, "th", 63);
    \u0275\u0275text(18, "\u{1F451} \u738B\u8005");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(19, "tbody")(20, "tr")(21, "td", 64);
    \u0275\u0275text(22, "\u5E33\u865F\u6578\u91CF");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(23, "td");
    \u0275\u0275text(24, "2 \u500B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(25, "td");
    \u0275\u0275text(26, "5 \u500B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(27, "td");
    \u0275\u0275text(28, "10 \u500B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(29, "td");
    \u0275\u0275text(30, "20 \u500B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(31, "td");
    \u0275\u0275text(32, "50 \u500B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(33, "td");
    \u0275\u0275text(34, "\u7121\u9650");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(35, "tr")(36, "td", 64);
    \u0275\u0275text(37, "\u6BCF\u65E5\u6D88\u606F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(38, "td");
    \u0275\u0275text(39, "20 \u689D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(40, "td");
    \u0275\u0275text(41, "100 \u689D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(42, "td");
    \u0275\u0275text(43, "300 \u689D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(44, "td");
    \u0275\u0275text(45, "1,000 \u689D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(46, "td");
    \u0275\u0275text(47, "\u7121\u9650");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(48, "td");
    \u0275\u0275text(49, "\u7121\u9650");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(50, "tr")(51, "td", 64);
    \u0275\u0275text(52, "\u6BCF\u65E5 AI \u8ABF\u7528");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(53, "td");
    \u0275\u0275text(54, "10 \u6B21");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(55, "td");
    \u0275\u0275text(56, "50 \u6B21");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(57, "td");
    \u0275\u0275text(58, "200 \u6B21");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(59, "td");
    \u0275\u0275text(60, "\u7121\u9650");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(61, "td");
    \u0275\u0275text(62, "\u7121\u9650");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(63, "td");
    \u0275\u0275text(64, "\u7121\u9650");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(65, "tr")(66, "td", 64);
    \u0275\u0275text(67, "\u7FA4\u7D44\u6578\u91CF");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(68, "td");
    \u0275\u0275text(69, "3 \u500B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(70, "td");
    \u0275\u0275text(71, "10 \u500B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(72, "td");
    \u0275\u0275text(73, "30 \u500B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(74, "td");
    \u0275\u0275text(75, "100 \u500B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(76, "td");
    \u0275\u0275text(77, "\u7121\u9650");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(78, "td");
    \u0275\u0275text(79, "\u7121\u9650");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(80, "tr")(81, "td", 64);
    \u0275\u0275text(82, "\u5EE3\u544A\u767C\u9001");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(83, "td");
    \u0275\u0275text(84, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(85, "td");
    \u0275\u0275text(86, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(87, "td");
    \u0275\u0275text(88, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(89, "td");
    \u0275\u0275text(90, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(91, "td");
    \u0275\u0275text(92, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(93, "td");
    \u0275\u0275text(94, "\u2705");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(95, "tr")(96, "td", 64);
    \u0275\u0275text(97, "\u6279\u91CF\u64CD\u4F5C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(98, "td");
    \u0275\u0275text(99, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(100, "td");
    \u0275\u0275text(101, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(102, "td");
    \u0275\u0275text(103, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(104, "td");
    \u0275\u0275text(105, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(106, "td");
    \u0275\u0275text(107, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(108, "td");
    \u0275\u0275text(109, "\u2705");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(110, "tr")(111, "td", 64);
    \u0275\u0275text(112, "AI \u92B7\u552E\u6F0F\u6597");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(113, "td");
    \u0275\u0275text(114, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(115, "td");
    \u0275\u0275text(116, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(117, "td");
    \u0275\u0275text(118, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(119, "td");
    \u0275\u0275text(120, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(121, "td");
    \u0275\u0275text(122, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(123, "td");
    \u0275\u0275text(124, "\u2705");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(125, "tr")(126, "td", 64);
    \u0275\u0275text(127, "\u667A\u80FD\u9632\u5C01");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(128, "td");
    \u0275\u0275text(129, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(130, "td");
    \u0275\u0275text(131, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(132, "td");
    \u0275\u0275text(133, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(134, "td");
    \u0275\u0275text(135, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(136, "td");
    \u0275\u0275text(137, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(138, "td");
    \u0275\u0275text(139, "\u2705");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(140, "tr")(141, "td", 64);
    \u0275\u0275text(142, "API \u63A5\u53E3");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(143, "td");
    \u0275\u0275text(144, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(145, "td");
    \u0275\u0275text(146, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(147, "td");
    \u0275\u0275text(148, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(149, "td");
    \u0275\u0275text(150, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(151, "td");
    \u0275\u0275text(152, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(153, "td");
    \u0275\u0275text(154, "\u2705");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(155, "tr")(156, "td", 64);
    \u0275\u0275text(157, "\u512A\u5148\u652F\u6301");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(158, "td");
    \u0275\u0275text(159, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(160, "td");
    \u0275\u0275text(161, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(162, "td");
    \u0275\u0275text(163, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(164, "td");
    \u0275\u0275text(165, "\u274C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(166, "td");
    \u0275\u0275text(167, "\u2705");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(168, "td");
    \u0275\u0275text(169, "\u2705 \u5C08\u5C6C");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(170, "tr", 65)(171, "td", 64);
    \u0275\u0275text(172, "\u50F9\u683C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(173, "td", 66);
    \u0275\u0275text(174, "\u514D\u8CBB");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(175, "td", 66);
    \u0275\u0275text(176, "4.99 USDT/\u6708");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(177, "td", 66);
    \u0275\u0275text(178, "19.9 USDT/\u6708");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(179, "td", 66);
    \u0275\u0275text(180, "59.9 USDT/\u6708");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(181, "td", 66);
    \u0275\u0275text(182, "199 USDT/\u6708");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(183, "td", 66);
    \u0275\u0275text(184, "599 USDT/\u6708");
    \u0275\u0275elementEnd()()()()()();
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 69);
    \u0275\u0275text(1, "\u7576\u524D\u65B9\u6848");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_24_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 90);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Conditional_24_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onPurchase("silver", "month"));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r0.membershipLevel() === "bronze" ? "\u7ACB\u5373\u958B\u901A" : "\u5207\u63DB\u65B9\u6848", " ");
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_25_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 91);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Conditional_25_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onPurchase("silver", "month"));
    });
    \u0275\u0275text(1, " \u7E8C\u8CBB ");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_27_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 69);
    \u0275\u0275text(1, "\u7576\u524D\u65B9\u6848");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_50_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 90);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Conditional_50_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onPurchase("gold", "month"));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pureFunction0(1, _c03).includes(ctx_r0.membershipLevel()) ? "\u7ACB\u5373\u5347\u7D1A" : "\u5207\u63DB\u65B9\u6848", " ");
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_51_Template(rf, ctx) {
  if (rf & 1) {
    const _r8 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 91);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Conditional_51_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r8);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onPurchase("gold", "month"));
    });
    \u0275\u0275text(1, " \u7E8C\u8CBB ");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_55_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 69);
    \u0275\u0275text(1, "\u7576\u524D\u65B9\u6848");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_78_Template(rf, ctx) {
  if (rf & 1) {
    const _r9 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 90);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Conditional_78_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r9);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onPurchase("diamond", "month"));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", \u0275\u0275pureFunction0(1, _c1).includes(ctx_r0.membershipLevel()) ? "\u7ACB\u5373\u5347\u7D1A" : "\u5207\u63DB\u65B9\u6848", " ");
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_79_Template(rf, ctx) {
  if (rf & 1) {
    const _r10 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 91);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Conditional_79_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r10);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onPurchase("diamond", "month"));
    });
    \u0275\u0275text(1, " \u7E8C\u8CBB ");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_81_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 69);
    \u0275\u0275text(1, "\u7576\u524D\u65B9\u6848");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_104_Template(rf, ctx) {
  if (rf & 1) {
    const _r11 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 90);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Conditional_104_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onPurchase("star", "month"));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r0.membershipLevel() !== "king" ? "\u7ACB\u5373\u5347\u7D1A" : "\u5207\u63DB\u65B9\u6848", " ");
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_105_Template(rf, ctx) {
  if (rf & 1) {
    const _r12 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 91);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Conditional_105_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r12);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onPurchase("star", "month"));
    });
    \u0275\u0275text(1, " \u7E8C\u8CBB ");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_107_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 69);
    \u0275\u0275text(1, "\u7576\u524D\u65B9\u6848");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_132_Template(rf, ctx) {
  if (rf & 1) {
    const _r13 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 90);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Conditional_132_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r13);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onPurchase("king", "month"));
    });
    \u0275\u0275text(1, " \u7D42\u6975\u5347\u7D1A ");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_84_Conditional_133_Template(rf, ctx) {
  if (rf & 1) {
    const _r14 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 91);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Conditional_133_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r14);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onPurchase("king", "month"));
    });
    \u0275\u0275text(1, " \u7E8C\u8CBB ");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_84_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 33)(1, "div", 67)(2, "div", 68);
    \u0275\u0275conditionalCreate(3, MembershipCenterComponent_Conditional_84_Conditional_3_Template, 2, 0, "div", 69);
    \u0275\u0275elementStart(4, "div", 70);
    \u0275\u0275text(5, "\u{1F948}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "h3", 71);
    \u0275\u0275text(7, "\u767D\u9280\u7CBE\u82F1");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 72)(9, "span", 73);
    \u0275\u0275text(10, "4.99 USDT");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "span", 74);
    \u0275\u0275text(12, "/\u6708");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(13, "ul", 75)(14, "li");
    \u0275\u0275text(15, "\u2705 5 \u500B\u5E33\u865F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "li");
    \u0275\u0275text(17, "\u2705 \u6BCF\u65E5 100 \u689D\u6D88\u606F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "li");
    \u0275\u0275text(19, "\u2705 \u6BCF\u65E5 50 \u6B21 AI");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(20, "li");
    \u0275\u0275text(21, "\u2705 10 \u500B\u7FA4\u7D44");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(22, "li");
    \u0275\u0275text(23, "\u2705 \u5EE3\u544A\u767C\u9001");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(24, MembershipCenterComponent_Conditional_84_Conditional_24_Template, 2, 1, "button", 76)(25, MembershipCenterComponent_Conditional_84_Conditional_25_Template, 2, 0, "button", 77);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(26, "div", 78);
    \u0275\u0275conditionalCreate(27, MembershipCenterComponent_Conditional_84_Conditional_27_Template, 2, 0, "div", 69);
    \u0275\u0275elementStart(28, "div", 70);
    \u0275\u0275text(29, "\u{1F947}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(30, "h3", 71);
    \u0275\u0275text(31, "\u9EC3\u91D1\u5927\u5E2B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(32, "div", 72)(33, "span", 73);
    \u0275\u0275text(34, "19.9 USDT");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(35, "span", 74);
    \u0275\u0275text(36, "/\u6708");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(37, "ul", 75)(38, "li");
    \u0275\u0275text(39, "\u2705 15 \u500B\u5E33\u865F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(40, "li");
    \u0275\u0275text(41, "\u2705 \u6BCF\u65E5 500 \u689D\u6D88\u606F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(42, "li");
    \u0275\u0275text(43, "\u2705 \u6BCF\u65E5 300 \u6B21 AI");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(44, "li");
    \u0275\u0275text(45, "\u2705 50 \u500B\u7FA4\u7D44");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(46, "li");
    \u0275\u0275text(47, "\u2705 \u6279\u91CF\u64CD\u4F5C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(48, "li");
    \u0275\u0275text(49, "\u2705 \u6578\u64DA\u5C0E\u51FA");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(50, MembershipCenterComponent_Conditional_84_Conditional_50_Template, 2, 2, "button", 76)(51, MembershipCenterComponent_Conditional_84_Conditional_51_Template, 2, 0, "button", 77);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(52, "div", 79)(53, "div", 80);
    \u0275\u0275text(54, "\u63A8\u85A6");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(55, MembershipCenterComponent_Conditional_84_Conditional_55_Template, 2, 0, "div", 69);
    \u0275\u0275elementStart(56, "div", 70);
    \u0275\u0275text(57, "\u{1F48E}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(58, "h3", 71);
    \u0275\u0275text(59, "\u947D\u77F3\u738B\u724C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(60, "div", 72)(61, "span", 73);
    \u0275\u0275text(62, "59.9 USDT");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(63, "span", 74);
    \u0275\u0275text(64, "/\u6708");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(65, "ul", 75)(66, "li");
    \u0275\u0275text(67, "\u2705 50 \u500B\u5E33\u865F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(68, "li");
    \u0275\u0275text(69, "\u2705 \u6BCF\u65E5 2000 \u689D\u6D88\u606F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(70, "li");
    \u0275\u0275text(71, "\u2705 \u7121\u9650 AI \u8ABF\u7528");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(72, "li");
    \u0275\u0275text(73, "\u2705 200 \u500B\u7FA4\u7D44");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(74, "li");
    \u0275\u0275text(75, "\u2705 AI \u92B7\u552E\u6F0F\u6597");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(76, "li");
    \u0275\u0275text(77, "\u2705 \u9AD8\u7D1A\u5206\u6790");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(78, MembershipCenterComponent_Conditional_84_Conditional_78_Template, 2, 2, "button", 76)(79, MembershipCenterComponent_Conditional_84_Conditional_79_Template, 2, 0, "button", 77);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(80, "div", 81);
    \u0275\u0275conditionalCreate(81, MembershipCenterComponent_Conditional_84_Conditional_81_Template, 2, 0, "div", 69);
    \u0275\u0275elementStart(82, "div", 70);
    \u0275\u0275text(83, "\u{1F31F}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(84, "h3", 71);
    \u0275\u0275text(85, "\u661F\u8000\u50B3\u8AAA");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(86, "div", 72)(87, "span", 73);
    \u0275\u0275text(88, "199 USDT");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(89, "span", 74);
    \u0275\u0275text(90, "/\u6708");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(91, "ul", 75)(92, "li");
    \u0275\u0275text(93, "\u2705 100 \u500B\u5E33\u865F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(94, "li");
    \u0275\u0275text(95, "\u2705 \u7121\u9650\u6D88\u606F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(96, "li");
    \u0275\u0275text(97, "\u2705 \u7121\u9650 AI");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(98, "li");
    \u0275\u0275text(99, "\u2705 \u7121\u9650\u7FA4\u7D44");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(100, "li");
    \u0275\u0275text(101, "\u2705 \u667A\u80FD\u9632\u5C01");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(102, "li");
    \u0275\u0275text(103, "\u2705 \u5718\u968A\u7BA1\u7406");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(104, MembershipCenterComponent_Conditional_84_Conditional_104_Template, 2, 1, "button", 76)(105, MembershipCenterComponent_Conditional_84_Conditional_105_Template, 2, 0, "button", 77);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(106, "div", 82);
    \u0275\u0275conditionalCreate(107, MembershipCenterComponent_Conditional_84_Conditional_107_Template, 2, 0, "div", 69);
    \u0275\u0275elementStart(108, "div", 70);
    \u0275\u0275text(109, "\u{1F451}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(110, "h3", 71);
    \u0275\u0275text(111, "\u69AE\u8000\u738B\u8005");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(112, "div", 72)(113, "span", 73);
    \u0275\u0275text(114, "599 USDT");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(115, "span", 74);
    \u0275\u0275text(116, "/\u6708");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(117, "div", 83);
    \u0275\u0275text(118, "\u5C0A\u4EAB\u7279\u6B0A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(119, "ul", 75)(120, "li");
    \u0275\u0275text(121, "\u2705 \u7121\u9650\u5E33\u865F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(122, "li");
    \u0275\u0275text(123, "\u2705 \u7121\u9650\u4E00\u5207");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(124, "li");
    \u0275\u0275text(125, "\u2705 API \u63A5\u53E3");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(126, "li");
    \u0275\u0275text(127, "\u2705 \u81EA\u5B9A\u7FA9\u54C1\u724C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(128, "li");
    \u0275\u0275text(129, "\u2705 \u5C08\u5C6C\u9867\u554F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(130, "li");
    \u0275\u0275text(131, "\u2705 \u65B0\u529F\u80FD\u5167\u6E2C");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(132, MembershipCenterComponent_Conditional_84_Conditional_132_Template, 2, 0, "button", 76)(133, MembershipCenterComponent_Conditional_84_Conditional_133_Template, 2, 0, "button", 77);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(134, "div", 37)(135, "h3", 38);
    \u0275\u0275text(136, "\u{1F3AB} \u4F7F\u7528\u5361\u5BC6\u6FC0\u6D3B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(137, "div", 84)(138, "input", 85);
    \u0275\u0275twoWayListener("ngModelChange", function MembershipCenterComponent_Conditional_84_Template_input_ngModelChange_138_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r0.licenseKey, $event) || (ctx_r0.licenseKey = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(139, "button", 86);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Template_button_click_139_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.onActivateLicense());
    });
    \u0275\u0275text(140, " \u6FC0\u6D3B ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(141, "div", 37)(142, "h3", 38);
    \u0275\u0275text(143, "\u{1F4B3} \u652F\u4ED8\u65B9\u5F0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(144, "div", 87)(145, "button", 88);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Template_button_click_145_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.selectedPayment.set("alipay"));
    });
    \u0275\u0275elementStart(146, "span", 89);
    \u0275\u0275text(147, "\u{1F499}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(148, " \u652F\u4ED8\u5BF6 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(149, "button", 88);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Template_button_click_149_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.selectedPayment.set("wechat"));
    });
    \u0275\u0275elementStart(150, "span", 89);
    \u0275\u0275text(151, "\u{1F49A}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(152, " \u5FAE\u4FE1\u652F\u4ED8 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(153, "button", 88);
    \u0275\u0275listener("click", function MembershipCenterComponent_Conditional_84_Template_button_click_153_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.selectedPayment.set("usdt"));
    });
    \u0275\u0275elementStart(154, "span", 89);
    \u0275\u0275text(155, "\u{1F48E}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(156, " USDT ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(2);
    \u0275\u0275classProp("current", ctx_r0.membershipLevel() === "silver");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.membershipLevel() === "silver" ? 3 : -1);
    \u0275\u0275advance(21);
    \u0275\u0275conditional(ctx_r0.membershipLevel() !== "silver" ? 24 : 25);
    \u0275\u0275advance(2);
    \u0275\u0275classProp("current", ctx_r0.membershipLevel() === "gold");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.membershipLevel() === "gold" ? 27 : -1);
    \u0275\u0275advance(23);
    \u0275\u0275conditional(ctx_r0.membershipLevel() !== "gold" ? 50 : 51);
    \u0275\u0275advance(2);
    \u0275\u0275classProp("current", ctx_r0.membershipLevel() === "diamond");
    \u0275\u0275advance(3);
    \u0275\u0275conditional(ctx_r0.membershipLevel() === "diamond" ? 55 : -1);
    \u0275\u0275advance(23);
    \u0275\u0275conditional(ctx_r0.membershipLevel() !== "diamond" ? 78 : 79);
    \u0275\u0275advance(2);
    \u0275\u0275classProp("current", ctx_r0.membershipLevel() === "star");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.membershipLevel() === "star" ? 81 : -1);
    \u0275\u0275advance(23);
    \u0275\u0275conditional(ctx_r0.membershipLevel() !== "star" ? 104 : 105);
    \u0275\u0275advance(2);
    \u0275\u0275classProp("current", ctx_r0.membershipLevel() === "king");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.membershipLevel() === "king" ? 107 : -1);
    \u0275\u0275advance(25);
    \u0275\u0275conditional(ctx_r0.membershipLevel() !== "king" ? 132 : 133);
    \u0275\u0275advance(6);
    \u0275\u0275twoWayProperty("ngModel", ctx_r0.licenseKey);
    \u0275\u0275advance();
    \u0275\u0275property("disabled", !ctx_r0.licenseKey);
    \u0275\u0275advance(6);
    \u0275\u0275classProp("active", ctx_r0.selectedPayment() === "alipay");
    \u0275\u0275advance(4);
    \u0275\u0275classProp("active", ctx_r0.selectedPayment() === "wechat");
    \u0275\u0275advance(4);
    \u0275\u0275classProp("active", ctx_r0.selectedPayment() === "usdt");
  }
}
function MembershipCenterComponent_Conditional_85_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 93);
    \u0275\u0275text(1, "\u8F09\u5165\u4E2D...");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_85_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 94);
    \u0275\u0275text(1, "\u66AB\u7121\u8A02\u95B1\u8A18\u9304");
    \u0275\u0275elementEnd();
  }
}
function MembershipCenterComponent_Conditional_85_Conditional_7_For_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 95)(1, "div", 96);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 97)(4, "div", 98);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "div", 99);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(8, "div", 100);
    \u0275\u0275text(9);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const record_r15 = ctx.$implicit;
    const ctx_r0 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(record_r15.level_icon || "\u{1F3AB}");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate2("", record_r15.level_name, " ", record_r15.duration_name, "\u6FC0\u6D3B");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("", ctx_r0.formatActivationDate(record_r15.activated_at), " \xB7 \u5361\u5BC6\u6FC0\u6D3B");
    \u0275\u0275advance();
    \u0275\u0275classProp("active", record_r15.is_active)("used", !record_r15.is_active);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", record_r15.is_active ? "\u751F\u6548\u4E2D" : "\u5DF2\u904E\u671F", " ");
  }
}
function MembershipCenterComponent_Conditional_85_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275repeaterCreate(0, MembershipCenterComponent_Conditional_85_Conditional_7_For_1_Template, 10, 9, "div", 95, _forTrack014);
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275repeater(ctx_r0.subscriptionHistory());
  }
}
function MembershipCenterComponent_Conditional_85_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 33)(1, "div", 37)(2, "h3", 38);
    \u0275\u0275text(3, "\u{1F4DC} \u8A02\u95B1\u6B77\u53F2");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 92);
    \u0275\u0275conditionalCreate(5, MembershipCenterComponent_Conditional_85_Conditional_5_Template, 2, 0, "div", 93)(6, MembershipCenterComponent_Conditional_85_Conditional_6_Template, 2, 0, "div", 94)(7, MembershipCenterComponent_Conditional_85_Conditional_7_Template, 2, 0);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(5);
    \u0275\u0275conditional(ctx_r0.isLoadingHistory() ? 5 : ctx_r0.subscriptionHistory().length === 0 ? 6 : 7);
  }
}
var MembershipCenterComponent = class _MembershipCenterComponent {
  constructor() {
    this.authService = inject(AuthService2);
    this.membershipService = inject(MembershipService);
    this.toast = inject(ToastService);
    this.licenseClient = inject(LicenseClientService);
    this.cdr = inject(ChangeDetectorRef);
    this.walletService = inject(WalletService);
    this.membershipUpdateHandler = null;
    this.activeTab = signal("overview", ...ngDevMode ? [{ debugName: "activeTab" }] : []);
    this.selectedPayment = signal("alipay", ...ngDevMode ? [{ debugName: "selectedPayment" }] : []);
    this.licenseKey = "";
    this.wallet = signal(null, ...ngDevMode ? [{ debugName: "wallet" }] : []);
    this.walletBalanceDisplay = computed(() => {
      const w = this.wallet();
      if (!w)
        return "$0.00";
      return "$" + (w.available_balance / 100).toFixed(2);
    }, ...ngDevMode ? [{ debugName: "walletBalanceDisplay" }] : []);
    this.walletBonusDisplay = computed(() => {
      const w = this.wallet();
      if (!w)
        return "$0.00";
      return "$" + ((w.bonus_balance || 0) / 100).toFixed(2);
    }, ...ngDevMode ? [{ debugName: "walletBonusDisplay" }] : []);
    this.user = computed(() => this.authService.user(), ...ngDevMode ? [{ debugName: "user" }] : []);
    this.membershipLevel = computed(() => this.authService.membershipLevel(), ...ngDevMode ? [{ debugName: "membershipLevel" }] : []);
    this.membershipExpires = computed(() => this.authService.user()?.membershipExpires, ...ngDevMode ? [{ debugName: "membershipExpires" }] : []);
    this.membershipDaysLeft = computed(() => this.authService.membershipDaysLeft(), ...ngDevMode ? [{ debugName: "membershipDaysLeft" }] : []);
    this.usageStats = computed(() => this.authService.usageStats(), ...ngDevMode ? [{ debugName: "usageStats" }] : []);
    this.inviteCode = signal("", ...ngDevMode ? [{ debugName: "inviteCode" }] : []);
    this.invitedCount = signal(0, ...ngDevMode ? [{ debugName: "invitedCount" }] : []);
    this.rewardDays = signal(0, ...ngDevMode ? [{ debugName: "rewardDays" }] : []);
    this.subscriptionHistory = signal([], ...ngDevMode ? [{ debugName: "subscriptionHistory" }] : []);
    this.isLoadingHistory = signal(false, ...ngDevMode ? [{ debugName: "isLoadingHistory" }] : []);
  }
  async ngOnInit() {
    const rewards = await this.authService.getInviteRewards();
    this.inviteCode.set(rewards.inviteCode);
    this.invitedCount.set(rewards.invitedCount);
    this.rewardDays.set(rewards.rewardDays);
    await this.loadWallet();
    await this.loadSubscriptionHistory();
    this.membershipUpdateHandler = (event) => {
      const customEvent = event;
      console.log("[MembershipCenterComponent] \u6536\u5230\u6703\u54E1\u72C0\u614B\u66F4\u65B0\u4E8B\u4EF6:", customEvent.detail);
      this.cdr.detectChanges();
    };
    window.addEventListener("membership-updated", this.membershipUpdateHandler);
  }
  ngOnDestroy() {
    if (this.membershipUpdateHandler) {
      window.removeEventListener("membership-updated", this.membershipUpdateHandler);
    }
  }
  async loadSubscriptionHistory() {
    this.isLoadingHistory.set(true);
    try {
      const result = await this.licenseClient.getActivationHistory(50, 0);
      if (result.success && result.data) {
        this.subscriptionHistory.set(result.data);
      }
    } catch (error) {
      console.error("\u8F09\u5165\u8A02\u95B1\u8A18\u9304\u5931\u6557:", error);
    } finally {
      this.isLoadingHistory.set(false);
    }
  }
  async loadWallet() {
    try {
      const wallet = await this.walletService.loadWallet();
      if (wallet) {
        this.wallet.set(wallet);
      }
    } catch (error) {
      console.error("\u8F09\u5165\u9322\u5305\u5931\u6557:", error);
    }
  }
  goToWallet() {
    window.dispatchEvent(new CustomEvent("changeView", { detail: "wallet" }));
  }
  goToRecharge() {
    window.dispatchEvent(new CustomEvent("changeView", { detail: "wallet" }));
  }
  getMembershipIcon() {
    const icons = {
      bronze: "\u2694\uFE0F",
      silver: "\u{1F948}",
      gold: "\u{1F947}",
      diamond: "\u{1F48E}",
      star: "\u{1F31F}",
      king: "\u{1F451}"
    };
    return icons[this.membershipLevel()] || "\u2694\uFE0F";
  }
  getMembershipName() {
    const names = {
      bronze: "\u9752\u9285\u6230\u58EB",
      silver: "\u767D\u9280\u7CBE\u82F1",
      gold: "\u9EC3\u91D1\u5927\u5E2B",
      diamond: "\u947D\u77F3\u738B\u724C",
      star: "\u661F\u8000\u50B3\u8AAA",
      king: "\u69AE\u8000\u738B\u8005"
    };
    return names[this.membershipLevel()] || "\u9752\u9285\u6230\u58EB";
  }
  formatDate(dateString) {
    if (!dateString)
      return "-";
    return new Date(dateString).toLocaleDateString("zh-TW");
  }
  getAiUsagePercent() {
    const stats = this.usageStats();
    if (!stats?.aiCalls)
      return 0;
    return Math.min(100, stats.aiCalls.used / stats.aiCalls.limit * 100);
  }
  getMessageUsagePercent() {
    const stats = this.usageStats();
    if (!stats?.messagesSent)
      return 0;
    return Math.min(100, stats.messagesSent.used / stats.messagesSent.limit * 100);
  }
  getAccountUsagePercent() {
    const stats = this.usageStats();
    if (!stats?.accounts)
      return 0;
    return Math.min(100, stats.accounts.used / stats.accounts.limit * 100);
  }
  getStorageUsagePercent() {
    const stats = this.usageStats();
    if (!stats?.storage)
      return 0;
    return Math.min(100, stats.storage.used / stats.storage.limit * 100);
  }
  copyInviteCode() {
    navigator.clipboard.writeText(this.inviteCode());
    this.toast.success("\u9080\u8ACB\u78BC\u5DF2\u8907\u88FD");
  }
  onPurchase(level, period) {
    this.toast.info(`\u6B63\u5728\u8DF3\u8F49\u5230\u652F\u4ED8\u9801\u9762... (${level} ${period})`);
  }
  async onActivateLicense() {
    const result = await this.authService.renewMembership(this.licenseKey);
    if (result.success) {
      this.toast.success(result.message || "\u5361\u5BC6\u6FC0\u6D3B\u6210\u529F\uFF01");
      this.licenseKey = "";
      await this.loadSubscriptionHistory();
      this.cdr.detectChanges();
    } else {
      this.toast.error(result.message);
    }
  }
  formatActivationDate(dateString) {
    if (!dateString)
      return "-";
    const date = new Date(dateString);
    return date.toLocaleDateString("zh-TW");
  }
  static {
    this.\u0275fac = function MembershipCenterComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _MembershipCenterComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _MembershipCenterComponent, selectors: [["app-membership-center"]], decls: 86, vars: 34, consts: [[1, "membership-container"], [1, "page-header"], [1, "page-title"], [1, "title-icon"], [1, "page-desc"], [1, "membership-status-card"], [1, "status-left"], [1, "level-badge"], [1, "level-info"], [1, "level-name"], [1, "expires-info"], [1, "status-right"], [1, "upgrade-btn"], [1, "wallet-card", 3, "click"], [1, "wallet-left"], [1, "wallet-icon"], [1, "wallet-info"], [1, "wallet-label"], [1, "wallet-amount"], [1, "wallet-right"], ["class", "wallet-bonus", 4, "ngIf"], [1, "wallet-recharge-btn", 3, "click"], [1, "quick-stats"], [1, "stat-card"], [1, "stat-icon"], [1, "stat-content"], [1, "stat-label"], [1, "stat-value"], [1, "stat-bar"], [1, "stat-fill"], [1, "stat-hint"], [1, "tabs"], [1, "tab-btn", 3, "click"], [1, "tab-content"], [1, "days-left"], [1, "upgrade-btn", 3, "click"], [1, "wallet-bonus"], [1, "section-card"], [1, "section-title"], [1, "usage-details"], [1, "usage-row"], [1, "usage-name"], [1, "usage-bar-container"], [1, "usage-bar"], [1, "usage-fill"], [1, "usage-count"], [1, "section-card", "invite-card"], [1, "invite-desc"], [1, "invite-code-display"], [1, "label"], [1, "code"], [1, "copy-btn", 3, "click"], [1, "invite-stats-row"], [1, "invite-stat"], [1, "value"], [1, "benefits-table-container"], [1, "benefits-table"], [1, "feature-col"], [1, "level-col", "bronze"], [1, "level-col", "silver"], [1, "level-col", "gold"], [1, "level-col", "diamond"], [1, "level-col", "star"], [1, "level-col", "king"], [1, "feature-name"], [1, "price-row"], [1, "price"], [1, "pricing-cards"], [1, "pricing-card", "silver"], [1, "current-badge"], [1, "plan-icon"], [1, "plan-name"], [1, "plan-price"], [1, "amount"], [1, "period"], [1, "plan-features"], [1, "buy-btn"], [1, "buy-btn", "renew"], [1, "pricing-card", "gold"], [1, "pricing-card", "diamond", "popular"], [1, "popular-badge"], [1, "pricing-card", "star"], [1, "pricing-card", "king"], [1, "savings"], [1, "license-input-row"], ["type", "text", "placeholder", "\u8F38\u5165\u5361\u5BC6\uFF1AXXXX-XXXX-XXXX-XXXX", 1, "license-input", 3, "ngModelChange", "ngModel"], [1, "activate-btn", 3, "click", "disabled"], [1, "payment-methods"], [1, "payment-btn", 3, "click"], [1, "payment-icon"], [1, "buy-btn", 3, "click"], [1, "buy-btn", "renew", 3, "click"], [1, "history-list"], [1, "loading-state"], [1, "empty-state"], [1, "history-item"], [1, "history-icon"], [1, "history-info"], [1, "history-title"], [1, "history-meta"], [1, "history-status"]], template: function MembershipCenterComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0)(1, "div", 1)(2, "h1", 2)(3, "span", 3);
        \u0275\u0275text(4, "\u2B50");
        \u0275\u0275elementEnd();
        \u0275\u0275text(5, " \u6703\u54E1\u4E2D\u5FC3 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(6, "p", 4);
        \u0275\u0275text(7, "\u7BA1\u7406\u60A8\u7684\u6703\u54E1\u6B0A\u76CA\u548C\u8A02\u95B1");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(8, "div", 5)(9, "div", 6)(10, "div", 7);
        \u0275\u0275text(11);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(12, "div", 8)(13, "h2", 9);
        \u0275\u0275text(14);
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(15, MembershipCenterComponent_Conditional_15_Template, 4, 2, "p", 10)(16, MembershipCenterComponent_Conditional_16_Template, 2, 0, "p", 10);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(17, "div", 11);
        \u0275\u0275conditionalCreate(18, MembershipCenterComponent_Conditional_18_Template, 2, 0, "button", 12);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(19, "div", 13);
        \u0275\u0275listener("click", function MembershipCenterComponent_Template_div_click_19_listener() {
          return ctx.goToWallet();
        });
        \u0275\u0275elementStart(20, "div", 14)(21, "div", 15);
        \u0275\u0275text(22, "\u{1F4B0}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(23, "div", 16)(24, "div", 17);
        \u0275\u0275text(25, "\u8CEC\u6236\u9918\u984D");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(26, "div", 18);
        \u0275\u0275text(27);
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(28, "div", 19);
        \u0275\u0275template(29, MembershipCenterComponent_div_29_Template, 2, 1, "div", 20);
        \u0275\u0275elementStart(30, "button", 21);
        \u0275\u0275listener("click", function MembershipCenterComponent_Template_button_click_30_listener($event) {
          ctx.goToRecharge();
          return $event.stopPropagation();
        });
        \u0275\u0275text(31, " \u{1F4B3} \u5145\u503C ");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(32, "div", 22)(33, "div", 23)(34, "div", 24);
        \u0275\u0275text(35, "\u{1F916}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(36, "div", 25)(37, "div", 26);
        \u0275\u0275text(38, "AI \u8ABF\u7528");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(39, "div", 27);
        \u0275\u0275text(40);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(41, "div", 28);
        \u0275\u0275element(42, "div", 29);
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(43, "div", 23)(44, "div", 24);
        \u0275\u0275text(45, "\u{1F4E8}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(46, "div", 25)(47, "div", 26);
        \u0275\u0275text(48, "\u6D88\u606F\u767C\u9001");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(49, "div", 27);
        \u0275\u0275text(50);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(51, "div", 28);
        \u0275\u0275element(52, "div", 29);
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(53, "div", 23)(54, "div", 24);
        \u0275\u0275text(55, "\u{1F465}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(56, "div", 25)(57, "div", 26);
        \u0275\u0275text(58, "\u5E33\u865F\u6578\u91CF");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(59, "div", 27);
        \u0275\u0275text(60);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(61, "div", 28);
        \u0275\u0275element(62, "div", 29);
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(63, "div", 23)(64, "div", 24);
        \u0275\u0275text(65, "\u{1F381}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(66, "div", 25)(67, "div", 26);
        \u0275\u0275text(68, "\u9080\u8ACB\u734E\u52F5");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(69, "div", 27);
        \u0275\u0275text(70);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(71, "div", 30);
        \u0275\u0275text(72);
        \u0275\u0275elementEnd()()()();
        \u0275\u0275elementStart(73, "div", 31)(74, "button", 32);
        \u0275\u0275listener("click", function MembershipCenterComponent_Template_button_click_74_listener() {
          return ctx.activeTab.set("overview");
        });
        \u0275\u0275text(75, " \u{1F4CA} \u7E3D\u89BD ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(76, "button", 32);
        \u0275\u0275listener("click", function MembershipCenterComponent_Template_button_click_76_listener() {
          return ctx.activeTab.set("benefits");
        });
        \u0275\u0275text(77, " \u{1F3AF} \u6B0A\u76CA\u5C0D\u6BD4 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(78, "button", 32);
        \u0275\u0275listener("click", function MembershipCenterComponent_Template_button_click_78_listener() {
          return ctx.activeTab.set("upgrade");
        });
        \u0275\u0275text(79, " \u{1F680} \u5347\u7D1A\u8CFC\u8CB7 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(80, "button", 32);
        \u0275\u0275listener("click", function MembershipCenterComponent_Template_button_click_80_listener() {
          return ctx.activeTab.set("history");
        });
        \u0275\u0275text(81, " \u{1F4DC} \u8A02\u95B1\u8A18\u9304 ");
        \u0275\u0275elementEnd()();
        \u0275\u0275conditionalCreate(82, MembershipCenterComponent_Conditional_82_Template, 63, 19, "div", 33);
        \u0275\u0275conditionalCreate(83, MembershipCenterComponent_Conditional_83_Template, 185, 0, "div", 33);
        \u0275\u0275conditionalCreate(84, MembershipCenterComponent_Conditional_84_Template, 157, 28, "div", 33);
        \u0275\u0275conditionalCreate(85, MembershipCenterComponent_Conditional_85_Template, 8, 1, "div", 33);
        \u0275\u0275elementEnd();
      }
      if (rf & 2) {
        let tmp_7_0;
        let tmp_9_0;
        let tmp_11_0;
        \u0275\u0275advance(8);
        \u0275\u0275classMap("level-" + ctx.membershipLevel());
        \u0275\u0275advance(3);
        \u0275\u0275textInterpolate1(" ", ctx.getMembershipIcon(), " ");
        \u0275\u0275advance(3);
        \u0275\u0275textInterpolate(ctx.getMembershipName());
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.membershipExpires() ? 15 : 16);
        \u0275\u0275advance(3);
        \u0275\u0275conditional(ctx.membershipLevel() !== "king" ? 18 : -1);
        \u0275\u0275advance(9);
        \u0275\u0275textInterpolate(ctx.walletBalanceDisplay());
        \u0275\u0275advance(2);
        \u0275\u0275property("ngIf", ctx.walletBonusDisplay() !== "$0.00");
        \u0275\u0275advance(11);
        \u0275\u0275textInterpolate2(" ", ((tmp_7_0 = ctx.usageStats()) == null ? null : tmp_7_0.aiCalls == null ? null : tmp_7_0.aiCalls.used) || 0, " / ", ((tmp_7_0 = ctx.usageStats()) == null ? null : tmp_7_0.aiCalls == null ? null : tmp_7_0.aiCalls.limit) || 50, " ");
        \u0275\u0275advance(2);
        \u0275\u0275styleProp("width", ctx.getAiUsagePercent(), "%");
        \u0275\u0275advance(8);
        \u0275\u0275textInterpolate2(" ", ((tmp_9_0 = ctx.usageStats()) == null ? null : tmp_9_0.messagesSent == null ? null : tmp_9_0.messagesSent.used) || 0, " / ", ((tmp_9_0 = ctx.usageStats()) == null ? null : tmp_9_0.messagesSent == null ? null : tmp_9_0.messagesSent.limit) || 100, " ");
        \u0275\u0275advance(2);
        \u0275\u0275styleProp("width", ctx.getMessageUsagePercent(), "%");
        \u0275\u0275advance(8);
        \u0275\u0275textInterpolate2(" ", ((tmp_11_0 = ctx.usageStats()) == null ? null : tmp_11_0.accounts == null ? null : tmp_11_0.accounts.used) || 0, " / ", ((tmp_11_0 = ctx.usageStats()) == null ? null : tmp_11_0.accounts == null ? null : tmp_11_0.accounts.limit) || 2, " ");
        \u0275\u0275advance(2);
        \u0275\u0275styleProp("width", ctx.getAccountUsagePercent(), "%");
        \u0275\u0275advance(8);
        \u0275\u0275textInterpolate1("", ctx.invitedCount(), " \u4EBA");
        \u0275\u0275advance(2);
        \u0275\u0275textInterpolate1("\u5DF2\u7372 ", ctx.rewardDays(), " \u5929\u734E\u52F5");
        \u0275\u0275advance(2);
        \u0275\u0275classProp("active", ctx.activeTab() === "overview");
        \u0275\u0275advance(2);
        \u0275\u0275classProp("active", ctx.activeTab() === "benefits");
        \u0275\u0275advance(2);
        \u0275\u0275classProp("active", ctx.activeTab() === "upgrade");
        \u0275\u0275advance(2);
        \u0275\u0275classProp("active", ctx.activeTab() === "history");
        \u0275\u0275advance(2);
        \u0275\u0275conditional(ctx.activeTab() === "overview" ? 82 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.activeTab() === "benefits" ? 83 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.activeTab() === "upgrade" ? 84 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.activeTab() === "history" ? 85 : -1);
      }
    }, dependencies: [CommonModule, NgIf, FormsModule, DefaultValueAccessor, NgControlStatus, NgModel], styles: ["\n\n.membership-container[_ngcontent-%COMP%] {\n  padding: 1.5rem;\n  max-width: 1200px;\n  margin: 0 auto;\n}\n.page-header[_ngcontent-%COMP%] {\n  margin-bottom: 1.5rem;\n}\n.page-title[_ngcontent-%COMP%] {\n  font-size: 1.5rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin: 0;\n}\n.title-icon[_ngcontent-%COMP%] {\n  font-size: 1.75rem;\n}\n.page-desc[_ngcontent-%COMP%] {\n  color: var(--text-muted, #94a3b8);\n  margin: 0.5rem 0 0 0;\n}\n.membership-status-card[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem;\n  border-radius: 1rem;\n  margin-bottom: 1.5rem;\n  border: 1px solid;\n}\n.membership-status-card.level-free[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(71, 85, 105, 0.3),\n      rgba(51, 65, 85, 0.3));\n  border-color: rgba(71, 85, 105, 0.5);\n}\n.membership-status-card.level-vip[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(245, 158, 11, 0.2),\n      rgba(217, 119, 6, 0.2));\n  border-color: rgba(245, 158, 11, 0.5);\n}\n.membership-status-card.level-svip[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(139, 92, 246, 0.2),\n      rgba(124, 58, 237, 0.2));\n  border-color: rgba(139, 92, 246, 0.5);\n}\n.membership-status-card.level-mvp[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(236, 72, 153, 0.2),\n      rgba(219, 39, 119, 0.2));\n  border-color: rgba(236, 72, 153, 0.5);\n}\n.wallet-card[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.5rem;\n  border-radius: 1rem;\n  margin-bottom: 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      rgba(102, 126, 234, 0.2),\n      rgba(118, 75, 162, 0.2));\n  border: 1px solid rgba(102, 126, 234, 0.5);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.wallet-card[_ngcontent-%COMP%]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\n}\n.wallet-left[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.wallet-icon[_ngcontent-%COMP%] {\n  font-size: 2rem;\n}\n.wallet-label[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n  color: var(--text-muted, #94a3b8);\n}\n.wallet-amount[_ngcontent-%COMP%] {\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: #22c55e;\n}\n.wallet-right[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.wallet-bonus[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n  color: #f59e0b;\n  background: rgba(245, 158, 11, 0.1);\n  padding: 0.25rem 0.75rem;\n  border-radius: 1rem;\n}\n.wallet-recharge-btn[_ngcontent-%COMP%] {\n  padding: 0.5rem 1rem;\n  border-radius: 0.5rem;\n  border: none;\n  background:\n    linear-gradient(\n      135deg,\n      #667eea,\n      #764ba2);\n  color: white;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.wallet-recharge-btn[_ngcontent-%COMP%]:hover {\n  transform: scale(1.05);\n}\n.status-left[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.level-badge[_ngcontent-%COMP%] {\n  width: 64px;\n  height: 64px;\n  border-radius: 50%;\n  background: rgba(255, 255, 255, 0.1);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 2rem;\n}\n.level-name[_ngcontent-%COMP%] {\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n  margin: 0;\n}\n.expires-info[_ngcontent-%COMP%] {\n  color: var(--text-secondary, #cbd5e1);\n  margin: 0.25rem 0 0 0;\n}\n.days-left[_ngcontent-%COMP%] {\n  color: var(--text-muted, #94a3b8);\n}\n.upgrade-btn[_ngcontent-%COMP%] {\n  padding: 0.75rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.75rem;\n  color: white;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.upgrade-btn[_ngcontent-%COMP%]:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 10px 20px -10px rgba(6, 182, 212, 0.5);\n}\n.quick-stats[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n}\n.stat-card[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 0.75rem;\n}\n.stat-icon[_ngcontent-%COMP%] {\n  font-size: 1.5rem;\n}\n.stat-content[_ngcontent-%COMP%] {\n  flex: 1;\n}\n.stat-label[_ngcontent-%COMP%] {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.75rem;\n}\n.stat-value[_ngcontent-%COMP%] {\n  font-weight: 600;\n  color: var(--text-primary, white);\n}\n.stat-bar[_ngcontent-%COMP%] {\n  height: 4px;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 2px;\n  margin-top: 0.5rem;\n  overflow: hidden;\n}\n.stat-fill[_ngcontent-%COMP%] {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #06b6d4,\n      #3b82f6);\n  border-radius: 2px;\n}\n.stat-hint[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-muted, #64748b);\n}\n.tabs[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 1.5rem;\n  flex-wrap: wrap;\n}\n.tab-btn[_ngcontent-%COMP%] {\n  padding: 0.5rem 1rem;\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 0.5rem;\n  color: var(--text-secondary, #94a3b8);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.tab-btn[_ngcontent-%COMP%]:hover {\n  border-color: var(--primary, #06b6d4);\n}\n.tab-btn.active[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border-color: transparent;\n  color: white;\n}\n.section-card[_ngcontent-%COMP%] {\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 1rem;\n  padding: 1.5rem;\n  margin-bottom: 1rem;\n}\n.section-title[_ngcontent-%COMP%] {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n  margin: 0 0 1rem 0;\n}\n.usage-details[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.usage-row[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.usage-name[_ngcontent-%COMP%] {\n  width: 150px;\n  color: var(--text-secondary, #cbd5e1);\n}\n.usage-bar-container[_ngcontent-%COMP%] {\n  flex: 1;\n}\n.usage-bar[_ngcontent-%COMP%] {\n  height: 8px;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 4px;\n  overflow: hidden;\n}\n.usage-fill[_ngcontent-%COMP%] {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #06b6d4,\n      #3b82f6);\n  border-radius: 4px;\n}\n.usage-count[_ngcontent-%COMP%] {\n  width: 100px;\n  text-align: right;\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n}\n.invite-card[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(6, 182, 212, 0.1),\n      rgba(59, 130, 246, 0.1));\n  border-color: rgba(6, 182, 212, 0.3);\n}\n.invite-desc[_ngcontent-%COMP%] {\n  color: var(--text-secondary, #cbd5e1);\n  margin-bottom: 1rem;\n}\n.invite-code-display[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.75rem;\n  margin-bottom: 1rem;\n}\n.invite-code-display[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%] {\n  color: var(--text-muted, #94a3b8);\n}\n.invite-code-display[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%] {\n  flex: 1;\n  font-family: monospace;\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--primary, #06b6d4);\n}\n.copy-btn[_ngcontent-%COMP%] {\n  padding: 0.5rem 1rem;\n  background: var(--primary-bg, rgba(6, 182, 212, 0.1));\n  border: 1px solid var(--primary, #06b6d4);\n  border-radius: 0.5rem;\n  color: var(--primary, #06b6d4);\n  cursor: pointer;\n}\n.invite-stats-row[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 2rem;\n}\n.invite-stat[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n.invite-stat[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%] {\n  font-size: 1.5rem;\n  font-weight: bold;\n  color: var(--primary, #06b6d4);\n}\n.invite-stat[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%] {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n}\n.benefits-table-container[_ngcontent-%COMP%] {\n  overflow-x: auto;\n}\n.benefits-table[_ngcontent-%COMP%] {\n  width: 100%;\n  border-collapse: collapse;\n  font-size: 0.875rem;\n}\n.benefits-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], \n.benefits-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] {\n  padding: 0.75rem 1rem;\n  text-align: center;\n  border-bottom: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n}\n.benefits-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  color: var(--text-primary, white);\n  font-weight: 600;\n}\n.benefits-table[_ngcontent-%COMP%]   .feature-col[_ngcontent-%COMP%] {\n  text-align: left;\n  min-width: 150px;\n}\n.benefits-table[_ngcontent-%COMP%]   .feature-name[_ngcontent-%COMP%] {\n  text-align: left;\n  color: var(--text-secondary, #cbd5e1);\n}\n.benefits-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] {\n  color: var(--text-primary, white);\n}\n.benefits-table[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%] {\n  font-weight: 600;\n  color: var(--primary, #06b6d4);\n}\n.pricing-cards[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n  gap: 1.5rem;\n  margin-bottom: 1.5rem;\n}\n.pricing-card[_ngcontent-%COMP%] {\n  position: relative;\n  padding: 2rem;\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 2px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 1rem;\n  text-align: center;\n}\n.pricing-card.vip[_ngcontent-%COMP%] {\n  border-color: rgba(245, 158, 11, 0.3);\n}\n.pricing-card.svip[_ngcontent-%COMP%] {\n  border-color: rgba(139, 92, 246, 0.3);\n}\n.pricing-card.mvp[_ngcontent-%COMP%] {\n  border-color: rgba(236, 72, 153, 0.3);\n}\n.pricing-card.popular[_ngcontent-%COMP%] {\n  transform: scale(1.02);\n  box-shadow: 0 20px 40px -20px rgba(139, 92, 246, 0.3);\n}\n.pricing-card.current[_ngcontent-%COMP%] {\n  border-width: 3px;\n}\n.popular-badge[_ngcontent-%COMP%] {\n  position: absolute;\n  top: -12px;\n  left: 50%;\n  transform: translateX(-50%);\n  padding: 0.25rem 1rem;\n  background:\n    linear-gradient(\n      135deg,\n      #8b5cf6,\n      #7c3aed);\n  border-radius: 1rem;\n  color: white;\n  font-size: 0.75rem;\n  font-weight: 600;\n}\n.current-badge[_ngcontent-%COMP%] {\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  padding: 0.25rem 0.5rem;\n  background: var(--success, #22c55e);\n  border-radius: 0.25rem;\n  color: white;\n  font-size: 0.625rem;\n  font-weight: 600;\n}\n.plan-icon[_ngcontent-%COMP%] {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n}\n.plan-name[_ngcontent-%COMP%] {\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n  margin: 0 0 0.5rem 0;\n}\n.plan-price[_ngcontent-%COMP%] {\n  margin-bottom: 0.5rem;\n}\n.plan-price[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%] {\n  font-size: 2rem;\n  font-weight: bold;\n  color: var(--primary, #06b6d4);\n}\n.plan-price[_ngcontent-%COMP%]   .period[_ngcontent-%COMP%] {\n  color: var(--text-muted, #94a3b8);\n}\n.savings[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--success, #22c55e);\n  margin-bottom: 1rem;\n}\n.plan-features[_ngcontent-%COMP%] {\n  list-style: none;\n  padding: 0;\n  margin: 1rem 0;\n  text-align: left;\n}\n.plan-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] {\n  padding: 0.5rem 0;\n  color: var(--text-secondary, #cbd5e1);\n}\n.buy-btn[_ngcontent-%COMP%] {\n  width: 100%;\n  padding: 0.75rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 600;\n  cursor: pointer;\n}\n.buy-btn.renew[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e,\n      #16a34a);\n}\n.license-input-row[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.5rem;\n}\n.license-input[_ngcontent-%COMP%] {\n  flex: 1;\n  padding: 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-primary, white);\n  font-family: monospace;\n}\n.activate-btn[_ngcontent-%COMP%] {\n  padding: 0.75rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e,\n      #16a34a);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 600;\n  cursor: pointer;\n}\n.activate-btn[_ngcontent-%COMP%]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.payment-methods[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 1rem;\n  flex-wrap: wrap;\n}\n.payment-btn[_ngcontent-%COMP%] {\n  padding: 0.75rem 1.5rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-secondary, #cbd5e1);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.payment-btn.active[_ngcontent-%COMP%] {\n  border-color: var(--primary, #06b6d4);\n  color: var(--primary, #06b6d4);\n  background: rgba(6, 182, 212, 0.1);\n}\n.history-list[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.history-item[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.75rem;\n}\n.history-icon[_ngcontent-%COMP%] {\n  font-size: 1.5rem;\n}\n.history-info[_ngcontent-%COMP%] {\n  flex: 1;\n}\n.history-title[_ngcontent-%COMP%] {\n  font-weight: 500;\n  color: var(--text-primary, white);\n}\n.history-meta[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.history-status[_ngcontent-%COMP%] {\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n}\n.history-status.active[_ngcontent-%COMP%] {\n  background: rgba(34, 197, 94, 0.2);\n  color: #86efac;\n}\n.history-status.used[_ngcontent-%COMP%] {\n  background: rgba(148, 163, 184, 0.2);\n  color: #94a3b8;\n}\n/*# sourceMappingURL=membership-center.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(MembershipCenterComponent, [{
    type: Component,
    args: [{ selector: "app-membership-center", standalone: true, imports: [CommonModule, FormsModule], template: `
    <div class="membership-container">
      <!-- \u9801\u9762\u6A19\u984C -->
      <div class="page-header">
        <h1 class="page-title">
          <span class="title-icon">\u2B50</span>
          \u6703\u54E1\u4E2D\u5FC3
        </h1>
        <p class="page-desc">\u7BA1\u7406\u60A8\u7684\u6703\u54E1\u6B0A\u76CA\u548C\u8A02\u95B1</p>
      </div>
      
      <!-- \u7576\u524D\u6703\u54E1\u72C0\u614B\u5361\u7247 -->
      <div class="membership-status-card" [class]="'level-' + membershipLevel()">
        <div class="status-left">
          <div class="level-badge">
            {{ getMembershipIcon() }}
          </div>
          <div class="level-info">
            <h2 class="level-name">{{ getMembershipName() }}</h2>
            @if (membershipExpires()) {
              <p class="expires-info">
                \u6709\u6548\u671F\u81F3 {{ formatDate(membershipExpires()) }}
                <span class="days-left">(\u5269\u9918 {{ membershipDaysLeft() }} \u5929)</span>
              </p>
            } @else {
              <p class="expires-info">\u6C38\u4E45\u514D\u8CBB\u7248</p>
            }
          </div>
        </div>
        <div class="status-right">
          @if (membershipLevel() !== 'king') {
            <button (click)="activeTab.set('upgrade')" class="upgrade-btn">
              \u{1F680} \u7ACB\u5373\u5347\u7D1A
            </button>
          }
        </div>
      </div>
      
      <!-- \u9322\u5305\u9918\u984D\u5361\u7247 -->
      <div class="wallet-card" (click)="goToWallet()">
        <div class="wallet-left">
          <div class="wallet-icon">\u{1F4B0}</div>
          <div class="wallet-info">
            <div class="wallet-label">\u8CEC\u6236\u9918\u984D</div>
            <div class="wallet-amount">{{ walletBalanceDisplay() }}</div>
          </div>
        </div>
        <div class="wallet-right">
          <div class="wallet-bonus" *ngIf="walletBonusDisplay() !== '$0.00'">
            \u8D08\u9001: {{ walletBonusDisplay() }}
          </div>
          <button class="wallet-recharge-btn" (click)="goToRecharge(); $event.stopPropagation()">
            \u{1F4B3} \u5145\u503C
          </button>
        </div>
      </div>
      
      <!-- \u5FEB\u901F\u7D71\u8A08 -->
      <div class="quick-stats">
        <div class="stat-card">
          <div class="stat-icon">\u{1F916}</div>
          <div class="stat-content">
            <div class="stat-label">AI \u8ABF\u7528</div>
            <div class="stat-value">
              {{ usageStats()?.aiCalls?.used || 0 }} / {{ usageStats()?.aiCalls?.limit || 50 }}
            </div>
            <div class="stat-bar">
              <div class="stat-fill" [style.width.%]="getAiUsagePercent()"></div>
            </div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">\u{1F4E8}</div>
          <div class="stat-content">
            <div class="stat-label">\u6D88\u606F\u767C\u9001</div>
            <div class="stat-value">
              {{ usageStats()?.messagesSent?.used || 0 }} / {{ usageStats()?.messagesSent?.limit || 100 }}
            </div>
            <div class="stat-bar">
              <div class="stat-fill" [style.width.%]="getMessageUsagePercent()"></div>
            </div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">\u{1F465}</div>
          <div class="stat-content">
            <div class="stat-label">\u5E33\u865F\u6578\u91CF</div>
            <div class="stat-value">
              {{ usageStats()?.accounts?.used || 0 }} / {{ usageStats()?.accounts?.limit || 2 }}
            </div>
            <div class="stat-bar">
              <div class="stat-fill" [style.width.%]="getAccountUsagePercent()"></div>
            </div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">\u{1F381}</div>
          <div class="stat-content">
            <div class="stat-label">\u9080\u8ACB\u734E\u52F5</div>
            <div class="stat-value">{{ invitedCount() }} \u4EBA</div>
            <div class="stat-hint">\u5DF2\u7372 {{ rewardDays() }} \u5929\u734E\u52F5</div>
          </div>
        </div>
      </div>
      
      <!-- \u6A19\u7C64\u5C0E\u822A -->
      <div class="tabs">
        <button 
          (click)="activeTab.set('overview')"
          [class.active]="activeTab() === 'overview'"
          class="tab-btn">
          \u{1F4CA} \u7E3D\u89BD
        </button>
        <button 
          (click)="activeTab.set('benefits')"
          [class.active]="activeTab() === 'benefits'"
          class="tab-btn">
          \u{1F3AF} \u6B0A\u76CA\u5C0D\u6BD4
        </button>
        <button 
          (click)="activeTab.set('upgrade')"
          [class.active]="activeTab() === 'upgrade'"
          class="tab-btn">
          \u{1F680} \u5347\u7D1A\u8CFC\u8CB7
        </button>
        <button 
          (click)="activeTab.set('history')"
          [class.active]="activeTab() === 'history'"
          class="tab-btn">
          \u{1F4DC} \u8A02\u95B1\u8A18\u9304
        </button>
      </div>
      
      <!-- \u7E3D\u89BD -->
      @if (activeTab() === 'overview') {
        <div class="tab-content">
          <!-- \u529F\u80FD\u4F7F\u7528\u8A73\u60C5 -->
          <div class="section-card">
            <h3 class="section-title">\u{1F4CA} \u672C\u6708\u4F7F\u7528\u8A73\u60C5</h3>
            
            <div class="usage-details">
              <div class="usage-row">
                <span class="usage-name">\u{1F916} AI \u8ABF\u7528\u6B21\u6578</span>
                <div class="usage-bar-container">
                  <div class="usage-bar">
                    <div class="usage-fill" [style.width.%]="getAiUsagePercent()"></div>
                  </div>
                </div>
                <span class="usage-count">{{ usageStats()?.aiCalls?.used || 0 }} / {{ usageStats()?.aiCalls?.limit || 50 }}</span>
              </div>
              
              <div class="usage-row">
                <span class="usage-name">\u{1F4E8} \u6D88\u606F\u767C\u9001</span>
                <div class="usage-bar-container">
                  <div class="usage-bar">
                    <div class="usage-fill" [style.width.%]="getMessageUsagePercent()"></div>
                  </div>
                </div>
                <span class="usage-count">{{ usageStats()?.messagesSent?.used || 0 }} / {{ usageStats()?.messagesSent?.limit || 100 }}</span>
              </div>
              
              <div class="usage-row">
                <span class="usage-name">\u{1F465} \u5E33\u865F\u6578\u91CF</span>
                <div class="usage-bar-container">
                  <div class="usage-bar">
                    <div class="usage-fill" [style.width.%]="getAccountUsagePercent()"></div>
                  </div>
                </div>
                <span class="usage-count">{{ usageStats()?.accounts?.used || 0 }} / {{ usageStats()?.accounts?.limit || 2 }}</span>
              </div>
              
              <div class="usage-row">
                <span class="usage-name">\u{1F4BE} \u5B58\u5132\u7A7A\u9593</span>
                <div class="usage-bar-container">
                  <div class="usage-bar">
                    <div class="usage-fill" [style.width.%]="getStorageUsagePercent()"></div>
                  </div>
                </div>
                <span class="usage-count">{{ usageStats()?.storage?.used || 0 }} MB / {{ usageStats()?.storage?.limit || 10 }} MB</span>
              </div>
            </div>
          </div>
          
          <!-- \u9080\u8ACB\u734E\u52F5\u5361\u7247 -->
          <div class="section-card invite-card">
            <h3 class="section-title">\u{1F381} \u9080\u8ACB\u597D\u53CB\u5F97\u734E\u52F5</h3>
            <p class="invite-desc">\u6BCF\u9080\u8ACB 1 \u4F4D\u597D\u53CB\u8A3B\u518A\u4E26\u6FC0\u6D3B\uFF0C\u60A8\u5C07\u7372\u5F97 <strong>3 \u5929\u767D\u9280\u7CBE\u82F1</strong> \u734E\u52F5\uFF01</p>
            
            <div class="invite-code-display">
              <span class="label">\u6211\u7684\u9080\u8ACB\u78BC</span>
              <span class="code">{{ inviteCode() }}</span>
              <button (click)="copyInviteCode()" class="copy-btn">\u{1F4CB} \u8907\u88FD</button>
            </div>
            
            <div class="invite-stats-row">
              <div class="invite-stat">
                <span class="value">{{ invitedCount() }}</span>
                <span class="label">\u5DF2\u9080\u8ACB\u4EBA\u6578</span>
              </div>
              <div class="invite-stat">
                <span class="value">{{ rewardDays() }}</span>
                <span class="label">\u7372\u5F97\u734E\u52F5\u5929\u6578</span>
              </div>
            </div>
          </div>
        </div>
      }
      
      <!-- \u6B0A\u76CA\u5C0D\u6BD4 -->
      @if (activeTab() === 'benefits') {
        <div class="tab-content">
          <div class="benefits-table-container">
            <table class="benefits-table">
              <thead>
                <tr>
                  <th class="feature-col">\u529F\u80FD</th>
                  <th class="level-col bronze">\u2694\uFE0F \u9752\u9285</th>
                  <th class="level-col silver">\u{1F948} \u767D\u9280</th>
                  <th class="level-col gold">\u{1F947} \u9EC3\u91D1</th>
                  <th class="level-col diamond">\u{1F48E} \u947D\u77F3</th>
                  <th class="level-col star">\u{1F31F} \u661F\u8000</th>
                  <th class="level-col king">\u{1F451} \u738B\u8005</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="feature-name">\u5E33\u865F\u6578\u91CF</td>
                  <td>2 \u500B</td>
                  <td>5 \u500B</td>
                  <td>10 \u500B</td>
                  <td>20 \u500B</td>
                  <td>50 \u500B</td>
                  <td>\u7121\u9650</td>
                </tr>
                <tr>
                  <td class="feature-name">\u6BCF\u65E5\u6D88\u606F</td>
                  <td>20 \u689D</td>
                  <td>100 \u689D</td>
                  <td>300 \u689D</td>
                  <td>1,000 \u689D</td>
                  <td>\u7121\u9650</td>
                  <td>\u7121\u9650</td>
                </tr>
                <tr>
                  <td class="feature-name">\u6BCF\u65E5 AI \u8ABF\u7528</td>
                  <td>10 \u6B21</td>
                  <td>50 \u6B21</td>
                  <td>200 \u6B21</td>
                  <td>\u7121\u9650</td>
                  <td>\u7121\u9650</td>
                  <td>\u7121\u9650</td>
                </tr>
                <tr>
                  <td class="feature-name">\u7FA4\u7D44\u6578\u91CF</td>
                  <td>3 \u500B</td>
                  <td>10 \u500B</td>
                  <td>30 \u500B</td>
                  <td>100 \u500B</td>
                  <td>\u7121\u9650</td>
                  <td>\u7121\u9650</td>
                </tr>
                <tr>
                  <td class="feature-name">\u5EE3\u544A\u767C\u9001</td>
                  <td>\u274C</td>
                  <td>\u2705</td>
                  <td>\u2705</td>
                  <td>\u2705</td>
                  <td>\u2705</td>
                  <td>\u2705</td>
                </tr>
                <tr>
                  <td class="feature-name">\u6279\u91CF\u64CD\u4F5C</td>
                  <td>\u274C</td>
                  <td>\u274C</td>
                  <td>\u2705</td>
                  <td>\u2705</td>
                  <td>\u2705</td>
                  <td>\u2705</td>
                </tr>
                <tr>
                  <td class="feature-name">AI \u92B7\u552E\u6F0F\u6597</td>
                  <td>\u274C</td>
                  <td>\u274C</td>
                  <td>\u274C</td>
                  <td>\u2705</td>
                  <td>\u2705</td>
                  <td>\u2705</td>
                </tr>
                <tr>
                  <td class="feature-name">\u667A\u80FD\u9632\u5C01</td>
                  <td>\u274C</td>
                  <td>\u274C</td>
                  <td>\u274C</td>
                  <td>\u274C</td>
                  <td>\u2705</td>
                  <td>\u2705</td>
                </tr>
                <tr>
                  <td class="feature-name">API \u63A5\u53E3</td>
                  <td>\u274C</td>
                  <td>\u274C</td>
                  <td>\u274C</td>
                  <td>\u274C</td>
                  <td>\u274C</td>
                  <td>\u2705</td>
                </tr>
                <tr>
                  <td class="feature-name">\u512A\u5148\u652F\u6301</td>
                  <td>\u274C</td>
                  <td>\u274C</td>
                  <td>\u274C</td>
                  <td>\u274C</td>
                  <td>\u2705</td>
                  <td>\u2705 \u5C08\u5C6C</td>
                </tr>
                <tr class="price-row">
                  <td class="feature-name">\u50F9\u683C</td>
                  <td class="price">\u514D\u8CBB</td>
                  <td class="price">4.99 USDT/\u6708</td>
                  <td class="price">19.9 USDT/\u6708</td>
                  <td class="price">59.9 USDT/\u6708</td>
                  <td class="price">199 USDT/\u6708</td>
                  <td class="price">599 USDT/\u6708</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      }
      
      <!-- \u5347\u7D1A\u8CFC\u8CB7\uFF08\u738B\u8005\u69AE\u8000\u7B49\u7D1A\uFF09 -->
      @if (activeTab() === 'upgrade') {
        <div class="tab-content">
          <div class="pricing-cards">
            <!-- \u767D\u9280\u7CBE\u82F1 -->
            <div class="pricing-card silver" [class.current]="membershipLevel() === 'silver'">
              @if (membershipLevel() === 'silver') {
                <div class="current-badge">\u7576\u524D\u65B9\u6848</div>
              }
              <div class="plan-icon">\u{1F948}</div>
              <h3 class="plan-name">\u767D\u9280\u7CBE\u82F1</h3>
              <div class="plan-price">
                <span class="amount">4.99 USDT</span>
                <span class="period">/\u6708</span>
              </div>
              <ul class="plan-features">
                <li>\u2705 5 \u500B\u5E33\u865F</li>
                <li>\u2705 \u6BCF\u65E5 100 \u689D\u6D88\u606F</li>
                <li>\u2705 \u6BCF\u65E5 50 \u6B21 AI</li>
                <li>\u2705 10 \u500B\u7FA4\u7D44</li>
                <li>\u2705 \u5EE3\u544A\u767C\u9001</li>
              </ul>
              @if (membershipLevel() !== 'silver') {
                <button class="buy-btn" (click)="onPurchase('silver', 'month')">
                  {{ membershipLevel() === 'bronze' ? '\u7ACB\u5373\u958B\u901A' : '\u5207\u63DB\u65B9\u6848' }}
                </button>
              } @else {
                <button class="buy-btn renew" (click)="onPurchase('silver', 'month')">
                  \u7E8C\u8CBB
                </button>
              }
            </div>
            
            <!-- \u9EC3\u91D1\u5927\u5E2B -->
            <div class="pricing-card gold" [class.current]="membershipLevel() === 'gold'">
              @if (membershipLevel() === 'gold') {
                <div class="current-badge">\u7576\u524D\u65B9\u6848</div>
              }
              <div class="plan-icon">\u{1F947}</div>
              <h3 class="plan-name">\u9EC3\u91D1\u5927\u5E2B</h3>
              <div class="plan-price">
                <span class="amount">19.9 USDT</span>
                <span class="period">/\u6708</span>
              </div>
              <ul class="plan-features">
                <li>\u2705 15 \u500B\u5E33\u865F</li>
                <li>\u2705 \u6BCF\u65E5 500 \u689D\u6D88\u606F</li>
                <li>\u2705 \u6BCF\u65E5 300 \u6B21 AI</li>
                <li>\u2705 50 \u500B\u7FA4\u7D44</li>
                <li>\u2705 \u6279\u91CF\u64CD\u4F5C</li>
                <li>\u2705 \u6578\u64DA\u5C0E\u51FA</li>
              </ul>
              @if (membershipLevel() !== 'gold') {
                <button class="buy-btn" (click)="onPurchase('gold', 'month')">
                  {{ ['bronze', 'silver'].includes(membershipLevel()) ? '\u7ACB\u5373\u5347\u7D1A' : '\u5207\u63DB\u65B9\u6848' }}
                </button>
              } @else {
                <button class="buy-btn renew" (click)="onPurchase('gold', 'month')">
                  \u7E8C\u8CBB
                </button>
              }
            </div>
            
            <!-- \u947D\u77F3\u738B\u724C -->
            <div class="pricing-card diamond popular" [class.current]="membershipLevel() === 'diamond'">
              <div class="popular-badge">\u63A8\u85A6</div>
              @if (membershipLevel() === 'diamond') {
                <div class="current-badge">\u7576\u524D\u65B9\u6848</div>
              }
              <div class="plan-icon">\u{1F48E}</div>
              <h3 class="plan-name">\u947D\u77F3\u738B\u724C</h3>
              <div class="plan-price">
                <span class="amount">59.9 USDT</span>
                <span class="period">/\u6708</span>
              </div>
              <ul class="plan-features">
                <li>\u2705 50 \u500B\u5E33\u865F</li>
                <li>\u2705 \u6BCF\u65E5 2000 \u689D\u6D88\u606F</li>
                <li>\u2705 \u7121\u9650 AI \u8ABF\u7528</li>
                <li>\u2705 200 \u500B\u7FA4\u7D44</li>
                <li>\u2705 AI \u92B7\u552E\u6F0F\u6597</li>
                <li>\u2705 \u9AD8\u7D1A\u5206\u6790</li>
              </ul>
              @if (membershipLevel() !== 'diamond') {
                <button class="buy-btn" (click)="onPurchase('diamond', 'month')">
                  {{ ['bronze', 'silver', 'gold'].includes(membershipLevel()) ? '\u7ACB\u5373\u5347\u7D1A' : '\u5207\u63DB\u65B9\u6848' }}
                </button>
              } @else {
                <button class="buy-btn renew" (click)="onPurchase('diamond', 'month')">
                  \u7E8C\u8CBB
                </button>
              }
            </div>
            
            <!-- \u661F\u8000\u50B3\u8AAA -->
            <div class="pricing-card star" [class.current]="membershipLevel() === 'star'">
              @if (membershipLevel() === 'star') {
                <div class="current-badge">\u7576\u524D\u65B9\u6848</div>
              }
              <div class="plan-icon">\u{1F31F}</div>
              <h3 class="plan-name">\u661F\u8000\u50B3\u8AAA</h3>
              <div class="plan-price">
                <span class="amount">199 USDT</span>
                <span class="period">/\u6708</span>
              </div>
              <ul class="plan-features">
                <li>\u2705 100 \u500B\u5E33\u865F</li>
                <li>\u2705 \u7121\u9650\u6D88\u606F</li>
                <li>\u2705 \u7121\u9650 AI</li>
                <li>\u2705 \u7121\u9650\u7FA4\u7D44</li>
                <li>\u2705 \u667A\u80FD\u9632\u5C01</li>
                <li>\u2705 \u5718\u968A\u7BA1\u7406</li>
              </ul>
              @if (membershipLevel() !== 'star') {
                <button class="buy-btn" (click)="onPurchase('star', 'month')">
                  {{ membershipLevel() !== 'king' ? '\u7ACB\u5373\u5347\u7D1A' : '\u5207\u63DB\u65B9\u6848' }}
                </button>
              } @else {
                <button class="buy-btn renew" (click)="onPurchase('star', 'month')">
                  \u7E8C\u8CBB
                </button>
              }
            </div>
            
            <!-- \u69AE\u8000\u738B\u8005 -->
            <div class="pricing-card king" [class.current]="membershipLevel() === 'king'">
              @if (membershipLevel() === 'king') {
                <div class="current-badge">\u7576\u524D\u65B9\u6848</div>
              }
              <div class="plan-icon">\u{1F451}</div>
              <h3 class="plan-name">\u69AE\u8000\u738B\u8005</h3>
              <div class="plan-price">
                <span class="amount">599 USDT</span>
                <span class="period">/\u6708</span>
              </div>
              <div class="savings">\u5C0A\u4EAB\u7279\u6B0A</div>
              <ul class="plan-features">
                <li>\u2705 \u7121\u9650\u5E33\u865F</li>
                <li>\u2705 \u7121\u9650\u4E00\u5207</li>
                <li>\u2705 API \u63A5\u53E3</li>
                <li>\u2705 \u81EA\u5B9A\u7FA9\u54C1\u724C</li>
                <li>\u2705 \u5C08\u5C6C\u9867\u554F</li>
                <li>\u2705 \u65B0\u529F\u80FD\u5167\u6E2C</li>
              </ul>
              @if (membershipLevel() !== 'king') {
                <button class="buy-btn" (click)="onPurchase('king', 'month')">
                  \u7D42\u6975\u5347\u7D1A
                </button>
              } @else {
                <button class="buy-btn renew" (click)="onPurchase('king', 'month')">
                  \u7E8C\u8CBB
                </button>
              }
            </div>
          </div>
          
          <!-- \u5361\u5BC6\u6FC0\u6D3B -->
          <div class="section-card">
            <h3 class="section-title">\u{1F3AB} \u4F7F\u7528\u5361\u5BC6\u6FC0\u6D3B</h3>
            <div class="license-input-row">
              <input 
                type="text" 
                [(ngModel)]="licenseKey" 
                class="license-input"
                placeholder="\u8F38\u5165\u5361\u5BC6\uFF1AXXXX-XXXX-XXXX-XXXX">
              <button 
                (click)="onActivateLicense()" 
                [disabled]="!licenseKey"
                class="activate-btn">
                \u6FC0\u6D3B
              </button>
            </div>
          </div>
          
          <!-- \u652F\u4ED8\u65B9\u5F0F -->
          <div class="section-card">
            <h3 class="section-title">\u{1F4B3} \u652F\u4ED8\u65B9\u5F0F</h3>
            <div class="payment-methods">
              <button class="payment-btn" [class.active]="selectedPayment() === 'alipay'" (click)="selectedPayment.set('alipay')">
                <span class="payment-icon">\u{1F499}</span> \u652F\u4ED8\u5BF6
              </button>
              <button class="payment-btn" [class.active]="selectedPayment() === 'wechat'" (click)="selectedPayment.set('wechat')">
                <span class="payment-icon">\u{1F49A}</span> \u5FAE\u4FE1\u652F\u4ED8
              </button>
              <button class="payment-btn" [class.active]="selectedPayment() === 'usdt'" (click)="selectedPayment.set('usdt')">
                <span class="payment-icon">\u{1F48E}</span> USDT
              </button>
            </div>
          </div>
        </div>
      }
      
      <!-- \u8A02\u95B1\u8A18\u9304 -->
      @if (activeTab() === 'history') {
        <div class="tab-content">
          <div class="section-card">
            <h3 class="section-title">\u{1F4DC} \u8A02\u95B1\u6B77\u53F2</h3>
            
            <div class="history-list">
              @if (isLoadingHistory()) {
                <div class="loading-state">\u8F09\u5165\u4E2D...</div>
              } @else if (subscriptionHistory().length === 0) {
                <div class="empty-state">\u66AB\u7121\u8A02\u95B1\u8A18\u9304</div>
              } @else {
                @for (record of subscriptionHistory(); track record.id) {
                  <div class="history-item">
                    <div class="history-icon">{{ record.level_icon || '\u{1F3AB}' }}</div>
                    <div class="history-info">
                      <div class="history-title">{{ record.level_name }} {{ record.duration_name }}\u6FC0\u6D3B</div>
                      <div class="history-meta">{{ formatActivationDate(record.activated_at) }} \xB7 \u5361\u5BC6\u6FC0\u6D3B</div>
                    </div>
                    <div class="history-status" [class.active]="record.is_active" [class.used]="!record.is_active">
                      {{ record.is_active ? '\u751F\u6548\u4E2D' : '\u5DF2\u904E\u671F' }}
                    </div>
                  </div>
                }
              }
            </div>
          </div>
        </div>
      }
    </div>
  `, styles: ["/* angular:styles/component:css;4ef958dfba314b75bfa7c84b13dab07bddb20bddf009b45725f0a040cc9a4882;D:/tgkz2026/src/membership-center.component.ts */\n.membership-container {\n  padding: 1.5rem;\n  max-width: 1200px;\n  margin: 0 auto;\n}\n.page-header {\n  margin-bottom: 1.5rem;\n}\n.page-title {\n  font-size: 1.5rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin: 0;\n}\n.title-icon {\n  font-size: 1.75rem;\n}\n.page-desc {\n  color: var(--text-muted, #94a3b8);\n  margin: 0.5rem 0 0 0;\n}\n.membership-status-card {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem;\n  border-radius: 1rem;\n  margin-bottom: 1.5rem;\n  border: 1px solid;\n}\n.membership-status-card.level-free {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(71, 85, 105, 0.3),\n      rgba(51, 65, 85, 0.3));\n  border-color: rgba(71, 85, 105, 0.5);\n}\n.membership-status-card.level-vip {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(245, 158, 11, 0.2),\n      rgba(217, 119, 6, 0.2));\n  border-color: rgba(245, 158, 11, 0.5);\n}\n.membership-status-card.level-svip {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(139, 92, 246, 0.2),\n      rgba(124, 58, 237, 0.2));\n  border-color: rgba(139, 92, 246, 0.5);\n}\n.membership-status-card.level-mvp {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(236, 72, 153, 0.2),\n      rgba(219, 39, 119, 0.2));\n  border-color: rgba(236, 72, 153, 0.5);\n}\n.wallet-card {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.5rem;\n  border-radius: 1rem;\n  margin-bottom: 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      rgba(102, 126, 234, 0.2),\n      rgba(118, 75, 162, 0.2));\n  border: 1px solid rgba(102, 126, 234, 0.5);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.wallet-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\n}\n.wallet-left {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.wallet-icon {\n  font-size: 2rem;\n}\n.wallet-label {\n  font-size: 0.875rem;\n  color: var(--text-muted, #94a3b8);\n}\n.wallet-amount {\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: #22c55e;\n}\n.wallet-right {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.wallet-bonus {\n  font-size: 0.875rem;\n  color: #f59e0b;\n  background: rgba(245, 158, 11, 0.1);\n  padding: 0.25rem 0.75rem;\n  border-radius: 1rem;\n}\n.wallet-recharge-btn {\n  padding: 0.5rem 1rem;\n  border-radius: 0.5rem;\n  border: none;\n  background:\n    linear-gradient(\n      135deg,\n      #667eea,\n      #764ba2);\n  color: white;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.wallet-recharge-btn:hover {\n  transform: scale(1.05);\n}\n.status-left {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.level-badge {\n  width: 64px;\n  height: 64px;\n  border-radius: 50%;\n  background: rgba(255, 255, 255, 0.1);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 2rem;\n}\n.level-name {\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n  margin: 0;\n}\n.expires-info {\n  color: var(--text-secondary, #cbd5e1);\n  margin: 0.25rem 0 0 0;\n}\n.days-left {\n  color: var(--text-muted, #94a3b8);\n}\n.upgrade-btn {\n  padding: 0.75rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.75rem;\n  color: white;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.upgrade-btn:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 10px 20px -10px rgba(6, 182, 212, 0.5);\n}\n.quick-stats {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n}\n.stat-card {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 0.75rem;\n}\n.stat-icon {\n  font-size: 1.5rem;\n}\n.stat-content {\n  flex: 1;\n}\n.stat-label {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.75rem;\n}\n.stat-value {\n  font-weight: 600;\n  color: var(--text-primary, white);\n}\n.stat-bar {\n  height: 4px;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 2px;\n  margin-top: 0.5rem;\n  overflow: hidden;\n}\n.stat-fill {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #06b6d4,\n      #3b82f6);\n  border-radius: 2px;\n}\n.stat-hint {\n  font-size: 0.75rem;\n  color: var(--text-muted, #64748b);\n}\n.tabs {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 1.5rem;\n  flex-wrap: wrap;\n}\n.tab-btn {\n  padding: 0.5rem 1rem;\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 0.5rem;\n  color: var(--text-secondary, #94a3b8);\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.tab-btn:hover {\n  border-color: var(--primary, #06b6d4);\n}\n.tab-btn.active {\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border-color: transparent;\n  color: white;\n}\n.section-card {\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 1rem;\n  padding: 1.5rem;\n  margin-bottom: 1rem;\n}\n.section-title {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n  margin: 0 0 1rem 0;\n}\n.usage-details {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.usage-row {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.usage-name {\n  width: 150px;\n  color: var(--text-secondary, #cbd5e1);\n}\n.usage-bar-container {\n  flex: 1;\n}\n.usage-bar {\n  height: 8px;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 4px;\n  overflow: hidden;\n}\n.usage-fill {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #06b6d4,\n      #3b82f6);\n  border-radius: 4px;\n}\n.usage-count {\n  width: 100px;\n  text-align: right;\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n}\n.invite-card {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(6, 182, 212, 0.1),\n      rgba(59, 130, 246, 0.1));\n  border-color: rgba(6, 182, 212, 0.3);\n}\n.invite-desc {\n  color: var(--text-secondary, #cbd5e1);\n  margin-bottom: 1rem;\n}\n.invite-code-display {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.75rem;\n  margin-bottom: 1rem;\n}\n.invite-code-display .label {\n  color: var(--text-muted, #94a3b8);\n}\n.invite-code-display .code {\n  flex: 1;\n  font-family: monospace;\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--primary, #06b6d4);\n}\n.copy-btn {\n  padding: 0.5rem 1rem;\n  background: var(--primary-bg, rgba(6, 182, 212, 0.1));\n  border: 1px solid var(--primary, #06b6d4);\n  border-radius: 0.5rem;\n  color: var(--primary, #06b6d4);\n  cursor: pointer;\n}\n.invite-stats-row {\n  display: flex;\n  gap: 2rem;\n}\n.invite-stat {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n.invite-stat .value {\n  font-size: 1.5rem;\n  font-weight: bold;\n  color: var(--primary, #06b6d4);\n}\n.invite-stat .label {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n}\n.benefits-table-container {\n  overflow-x: auto;\n}\n.benefits-table {\n  width: 100%;\n  border-collapse: collapse;\n  font-size: 0.875rem;\n}\n.benefits-table th,\n.benefits-table td {\n  padding: 0.75rem 1rem;\n  text-align: center;\n  border-bottom: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n}\n.benefits-table th {\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  color: var(--text-primary, white);\n  font-weight: 600;\n}\n.benefits-table .feature-col {\n  text-align: left;\n  min-width: 150px;\n}\n.benefits-table .feature-name {\n  text-align: left;\n  color: var(--text-secondary, #cbd5e1);\n}\n.benefits-table td {\n  color: var(--text-primary, white);\n}\n.benefits-table .price {\n  font-weight: 600;\n  color: var(--primary, #06b6d4);\n}\n.pricing-cards {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n  gap: 1.5rem;\n  margin-bottom: 1.5rem;\n}\n.pricing-card {\n  position: relative;\n  padding: 2rem;\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 2px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 1rem;\n  text-align: center;\n}\n.pricing-card.vip {\n  border-color: rgba(245, 158, 11, 0.3);\n}\n.pricing-card.svip {\n  border-color: rgba(139, 92, 246, 0.3);\n}\n.pricing-card.mvp {\n  border-color: rgba(236, 72, 153, 0.3);\n}\n.pricing-card.popular {\n  transform: scale(1.02);\n  box-shadow: 0 20px 40px -20px rgba(139, 92, 246, 0.3);\n}\n.pricing-card.current {\n  border-width: 3px;\n}\n.popular-badge {\n  position: absolute;\n  top: -12px;\n  left: 50%;\n  transform: translateX(-50%);\n  padding: 0.25rem 1rem;\n  background:\n    linear-gradient(\n      135deg,\n      #8b5cf6,\n      #7c3aed);\n  border-radius: 1rem;\n  color: white;\n  font-size: 0.75rem;\n  font-weight: 600;\n}\n.current-badge {\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  padding: 0.25rem 0.5rem;\n  background: var(--success, #22c55e);\n  border-radius: 0.25rem;\n  color: white;\n  font-size: 0.625rem;\n  font-weight: 600;\n}\n.plan-icon {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n}\n.plan-name {\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n  margin: 0 0 0.5rem 0;\n}\n.plan-price {\n  margin-bottom: 0.5rem;\n}\n.plan-price .amount {\n  font-size: 2rem;\n  font-weight: bold;\n  color: var(--primary, #06b6d4);\n}\n.plan-price .period {\n  color: var(--text-muted, #94a3b8);\n}\n.savings {\n  font-size: 0.75rem;\n  color: var(--success, #22c55e);\n  margin-bottom: 1rem;\n}\n.plan-features {\n  list-style: none;\n  padding: 0;\n  margin: 1rem 0;\n  text-align: left;\n}\n.plan-features li {\n  padding: 0.5rem 0;\n  color: var(--text-secondary, #cbd5e1);\n}\n.buy-btn {\n  width: 100%;\n  padding: 0.75rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 600;\n  cursor: pointer;\n}\n.buy-btn.renew {\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e,\n      #16a34a);\n}\n.license-input-row {\n  display: flex;\n  gap: 0.5rem;\n}\n.license-input {\n  flex: 1;\n  padding: 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-primary, white);\n  font-family: monospace;\n}\n.activate-btn {\n  padding: 0.75rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e,\n      #16a34a);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 600;\n  cursor: pointer;\n}\n.activate-btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.payment-methods {\n  display: flex;\n  gap: 1rem;\n  flex-wrap: wrap;\n}\n.payment-btn {\n  padding: 0.75rem 1.5rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-secondary, #cbd5e1);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.payment-btn.active {\n  border-color: var(--primary, #06b6d4);\n  color: var(--primary, #06b6d4);\n  background: rgba(6, 182, 212, 0.1);\n}\n.history-list {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.history-item {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.75rem;\n}\n.history-icon {\n  font-size: 1.5rem;\n}\n.history-info {\n  flex: 1;\n}\n.history-title {\n  font-weight: 500;\n  color: var(--text-primary, white);\n}\n.history-meta {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.history-status {\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n}\n.history-status.active {\n  background: rgba(34, 197, 94, 0.2);\n  color: #86efac;\n}\n.history-status.used {\n  background: rgba(148, 163, 184, 0.2);\n  color: #94a3b8;\n}\n/*# sourceMappingURL=membership-center.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(MembershipCenterComponent, { className: "MembershipCenterComponent", filePath: "src/membership-center.component.ts", lineNumber: 1216 });
})();

// src/profile.component.ts
var _forTrack015 = ($index, $item) => $item.id;
function ProfileComponent_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 1);
    \u0275\u0275element(1, "div", 15);
    \u0275\u0275elementStart(2, "span");
    \u0275\u0275text(3, "\u6B63\u5728\u52A0\u8F09\u7528\u6236\u4FE1\u606F...");
    \u0275\u0275elementEnd()();
  }
}
function ProfileComponent_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 2)(1, "span", 16);
    \u0275\u0275text(2, "\u26A0\uFE0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span");
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "button", 17);
    \u0275\u0275listener("click", function ProfileComponent_Conditional_2_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.ensureUserLoaded());
    });
    \u0275\u0275text(6, "\u91CD\u8A66");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r1.userLoadError());
  }
}
function ProfileComponent_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 10);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("\xB7 \u5269\u9918 ", ctx_r1.membershipDaysLeft(), " \u5929");
  }
}
function ProfileComponent_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "span", 18);
    \u0275\u0275text(1, " \u9000\u51FA\u4E2D... ");
  }
}
function ProfileComponent_Conditional_17_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u{1F6AA} \u9000\u51FA ");
  }
}
function ProfileComponent_Conditional_29_Conditional_35_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 29)(1, "div", 30)(2, "label");
    \u0275\u0275text(3, "\u7576\u524D\u5BC6\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "input", 31);
    \u0275\u0275twoWayListener("ngModelChange", function ProfileComponent_Conditional_29_Conditional_35_Template_input_ngModelChange_4_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.passwordForm.oldPassword, $event) || (ctx_r1.passwordForm.oldPassword = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(5, "div", 30)(6, "label");
    \u0275\u0275text(7, "\u65B0\u5BC6\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "input", 31);
    \u0275\u0275twoWayListener("ngModelChange", function ProfileComponent_Conditional_29_Conditional_35_Template_input_ngModelChange_8_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.passwordForm.newPassword, $event) || (ctx_r1.passwordForm.newPassword = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(9, "div", 30)(10, "label");
    \u0275\u0275text(11, "\u78BA\u8A8D\u65B0\u5BC6\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "input", 31);
    \u0275\u0275twoWayListener("ngModelChange", function ProfileComponent_Conditional_29_Conditional_35_Template_input_ngModelChange_12_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.passwordForm.confirmPassword, $event) || (ctx_r1.passwordForm.confirmPassword = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(13, "div", 32)(14, "button", 33);
    \u0275\u0275listener("click", function ProfileComponent_Conditional_29_Conditional_35_Template_button_click_14_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.showChangePassword.set(false));
    });
    \u0275\u0275text(15, "\u53D6\u6D88");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "button", 34);
    \u0275\u0275listener("click", function ProfileComponent_Conditional_29_Conditional_35_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.onChangePassword());
    });
    \u0275\u0275text(17, "\u78BA\u8A8D\u4FEE\u6539");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.passwordForm.oldPassword);
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.passwordForm.newPassword);
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.passwordForm.confirmPassword);
  }
}
function ProfileComponent_Conditional_29_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 14)(1, "div", 19)(2, "h3", 20);
    \u0275\u0275text(3, "\u{1F4CB} \u57FA\u672C\u4FE1\u606F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 21)(5, "div", 22)(6, "span", 23);
    \u0275\u0275text(7, "\u7528\u6236\u540D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "span", 24);
    \u0275\u0275text(9);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(10, "div", 22)(11, "span", 23);
    \u0275\u0275text(12, "\u90F5\u7BB1");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "span", 24);
    \u0275\u0275text(14);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "button", 25);
    \u0275\u0275text(16, "\u7DE8\u8F2F");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(17, "div", 22)(18, "span", 23);
    \u0275\u0275text(19, "\u8A3B\u518A\u6642\u9593");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(20, "span", 24);
    \u0275\u0275text(21);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(22, "div", 22)(23, "span", 23);
    \u0275\u0275text(24, "\u6700\u5F8C\u767B\u5165");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(25, "span", 24);
    \u0275\u0275text(26);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(27, "div", 19)(28, "h3", 20);
    \u0275\u0275text(29, "\u{1F510} \u5B89\u5168\u8A2D\u7F6E");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(30, "div", 26)(31, "button", 27);
    \u0275\u0275listener("click", function ProfileComponent_Conditional_29_Template_button_click_31_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.showChangePassword.set(true));
    });
    \u0275\u0275text(32, " \u{1F511} \u4FEE\u6539\u5BC6\u78BC ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(33, "button", 28);
    \u0275\u0275text(34, " \u{1F4F1} \u5169\u6B65\u9A57\u8B49 ");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(35, ProfileComponent_Conditional_29_Conditional_35_Template, 18, 3, "div", 29);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    let tmp_1_0;
    let tmp_2_0;
    let tmp_3_0;
    let tmp_4_0;
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(9);
    \u0275\u0275textInterpolate((tmp_1_0 = ctx_r1.user()) == null ? null : tmp_1_0.username);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(((tmp_2_0 = ctx_r1.user()) == null ? null : tmp_2_0.email) || "\u672A\u8A2D\u7F6E");
    \u0275\u0275advance(7);
    \u0275\u0275textInterpolate(ctx_r1.formatDate((tmp_3_0 = ctx_r1.user()) == null ? null : tmp_3_0.createdAt));
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r1.formatDate((tmp_4_0 = ctx_r1.user()) == null ? null : tmp_4_0.lastLogin));
    \u0275\u0275advance(9);
    \u0275\u0275conditional(ctx_r1.showChangePassword() ? 35 : -1);
  }
}
function ProfileComponent_Conditional_30_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 40);
    \u0275\u0275text(1, "\u8F09\u5165\u4E2D...");
    \u0275\u0275elementEnd();
  }
}
function ProfileComponent_Conditional_30_Conditional_15_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 41);
    \u0275\u0275text(1, "\u66AB\u7121\u6FC0\u6D3B\u8A18\u9304");
    \u0275\u0275elementEnd();
  }
}
function ProfileComponent_Conditional_30_Conditional_16_For_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 53)(1, "div", 54)(2, "span", 55);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span", 56);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div", 57)(7, "span");
    \u0275\u0275text(8);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "span", 58);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const record_r6 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r1.formatLicenseKey(record_r6.license_key));
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate3("", record_r6.level_icon, " ", record_r6.level_name, " ", record_r6.duration_name);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("", ctx_r1.formatActivationDate(record_r6.activated_at), " \u6FC0\u6D3B");
    \u0275\u0275advance();
    \u0275\u0275classProp("active", record_r6.is_active)("used", !record_r6.is_active);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", record_r6.is_active ? "\u6709\u6548" : "\u5DF2\u904E\u671F", " ");
  }
}
function ProfileComponent_Conditional_30_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275repeaterCreate(0, ProfileComponent_Conditional_30_Conditional_16_For_1_Template, 11, 10, "div", 53, _forTrack015);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275repeater(ctx_r1.activationHistory());
  }
}
function ProfileComponent_Conditional_30_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 14)(1, "div", 19)(2, "h3", 20);
    \u0275\u0275text(3, "\u{1F3AB} \u6FC0\u6D3B\u65B0\u5361\u5BC6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 35)(5, "input", 36);
    \u0275\u0275twoWayListener("ngModelChange", function ProfileComponent_Conditional_30_Template_input_ngModelChange_5_listener($event) {
      \u0275\u0275restoreView(_r5);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.newLicenseKey, $event) || (ctx_r1.newLicenseKey = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "button", 37);
    \u0275\u0275listener("click", function ProfileComponent_Conditional_30_Template_button_click_6_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.onActivateLicense());
    });
    \u0275\u0275text(7, " \u6FC0\u6D3B ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(8, "p", 38);
    \u0275\u0275text(9, "\u8F38\u5165\u8CFC\u8CB7\u7684\u5361\u5BC6\u4EE5\u7E8C\u8CBB\u6216\u5347\u7D1A\u6703\u54E1");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(10, "div", 19)(11, "h3", 20);
    \u0275\u0275text(12, "\u{1F4DC} \u6FC0\u6D3B\u8A18\u9304");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "div", 39);
    \u0275\u0275conditionalCreate(14, ProfileComponent_Conditional_30_Conditional_14_Template, 2, 0, "div", 40)(15, ProfileComponent_Conditional_30_Conditional_15_Template, 2, 0, "div", 41)(16, ProfileComponent_Conditional_30_Conditional_16_Template, 2, 0);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(17, "div", 19)(18, "h3", 20);
    \u0275\u0275text(19, "\u{1F6D2} \u8CFC\u8CB7\u5361\u5BC6\uFF08\u738B\u8005\u69AE\u8000\u7B49\u7D1A\uFF09");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(20, "div", 42)(21, "div", 43)(22, "div", 44);
    \u0275\u0275text(23, "\u{1F948} \u767D\u9280\u7CBE\u82F1");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(24, "div", 45);
    \u0275\u0275text(25, "4.99 USDT/\u6708");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(26, "ul", 46)(27, "li");
    \u0275\u0275text(28, "5 \u500B\u5E33\u865F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(29, "li");
    \u0275\u0275text(30, "\u6BCF\u65E5 100 \u689D\u6D88\u606F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(31, "li");
    \u0275\u0275text(32, "\u6BCF\u65E5 50 \u6B21 AI");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(33, "li");
    \u0275\u0275text(34, "10 \u500B\u7FA4\u7D44");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(35, "button", 47);
    \u0275\u0275text(36, "\u8CFC\u8CB7");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(37, "div", 48)(38, "div", 44);
    \u0275\u0275text(39, "\u{1F947} \u9EC3\u91D1\u5927\u5E2B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(40, "div", 45);
    \u0275\u0275text(41, "19.9 USDT/\u6708");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(42, "div", 49);
    \u0275\u0275text(43, "\u63A8\u85A6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(44, "ul", 46)(45, "li");
    \u0275\u0275text(46, "15 \u500B\u5E33\u865F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(47, "li");
    \u0275\u0275text(48, "\u6BCF\u65E5 500 \u689D\u6D88\u606F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(49, "li");
    \u0275\u0275text(50, "\u6BCF\u65E5 300 \u6B21 AI");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(51, "li");
    \u0275\u0275text(52, "\u6279\u91CF\u64CD\u4F5C");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(53, "button", 47);
    \u0275\u0275text(54, "\u8CFC\u8CB7");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(55, "div", 50)(56, "div", 44);
    \u0275\u0275text(57, "\u{1F48E} \u947D\u77F3\u738B\u724C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(58, "div", 45);
    \u0275\u0275text(59, "59.9 USDT/\u6708");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(60, "ul", 46)(61, "li");
    \u0275\u0275text(62, "50 \u500B\u5E33\u865F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(63, "li");
    \u0275\u0275text(64, "\u6BCF\u65E5 2000 \u689D\u6D88\u606F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(65, "li");
    \u0275\u0275text(66, "\u7121\u9650 AI \u8ABF\u7528");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(67, "li");
    \u0275\u0275text(68, "AI \u92B7\u552E\u6F0F\u6597");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(69, "button", 47);
    \u0275\u0275text(70, "\u8CFC\u8CB7");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(71, "div", 51)(72, "div", 44);
    \u0275\u0275text(73, "\u{1F31F} \u661F\u8000\u50B3\u8AAA");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(74, "div", 45);
    \u0275\u0275text(75, "199 USDT/\u6708");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(76, "ul", 46)(77, "li");
    \u0275\u0275text(78, "100 \u500B\u5E33\u865F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(79, "li");
    \u0275\u0275text(80, "\u7121\u9650\u6D88\u606F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(81, "li");
    \u0275\u0275text(82, "\u5718\u968A\u7BA1\u7406");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(83, "li");
    \u0275\u0275text(84, "\u667A\u80FD\u9632\u5C01");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(85, "button", 47);
    \u0275\u0275text(86, "\u8CFC\u8CB7");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(87, "div", 52)(88, "div", 44);
    \u0275\u0275text(89, "\u{1F451} \u69AE\u8000\u738B\u8005");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(90, "div", 45);
    \u0275\u0275text(91, "599 USDT/\u6708");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(92, "ul", 46)(93, "li");
    \u0275\u0275text(94, "\u7121\u9650\u5E33\u865F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(95, "li");
    \u0275\u0275text(96, "\u7121\u9650\u4E00\u5207");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(97, "li");
    \u0275\u0275text(98, "API \u63A5\u53E3");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(99, "li");
    \u0275\u0275text(100, "\u5C08\u5C6C\u9867\u554F");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(101, "button", 47);
    \u0275\u0275text(102, "\u8CFC\u8CB7");
    \u0275\u0275elementEnd()()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(5);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.newLicenseKey);
    \u0275\u0275advance();
    \u0275\u0275property("disabled", !ctx_r1.newLicenseKey);
    \u0275\u0275advance(8);
    \u0275\u0275conditional(ctx_r1.isLoadingHistory() ? 14 : ctx_r1.activationHistory().length === 0 ? 15 : 16);
  }
}
function ProfileComponent_Conditional_31_For_8_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 72);
    \u0275\u0275text(1, "\u672C\u6A5F");
    \u0275\u0275elementEnd();
  }
}
function ProfileComponent_Conditional_31_For_8_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    const _r8 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 76);
    \u0275\u0275listener("click", function ProfileComponent_Conditional_31_For_8_Conditional_11_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r8);
      const device_r9 = \u0275\u0275nextContext().$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.onUnbindDevice(device_r9.id));
    });
    \u0275\u0275text(1, " \u89E3\u7D81 ");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275property("disabled", ctx_r1.isUnbinding());
  }
}
function ProfileComponent_Conditional_31_For_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 68)(1, "div", 69);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 70)(4, "div", 71);
    \u0275\u0275text(5);
    \u0275\u0275conditionalCreate(6, ProfileComponent_Conditional_31_For_8_Conditional_6_Template, 2, 0, "span", 72);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div", 73);
    \u0275\u0275text(8);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "div", 74);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(11, ProfileComponent_Conditional_31_For_8_Conditional_11_Template, 2, 1, "button", 75);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const device_r9 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275classProp("current", device_r9.isCurrent);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", ctx_r1.getDeviceIcon(device_r9), " ");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", device_r9.deviceName, " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(device_r9.isCurrent ? 6 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(device_r9.deviceCode);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2(" \u7D81\u5B9A\u65BC ", ctx_r1.formatDate(device_r9.boundAt), " \xB7 \u6700\u5F8C\u6D3B\u52D5 ", ctx_r1.formatDate(device_r9.lastSeen), " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(!device_r9.isCurrent ? 11 : -1);
  }
}
function ProfileComponent_Conditional_31_ForEmpty_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 41);
    \u0275\u0275text(1, " \u66AB\u7121\u7D81\u5B9A\u8A2D\u5099\u8A18\u9304 ");
    \u0275\u0275elementEnd();
  }
}
function ProfileComponent_Conditional_31_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 14)(1, "div", 19)(2, "h3", 20);
    \u0275\u0275text(3, "\u{1F4BB} \u5DF2\u7D81\u5B9A\u8A2D\u5099");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "p", 59);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "div", 60);
    \u0275\u0275repeaterCreate(7, ProfileComponent_Conditional_31_For_8_Template, 12, 9, "div", 61, _forTrack015, false, ProfileComponent_Conditional_31_ForEmpty_9_Template, 2, 0, "div", 41);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(10, "div", 19)(11, "h3", 20);
    \u0275\u0275text(12, "\u{1F4F1} \u7576\u524D\u8A2D\u5099");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "div", 62)(14, "div", 63)(15, "span", 64);
    \u0275\u0275text(16, "\u8A2D\u5099\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(17, "span", 65);
    \u0275\u0275text(18);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(19, "button", 66);
    \u0275\u0275listener("click", function ProfileComponent_Conditional_31_Template_button_click_19_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.copyDeviceCode());
    });
    \u0275\u0275text(20, "\u{1F4CB}");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(21, "div", 63)(22, "span", 64);
    \u0275\u0275text(23, "\u8A2D\u5099\u540D\u7A31");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(24, "span", 67);
    \u0275\u0275text(25);
    \u0275\u0275elementEnd()()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate2(" \u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u6700\u591A\u53EF\u7D81\u5B9A ", ctx_r1.getMaxDevices(), " \u53F0\u8A2D\u5099\uFF0C\u5DF2\u4F7F\u7528 ", ctx_r1.devices().length, " \u53F0 ");
    \u0275\u0275advance(2);
    \u0275\u0275repeater(ctx_r1.devices());
    \u0275\u0275advance(11);
    \u0275\u0275textInterpolate(ctx_r1.currentDeviceCode());
    \u0275\u0275advance(7);
    \u0275\u0275textInterpolate(ctx_r1.currentDeviceName());
  }
}
function ProfileComponent_Conditional_32_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 77)(1, "div", 78)(2, "div", 79);
    \u0275\u0275text(3, "\u{1F916}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 80)(5, "div", 81);
    \u0275\u0275text(6, "AI \u8ABF\u7528");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div", 82);
    \u0275\u0275element(8, "div", 83);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "div", 84);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(11, "div", 78)(12, "div", 79);
    \u0275\u0275text(13, "\u{1F4E8}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "div", 80)(15, "div", 81);
    \u0275\u0275text(16, "\u6D88\u606F\u767C\u9001");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(17, "div", 82);
    \u0275\u0275element(18, "div", 83);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(19, "div", 84);
    \u0275\u0275text(20);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(21, "div", 78)(22, "div", 79);
    \u0275\u0275text(23, "\u{1F465}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(24, "div", 80)(25, "div", 81);
    \u0275\u0275text(26, "\u5E33\u865F\u6578\u91CF");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(27, "div", 82);
    \u0275\u0275element(28, "div", 83);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(29, "div", 84);
    \u0275\u0275text(30);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(31, "div", 78)(32, "div", 79);
    \u0275\u0275text(33, "\u{1F4BE}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(34, "div", 80)(35, "div", 81);
    \u0275\u0275text(36, "\u5B58\u5132\u7A7A\u9593");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(37, "div", 82);
    \u0275\u0275element(38, "div", 83);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(39, "div", 84);
    \u0275\u0275text(40);
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(8);
    \u0275\u0275styleProp("width", ctx_r1.getUsagePercent(ctx_r1.usageStats().aiCalls), "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2(" ", ctx_r1.usageStats().aiCalls.used, " / ", ctx_r1.usageStats().aiCalls.limit, " \u6B21 ");
    \u0275\u0275advance(8);
    \u0275\u0275styleProp("width", ctx_r1.getUsagePercent(ctx_r1.usageStats().messagesSent), "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2(" ", ctx_r1.usageStats().messagesSent.used, " / ", ctx_r1.usageStats().messagesSent.limit, " \u689D ");
    \u0275\u0275advance(8);
    \u0275\u0275styleProp("width", ctx_r1.getUsagePercent(ctx_r1.usageStats().accounts), "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2(" ", ctx_r1.usageStats().accounts.used, " / ", ctx_r1.usageStats().accounts.limit, " \u500B ");
    \u0275\u0275advance(8);
    \u0275\u0275styleProp("width", ctx_r1.getUsagePercent(ctx_r1.usageStats().storage), "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2(" ", ctx_r1.usageStats().storage.used, " / ", ctx_r1.usageStats().storage.limit, " MB ");
  }
}
function ProfileComponent_Conditional_32_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 40);
    \u0275\u0275text(1, "\u8F09\u5165\u4E2D...");
    \u0275\u0275elementEnd();
  }
}
function ProfileComponent_Conditional_32_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 14)(1, "div", 19)(2, "h3", 20);
    \u0275\u0275text(3, "\u{1F4CA} \u672C\u6708\u4F7F\u7528\u60C5\u6CC1");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(4, ProfileComponent_Conditional_32_Conditional_4_Template, 41, 16, "div", 77)(5, ProfileComponent_Conditional_32_Conditional_5_Template, 2, 0, "div", 40);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "div", 19)(7, "h3", 20);
    \u0275\u0275text(8, "\u{1F4C8} \u6B77\u53F2\u8DA8\u52E2");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "p", 59);
    \u0275\u0275text(10, "\u656C\u8ACB\u671F\u5F85...");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(4);
    \u0275\u0275conditional(ctx_r1.usageStats() ? 4 : 5);
  }
}
function ProfileComponent_Conditional_33_Template(rf, ctx) {
  if (rf & 1) {
    const _r10 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 14)(1, "div", 85)(2, "h3", 20);
    \u0275\u0275text(3, "\u{1F381} \u9080\u8ACB\u597D\u53CB\u5F97\u734E\u52F5");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "p", 59);
    \u0275\u0275text(5, " \u6BCF\u9080\u8ACB 1 \u4F4D\u597D\u53CB\u8A3B\u518A\u4E26\u6FC0\u6D3B\uFF0C\u60A8\u5C07\u7372\u5F97 ");
    \u0275\u0275elementStart(6, "strong");
    \u0275\u0275text(7, "3 \u5929\u767D\u9280\u7CBE\u82F1");
    \u0275\u0275elementEnd();
    \u0275\u0275text(8, " \u734E\u52F5\uFF01 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "div", 86)(10, "span", 87);
    \u0275\u0275text(11, "\u6211\u7684\u9080\u8ACB\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "div", 88);
    \u0275\u0275text(13);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "button", 66);
    \u0275\u0275listener("click", function ProfileComponent_Conditional_33_Template_button_click_14_listener() {
      \u0275\u0275restoreView(_r10);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.copyInviteCode());
    });
    \u0275\u0275text(15, " \u{1F4CB} \u8907\u88FD ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(16, "div", 89)(17, "span", 87);
    \u0275\u0275text(18, "\u9080\u8ACB\u93C8\u63A5");
    \u0275\u0275elementEnd();
    \u0275\u0275element(19, "input", 90);
    \u0275\u0275elementStart(20, "button", 66);
    \u0275\u0275listener("click", function ProfileComponent_Conditional_33_Template_button_click_20_listener() {
      \u0275\u0275restoreView(_r10);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.copyInviteLink());
    });
    \u0275\u0275text(21, " \u{1F4CB} \u8907\u88FD ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(22, "div", 19)(23, "h3", 20);
    \u0275\u0275text(24, "\u{1F4CA} \u9080\u8ACB\u7D71\u8A08");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(25, "div", 91)(26, "div", 92)(27, "div", 93);
    \u0275\u0275text(28);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(29, "div", 94);
    \u0275\u0275text(30, "\u5DF2\u9080\u8ACB\u4EBA\u6578");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(31, "div", 92)(32, "div", 93);
    \u0275\u0275text(33);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(34, "div", 94);
    \u0275\u0275text(35, "\u7372\u5F97\u734E\u52F5\u5929\u6578");
    \u0275\u0275elementEnd()()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(13);
    \u0275\u0275textInterpolate(ctx_r1.inviteCode());
    \u0275\u0275advance(6);
    \u0275\u0275property("value", ctx_r1.inviteLink());
    \u0275\u0275advance(9);
    \u0275\u0275textInterpolate(ctx_r1.invitedCount());
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r1.rewardDays());
  }
}
var ProfileComponent = class _ProfileComponent {
  constructor() {
    this.authService = inject(AuthService2);
    this.deviceService = inject(DeviceService);
    this.i18n = inject(I18nService);
    this.toast = inject(ToastService);
    this.licenseClient = inject(LicenseClientService);
    this.cdr = inject(ChangeDetectorRef);
    this.router = inject(Router);
    this.membershipUpdateHandler = null;
    this.activeTab = signal("account", ...ngDevMode ? [{ debugName: "activeTab" }] : []);
    this.showChangePassword = signal(false, ...ngDevMode ? [{ debugName: "showChangePassword" }] : []);
    this.isUnbinding = signal(false, ...ngDevMode ? [{ debugName: "isUnbinding" }] : []);
    this.isLoggingOut = signal(false, ...ngDevMode ? [{ debugName: "isLoggingOut" }] : []);
    this.passwordForm = { oldPassword: "", newPassword: "", confirmPassword: "" };
    this.newLicenseKey = "";
    this.user = computed(() => this.authService.user(), ...ngDevMode ? [{ debugName: "user" }] : []);
    this.membershipLevel = computed(() => this.authService.membershipLevel(), ...ngDevMode ? [{ debugName: "membershipLevel" }] : []);
    this.membershipDaysLeft = computed(() => this.authService.membershipDaysLeft(), ...ngDevMode ? [{ debugName: "membershipDaysLeft" }] : []);
    this.devices = computed(() => this.authService.devices(), ...ngDevMode ? [{ debugName: "devices" }] : []);
    this.usageStats = computed(() => this.authService.usageStats(), ...ngDevMode ? [{ debugName: "usageStats" }] : []);
    this.currentDeviceCode = signal("", ...ngDevMode ? [{ debugName: "currentDeviceCode" }] : []);
    this.currentDeviceName = signal("", ...ngDevMode ? [{ debugName: "currentDeviceName" }] : []);
    this.inviteCode = signal("", ...ngDevMode ? [{ debugName: "inviteCode" }] : []);
    this.invitedCount = signal(0, ...ngDevMode ? [{ debugName: "invitedCount" }] : []);
    this.rewardDays = signal(0, ...ngDevMode ? [{ debugName: "rewardDays" }] : []);
    this.activationHistory = signal([], ...ngDevMode ? [{ debugName: "activationHistory" }] : []);
    this.isLoadingHistory = signal(false, ...ngDevMode ? [{ debugName: "isLoadingHistory" }] : []);
    this.inviteLink = computed(() => {
      return `https://tg-matrix.com/invite?code=${this.inviteCode()}`;
    }, ...ngDevMode ? [{ debugName: "inviteLink" }] : []);
    this.isLoadingUser = signal(false, ...ngDevMode ? [{ debugName: "isLoadingUser" }] : []);
    this.userLoadError = signal(null, ...ngDevMode ? [{ debugName: "userLoadError" }] : []);
  }
  async ngOnInit() {
    await this.ensureUserLoaded();
    this.currentDeviceCode.set(await this.deviceService.getDeviceCode());
    this.currentDeviceName.set(this.deviceService.getDeviceName());
    const rewards = await this.authService.getInviteRewards();
    this.inviteCode.set(rewards.inviteCode);
    this.invitedCount.set(rewards.invitedCount);
    this.rewardDays.set(rewards.rewardDays);
    await this.loadActivationHistory();
    this.membershipUpdateHandler = (event) => {
      const customEvent = event;
      console.log("[ProfileComponent] \u6536\u5230\u6703\u54E1\u72C0\u614B\u66F4\u65B0\u4E8B\u4EF6:", customEvent.detail);
      this.cdr.detectChanges();
    };
    window.addEventListener("membership-updated", this.membershipUpdateHandler);
  }
  ngOnDestroy() {
    if (this.membershipUpdateHandler) {
      window.removeEventListener("membership-updated", this.membershipUpdateHandler);
    }
  }
  /**
   * 🔧 修復：確保用戶信息已加載
   * 如果沒有用戶信息，主動從後端獲取
   */
  async ensureUserLoaded() {
    if (this.user()?.username) {
      console.log("[Profile] User already loaded:", this.user()?.username);
      return;
    }
    this.isLoadingUser.set(true);
    this.userLoadError.set(null);
    try {
      console.log("[Profile] Fetching user info...");
      const user = await this.authService.fetchCurrentUser();
      if (user) {
        console.log("[Profile] User loaded successfully:", user.username);
      } else {
        console.warn("[Profile] No user returned from API");
        this.userLoadError.set("\u7121\u6CD5\u7372\u53D6\u7528\u6236\u4FE1\u606F");
      }
    } catch (error) {
      console.error("[Profile] Failed to load user:", error);
      this.userLoadError.set(error.message || "\u52A0\u8F09\u5931\u6557");
    } finally {
      this.isLoadingUser.set(false);
      this.cdr.detectChanges();
    }
  }
  async loadActivationHistory() {
    this.isLoadingHistory.set(true);
    try {
      const result = await this.licenseClient.getActivationHistory(50, 0);
      if (result.success && result.data) {
        this.activationHistory.set(result.data);
      }
    } catch (error) {
      console.error("\u8F09\u5165\u6FC0\u6D3B\u8A18\u9304\u5931\u6557:", error);
    } finally {
      this.isLoadingHistory.set(false);
    }
  }
  getMembershipIcon() {
    const icons = {
      bronze: "\u2694\uFE0F",
      silver: "\u{1F948}",
      gold: "\u{1F947}",
      diamond: "\u{1F48E}",
      star: "\u{1F31F}",
      king: "\u{1F451}"
    };
    return icons[this.membershipLevel()] || "\u2694\uFE0F";
  }
  getMembershipName() {
    const names = {
      bronze: "\u9752\u9285\u6230\u58EB",
      silver: "\u767D\u9280\u7CBE\u82F1",
      gold: "\u9EC3\u91D1\u5927\u5E2B",
      diamond: "\u947D\u77F3\u738B\u724C",
      star: "\u661F\u8000\u50B3\u8AAA",
      king: "\u69AE\u8000\u738B\u8005"
    };
    return names[this.membershipLevel()] || "\u9752\u9285\u6230\u58EB";
  }
  getMaxDevices() {
    const limits = {
      bronze: 1,
      silver: 2,
      gold: 3,
      diamond: 4,
      star: 5,
      king: -1
      // 無限
    };
    return limits[this.membershipLevel()] || 1;
  }
  getDeviceIcon(device) {
    if (device.deviceName.includes("Windows"))
      return "\u{1F4BB}";
    if (device.deviceName.includes("Mac"))
      return "\u{1F5A5}\uFE0F";
    if (device.deviceName.includes("Linux"))
      return "\u{1F427}";
    return "\u{1F4F1}";
  }
  getUsagePercent(usage) {
    return Math.min(100, usage.used / usage.limit * 100);
  }
  formatDate(dateString) {
    if (!dateString)
      return "-";
    return new Date(dateString).toLocaleDateString("zh-TW");
  }
  async onLogout() {
    console.log("[Profile] Logging out...");
    this.isLoggingOut.set(true);
    await new Promise((resolve) => setTimeout(resolve, 500));
    await this.authService.logout();
  }
  async onChangePassword() {
    if (this.passwordForm.newPassword !== this.passwordForm.confirmPassword) {
      this.toast.error("\u5169\u6B21\u8F38\u5165\u7684\u5BC6\u78BC\u4E0D\u4E00\u81F4");
      return;
    }
    const result = await this.authService.changePassword(this.passwordForm.oldPassword, this.passwordForm.newPassword);
    if (result.success) {
      this.toast.success("\u5BC6\u78BC\u4FEE\u6539\u6210\u529F");
      this.showChangePassword.set(false);
      this.passwordForm = { oldPassword: "", newPassword: "", confirmPassword: "" };
    } else {
      this.toast.error(result.message);
    }
  }
  async onActivateLicense() {
    const result = await this.authService.renewMembership(this.newLicenseKey);
    if (result.success) {
      this.toast.success(result.message || "\u5361\u5BC6\u6FC0\u6D3B\u6210\u529F\uFF01");
      this.newLicenseKey = "";
      await this.loadActivationHistory();
      this.cdr.detectChanges();
    } else {
      this.toast.error(result.message);
    }
  }
  formatLicenseKey(key) {
    if (!key)
      return "";
    if (key.length > 16) {
      return key.substring(0, 12) + "-****";
    }
    return key;
  }
  formatActivationDate(dateString) {
    if (!dateString)
      return "-";
    const date = new Date(dateString);
    return date.toLocaleDateString("zh-TW");
  }
  async onUnbindDevice(deviceId) {
    this.isUnbinding.set(true);
    const result = await this.authService.unbindDevice(deviceId);
    if (result.success) {
      this.toast.success("\u8A2D\u5099\u5DF2\u89E3\u7D81");
    } else {
      this.toast.error(result.message);
    }
    this.isUnbinding.set(false);
  }
  copyDeviceCode() {
    navigator.clipboard.writeText(this.currentDeviceCode());
    this.toast.success("\u8A2D\u5099\u78BC\u5DF2\u8907\u88FD");
  }
  copyInviteCode() {
    navigator.clipboard.writeText(this.inviteCode());
    this.toast.success("\u9080\u8ACB\u78BC\u5DF2\u8907\u88FD");
  }
  copyInviteLink() {
    navigator.clipboard.writeText(this.inviteLink());
    this.toast.success("\u9080\u8ACB\u93C8\u63A5\u5DF2\u8907\u88FD");
  }
  static {
    this.\u0275fac = function ProfileComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _ProfileComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _ProfileComponent, selectors: [["app-profile"]], decls: 34, vars: 27, consts: [[1, "profile-container"], [1, "loading-overlay"], [1, "error-alert"], [1, "profile-header"], [1, "avatar-section"], [1, "avatar"], [1, "user-info"], [1, "username"], [1, "email"], [1, "membership-badge"], [1, "expires"], [1, "logout-btn", 3, "click", "disabled"], [1, "tabs"], [1, "tab-btn", 3, "click"], [1, "tab-content"], [1, "loading-spinner"], [1, "error-icon"], [1, "retry-btn", 3, "click"], [1, "logout-spinner"], [1, "section-card"], [1, "section-title"], [1, "info-grid"], [1, "info-item"], [1, "info-label"], [1, "info-value"], [1, "edit-btn"], [1, "security-actions"], [1, "action-btn", 3, "click"], [1, "action-btn"], [1, "change-password-form"], [1, "form-group"], ["type", "password", 1, "form-input", 3, "ngModelChange", "ngModel"], [1, "form-actions"], [1, "cancel-btn", 3, "click"], [1, "submit-btn", 3, "click"], [1, "license-input-group"], ["type", "text", "placeholder", "XXXX-XXXX-XXXX-XXXX", 1, "form-input", "font-mono", 3, "ngModelChange", "ngModel"], [1, "activate-btn", 3, "click", "disabled"], [1, "hint-text"], [1, "license-history"], [1, "loading-state"], [1, "empty-state"], [1, "purchase-options"], [1, "purchase-card", "silver"], [1, "plan-name"], [1, "plan-price"], [1, "plan-features"], [1, "buy-btn"], [1, "purchase-card", "gold"], [1, "recommended"], [1, "purchase-card", "diamond"], [1, "purchase-card", "star"], [1, "purchase-card", "king"], [1, "history-item"], [1, "history-info"], [1, "license-code"], [1, "license-type"], [1, "history-meta"], [1, "status"], [1, "section-desc"], [1, "device-list"], [1, "device-item", 3, "current"], [1, "current-device-info"], [1, "info-row"], [1, "label"], [1, "value", "font-mono"], [1, "copy-btn", 3, "click"], [1, "value"], [1, "device-item"], [1, "device-icon"], [1, "device-info"], [1, "device-name"], [1, "current-badge"], [1, "device-code"], [1, "device-meta"], [1, "unbind-btn", 3, "disabled"], [1, "unbind-btn", 3, "click", "disabled"], [1, "usage-grid"], [1, "usage-item"], [1, "usage-icon"], [1, "usage-info"], [1, "usage-label"], [1, "usage-bar"], [1, "usage-fill"], [1, "usage-text"], [1, "section-card", "highlight"], [1, "invite-code-box"], [1, "invite-label"], [1, "invite-code"], [1, "invite-link-box"], ["type", "text", "readonly", "", 1, "invite-link-input", 3, "value"], [1, "invite-stats"], [1, "stat-item"], [1, "stat-value"], [1, "stat-label"]], template: function ProfileComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0);
        \u0275\u0275conditionalCreate(1, ProfileComponent_Conditional_1_Template, 4, 0, "div", 1);
        \u0275\u0275conditionalCreate(2, ProfileComponent_Conditional_2_Template, 7, 1, "div", 2);
        \u0275\u0275elementStart(3, "div", 3)(4, "div", 4)(5, "div", 5);
        \u0275\u0275text(6);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(7, "div", 6)(8, "h2", 7);
        \u0275\u0275text(9);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(10, "p", 8);
        \u0275\u0275text(11);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(12, "div", 9);
        \u0275\u0275text(13);
        \u0275\u0275conditionalCreate(14, ProfileComponent_Conditional_14_Template, 2, 1, "span", 10);
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(15, "button", 11);
        \u0275\u0275listener("click", function ProfileComponent_Template_button_click_15_listener() {
          return ctx.onLogout();
        });
        \u0275\u0275conditionalCreate(16, ProfileComponent_Conditional_16_Template, 2, 0)(17, ProfileComponent_Conditional_17_Template, 1, 0);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(18, "div", 12)(19, "button", 13);
        \u0275\u0275listener("click", function ProfileComponent_Template_button_click_19_listener() {
          return ctx.activeTab.set("account");
        });
        \u0275\u0275text(20, " \u{1F464} \u5E33\u865F\u4FE1\u606F ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(21, "button", 13);
        \u0275\u0275listener("click", function ProfileComponent_Template_button_click_21_listener() {
          return ctx.activeTab.set("license");
        });
        \u0275\u0275text(22, " \u{1F511} \u5361\u5BC6\u7BA1\u7406 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(23, "button", 13);
        \u0275\u0275listener("click", function ProfileComponent_Template_button_click_23_listener() {
          return ctx.activeTab.set("devices");
        });
        \u0275\u0275text(24, " \u{1F4BB} \u8A2D\u5099\u7BA1\u7406 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(25, "button", 13);
        \u0275\u0275listener("click", function ProfileComponent_Template_button_click_25_listener() {
          return ctx.activeTab.set("usage");
        });
        \u0275\u0275text(26, " \u{1F4CA} \u4F7F\u7528\u7D71\u8A08 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(27, "button", 13);
        \u0275\u0275listener("click", function ProfileComponent_Template_button_click_27_listener() {
          return ctx.activeTab.set("invite");
        });
        \u0275\u0275text(28, " \u{1F381} \u9080\u8ACB\u734E\u52F5 ");
        \u0275\u0275elementEnd()();
        \u0275\u0275conditionalCreate(29, ProfileComponent_Conditional_29_Template, 36, 5, "div", 14);
        \u0275\u0275conditionalCreate(30, ProfileComponent_Conditional_30_Template, 103, 3, "div", 14);
        \u0275\u0275conditionalCreate(31, ProfileComponent_Conditional_31_Template, 26, 5, "div", 14);
        \u0275\u0275conditionalCreate(32, ProfileComponent_Conditional_32_Template, 11, 1, "div", 14);
        \u0275\u0275conditionalCreate(33, ProfileComponent_Conditional_33_Template, 36, 4, "div", 14);
        \u0275\u0275elementEnd();
      }
      if (rf & 2) {
        let tmp_2_0;
        let tmp_3_0;
        let tmp_4_0;
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.isLoadingUser() ? 1 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.userLoadError() ? 2 : -1);
        \u0275\u0275advance(4);
        \u0275\u0275textInterpolate1(" ", ((tmp_2_0 = ctx.user()) == null ? null : tmp_2_0.username == null ? null : tmp_2_0.username.charAt(0).toUpperCase()) || ((tmp_2_0 = ctx.user()) == null ? null : tmp_2_0.display_name == null ? null : tmp_2_0.display_name.charAt(0).toUpperCase()) || "?", " ");
        \u0275\u0275advance(3);
        \u0275\u0275textInterpolate(((tmp_3_0 = ctx.user()) == null ? null : tmp_3_0.display_name) || ((tmp_3_0 = ctx.user()) == null ? null : tmp_3_0.username) || (ctx.isLoadingUser() ? "\u8F09\u5165\u4E2D..." : "\u672A\u767B\u5165"));
        \u0275\u0275advance(2);
        \u0275\u0275textInterpolate(((tmp_4_0 = ctx.user()) == null ? null : tmp_4_0.email) || "\u672A\u8A2D\u7F6E\u90F5\u7BB1");
        \u0275\u0275advance();
        \u0275\u0275classMap("level-" + ctx.membershipLevel());
        \u0275\u0275advance();
        \u0275\u0275textInterpolate2(" ", ctx.getMembershipIcon(), " ", ctx.getMembershipName(), " ");
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.membershipDaysLeft() > 0 ? 14 : -1);
        \u0275\u0275advance();
        \u0275\u0275property("disabled", ctx.isLoggingOut());
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.isLoggingOut() ? 16 : 17);
        \u0275\u0275advance(3);
        \u0275\u0275classProp("active", ctx.activeTab() === "account");
        \u0275\u0275advance(2);
        \u0275\u0275classProp("active", ctx.activeTab() === "license");
        \u0275\u0275advance(2);
        \u0275\u0275classProp("active", ctx.activeTab() === "devices");
        \u0275\u0275advance(2);
        \u0275\u0275classProp("active", ctx.activeTab() === "usage");
        \u0275\u0275advance(2);
        \u0275\u0275classProp("active", ctx.activeTab() === "invite");
        \u0275\u0275advance(2);
        \u0275\u0275conditional(ctx.activeTab() === "account" ? 29 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.activeTab() === "license" ? 30 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.activeTab() === "devices" ? 31 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.activeTab() === "usage" ? 32 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.activeTab() === "invite" ? 33 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, DefaultValueAccessor, NgControlStatus, NgModel], styles: ["\n\n.profile-container[_ngcontent-%COMP%] {\n  padding: 1.5rem;\n  max-width: 900px;\n  margin: 0 auto;\n}\n.profile-header[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      rgba(6, 182, 212, 0.1),\n      rgba(59, 130, 246, 0.1));\n  border: 1px solid rgba(6, 182, 212, 0.2);\n  border-radius: 1rem;\n  margin-bottom: 1.5rem;\n}\n.avatar-section[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.avatar[_ngcontent-%COMP%] {\n  width: 64px;\n  height: 64px;\n  border-radius: 50%;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.5rem;\n  font-weight: bold;\n  color: white;\n}\n.username[_ngcontent-%COMP%] {\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n  margin: 0;\n}\n.email[_ngcontent-%COMP%] {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n  margin: 0.25rem 0;\n}\n.membership-badge[_ngcontent-%COMP%] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding: 0.25rem 0.75rem;\n  border-radius: 1rem;\n  font-size: 0.75rem;\n  font-weight: 500;\n}\n.membership-badge.level-bronze[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #CD7F32,\n      #8B4513);\n  color: white;\n}\n.membership-badge.level-silver[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #C0C0C0,\n      #A8A8A8);\n  color: #1e293b;\n}\n.membership-badge.level-gold[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #FFD700,\n      #FFA500);\n  color: #1e293b;\n}\n.membership-badge.level-diamond[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #B9F2FF,\n      #06b6d4);\n  color: #1e293b;\n}\n.membership-badge.level-star[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #9B59B6,\n      #8E44AD);\n  color: white;\n}\n.membership-badge.level-king[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #FF6B6B,\n      #ee5a5a);\n  color: white;\n}\n.expires[_ngcontent-%COMP%] {\n  opacity: 0.8;\n}\n.logout-btn[_ngcontent-%COMP%] {\n  padding: 0.5rem 1rem;\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  border-radius: 0.5rem;\n  color: #fca5a5;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.logout-btn[_ngcontent-%COMP%]:hover:not(:disabled) {\n  background: rgba(239, 68, 68, 0.2);\n}\n.logout-btn[_ngcontent-%COMP%]:disabled {\n  opacity: 0.7;\n  cursor: not-allowed;\n}\n.logout-spinner[_ngcontent-%COMP%] {\n  display: inline-block;\n  width: 14px;\n  height: 14px;\n  border: 2px solid rgba(239, 68, 68, 0.3);\n  border-top-color: #ef4444;\n  border-radius: 50%;\n  animation: _ngcontent-%COMP%_spin 0.8s linear infinite;\n}\n@keyframes _ngcontent-%COMP%_spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n.tabs[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 1.5rem;\n  flex-wrap: wrap;\n}\n.tab-btn[_ngcontent-%COMP%] {\n  padding: 0.5rem 1rem;\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 0.5rem;\n  color: var(--text-secondary, #94a3b8);\n  cursor: pointer;\n  transition: all 0.2s;\n  font-size: 0.875rem;\n}\n.tab-btn[_ngcontent-%COMP%]:hover {\n  border-color: var(--primary, #06b6d4);\n  color: var(--text-primary, white);\n}\n.tab-btn.active[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border-color: transparent;\n  color: white;\n}\n.section-card[_ngcontent-%COMP%] {\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 1rem;\n  padding: 1.5rem;\n  margin-bottom: 1rem;\n}\n.section-card.highlight[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(6, 182, 212, 0.1),\n      rgba(59, 130, 246, 0.1));\n  border-color: rgba(6, 182, 212, 0.3);\n}\n.section-title[_ngcontent-%COMP%] {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n  margin: 0 0 1rem 0;\n}\n.section-desc[_ngcontent-%COMP%] {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n  margin-bottom: 1rem;\n}\n.info-grid[_ngcontent-%COMP%] {\n  display: grid;\n  gap: 1rem;\n}\n.info-item[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.5rem;\n}\n.info-label[_ngcontent-%COMP%] {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n  min-width: 80px;\n}\n.info-value[_ngcontent-%COMP%] {\n  color: var(--text-primary, white);\n  flex: 1;\n}\n.edit-btn[_ngcontent-%COMP%], \n.copy-btn[_ngcontent-%COMP%] {\n  padding: 0.25rem 0.5rem;\n  background: transparent;\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.25rem;\n  color: var(--text-muted, #94a3b8);\n  cursor: pointer;\n  font-size: 0.75rem;\n}\n.edit-btn[_ngcontent-%COMP%]:hover, \n.copy-btn[_ngcontent-%COMP%]:hover {\n  border-color: var(--primary, #06b6d4);\n  color: var(--primary, #06b6d4);\n}\n.form-group[_ngcontent-%COMP%] {\n  margin-bottom: 1rem;\n}\n.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%] {\n  display: block;\n  color: var(--text-secondary, #cbd5e1);\n  font-size: 0.875rem;\n  margin-bottom: 0.5rem;\n}\n.form-input[_ngcontent-%COMP%] {\n  width: 100%;\n  padding: 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n}\n.form-input[_ngcontent-%COMP%]:focus {\n  outline: none;\n  border-color: var(--primary, #06b6d4);\n}\n.device-list[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.device-item[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 0.75rem;\n}\n.device-item.current[_ngcontent-%COMP%] {\n  border-color: var(--primary, #06b6d4);\n  background: rgba(6, 182, 212, 0.1);\n}\n.device-icon[_ngcontent-%COMP%] {\n  font-size: 1.5rem;\n}\n.device-info[_ngcontent-%COMP%] {\n  flex: 1;\n}\n.device-name[_ngcontent-%COMP%] {\n  font-weight: 500;\n  color: var(--text-primary, white);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.current-badge[_ngcontent-%COMP%] {\n  font-size: 0.625rem;\n  padding: 0.125rem 0.375rem;\n  background: var(--primary, #06b6d4);\n  border-radius: 0.25rem;\n  color: white;\n}\n.device-code[_ngcontent-%COMP%] {\n  font-family: monospace;\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.device-meta[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-muted, #64748b);\n  margin-top: 0.25rem;\n}\n.unbind-btn[_ngcontent-%COMP%] {\n  padding: 0.375rem 0.75rem;\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  border-radius: 0.375rem;\n  color: #fca5a5;\n  cursor: pointer;\n  font-size: 0.75rem;\n}\n.usage-grid[_ngcontent-%COMP%] {\n  display: grid;\n  gap: 1rem;\n}\n.usage-item[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.75rem;\n}\n.usage-icon[_ngcontent-%COMP%] {\n  font-size: 1.5rem;\n}\n.usage-info[_ngcontent-%COMP%] {\n  flex: 1;\n}\n.usage-label[_ngcontent-%COMP%] {\n  color: var(--text-secondary, #cbd5e1);\n  font-size: 0.875rem;\n  margin-bottom: 0.5rem;\n}\n.usage-bar[_ngcontent-%COMP%] {\n  height: 8px;\n  background: var(--bg-primary, #0f172a);\n  border-radius: 4px;\n  overflow: hidden;\n}\n.usage-fill[_ngcontent-%COMP%] {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #06b6d4,\n      #3b82f6);\n  border-radius: 4px;\n  transition: width 0.3s;\n}\n.usage-text[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n  margin-top: 0.25rem;\n}\n.invite-code-box[_ngcontent-%COMP%], \n.invite-link-box[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.75rem;\n  margin-bottom: 1rem;\n}\n.invite-label[_ngcontent-%COMP%] {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n  min-width: 80px;\n}\n.invite-code[_ngcontent-%COMP%] {\n  font-family: monospace;\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--primary, #06b6d4);\n  flex: 1;\n}\n.invite-link-input[_ngcontent-%COMP%] {\n  flex: 1;\n  padding: 0.5rem;\n  background: transparent;\n  border: none;\n  color: var(--text-secondary, #cbd5e1);\n  font-size: 0.875rem;\n}\n.invite-stats[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 2rem;\n  justify-content: center;\n  padding: 1rem;\n}\n.stat-item[_ngcontent-%COMP%] {\n  text-align: center;\n}\n.stat-value[_ngcontent-%COMP%] {\n  font-size: 2rem;\n  font-weight: bold;\n  color: var(--primary, #06b6d4);\n}\n.stat-label[_ngcontent-%COMP%] {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n}\n.purchase-options[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 1rem;\n}\n.purchase-card[_ngcontent-%COMP%] {\n  padding: 1.5rem;\n  border-radius: 1rem;\n  text-align: center;\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n}\n.purchase-card.silver[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(192, 192, 192, 0.1),\n      rgba(168, 168, 168, 0.1));\n  border-color: rgba(192, 192, 192, 0.3);\n}\n.purchase-card.gold[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(255, 215, 0, 0.1),\n      rgba(255, 165, 0, 0.1));\n  border-color: rgba(255, 215, 0, 0.3);\n}\n.purchase-card.diamond[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(6, 182, 212, 0.15),\n      rgba(185, 242, 255, 0.1));\n  border-color: rgba(6, 182, 212, 0.4);\n}\n.purchase-card.star[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(155, 89, 182, 0.1),\n      rgba(142, 68, 173, 0.1));\n  border-color: rgba(155, 89, 182, 0.3);\n}\n.purchase-card.king[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(255, 107, 107, 0.15),\n      rgba(238, 90, 90, 0.1));\n  border-color: rgba(255, 107, 107, 0.4);\n}\n.recommended[_ngcontent-%COMP%] {\n  position: absolute;\n  top: -8px;\n  right: -8px;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  color: white;\n  font-size: 0.625rem;\n  padding: 0.125rem 0.5rem;\n  border-radius: 0.25rem;\n  font-weight: 600;\n}\n.purchase-card[_ngcontent-%COMP%] {\n  position: relative;\n}\n.plan-name[_ngcontent-%COMP%] {\n  font-weight: 600;\n  color: var(--text-primary, white);\n  margin-bottom: 0.5rem;\n}\n.plan-price[_ngcontent-%COMP%] {\n  font-size: 1.5rem;\n  font-weight: bold;\n  color: var(--primary, #06b6d4);\n  margin-bottom: 1rem;\n}\n.plan-features[_ngcontent-%COMP%] {\n  list-style: none;\n  padding: 0;\n  margin: 0 0 1rem 0;\n  font-size: 0.875rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.plan-features[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] {\n  padding: 0.25rem 0;\n}\n.buy-btn[_ngcontent-%COMP%] {\n  padding: 0.5rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  cursor: pointer;\n  font-weight: 500;\n}\n.license-input-group[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n.license-input-group[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%] {\n  flex: 1;\n  font-family: monospace;\n}\n.activate-btn[_ngcontent-%COMP%] {\n  padding: 0.75rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e,\n      #16a34a);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  white-space: nowrap;\n}\n.activate-btn[_ngcontent-%COMP%]:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);\n}\n.activate-btn[_ngcontent-%COMP%]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.hint-text[_ngcontent-%COMP%] {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n  margin-top: 0.5rem;\n}\n.empty-state[_ngcontent-%COMP%], \n.loading-state[_ngcontent-%COMP%] {\n  text-align: center;\n  padding: 2rem;\n  color: var(--text-muted, #94a3b8);\n}\n.loading-overlay[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.75rem;\n  padding: 1.5rem;\n  background: rgba(6, 182, 212, 0.1);\n  border: 1px solid rgba(6, 182, 212, 0.2);\n  border-radius: 1rem;\n  margin-bottom: 1rem;\n  color: var(--primary, #06b6d4);\n}\n.loading-overlay[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%] {\n  width: 24px;\n  height: 24px;\n  border: 3px solid rgba(6, 182, 212, 0.3);\n  border-top-color: #06b6d4;\n  border-radius: 50%;\n  animation: _ngcontent-%COMP%_spin 0.8s linear infinite;\n}\n.error-alert[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 1rem 1.25rem;\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  border-radius: 0.5rem;\n  color: #fca5a5;\n  margin-bottom: 1rem;\n}\n.error-icon[_ngcontent-%COMP%] {\n  font-size: 1.25rem;\n}\n.retry-btn[_ngcontent-%COMP%] {\n  margin-left: auto;\n  padding: 0.375rem 0.75rem;\n  background: rgba(239, 68, 68, 0.2);\n  border: 1px solid rgba(239, 68, 68, 0.4);\n  border-radius: 0.375rem;\n  color: #fca5a5;\n  font-size: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.retry-btn[_ngcontent-%COMP%]:hover {\n  background: rgba(239, 68, 68, 0.3);\n}\n/*# sourceMappingURL=profile.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(ProfileComponent, [{
    type: Component,
    args: [{ selector: "app-profile", standalone: true, imports: [CommonModule, FormsModule], template: `
    <div class="profile-container">
      <!-- \u{1F527} \u52A0\u8F09\u4E2D\u72C0\u614B -->
      @if (isLoadingUser()) {
        <div class="loading-overlay">
          <div class="loading-spinner"></div>
          <span>\u6B63\u5728\u52A0\u8F09\u7528\u6236\u4FE1\u606F...</span>
        </div>
      }
      
      <!-- \u{1F527} \u932F\u8AA4\u63D0\u793A -->
      @if (userLoadError()) {
        <div class="error-alert">
          <span class="error-icon">\u26A0\uFE0F</span>
          <span>{{ userLoadError() }}</span>
          <button class="retry-btn" (click)="ensureUserLoaded()">\u91CD\u8A66</button>
        </div>
      }
      
      <!-- \u7528\u6236\u982D\u90E8\u4FE1\u606F -->
      <div class="profile-header">
        <div class="avatar-section">
          <div class="avatar">
            {{ user()?.username?.charAt(0).toUpperCase() || user()?.display_name?.charAt(0).toUpperCase() || '?' }}
          </div>
          <div class="user-info">
            <h2 class="username">{{ user()?.display_name || user()?.username || (isLoadingUser() ? '\u8F09\u5165\u4E2D...' : '\u672A\u767B\u5165') }}</h2>
            <p class="email">{{ user()?.email || '\u672A\u8A2D\u7F6E\u90F5\u7BB1' }}</p>
            <div class="membership-badge" [class]="'level-' + membershipLevel()">
              {{ getMembershipIcon() }} {{ getMembershipName() }}
              @if (membershipDaysLeft() > 0) {
                <span class="expires">\xB7 \u5269\u9918 {{ membershipDaysLeft() }} \u5929</span>
              }
            </div>
          </div>
        </div>
        <button (click)="onLogout()" class="logout-btn" [disabled]="isLoggingOut()">
          @if (isLoggingOut()) {
            <span class="logout-spinner"></span> \u9000\u51FA\u4E2D...
          } @else {
            \u{1F6AA} \u9000\u51FA
          }
        </button>
      </div>
      
      <!-- \u6A19\u7C64\u5C0E\u822A -->
      <div class="tabs">
        <button 
          (click)="activeTab.set('account')"
          [class.active]="activeTab() === 'account'"
          class="tab-btn">
          \u{1F464} \u5E33\u865F\u4FE1\u606F
        </button>
        <button 
          (click)="activeTab.set('license')"
          [class.active]="activeTab() === 'license'"
          class="tab-btn">
          \u{1F511} \u5361\u5BC6\u7BA1\u7406
        </button>
        <button 
          (click)="activeTab.set('devices')"
          [class.active]="activeTab() === 'devices'"
          class="tab-btn">
          \u{1F4BB} \u8A2D\u5099\u7BA1\u7406
        </button>
        <button 
          (click)="activeTab.set('usage')"
          [class.active]="activeTab() === 'usage'"
          class="tab-btn">
          \u{1F4CA} \u4F7F\u7528\u7D71\u8A08
        </button>
        <button 
          (click)="activeTab.set('invite')"
          [class.active]="activeTab() === 'invite'"
          class="tab-btn">
          \u{1F381} \u9080\u8ACB\u734E\u52F5
        </button>
      </div>
      
      <!-- \u5E33\u865F\u4FE1\u606F -->
      @if (activeTab() === 'account') {
        <div class="tab-content">
          <div class="section-card">
            <h3 class="section-title">\u{1F4CB} \u57FA\u672C\u4FE1\u606F</h3>
            
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">\u7528\u6236\u540D</span>
                <span class="info-value">{{ user()?.username }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">\u90F5\u7BB1</span>
                <span class="info-value">{{ user()?.email || '\u672A\u8A2D\u7F6E' }}</span>
                <button class="edit-btn">\u7DE8\u8F2F</button>
              </div>
              <div class="info-item">
                <span class="info-label">\u8A3B\u518A\u6642\u9593</span>
                <span class="info-value">{{ formatDate(user()?.createdAt) }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">\u6700\u5F8C\u767B\u5165</span>
                <span class="info-value">{{ formatDate(user()?.lastLogin) }}</span>
              </div>
            </div>
          </div>
          
          <div class="section-card">
            <h3 class="section-title">\u{1F510} \u5B89\u5168\u8A2D\u7F6E</h3>
            
            <div class="security-actions">
              <button (click)="showChangePassword.set(true)" class="action-btn">
                \u{1F511} \u4FEE\u6539\u5BC6\u78BC
              </button>
              <button class="action-btn">
                \u{1F4F1} \u5169\u6B65\u9A57\u8B49
              </button>
            </div>
            
            @if (showChangePassword()) {
              <div class="change-password-form">
                <div class="form-group">
                  <label>\u7576\u524D\u5BC6\u78BC</label>
                  <input type="password" [(ngModel)]="passwordForm.oldPassword" class="form-input">
                </div>
                <div class="form-group">
                  <label>\u65B0\u5BC6\u78BC</label>
                  <input type="password" [(ngModel)]="passwordForm.newPassword" class="form-input">
                </div>
                <div class="form-group">
                  <label>\u78BA\u8A8D\u65B0\u5BC6\u78BC</label>
                  <input type="password" [(ngModel)]="passwordForm.confirmPassword" class="form-input">
                </div>
                <div class="form-actions">
                  <button (click)="showChangePassword.set(false)" class="cancel-btn">\u53D6\u6D88</button>
                  <button (click)="onChangePassword()" class="submit-btn">\u78BA\u8A8D\u4FEE\u6539</button>
                </div>
              </div>
            }
          </div>
        </div>
      }
      
      <!-- \u5361\u5BC6\u7BA1\u7406 -->
      @if (activeTab() === 'license') {
        <div class="tab-content">
          <div class="section-card">
            <h3 class="section-title">\u{1F3AB} \u6FC0\u6D3B\u65B0\u5361\u5BC6</h3>
            
            <div class="license-input-group">
              <input 
                type="text" 
                [(ngModel)]="newLicenseKey" 
                class="form-input font-mono"
                placeholder="XXXX-XXXX-XXXX-XXXX">
              <button (click)="onActivateLicense()" [disabled]="!newLicenseKey" class="activate-btn">
                \u6FC0\u6D3B
              </button>
            </div>
            <p class="hint-text">\u8F38\u5165\u8CFC\u8CB7\u7684\u5361\u5BC6\u4EE5\u7E8C\u8CBB\u6216\u5347\u7D1A\u6703\u54E1</p>
          </div>
          
          <div class="section-card">
            <h3 class="section-title">\u{1F4DC} \u6FC0\u6D3B\u8A18\u9304</h3>
            
            <div class="license-history">
              @if (isLoadingHistory()) {
                <div class="loading-state">\u8F09\u5165\u4E2D...</div>
              } @else if (activationHistory().length === 0) {
                <div class="empty-state">\u66AB\u7121\u6FC0\u6D3B\u8A18\u9304</div>
              } @else {
                @for (record of activationHistory(); track record.id) {
                  <div class="history-item">
                    <div class="history-info">
                      <span class="license-code">{{ formatLicenseKey(record.license_key) }}</span>
                      <span class="license-type">{{ record.level_icon }} {{ record.level_name }} {{ record.duration_name }}</span>
                    </div>
                    <div class="history-meta">
                      <span>{{ formatActivationDate(record.activated_at) }} \u6FC0\u6D3B</span>
                      <span class="status" [class.active]="record.is_active" [class.used]="!record.is_active">
                        {{ record.is_active ? '\u6709\u6548' : '\u5DF2\u904E\u671F' }}
                      </span>
                    </div>
                  </div>
                }
              }
            </div>
          </div>
          
          <div class="section-card">
            <h3 class="section-title">\u{1F6D2} \u8CFC\u8CB7\u5361\u5BC6\uFF08\u738B\u8005\u69AE\u8000\u7B49\u7D1A\uFF09</h3>
            
            <div class="purchase-options">
              <div class="purchase-card silver">
                <div class="plan-name">\u{1F948} \u767D\u9280\u7CBE\u82F1</div>
                <div class="plan-price">4.99 USDT/\u6708</div>
                <ul class="plan-features">
                  <li>5 \u500B\u5E33\u865F</li>
                  <li>\u6BCF\u65E5 100 \u689D\u6D88\u606F</li>
                  <li>\u6BCF\u65E5 50 \u6B21 AI</li>
                  <li>10 \u500B\u7FA4\u7D44</li>
                </ul>
                <button class="buy-btn">\u8CFC\u8CB7</button>
              </div>
              
              <div class="purchase-card gold">
                <div class="plan-name">\u{1F947} \u9EC3\u91D1\u5927\u5E2B</div>
                <div class="plan-price">19.9 USDT/\u6708</div>
                <div class="recommended">\u63A8\u85A6</div>
                <ul class="plan-features">
                  <li>15 \u500B\u5E33\u865F</li>
                  <li>\u6BCF\u65E5 500 \u689D\u6D88\u606F</li>
                  <li>\u6BCF\u65E5 300 \u6B21 AI</li>
                  <li>\u6279\u91CF\u64CD\u4F5C</li>
                </ul>
                <button class="buy-btn">\u8CFC\u8CB7</button>
              </div>
              
              <div class="purchase-card diamond">
                <div class="plan-name">\u{1F48E} \u947D\u77F3\u738B\u724C</div>
                <div class="plan-price">59.9 USDT/\u6708</div>
                <ul class="plan-features">
                  <li>50 \u500B\u5E33\u865F</li>
                  <li>\u6BCF\u65E5 2000 \u689D\u6D88\u606F</li>
                  <li>\u7121\u9650 AI \u8ABF\u7528</li>
                  <li>AI \u92B7\u552E\u6F0F\u6597</li>
                </ul>
                <button class="buy-btn">\u8CFC\u8CB7</button>
              </div>
              
              <div class="purchase-card star">
                <div class="plan-name">\u{1F31F} \u661F\u8000\u50B3\u8AAA</div>
                <div class="plan-price">199 USDT/\u6708</div>
                <ul class="plan-features">
                  <li>100 \u500B\u5E33\u865F</li>
                  <li>\u7121\u9650\u6D88\u606F</li>
                  <li>\u5718\u968A\u7BA1\u7406</li>
                  <li>\u667A\u80FD\u9632\u5C01</li>
                </ul>
                <button class="buy-btn">\u8CFC\u8CB7</button>
              </div>
              
              <div class="purchase-card king">
                <div class="plan-name">\u{1F451} \u69AE\u8000\u738B\u8005</div>
                <div class="plan-price">599 USDT/\u6708</div>
                <ul class="plan-features">
                  <li>\u7121\u9650\u5E33\u865F</li>
                  <li>\u7121\u9650\u4E00\u5207</li>
                  <li>API \u63A5\u53E3</li>
                  <li>\u5C08\u5C6C\u9867\u554F</li>
                </ul>
                <button class="buy-btn">\u8CFC\u8CB7</button>
              </div>
            </div>
          </div>
        </div>
      }
      
      <!-- \u8A2D\u5099\u7BA1\u7406 -->
      @if (activeTab() === 'devices') {
        <div class="tab-content">
          <div class="section-card">
            <h3 class="section-title">\u{1F4BB} \u5DF2\u7D81\u5B9A\u8A2D\u5099</h3>
            <p class="section-desc">
              \u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u6700\u591A\u53EF\u7D81\u5B9A {{ getMaxDevices() }} \u53F0\u8A2D\u5099\uFF0C\u5DF2\u4F7F\u7528 {{ devices().length }} \u53F0
            </p>
            
            <div class="device-list">
              @for (device of devices(); track device.id) {
                <div class="device-item" [class.current]="device.isCurrent">
                  <div class="device-icon">
                    {{ getDeviceIcon(device) }}
                  </div>
                  <div class="device-info">
                    <div class="device-name">
                      {{ device.deviceName }}
                      @if (device.isCurrent) {
                        <span class="current-badge">\u672C\u6A5F</span>
                      }
                    </div>
                    <div class="device-code">{{ device.deviceCode }}</div>
                    <div class="device-meta">
                      \u7D81\u5B9A\u65BC {{ formatDate(device.boundAt) }} \xB7 
                      \u6700\u5F8C\u6D3B\u52D5 {{ formatDate(device.lastSeen) }}
                    </div>
                  </div>
                  @if (!device.isCurrent) {
                    <button 
                      (click)="onUnbindDevice(device.id)" 
                      class="unbind-btn"
                      [disabled]="isUnbinding()">
                      \u89E3\u7D81
                    </button>
                  }
                </div>
              } @empty {
                <div class="empty-state">
                  \u66AB\u7121\u7D81\u5B9A\u8A2D\u5099\u8A18\u9304
                </div>
              }
            </div>
          </div>
          
          <div class="section-card">
            <h3 class="section-title">\u{1F4F1} \u7576\u524D\u8A2D\u5099</h3>
            
            <div class="current-device-info">
              <div class="info-row">
                <span class="label">\u8A2D\u5099\u78BC</span>
                <span class="value font-mono">{{ currentDeviceCode() }}</span>
                <button (click)="copyDeviceCode()" class="copy-btn">\u{1F4CB}</button>
              </div>
              <div class="info-row">
                <span class="label">\u8A2D\u5099\u540D\u7A31</span>
                <span class="value">{{ currentDeviceName() }}</span>
              </div>
            </div>
          </div>
        </div>
      }
      
      <!-- \u4F7F\u7528\u7D71\u8A08 -->
      @if (activeTab() === 'usage') {
        <div class="tab-content">
          <div class="section-card">
            <h3 class="section-title">\u{1F4CA} \u672C\u6708\u4F7F\u7528\u60C5\u6CC1</h3>
            
            @if (usageStats()) {
              <div class="usage-grid">
                <div class="usage-item">
                  <div class="usage-icon">\u{1F916}</div>
                  <div class="usage-info">
                    <div class="usage-label">AI \u8ABF\u7528</div>
                    <div class="usage-bar">
                      <div 
                        class="usage-fill" 
                        [style.width.%]="getUsagePercent(usageStats()!.aiCalls)">
                      </div>
                    </div>
                    <div class="usage-text">
                      {{ usageStats()!.aiCalls.used }} / {{ usageStats()!.aiCalls.limit }} \u6B21
                    </div>
                  </div>
                </div>
                
                <div class="usage-item">
                  <div class="usage-icon">\u{1F4E8}</div>
                  <div class="usage-info">
                    <div class="usage-label">\u6D88\u606F\u767C\u9001</div>
                    <div class="usage-bar">
                      <div 
                        class="usage-fill" 
                        [style.width.%]="getUsagePercent(usageStats()!.messagesSent)">
                      </div>
                    </div>
                    <div class="usage-text">
                      {{ usageStats()!.messagesSent.used }} / {{ usageStats()!.messagesSent.limit }} \u689D
                    </div>
                  </div>
                </div>
                
                <div class="usage-item">
                  <div class="usage-icon">\u{1F465}</div>
                  <div class="usage-info">
                    <div class="usage-label">\u5E33\u865F\u6578\u91CF</div>
                    <div class="usage-bar">
                      <div 
                        class="usage-fill" 
                        [style.width.%]="getUsagePercent(usageStats()!.accounts)">
                      </div>
                    </div>
                    <div class="usage-text">
                      {{ usageStats()!.accounts.used }} / {{ usageStats()!.accounts.limit }} \u500B
                    </div>
                  </div>
                </div>
                
                <div class="usage-item">
                  <div class="usage-icon">\u{1F4BE}</div>
                  <div class="usage-info">
                    <div class="usage-label">\u5B58\u5132\u7A7A\u9593</div>
                    <div class="usage-bar">
                      <div 
                        class="usage-fill" 
                        [style.width.%]="getUsagePercent(usageStats()!.storage)">
                      </div>
                    </div>
                    <div class="usage-text">
                      {{ usageStats()!.storage.used }} / {{ usageStats()!.storage.limit }} MB
                    </div>
                  </div>
                </div>
              </div>
            } @else {
              <div class="loading-state">\u8F09\u5165\u4E2D...</div>
            }
          </div>
          
          <div class="section-card">
            <h3 class="section-title">\u{1F4C8} \u6B77\u53F2\u8DA8\u52E2</h3>
            <p class="section-desc">\u656C\u8ACB\u671F\u5F85...</p>
          </div>
        </div>
      }
      
      <!-- \u9080\u8ACB\u734E\u52F5 -->
      @if (activeTab() === 'invite') {
        <div class="tab-content">
          <div class="section-card highlight">
            <h3 class="section-title">\u{1F381} \u9080\u8ACB\u597D\u53CB\u5F97\u734E\u52F5</h3>
            <p class="section-desc">
              \u6BCF\u9080\u8ACB 1 \u4F4D\u597D\u53CB\u8A3B\u518A\u4E26\u6FC0\u6D3B\uFF0C\u60A8\u5C07\u7372\u5F97 <strong>3 \u5929\u767D\u9280\u7CBE\u82F1</strong> \u734E\u52F5\uFF01
            </p>
            
            <div class="invite-code-box">
              <span class="invite-label">\u6211\u7684\u9080\u8ACB\u78BC</span>
              <div class="invite-code">{{ inviteCode() }}</div>
              <button (click)="copyInviteCode()" class="copy-btn">
                \u{1F4CB} \u8907\u88FD
              </button>
            </div>
            
            <div class="invite-link-box">
              <span class="invite-label">\u9080\u8ACB\u93C8\u63A5</span>
              <input type="text" [value]="inviteLink()" readonly class="invite-link-input">
              <button (click)="copyInviteLink()" class="copy-btn">
                \u{1F4CB} \u8907\u88FD
              </button>
            </div>
          </div>
          
          <div class="section-card">
            <h3 class="section-title">\u{1F4CA} \u9080\u8ACB\u7D71\u8A08</h3>
            
            <div class="invite-stats">
              <div class="stat-item">
                <div class="stat-value">{{ invitedCount() }}</div>
                <div class="stat-label">\u5DF2\u9080\u8ACB\u4EBA\u6578</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">{{ rewardDays() }}</div>
                <div class="stat-label">\u7372\u5F97\u734E\u52F5\u5929\u6578</div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  `, styles: ["/* angular:styles/component:css;292e3c2b0ebd9c5a673e446e4e9ea2592f5852b6be40c4e5935f21a0a574d786;D:/tgkz2026/src/profile.component.ts */\n.profile-container {\n  padding: 1.5rem;\n  max-width: 900px;\n  margin: 0 auto;\n}\n.profile-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      rgba(6, 182, 212, 0.1),\n      rgba(59, 130, 246, 0.1));\n  border: 1px solid rgba(6, 182, 212, 0.2);\n  border-radius: 1rem;\n  margin-bottom: 1.5rem;\n}\n.avatar-section {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.avatar {\n  width: 64px;\n  height: 64px;\n  border-radius: 50%;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.5rem;\n  font-weight: bold;\n  color: white;\n}\n.username {\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n  margin: 0;\n}\n.email {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n  margin: 0.25rem 0;\n}\n.membership-badge {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding: 0.25rem 0.75rem;\n  border-radius: 1rem;\n  font-size: 0.75rem;\n  font-weight: 500;\n}\n.membership-badge.level-bronze {\n  background:\n    linear-gradient(\n      135deg,\n      #CD7F32,\n      #8B4513);\n  color: white;\n}\n.membership-badge.level-silver {\n  background:\n    linear-gradient(\n      135deg,\n      #C0C0C0,\n      #A8A8A8);\n  color: #1e293b;\n}\n.membership-badge.level-gold {\n  background:\n    linear-gradient(\n      135deg,\n      #FFD700,\n      #FFA500);\n  color: #1e293b;\n}\n.membership-badge.level-diamond {\n  background:\n    linear-gradient(\n      135deg,\n      #B9F2FF,\n      #06b6d4);\n  color: #1e293b;\n}\n.membership-badge.level-star {\n  background:\n    linear-gradient(\n      135deg,\n      #9B59B6,\n      #8E44AD);\n  color: white;\n}\n.membership-badge.level-king {\n  background:\n    linear-gradient(\n      135deg,\n      #FF6B6B,\n      #ee5a5a);\n  color: white;\n}\n.expires {\n  opacity: 0.8;\n}\n.logout-btn {\n  padding: 0.5rem 1rem;\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  border-radius: 0.5rem;\n  color: #fca5a5;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.logout-btn:hover:not(:disabled) {\n  background: rgba(239, 68, 68, 0.2);\n}\n.logout-btn:disabled {\n  opacity: 0.7;\n  cursor: not-allowed;\n}\n.logout-spinner {\n  display: inline-block;\n  width: 14px;\n  height: 14px;\n  border: 2px solid rgba(239, 68, 68, 0.3);\n  border-top-color: #ef4444;\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n.tabs {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 1.5rem;\n  flex-wrap: wrap;\n}\n.tab-btn {\n  padding: 0.5rem 1rem;\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 0.5rem;\n  color: var(--text-secondary, #94a3b8);\n  cursor: pointer;\n  transition: all 0.2s;\n  font-size: 0.875rem;\n}\n.tab-btn:hover {\n  border-color: var(--primary, #06b6d4);\n  color: var(--text-primary, white);\n}\n.tab-btn.active {\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border-color: transparent;\n  color: white;\n}\n.section-card {\n  background: var(--bg-card, rgba(30, 41, 59, 0.8));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 1rem;\n  padding: 1.5rem;\n  margin-bottom: 1rem;\n}\n.section-card.highlight {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(6, 182, 212, 0.1),\n      rgba(59, 130, 246, 0.1));\n  border-color: rgba(6, 182, 212, 0.3);\n}\n.section-title {\n  font-size: 1rem;\n  font-weight: 600;\n  color: var(--text-primary, white);\n  margin: 0 0 1rem 0;\n}\n.section-desc {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n  margin-bottom: 1rem;\n}\n.info-grid {\n  display: grid;\n  gap: 1rem;\n}\n.info-item {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.5rem;\n}\n.info-label {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n  min-width: 80px;\n}\n.info-value {\n  color: var(--text-primary, white);\n  flex: 1;\n}\n.edit-btn,\n.copy-btn {\n  padding: 0.25rem 0.5rem;\n  background: transparent;\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.25rem;\n  color: var(--text-muted, #94a3b8);\n  cursor: pointer;\n  font-size: 0.75rem;\n}\n.edit-btn:hover,\n.copy-btn:hover {\n  border-color: var(--primary, #06b6d4);\n  color: var(--primary, #06b6d4);\n}\n.form-group {\n  margin-bottom: 1rem;\n}\n.form-group label {\n  display: block;\n  color: var(--text-secondary, #cbd5e1);\n  font-size: 0.875rem;\n  margin-bottom: 0.5rem;\n}\n.form-input {\n  width: 100%;\n  padding: 0.75rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.2));\n  border-radius: 0.5rem;\n  color: var(--text-primary, white);\n  font-size: 0.875rem;\n}\n.form-input:focus {\n  outline: none;\n  border-color: var(--primary, #06b6d4);\n}\n.device-list {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n.device-item {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n  border-radius: 0.75rem;\n}\n.device-item.current {\n  border-color: var(--primary, #06b6d4);\n  background: rgba(6, 182, 212, 0.1);\n}\n.device-icon {\n  font-size: 1.5rem;\n}\n.device-info {\n  flex: 1;\n}\n.device-name {\n  font-weight: 500;\n  color: var(--text-primary, white);\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.current-badge {\n  font-size: 0.625rem;\n  padding: 0.125rem 0.375rem;\n  background: var(--primary, #06b6d4);\n  border-radius: 0.25rem;\n  color: white;\n}\n.device-code {\n  font-family: monospace;\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n}\n.device-meta {\n  font-size: 0.75rem;\n  color: var(--text-muted, #64748b);\n  margin-top: 0.25rem;\n}\n.unbind-btn {\n  padding: 0.375rem 0.75rem;\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  border-radius: 0.375rem;\n  color: #fca5a5;\n  cursor: pointer;\n  font-size: 0.75rem;\n}\n.usage-grid {\n  display: grid;\n  gap: 1rem;\n}\n.usage-item {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.75rem;\n}\n.usage-icon {\n  font-size: 1.5rem;\n}\n.usage-info {\n  flex: 1;\n}\n.usage-label {\n  color: var(--text-secondary, #cbd5e1);\n  font-size: 0.875rem;\n  margin-bottom: 0.5rem;\n}\n.usage-bar {\n  height: 8px;\n  background: var(--bg-primary, #0f172a);\n  border-radius: 4px;\n  overflow: hidden;\n}\n.usage-fill {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #06b6d4,\n      #3b82f6);\n  border-radius: 4px;\n  transition: width 0.3s;\n}\n.usage-text {\n  font-size: 0.75rem;\n  color: var(--text-muted, #94a3b8);\n  margin-top: 0.25rem;\n}\n.invite-code-box,\n.invite-link-box {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n  background: var(--bg-tertiary, rgba(15, 23, 42, 0.5));\n  border-radius: 0.75rem;\n  margin-bottom: 1rem;\n}\n.invite-label {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n  min-width: 80px;\n}\n.invite-code {\n  font-family: monospace;\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: var(--primary, #06b6d4);\n  flex: 1;\n}\n.invite-link-input {\n  flex: 1;\n  padding: 0.5rem;\n  background: transparent;\n  border: none;\n  color: var(--text-secondary, #cbd5e1);\n  font-size: 0.875rem;\n}\n.invite-stats {\n  display: flex;\n  gap: 2rem;\n  justify-content: center;\n  padding: 1rem;\n}\n.stat-item {\n  text-align: center;\n}\n.stat-value {\n  font-size: 2rem;\n  font-weight: bold;\n  color: var(--primary, #06b6d4);\n}\n.stat-label {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n}\n.purchase-options {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 1rem;\n}\n.purchase-card {\n  padding: 1.5rem;\n  border-radius: 1rem;\n  text-align: center;\n  border: 1px solid var(--border-default, rgba(148, 163, 184, 0.1));\n}\n.purchase-card.silver {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(192, 192, 192, 0.1),\n      rgba(168, 168, 168, 0.1));\n  border-color: rgba(192, 192, 192, 0.3);\n}\n.purchase-card.gold {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(255, 215, 0, 0.1),\n      rgba(255, 165, 0, 0.1));\n  border-color: rgba(255, 215, 0, 0.3);\n}\n.purchase-card.diamond {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(6, 182, 212, 0.15),\n      rgba(185, 242, 255, 0.1));\n  border-color: rgba(6, 182, 212, 0.4);\n}\n.purchase-card.star {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(155, 89, 182, 0.1),\n      rgba(142, 68, 173, 0.1));\n  border-color: rgba(155, 89, 182, 0.3);\n}\n.purchase-card.king {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(255, 107, 107, 0.15),\n      rgba(238, 90, 90, 0.1));\n  border-color: rgba(255, 107, 107, 0.4);\n}\n.recommended {\n  position: absolute;\n  top: -8px;\n  right: -8px;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  color: white;\n  font-size: 0.625rem;\n  padding: 0.125rem 0.5rem;\n  border-radius: 0.25rem;\n  font-weight: 600;\n}\n.purchase-card {\n  position: relative;\n}\n.plan-name {\n  font-weight: 600;\n  color: var(--text-primary, white);\n  margin-bottom: 0.5rem;\n}\n.plan-price {\n  font-size: 1.5rem;\n  font-weight: bold;\n  color: var(--primary, #06b6d4);\n  margin-bottom: 1rem;\n}\n.plan-features {\n  list-style: none;\n  padding: 0;\n  margin: 0 0 1rem 0;\n  font-size: 0.875rem;\n  color: var(--text-secondary, #cbd5e1);\n}\n.plan-features li {\n  padding: 0.25rem 0;\n}\n.buy-btn {\n  padding: 0.5rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  cursor: pointer;\n  font-weight: 500;\n}\n.license-input-group {\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n}\n.license-input-group .form-input {\n  flex: 1;\n  font-family: monospace;\n}\n.activate-btn {\n  padding: 0.75rem 1.5rem;\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e,\n      #16a34a);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  white-space: nowrap;\n}\n.activate-btn:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);\n}\n.activate-btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.hint-text {\n  color: var(--text-muted, #94a3b8);\n  font-size: 0.875rem;\n  margin-top: 0.5rem;\n}\n.empty-state,\n.loading-state {\n  text-align: center;\n  padding: 2rem;\n  color: var(--text-muted, #94a3b8);\n}\n.loading-overlay {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.75rem;\n  padding: 1.5rem;\n  background: rgba(6, 182, 212, 0.1);\n  border: 1px solid rgba(6, 182, 212, 0.2);\n  border-radius: 1rem;\n  margin-bottom: 1rem;\n  color: var(--primary, #06b6d4);\n}\n.loading-overlay .loading-spinner {\n  width: 24px;\n  height: 24px;\n  border: 3px solid rgba(6, 182, 212, 0.3);\n  border-top-color: #06b6d4;\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n.error-alert {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 1rem 1.25rem;\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  border-radius: 0.5rem;\n  color: #fca5a5;\n  margin-bottom: 1rem;\n}\n.error-icon {\n  font-size: 1.25rem;\n}\n.retry-btn {\n  margin-left: auto;\n  padding: 0.375rem 0.75rem;\n  background: rgba(239, 68, 68, 0.2);\n  border: 1px solid rgba(239, 68, 68, 0.4);\n  border-radius: 0.375rem;\n  color: #fca5a5;\n  font-size: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.retry-btn:hover {\n  background: rgba(239, 68, 68, 0.3);\n}\n/*# sourceMappingURL=profile.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(ProfileComponent, { className: "ProfileComponent", filePath: "src/profile.component.ts", lineNumber: 1037 });
})();

// src/manual-mode/resource-center.component.ts
var _forTrack016 = ($index, $item) => $item.id;
var _forTrack15 = ($index, $item) => $item.value;
var _forTrack23 = ($index, $item) => $item.telegram_id;
function ResourceCenterComponent_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "span", 45);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_8_Template_span_click_0_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.forceEndSync());
    });
    \u0275\u0275element(1, "span", 46);
    \u0275\u0275text(2, " \u540C\u6B65\u4E2D... (\u9EDE\u64CA\u53D6\u6D88) ");
    \u0275\u0275elementEnd();
  }
}
function ResourceCenterComponent_For_64_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 47);
    \u0275\u0275listener("click", function ResourceCenterComponent_For_64_Template_button_click_0_listener() {
      const tab_r4 = \u0275\u0275restoreView(_r3).$implicit;
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.switchTab(tab_r4.id));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const tab_r4 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275classProp("bg-purple-500", ctx_r1.activeTab() === tab_r4.id)("text-white", ctx_r1.activeTab() === tab_r4.id)("text-slate-400", ctx_r1.activeTab() !== tab_r4.id)("hover:text-white", ctx_r1.activeTab() !== tab_r4.id);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", tab_r4.icon, " ", tab_r4.label, " ");
  }
}
function ResourceCenterComponent_For_69_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "option", 33);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const status_r5 = ctx.$implicit;
    \u0275\u0275property("value", status_r5.value);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(status_r5.label);
  }
}
function ResourceCenterComponent_For_74_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "option", 33);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const tag_r6 = ctx.$implicit;
    \u0275\u0275property("value", tag_r6);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(tag_r6);
  }
}
function ResourceCenterComponent_Conditional_84_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 40)(1, "span", 48);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "button", 49);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_84_Template_button_click_3_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.showBatchTagDialog.set(true));
    });
    \u0275\u0275text(4, " \u6279\u91CF\u6A19\u8A18 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "button", 50);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_84_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.showBatchStatusDialog.set(true));
    });
    \u0275\u0275text(6, " \u66F4\u65B0\u72C0\u614B ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "button", 51);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_84_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.batchSendMessage());
    });
    \u0275\u0275text(8, " \u6279\u91CF\u767C\u9001 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "button", 52);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_84_Template_button_click_9_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.sendToAISales());
    });
    \u0275\u0275elementStart(10, "span");
    \u0275\u0275text(11, "\u{1F4E4}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(12, " \u52A0\u5165\u767C\u9001\u968A\u5217 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "button", 53);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_84_Template_button_click_13_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.confirmBatchDelete());
    });
    \u0275\u0275text(14, " \u522A\u9664 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "button", 54);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_84_Template_button_click_15_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.contactsService.clearSelection());
    });
    \u0275\u0275text(16, " \u53D6\u6D88\u9078\u64C7 ");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" \u5DF2\u9078\u64C7 ", ctx_r1.contactsService.selectedIds().size, " \u9805 ");
  }
}
function ResourceCenterComponent_Conditional_86_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 42);
    \u0275\u0275element(1, "div", 55);
    \u0275\u0275elementEnd();
  }
}
function ResourceCenterComponent_Conditional_87_Template(rf, ctx) {
  if (rf & 1) {
    const _r8 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 43)(1, "div", 56);
    \u0275\u0275text(2, "\u{1F4E6}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 57);
    \u0275\u0275text(4, "\u66AB\u7121\u8CC7\u6E90\u6578\u64DA");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 58);
    \u0275\u0275text(6, "\u9EDE\u64CA\u300C\u540C\u6B65\u6578\u64DA\u300D\u5F9E\u5404\u4F86\u6E90\u6574\u5408\u6578\u64DA");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "button", 39);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_87_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r8);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.syncData());
    });
    \u0275\u0275text(8, " \u540C\u6B65\u6578\u64DA ");
    \u0275\u0275elementEnd()();
  }
}
function ResourceCenterComponent_Conditional_88_For_22_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 73);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const contact_r11 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("@", contact_r11.username);
  }
}
function ResourceCenterComponent_Conditional_88_For_22_Conditional_20_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 78);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const contact_r11 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u{1F4CD} ", contact_r11.source_name, " ");
  }
}
function ResourceCenterComponent_Conditional_88_For_22_For_24_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 80);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const tag_r12 = ctx.$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", tag_r12, " ");
  }
}
function ResourceCenterComponent_Conditional_88_For_22_Conditional_25_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 81);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const contact_r11 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" +", contact_r11.tags.length - 2, " ");
  }
}
function ResourceCenterComponent_Conditional_88_For_22_Conditional_37_Template(rf, ctx) {
  if (rf & 1) {
    const _r13 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 90);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_88_For_22_Conditional_37_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r13);
      const contact_r11 = \u0275\u0275nextContext().$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.sendMessage(contact_r11));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(1, "svg", 10);
    \u0275\u0275element(2, "path", 91);
    \u0275\u0275elementEnd()();
  }
}
function ResourceCenterComponent_Conditional_88_For_22_Template(rf, ctx) {
  if (rf & 1) {
    const _r10 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "tr", 66)(1, "td", 65)(2, "input", 64);
    \u0275\u0275listener("change", function ResourceCenterComponent_Conditional_88_For_22_Template_input_change_2_listener() {
      const contact_r11 = \u0275\u0275restoreView(_r10).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.contactsService.toggleSelect(contact_r11.telegram_id));
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(3, "td", 65)(4, "div", 7)(5, "div", 71);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div")(8, "div", 72);
    \u0275\u0275text(9);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(10, ResourceCenterComponent_Conditional_88_For_22_Conditional_10_Template, 2, 1, "div", 73);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(11, "td", 65)(12, "span", 74);
    \u0275\u0275text(13);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(14, "td", 65)(15, "div", 75)(16, "span", 76);
    \u0275\u0275text(17);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "span", 77);
    \u0275\u0275text(19);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(20, ResourceCenterComponent_Conditional_88_For_22_Conditional_20_Template, 2, 1, "div", 78);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(21, "td", 65)(22, "div", 79);
    \u0275\u0275repeaterCreate(23, ResourceCenterComponent_Conditional_88_For_22_For_24_Template, 2, 1, "span", 80, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275conditionalCreate(25, ResourceCenterComponent_Conditional_88_For_22_Conditional_25_Template, 2, 1, "span", 81);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(26, "td", 65)(27, "span", 74);
    \u0275\u0275text(28);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(29, "td", 65)(30, "div", 68)(31, "div", 82);
    \u0275\u0275element(32, "div", 83);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(33, "span", 73);
    \u0275\u0275text(34);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(35, "td", 65)(36, "div", 68);
    \u0275\u0275conditionalCreate(37, ResourceCenterComponent_Conditional_88_For_22_Conditional_37_Template, 3, 0, "button", 84);
    \u0275\u0275elementStart(38, "button", 85);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_88_For_22_Template_button_click_38_listener() {
      const contact_r11 = \u0275\u0275restoreView(_r10).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.viewDetail(contact_r11));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(39, "svg", 10);
    \u0275\u0275element(40, "path", 86)(41, "path", 87);
    \u0275\u0275elementEnd()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(42, "button", 88);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_88_For_22_Template_button_click_42_listener() {
      const contact_r11 = \u0275\u0275restoreView(_r10).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.editContact(contact_r11));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(43, "svg", 10);
    \u0275\u0275element(44, "path", 89);
    \u0275\u0275elementEnd()()()()();
  }
  if (rf & 2) {
    const contact_r11 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(2);
    \u0275\u0275property("checked", ctx_r1.contactsService.selectedIds().has(contact_r11.telegram_id));
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate1(" ", ctx_r1.getInitial(contact_r11), " ");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(contact_r11.display_name);
    \u0275\u0275advance();
    \u0275\u0275conditional(contact_r11.username ? 10 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275classProp("bg-blue-500/20", contact_r11.contact_type === "user")("text-blue-400", contact_r11.contact_type === "user")("bg-green-500/20", contact_r11.contact_type === "group")("text-green-400", contact_r11.contact_type === "group")("bg-purple-500/20", contact_r11.contact_type === "channel")("text-purple-400", contact_r11.contact_type === "channel");
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.getTypeLabel(contact_r11.contact_type), " ");
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r1.getSourceIcon(contact_r11.source_type));
    \u0275\u0275advance();
    \u0275\u0275classMap(ctx_r1.getSourceColor(contact_r11.source_type));
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.getSourceLabel(contact_r11.source_type), " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(contact_r11.source_name ? 20 : -1);
    \u0275\u0275advance(3);
    \u0275\u0275repeater(contact_r11.tags.slice(0, 2));
    \u0275\u0275advance(2);
    \u0275\u0275conditional(contact_r11.tags.length > 2 ? 25 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275classMap(ctx_r1.contactsService.getStatusColor(contact_r11.status));
    \u0275\u0275classProp("text-white", true);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.contactsService.getStatusLabel(contact_r11.status), " ");
    \u0275\u0275advance(4);
    \u0275\u0275styleProp("width", contact_r11.ai_score * 100, "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate((contact_r11.ai_score * 100).toFixed(0));
    \u0275\u0275advance(3);
    \u0275\u0275conditional(contact_r11.contact_type === "user" ? 37 : -1);
  }
}
function ResourceCenterComponent_Conditional_88_Template(rf, ctx) {
  if (rf & 1) {
    const _r9 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 59)(1, "table", 60)(2, "thead", 61)(3, "tr", 62)(4, "th", 63)(5, "input", 64);
    \u0275\u0275listener("change", function ResourceCenterComponent_Conditional_88_Template_input_change_5_listener() {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.contactsService.toggleSelectAll());
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "th", 65);
    \u0275\u0275text(7, "\u540D\u7A31");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "th", 65);
    \u0275\u0275text(9, "\u985E\u578B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "th", 65);
    \u0275\u0275text(11, "\u4F86\u6E90");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "th", 65);
    \u0275\u0275text(13, "\u6A19\u7C64");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "th", 65);
    \u0275\u0275text(15, "\u72C0\u614B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "th", 65);
    \u0275\u0275text(17, "\u8A55\u5206");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "th", 65);
    \u0275\u0275text(19, "\u64CD\u4F5C");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(20, "tbody");
    \u0275\u0275repeaterCreate(21, ResourceCenterComponent_Conditional_88_For_22_Template, 45, 32, "tr", 66, _forTrack23);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(23, "div", 67)(24, "div");
    \u0275\u0275text(25);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(26, "div", 68)(27, "button", 69);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_88_Template_button_click_27_listener() {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.prevPage());
    });
    \u0275\u0275text(28, " \u4E0A\u4E00\u9801 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(29, "span", 70);
    \u0275\u0275text(30);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(31, "button", 69);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_88_Template_button_click_31_listener() {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.nextPage());
    });
    \u0275\u0275text(32, " \u4E0B\u4E00\u9801 ");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(5);
    \u0275\u0275property("checked", ctx_r1.isAllSelected());
    \u0275\u0275advance(16);
    \u0275\u0275repeater(ctx_r1.contactsService.contacts());
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate2(" \u986F\u793A ", ctx_r1.contactsService.contacts().length, " / ", ctx_r1.contactsService.total(), " \u689D ");
    \u0275\u0275advance(2);
    \u0275\u0275property("disabled", ctx_r1.currentPage() <= 1);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("\u7B2C ", ctx_r1.currentPage(), " \u9801");
    \u0275\u0275advance();
    \u0275\u0275property("disabled", !ctx_r1.hasNextPage());
  }
}
function ResourceCenterComponent_Conditional_89_For_6_Template(rf, ctx) {
  if (rf & 1) {
    const _r15 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "label", 95)(1, "input", 64);
    \u0275\u0275listener("change", function ResourceCenterComponent_Conditional_89_For_6_Template_input_change_1_listener() {
      const tag_r16 = \u0275\u0275restoreView(_r15).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.toggleBatchTag(tag_r16));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "span", 99);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const tag_r16 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275property("checked", ctx_r1.selectedBatchTags().has(tag_r16));
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(tag_r16);
  }
}
function ResourceCenterComponent_Conditional_89_Template(rf, ctx) {
  if (rf & 1) {
    const _r14 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 44)(1, "div", 92)(2, "h3", 93);
    \u0275\u0275text(3, "\u6279\u91CF\u6DFB\u52A0\u6A19\u7C64");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 94);
    \u0275\u0275repeaterCreate(5, ResourceCenterComponent_Conditional_89_For_6_Template, 4, 2, "label", 95, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div", 96)(8, "button", 97);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_89_Template_button_click_8_listener() {
      \u0275\u0275restoreView(_r14);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.showBatchTagDialog.set(false));
    });
    \u0275\u0275text(9, " \u53D6\u6D88 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "button", 98);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_89_Template_button_click_10_listener() {
      \u0275\u0275restoreView(_r14);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.applyBatchTags());
    });
    \u0275\u0275text(11, " \u61C9\u7528 ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(5);
    \u0275\u0275repeater(ctx_r1.defaultTags);
  }
}
function ResourceCenterComponent_Conditional_90_For_6_Template(rf, ctx) {
  if (rf & 1) {
    const _r18 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 103);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_90_For_6_Template_button_click_0_listener() {
      const status_r19 = \u0275\u0275restoreView(_r18).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.applyBatchStatus(status_r19.value));
    });
    \u0275\u0275element(1, "span", 104);
    \u0275\u0275elementStart(2, "span", 99);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const status_r19 = ctx.$implicit;
    \u0275\u0275advance();
    \u0275\u0275classMap(status_r19.color);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(status_r19.label);
  }
}
function ResourceCenterComponent_Conditional_90_Template(rf, ctx) {
  if (rf & 1) {
    const _r17 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 44)(1, "div", 92)(2, "h3", 93);
    \u0275\u0275text(3, "\u66F4\u65B0\u72C0\u614B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 100);
    \u0275\u0275repeaterCreate(5, ResourceCenterComponent_Conditional_90_For_6_Template, 4, 3, "button", 101, _forTrack15);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "button", 102);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_90_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r17);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.showBatchStatusDialog.set(false));
    });
    \u0275\u0275text(8, " \u53D6\u6D88 ");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(5);
    \u0275\u0275repeater(ctx_r1.statusOptions);
  }
}
function ResourceCenterComponent_Conditional_91_Template(rf, ctx) {
  if (rf & 1) {
    const _r20 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 44)(1, "div", 92)(2, "h3", 105);
    \u0275\u0275text(3, "\u26A0\uFE0F \u78BA\u8A8D\u522A\u9664");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "p", 106);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "div", 107)(7, "button", 97);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_91_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r20);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.showDeleteConfirm.set(false));
    });
    \u0275\u0275text(8, " \u53D6\u6D88 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "button", 108);
    \u0275\u0275listener("click", function ResourceCenterComponent_Conditional_91_Template_button_click_9_listener() {
      \u0275\u0275restoreView(_r20);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.confirmDelete());
    });
    \u0275\u0275text(10, " \u78BA\u8A8D\u522A\u9664 ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate1(" \u78BA\u5B9A\u8981\u522A\u9664\u9078\u4E2D\u7684 ", ctx_r1.contactsService.selectedIds().size, " \u500B\u806F\u7E6B\u4EBA\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002 ");
  }
}
var ResourceCenterComponent = class _ResourceCenterComponent {
  constructor() {
    this.contactsService = inject(UnifiedContactsService);
    this.toast = inject(ToastService);
    this.nav = inject(NavBridgeService);
    this.sendMessageEvent = output();
    this.viewDetailEvent = output();
    this.batchSendEvent = output();
    this.sendToAISalesEvent = output();
    this.statusChangedEvent = output();
    this.refreshDataEvent = output();
    this.tabs = [
      { id: "all", icon: "\u{1F4CA}", label: "\u5168\u90E8" },
      { id: "users", icon: "\u{1F464}", label: "\u6210\u54E1" },
      { id: "groups", icon: "\u{1F465}", label: "\u7FA4\u7D44" },
      { id: "channels", icon: "\u{1F4E2}", label: "\u983B\u9053" }
    ];
    this.statusOptions = STATUS_OPTIONS;
    this.defaultTags = DEFAULT_TAGS;
    this.activeTab = signal("all", ...ngDevMode ? [{ debugName: "activeTab" }] : []);
    this.selectedStatus = "";
    this.selectedTag = "";
    this.searchKeyword = "";
    this.pageSize = 50;
    this.currentPage = signal(1, ...ngDevMode ? [{ debugName: "currentPage" }] : []);
    this.showImportDialog = signal(false, ...ngDevMode ? [{ debugName: "showImportDialog" }] : []);
    this.showBatchTagDialog = signal(false, ...ngDevMode ? [{ debugName: "showBatchTagDialog" }] : []);
    this.showBatchStatusDialog = signal(false, ...ngDevMode ? [{ debugName: "showBatchStatusDialog" }] : []);
    this.showDeleteConfirm = signal(false, ...ngDevMode ? [{ debugName: "showDeleteConfirm" }] : []);
    this.selectedBatchTags = signal(/* @__PURE__ */ new Set(), ...ngDevMode ? [{ debugName: "selectedBatchTags" }] : []);
  }
  ngOnInit() {
    console.log("[ResourceCenter] Initialized, using imported leads data");
    console.log("[ResourceCenter] Current contacts:", this.contactsService.contacts().length);
    console.log("[ResourceCenter] Has imported data:", this.contactsService.hasData());
  }
  ngOnDestroy() {
    this.contactsService.forceEndSync();
  }
  // 強制結束同步和載入狀態
  forceEndSync() {
    this.contactsService.forceEndSync();
    this.toast.info("\u5DF2\u53D6\u6D88", 1500);
  }
  // Tab 切換
  switchTab(tab) {
    this.activeTab.set(tab);
    let contactType;
    switch (tab) {
      case "users":
        contactType = "user";
        break;
      case "groups":
        contactType = "group";
        break;
      case "channels":
        contactType = "channel";
        break;
      default:
        contactType = void 0;
    }
    this.contactsService.setFilter({ contactType, offset: 0 });
    this.currentPage.set(1);
  }
  // 同步數據 - 🔧 FIX: 直接調用後端同步
  syncData() {
    console.log("[ResourceCenter] ========== SYNC DATA CLICKED ==========");
    if (this.contactsService.isSyncing()) {
      console.log("[ResourceCenter] Already syncing, skip");
      this.toast.warning("\u6B63\u5728\u540C\u6B65\u4E2D\uFF0C\u8ACB\u7A0D\u5019...", 2e3);
      return;
    }
    console.log("[ResourceCenter] Calling syncFromSources()...");
    this.contactsService.syncFromSources();
    this.toast.info("\u{1F504} \u6B63\u5728\u540C\u6B65\u6578\u64DA\uFF0C\u8ACB\u7A0D\u5019...", 5e3);
    this.refreshDataEvent.emit();
  }
  // 搜索
  search() {
    this.contactsService.search(this.searchKeyword);
    this.currentPage.set(1);
  }
  // 狀態篩選
  filterByStatus(status) {
    this.contactsService.setFilter({
      status: status || void 0,
      offset: 0
    });
    this.currentPage.set(1);
  }
  // 標籤篩選
  filterByTag(tag) {
    this.contactsService.setFilter({
      tags: tag ? [tag] : void 0,
      offset: 0
    });
    this.currentPage.set(1);
  }
  // 重置篩選
  resetFilters() {
    this.selectedStatus = "";
    this.selectedTag = "";
    this.searchKeyword = "";
    this.activeTab.set("all");
    this.contactsService.resetFilter();
    this.currentPage.set(1);
  }
  // 分頁
  hasNextPage() {
    return this.currentPage() * this.pageSize < this.contactsService.total();
  }
  prevPage() {
    if (this.currentPage() > 1) {
      this.currentPage.update((p) => p - 1);
      this.contactsService.setPage(this.currentPage(), this.pageSize);
    }
  }
  nextPage() {
    if (this.hasNextPage()) {
      this.currentPage.update((p) => p + 1);
      this.contactsService.setPage(this.currentPage(), this.pageSize);
    }
  }
  // 全選檢查
  isAllSelected() {
    const contacts = this.contactsService.contacts();
    const selected = this.contactsService.selectedIds();
    return contacts.length > 0 && contacts.every((c) => selected.has(c.telegram_id));
  }
  // 發送消息
  sendMessage(contact) {
    this.sendMessageEvent.emit(contact);
  }
  // 查看詳情
  viewDetail(contact) {
    this.viewDetailEvent.emit(contact);
  }
  // 編輯聯繫人
  editContact(contact) {
    this.toast.info("\u7DE8\u8F2F\u529F\u80FD\u958B\u767C\u4E2D...", 2e3);
  }
  // 批量發送
  batchSendMessage() {
    const selected = this.contactsService.selectedContacts();
    const users = selected.filter((c) => c.contact_type === "user");
    if (users.length === 0) {
      this.toast.warning("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u7528\u6236", 2e3);
      return;
    }
    this.batchSendEvent.emit(users);
    this.toast.info(`\u6E96\u5099\u5411 ${users.length} \u500B\u7528\u6236\u767C\u9001\u6D88\u606F...`, 2e3);
  }
  // 加入 AI 銷售
  sendToAISales() {
    const selected = this.contactsService.selectedContacts();
    if (selected.length === 0) {
      this.toast.warning("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u806F\u7E6B\u4EBA", 2e3);
      return;
    }
    this.sendToAISalesEvent.emit(selected);
    this.toast.success(`\u5DF2\u5C07 ${selected.length} \u500B\u806F\u7E6B\u4EBA\u52A0\u5165\u767C\u9001\u968A\u5217`, 2e3);
    this.contactsService.clearSelection();
  }
  // 🆕 P1: 前往發送控制台
  goToSendConsole() {
    this.nav.navigateTo("leads");
  }
  // 批量標籤
  toggleBatchTag(tag) {
    const current = new Set(this.selectedBatchTags());
    if (current.has(tag)) {
      current.delete(tag);
    } else {
      current.add(tag);
    }
    this.selectedBatchTags.set(current);
  }
  applyBatchTags() {
    const tags = Array.from(this.selectedBatchTags());
    if (tags.length === 0) {
      this.toast.warning("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u6A19\u7C64", 2e3);
      return;
    }
    this.contactsService.addTagsToSelected(tags);
    this.showBatchTagDialog.set(false);
    this.selectedBatchTags.set(/* @__PURE__ */ new Set());
    this.toast.success("\u6A19\u7C64\u5DF2\u6DFB\u52A0", 2e3);
  }
  // 批量狀態
  applyBatchStatus(status) {
    const selectedContacts = this.contactsService.selectedContacts();
    this.contactsService.updateSelectedStatus(status);
    this.showBatchStatusDialog.set(false);
    this.toast.success("\u72C0\u614B\u5DF2\u66F4\u65B0", 2e3);
    if (selectedContacts.length > 0) {
      this.statusChangedEvent.emit({ contacts: selectedContacts, status });
    }
  }
  // 刪除確認
  confirmBatchDelete() {
    this.showDeleteConfirm.set(true);
  }
  confirmDelete() {
    this.contactsService.deleteSelected();
    this.showDeleteConfirm.set(false);
    this.toast.success("\u5DF2\u522A\u9664", 2e3);
  }
  // 導出
  exportData() {
    this.toast.info("\u5C0E\u51FA\u529F\u80FD\u958B\u767C\u4E2D...", 2e3);
  }
  // 輔助方法
  getInitial(contact) {
    if (contact.display_name) {
      return contact.display_name.charAt(0).toUpperCase();
    }
    return "?";
  }
  getTypeLabel(type) {
    switch (type) {
      case "user":
        return "\u6210\u54E1";
      case "group":
        return "\u7FA4\u7D44";
      case "channel":
        return "\u983B\u9053";
      default:
        return type;
    }
  }
  getSourceLabel(source) {
    switch (source) {
      case "member":
        return "\u7FA4\u7D44\u63D0\u53D6";
      case "resource":
        return "\u8CC7\u6E90\u767C\u73FE";
      case "lead":
        return "\u71DF\u92B7\u6F0F\u6597";
      // 🆕 發送控制台的 leads
      case "manual":
        return "\u624B\u52D5\u6DFB\u52A0";
      case "import":
        return "\u6279\u91CF\u5C0E\u5165";
      default:
        return source || "\u672A\u77E5";
    }
  }
  // 🆕 獲取來源圖標
  getSourceIcon(source) {
    switch (source) {
      case "member":
        return "\u{1F465}";
      case "resource":
        return "\u{1F50D}";
      case "lead":
        return "\u{1F3AF}";
      case "manual":
        return "\u270B";
      case "import":
        return "\u{1F4E5}";
      default:
        return "\u{1F4CB}";
    }
  }
  // 🆕 獲取來源顏色
  getSourceColor(source) {
    switch (source) {
      case "member":
        return "text-blue-400 bg-blue-500/20";
      case "resource":
        return "text-green-400 bg-green-500/20";
      case "lead":
        return "text-orange-400 bg-orange-500/20";
      case "manual":
        return "text-purple-400 bg-purple-500/20";
      case "import":
        return "text-cyan-400 bg-cyan-500/20";
      default:
        return "text-slate-400 bg-slate-500/20";
    }
  }
  static {
    this.\u0275fac = function ResourceCenterComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _ResourceCenterComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _ResourceCenterComponent, selectors: [["app-resource-center"]], outputs: { sendMessageEvent: "sendMessageEvent", viewDetailEvent: "viewDetailEvent", batchSendEvent: "batchSendEvent", sendToAISalesEvent: "sendToAISalesEvent", statusChangedEvent: "statusChangedEvent", refreshDataEvent: "refreshDataEvent" }, decls: 92, vars: 14, consts: [[1, "resource-center", "h-full", "flex", "flex-col", "bg-slate-900"], [1, "p-4", "border-b", "border-slate-700/50", "bg-slate-900/80", "backdrop-blur-sm"], [1, "flex", "items-center", "justify-between"], [1, "flex", "items-center", "gap-4"], [1, "text-2xl", "font-bold", "text-white", "flex", "items-center", "gap-3"], [1, "text-2xl"], ["title", "\u9EDE\u64CA\u5F37\u5236\u7D50\u675F\u540C\u6B65", 1, "flex", "items-center", "gap-2", "px-3", "py-1", "bg-blue-500/20", "text-blue-400", "rounded-full", "text-sm", "cursor-pointer", "hover:bg-blue-500/30"], [1, "flex", "items-center", "gap-3"], [1, "px-4", "py-2", "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "text-white", "rounded-lg", "hover:from-cyan-600", "hover:to-blue-600", "transition-colors", "flex", "items-center", "gap-2", 3, "click"], [1, "px-4", "py-2", "bg-blue-500/20", "text-blue-400", "rounded-lg", "hover:bg-blue-500/30", "transition-colors", "flex", "items-center", "gap-2", 3, "click", "disabled"], ["fill", "none", "viewBox", "0 0 24 24", "stroke", "currentColor", 1, "h-4", "w-4"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"], [1, "px-4", "py-2", "bg-slate-700", "text-slate-300", "rounded-lg", "hover:bg-slate-600", "transition-colors", 3, "click"], [1, "p-4", "border-b", "border-slate-700/30"], [1, "grid", "grid-cols-4", "gap-4"], [1, "bg-gradient-to-br", "from-slate-800/80", "to-slate-800/40", "rounded-xl", "p-4", "border", "border-slate-700/50"], [1, "text-slate-400", "text-sm", "mb-1"], [1, "text-3xl", "font-bold", "text-white"], [1, "text-4xl", "opacity-20"], [1, "bg-gradient-to-br", "from-emerald-900/30", "to-slate-800/40", "rounded-xl", "p-4", "border", "border-emerald-700/30"], [1, "text-emerald-400", "text-sm", "mb-1"], [1, "text-3xl", "font-bold", "text-emerald-400"], [1, "bg-gradient-to-br", "from-blue-900/30", "to-slate-800/40", "rounded-xl", "p-4", "border", "border-blue-700/30"], [1, "text-blue-400", "text-sm", "mb-1"], [1, "text-3xl", "font-bold", "text-blue-400"], [1, "bg-gradient-to-br", "from-yellow-900/30", "to-slate-800/40", "rounded-xl", "p-4", "border", "border-yellow-700/30"], [1, "text-yellow-400", "text-sm", "mb-1"], [1, "text-3xl", "font-bold", "text-yellow-400"], [1, "flex", "items-center", "gap-4", "flex-wrap"], [1, "flex", "bg-slate-800/50", "rounded-lg", "p-1"], [1, "px-4", "py-2", "rounded-md", "text-sm", "transition-all", 3, "bg-purple-500", "text-white", "text-slate-400", "hover:text-white"], [1, "px-3", "py-2", "bg-slate-800", "border", "border-slate-700", "rounded-lg", "text-white", "text-sm", 3, "ngModelChange", "ngModel"], ["value", ""], [3, "value"], [1, "flex-1", "max-w-md"], [1, "relative"], ["type", "text", "placeholder", "\u641C\u7D22\u540D\u7A31\u3001\u7528\u6236\u540D\u6216 ID...", 1, "w-full", "px-4", "py-2", "pl-10", "bg-slate-800", "border", "border-slate-700", "rounded-lg", "text-white", "placeholder-slate-500", 3, "ngModelChange", "keyup.enter", "ngModel"], ["fill", "none", "viewBox", "0 0 24 24", "stroke", "currentColor", 1, "absolute", "left-3", "top-1/2", "-translate-y-1/2", "h-4", "w-4", "text-slate-500"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"], [1, "px-4", "py-2", "bg-purple-500", "text-white", "rounded-lg", "hover:bg-purple-400", "transition-colors", 3, "click"], [1, "p-3", "bg-purple-500/10", "border-b", "border-purple-500/30", "flex", "items-center", "gap-4"], [1, "flex-1", "overflow-y-auto", "p-4"], [1, "flex", "items-center", "justify-center", "h-64"], [1, "flex", "flex-col", "items-center", "justify-center", "h-64", "text-slate-400"], [1, "fixed", "inset-0", "bg-black/60", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-50"], ["title", "\u9EDE\u64CA\u5F37\u5236\u7D50\u675F\u540C\u6B65", 1, "flex", "items-center", "gap-2", "px-3", "py-1", "bg-blue-500/20", "text-blue-400", "rounded-full", "text-sm", "cursor-pointer", "hover:bg-blue-500/30", 3, "click"], [1, "animate-spin", "h-4", "w-4", "border-2", "border-blue-400", "border-t-transparent", "rounded-full"], [1, "px-4", "py-2", "rounded-md", "text-sm", "transition-all", 3, "click"], [1, "text-purple-400", "text-sm"], [1, "px-3", "py-1.5", "bg-blue-500/20", "text-blue-400", "rounded-lg", "text-sm", "hover:bg-blue-500/30", 3, "click"], [1, "px-3", "py-1.5", "bg-green-500/20", "text-green-400", "rounded-lg", "text-sm", "hover:bg-green-500/30", 3, "click"], [1, "px-3", "py-1.5", "bg-purple-500/20", "text-purple-400", "rounded-lg", "text-sm", "hover:bg-purple-500/30", 3, "click"], [1, "px-3", "py-1.5", "bg-cyan-500/20", "text-cyan-400", "rounded-lg", "text-sm", "hover:bg-cyan-500/30", "flex", "items-center", "gap-1", 3, "click"], [1, "px-3", "py-1.5", "bg-red-500/20", "text-red-400", "rounded-lg", "text-sm", "hover:bg-red-500/30", 3, "click"], [1, "ml-auto", "px-3", "py-1.5", "text-slate-400", "text-sm", "hover:text-white", 3, "click"], [1, "animate-spin", "rounded-full", "h-12", "w-12", "border-t-2", "border-b-2", "border-purple-500"], [1, "text-5xl", "mb-4"], [1, "text-lg", "mb-2"], [1, "text-sm", "mb-4"], [1, "bg-slate-800/30", "rounded-xl", "border", "border-slate-700/50", "overflow-hidden"], [1, "w-full"], [1, "bg-slate-800/50"], [1, "text-left", "text-slate-400", "text-sm"], [1, "p-3", "w-12"], ["type", "checkbox", 1, "rounded", "bg-slate-700", "border-slate-600", 3, "change", "checked"], [1, "p-3"], [1, "border-t", "border-slate-700/30", "hover:bg-slate-800/30", "transition-colors"], [1, "flex", "items-center", "justify-between", "mt-4", "text-slate-400", "text-sm"], [1, "flex", "items-center", "gap-2"], [1, "px-3", "py-1.5", "bg-slate-800", "rounded-lg", "hover:bg-slate-700", "disabled:opacity-50", "disabled:cursor-not-allowed", 3, "click", "disabled"], [1, "px-4"], [1, "w-10", "h-10", "rounded-full", "bg-gradient-to-br", "from-purple-500", "to-pink-500", "flex", "items-center", "justify-center", "text-white", "font-bold"], [1, "font-medium", "text-white"], [1, "text-sm", "text-slate-400"], [1, "px-2", "py-1", "rounded-full", "text-xs"], [1, "flex", "items-center", "gap-1"], [1, "text-sm"], [1, "text-sm", "px-1.5", "py-0.5", "rounded"], [1, "text-xs", "text-slate-500", "truncate", "max-w-32", "mt-0.5"], [1, "flex", "flex-wrap", "gap-1"], [1, "px-2", "py-0.5", "bg-slate-700", "text-slate-300", "rounded", "text-xs"], [1, "px-2", "py-0.5", "bg-slate-700", "text-slate-400", "rounded", "text-xs"], [1, "w-16", "bg-slate-700", "rounded-full", "h-2"], [1, "bg-gradient-to-r", "from-purple-500", "to-pink-500", "h-2", "rounded-full"], ["title", "\u767C\u9001\u6D88\u606F", 1, "p-2", "text-blue-400", "hover:bg-blue-500/20", "rounded-lg", "transition-colors"], ["title", "\u67E5\u770B\u8A73\u60C5", 1, "p-2", "text-slate-400", "hover:bg-slate-700", "rounded-lg", "transition-colors", 3, "click"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M15 12a3 3 0 11-6 0 3 3 0 016 0z"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"], ["title", "\u7DE8\u8F2F", 1, "p-2", "text-slate-400", "hover:bg-slate-700", "rounded-lg", "transition-colors", 3, "click"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"], ["title", "\u767C\u9001\u6D88\u606F", 1, "p-2", "text-blue-400", "hover:bg-blue-500/20", "rounded-lg", "transition-colors", 3, "click"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"], [1, "bg-slate-800", "rounded-2xl", "w-full", "max-w-md", "p-6", "shadow-xl", "border", "border-slate-700"], [1, "text-xl", "font-bold", "text-white", "mb-4"], [1, "space-y-3", "max-h-64", "overflow-y-auto"], [1, "flex", "items-center", "gap-3", "p-2", "hover:bg-slate-700/50", "rounded-lg", "cursor-pointer"], [1, "flex", "gap-3", "mt-6"], [1, "flex-1", "py-2.5", "bg-slate-700", "text-slate-300", "rounded-lg", "hover:bg-slate-600", 3, "click"], [1, "flex-1", "py-2.5", "bg-purple-500", "text-white", "rounded-lg", "hover:bg-purple-400", 3, "click"], [1, "text-white"], [1, "space-y-2"], [1, "w-full", "p-3", "text-left", "rounded-lg", "hover:bg-slate-700/50", "flex", "items-center", "gap-3"], [1, "w-full", "mt-4", "py-2.5", "bg-slate-700", "text-slate-300", "rounded-lg", "hover:bg-slate-600", 3, "click"], [1, "w-full", "p-3", "text-left", "rounded-lg", "hover:bg-slate-700/50", "flex", "items-center", "gap-3", 3, "click"], [1, "w-3", "h-3", "rounded-full"], [1, "text-xl", "font-bold", "text-red-400", "mb-4"], [1, "text-slate-300", "mb-6"], [1, "flex", "gap-3"], [1, "flex-1", "py-2.5", "bg-red-500", "text-white", "rounded-lg", "hover:bg-red-400", 3, "click"]], template: function ResourceCenterComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0)(1, "div", 1)(2, "div", 2)(3, "div", 3)(4, "h1", 4)(5, "span", 5);
        \u0275\u0275text(6, "\u{1F4E6}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(7, " \u8CC7\u6E90\u4E2D\u5FC3 ");
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(8, ResourceCenterComponent_Conditional_8_Template, 3, 0, "span", 6);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(9, "div", 7)(10, "button", 8);
        \u0275\u0275listener("click", function ResourceCenterComponent_Template_button_click_10_listener() {
          return ctx.goToSendConsole();
        });
        \u0275\u0275elementStart(11, "span");
        \u0275\u0275text(12, "\u{1F4E4}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(13, " \u767C\u9001\u63A7\u5236\u53F0 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(14, "button", 9);
        \u0275\u0275listener("click", function ResourceCenterComponent_Template_button_click_14_listener() {
          return ctx.syncData();
        });
        \u0275\u0275namespaceSVG();
        \u0275\u0275elementStart(15, "svg", 10);
        \u0275\u0275element(16, "path", 11);
        \u0275\u0275elementEnd();
        \u0275\u0275text(17, " \u540C\u6B65\u6578\u64DA ");
        \u0275\u0275elementEnd();
        \u0275\u0275namespaceHTML();
        \u0275\u0275elementStart(18, "button", 12);
        \u0275\u0275listener("click", function ResourceCenterComponent_Template_button_click_18_listener() {
          return ctx.showImportDialog.set(true);
        });
        \u0275\u0275text(19, " \u5C0E\u5165 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(20, "button", 12);
        \u0275\u0275listener("click", function ResourceCenterComponent_Template_button_click_20_listener() {
          return ctx.exportData();
        });
        \u0275\u0275text(21, " \u5C0E\u51FA ");
        \u0275\u0275elementEnd()()()();
        \u0275\u0275elementStart(22, "div", 13)(23, "div", 14)(24, "div", 15)(25, "div", 2)(26, "div")(27, "div", 16);
        \u0275\u0275text(28, "\u{1F4CA} \u7E3D\u8CC7\u6E90");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(29, "div", 17);
        \u0275\u0275text(30);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(31, "div", 18);
        \u0275\u0275text(32, "\u{1F4E6}");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(33, "div", 19)(34, "div", 2)(35, "div")(36, "div", 20);
        \u0275\u0275text(37, "\u{1F195} \u672C\u9031\u65B0\u589E");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(38, "div", 21);
        \u0275\u0275text(39);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(40, "div", 18);
        \u0275\u0275text(41, "\u{1F4C8}");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(42, "div", 22)(43, "div", 2)(44, "div")(45, "div", 23);
        \u0275\u0275text(46, "\u{1F514} \u5F85\u8DDF\u9032");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(47, "div", 24);
        \u0275\u0275text(48);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(49, "div", 18);
        \u0275\u0275text(50, "\u{1F44B}");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(51, "div", 25)(52, "div", 2)(53, "div")(54, "div", 26);
        \u0275\u0275text(55, "\u{1F4AC} \u5DF2\u806F\u7E6B");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(56, "div", 27);
        \u0275\u0275text(57);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(58, "div", 18);
        \u0275\u0275text(59, "\u2709\uFE0F");
        \u0275\u0275elementEnd()()()()();
        \u0275\u0275elementStart(60, "div", 13)(61, "div", 28)(62, "div", 29);
        \u0275\u0275repeaterCreate(63, ResourceCenterComponent_For_64_Template, 2, 10, "button", 30, _forTrack016);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(65, "select", 31);
        \u0275\u0275twoWayListener("ngModelChange", function ResourceCenterComponent_Template_select_ngModelChange_65_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.selectedStatus, $event) || (ctx.selectedStatus = $event);
          return $event;
        });
        \u0275\u0275listener("ngModelChange", function ResourceCenterComponent_Template_select_ngModelChange_65_listener($event) {
          return ctx.filterByStatus($event);
        });
        \u0275\u0275elementStart(66, "option", 32);
        \u0275\u0275text(67, "\u6240\u6709\u72C0\u614B");
        \u0275\u0275elementEnd();
        \u0275\u0275repeaterCreate(68, ResourceCenterComponent_For_69_Template, 2, 2, "option", 33, _forTrack15);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(70, "select", 31);
        \u0275\u0275twoWayListener("ngModelChange", function ResourceCenterComponent_Template_select_ngModelChange_70_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.selectedTag, $event) || (ctx.selectedTag = $event);
          return $event;
        });
        \u0275\u0275listener("ngModelChange", function ResourceCenterComponent_Template_select_ngModelChange_70_listener($event) {
          return ctx.filterByTag($event);
        });
        \u0275\u0275elementStart(71, "option", 32);
        \u0275\u0275text(72, "\u6240\u6709\u6A19\u7C64");
        \u0275\u0275elementEnd();
        \u0275\u0275repeaterCreate(73, ResourceCenterComponent_For_74_Template, 2, 2, "option", 33, \u0275\u0275repeaterTrackByIdentity);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(75, "div", 34)(76, "div", 35)(77, "input", 36);
        \u0275\u0275twoWayListener("ngModelChange", function ResourceCenterComponent_Template_input_ngModelChange_77_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.searchKeyword, $event) || (ctx.searchKeyword = $event);
          return $event;
        });
        \u0275\u0275listener("keyup.enter", function ResourceCenterComponent_Template_input_keyup_enter_77_listener() {
          return ctx.search();
        });
        \u0275\u0275elementEnd();
        \u0275\u0275namespaceSVG();
        \u0275\u0275elementStart(78, "svg", 37);
        \u0275\u0275element(79, "path", 38);
        \u0275\u0275elementEnd()()();
        \u0275\u0275namespaceHTML();
        \u0275\u0275elementStart(80, "button", 39);
        \u0275\u0275listener("click", function ResourceCenterComponent_Template_button_click_80_listener() {
          return ctx.search();
        });
        \u0275\u0275text(81, " \u641C\u7D22 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(82, "button", 12);
        \u0275\u0275listener("click", function ResourceCenterComponent_Template_button_click_82_listener() {
          return ctx.resetFilters();
        });
        \u0275\u0275text(83, " \u91CD\u7F6E ");
        \u0275\u0275elementEnd()()();
        \u0275\u0275conditionalCreate(84, ResourceCenterComponent_Conditional_84_Template, 17, 1, "div", 40);
        \u0275\u0275elementStart(85, "div", 41);
        \u0275\u0275conditionalCreate(86, ResourceCenterComponent_Conditional_86_Template, 2, 0, "div", 42)(87, ResourceCenterComponent_Conditional_87_Template, 9, 0, "div", 43)(88, ResourceCenterComponent_Conditional_88_Template, 33, 6);
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(89, ResourceCenterComponent_Conditional_89_Template, 12, 0, "div", 44);
        \u0275\u0275conditionalCreate(90, ResourceCenterComponent_Conditional_90_Template, 9, 0, "div", 44);
        \u0275\u0275conditionalCreate(91, ResourceCenterComponent_Conditional_91_Template, 11, 1, "div", 44);
        \u0275\u0275elementEnd();
      }
      if (rf & 2) {
        let tmp_4_0;
        let tmp_5_0;
        \u0275\u0275advance(8);
        \u0275\u0275conditional(ctx.contactsService.isSyncing() ? 8 : -1);
        \u0275\u0275advance(6);
        \u0275\u0275property("disabled", ctx.contactsService.isSyncing());
        \u0275\u0275advance(16);
        \u0275\u0275textInterpolate(ctx.contactsService.stats().total);
        \u0275\u0275advance(9);
        \u0275\u0275textInterpolate1("+", ctx.contactsService.stats().recent_added);
        \u0275\u0275advance(9);
        \u0275\u0275textInterpolate(((tmp_4_0 = ctx.contactsService.stats().by_status) == null ? null : tmp_4_0["new"]) || 0);
        \u0275\u0275advance(9);
        \u0275\u0275textInterpolate(((tmp_5_0 = ctx.contactsService.stats().by_status) == null ? null : tmp_5_0["contacted"]) || 0);
        \u0275\u0275advance(6);
        \u0275\u0275repeater(ctx.tabs);
        \u0275\u0275advance(2);
        \u0275\u0275twoWayProperty("ngModel", ctx.selectedStatus);
        \u0275\u0275advance(3);
        \u0275\u0275repeater(ctx.statusOptions);
        \u0275\u0275advance(2);
        \u0275\u0275twoWayProperty("ngModel", ctx.selectedTag);
        \u0275\u0275advance(3);
        \u0275\u0275repeater(ctx.defaultTags);
        \u0275\u0275advance(4);
        \u0275\u0275twoWayProperty("ngModel", ctx.searchKeyword);
        \u0275\u0275advance(7);
        \u0275\u0275conditional(ctx.contactsService.selectedIds().size > 0 ? 84 : -1);
        \u0275\u0275advance(2);
        \u0275\u0275conditional(ctx.contactsService.isLoading() ? 86 : ctx.contactsService.contacts().length === 0 ? 87 : 88);
        \u0275\u0275advance(3);
        \u0275\u0275conditional(ctx.showBatchTagDialog() ? 89 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.showBatchStatusDialog() ? 90 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.showDeleteConfirm() ? 91 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, NgSelectOption, \u0275NgSelectMultipleOption, DefaultValueAccessor, SelectControlValueAccessor, NgControlStatus, NgModel], styles: ["\n\n.resource-center[_ngcontent-%COMP%] {\n  min-height: 100vh;\n}\n/*# sourceMappingURL=resource-center.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(ResourceCenterComponent, [{
    type: Component,
    args: [{ selector: "app-resource-center", standalone: true, imports: [CommonModule, FormsModule], template: `
    <div class="resource-center h-full flex flex-col bg-slate-900">
      <!-- \u9802\u90E8\u6A19\u984C\u6B04 -->
      <div class="p-4 border-b border-slate-700/50 bg-slate-900/80 backdrop-blur-sm">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <h1 class="text-2xl font-bold text-white flex items-center gap-3">
              <span class="text-2xl">\u{1F4E6}</span>
              \u8CC7\u6E90\u4E2D\u5FC3
            </h1>
            
            <!-- \u540C\u6B65\u72C0\u614B -->
            @if (contactsService.isSyncing()) {
              <span class="flex items-center gap-2 px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full text-sm cursor-pointer hover:bg-blue-500/30"
                    (click)="forceEndSync()"
                    title="\u9EDE\u64CA\u5F37\u5236\u7D50\u675F\u540C\u6B65">
                <span class="animate-spin h-4 w-4 border-2 border-blue-400 border-t-transparent rounded-full"></span>
                \u540C\u6B65\u4E2D... (\u9EDE\u64CA\u53D6\u6D88)
              </span>
            }
          </div>
          
          <!-- \u64CD\u4F5C\u6309\u9215 -->
          <div class="flex items-center gap-3">
            <!-- \u{1F195} P1: \u524D\u5F80\u767C\u9001\u63A7\u5236\u53F0\u5FEB\u6377\u6309\u9215 -->
            <button (click)="goToSendConsole()"
                    class="px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-colors flex items-center gap-2">
              <span>\u{1F4E4}</span>
              \u767C\u9001\u63A7\u5236\u53F0
            </button>
            <button (click)="syncData()"
                    [disabled]="contactsService.isSyncing()"
                    class="px-4 py-2 bg-blue-500/20 text-blue-400 rounded-lg hover:bg-blue-500/30 transition-colors flex items-center gap-2">
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
              \u540C\u6B65\u6578\u64DA
            </button>
            <button (click)="showImportDialog.set(true)"
                    class="px-4 py-2 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600 transition-colors">
              \u5C0E\u5165
            </button>
            <button (click)="exportData()"
                    class="px-4 py-2 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600 transition-colors">
              \u5C0E\u51FA
            </button>
          </div>
        </div>
      </div>
      
      <!-- \u{1F195} \u7C21\u5316\u7D71\u8A08\u5361\u7247 - \u805A\u7126\u6838\u5FC3\u6307\u6A19 -->
      <div class="p-4 border-b border-slate-700/30">
        <div class="grid grid-cols-4 gap-4">
          <!-- \u7E3D\u8CC7\u6E90\u6578 -->
          <div class="bg-gradient-to-br from-slate-800/80 to-slate-800/40 rounded-xl p-4 border border-slate-700/50">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-slate-400 text-sm mb-1">\u{1F4CA} \u7E3D\u8CC7\u6E90</div>
                <div class="text-3xl font-bold text-white">{{ contactsService.stats().total }}</div>
              </div>
              <div class="text-4xl opacity-20">\u{1F4E6}</div>
            </div>
          </div>
          
          <!-- \u672C\u9031\u65B0\u589E -->
          <div class="bg-gradient-to-br from-emerald-900/30 to-slate-800/40 rounded-xl p-4 border border-emerald-700/30">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-emerald-400 text-sm mb-1">\u{1F195} \u672C\u9031\u65B0\u589E</div>
                <div class="text-3xl font-bold text-emerald-400">+{{ contactsService.stats().recent_added }}</div>
              </div>
              <div class="text-4xl opacity-20">\u{1F4C8}</div>
            </div>
          </div>
          
          <!-- \u5F85\u8DDF\u9032\uFF08\u65B0\u767C\u73FE\u72C0\u614B\uFF09 -->
          <div class="bg-gradient-to-br from-blue-900/30 to-slate-800/40 rounded-xl p-4 border border-blue-700/30">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-blue-400 text-sm mb-1">\u{1F514} \u5F85\u8DDF\u9032</div>
                <div class="text-3xl font-bold text-blue-400">{{ contactsService.stats().by_status?.['new'] || 0 }}</div>
              </div>
              <div class="text-4xl opacity-20">\u{1F44B}</div>
            </div>
          </div>
          
          <!-- \u5DF2\u806F\u7E6B -->
          <div class="bg-gradient-to-br from-yellow-900/30 to-slate-800/40 rounded-xl p-4 border border-yellow-700/30">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-yellow-400 text-sm mb-1">\u{1F4AC} \u5DF2\u806F\u7E6B</div>
                <div class="text-3xl font-bold text-yellow-400">{{ contactsService.stats().by_status?.['contacted'] || 0 }}</div>
              </div>
              <div class="text-4xl opacity-20">\u2709\uFE0F</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- \u7BE9\u9078\u6B04 -->
      <div class="p-4 border-b border-slate-700/30">
        <div class="flex items-center gap-4 flex-wrap">
          <!-- Tab \u5207\u63DB -->
          <div class="flex bg-slate-800/50 rounded-lg p-1">
            @for (tab of tabs; track tab.id) {
              <button (click)="switchTab(tab.id)"
                      class="px-4 py-2 rounded-md text-sm transition-all"
                      [class.bg-purple-500]="activeTab() === tab.id"
                      [class.text-white]="activeTab() === tab.id"
                      [class.text-slate-400]="activeTab() !== tab.id"
                      [class.hover:text-white]="activeTab() !== tab.id">
                {{ tab.icon }} {{ tab.label }}
              </button>
            }
          </div>
          
          <!-- \u72C0\u614B\u7BE9\u9078 -->
          <select [(ngModel)]="selectedStatus"
                  (ngModelChange)="filterByStatus($event)"
                  class="px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm">
            <option value="">\u6240\u6709\u72C0\u614B</option>
            @for (status of statusOptions; track status.value) {
              <option [value]="status.value">{{ status.label }}</option>
            }
          </select>
          
          <!-- \u6A19\u7C64\u7BE9\u9078 -->
          <select [(ngModel)]="selectedTag"
                  (ngModelChange)="filterByTag($event)"
                  class="px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm">
            <option value="">\u6240\u6709\u6A19\u7C64</option>
            @for (tag of defaultTags; track tag) {
              <option [value]="tag">{{ tag }}</option>
            }
          </select>
          
          <!-- \u641C\u7D22\u6846 -->
          <div class="flex-1 max-w-md">
            <div class="relative">
              <input type="text"
                     [(ngModel)]="searchKeyword"
                     (keyup.enter)="search()"
                     placeholder="\u641C\u7D22\u540D\u7A31\u3001\u7528\u6236\u540D\u6216 ID..."
                     class="w-full px-4 py-2 pl-10 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500">
              <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>
          </div>
          
          <button (click)="search()"
                  class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-400 transition-colors">
            \u641C\u7D22
          </button>
          
          <button (click)="resetFilters()"
                  class="px-4 py-2 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600 transition-colors">
            \u91CD\u7F6E
          </button>
        </div>
      </div>
      
      <!-- \u6279\u91CF\u64CD\u4F5C\u6B04 -->
      @if (contactsService.selectedIds().size > 0) {
        <div class="p-3 bg-purple-500/10 border-b border-purple-500/30 flex items-center gap-4">
          <span class="text-purple-400 text-sm">
            \u5DF2\u9078\u64C7 {{ contactsService.selectedIds().size }} \u9805
          </span>
          <button (click)="showBatchTagDialog.set(true)"
                  class="px-3 py-1.5 bg-blue-500/20 text-blue-400 rounded-lg text-sm hover:bg-blue-500/30">
            \u6279\u91CF\u6A19\u8A18
          </button>
          <button (click)="showBatchStatusDialog.set(true)"
                  class="px-3 py-1.5 bg-green-500/20 text-green-400 rounded-lg text-sm hover:bg-green-500/30">
            \u66F4\u65B0\u72C0\u614B
          </button>
          <button (click)="batchSendMessage()"
                  class="px-3 py-1.5 bg-purple-500/20 text-purple-400 rounded-lg text-sm hover:bg-purple-500/30">
            \u6279\u91CF\u767C\u9001
          </button>
          <button (click)="sendToAISales()"
                  class="px-3 py-1.5 bg-cyan-500/20 text-cyan-400 rounded-lg text-sm hover:bg-cyan-500/30 flex items-center gap-1">
            <span>\u{1F4E4}</span> \u52A0\u5165\u767C\u9001\u968A\u5217
          </button>
          <button (click)="confirmBatchDelete()"
                  class="px-3 py-1.5 bg-red-500/20 text-red-400 rounded-lg text-sm hover:bg-red-500/30">
            \u522A\u9664
          </button>
          <button (click)="contactsService.clearSelection()"
                  class="ml-auto px-3 py-1.5 text-slate-400 text-sm hover:text-white">
            \u53D6\u6D88\u9078\u64C7
          </button>
        </div>
      }
      
      <!-- \u5217\u8868\u5340\u57DF -->
      <div class="flex-1 overflow-y-auto p-4">
        @if (contactsService.isLoading()) {
          <div class="flex items-center justify-center h-64">
            <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"></div>
          </div>
        } @else if (contactsService.contacts().length === 0) {
          <div class="flex flex-col items-center justify-center h-64 text-slate-400">
            <div class="text-5xl mb-4">\u{1F4E6}</div>
            <p class="text-lg mb-2">\u66AB\u7121\u8CC7\u6E90\u6578\u64DA</p>
            <p class="text-sm mb-4">\u9EDE\u64CA\u300C\u540C\u6B65\u6578\u64DA\u300D\u5F9E\u5404\u4F86\u6E90\u6574\u5408\u6578\u64DA</p>
            <button (click)="syncData()"
                    class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-400 transition-colors">
              \u540C\u6B65\u6578\u64DA
            </button>
          </div>
        } @else {
          <!-- \u8868\u683C -->
          <div class="bg-slate-800/30 rounded-xl border border-slate-700/50 overflow-hidden">
            <table class="w-full">
              <thead class="bg-slate-800/50">
                <tr class="text-left text-slate-400 text-sm">
                  <th class="p-3 w-12">
                    <input type="checkbox"
                           [checked]="isAllSelected()"
                           (change)="contactsService.toggleSelectAll()"
                           class="rounded bg-slate-700 border-slate-600">
                  </th>
                  <th class="p-3">\u540D\u7A31</th>
                  <th class="p-3">\u985E\u578B</th>
                  <th class="p-3">\u4F86\u6E90</th>
                  <th class="p-3">\u6A19\u7C64</th>
                  <th class="p-3">\u72C0\u614B</th>
                  <th class="p-3">\u8A55\u5206</th>
                  <th class="p-3">\u64CD\u4F5C</th>
                </tr>
              </thead>
              <tbody>
                @for (contact of contactsService.contacts(); track contact.telegram_id) {
                  <tr class="border-t border-slate-700/30 hover:bg-slate-800/30 transition-colors">
                    <td class="p-3">
                      <input type="checkbox"
                             [checked]="contactsService.selectedIds().has(contact.telegram_id)"
                             (change)="contactsService.toggleSelect(contact.telegram_id)"
                             class="rounded bg-slate-700 border-slate-600">
                    </td>
                    <td class="p-3">
                      <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold">
                          {{ getInitial(contact) }}
                        </div>
                        <div>
                          <div class="font-medium text-white">{{ contact.display_name }}</div>
                          @if (contact.username) {
                            <div class="text-sm text-slate-400">&#64;{{ contact.username }}</div>
                          }
                        </div>
                      </div>
                    </td>
                    <td class="p-3">
                      <span class="px-2 py-1 rounded-full text-xs"
                            [class.bg-blue-500/20]="contact.contact_type === 'user'"
                            [class.text-blue-400]="contact.contact_type === 'user'"
                            [class.bg-green-500/20]="contact.contact_type === 'group'"
                            [class.text-green-400]="contact.contact_type === 'group'"
                            [class.bg-purple-500/20]="contact.contact_type === 'channel'"
                            [class.text-purple-400]="contact.contact_type === 'channel'">
                        {{ getTypeLabel(contact.contact_type) }}
                      </span>
                    </td>
                    <td class="p-3">
                      <div class="flex items-center gap-1">
                        <span class="text-sm">{{ getSourceIcon(contact.source_type) }}</span>
                        <span class="text-sm px-1.5 py-0.5 rounded" [class]="getSourceColor(contact.source_type)">
                          {{ getSourceLabel(contact.source_type) }}
                        </span>
                      </div>
                      @if (contact.source_name) {
                        <div class="text-xs text-slate-500 truncate max-w-32 mt-0.5">
                          \u{1F4CD} {{ contact.source_name }}
                        </div>
                      }
                    </td>
                    <td class="p-3">
                      <div class="flex flex-wrap gap-1">
                        @for (tag of contact.tags.slice(0, 2); track tag) {
                          <span class="px-2 py-0.5 bg-slate-700 text-slate-300 rounded text-xs">
                            {{ tag }}
                          </span>
                        }
                        @if (contact.tags.length > 2) {
                          <span class="px-2 py-0.5 bg-slate-700 text-slate-400 rounded text-xs">
                            +{{ contact.tags.length - 2 }}
                          </span>
                        }
                      </div>
                    </td>
                    <td class="p-3">
                      <span class="px-2 py-1 rounded-full text-xs"
                            [class]="contactsService.getStatusColor(contact.status)"
                            [class.text-white]="true">
                        {{ contactsService.getStatusLabel(contact.status) }}
                      </span>
                    </td>
                    <td class="p-3">
                      <div class="flex items-center gap-2">
                        <div class="w-16 bg-slate-700 rounded-full h-2">
                          <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full"
                               [style.width.%]="contact.ai_score * 100"></div>
                        </div>
                        <span class="text-sm text-slate-400">{{ (contact.ai_score * 100).toFixed(0) }}</span>
                      </div>
                    </td>
                    <td class="p-3">
                      <div class="flex items-center gap-2">
                        @if (contact.contact_type === 'user') {
                          <button (click)="sendMessage(contact)"
                                  class="p-2 text-blue-400 hover:bg-blue-500/20 rounded-lg transition-colors"
                                  title="\u767C\u9001\u6D88\u606F">
                            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                            </svg>
                          </button>
                        }
                        <button (click)="viewDetail(contact)"
                                class="p-2 text-slate-400 hover:bg-slate-700 rounded-lg transition-colors"
                                title="\u67E5\u770B\u8A73\u60C5">
                          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                          </svg>
                        </button>
                        <button (click)="editContact(contact)"
                                class="p-2 text-slate-400 hover:bg-slate-700 rounded-lg transition-colors"
                                title="\u7DE8\u8F2F">
                          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                          </svg>
                        </button>
                      </div>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
          
          <!-- \u5206\u9801 -->
          <div class="flex items-center justify-between mt-4 text-slate-400 text-sm">
            <div>
              \u986F\u793A {{ contactsService.contacts().length }} / {{ contactsService.total() }} \u689D
            </div>
            <div class="flex items-center gap-2">
              <button (click)="prevPage()"
                      [disabled]="currentPage() <= 1"
                      class="px-3 py-1.5 bg-slate-800 rounded-lg hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed">
                \u4E0A\u4E00\u9801
              </button>
              <span class="px-4">\u7B2C {{ currentPage() }} \u9801</span>
              <button (click)="nextPage()"
                      [disabled]="!hasNextPage()"
                      class="px-3 py-1.5 bg-slate-800 rounded-lg hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed">
                \u4E0B\u4E00\u9801
              </button>
            </div>
          </div>
        }
      </div>
      
      <!-- \u6279\u91CF\u6A19\u7C64\u5C0D\u8A71\u6846 -->
      @if (showBatchTagDialog()) {
        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
          <div class="bg-slate-800 rounded-2xl w-full max-w-md p-6 shadow-xl border border-slate-700">
            <h3 class="text-xl font-bold text-white mb-4">\u6279\u91CF\u6DFB\u52A0\u6A19\u7C64</h3>
            <div class="space-y-3 max-h-64 overflow-y-auto">
              @for (tag of defaultTags; track tag) {
                <label class="flex items-center gap-3 p-2 hover:bg-slate-700/50 rounded-lg cursor-pointer">
                  <input type="checkbox"
                         [checked]="selectedBatchTags().has(tag)"
                         (change)="toggleBatchTag(tag)"
                         class="rounded bg-slate-700 border-slate-600">
                  <span class="text-white">{{ tag }}</span>
                </label>
              }
            </div>
            <div class="flex gap-3 mt-6">
              <button (click)="showBatchTagDialog.set(false)"
                      class="flex-1 py-2.5 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600">
                \u53D6\u6D88
              </button>
              <button (click)="applyBatchTags()"
                      class="flex-1 py-2.5 bg-purple-500 text-white rounded-lg hover:bg-purple-400">
                \u61C9\u7528
              </button>
            </div>
          </div>
        </div>
      }
      
      <!-- \u6279\u91CF\u72C0\u614B\u5C0D\u8A71\u6846 -->
      @if (showBatchStatusDialog()) {
        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
          <div class="bg-slate-800 rounded-2xl w-full max-w-md p-6 shadow-xl border border-slate-700">
            <h3 class="text-xl font-bold text-white mb-4">\u66F4\u65B0\u72C0\u614B</h3>
            <div class="space-y-2">
              @for (status of statusOptions; track status.value) {
                <button (click)="applyBatchStatus(status.value)"
                        class="w-full p-3 text-left rounded-lg hover:bg-slate-700/50 flex items-center gap-3">
                  <span class="w-3 h-3 rounded-full" [class]="status.color"></span>
                  <span class="text-white">{{ status.label }}</span>
                </button>
              }
            </div>
            <button (click)="showBatchStatusDialog.set(false)"
                    class="w-full mt-4 py-2.5 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600">
              \u53D6\u6D88
            </button>
          </div>
        </div>
      }
      
      <!-- \u522A\u9664\u78BA\u8A8D\u5C0D\u8A71\u6846 -->
      @if (showDeleteConfirm()) {
        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
          <div class="bg-slate-800 rounded-2xl w-full max-w-md p-6 shadow-xl border border-slate-700">
            <h3 class="text-xl font-bold text-red-400 mb-4">\u26A0\uFE0F \u78BA\u8A8D\u522A\u9664</h3>
            <p class="text-slate-300 mb-6">
              \u78BA\u5B9A\u8981\u522A\u9664\u9078\u4E2D\u7684 {{ contactsService.selectedIds().size }} \u500B\u806F\u7E6B\u4EBA\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\u3002
            </p>
            <div class="flex gap-3">
              <button (click)="showDeleteConfirm.set(false)"
                      class="flex-1 py-2.5 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600">
                \u53D6\u6D88
              </button>
              <button (click)="confirmDelete()"
                      class="flex-1 py-2.5 bg-red-500 text-white rounded-lg hover:bg-red-400">
                \u78BA\u8A8D\u522A\u9664
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  `, styles: ["/* angular:styles/component:css;1e2e16f59079d65deb71285438eb7b08c47fa5ed2dc0b475483ed36327c3c413;D:/tgkz2026/src/manual-mode/resource-center.component.ts */\n.resource-center {\n  min-height: 100vh;\n}\n/*# sourceMappingURL=resource-center.component.css.map */\n"] }]
  }], null, { sendMessageEvent: [{ type: Output, args: ["sendMessageEvent"] }], viewDetailEvent: [{ type: Output, args: ["viewDetailEvent"] }], batchSendEvent: [{ type: Output, args: ["batchSendEvent"] }], sendToAISalesEvent: [{ type: Output, args: ["sendToAISalesEvent"] }], statusChangedEvent: [{ type: Output, args: ["statusChangedEvent"] }], refreshDataEvent: [{ type: Output, args: ["refreshDataEvent"] }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(ResourceCenterComponent, { className: "ResourceCenterComponent", filePath: "src/manual-mode/resource-center.component.ts", lineNumber: 472 });
})();

// src/ai-assistant/ai-strategy.service.ts
var STRATEGY_GENERATION_PROMPT = `\u4F60\u662F\u4E00\u4F4D\u5C08\u696D\u7684 Telegram \u71DF\u92B7\u7B56\u7565\u5C08\u5BB6\uFF0C\u7CBE\u901A\u5404\u884C\u696D\u7684\u5BA2\u6236\u7372\u53D6\u548C\u71DF\u92B7\u8A71\u8853\u3002

\u7528\u6236\u9700\u6C42\uFF1A{USER_INPUT}

\u8ACB\u6839\u64DA\u7528\u6236\u9700\u6C42\uFF0C\u751F\u6210\u4E00\u4EFD\u5B8C\u6574\u7684\u71DF\u92B7\u7B56\u7565\u3002\u8FD4\u56DE\u7D14 JSON \u683C\u5F0F\uFF08\u4E0D\u8981 markdown \u4EE3\u78BC\u584A\uFF09\uFF1A

{
  "industry": "\u8B58\u5225\u7684\u76EE\u6A19\u884C\u696D",
  "targetAudience": "\u76EE\u6A19\u53D7\u773E\u63CF\u8FF0",
  "keywords": {
    "highIntent": ["\u9AD8\u610F\u5411\u95DC\u9375\u8A5E1", "\u9AD8\u610F\u5411\u95DC\u9375\u8A5E2", "\u9AD8\u610F\u5411\u95DC\u9375\u8A5E3"],
    "mediumIntent": ["\u4E2D\u610F\u5411\u95DC\u9375\u8A5E1", "\u4E2D\u610F\u5411\u95DC\u9375\u8A5E2", "\u4E2D\u610F\u5411\u95DC\u9375\u8A5E3"],
    "extended": ["\u64F4\u5C55\u95DC\u9375\u8A5E1", "\u64F4\u5C55\u95DC\u9375\u8A5E2", "\u64F4\u5C55\u95DC\u9375\u8A5E3"]
  },
  "customerProfile": {
    "identity": ["\u8EAB\u4EFD\u7279\u5FB51", "\u8EAB\u4EFD\u7279\u5FB52", "\u8EAB\u4EFD\u7279\u5FB53"],
    "features": ["\u884C\u70BA\u7279\u5FB51", "\u884C\u70BA\u7279\u5FB52", "\u884C\u70BA\u7279\u5FB53"],
    "needs": ["\u6838\u5FC3\u9700\u6C421", "\u6838\u5FC3\u9700\u6C422", "\u6838\u5FC3\u9700\u6C423"]
  },
  "recommendedGroups": ["\u63A8\u85A6\u641C\u7D22\u7684\u7FA4\u7D44\u985E\u578B1", "\u63A8\u85A6\u7FA4\u7D44\u985E\u578B2"],
  "messageTemplates": {
    "firstTouch": "\u9996\u6B21\u89F8\u9054\u6D88\u606F\u6A21\u677F\uFF08\u81EA\u7136\u3001\u5C08\u696D\u3001\u6709\u5438\u5F15\u529B\uFF09",
    "followUp": "\u8DDF\u9032\u6D88\u606F\u6A21\u677F",
    "closing": "\u4FC3\u6210\u8F49\u5316\u6D88\u606F\u6A21\u677F"
  },
  "automationSettings": {
    "monitorMode": "24/7 \u5168\u5929\u5019",
    "responseDelay": 30,
    "followUpInterval": 7200
  }
}

\u8981\u6C42\uFF1A
1. \u95DC\u9375\u8A5E\u8981\u7CBE\u6E96\uFF0C\u8986\u84CB\u884C\u696D\u5E38\u7528\u8853\u8A9E\u548C\u641C\u7D22\u8A5E
2. \u6D88\u606F\u6A21\u677F\u8981\u81EA\u7136\u3001\u5C08\u696D\u3001\u6709\u5438\u5F15\u529B\uFF0C\u907F\u514D\u6A5F\u5668\u4EBA\u611F
3. \u5BA2\u6236\u756B\u50CF\u8981\u5177\u9AD4\uFF0C\u4FBF\u65BC\u8B58\u5225\u76EE\u6A19\u5BA2\u6236
4. \u53EA\u8FD4\u56DE JSON\uFF0C\u4E0D\u8981\u4EFB\u4F55\u5176\u4ED6\u89E3\u91CB`;
var AIStrategyService = class _AIStrategyService {
  constructor() {
    this.aiProviderService = inject(AIProviderService);
    this.aiCenterService = inject(AICenterService);
    this.toastService = inject(ToastService);
    this.ipcService = inject(ElectronIpcService);
    this._availableModels = signal([], ...ngDevMode ? [{ debugName: "_availableModels" }] : []);
    this.availableModels = this._availableModels.asReadonly();
    this._selectedModelId = signal("local-ollama", ...ngDevMode ? [{ debugName: "_selectedModelId" }] : []);
    this.selectedModelId = this._selectedModelId.asReadonly();
    this._localAIConfig = signal({
      endpoint: "https://ms-defysomwqybz.tail05a567.ts.net/api/chat",
      model: "huihui_ai/qwen2.5-abliterate",
      isConnected: false,
      lastChecked: ""
    }, ...ngDevMode ? [{ debugName: "_localAIConfig" }] : []);
    this.localAIConfig = this._localAIConfig.asReadonly();
    this._generationStatus = signal({
      isGenerating: false,
      currentProvider: "",
      progress: 0,
      message: ""
    }, ...ngDevMode ? [{ debugName: "_generationStatus" }] : []);
    this.generationStatus = this._generationStatus.asReadonly();
    this._savedStrategies = signal([], ...ngDevMode ? [{ debugName: "_savedStrategies" }] : []);
    this.savedStrategies = this._savedStrategies.asReadonly();
    this._currentStrategy = signal(null, ...ngDevMode ? [{ debugName: "_currentStrategy" }] : []);
    this.currentStrategy = this._currentStrategy.asReadonly();
    this.selectedModel = computed(() => this._availableModels().find((m) => m.id === this._selectedModelId()), ...ngDevMode ? [{ debugName: "selectedModel" }] : []);
    this.loadConfig();
    this.refreshAvailableModels();
  }
  // ============ 模型管理 ============
  /**
   * 刷新可用模型列表
   */
  async refreshAvailableModels() {
    const models = [];
    const configuredModels = this.aiCenterService.models();
    const localModelsFromCenter = configuredModels.filter((m) => m.isLocal);
    if (localModelsFromCenter.length > 0) {
      for (const local of localModelsFromCenter) {
        models.push({
          id: local.id,
          name: local.displayName || local.modelName,
          provider: "Ollama (\u672C\u5730)",
          icon: "\u{1F999}",
          isLocal: true,
          isConnected: local.isConnected,
          endpoint: local.apiEndpoint
        });
        if (local.apiEndpoint) {
          this._localAIConfig.update((c) => __spreadProps(__spreadValues({}, c), {
            endpoint: local.apiEndpoint,
            model: local.modelName,
            isConnected: local.isConnected
          }));
        }
      }
    } else {
      const localConfig = this._localAIConfig();
      models.push({
        id: "local-ollama",
        name: `\u672C\u5730 AI (${localConfig.model})`,
        provider: "Ollama (Tailscale)",
        icon: "\u{1F999}",
        isLocal: true,
        isConnected: localConfig.isConnected,
        endpoint: localConfig.endpoint
      });
    }
    const cloudModels = configuredModels.filter((m) => !m.isLocal);
    for (const model of cloudModels) {
      const providerInfo = this.getProviderInfo(model.provider);
      const capability = this.getModelCapability(model.modelName);
      models.push({
        id: model.id,
        name: model.displayName || model.modelName,
        provider: providerInfo.name,
        icon: providerInfo.icon,
        isLocal: false,
        isConnected: model.isConnected,
        capability
      });
    }
    if (models.length === 0) {
      console.log("[AIStrategy] \u6C92\u6709\u914D\u7F6E\u4EFB\u4F55 AI \u6A21\u578B\uFF0C\u8ACB\u524D\u5F80 AI \u4E2D\u5FC3\u914D\u7F6E");
    }
    models.sort((a, b) => {
      if (a.isConnected && !b.isConnected)
        return -1;
      if (!a.isConnected && b.isConnected)
        return 1;
      if (a.isLocal && !b.isLocal)
        return -1;
      return 0;
    });
    this._availableModels.set(models);
    const currentSelected = this._selectedModelId();
    const availableIds = models.map((m) => m.id);
    if (!availableIds.includes(currentSelected)) {
      const firstConnected = models.find((m) => m.isConnected);
      if (firstConnected) {
        this._selectedModelId.set(firstConnected.id);
      } else if (models.length > 0) {
        this._selectedModelId.set(models[0].id);
      }
    }
  }
  /**
   * 選擇模型
   */
  selectModel(modelId) {
    this._selectedModelId.set(modelId);
    this.saveConfig();
  }
  /**
   * 更新本地 AI 配置
   */
  updateLocalAIConfig(config) {
    this._localAIConfig.update((c) => __spreadValues(__spreadValues({}, c), config));
    this.saveConfig();
    this.refreshAvailableModels();
  }
  /**
   * 測試本地 AI 連接
   */
  async testLocalAIConnection() {
    const config = this._localAIConfig();
    try {
      this._generationStatus.set({
        isGenerating: true,
        currentProvider: "\u672C\u5730 Ollama",
        progress: 50,
        message: "\u6B63\u5728\u6E2C\u8A66\u9023\u63A5..."
      });
      const response = await fetch(config.endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          model: config.model,
          messages: [{ role: "user", content: "Hi, please respond with OK." }],
          stream: false,
          options: { temperature: 0.1, num_predict: 10 }
        }),
        signal: AbortSignal.timeout(1e4)
        // 10秒超時
      });
      if (response.ok) {
        const data = await response.json();
        if (data.message?.content) {
          this._localAIConfig.update((c) => __spreadProps(__spreadValues({}, c), {
            isConnected: true,
            lastChecked: (/* @__PURE__ */ new Date()).toISOString()
          }));
          this.refreshAvailableModels();
          this.toastService.success("\u672C\u5730 AI \u9023\u63A5\u6210\u529F\uFF01");
          return true;
        }
      }
      throw new Error("\u7121\u6548\u97FF\u61C9");
    } catch (error) {
      this._localAIConfig.update((c) => __spreadProps(__spreadValues({}, c), {
        isConnected: false,
        lastChecked: (/* @__PURE__ */ new Date()).toISOString()
      }));
      this.refreshAvailableModels();
      this.toastService.error(`\u672C\u5730 AI \u9023\u63A5\u5931\u6557: ${error.message}`);
      return false;
    } finally {
      this._generationStatus.set({
        isGenerating: false,
        currentProvider: "",
        progress: 0,
        message: ""
      });
    }
  }
  // ============ 策略生成 ============
  /**
   * 生成 AI 營銷策略
   * 🔧 根據用戶選擇的模型來調用 AI
   */
  async generateStrategy(userInput) {
    const prompt = STRATEGY_GENERATION_PROMPT.replace("{USER_INPUT}", userInput);
    const messages = [
      { role: "system", content: "\u4F60\u662F\u4E00\u4F4D\u5C08\u696D\u7684 Telegram \u71DF\u92B7\u7B56\u7565\u5C08\u5BB6\uFF0C\u53EA\u8FD4\u56DE JSON \u683C\u5F0F\u7684\u7B56\u7565\u5206\u6790\u7D50\u679C\u3002" },
      { role: "user", content: prompt }
    ];
    const selected = this.selectedModel();
    const modelName = selected?.name || "\u672C\u5730 AI";
    const isLocal = selected?.isLocal ?? true;
    console.log(`[AIStrategy] \u4F7F\u7528\u6A21\u578B: ${modelName}, isLocal: ${isLocal}`);
    if (isLocal) {
      this._generationStatus.set({
        isGenerating: true,
        currentProvider: modelName,
        progress: 20,
        message: `\u6B63\u5728\u4F7F\u7528 ${modelName} \u5206\u6790...`
      });
      try {
        const localResult = await this.callLocalAI(messages);
        if (localResult) {
          const strategy = this.parseStrategyResponse(localResult);
          if (strategy) {
            this._generationStatus.set({
              isGenerating: false,
              currentProvider: modelName,
              progress: 100,
              message: "\u751F\u6210\u5B8C\u6210\uFF01"
            });
            return strategy;
          }
        }
      } catch (error) {
        console.warn(`[AIStrategy] ${modelName} \u5931\u6557:`, error.message);
        this.toastService.warning(`${modelName} \u8ABF\u7528\u5931\u6557\uFF0C\u5617\u8A66\u96F2\u7AEF\u56DE\u9000...`);
      }
      this._generationStatus.set({
        isGenerating: true,
        currentProvider: "\u96F2\u7AEF AI (\u56DE\u9000)",
        progress: 50,
        message: "\u672C\u5730 AI \u4E0D\u53EF\u7528\uFF0C\u6B63\u5728\u4F7F\u7528\u96F2\u7AEF AI..."
      });
      try {
        const cloudResult = await this.callCloudAI(messages);
        if (cloudResult) {
          const strategy = this.parseStrategyResponse(cloudResult);
          if (strategy) {
            this._generationStatus.set({
              isGenerating: false,
              currentProvider: "\u96F2\u7AEF AI",
              progress: 100,
              message: "\u751F\u6210\u5B8C\u6210\uFF01"
            });
            return strategy;
          }
        }
      } catch (error) {
        console.warn("[AIStrategy] \u96F2\u7AEF AI \u56DE\u9000\u5931\u6557:", error.message);
      }
    } else {
      this._generationStatus.set({
        isGenerating: true,
        currentProvider: modelName,
        progress: 30,
        message: `\u6B63\u5728\u4F7F\u7528 ${modelName} \u5206\u6790...`
      });
      try {
        const cloudResult = await this.callSelectedCloudModel(messages, selected);
        if (cloudResult) {
          const strategy = this.parseStrategyResponse(cloudResult);
          if (strategy) {
            this._generationStatus.set({
              isGenerating: false,
              currentProvider: modelName,
              progress: 100,
              message: "\u751F\u6210\u5B8C\u6210\uFF01"
            });
            return strategy;
          }
        }
      } catch (error) {
        console.warn(`[AIStrategy] ${modelName} \u5931\u6557:`, error.message);
        this.toastService.warning(`${modelName} \u8ABF\u7528\u5931\u6557\uFF0C\u5617\u8A66\u5176\u4ED6\u6A21\u578B...`);
      }
      this._generationStatus.set({
        isGenerating: true,
        currentProvider: "\u5176\u4ED6\u96F2\u7AEF\u6A21\u578B",
        progress: 60,
        message: "\u5617\u8A66\u5176\u4ED6\u53EF\u7528\u6A21\u578B..."
      });
      try {
        const cloudResult = await this.callCloudAI(messages);
        if (cloudResult) {
          const strategy = this.parseStrategyResponse(cloudResult);
          if (strategy) {
            this._generationStatus.set({
              isGenerating: false,
              currentProvider: "\u96F2\u7AEF AI",
              progress: 100,
              message: "\u751F\u6210\u5B8C\u6210\uFF01"
            });
            return strategy;
          }
        }
      } catch (error) {
        console.warn("[AIStrategy] \u6240\u6709\u96F2\u7AEF AI \u5931\u6557:", error.message);
      }
    }
    this._generationStatus.set({
      isGenerating: true,
      currentProvider: "\u6A21\u677F\u56DE\u9000",
      progress: 80,
      message: "AI \u4E0D\u53EF\u7528\uFF0C\u4F7F\u7528\u667A\u80FD\u6A21\u677F..."
    });
    const templateResult = this.generateFromTemplate(userInput);
    this._generationStatus.set({
      isGenerating: false,
      currentProvider: "\u6A21\u677F\u56DE\u9000",
      progress: 100,
      message: "\u751F\u6210\u5B8C\u6210\uFF08\u6A21\u677F\u6A21\u5F0F\uFF09"
    });
    return templateResult;
  }
  /**
   * 調用本地 Ollama AI
   */
  async callLocalAI(messages) {
    const config = this._localAIConfig();
    const response = await fetch(config.endpoint, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: config.model,
        messages,
        stream: false,
        options: {
          temperature: 0.7,
          num_predict: 2048,
          top_p: 0.9
        }
      }),
      signal: AbortSignal.timeout(3e4)
      // 30秒超時
    });
    if (!response.ok) {
      throw new Error(`\u672C\u5730 AI \u8ACB\u6C42\u5931\u6557: ${response.status}`);
    }
    const data = await response.json();
    return data.message?.content || null;
  }
  /**
   * 調用雲端 AI
   * 🔧 優先使用後端 IPC 代理，保護 API Key 並避免 CORS 問題
   */
  async callCloudAI(messages) {
    try {
      console.log("[AIStrategy] \u5617\u8A66\u901A\u904E\u5F8C\u7AEF IPC \u8ABF\u7528 AI...");
      const result = await this.callAIViaBackend(messages);
      if (result) {
        console.log("[AIStrategy] \u5F8C\u7AEF IPC \u8ABF\u7528\u6210\u529F");
        return result;
      }
    } catch (error) {
      console.warn("[AIStrategy] \u5F8C\u7AEF IPC \u8ABF\u7528\u5931\u6557:", error);
    }
    const allModels = this.aiCenterService.models();
    const connectedModels = allModels.filter((m) => m.isConnected && !m.isLocal);
    const modelsToTry = connectedModels.length > 0 ? connectedModels : allModels.filter((m) => !m.isLocal && m.apiKey);
    for (const model of modelsToTry) {
      try {
        console.log(`[AIStrategy] \u5617\u8A66\u96F2\u7AEF\u6A21\u578B: ${model.modelName}`);
        this.aiProviderService.setConfig({
          provider: model.provider,
          model: model.modelName,
          apiKey: model.apiKey,
          baseUrl: model.apiEndpoint
        });
        const response = await this.aiProviderService.chat(messages);
        if (response.content) {
          return response.content;
        }
      } catch (error) {
        console.warn(`[AIStrategy] \u96F2\u7AEF\u6A21\u578B ${model.modelName} \u5931\u6557:`, error);
      }
    }
    if (this.aiProviderService.isConnected()) {
      try {
        const response = await this.aiProviderService.chat(messages);
        return response.content;
      } catch (error) {
        console.warn("[AIStrategy] AIProviderService \u8ABF\u7528\u5931\u6557:", error);
      }
    }
    return null;
  }
  /**
   * 🔧 通過後端 IPC 調用 AI（保護 API Key）
   */
  callAIViaBackend(messages) {
    return new Promise((resolve, reject) => {
      const timeout = setTimeout(() => {
        this.ipcService.off("ai-response", handler);
        reject(new Error("\u5F8C\u7AEF AI \u8ABF\u7528\u8D85\u6642"));
      }, 6e4);
      const handler = (result) => {
        clearTimeout(timeout);
        this.ipcService.off("ai-response", handler);
        if (result.success && result.response) {
          resolve(result.response);
        } else if (result.error) {
          reject(new Error(result.error));
        } else {
          resolve(null);
        }
      };
      this.ipcService.on("ai-response", handler);
      const systemMessage = messages.find((m) => m.role === "system");
      const userMessage = messages.find((m) => m.role === "user");
      const localConfig = this._localAIConfig();
      this.ipcService.send("generate-ai-response", {
        userId: "strategy-generator",
        message: userMessage?.content || "",
        systemPrompt: systemMessage?.content || "",
        localAiEndpoint: localConfig.endpoint,
        localAiModel: localConfig.model
      });
    });
  }
  /**
   * 🔧 調用選定的雲端模型
   */
  async callSelectedCloudModel(messages, selectedModel) {
    const allModels = this.aiCenterService.models();
    const modelConfig = allModels.find((m) => m.id === selectedModel.id);
    if (!modelConfig) {
      console.warn(`[AIStrategy] \u627E\u4E0D\u5230\u6A21\u578B\u914D\u7F6E: ${selectedModel.id}`);
      return null;
    }
    if (!modelConfig.apiKey && !modelConfig.isConnected) {
      console.warn(`[AIStrategy] \u6A21\u578B ${selectedModel.name} \u672A\u914D\u7F6E API Key`);
      this.toastService.error(`\u8ACB\u5148\u5728 AI \u4E2D\u5FC3\u914D\u7F6E ${selectedModel.name} \u7684 API Key`);
      return null;
    }
    console.log(`[AIStrategy] \u8ABF\u7528\u9078\u5B9A\u6A21\u578B: ${modelConfig.modelName}, provider: ${modelConfig.provider}`);
    this.aiProviderService.setConfig({
      provider: modelConfig.provider,
      model: modelConfig.modelName,
      apiKey: modelConfig.apiKey,
      baseUrl: modelConfig.apiEndpoint
    });
    const response = await this.aiProviderService.chat(messages);
    return response.content;
  }
  /**
   * 從 AI 中心獲取已配置的本地 AI
   */
  getLocalAIFromCenter() {
    const localModels = this.aiCenterService.models().filter((m) => m.isLocal);
    if (localModels.length > 0) {
      const local = localModels[0];
      return {
        endpoint: local.apiEndpoint || "",
        model: local.modelName
      };
    }
    return null;
  }
  /**
   * 同步本地 AI 配置從 AI 中心
   */
  syncLocalAIFromCenter() {
    const localFromCenter = this.getLocalAIFromCenter();
    if (localFromCenter && localFromCenter.endpoint) {
      this._localAIConfig.update((c) => __spreadProps(__spreadValues({}, c), {
        endpoint: localFromCenter.endpoint,
        model: localFromCenter.model
      }));
    }
  }
  /**
   * 解析 AI 返回的策略 JSON
   */
  parseStrategyResponse(response) {
    try {
      let jsonStr = response;
      const jsonMatch = response.match(/```(?:json)?\s*([\s\S]*?)```/);
      if (jsonMatch) {
        jsonStr = jsonMatch[1];
      }
      const jsonStart = jsonStr.indexOf("{");
      const jsonEnd = jsonStr.lastIndexOf("}");
      if (jsonStart !== -1 && jsonEnd !== -1) {
        jsonStr = jsonStr.slice(jsonStart, jsonEnd + 1);
      }
      const parsed = JSON.parse(jsonStr);
      if (!parsed.industry || !parsed.keywords) {
        throw new Error("\u7F3A\u5C11\u5FC5\u8981\u5B57\u6BB5");
      }
      return {
        industry: parsed.industry || "\u672A\u8B58\u5225\u884C\u696D",
        targetAudience: parsed.targetAudience || "\u76EE\u6A19\u5BA2\u6236\u7FA4\u9AD4",
        keywords: {
          highIntent: parsed.keywords?.highIntent || [],
          mediumIntent: parsed.keywords?.mediumIntent || [],
          extended: parsed.keywords?.extended || []
        },
        customerProfile: {
          identity: parsed.customerProfile?.identity || [],
          features: parsed.customerProfile?.features || [],
          needs: parsed.customerProfile?.needs || []
        },
        recommendedGroups: parsed.recommendedGroups || [],
        messageTemplates: {
          firstTouch: parsed.messageTemplates?.firstTouch || "",
          followUp: parsed.messageTemplates?.followUp || "",
          closing: parsed.messageTemplates?.closing || ""
        },
        automationSettings: {
          monitorMode: parsed.automationSettings?.monitorMode || "24/7 \u5168\u5929\u5019",
          responseDelay: parsed.automationSettings?.responseDelay || 30,
          followUpInterval: parsed.automationSettings?.followUpInterval || 7200
        }
      };
    } catch (error) {
      console.error("[AIStrategy] \u89E3\u6790 AI \u97FF\u61C9\u5931\u6557:", error, response);
      return null;
    }
  }
  /**
   * 從模板生成策略（回退方案）
   */
  generateFromTemplate(userInput) {
    let industry = "\u901A\u7528\u884C\u696D";
    let keywords = {
      highIntent: ["\u5408\u4F5C", "\u4EE3\u7406", "\u5C0D\u63A5"],
      mediumIntent: ["\u8CC7\u6E90", "\u6E20\u9053", "\u696D\u52D9"],
      extended: ["\u4EA4\u6D41", "\u4E86\u89E3", "\u54A8\u8A62"]
    };
    if (userInput.includes("\u652F\u4ED8") || userInput.includes("\u63DB\u532F") || userInput.includes("\u8DD1\u5206")) {
      industry = "\u652F\u4ED8/\u63DB\u532F";
      keywords = {
        highIntent: ["\u652F\u4ED8\u901A\u9053", "U\u5546", "\u63DB\u532F", "USDT", "\u4EE3\u6536\u4EE3\u4ED8", "\u8DD1\u5206"],
        mediumIntent: ["\u56DB\u65B9\u652F\u4ED8", "\u4E09\u65B9\u652F\u4ED8", "API\u5C0D\u63A5", "\u627F\u514C\u5546"],
        extended: ["OTC", "\u6536\u6B3E", "\u51FA\u6B3E", "\u8CBB\u7387", "T+0", "T+1"]
      };
    } else if (userInput.includes("\u5E63") || userInput.includes("\u52A0\u5BC6") || userInput.includes("BTC")) {
      industry = "\u52A0\u5BC6\u8CA8\u5E63";
      keywords = {
        highIntent: ["BTC", "ETH", "\u5408\u7D04", "\u73FE\u8CA8", "\u4EA4\u6613\u6240"],
        mediumIntent: ["DeFi", "NFT", "\u9322\u5305", "\u516C\u93C8"],
        extended: ["\u6316\u7926", "\u8CEA\u62BC", "\u7A7A\u6295", "IDO"]
      };
    } else if (userInput.includes("\u96FB\u5546") || userInput.includes("\u8DE8\u5883") || userInput.includes("\u4E9E\u99AC\u905C")) {
      industry = "\u96FB\u5546/\u8DE8\u5883";
      keywords = {
        highIntent: ["\u4E9E\u99AC\u905C", "\u7368\u7ACB\u7AD9", "Shopify", "\u7269\u6D41", "\u9078\u54C1"],
        mediumIntent: ["FBA", "\u6D77\u5916\u5009", "\u6E05\u95DC", "\u652F\u4ED8"],
        extended: ["\u6E2C\u8A55", "\u5237\u55AE", "\u7AD9\u5916\u63A8\u5EE3"]
      };
    }
    return {
      industry,
      targetAudience: this.extractAudience(userInput),
      keywords,
      customerProfile: {
        identity: ["\u4EE3\u7406\u5546", "\u9805\u76EE\u65B9", "\u904B\u71DF\u4EBA\u54E1"],
        features: ["\u6D3B\u8E8D\u5728\u76F8\u95DC\u7FA4\u7D44", "\u7D93\u5E38\u767C\u696D\u52D9\u6D88\u606F", "\u6709\u660E\u78BA\u9700\u6C42"],
        needs: ["\u5C0B\u627E\u5408\u4F5C\u5925\u4F34", "\u89E3\u6C7A\u696D\u52D9\u75DB\u9EDE", "\u7372\u53D6\u66F4\u591A\u8CC7\u6E90"]
      },
      recommendedGroups: [`${industry}\u4EA4\u6D41\u7FA4`, "\u696D\u52D9\u5C0D\u63A5\u7FA4", "\u9805\u76EE\u5408\u4F5C\u7FA4"],
      messageTemplates: {
        firstTouch: `\u60A8\u597D\uFF01\u770B\u5230\u60A8\u5728\u7FA4\u88E1\u7684\u6D88\u606F\uFF0C\u6211\u5011\u5C08\u6CE8${industry}\u884C\u696D\uFF0C\u80FD\u70BA\u60A8\u63D0\u4F9B\u5C08\u696D\u670D\u52D9\u3002\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F`,
        followUp: "\u8ACB\u554F\u60A8\u76EE\u524D\u696D\u52D9\u4E0A\u6709\u4EC0\u9EBC\u5177\u9AD4\u9700\u6C42\u55CE\uFF1F\u6211\u5011\u53EF\u4EE5\u6839\u64DA\u60A8\u7684\u60C5\u6CC1\u63D0\u4F9B\u5B9A\u5236\u65B9\u6848\u3002",
        closing: "\u8981\u4E0D\u9019\u6A23\uFF0C\u6211\u5148\u7D66\u60A8\u958B\u500B\u6E2C\u8A66\u8CEC\u865F/\u767C\u500B\u8CC7\u6599\uFF0C\u60A8\u9AD4\u9A57\u4E00\u4E0B\uFF1F"
      },
      automationSettings: {
        monitorMode: "24/7 \u5168\u5929\u5019",
        responseDelay: 30,
        followUpInterval: 7200
      }
    };
  }
  extractAudience(input2) {
    if (input2.includes("\u4EE3\u7406"))
      return "\u4EE3\u7406\u5546/\u6E20\u9053\u5546";
    if (input2.includes("\u5BA2\u6236"))
      return "\u7D42\u7AEF\u5BA2\u6236";
    if (input2.includes("\u9805\u76EE"))
      return "\u9805\u76EE\u65B9/\u904B\u71DF\u5546";
    return "\u76EE\u6A19\u5BA2\u6236\u7FA4\u9AD4";
  }
  getProviderInfo(provider) {
    switch (provider) {
      case "openai":
        return { name: "OpenAI", icon: "\u{1F916}" };
      case "claude":
        return { name: "Anthropic", icon: "\u{1F9E0}" };
      case "gemini":
        return { name: "Google", icon: "\u2728" };
      default:
        return { name: provider, icon: "\u{1F527}" };
    }
  }
  /**
   * 根據模型名稱判斷能力標籤
   */
  getModelCapability(modelName) {
    const name = modelName.toLowerCase();
    if (name.includes("flash") || name.includes("mini") || name.includes("haiku") || name.includes("3.5-turbo")) {
      return "fast";
    }
    if (name.includes("opus") || name.includes("pro") || name.includes("gpt-4o") || name.includes("ultra")) {
      return "powerful";
    }
    if (name.includes("mini") || name.includes("nano") || name.includes("lite")) {
      return "economic";
    }
    return "balanced";
  }
  // ============ 配置持久化 ============
  loadConfig() {
    try {
      const stored = localStorage.getItem("ai-strategy-config");
      if (stored) {
        const config = JSON.parse(stored);
        if (config.localAIConfig) {
          this._localAIConfig.set(config.localAIConfig);
        }
        if (config.selectedModelId) {
          this._selectedModelId.set(config.selectedModelId);
        }
      }
      this.loadSavedStrategies();
    } catch (e) {
      console.error("Failed to load AI strategy config:", e);
    }
  }
  saveConfig() {
    try {
      localStorage.setItem("ai-strategy-config", JSON.stringify({
        localAIConfig: this._localAIConfig(),
        selectedModelId: this._selectedModelId()
      }));
    } catch (e) {
      console.error("Failed to save AI strategy config:", e);
    }
  }
  // ============ 🔧 策略持久化 ============
  /**
   * 加載已保存的策略
   */
  loadSavedStrategies() {
    try {
      const stored = localStorage.getItem("ai-saved-strategies");
      if (stored) {
        const strategies = JSON.parse(stored);
        this._savedStrategies.set(strategies);
        console.log(`[AIStrategy] \u5DF2\u52A0\u8F09 ${strategies.length} \u500B\u4FDD\u5B58\u7684\u7B56\u7565`);
      }
    } catch (e) {
      console.error("Failed to load saved strategies:", e);
    }
  }
  /**
   * 保存策略
   */
  saveStrategy(strategy, name) {
    const savedStrategy = {
      id: `strategy-${Date.now()}`,
      name: name || `${strategy.industry} - ${(/* @__PURE__ */ new Date()).toLocaleDateString("zh-TW")}`,
      strategy,
      createdAt: (/* @__PURE__ */ new Date()).toISOString(),
      updatedAt: (/* @__PURE__ */ new Date()).toISOString(),
      usedCount: 0
    };
    const strategies = [...this._savedStrategies(), savedStrategy];
    this._savedStrategies.set(strategies);
    this._currentStrategy.set(strategy);
    try {
      localStorage.setItem("ai-saved-strategies", JSON.stringify(strategies));
    } catch (e) {
      console.error("Failed to save strategies:", e);
    }
    this.toastService.success("\u7B56\u7565\u5DF2\u4FDD\u5B58\uFF01");
    return savedStrategy;
  }
  /**
   * 加載策略
   */
  loadStrategy(strategyId) {
    const saved = this._savedStrategies().find((s) => s.id === strategyId);
    if (saved) {
      saved.usedCount++;
      saved.updatedAt = (/* @__PURE__ */ new Date()).toISOString();
      this._currentStrategy.set(saved.strategy);
      this.persistStrategies();
      return saved.strategy;
    }
    return null;
  }
  /**
   * 刪除策略
   */
  deleteStrategy(strategyId) {
    const strategies = this._savedStrategies().filter((s) => s.id !== strategyId);
    this._savedStrategies.set(strategies);
    this.persistStrategies();
    this.toastService.success("\u7B56\u7565\u5DF2\u522A\u9664");
  }
  /**
   * 設置當前策略
   */
  setCurrentStrategy(strategy) {
    this._currentStrategy.set(strategy);
  }
  /**
   * 持久化策略列表
   */
  persistStrategies() {
    try {
      localStorage.setItem("ai-saved-strategies", JSON.stringify(this._savedStrategies()));
    } catch (e) {
      console.error("Failed to persist strategies:", e);
    }
  }
  static {
    this.\u0275fac = function AIStrategyService_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _AIStrategyService)();
    };
  }
  static {
    this.\u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({ token: _AIStrategyService, factory: _AIStrategyService.\u0275fac, providedIn: "root" });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AIStrategyService, [{
    type: Injectable,
    args: [{
      providedIn: "root"
    }]
  }], () => [], null);
})();

// src/ai-assistant/ai-marketing-assistant.component.ts
var _forTrack017 = ($index, $item) => $item.id;
function AiMarketingAssistantComponent_Case_11_Conditional_24_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 18);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.connectedModelsCount(), " \u500B\u5DF2\u9023\u63A5 ");
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_25_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 19);
    \u0275\u0275text(1, "\u672A\u914D\u7F6E");
    \u0275\u0275elementEnd();
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_28_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 21)(1, "p", 26);
    \u0275\u0275text(2, "\u26A0\uFE0F \u5C1A\u672A\u914D\u7F6E\u4EFB\u4F55 AI \u6A21\u578B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 27);
    \u0275\u0275text(4, "\u8ACB\u5148\u5728 AI \u4E2D\u5FC3\u914D\u7F6E\u4E26\u6E2C\u8A66 AI \u6A21\u578B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "button", 28);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_11_Conditional_28_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.goToAICenter());
    });
    \u0275\u0275text(6, " \u{1F680} \u524D\u5F80\u914D\u7F6E AI ");
    \u0275\u0275elementEnd()();
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_1_For_6_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 38);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const model_r5 = \u0275\u0275nextContext().$implicit;
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275classMap(ctx_r1.getCapabilityStyle(model_r5.capability));
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.getCapabilityLabel(model_r5.capability), " ");
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_1_For_6_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 35);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_1_For_6_Template_button_click_0_listener() {
      const model_r5 = \u0275\u0275restoreView(_r4).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r1.selectModel(model_r5.id));
    });
    \u0275\u0275elementStart(1, "span");
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span");
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(5, AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_1_For_6_Conditional_5_Template, 2, 3, "span", 36);
    \u0275\u0275element(6, "span", 37);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const model_r5 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275classMap(ctx_r1.selectedModelId() === model_r5.id ? "bg-emerald-500/30 text-emerald-400 border-2 border-emerald-500/50 shadow-lg shadow-emerald-500/20" : "bg-slate-700/50 text-slate-300 border border-slate-600 hover:bg-slate-600/50 hover:border-emerald-500/30");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(model_r5.icon);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(model_r5.name);
    \u0275\u0275advance();
    \u0275\u0275conditional(model_r5.capability ? 5 : -1);
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div")(1, "p", 31);
    \u0275\u0275element(2, "span", 32);
    \u0275\u0275text(3, " \u53EF\u7528\u6A21\u578B ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 33);
    \u0275\u0275repeaterCreate(5, AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_1_For_6_Template, 7, 5, "button", 34, _forTrack017);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(5);
    \u0275\u0275repeater(ctx_r1.connectedModels());
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_2_For_6_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 41);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_2_For_6_Template_button_click_0_listener() {
      const model_r7 = \u0275\u0275restoreView(_r6).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r1.selectModel(model_r7.id));
    });
    \u0275\u0275elementStart(1, "span");
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span");
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "span", 42);
    \u0275\u0275text(6, "\u672A\u6E2C\u8A66");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const model_r7 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(4);
    \u0275\u0275classMap(ctx_r1.selectedModelId() === model_r7.id ? "bg-slate-600/50 text-slate-300 border border-slate-500" : "bg-slate-800/50 text-slate-500 border border-slate-700 hover:opacity-80");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(model_r7.icon);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(model_r7.name);
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div")(1, "p", 31);
    \u0275\u0275element(2, "span", 39);
    \u0275\u0275text(3, " \u672A\u9023\u63A5\uFF08\u9700\u8981\u6E2C\u8A66\uFF09 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 33);
    \u0275\u0275repeaterCreate(5, AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_2_For_6_Template, 7, 4, "button", 40, _forTrack017);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(5);
    \u0275\u0275repeater(ctx_r1.disconnectedModels());
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 30);
    \u0275\u0275text(1, " \u{1F4A1} \u512A\u5148\u4F7F\u7528\u672C\u5730 AI\uFF08\u514D\u8CBB\u7121\u9650\uFF09\uFF0C\u96F2\u7AEF AI \u6309\u4F7F\u7528\u91CF\u8A08\u8CBB ");
    \u0275\u0275elementEnd();
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_29_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 29);
    \u0275\u0275conditionalCreate(1, AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_1_Template, 7, 0, "div");
    \u0275\u0275conditionalCreate(2, AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_2_Template, 7, 0, "div");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(3, AiMarketingAssistantComponent_Case_11_Conditional_29_Conditional_3_Template, 2, 0, "p", 30);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.connectedModels().length > 0 ? 1 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.disconnectedModels().length > 0 ? 2 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.connectedModels().length > 0 ? 3 : -1);
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_30_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 45);
    \u0275\u0275text(1, "\u2713 \u5DF2\u9023\u63A5");
    \u0275\u0275elementEnd();
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_30_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 46);
    \u0275\u0275text(1, "\u672A\u9023\u63A5");
    \u0275\u0275elementEnd();
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_30_For_22_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "span", 60);
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_30_For_22_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 42);
    \u0275\u0275text(1, "\u672A\u914D\u7F6E");
    \u0275\u0275elementEnd();
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_30_For_22_Template(rf, ctx) {
  if (rf & 1) {
    const _r9 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 55);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_11_Conditional_30_For_22_Template_div_click_0_listener() {
      const model_r10 = \u0275\u0275restoreView(_r9).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.selectModel(model_r10.id));
    });
    \u0275\u0275elementStart(1, "div", 56)(2, "span", 57);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 58)(5, "div", 59);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div", 42);
    \u0275\u0275text(8);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(9, AiMarketingAssistantComponent_Case_11_Conditional_30_For_22_Conditional_9_Template, 1, 0, "span", 60)(10, AiMarketingAssistantComponent_Case_11_Conditional_30_For_22_Conditional_10_Template, 2, 0, "span", 42);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const model_r10 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275classMap(ctx_r1.selectedModelId() === model_r10.id ? "bg-purple-500/20 border-purple-500/50" : "bg-slate-800/50 border-slate-700 hover:border-slate-500");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(model_r10.icon);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(model_r10.name);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(model_r10.provider);
    \u0275\u0275advance();
    \u0275\u0275conditional(model_r10.isConnected ? 9 : !model_r10.isLocal ? 10 : -1);
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_30_Template(rf, ctx) {
  if (rf & 1) {
    const _r8 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 22)(1, "div", 43)(2, "h4", 44);
    \u0275\u0275text(3, " \u{1F999} \u672C\u5730 Ollama \u914D\u7F6E ");
    \u0275\u0275conditionalCreate(4, AiMarketingAssistantComponent_Case_11_Conditional_30_Conditional_4_Template, 2, 0, "span", 45)(5, AiMarketingAssistantComponent_Case_11_Conditional_30_Conditional_5_Template, 2, 0, "span", 46);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "div", 47)(7, "div")(8, "label", 48);
    \u0275\u0275text(9, "API \u7AEF\u9EDE");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "input", 49);
    \u0275\u0275listener("change", function AiMarketingAssistantComponent_Case_11_Conditional_30_Template_input_change_10_listener($event) {
      \u0275\u0275restoreView(_r8);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.updateLocalEndpoint($event.target.value));
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(11, "div")(12, "label", 48);
    \u0275\u0275text(13, "\u6A21\u578B\u540D\u7A31");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "input", 50);
    \u0275\u0275listener("change", function AiMarketingAssistantComponent_Case_11_Conditional_30_Template_input_change_14_listener($event) {
      \u0275\u0275restoreView(_r8);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.updateLocalModel($event.target.value));
    });
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(15, "button", 51);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_11_Conditional_30_Template_button_click_15_listener() {
      \u0275\u0275restoreView(_r8);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.testLocalAI());
    });
    \u0275\u0275text(16, " \u{1F517} \u6E2C\u8A66\u9023\u63A5 ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(17, "div")(18, "h4", 52);
    \u0275\u0275text(19, "\u53EF\u7528\u6A21\u578B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(20, "div", 53);
    \u0275\u0275repeaterCreate(21, AiMarketingAssistantComponent_Case_11_Conditional_30_For_22_Template, 11, 6, "div", 54, _forTrack017);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(23, "p", 42);
    \u0275\u0275text(24, " \u{1F4A1} \u512A\u5148\u4F7F\u7528\u672C\u5730 AI (\u514D\u8CBB\u3001\u96B1\u79C1)\uFF0C\u672C\u5730\u4E0D\u53EF\u7528\u6642\u81EA\u52D5\u5207\u63DB\u5230\u96F2\u7AEF AI ");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(4);
    \u0275\u0275conditional(ctx_r1.localAIConfig().isConnected ? 4 : 5);
    \u0275\u0275advance(6);
    \u0275\u0275property("value", ctx_r1.localAIConfig().endpoint);
    \u0275\u0275advance(4);
    \u0275\u0275property("value", ctx_r1.localAIConfig().model);
    \u0275\u0275advance(7);
    \u0275\u0275repeater(ctx_r1.availableModels());
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_33_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 61);
    \u0275\u0275text(1, "\u27F3");
    \u0275\u0275elementEnd();
    \u0275\u0275text(2, " AI \u5206\u6790\u4E2D... ");
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_34_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u{1F680} \u751F\u6210 AI \u71DF\u92B7\u7B56\u7565 ");
  }
}
function AiMarketingAssistantComponent_Case_11_Conditional_35_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 25)(1, "div", 62)(2, "span", 63);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span", 64);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div", 65);
    \u0275\u0275element(7, "div", 66);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r1.generationStatus().message);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r1.generationStatus().currentProvider);
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("width", ctx_r1.generationStatus().progress, "%");
  }
}
function AiMarketingAssistantComponent_Case_11_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 7)(1, "div", 9)(2, "label", 10);
    \u0275\u0275text(3, " \u{1F4AC} \u544A\u8A34\u6211\u4F60\u60F3\u627E\u4EC0\u9EBC\u6A23\u7684\u5BA2\u6236\uFF1F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "textarea", 11);
    \u0275\u0275twoWayListener("ngModelChange", function AiMarketingAssistantComponent_Case_11_Template_textarea_ngModelChange_4_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.userInput, $event) || (ctx_r1.userInput = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275listener("keydown.enter", function AiMarketingAssistantComponent_Case_11_Template_textarea_keydown_enter_4_listener($event) {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView($event.ctrlKey && ctx_r1.generateStrategy());
    });
    \u0275\u0275text(5, "                ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "p", 12);
    \u0275\u0275text(7, "\u{1F4A1} \u63D0\u793A\uFF1A\u63CF\u8FF0\u8D8A\u8A73\u7D30\uFF0CAI \u5206\u6790\u8D8A\u7CBE\u6E96");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(8, "div", 9)(9, "label", 13);
    \u0275\u0275text(10, "\u26A1 \u5FEB\u901F\u9078\u64C7\u884C\u696D\u6A21\u677F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "div", 14)(12, "button", 15);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_11_Template_button_click_12_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.selectIndustry("payment"));
    });
    \u0275\u0275text(13, " \u{1F4B3} \u652F\u4ED8/\u63DB\u532F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "button", 15);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_11_Template_button_click_14_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.selectIndustry("crypto"));
    });
    \u0275\u0275text(15, " \u{1FA99} \u52A0\u5BC6\u8CA8\u5E63 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "button", 15);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_11_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.selectIndustry("ecommerce"));
    });
    \u0275\u0275text(17, " \u{1F6D2} \u96FB\u5546/\u8DE8\u5883 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "button", 15);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_11_Template_button_click_18_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.selectIndustry("custom"));
    });
    \u0275\u0275text(19, " \u270F\uFE0F \u81EA\u5B9A\u7FA9 ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(20, "div", 9)(21, "div", 16)(22, "label", 17);
    \u0275\u0275text(23, " \u{1F916} AI \u6A21\u578B ");
    \u0275\u0275conditionalCreate(24, AiMarketingAssistantComponent_Case_11_Conditional_24_Template, 2, 1, "span", 18)(25, AiMarketingAssistantComponent_Case_11_Conditional_25_Template, 2, 0, "span", 19);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(26, "a", 20);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_11_Template_a_click_26_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.goToAICenter());
    });
    \u0275\u0275text(27, " \u2699\uFE0F \u524D\u5F80 AI \u4E2D\u5FC3 ");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(28, AiMarketingAssistantComponent_Case_11_Conditional_28_Template, 7, 0, "div", 21)(29, AiMarketingAssistantComponent_Case_11_Conditional_29_Template, 4, 3);
    \u0275\u0275conditionalCreate(30, AiMarketingAssistantComponent_Case_11_Conditional_30_Template, 25, 3, "div", 22);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(31, "div", 23)(32, "button", 24);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_11_Template_button_click_32_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.generateStrategy());
    });
    \u0275\u0275conditionalCreate(33, AiMarketingAssistantComponent_Case_11_Conditional_33_Template, 3, 0)(34, AiMarketingAssistantComponent_Case_11_Conditional_34_Template, 1, 0);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(35, AiMarketingAssistantComponent_Case_11_Conditional_35_Template, 8, 4, "div", 25);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(4);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.userInput);
    \u0275\u0275advance(8);
    \u0275\u0275classMap(ctx_r1.selectedIndustry() === "payment" ? "bg-purple-500 text-white" : "bg-slate-700 text-slate-300 hover:bg-slate-600");
    \u0275\u0275advance(2);
    \u0275\u0275classMap(ctx_r1.selectedIndustry() === "crypto" ? "bg-purple-500 text-white" : "bg-slate-700 text-slate-300 hover:bg-slate-600");
    \u0275\u0275advance(2);
    \u0275\u0275classMap(ctx_r1.selectedIndustry() === "ecommerce" ? "bg-purple-500 text-white" : "bg-slate-700 text-slate-300 hover:bg-slate-600");
    \u0275\u0275advance(2);
    \u0275\u0275classMap(ctx_r1.selectedIndustry() === "custom" ? "bg-purple-500 text-white" : "bg-slate-700 text-slate-300 hover:bg-slate-600");
    \u0275\u0275advance(6);
    \u0275\u0275conditional(ctx_r1.connectedModelsCount() > 0 ? 24 : 25);
    \u0275\u0275advance(4);
    \u0275\u0275conditional(ctx_r1.availableModels().length === 0 ? 28 : 29);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.showModelSettings() ? 30 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275property("disabled", ctx_r1.isGenerating() || !ctx_r1.userInput && ctx_r1.selectedIndustry() === "custom");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isGenerating() ? 33 : 34);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.isGenerating() ? 35 : -1);
  }
}
function AiMarketingAssistantComponent_Case_12_Conditional_0_For_39_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 77);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const keyword_r12 = ctx.$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", keyword_r12, " ");
  }
}
function AiMarketingAssistantComponent_Case_12_Conditional_0_For_48_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 81);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const keyword_r13 = ctx.$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", keyword_r13, " ");
  }
}
function AiMarketingAssistantComponent_Case_12_Conditional_0_For_57_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 84);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const keyword_r14 = ctx.$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", keyword_r14, " ");
  }
}
function AiMarketingAssistantComponent_Case_12_Conditional_0_For_71_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "li", 88)(1, "span", 101);
    \u0275\u0275text(2, "\u2022");
    \u0275\u0275elementEnd();
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const item_r15 = ctx.$implicit;
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", item_r15, " ");
  }
}
function AiMarketingAssistantComponent_Case_12_Conditional_0_For_77_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "li", 88)(1, "span", 102);
    \u0275\u0275text(2, "\u2022");
    \u0275\u0275elementEnd();
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const item_r16 = ctx.$implicit;
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", item_r16, " ");
  }
}
function AiMarketingAssistantComponent_Case_12_Conditional_0_For_83_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "li", 88)(1, "span", 103);
    \u0275\u0275text(2, "\u2022");
    \u0275\u0275elementEnd();
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const item_r17 = ctx.$implicit;
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", item_r17, " ");
  }
}
function AiMarketingAssistantComponent_Case_12_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r11 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 67)(1, "div", 68)(2, "span", 69);
    \u0275\u0275text(3, "\u2728");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div")(5, "p", 70);
    \u0275\u0275text(6, "AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "p", 5);
    \u0275\u0275text(8, "\u6839\u64DA\u60A8\u7684\u9700\u6C42\uFF0CAI \u5DF2\u751F\u6210\u4EE5\u4E0B\u71DF\u92B7\u7B56\u7565");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(9, "div", 9)(10, "h3", 71)(11, "span");
    \u0275\u0275text(12, "\u{1F4CA}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(13, " \u884C\u696D\u5206\u6790 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "div", 72)(15, "div")(16, "label", 63);
    \u0275\u0275text(17, "\u76EE\u6A19\u884C\u696D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "p", 73);
    \u0275\u0275text(19);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(20, "div")(21, "label", 63);
    \u0275\u0275text(22, "\u76EE\u6A19\u53D7\u773E");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(23, "p", 73);
    \u0275\u0275text(24);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(25, "div", 9)(26, "h3", 71)(27, "span");
    \u0275\u0275text(28, "\u{1F511}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(29, " AI \u63A8\u85A6\u95DC\u9375\u8A5E ");
    \u0275\u0275elementStart(30, "span", 74);
    \u0275\u0275text(31, "\u9EDE\u64CA\u53EF\u7DE8\u8F2F");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(32, "div", 75)(33, "div")(34, "label", 76);
    \u0275\u0275element(35, "span", 37);
    \u0275\u0275text(36, " \u9AD8\u610F\u5411\u95DC\u9375\u8A5E ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(37, "div", 33);
    \u0275\u0275repeaterCreate(38, AiMarketingAssistantComponent_Case_12_Conditional_0_For_39_Template, 2, 1, "span", 77, \u0275\u0275repeaterTrackByIndex);
    \u0275\u0275elementStart(40, "button", 78);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_12_Conditional_0_Template_button_click_40_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.addKeyword("high"));
    });
    \u0275\u0275text(41, " + \u6DFB\u52A0 ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(42, "div")(43, "label", 79);
    \u0275\u0275element(44, "span", 80);
    \u0275\u0275text(45, " \u4E2D\u610F\u5411\u95DC\u9375\u8A5E ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(46, "div", 33);
    \u0275\u0275repeaterCreate(47, AiMarketingAssistantComponent_Case_12_Conditional_0_For_48_Template, 2, 1, "span", 81, \u0275\u0275repeaterTrackByIndex);
    \u0275\u0275elementStart(49, "button", 78);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_12_Conditional_0_Template_button_click_49_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.addKeyword("medium"));
    });
    \u0275\u0275text(50, " + \u6DFB\u52A0 ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(51, "div")(52, "label", 82);
    \u0275\u0275element(53, "span", 83);
    \u0275\u0275text(54, " \u64F4\u5C55\u95DC\u9375\u8A5E ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(55, "div", 33);
    \u0275\u0275repeaterCreate(56, AiMarketingAssistantComponent_Case_12_Conditional_0_For_57_Template, 2, 1, "span", 84, \u0275\u0275repeaterTrackByIndex);
    \u0275\u0275elementStart(58, "button", 78);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_12_Conditional_0_Template_button_click_58_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.addKeyword("extended"));
    });
    \u0275\u0275text(59, " + \u6DFB\u52A0 ");
    \u0275\u0275elementEnd()()()()();
    \u0275\u0275elementStart(60, "div", 9)(61, "h3", 71)(62, "span");
    \u0275\u0275text(63, "\u{1F465}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(64, " \u76EE\u6A19\u5BA2\u6236\u756B\u50CF ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(65, "div", 85)(66, "div")(67, "label", 86);
    \u0275\u0275text(68, "\u8EAB\u4EFD\u7279\u5FB5");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(69, "ul", 87);
    \u0275\u0275repeaterCreate(70, AiMarketingAssistantComponent_Case_12_Conditional_0_For_71_Template, 4, 1, "li", 88, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(72, "div")(73, "label", 86);
    \u0275\u0275text(74, "\u884C\u70BA\u7279\u5FB5");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(75, "ul", 87);
    \u0275\u0275repeaterCreate(76, AiMarketingAssistantComponent_Case_12_Conditional_0_For_77_Template, 4, 1, "li", 88, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(78, "div")(79, "label", 86);
    \u0275\u0275text(80, "\u6838\u5FC3\u9700\u6C42");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(81, "ul", 87);
    \u0275\u0275repeaterCreate(82, AiMarketingAssistantComponent_Case_12_Conditional_0_For_83_Template, 4, 1, "li", 88, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(84, "div", 9)(85, "h3", 71)(86, "span");
    \u0275\u0275text(87, "\u{1F4AC}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(88, " AI \u751F\u6210\u8A71\u8853\u6A21\u677F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(89, "div", 75)(90, "div")(91, "label", 89);
    \u0275\u0275text(92, "\u9996\u6B21\u89F8\u9054");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(93, "textarea", 90);
    \u0275\u0275twoWayListener("ngModelChange", function AiMarketingAssistantComponent_Case_12_Conditional_0_Template_textarea_ngModelChange_93_listener($event) {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.editableTemplates.firstTouch, $event) || (ctx_r1.editableTemplates.firstTouch = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275text(94, "                      ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(95, "div")(96, "label", 91);
    \u0275\u0275text(97, "\u8DDF\u9032\u8A71\u8853");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(98, "textarea", 90);
    \u0275\u0275twoWayListener("ngModelChange", function AiMarketingAssistantComponent_Case_12_Conditional_0_Template_textarea_ngModelChange_98_listener($event) {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.editableTemplates.followUp, $event) || (ctx_r1.editableTemplates.followUp = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275text(99, "                      ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(100, "div")(101, "label", 92);
    \u0275\u0275text(102, "\u4FC3\u6210\u8A71\u8853");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(103, "textarea", 90);
    \u0275\u0275twoWayListener("ngModelChange", function AiMarketingAssistantComponent_Case_12_Conditional_0_Template_textarea_ngModelChange_103_listener($event) {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.editableTemplates.closing, $event) || (ctx_r1.editableTemplates.closing = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275text(104, "                      ");
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(105, "div", 93)(106, "button", 94);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_12_Conditional_0_Template_button_click_106_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.backToInput());
    });
    \u0275\u0275text(107, " \u2190 \u8FD4\u56DE\u4FEE\u6539 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(108, "div", 95)(109, "button", 96);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_12_Conditional_0_Template_button_click_109_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.saveStrategy());
    });
    \u0275\u0275text(110, " \u{1F4BE} \u4FDD\u5B58\u7B56\u7565 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(111, "button", 97);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_12_Conditional_0_Template_button_click_111_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.handoverToAITeam());
    });
    \u0275\u0275text(112, " \u{1F916} \u4EA4\u7D66 AI \u5718\u968A ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(113, "button", 98);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Case_12_Conditional_0_Template_button_click_113_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.startAutomation());
    });
    \u0275\u0275text(114, " \u{1F680} \u624B\u52D5\u57F7\u884C ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(115, "div", 99)(116, "div", 100)(117, "span", 69);
    \u0275\u0275text(118, "\u{1F4A1}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(119, "div")(120, "p", 73);
    \u0275\u0275text(121, "\u63A8\u85A6\u4F7F\u7528\u300C\u4EA4\u7D66 AI \u5718\u968A\u300D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(122, "p", 5);
    \u0275\u0275text(123, "AI \u6703\u81EA\u52D5\u7D44\u5EFA\u5718\u968A\u3001\u5206\u914D\u89D2\u8272\u3001\u5236\u5B9A\u8A71\u8853\uFF0C24/7 \u667A\u80FD\u92B7\u552E");
    \u0275\u0275elementEnd()()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(19);
    \u0275\u0275textInterpolate(ctx_r1.strategyResult().industry);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r1.strategyResult().targetAudience);
    \u0275\u0275advance(14);
    \u0275\u0275repeater(ctx_r1.strategyResult().keywords.highIntent);
    \u0275\u0275advance(9);
    \u0275\u0275repeater(ctx_r1.strategyResult().keywords.mediumIntent);
    \u0275\u0275advance(9);
    \u0275\u0275repeater(ctx_r1.strategyResult().keywords.extended);
    \u0275\u0275advance(14);
    \u0275\u0275repeater(ctx_r1.strategyResult().customerProfile.identity);
    \u0275\u0275advance(6);
    \u0275\u0275repeater(ctx_r1.strategyResult().customerProfile.features);
    \u0275\u0275advance(6);
    \u0275\u0275repeater(ctx_r1.strategyResult().customerProfile.needs);
    \u0275\u0275advance(11);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.editableTemplates.firstTouch);
    \u0275\u0275advance(5);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.editableTemplates.followUp);
    \u0275\u0275advance(5);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.editableTemplates.closing);
  }
}
function AiMarketingAssistantComponent_Case_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275conditionalCreate(0, AiMarketingAssistantComponent_Case_12_Conditional_0_Template, 124, 5, "div", 67);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275conditional(ctx_r1.strategyResult() ? 0 : -1);
  }
}
function AiMarketingAssistantComponent_Conditional_13_Template(rf, ctx) {
  if (rf & 1) {
    const _r18 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 104);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Conditional_13_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r18);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.cancelAddKeyword());
    });
    \u0275\u0275elementStart(1, "div", 105);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Conditional_13_Template_div_click_1_listener($event) {
      \u0275\u0275restoreView(_r18);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275elementStart(2, "h3", 106)(3, "span", 107);
    \u0275\u0275text(4, "\u{1F3F7}\uFE0F");
    \u0275\u0275elementEnd();
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "input", 108);
    \u0275\u0275twoWayListener("ngModelChange", function AiMarketingAssistantComponent_Conditional_13_Template_input_ngModelChange_6_listener($event) {
      \u0275\u0275restoreView(_r18);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.newKeywordInput, $event) || (ctx_r1.newKeywordInput = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275listener("keydown.enter", function AiMarketingAssistantComponent_Conditional_13_Template_input_keydown_enter_6_listener() {
      \u0275\u0275restoreView(_r18);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.confirmAddKeyword());
    })("keydown.escape", function AiMarketingAssistantComponent_Conditional_13_Template_input_keydown_escape_6_listener() {
      \u0275\u0275restoreView(_r18);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.cancelAddKeyword());
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div", 109)(8, "button", 110);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Conditional_13_Template_button_click_8_listener() {
      \u0275\u0275restoreView(_r18);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.cancelAddKeyword());
    });
    \u0275\u0275text(9, " \u53D6\u6D88 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "button", 111);
    \u0275\u0275listener("click", function AiMarketingAssistantComponent_Conditional_13_Template_button_click_10_listener() {
      \u0275\u0275restoreView(_r18);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.confirmAddKeyword());
    });
    \u0275\u0275text(11, " \u78BA\u5B9A\u6DFB\u52A0 ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate1(" \u6DFB\u52A0", ctx_r1.getKeywordLevelLabel(ctx_r1.keywordDialogLevel()), "\u95DC\u9375\u8A5E ");
    \u0275\u0275advance();
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.newKeywordInput);
    \u0275\u0275advance(4);
    \u0275\u0275property("disabled", !ctx_r1.newKeywordInput.trim());
  }
}
var INDUSTRY_TEMPLATES = {
  "payment": {
    industry: "\u652F\u4ED8/\u63DB\u532F",
    keywords: {
      highIntent: ["\u652F\u4ED8\u901A\u9053", "U\u5546", "\u63DB\u532F", "USDT", "\u4EE3\u6536\u4EE3\u4ED8", "\u8DD1\u5206"],
      mediumIntent: ["\u56DB\u65B9\u652F\u4ED8", "\u4E09\u65B9\u652F\u4ED8", "API\u5C0D\u63A5", "\u627F\u514C\u5546"],
      extended: ["OTC", "\u6536\u6B3E", "\u51FA\u6B3E", "\u8CBB\u7387", "T+0", "T+1"]
    },
    recommendedGroups: ["\u652F\u4ED8\u884C\u696D\u4EA4\u6D41\u7FA4", "USDT/\u63DB\u532F\u4EA4\u6613\u7FA4", "\u9805\u76EE\u5C0D\u63A5\u7FA4"]
  },
  "crypto": {
    industry: "\u52A0\u5BC6\u8CA8\u5E63",
    keywords: {
      highIntent: ["BTC", "ETH", "\u5408\u7D04", "\u73FE\u8CA8", "\u4EA4\u6613\u6240"],
      mediumIntent: ["DeFi", "NFT", "\u9322\u5305", "\u516C\u93C8"],
      extended: ["\u6316\u7926", "\u8CEA\u62BC", "\u7A7A\u6295", "IDO"]
    },
    recommendedGroups: ["\u5E63\u5708\u4EA4\u6D41\u7FA4", "\u5408\u7D04\u4EA4\u6613\u7FA4", "\u9805\u76EE\u9996\u767C\u7FA4"]
  },
  "ecommerce": {
    industry: "\u96FB\u5546/\u8DE8\u5883",
    keywords: {
      highIntent: ["\u4E9E\u99AC\u905C", "\u7368\u7ACB\u7AD9", "Shopify", "\u7269\u6D41", "\u9078\u54C1"],
      mediumIntent: ["FBA", "\u6D77\u5916\u5009", "\u6E05\u95DC", "\u652F\u4ED8"],
      extended: ["\u6E2C\u8A55", "\u5237\u55AE", "\u7AD9\u5916\u63A8\u5EE3"]
    },
    recommendedGroups: ["\u8DE8\u5883\u96FB\u5546\u4EA4\u6D41\u7FA4", "\u4E9E\u99AC\u905C\u8CE3\u5BB6\u7FA4", "\u7269\u6D41\u5C0D\u63A5\u7FA4"]
  }
};
var AiMarketingAssistantComponent = class _AiMarketingAssistantComponent {
  constructor() {
    this.ipcService = inject(ElectronIpcService);
    this.toastService = inject(ToastService);
    this.aiStrategyService = inject(AIStrategyService);
    this.startAutomationEvent = output();
    this.handoverToAITeamEvent = output();
    this.navigateEvent = output();
    this.currentStep = signal("input", ...ngDevMode ? [{ debugName: "currentStep" }] : []);
    this.userInput = "";
    this.selectedIndustry = signal("custom", ...ngDevMode ? [{ debugName: "selectedIndustry" }] : []);
    this.isGenerating = signal(false, ...ngDevMode ? [{ debugName: "isGenerating" }] : []);
    this.strategyResult = signal(null, ...ngDevMode ? [{ debugName: "strategyResult" }] : []);
    this.showModelSettings = signal(false, ...ngDevMode ? [{ debugName: "showModelSettings" }] : []);
    this.availableModels = this.aiStrategyService.availableModels;
    this.selectedModelId = this.aiStrategyService.selectedModelId;
    this.showKeywordDialog = signal(false, ...ngDevMode ? [{ debugName: "showKeywordDialog" }] : []);
    this.keywordDialogLevel = signal("high", ...ngDevMode ? [{ debugName: "keywordDialogLevel" }] : []);
    this.newKeywordInput = "";
    this.localAIConfig = this.aiStrategyService.localAIConfig;
    this.generationStatus = this.aiStrategyService.generationStatus;
    this.connectedModels = computed(() => this.availableModels().filter((m) => m.isConnected), ...ngDevMode ? [{ debugName: "connectedModels" }] : []);
    this.disconnectedModels = computed(() => this.availableModels().filter((m) => !m.isConnected), ...ngDevMode ? [{ debugName: "disconnectedModels" }] : []);
    this.connectedModelsCount = computed(() => this.connectedModels().length, ...ngDevMode ? [{ debugName: "connectedModelsCount" }] : []);
    this.editableTemplates = {
      firstTouch: "",
      followUp: "",
      closing: ""
    };
  }
  ngOnInit() {
    this.setupEventListeners();
    this.aiStrategyService.refreshAvailableModels();
  }
  setupEventListeners() {
    this.ipcService.on("ai-strategy-generated", (data) => {
      this.isGenerating.set(false);
      if (data.success) {
        this.strategyResult.set(data.strategy);
        this.editableTemplates = __spreadValues({}, data.strategy.messageTemplates);
        this.currentStep.set("result");
        this.toastService.success("AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01");
      } else {
        this.toastService.error(`\u751F\u6210\u5931\u6557: ${data.error}`);
      }
    });
  }
  // 導航到 AI 中心
  goToAICenter() {
    this.navigateEvent.emit("ai-center");
    this.toastService.info("\u524D\u5F80 AI \u4E2D\u5FC3\u914D\u7F6E\u6A21\u578B...");
  }
  // AI 模型設置
  selectModel(modelId) {
    this.aiStrategyService.selectModel(modelId);
  }
  // 能力標籤樣式
  getCapabilityStyle(capability) {
    switch (capability) {
      case "fast":
        return "bg-cyan-500/20 text-cyan-400";
      case "powerful":
        return "bg-purple-500/20 text-purple-400";
      case "economic":
        return "bg-green-500/20 text-green-400";
      case "balanced":
        return "bg-amber-500/20 text-amber-400";
      default:
        return "bg-slate-500/20 text-slate-400";
    }
  }
  // 能力標籤文字
  getCapabilityLabel(capability) {
    switch (capability) {
      case "fast":
        return "\u5FEB\u901F";
      case "powerful":
        return "\u5F37\u5927";
      case "economic":
        return "\u7D93\u6FDF";
      case "balanced":
        return "\u5747\u8861";
      default:
        return "";
    }
  }
  async testLocalAI() {
    await this.aiStrategyService.testLocalAIConnection();
  }
  updateLocalEndpoint(endpoint) {
    this.aiStrategyService.updateLocalAIConfig({ endpoint });
  }
  updateLocalModel(model) {
    this.aiStrategyService.updateLocalAIConfig({ model });
  }
  selectIndustry(industry) {
    this.selectedIndustry.set(industry);
    if (industry !== "custom") {
      const template = INDUSTRY_TEMPLATES[industry];
      if (template) {
        this.userInput = `\u6211\u60F3\u627E${template.industry}\u884C\u696D\u7684\u5BA2\u6236`;
      }
    }
  }
  async generateStrategy() {
    if (!this.userInput && this.selectedIndustry() === "custom") {
      this.toastService.warning("\u8ACB\u8F38\u5165\u60A8\u7684\u9700\u6C42\u6216\u9078\u64C7\u4E00\u500B\u884C\u696D\u6A21\u677F");
      return;
    }
    this.isGenerating.set(true);
    const inputText = this.userInput || `\u6211\u60F3\u627E${INDUSTRY_TEMPLATES[this.selectedIndustry()]?.industry || "\u76EE\u6A19\u884C\u696D"}\u7684\u5BA2\u6236`;
    try {
      const result = await this.aiStrategyService.generateStrategy(inputText);
      if (result) {
        this.strategyResult.set(result);
        this.editableTemplates = __spreadValues({}, result.messageTemplates);
        this.currentStep.set("result");
        const status = this.generationStatus();
        if (status.currentProvider === "\u6A21\u677F\u56DE\u9000") {
          this.toastService.warning("\u96F2\u7AEF AI \u9023\u63A5\u5931\u6557\uFF0C\u5DF2\u4F7F\u7528\u667A\u80FD\u6A21\u677F\u751F\u6210\u3002\u8ACB\u6AA2\u67E5 AI \u4E2D\u5FC3\u914D\u7F6E\u3002");
        } else if (status.currentProvider.includes("\u672C\u5730")) {
          this.toastService.success(`\u2705 \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01\u4F7F\u7528\uFF1A${status.currentProvider}`);
        } else {
          this.toastService.success(`\u2705 AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01(${status.currentProvider})`);
        }
      } else {
        this.toastService.error("\u7B56\u7565\u751F\u6210\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66");
      }
    } catch (error) {
      console.error("[AIMarketing] \u7B56\u7565\u751F\u6210\u5931\u6557:", error);
      this.toastService.error(`\u751F\u6210\u5931\u6557: ${error.message}`);
    } finally {
      this.isGenerating.set(false);
    }
  }
  generateFromTemplate() {
    const industry = this.selectedIndustry();
    const template = INDUSTRY_TEMPLATES[industry] || INDUSTRY_TEMPLATES["payment"];
    const strategy = {
      industry: template.industry || "\u81EA\u5B9A\u7FA9\u884C\u696D",
      targetAudience: this.extractAudience(this.userInput),
      keywords: template.keywords || {
        highIntent: [],
        mediumIntent: [],
        extended: []
      },
      customerProfile: {
        identity: ["\u4EE3\u7406\u5546", "\u9805\u76EE\u65B9", "\u904B\u71DF\u4EBA\u54E1"],
        features: ["\u6D3B\u8E8D\u5728\u76F8\u95DC\u7FA4\u7D44", "\u7D93\u5E38\u767C\u696D\u52D9\u6D88\u606F", "\u6709\u660E\u78BA\u9700\u6C42"],
        needs: ["\u5C0B\u627E\u5408\u4F5C\u5925\u4F34", "\u89E3\u6C7A\u696D\u52D9\u75DB\u9EDE", "\u7372\u53D6\u66F4\u591A\u8CC7\u6E90"]
      },
      recommendedGroups: template.recommendedGroups || ["\u884C\u696D\u4EA4\u6D41\u7FA4", "\u696D\u52D9\u5C0D\u63A5\u7FA4"],
      messageTemplates: {
        firstTouch: `\u60A8\u597D\uFF01\u770B\u5230\u60A8\u5728\u7FA4\u88E1\u7684\u6D88\u606F\uFF0C\u6211\u5011\u5C08\u6CE8${template.industry || "\u9019\u500B"}\u884C\u696D\uFF0C\u80FD\u70BA\u60A8\u63D0\u4F9B\u5C08\u696D\u670D\u52D9\u3002\u65B9\u4FBF\u804A\u804A\u55CE\uFF1F`,
        followUp: "\u8ACB\u554F\u60A8\u76EE\u524D\u696D\u52D9\u4E0A\u6709\u4EC0\u9EBC\u5177\u9AD4\u9700\u6C42\u55CE\uFF1F\u6211\u5011\u53EF\u4EE5\u6839\u64DA\u60A8\u7684\u60C5\u6CC1\u63D0\u4F9B\u5B9A\u5236\u65B9\u6848\u3002",
        closing: "\u8981\u4E0D\u9019\u6A23\uFF0C\u6211\u5148\u7D66\u60A8\u958B\u500B\u6E2C\u8A66\u8CEC\u865F/\u767C\u500B\u8CC7\u6599\uFF0C\u60A8\u9AD4\u9A57\u4E00\u4E0B\uFF1F"
      },
      automationSettings: {
        monitorMode: "24/7 \u5168\u5929\u5019",
        responseDelay: 30,
        followUpInterval: 7200
      }
    };
    this.strategyResult.set(strategy);
    this.editableTemplates = __spreadValues({}, strategy.messageTemplates);
    this.currentStep.set("result");
    this.isGenerating.set(false);
    this.toastService.success("AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01");
  }
  extractAudience(input2) {
    if (input2.includes("\u4EE3\u7406"))
      return "\u4EE3\u7406\u5546/\u6E20\u9053\u5546";
    if (input2.includes("\u5BA2\u6236"))
      return "\u7D42\u7AEF\u5BA2\u6236";
    if (input2.includes("\u9805\u76EE"))
      return "\u9805\u76EE\u65B9/\u904B\u71DF\u5546";
    return "\u76EE\u6A19\u5BA2\u6236\u7FA4\u9AD4";
  }
  // 🔧 打開關鍵詞輸入對話框（替代 prompt）
  addKeyword(level) {
    this.keywordDialogLevel.set(level);
    this.newKeywordInput = "";
    this.showKeywordDialog.set(true);
  }
  // 🔧 確認添加關鍵詞
  confirmAddKeyword() {
    const keyword = this.newKeywordInput.trim();
    if (keyword && this.strategyResult()) {
      const result = __spreadValues({}, this.strategyResult());
      const level = this.keywordDialogLevel();
      switch (level) {
        case "high":
          result.keywords.highIntent = [...result.keywords.highIntent, keyword];
          break;
        case "medium":
          result.keywords.mediumIntent = [...result.keywords.mediumIntent, keyword];
          break;
        case "extended":
          result.keywords.extended = [...result.keywords.extended, keyword];
          break;
      }
      this.strategyResult.set(result);
      this.toastService.success(`\u5DF2\u6DFB\u52A0\u95DC\u9375\u8A5E: ${keyword}`);
    }
    this.showKeywordDialog.set(false);
    this.newKeywordInput = "";
  }
  // 🔧 取消添加關鍵詞
  cancelAddKeyword() {
    this.showKeywordDialog.set(false);
    this.newKeywordInput = "";
  }
  // 🔧 獲取關鍵詞類型標籤
  getKeywordLevelLabel(level) {
    switch (level) {
      case "high":
        return "\u9AD8\u610F\u5411";
      case "medium":
        return "\u4E2D\u610F\u5411";
      case "extended":
        return "\u64F4\u5C55";
    }
  }
  backToInput() {
    this.currentStep.set("input");
  }
  saveStrategy() {
    const result = this.strategyResult();
    if (result) {
      result.messageTemplates = __spreadValues({}, this.editableTemplates);
      this.ipcService.send("save-ai-strategy", {
        strategy: result
      });
      this.toastService.success("\u7B56\u7565\u5DF2\u4FDD\u5B58\uFF01");
    }
  }
  startAutomation() {
    const result = this.strategyResult();
    if (result) {
      result.messageTemplates = __spreadValues({}, this.editableTemplates);
      this.startAutomationEvent.emit(result);
      this.toastService.success("\u6B63\u5728\u555F\u52D5\u624B\u52D5\u71DF\u92B7...");
    }
  }
  /**
   * 將策略交給 AI 團隊銷售
   * AI 團隊會自動組建團隊、分配角色、制定話術
   */
  handoverToAITeam() {
    const result = this.strategyResult();
    if (result) {
      result.messageTemplates = __spreadValues({}, this.editableTemplates);
      this.handoverToAITeamEvent.emit(result);
      this.toastService.success("\u{1F916} \u6B63\u5728\u5C07\u7B56\u7565\u4EA4\u7D66 AI \u5718\u968A...");
    }
  }
  static {
    this.\u0275fac = function AiMarketingAssistantComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _AiMarketingAssistantComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _AiMarketingAssistantComponent, selectors: [["app-ai-marketing-assistant"]], outputs: { startAutomationEvent: "startAutomationEvent", handoverToAITeamEvent: "handoverToAITeamEvent", navigateEvent: "navigateEvent" }, decls: 14, vars: 2, consts: [[1, "ai-assistant", "h-full", "flex", "flex-col", "bg-gradient-to-br", "from-slate-900", "via-slate-800", "to-slate-900"], [1, "p-6", "border-b", "border-slate-700/50"], [1, "flex", "items-center", "gap-4"], [1, "w-14", "h-14", "rounded-2xl", "bg-gradient-to-br", "from-purple-500", "to-cyan-500", "flex", "items-center", "justify-center", "text-2xl", "shadow-lg", "shadow-purple-500/20"], [1, "text-2xl", "font-bold", "text-white"], [1, "text-slate-400", "text-sm"], [1, "flex-1", "overflow-y-auto", "p-6"], [1, "max-w-3xl", "mx-auto", "space-y-6"], [1, "fixed", "inset-0", "bg-black/60", "backdrop-blur-sm", "z-50", "flex", "items-center", "justify-center"], [1, "bg-slate-800/50", "rounded-2xl", "p-6", "border", "border-slate-700/50"], [1, "block", "text-lg", "font-medium", "text-white", "mb-4"], ["rows", "4", "placeholder", "\u4F8B\u5982\uFF1A\u6211\u60F3\u627E\u652F\u4ED8\u884C\u696D\u7684\u4EE3\u7406\u5546\uFF0C\u4ED6\u5011\u9700\u8981\u6709\u63DB\u532F\u548C\u8DD1\u5206\u9700\u6C42...", 1, "w-full", "bg-slate-900/50", "border", "border-slate-600", "rounded-xl", "p-4", "text-white", "text-lg", "placeholder-slate-500", "focus:border-purple-500", "focus:ring-2", "focus:ring-purple-500/20", "resize-none", 3, "ngModelChange", "keydown.enter", "ngModel"], [1, "text-xs", "text-slate-500", "mt-2"], [1, "block", "text-sm", "font-medium", "text-slate-400", "mb-3"], [1, "flex", "flex-wrap", "gap-3"], [1, "px-4", "py-2", "rounded-xl", "text-sm", "font-medium", "transition-all", 3, "click"], [1, "flex", "items-center", "justify-between", "mb-4"], [1, "text-sm", "font-medium", "text-slate-400", "flex", "items-center", "gap-2"], [1, "px-2", "py-0.5", "bg-emerald-500/20", "text-emerald-400", "rounded-full", "text-xs"], [1, "px-2", "py-0.5", "bg-amber-500/20", "text-amber-400", "rounded-full", "text-xs"], [1, "text-sm", "text-purple-400", "hover:text-purple-300", "cursor-pointer", "flex", "items-center", "gap-1", 3, "click"], [1, "p-4", "bg-amber-500/10", "border", "border-amber-500/30", "rounded-xl", "text-center"], [1, "mt-4", "pt-4", "border-t", "border-slate-700/50", "space-y-4"], [1, "flex", "flex-col", "items-center", "gap-4"], [1, "px-8", "py-4", "bg-gradient-to-r", "from-purple-500", "to-cyan-500", "hover:from-purple-600", "hover:to-cyan-600", "disabled:opacity-50", "disabled:cursor-not-allowed", "text-white", "text-lg", "font-bold", "rounded-2xl", "shadow-lg", "shadow-purple-500/30", "transition-all", "flex", "items-center", "gap-3", 3, "click", "disabled"], [1, "w-full", "max-w-md", "bg-slate-800/80", "rounded-xl", "p-4", "border", "border-slate-700/50"], [1, "text-amber-400", "mb-2"], [1, "text-sm", "text-slate-400", "mb-3"], [1, "px-4", "py-2", "bg-purple-500/20", "text-purple-400", "rounded-lg", "hover:bg-purple-500/30", "transition-colors", 3, "click"], [1, "space-y-3"], [1, "text-xs", "text-slate-500", "mt-3", "flex", "items-center", "gap-1"], [1, "text-xs", "text-slate-500", "mb-2", "flex", "items-center", "gap-1"], [1, "w-1.5", "h-1.5", "bg-emerald-500", "rounded-full"], [1, "flex", "flex-wrap", "gap-2"], [1, "px-3", "py-1.5", "rounded-lg", "text-sm", "font-medium", "transition-all", "flex", "items-center", "gap-1.5", 3, "class"], [1, "px-3", "py-1.5", "rounded-lg", "text-sm", "font-medium", "transition-all", "flex", "items-center", "gap-1.5", 3, "click"], [1, "text-[10px]", "px-1.5", "py-0.5", "rounded-full", 3, "class"], [1, "w-2", "h-2", "bg-emerald-500", "rounded-full"], [1, "text-[10px]", "px-1.5", "py-0.5", "rounded-full"], [1, "w-1.5", "h-1.5", "bg-slate-500", "rounded-full"], [1, "px-3", "py-1.5", "rounded-lg", "text-sm", "font-medium", "transition-all", "flex", "items-center", "gap-1.5", "opacity-60", 3, "class"], [1, "px-3", "py-1.5", "rounded-lg", "text-sm", "font-medium", "transition-all", "flex", "items-center", "gap-1.5", "opacity-60", 3, "click"], [1, "text-xs", "text-slate-500"], [1, "bg-slate-900/50", "rounded-xl", "p-4"], [1, "text-sm", "font-medium", "text-white", "mb-3", "flex", "items-center", "gap-2"], [1, "text-emerald-400", "text-xs"], [1, "text-amber-400", "text-xs"], [1, "grid", "grid-cols-2", "gap-3"], [1, "text-xs", "text-slate-500", "block", "mb-1"], ["type", "text", "placeholder", "https://your-ollama.ts.net/api/chat", 1, "w-full", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "px-3", "py-2", "text-white", "text-sm", 3, "change", "value"], ["type", "text", "placeholder", "qwen2.5", 1, "w-full", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "px-3", "py-2", "text-white", "text-sm", 3, "change", "value"], [1, "mt-3", "px-4", "py-2", "bg-cyan-500/20", "text-cyan-400", "rounded-lg", "text-sm", "hover:bg-cyan-500/30", "transition-colors", 3, "click"], [1, "text-sm", "font-medium", "text-white", "mb-2"], [1, "grid", "grid-cols-2", "gap-2", "max-h-48", "overflow-y-auto"], [1, "p-3", "rounded-lg", "cursor-pointer", "transition-all", "border", 3, "class"], [1, "p-3", "rounded-lg", "cursor-pointer", "transition-all", "border", 3, "click"], [1, "flex", "items-center", "gap-2"], [1, "text-lg"], [1, "flex-1", "min-w-0"], [1, "text-sm", "font-medium", "text-white", "truncate"], [1, "w-2", "h-2", "bg-emerald-500", "rounded-full", "flex-shrink-0"], [1, "animate-spin"], [1, "flex", "items-center", "justify-between", "mb-2"], [1, "text-sm", "text-slate-400"], [1, "text-sm", "text-purple-400"], [1, "h-2", "bg-slate-700", "rounded-full", "overflow-hidden"], [1, "h-full", "bg-gradient-to-r", "from-purple-500", "to-cyan-500", "transition-all", "duration-500"], [1, "max-w-4xl", "mx-auto", "space-y-6"], [1, "bg-gradient-to-r", "from-emerald-500/20", "to-cyan-500/20", "rounded-2xl", "p-4", "border", "border-emerald-500/30", "flex", "items-center", "gap-3"], [1, "text-2xl"], [1, "text-emerald-400", "font-medium"], [1, "text-lg", "font-semibold", "text-white", "mb-4", "flex", "items-center", "gap-2"], [1, "grid", "grid-cols-2", "gap-4"], [1, "text-white", "font-medium"], [1, "text-xs", "text-slate-500", "font-normal", "ml-2"], [1, "space-y-4"], [1, "text-sm", "text-emerald-400", "font-medium", "mb-2", "flex", "items-center", "gap-2"], [1, "px-3", "py-1.5", "bg-emerald-500/20", "text-emerald-400", "rounded-lg", "text-sm", "border", "border-emerald-500/30", "cursor-pointer", "hover:bg-emerald-500/30", "transition-all"], [1, "px-3", "py-1.5", "bg-slate-700", "text-slate-400", "rounded-lg", "text-sm", "hover:bg-slate-600", 3, "click"], [1, "text-sm", "text-amber-400", "font-medium", "mb-2", "flex", "items-center", "gap-2"], [1, "w-2", "h-2", "bg-amber-500", "rounded-full"], [1, "px-3", "py-1.5", "bg-amber-500/20", "text-amber-400", "rounded-lg", "text-sm", "border", "border-amber-500/30", "cursor-pointer", "hover:bg-amber-500/30", "transition-all"], [1, "text-sm", "text-slate-400", "font-medium", "mb-2", "flex", "items-center", "gap-2"], [1, "w-2", "h-2", "bg-slate-500", "rounded-full"], [1, "px-3", "py-1.5", "bg-slate-700", "text-slate-300", "rounded-lg", "text-sm", "border", "border-slate-600", "cursor-pointer", "hover:bg-slate-600", "transition-all"], [1, "grid", "grid-cols-3", "gap-4"], [1, "text-sm", "text-slate-400", "mb-2", "block"], [1, "space-y-1"], [1, "text-white", "text-sm", "flex", "items-center", "gap-2"], [1, "text-sm", "text-emerald-400", "font-medium", "mb-2", "block"], ["rows", "2", 1, "w-full", "bg-slate-900/50", "border", "border-slate-600", "rounded-lg", "p-3", "text-white", "text-sm", "resize-none", "focus:border-purple-500", 3, "ngModelChange", "ngModel"], [1, "text-sm", "text-amber-400", "font-medium", "mb-2", "block"], [1, "text-sm", "text-purple-400", "font-medium", "mb-2", "block"], [1, "flex", "justify-between", "items-center", "pt-4"], [1, "px-6", "py-3", "bg-slate-700", "hover:bg-slate-600", "text-white", "rounded-xl", "transition-all", 3, "click"], [1, "flex", "gap-3"], [1, "px-6", "py-3", "bg-slate-700", "hover:bg-slate-600", "text-white", "rounded-xl", "transition-all", "flex", "items-center", "gap-2", 3, "click"], [1, "px-6", "py-3", "bg-gradient-to-r", "from-emerald-500", "to-cyan-500", "hover:from-emerald-600", "hover:to-cyan-600", "text-white", "font-bold", "rounded-xl", "shadow-lg", "shadow-emerald-500/30", "transition-all", "flex", "items-center", "gap-2", 3, "click"], [1, "px-8", "py-3", "bg-gradient-to-r", "from-purple-500", "to-cyan-500", "hover:from-purple-600", "hover:to-cyan-600", "text-white", "font-bold", "rounded-xl", "shadow-lg", "shadow-purple-500/30", "transition-all", "flex", "items-center", "gap-2", 3, "click"], [1, "mt-4", "p-4", "bg-gradient-to-r", "from-emerald-500/10", "to-cyan-500/10", "border", "border-emerald-500/30", "rounded-xl"], [1, "flex", "items-center", "gap-3"], [1, "text-purple-400"], [1, "text-cyan-400"], [1, "text-emerald-400"], [1, "fixed", "inset-0", "bg-black/60", "backdrop-blur-sm", "z-50", "flex", "items-center", "justify-center", 3, "click"], [1, "bg-slate-800", "rounded-2xl", "p-6", "w-full", "max-w-md", "mx-4", "border", "border-slate-700", "shadow-2xl", 3, "click"], [1, "text-lg", "font-bold", "text-white", "mb-4", "flex", "items-center", "gap-2"], [1, "text-xl"], ["type", "text", "placeholder", "\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E...", "autofocus", "", 1, "w-full", "px-4", "py-3", "bg-slate-900", "border", "border-slate-600", "rounded-xl", "text-white", "placeholder-slate-500", "focus:border-purple-500", "focus:ring-2", "focus:ring-purple-500/20", "outline-none", "transition-all", 3, "ngModelChange", "keydown.enter", "keydown.escape", "ngModel"], [1, "flex", "gap-3", "mt-6"], [1, "flex-1", "px-4", "py-2.5", "bg-slate-700", "hover:bg-slate-600", "text-slate-300", "rounded-xl", "transition-all", "font-medium", 3, "click"], [1, "flex-1", "px-4", "py-2.5", "bg-gradient-to-r", "from-purple-500", "to-pink-500", "hover:from-purple-600", "hover:to-pink-600", "text-white", "rounded-xl", "transition-all", "font-medium", "disabled:opacity-50", "disabled:cursor-not-allowed", 3, "click", "disabled"]], template: function AiMarketingAssistantComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0)(1, "div", 1)(2, "div", 2)(3, "div", 3);
        \u0275\u0275text(4, " \u{1F916} ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(5, "div")(6, "h1", 4);
        \u0275\u0275text(7, "AI \u71DF\u92B7\u52A9\u624B");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(8, "p", 5);
        \u0275\u0275text(9, "\u544A\u8A34\u6211\u4F60\u60F3\u627E\u4EC0\u9EBC\u5BA2\u6236\uFF0CAI \u5E6B\u4F60\u5B8C\u6210\u4E00\u5207");
        \u0275\u0275elementEnd()()()();
        \u0275\u0275elementStart(10, "div", 6);
        \u0275\u0275conditionalCreate(11, AiMarketingAssistantComponent_Case_11_Template, 36, 15, "div", 7)(12, AiMarketingAssistantComponent_Case_12_Template, 1, 1);
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(13, AiMarketingAssistantComponent_Conditional_13_Template, 12, 3, "div", 8);
        \u0275\u0275elementEnd();
      }
      if (rf & 2) {
        let tmp_0_0;
        \u0275\u0275advance(11);
        \u0275\u0275conditional((tmp_0_0 = ctx.currentStep()) === "input" ? 11 : tmp_0_0 === "result" ? 12 : -1);
        \u0275\u0275advance(2);
        \u0275\u0275conditional(ctx.showKeywordDialog() ? 13 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, DefaultValueAccessor, NgControlStatus, NgModel], styles: ["\n\n[_nghost-%COMP%] {\n  display: block;\n  height: 100%;\n}\n/*# sourceMappingURL=ai-marketing-assistant.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AiMarketingAssistantComponent, [{
    type: Component,
    args: [{ selector: "app-ai-marketing-assistant", standalone: true, imports: [CommonModule, FormsModule], template: `
    <div class="ai-assistant h-full flex flex-col bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
      
      <!-- \u9802\u90E8\u6A19\u984C -->
      <div class="p-6 border-b border-slate-700/50">
        <div class="flex items-center gap-4">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-cyan-500 flex items-center justify-center text-2xl shadow-lg shadow-purple-500/20">
            \u{1F916}
          </div>
          <div>
            <h1 class="text-2xl font-bold text-white">AI \u71DF\u92B7\u52A9\u624B</h1>
            <p class="text-slate-400 text-sm">\u544A\u8A34\u6211\u4F60\u60F3\u627E\u4EC0\u9EBC\u5BA2\u6236\uFF0CAI \u5E6B\u4F60\u5B8C\u6210\u4E00\u5207</p>
          </div>
        </div>
      </div>
      
      <!-- \u4E3B\u5167\u5BB9\u5340 -->
      <div class="flex-1 overflow-y-auto p-6">
        
        @switch (currentStep()) {
          <!-- \u6B65\u9A5F 1: \u8F38\u5165\u9700\u6C42 -->
          @case ('input') {
            <div class="max-w-3xl mx-auto space-y-6">
              
              <!-- \u8F38\u5165\u5340\u57DF -->
              <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700/50">
                <label class="block text-lg font-medium text-white mb-4">
                  \u{1F4AC} \u544A\u8A34\u6211\u4F60\u60F3\u627E\u4EC0\u9EBC\u6A23\u7684\u5BA2\u6236\uFF1F
                </label>
                <textarea 
                  [(ngModel)]="userInput"
                  rows="4"
                  class="w-full bg-slate-900/50 border border-slate-600 rounded-xl p-4 text-white text-lg placeholder-slate-500 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 resize-none"
                  placeholder="\u4F8B\u5982\uFF1A\u6211\u60F3\u627E\u652F\u4ED8\u884C\u696D\u7684\u4EE3\u7406\u5546\uFF0C\u4ED6\u5011\u9700\u8981\u6709\u63DB\u532F\u548C\u8DD1\u5206\u9700\u6C42..."
                  (keydown.enter)="$event.ctrlKey && generateStrategy()">
                </textarea>
                <p class="text-xs text-slate-500 mt-2">\u{1F4A1} \u63D0\u793A\uFF1A\u63CF\u8FF0\u8D8A\u8A73\u7D30\uFF0CAI \u5206\u6790\u8D8A\u7CBE\u6E96</p>
              </div>
              
              <!-- \u5FEB\u901F\u9078\u64C7\u884C\u696D -->
              <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700/50">
                <label class="block text-sm font-medium text-slate-400 mb-3">\u26A1 \u5FEB\u901F\u9078\u64C7\u884C\u696D\u6A21\u677F</label>
                <div class="flex flex-wrap gap-3">
                  <button 
                    (click)="selectIndustry('payment')"
                    class="px-4 py-2 rounded-xl text-sm font-medium transition-all"
                    [class]="selectedIndustry() === 'payment' ? 'bg-purple-500 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'">
                    \u{1F4B3} \u652F\u4ED8/\u63DB\u532F
                  </button>
                  <button 
                    (click)="selectIndustry('crypto')"
                    class="px-4 py-2 rounded-xl text-sm font-medium transition-all"
                    [class]="selectedIndustry() === 'crypto' ? 'bg-purple-500 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'">
                    \u{1FA99} \u52A0\u5BC6\u8CA8\u5E63
                  </button>
                  <button 
                    (click)="selectIndustry('ecommerce')"
                    class="px-4 py-2 rounded-xl text-sm font-medium transition-all"
                    [class]="selectedIndustry() === 'ecommerce' ? 'bg-purple-500 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'">
                    \u{1F6D2} \u96FB\u5546/\u8DE8\u5883
                  </button>
                  <button 
                    (click)="selectIndustry('custom')"
                    class="px-4 py-2 rounded-xl text-sm font-medium transition-all"
                    [class]="selectedIndustry() === 'custom' ? 'bg-purple-500 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'">
                    \u270F\uFE0F \u81EA\u5B9A\u7FA9
                  </button>
                </div>
              </div>
              
              <!-- AI \u6A21\u578B\u9078\u64C7 -->
              <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700/50">
                <div class="flex items-center justify-between mb-4">
                  <label class="text-sm font-medium text-slate-400 flex items-center gap-2">
                    \u{1F916} AI \u6A21\u578B
                    @if (connectedModelsCount() > 0) {
                      <span class="px-2 py-0.5 bg-emerald-500/20 text-emerald-400 rounded-full text-xs">
                        {{ connectedModelsCount() }} \u500B\u5DF2\u9023\u63A5
                      </span>
                    } @else {
                      <span class="px-2 py-0.5 bg-amber-500/20 text-amber-400 rounded-full text-xs">\u672A\u914D\u7F6E</span>
                    }
                  </label>
                  <a (click)="goToAICenter()"
                     class="text-sm text-purple-400 hover:text-purple-300 cursor-pointer flex items-center gap-1">
                    \u2699\uFE0F \u524D\u5F80 AI \u4E2D\u5FC3
                  </a>
                </div>
                
                <!-- \u7121\u6A21\u578B\u63D0\u793A -->
                @if (availableModels().length === 0) {
                  <div class="p-4 bg-amber-500/10 border border-amber-500/30 rounded-xl text-center">
                    <p class="text-amber-400 mb-2">\u26A0\uFE0F \u5C1A\u672A\u914D\u7F6E\u4EFB\u4F55 AI \u6A21\u578B</p>
                    <p class="text-sm text-slate-400 mb-3">\u8ACB\u5148\u5728 AI \u4E2D\u5FC3\u914D\u7F6E\u4E26\u6E2C\u8A66 AI \u6A21\u578B</p>
                    <button (click)="goToAICenter()"
                            class="px-4 py-2 bg-purple-500/20 text-purple-400 rounded-lg hover:bg-purple-500/30 transition-colors">
                      \u{1F680} \u524D\u5F80\u914D\u7F6E AI
                    </button>
                  </div>
                } @else {
                  <!-- \u6A21\u578B\u5FEB\u901F\u9078\u64C7 - \u53EA\u986F\u793A\u5DF2\u9023\u63A5\u7684\u6A21\u578B -->
                  <div class="space-y-3">
                    <!-- \u5DF2\u9023\u63A5\u6A21\u578B -->
                    @if (connectedModels().length > 0) {
                      <div>
                        <p class="text-xs text-slate-500 mb-2 flex items-center gap-1">
                          <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full"></span>
                          \u53EF\u7528\u6A21\u578B
                        </p>
                        <div class="flex flex-wrap gap-2">
                          @for (model of connectedModels(); track model.id) {
                            <button 
                              (click)="selectModel(model.id)"
                              class="px-3 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5"
                              [class]="selectedModelId() === model.id 
                                ? 'bg-emerald-500/30 text-emerald-400 border-2 border-emerald-500/50 shadow-lg shadow-emerald-500/20'
                                : 'bg-slate-700/50 text-slate-300 border border-slate-600 hover:bg-slate-600/50 hover:border-emerald-500/30'">
                              <span>{{ model.icon }}</span>
                              <span>{{ model.name }}</span>
                              @if (model.capability) {
                                <span class="text-[10px] px-1.5 py-0.5 rounded-full"
                                      [class]="getCapabilityStyle(model.capability)">
                                  {{ getCapabilityLabel(model.capability) }}
                                </span>
                              }
                              <span class="w-2 h-2 bg-emerald-500 rounded-full"></span>
                            </button>
                          }
                        </div>
                      </div>
                    }
                    
                    <!-- \u672A\u9023\u63A5\u6A21\u578B -->
                    @if (disconnectedModels().length > 0) {
                      <div>
                        <p class="text-xs text-slate-500 mb-2 flex items-center gap-1">
                          <span class="w-1.5 h-1.5 bg-slate-500 rounded-full"></span>
                          \u672A\u9023\u63A5\uFF08\u9700\u8981\u6E2C\u8A66\uFF09
                        </p>
                        <div class="flex flex-wrap gap-2">
                          @for (model of disconnectedModels(); track model.id) {
                            <button 
                              (click)="selectModel(model.id)"
                              class="px-3 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5 opacity-60"
                              [class]="selectedModelId() === model.id 
                                ? 'bg-slate-600/50 text-slate-300 border border-slate-500'
                                : 'bg-slate-800/50 text-slate-500 border border-slate-700 hover:opacity-80'">
                              <span>{{ model.icon }}</span>
                              <span>{{ model.name }}</span>
                              <span class="text-xs text-slate-500">\u672A\u6E2C\u8A66</span>
                            </button>
                          }
                        </div>
                      </div>
                    }
                  </div>
                  
                  <!-- \u63A8\u85A6\u63D0\u793A -->
                  @if (connectedModels().length > 0) {
                    <p class="text-xs text-slate-500 mt-3 flex items-center gap-1">
                      \u{1F4A1} \u512A\u5148\u4F7F\u7528\u672C\u5730 AI\uFF08\u514D\u8CBB\u7121\u9650\uFF09\uFF0C\u96F2\u7AEF AI \u6309\u4F7F\u7528\u91CF\u8A08\u8CBB
                    </p>
                  }
                }
                
                <!-- \u8A73\u7D30\u8A2D\u7F6E\u9762\u677F -->
                @if (showModelSettings()) {
                  <div class="mt-4 pt-4 border-t border-slate-700/50 space-y-4">
                    <!-- \u672C\u5730 AI \u914D\u7F6E -->
                    <div class="bg-slate-900/50 rounded-xl p-4">
                      <h4 class="text-sm font-medium text-white mb-3 flex items-center gap-2">
                        \u{1F999} \u672C\u5730 Ollama \u914D\u7F6E
                        @if (localAIConfig().isConnected) {
                          <span class="text-emerald-400 text-xs">\u2713 \u5DF2\u9023\u63A5</span>
                        } @else {
                          <span class="text-amber-400 text-xs">\u672A\u9023\u63A5</span>
                        }
                      </h4>
                      <div class="grid grid-cols-2 gap-3">
                        <div>
                          <label class="text-xs text-slate-500 block mb-1">API \u7AEF\u9EDE</label>
                          <input type="text" 
                                 [value]="localAIConfig().endpoint"
                                 (change)="updateLocalEndpoint($any($event.target).value)"
                                 class="w-full bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white text-sm"
                                 placeholder="https://your-ollama.ts.net/api/chat">
                        </div>
                        <div>
                          <label class="text-xs text-slate-500 block mb-1">\u6A21\u578B\u540D\u7A31</label>
                          <input type="text" 
                                 [value]="localAIConfig().model"
                                 (change)="updateLocalModel($any($event.target).value)"
                                 class="w-full bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white text-sm"
                                 placeholder="qwen2.5">
                        </div>
                      </div>
                      <button (click)="testLocalAI()"
                              class="mt-3 px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg text-sm hover:bg-cyan-500/30 transition-colors">
                        \u{1F517} \u6E2C\u8A66\u9023\u63A5
                      </button>
                    </div>
                    
                    <!-- \u6240\u6709\u53EF\u7528\u6A21\u578B -->
                    <div>
                      <h4 class="text-sm font-medium text-white mb-2">\u53EF\u7528\u6A21\u578B</h4>
                      <div class="grid grid-cols-2 gap-2 max-h-48 overflow-y-auto">
                        @for (model of availableModels(); track model.id) {
                          <div 
                            (click)="selectModel(model.id)"
                            class="p-3 rounded-lg cursor-pointer transition-all border"
                            [class]="selectedModelId() === model.id 
                              ? 'bg-purple-500/20 border-purple-500/50' 
                              : 'bg-slate-800/50 border-slate-700 hover:border-slate-500'">
                            <div class="flex items-center gap-2">
                              <span class="text-lg">{{ model.icon }}</span>
                              <div class="flex-1 min-w-0">
                                <div class="text-sm font-medium text-white truncate">{{ model.name }}</div>
                                <div class="text-xs text-slate-500">{{ model.provider }}</div>
                              </div>
                              @if (model.isConnected) {
                                <span class="w-2 h-2 bg-emerald-500 rounded-full flex-shrink-0"></span>
                              } @else if (!model.isLocal) {
                                <span class="text-xs text-slate-500">\u672A\u914D\u7F6E</span>
                              }
                            </div>
                          </div>
                        }
                      </div>
                    </div>
                    
                    <p class="text-xs text-slate-500">
                      \u{1F4A1} \u512A\u5148\u4F7F\u7528\u672C\u5730 AI (\u514D\u8CBB\u3001\u96B1\u79C1)\uFF0C\u672C\u5730\u4E0D\u53EF\u7528\u6642\u81EA\u52D5\u5207\u63DB\u5230\u96F2\u7AEF AI
                    </p>
                  </div>
                }
              </div>
              
              <!-- \u751F\u6210\u6309\u9215 -->
              <div class="flex flex-col items-center gap-4">
                <button 
                  (click)="generateStrategy()"
                  [disabled]="isGenerating() || (!userInput && selectedIndustry() === 'custom')"
                  class="px-8 py-4 bg-gradient-to-r from-purple-500 to-cyan-500 hover:from-purple-600 hover:to-cyan-600 disabled:opacity-50 disabled:cursor-not-allowed text-white text-lg font-bold rounded-2xl shadow-lg shadow-purple-500/30 transition-all flex items-center gap-3">
                  @if (isGenerating()) {
                    <span class="animate-spin">\u27F3</span>
                    AI \u5206\u6790\u4E2D...
                  } @else {
                    \u{1F680} \u751F\u6210 AI \u71DF\u92B7\u7B56\u7565
                  }
                </button>
                
                <!-- \u751F\u6210\u9032\u5EA6 -->
                @if (isGenerating()) {
                  <div class="w-full max-w-md bg-slate-800/80 rounded-xl p-4 border border-slate-700/50">
                    <div class="flex items-center justify-between mb-2">
                      <span class="text-sm text-slate-400">{{ generationStatus().message }}</span>
                      <span class="text-sm text-purple-400">{{ generationStatus().currentProvider }}</span>
                    </div>
                    <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                      <div class="h-full bg-gradient-to-r from-purple-500 to-cyan-500 transition-all duration-500"
                           [style.width.%]="generationStatus().progress">
                      </div>
                    </div>
                  </div>
                }
              </div>
              
            </div>
          }
          
          <!-- \u6B65\u9A5F 2: \u7B56\u7565\u7D50\u679C -->
          @case ('result') {
            @if (strategyResult()) {
              <div class="max-w-4xl mx-auto space-y-6">
                
                <!-- \u6210\u529F\u63D0\u793A -->
                <div class="bg-gradient-to-r from-emerald-500/20 to-cyan-500/20 rounded-2xl p-4 border border-emerald-500/30 flex items-center gap-3">
                  <span class="text-2xl">\u2728</span>
                  <div>
                    <p class="text-emerald-400 font-medium">AI \u7B56\u7565\u751F\u6210\u5B8C\u6210\uFF01</p>
                    <p class="text-slate-400 text-sm">\u6839\u64DA\u60A8\u7684\u9700\u6C42\uFF0CAI \u5DF2\u751F\u6210\u4EE5\u4E0B\u71DF\u92B7\u7B56\u7565</p>
                  </div>
                </div>
                
                <!-- \u884C\u696D\u5206\u6790 -->
                <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700/50">
                  <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                    <span>\u{1F4CA}</span> \u884C\u696D\u5206\u6790
                  </h3>
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="text-sm text-slate-400">\u76EE\u6A19\u884C\u696D</label>
                      <p class="text-white font-medium">{{ strategyResult()!.industry }}</p>
                    </div>
                    <div>
                      <label class="text-sm text-slate-400">\u76EE\u6A19\u53D7\u773E</label>
                      <p class="text-white font-medium">{{ strategyResult()!.targetAudience }}</p>
                    </div>
                  </div>
                </div>
                
                <!-- \u95DC\u9375\u8A5E\u63A8\u85A6 -->
                <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700/50">
                  <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                    <span>\u{1F511}</span> AI \u63A8\u85A6\u95DC\u9375\u8A5E
                    <span class="text-xs text-slate-500 font-normal ml-2">\u9EDE\u64CA\u53EF\u7DE8\u8F2F</span>
                  </h3>
                  
                  <div class="space-y-4">
                    <!-- \u9AD8\u610F\u5411\u95DC\u9375\u8A5E -->
                    <div>
                      <label class="text-sm text-emerald-400 font-medium mb-2 flex items-center gap-2">
                        <span class="w-2 h-2 bg-emerald-500 rounded-full"></span>
                        \u9AD8\u610F\u5411\u95DC\u9375\u8A5E
                      </label>
                      <div class="flex flex-wrap gap-2">
                        @for (keyword of strategyResult()!.keywords.highIntent; track $index) {
                          <span class="px-3 py-1.5 bg-emerald-500/20 text-emerald-400 rounded-lg text-sm border border-emerald-500/30 cursor-pointer hover:bg-emerald-500/30 transition-all">
                            {{ keyword }}
                          </span>
                        }
                        <button (click)="addKeyword('high')" class="px-3 py-1.5 bg-slate-700 text-slate-400 rounded-lg text-sm hover:bg-slate-600">
                          + \u6DFB\u52A0
                        </button>
                      </div>
                    </div>
                    
                    <!-- \u4E2D\u610F\u5411\u95DC\u9375\u8A5E -->
                    <div>
                      <label class="text-sm text-amber-400 font-medium mb-2 flex items-center gap-2">
                        <span class="w-2 h-2 bg-amber-500 rounded-full"></span>
                        \u4E2D\u610F\u5411\u95DC\u9375\u8A5E
                      </label>
                      <div class="flex flex-wrap gap-2">
                        @for (keyword of strategyResult()!.keywords.mediumIntent; track $index) {
                          <span class="px-3 py-1.5 bg-amber-500/20 text-amber-400 rounded-lg text-sm border border-amber-500/30 cursor-pointer hover:bg-amber-500/30 transition-all">
                            {{ keyword }}
                          </span>
                        }
                        <button (click)="addKeyword('medium')" class="px-3 py-1.5 bg-slate-700 text-slate-400 rounded-lg text-sm hover:bg-slate-600">
                          + \u6DFB\u52A0
                        </button>
                      </div>
                    </div>
                    
                    <!-- \u64F4\u5C55\u95DC\u9375\u8A5E -->
                    <div>
                      <label class="text-sm text-slate-400 font-medium mb-2 flex items-center gap-2">
                        <span class="w-2 h-2 bg-slate-500 rounded-full"></span>
                        \u64F4\u5C55\u95DC\u9375\u8A5E
                      </label>
                      <div class="flex flex-wrap gap-2">
                        @for (keyword of strategyResult()!.keywords.extended; track $index) {
                          <span class="px-3 py-1.5 bg-slate-700 text-slate-300 rounded-lg text-sm border border-slate-600 cursor-pointer hover:bg-slate-600 transition-all">
                            {{ keyword }}
                          </span>
                        }
                        <button (click)="addKeyword('extended')" class="px-3 py-1.5 bg-slate-700 text-slate-400 rounded-lg text-sm hover:bg-slate-600">
                          + \u6DFB\u52A0
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- \u5BA2\u6236\u756B\u50CF -->
                <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700/50">
                  <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                    <span>\u{1F465}</span> \u76EE\u6A19\u5BA2\u6236\u756B\u50CF
                  </h3>
                  <div class="grid grid-cols-3 gap-4">
                    <div>
                      <label class="text-sm text-slate-400 mb-2 block">\u8EAB\u4EFD\u7279\u5FB5</label>
                      <ul class="space-y-1">
                        @for (item of strategyResult()!.customerProfile.identity; track item) {
                          <li class="text-white text-sm flex items-center gap-2">
                            <span class="text-purple-400">\u2022</span> {{ item }}
                          </li>
                        }
                      </ul>
                    </div>
                    <div>
                      <label class="text-sm text-slate-400 mb-2 block">\u884C\u70BA\u7279\u5FB5</label>
                      <ul class="space-y-1">
                        @for (item of strategyResult()!.customerProfile.features; track item) {
                          <li class="text-white text-sm flex items-center gap-2">
                            <span class="text-cyan-400">\u2022</span> {{ item }}
                          </li>
                        }
                      </ul>
                    </div>
                    <div>
                      <label class="text-sm text-slate-400 mb-2 block">\u6838\u5FC3\u9700\u6C42</label>
                      <ul class="space-y-1">
                        @for (item of strategyResult()!.customerProfile.needs; track item) {
                          <li class="text-white text-sm flex items-center gap-2">
                            <span class="text-emerald-400">\u2022</span> {{ item }}
                          </li>
                        }
                      </ul>
                    </div>
                  </div>
                </div>
                
                <!-- \u6D88\u606F\u6A21\u677F -->
                <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700/50">
                  <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                    <span>\u{1F4AC}</span> AI \u751F\u6210\u8A71\u8853\u6A21\u677F
                  </h3>
                  <div class="space-y-4">
                    <div>
                      <label class="text-sm text-emerald-400 font-medium mb-2 block">\u9996\u6B21\u89F8\u9054</label>
                      <textarea 
                        [(ngModel)]="editableTemplates.firstTouch"
                        rows="2"
                        class="w-full bg-slate-900/50 border border-slate-600 rounded-lg p-3 text-white text-sm resize-none focus:border-purple-500">
                      </textarea>
                    </div>
                    <div>
                      <label class="text-sm text-amber-400 font-medium mb-2 block">\u8DDF\u9032\u8A71\u8853</label>
                      <textarea 
                        [(ngModel)]="editableTemplates.followUp"
                        rows="2"
                        class="w-full bg-slate-900/50 border border-slate-600 rounded-lg p-3 text-white text-sm resize-none focus:border-purple-500">
                      </textarea>
                    </div>
                    <div>
                      <label class="text-sm text-purple-400 font-medium mb-2 block">\u4FC3\u6210\u8A71\u8853</label>
                      <textarea 
                        [(ngModel)]="editableTemplates.closing"
                        rows="2"
                        class="w-full bg-slate-900/50 border border-slate-600 rounded-lg p-3 text-white text-sm resize-none focus:border-purple-500">
                      </textarea>
                    </div>
                  </div>
                </div>
                
                <!-- \u64CD\u4F5C\u6309\u9215 -->
                <div class="flex justify-between items-center pt-4">
                  <button 
                    (click)="backToInput()"
                    class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl transition-all">
                    \u2190 \u8FD4\u56DE\u4FEE\u6539
                  </button>
                  <div class="flex gap-3">
                    <button 
                      (click)="saveStrategy()"
                      class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl transition-all flex items-center gap-2">
                      \u{1F4BE} \u4FDD\u5B58\u7B56\u7565
                    </button>
                    <button 
                      (click)="handoverToAITeam()"
                      class="px-6 py-3 bg-gradient-to-r from-emerald-500 to-cyan-500 hover:from-emerald-600 hover:to-cyan-600 text-white font-bold rounded-xl shadow-lg shadow-emerald-500/30 transition-all flex items-center gap-2">
                      \u{1F916} \u4EA4\u7D66 AI \u5718\u968A
                    </button>
                    <button 
                      (click)="startAutomation()"
                      class="px-8 py-3 bg-gradient-to-r from-purple-500 to-cyan-500 hover:from-purple-600 hover:to-cyan-600 text-white font-bold rounded-xl shadow-lg shadow-purple-500/30 transition-all flex items-center gap-2">
                      \u{1F680} \u624B\u52D5\u57F7\u884C
                    </button>
                  </div>
                </div>
                
                <!-- AI \u5718\u968A\u512A\u52E2\u63D0\u793A -->
                <div class="mt-4 p-4 bg-gradient-to-r from-emerald-500/10 to-cyan-500/10 border border-emerald-500/30 rounded-xl">
                  <div class="flex items-center gap-3">
                    <span class="text-2xl">\u{1F4A1}</span>
                    <div>
                      <p class="text-white font-medium">\u63A8\u85A6\u4F7F\u7528\u300C\u4EA4\u7D66 AI \u5718\u968A\u300D</p>
                      <p class="text-slate-400 text-sm">AI \u6703\u81EA\u52D5\u7D44\u5EFA\u5718\u968A\u3001\u5206\u914D\u89D2\u8272\u3001\u5236\u5B9A\u8A71\u8853\uFF0C24/7 \u667A\u80FD\u92B7\u552E</p>
                    </div>
                  </div>
                </div>
                
              </div>
            }
          }
        }
        
      </div>
      
      <!-- \u{1F527} \u95DC\u9375\u8A5E\u8F38\u5165\u5C0D\u8A71\u6846\uFF08\u66FF\u4EE3 prompt\uFF09 -->
      @if (showKeywordDialog()) {
        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center"
             (click)="cancelAddKeyword()">
          <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-md mx-4 border border-slate-700 shadow-2xl"
               (click)="$event.stopPropagation()">
            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
              <span class="text-xl">\u{1F3F7}\uFE0F</span>
              \u6DFB\u52A0{{ getKeywordLevelLabel(keywordDialogLevel()) }}\u95DC\u9375\u8A5E
            </h3>
            
            <input type="text" 
                   [(ngModel)]="newKeywordInput"
                   (keydown.enter)="confirmAddKeyword()"
                   (keydown.escape)="cancelAddKeyword()"
                   placeholder="\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E..."
                   class="w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-xl text-white 
                          placeholder-slate-500 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 
                          outline-none transition-all"
                   autofocus />
            
            <div class="flex gap-3 mt-6">
              <button (click)="cancelAddKeyword()"
                      class="flex-1 px-4 py-2.5 bg-slate-700 hover:bg-slate-600 text-slate-300 
                             rounded-xl transition-all font-medium">
                \u53D6\u6D88
              </button>
              <button (click)="confirmAddKeyword()"
                      [disabled]="!newKeywordInput.trim()"
                      class="flex-1 px-4 py-2.5 bg-gradient-to-r from-purple-500 to-pink-500 
                             hover:from-purple-600 hover:to-pink-600 text-white rounded-xl 
                             transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                \u78BA\u5B9A\u6DFB\u52A0
              </button>
            </div>
          </div>
        </div>
      }
      
    </div>
  `, styles: ["/* angular:styles/component:css;c63aac4e1d1ce1074d0fb61b93c3d082a38ddfc40b5cc09fdd9a596f2e08e21b;D:/tgkz2026/src/ai-assistant/ai-marketing-assistant.component.ts */\n:host {\n  display: block;\n  height: 100%;\n}\n/*# sourceMappingURL=ai-marketing-assistant.component.css.map */\n"] }]
  }], null, { startAutomationEvent: [{ type: Output, args: ["startAutomationEvent"] }], handoverToAITeamEvent: [{ type: Output, args: ["handoverToAITeamEvent"] }], navigateEvent: [{ type: Output, args: ["navigateEvent"] }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(AiMarketingAssistantComponent, { className: "AiMarketingAssistantComponent", filePath: "src/ai-assistant/ai-marketing-assistant.component.ts", lineNumber: 610 });
})();

// src/multi-role/ai-team-hub.component.ts
var _forTrack018 = ($index, $item) => $item.id;
function AiTeamHubComponent_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 6);
    \u0275\u0275element(1, "span", 22);
    \u0275\u0275text(2, " \u57F7\u884C\u4E2D ");
    \u0275\u0275elementEnd();
  }
}
function AiTeamHubComponent_Conditional_36_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 16);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(ctx_r0.runningCount());
  }
}
function AiTeamHubComponent_Case_42_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 23)(1, "div", 2)(2, "div", 39)(3, "span", 5);
    \u0275\u0275text(4, "\u{1F517}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "div")(6, "p", 40);
    \u0275\u0275text(7, "\u5DF2\u63A5\u6536 AI \u71DF\u92B7\u52A9\u624B\u7684\u7B56\u7565");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "p", 41);
    \u0275\u0275text(9, "\u7B56\u7565\u5DF2\u81EA\u52D5\u586B\u5165\uFF0C\u78BA\u8A8D\u5F8C\u5373\u53EF\u958B\u59CB\u57F7\u884C");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(10, "button", 42);
    \u0275\u0275listener("click", function AiTeamHubComponent_Case_42_Conditional_1_Template_button_click_10_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.clearIncomingStrategy());
    });
    \u0275\u0275text(11, " \u2715 \u6E05\u9664 ");
    \u0275\u0275elementEnd()()();
  }
}
function AiTeamHubComponent_Case_42_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 43);
    \u0275\u0275text(1, "\u23F3");
    \u0275\u0275elementEnd();
    \u0275\u0275text(2, " \u7B56\u5283\u4E2D... ");
  }
}
function AiTeamHubComponent_Case_42_Conditional_13_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span");
    \u0275\u0275text(1, "\u{1F680}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(2, " AI \u958B\u59CB\u5DE5\u4F5C ");
  }
}
function AiTeamHubComponent_Case_42_For_21_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 44);
    \u0275\u0275listener("click", function AiTeamHubComponent_Case_42_For_21_Template_button_click_0_listener() {
      const preset_r5 = \u0275\u0275restoreView(_r4).$implicit;
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.quickStart(preset_r5.goal));
    });
    \u0275\u0275elementStart(1, "div", 36);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 45);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "div", 38);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const preset_r5 = ctx.$implicit;
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(preset_r5.icon);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(preset_r5.name);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(preset_r5.description);
  }
}
function AiTeamHubComponent_Case_42_Template(rf, ctx) {
  if (rf & 1) {
    const _r2 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 18);
    \u0275\u0275conditionalCreate(1, AiTeamHubComponent_Case_42_Conditional_1_Template, 12, 0, "div", 23);
    \u0275\u0275elementStart(2, "div", 24)(3, "div", 25)(4, "h2", 26);
    \u0275\u0275text(5, "\u{1F3AF} \u4E00\u53E5\u8A71\uFF0C\u555F\u52D5\u4F60\u7684 AI \u92B7\u552E\u5718\u968A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "p", 27);
    \u0275\u0275text(7, "\u544A\u8A34 AI \u4F60\u60F3\u8981\u4EC0\u9EBC\uFF0C\u5269\u4E0B\u7684\u4EA4\u7D66\u6211\u5011");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(8, "div", 28)(9, "textarea", 29);
    \u0275\u0275twoWayListener("ngModelChange", function AiTeamHubComponent_Case_42_Template_textarea_ngModelChange_9_listener($event) {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r0.userGoal, $event) || (ctx_r0.userGoal = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275listener("keydown.enter", function AiTeamHubComponent_Case_42_Template_textarea_keydown_enter_9_listener($event) {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.onEnterKey($event));
    });
    \u0275\u0275text(10, "                  ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "button", 30);
    \u0275\u0275listener("click", function AiTeamHubComponent_Case_42_Template_button_click_11_listener() {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.startFromGoal());
    });
    \u0275\u0275conditionalCreate(12, AiTeamHubComponent_Case_42_Conditional_12_Template, 3, 0)(13, AiTeamHubComponent_Case_42_Conditional_13_Template, 3, 0);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(14, "div")(15, "h3", 31)(16, "span");
    \u0275\u0275text(17, "\u{1F4A1}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(18, " \u6216\u9078\u64C7\u5E38\u898B\u76EE\u6A19\uFF0C\u4E00\u9375\u958B\u59CB ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(19, "div", 32);
    \u0275\u0275repeaterCreate(20, AiTeamHubComponent_Case_42_For_21_Template, 7, 3, "button", 33, _forTrack018);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(22, "div", 34)(23, "div", 35)(24, "div", 36);
    \u0275\u0275text(25, "\u{1F3AD}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(26, "div", 37);
    \u0275\u0275text(27, "\u50CF\u771F\u4EBA\u4E00\u6A23");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(28, "div", 38);
    \u0275\u0275text(29, "\u804A\u751F\u6D3B\u3001\u804A\u65B0\u805E\u3001\u81EA\u7136\u5F15\u5C0E");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(30, "div", 35)(31, "div", 36);
    \u0275\u0275text(32, "\u{1F504}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(33, "div", 37);
    \u0275\u0275text(34, "\u5BE6\u6642\u8ABF\u6574");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(35, "div", 38);
    \u0275\u0275text(36, "\u6BCF10\u689D\u6D88\u606F\u5206\u6790\u4E00\u6B21");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(37, "div", 35)(38, "div", 36);
    \u0275\u0275text(39, "\u{1F91D}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(40, "div", 37);
    \u0275\u0275text(41, "\u591A\u89D2\u8272\u914D\u5408");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(42, "div", 38);
    \u0275\u0275text(43, "AI \u81EA\u52D5\u5354\u8ABF\u6700\u4F73\u7D44\u5408");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.hasIncomingStrategy() ? 1 : -1);
    \u0275\u0275advance(8);
    \u0275\u0275twoWayProperty("ngModel", ctx_r0.userGoal);
    \u0275\u0275advance(2);
    \u0275\u0275property("disabled", !ctx_r0.userGoal.trim() || ctx_r0.engine.isProcessing());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.engine.isProcessing() ? 12 : 13);
    \u0275\u0275advance(8);
    \u0275\u0275repeater(ctx_r0.presetGoals);
  }
}
function AiTeamHubComponent_Case_43_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 46)(1, "div", 47);
    \u0275\u0275text(2, "\u{1F680}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 48);
    \u0275\u0275text(4, "\u66AB\u7121\u57F7\u884C\u4E2D\u7684\u4EFB\u52D9");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 49);
    \u0275\u0275text(6, "\u524D\u5F80\u300C\u4E00\u9375\u555F\u52D5\u300D\u5275\u5EFA\u65B0\u4EFB\u52D9");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "button", 50);
    \u0275\u0275listener("click", function AiTeamHubComponent_Case_43_Conditional_1_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.activeTab.set("start"));
    });
    \u0275\u0275text(8, " \u{1F680} \u5275\u5EFA\u4EFB\u52D9 ");
    \u0275\u0275elementEnd()();
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_15_Template(rf, ctx) {
  if (rf & 1) {
    const _r8 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 70);
    \u0275\u0275listener("click", function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_15_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r8);
      const execution_r9 = \u0275\u0275nextContext(2).$implicit;
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.confirmStart(execution_r9));
    });
    \u0275\u0275text(1, " \u25B6\uFE0F \u78BA\u8A8D\u958B\u59CB ");
    \u0275\u0275elementEnd();
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    const _r10 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 71);
    \u0275\u0275listener("click", function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_16_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r10);
      const execution_r9 = \u0275\u0275nextContext(2).$implicit;
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.pauseExecution(execution_r9));
    });
    \u0275\u0275text(1, " \u23F8\uFE0F \u66AB\u505C ");
    \u0275\u0275elementEnd();
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_17_Template(rf, ctx) {
  if (rf & 1) {
    const _r11 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 72);
    \u0275\u0275listener("click", function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_17_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r11);
      const execution_r9 = \u0275\u0275nextContext(2).$implicit;
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.resumeExecution(execution_r9));
    });
    \u0275\u0275text(1, " \u25B6\uFE0F \u7E7C\u7E8C ");
    \u0275\u0275elementEnd();
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_21_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 62)(1, "div", 73)(2, "span");
    \u0275\u0275text(3, "\u{1F916}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(4, " AI \u7406\u89E3 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 74);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div", 75)(8, "span");
    \u0275\u0275text(9);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "span");
    \u0275\u0275text(11);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "span");
    \u0275\u0275text(13);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const execution_r9 = \u0275\u0275nextContext(2).$implicit;
    \u0275\u0275advance(6);
    \u0275\u0275textInterpolate(execution_r9.intent.goal);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("\u7F6E\u4FE1\u5EA6: ", execution_r9.intent.confidence, "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u76EE\u6A19\u7FA4\u9AD4: ", execution_r9.intent.targetAudience);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u5EFA\u8B70\u9031\u671F: ", execution_r9.intent.suggestedDuration);
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_22_For_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 78)(1, "span", 79);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div")(4, "div", 80);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "div", 66);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const role_r12 = ctx.$implicit;
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(role_r12.icon);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(role_r12.name);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(role_r12.purpose);
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_22_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 63)(1, "div", 76);
    \u0275\u0275text(2, "\u{1F3AD} AI \u5718\u968A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 77);
    \u0275\u0275repeaterCreate(4, AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_22_For_5_Template, 8, 3, "div", 78, _forTrack018);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const execution_r9 = \u0275\u0275nextContext(2).$implicit;
    \u0275\u0275advance(4);
    \u0275\u0275repeater(execution_r9.roles);
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_23_For_5_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(0, "svg", 83);
    \u0275\u0275element(1, "path", 84);
    \u0275\u0275elementEnd();
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_23_For_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 81)(1, "div", 82);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(3, AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_23_For_5_Conditional_3_Template, 2, 0, ":svg:svg", 83);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const phase_r13 = ctx.$implicit;
    const \u0275$index_302_r14 = ctx.$index;
    const execution_r9 = \u0275\u0275nextContext(3).$implicit;
    \u0275\u0275advance();
    \u0275\u0275classProp("bg-green-500", \u0275$index_302_r14 < execution_r9.stats.currentPhase)("text-white", \u0275$index_302_r14 < execution_r9.stats.currentPhase)("bg-purple-500", \u0275$index_302_r14 === execution_r9.stats.currentPhase)("text-white", \u0275$index_302_r14 === execution_r9.stats.currentPhase)("bg-slate-700", \u0275$index_302_r14 > execution_r9.stats.currentPhase)("text-slate-400", \u0275$index_302_r14 > execution_r9.stats.currentPhase);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", phase_r13.name, " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(\u0275$index_302_r14 < execution_r9.strategy.phases.length - 1 ? 3 : -1);
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_23_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 63)(1, "div", 76);
    \u0275\u0275text(2, "\u{1F4CB} \u57F7\u884C\u968E\u6BB5");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 56);
    \u0275\u0275repeaterCreate(4, AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_23_For_5_Template, 4, 14, "div", 81, _forTrack018);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const execution_r9 = \u0275\u0275nextContext(2).$implicit;
    \u0275\u0275advance(4);
    \u0275\u0275repeater(execution_r9.strategy.phases);
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_45_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 68)(1, "div", 85)(2, "span");
    \u0275\u0275text(3, "\u{1F50D}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(4, " AI \u6700\u65B0\u5206\u6790 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 86);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div", 87);
    \u0275\u0275text(8);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const execution_r9 = \u0275\u0275nextContext(2).$implicit;
    \u0275\u0275advance(6);
    \u0275\u0275textInterpolate(execution_r9.stats.lastAnalysis.suggestions.reasoning);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" \u5EFA\u8B70: ", execution_r9.stats.lastAnalysis.suggestions.topicSuggestion, " ");
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_46_Template(rf, ctx) {
  if (rf & 1) {
    const _r15 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 69)(1, "div", 2)(2, "div")(3, "div", 88)(4, "span");
    \u0275\u0275text(5, "\u{1F3AF}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(6, " \u9AD8\u610F\u5411\u5BA2\u6236 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "p", 86);
    \u0275\u0275text(8, "\u6AA2\u6E2C\u5230\u9AD8\u610F\u5411\u5BA2\u6236\uFF0C\u5EFA\u8B70\u5275\u5EFA\u5C08\u5C6C\u7FA4\u7D44\u9032\u884C\u591A\u89D2\u8272\u5354\u4F5C\u6210\u4EA4");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(9, "button", 89);
    \u0275\u0275listener("click", function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_46_Template_button_click_9_listener() {
      \u0275\u0275restoreView(_r15);
      const execution_r9 = \u0275\u0275nextContext(2).$implicit;
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.createGroupForExecution(execution_r9));
    });
    \u0275\u0275elementStart(10, "span");
    \u0275\u0275text(11, "\u{1F465}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(12, " \u4E00\u9375\u5EFA\u7FA4 ");
    \u0275\u0275elementEnd()()();
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 51)(1, "div", 52)(2, "div", 3);
    \u0275\u0275element(3, "div", 53);
    \u0275\u0275elementStart(4, "div")(5, "div", 54);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div", 55)(8, "span");
    \u0275\u0275text(9);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "span");
    \u0275\u0275text(11, "\xB7");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "span");
    \u0275\u0275text(13);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(14, "div", 56);
    \u0275\u0275conditionalCreate(15, AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_15_Template, 2, 0, "button", 57);
    \u0275\u0275conditionalCreate(16, AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_16_Template, 2, 0, "button", 58);
    \u0275\u0275conditionalCreate(17, AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_17_Template, 2, 0, "button", 59);
    \u0275\u0275elementStart(18, "button", 60);
    \u0275\u0275listener("click", function AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Template_button_click_18_listener() {
      \u0275\u0275restoreView(_r7);
      const execution_r9 = \u0275\u0275nextContext().$implicit;
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.stopExecution(execution_r9));
    });
    \u0275\u0275text(19, " \u23F9\uFE0F \u505C\u6B62 ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(20, "div", 61);
    \u0275\u0275conditionalCreate(21, AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_21_Template, 14, 4, "div", 62);
    \u0275\u0275conditionalCreate(22, AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_22_Template, 6, 0, "div", 63);
    \u0275\u0275conditionalCreate(23, AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_23_Template, 6, 0, "div", 63);
    \u0275\u0275elementStart(24, "div", 64)(25, "div", 65)(26, "div", 12);
    \u0275\u0275text(27);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(28, "div", 66);
    \u0275\u0275text(29, "\u5DF2\u767C\u6D88\u606F");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(30, "div", 65)(31, "div", 9);
    \u0275\u0275text(32);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(33, "div", 66);
    \u0275\u0275text(34, "\u6536\u5230\u56DE\u8986");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(35, "div", 65)(36, "div", 13);
    \u0275\u0275text(37);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(38, "div", 66);
    \u0275\u0275text(39, "\u8208\u8DA3\u5EA6");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(40, "div", 65)(41, "div", 67);
    \u0275\u0275text(42);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(43, "div", 66);
    \u0275\u0275text(44, "\u7576\u524D\u968E\u6BB5");
    \u0275\u0275elementEnd()()();
    \u0275\u0275conditionalCreate(45, AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_45_Template, 9, 2, "div", 68);
    \u0275\u0275conditionalCreate(46, AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Conditional_46_Template, 13, 0, "div", 69);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const execution_r9 = \u0275\u0275nextContext().$implicit;
    const ctx_r0 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(3);
    \u0275\u0275classProp("bg-green-500", execution_r9.status === "running")("bg-yellow-500", execution_r9.status === "planning")("bg-orange-500", execution_r9.status === "paused")("animate-pulse", execution_r9.status === "running");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(execution_r9.goal);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r0.getStatusLabel(execution_r9.status));
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r0.getExecutionDuration(execution_r9));
    \u0275\u0275advance(2);
    \u0275\u0275conditional(execution_r9.status === "planning" ? 15 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(execution_r9.status === "running" ? 16 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(execution_r9.status === "paused" ? 17 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275conditional(execution_r9.intent ? 21 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(execution_r9.roles.length > 0 ? 22 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(execution_r9.strategy ? 23 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(execution_r9.stats.messagesSent);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(execution_r9.stats.responsesReceived);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate1("", execution_r9.stats.interestScore, "%");
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate2("", execution_r9.stats.currentPhase + 1, "/", (execution_r9.strategy == null ? null : execution_r9.strategy.phases == null ? null : execution_r9.strategy.phases.length) || 0);
    \u0275\u0275advance(3);
    \u0275\u0275conditional(execution_r9.stats.lastAnalysis ? 45 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(execution_r9.stats.interestScore >= 50 && execution_r9.status === "running" ? 46 : -1);
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_For_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275conditionalCreate(0, AiTeamHubComponent_Case_43_Conditional_2_For_1_Conditional_0_Template, 47, 24, "div", 51);
  }
  if (rf & 2) {
    \u0275\u0275conditional(true ? 0 : -1);
  }
}
function AiTeamHubComponent_Case_43_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275repeaterCreate(0, AiTeamHubComponent_Case_43_Conditional_2_For_1_Template, 1, 1, null, null, _forTrack018);
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275repeater(ctx_r0.activeExecutions());
  }
}
function AiTeamHubComponent_Case_43_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 19);
    \u0275\u0275conditionalCreate(1, AiTeamHubComponent_Case_43_Conditional_1_Template, 9, 0, "div", 46)(2, AiTeamHubComponent_Case_43_Conditional_2_Template, 2, 0);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.activeExecutions().length === 0 ? 1 : 2);
  }
}
function AiTeamHubComponent_Case_44_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 46)(1, "div", 47);
    \u0275\u0275text(2, "\u{1F4DC}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 48);
    \u0275\u0275text(4, "\u66AB\u7121\u6B77\u53F2\u8A18\u9304");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 27);
    \u0275\u0275text(6, "\u5B8C\u6210\u7684\u4EFB\u52D9\u6703\u986F\u793A\u5728\u9019\u88E1");
    \u0275\u0275elementEnd()();
  }
}
function AiTeamHubComponent_Case_44_Conditional_2_For_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 90)(1, "div", 2)(2, "div")(3, "div", 54);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "div", 91);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(7, "div", 92)(8, "div", 93);
    \u0275\u0275text(9);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "div", 94);
    \u0275\u0275text(11, "\u5DF2\u5B8C\u6210");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const execution_r16 = ctx.$implicit;
    const ctx_r0 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(execution_r16.goal);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2(" ", execution_r16.intent == null ? null : execution_r16.intent.goal, " \xB7 ", execution_r16.stats.messagesSent, " \u689D\u6D88\u606F ");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r0.formatDate(execution_r16.stats.startTime));
  }
}
function AiTeamHubComponent_Case_44_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275repeaterCreate(0, AiTeamHubComponent_Case_44_Conditional_2_For_1_Template, 12, 4, "div", 90, _forTrack018);
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275repeater(ctx_r0.completedExecutions());
  }
}
function AiTeamHubComponent_Case_44_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 20);
    \u0275\u0275conditionalCreate(1, AiTeamHubComponent_Case_44_Conditional_1_Template, 7, 0, "div", 46)(2, AiTeamHubComponent_Case_44_Conditional_2_Template, 2, 0);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.completedExecutions().length === 0 ? 1 : 2);
  }
}
function AiTeamHubComponent_Conditional_45_Conditional_11_For_16_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 103)(1, "div", 113)(2, "span", 5);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span", 114);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "p", 66);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "p", 115);
    \u0275\u0275text(9);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const role_r18 = ctx.$implicit;
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(role_r18.icon);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(role_r18.name);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(role_r18.purpose);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(role_r18.entryTiming);
  }
}
function AiTeamHubComponent_Conditional_45_Conditional_11_For_22_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 110)(1, "div", 116);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 117)(4, "div", 2)(5, "span", 114);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "span", 66);
    \u0275\u0275text(8);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(9, "p", 91);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const phase_r19 = ctx.$implicit;
    const \u0275$index_491_r20 = ctx.$index;
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", \u0275$index_491_r20 + 1, " ");
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(phase_r19.name);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(phase_r19.duration);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(phase_r19.goal);
  }
}
function AiTeamHubComponent_Conditional_45_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 99)(1, "div", 103)(2, "div", 76);
    \u0275\u0275text(3, "\u{1F3AF} AI \u7406\u89E3\u7684\u76EE\u6A19");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "p", 74);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "div", 104)(7, "span", 105);
    \u0275\u0275text(8);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "span", 106);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(11, "div")(12, "div", 107);
    \u0275\u0275text(13, "\u{1F3AD} AI \u63A8\u85A6\u7684\u5718\u968A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "div", 108);
    \u0275\u0275repeaterCreate(15, AiTeamHubComponent_Conditional_45_Conditional_11_For_16_Template, 10, 4, "div", 103, _forTrack018);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(17, "div")(18, "div", 107);
    \u0275\u0275text(19, "\u{1F4CB} \u57F7\u884C\u8A08\u5283");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(20, "div", 109);
    \u0275\u0275repeaterCreate(21, AiTeamHubComponent_Conditional_45_Conditional_11_For_22_Template, 11, 4, "div", 110, _forTrack018);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(23, "div", 111)(24, "div", 85)(25, "span");
    \u0275\u0275text(26, "\u{1F4A1}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(27, " AI \u6703\u9019\u6A23\u505A ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(28, "ul", 112)(29, "li");
    \u0275\u0275text(30, "\u2022 \u50CF\u771F\u4EBA\u4E00\u6A23\u5728\u7FA4\u88E1\u804A\u5929\uFF0C\u804A\u751F\u6D3B\u3001\u804A\u65B0\u805E");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(31, "li");
    \u0275\u0275text(32, "\u2022 \u81EA\u7136\u5730\u5F15\u5165\u7522\u54C1\u8A71\u984C\uFF0C\u4E0D\u751F\u786C\u63A8\u92B7");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(33, "li");
    \u0275\u0275text(34, "\u2022 \u6BCF 10 \u689D\u6D88\u606F\u5206\u6790\u4E00\u6B21\uFF0C\u52D5\u614B\u8ABF\u6574\u7B56\u7565");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(35, "li");
    \u0275\u0275text(36, "\u2022 \u6839\u64DA\u5BA2\u6236\u53CD\u61C9\u9748\u6D3B\u5207\u63DB\u89D2\u8272");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    let tmp_2_0;
    let tmp_3_0;
    let tmp_4_0;
    let tmp_5_0;
    let tmp_6_0;
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate((tmp_2_0 = ctx_r0.pendingExecution()) == null ? null : tmp_2_0.intent == null ? null : tmp_2_0.intent.goal);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("\u7F6E\u4FE1\u5EA6: ", (tmp_3_0 = ctx_r0.pendingExecution()) == null ? null : tmp_3_0.intent == null ? null : tmp_3_0.intent.confidence, "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u5EFA\u8B70\u9031\u671F: ", (tmp_4_0 = ctx_r0.pendingExecution()) == null ? null : tmp_4_0.intent == null ? null : tmp_4_0.intent.suggestedDuration);
    \u0275\u0275advance(5);
    \u0275\u0275repeater((tmp_5_0 = ctx_r0.pendingExecution()) == null ? null : tmp_5_0.roles);
    \u0275\u0275advance(6);
    \u0275\u0275repeater((tmp_6_0 = ctx_r0.pendingExecution()) == null ? null : tmp_6_0.strategy == null ? null : tmp_6_0.strategy.phases);
  }
}
function AiTeamHubComponent_Conditional_45_Template(rf, ctx) {
  if (rf & 1) {
    const _r17 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 21)(1, "div", 95)(2, "div", 96)(3, "div", 3)(4, "div", 97);
    \u0275\u0275text(5, " \u{1F916} ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "div")(7, "h2", 98);
    \u0275\u0275text(8, "AI \u7B56\u5283\u5B8C\u6210\uFF01");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "p", 27);
    \u0275\u0275text(10, "\u78BA\u8A8D\u4EE5\u4E0B\u65B9\u6848\uFF0C\u5373\u53EF\u958B\u59CB\u57F7\u884C");
    \u0275\u0275elementEnd()()()();
    \u0275\u0275conditionalCreate(11, AiTeamHubComponent_Conditional_45_Conditional_11_Template, 37, 3, "div", 99);
    \u0275\u0275elementStart(12, "div", 100)(13, "button", 101);
    \u0275\u0275listener("click", function AiTeamHubComponent_Conditional_45_Template_button_click_13_listener() {
      \u0275\u0275restoreView(_r17);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.cancelPendingExecution());
    });
    \u0275\u0275text(14, " \u53D6\u6D88 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "button", 102);
    \u0275\u0275listener("click", function AiTeamHubComponent_Conditional_45_Template_button_click_15_listener() {
      \u0275\u0275restoreView(_r17);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.confirmPendingExecution());
    });
    \u0275\u0275elementStart(16, "span");
    \u0275\u0275text(17, "\u25B6\uFE0F");
    \u0275\u0275elementEnd();
    \u0275\u0275text(18, " \u78BA\u8A8D\u958B\u59CB ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(11);
    \u0275\u0275conditional(ctx_r0.pendingExecution() ? 11 : -1);
  }
}
var AiTeamHubComponent = class _AiTeamHubComponent {
  constructor() {
    this.engine = inject(DynamicScriptEngineService);
    this.toast = inject(ToastService);
    this.autoGroup = inject(AutoGroupService);
    this.incomingStrategy = input(null, ...ngDevMode ? [{ debugName: "incomingStrategy" }] : []);
    this.activeTab = signal("start", ...ngDevMode ? [{ debugName: "activeTab" }] : []);
    this.userGoal = "";
    this.hasIncomingStrategy = signal(false, ...ngDevMode ? [{ debugName: "hasIncomingStrategy" }] : []);
    this.receivedStrategy = null;
    this.showPlanningResult = signal(false, ...ngDevMode ? [{ debugName: "showPlanningResult" }] : []);
    this.pendingExecution = signal(null, ...ngDevMode ? [{ debugName: "pendingExecution" }] : []);
    this.presetGoals = [
      {
        id: "convert",
        icon: "\u{1F4B0}",
        name: "\u4FC3\u9032\u6210\u4EA4",
        description: "\u591A\u89D2\u8272\u914D\u5408\uFF0C\u4FC3\u6210\u7336\u8C6B\u5BA2\u6236\u4E0B\u55AE",
        goal: "\u8B93\u7FA4\u88E1\u5C0D\u7522\u54C1\u611F\u8208\u8DA3\u4F46\u9084\u6C92\u4E0B\u55AE\u7684\u6F5B\u5728\u5BA2\u6236\u5B8C\u6210\u8CFC\u8CB7"
      },
      {
        id: "recovery",
        icon: "\u{1F49D}",
        name: "\u633D\u56DE\u6D41\u5931",
        description: "\u95DC\u61F7\u56DE\u8A2A + \u7279\u5225\u512A\u60E0",
        goal: "\u633D\u56DE\u5DF2\u7D93\u6D41\u5931\u6216\u6C89\u9ED8\u7684\u8001\u5BA2\u6236\uFF0C\u8B93\u4ED6\u5011\u91CD\u65B0\u8CFC\u8CB7"
      },
      {
        id: "active",
        icon: "\u{1F389}",
        name: "\u793E\u7FA4\u6D3B\u8E8D",
        description: "\u8A71\u984C\u5F15\u5C0E + \u4E92\u52D5\u6FC0\u52F5",
        goal: "\u63D0\u5347\u793E\u7FA4\u6D3B\u8E8D\u5EA6\uFF0C\u8B93\u7FA4\u6210\u54E1\u66F4\u9858\u610F\u4E92\u52D5\u548C\u8A0E\u8AD6"
      },
      {
        id: "support",
        icon: "\u{1F527}",
        name: "\u552E\u5F8C\u670D\u52D9",
        description: "\u5FEB\u901F\u97FF\u61C9 + \u554F\u984C\u89E3\u6C7A",
        goal: "\u9AD8\u6548\u8655\u7406\u5BA2\u6236\u552E\u5F8C\u554F\u984C\uFF0C\u63D0\u5347\u5BA2\u6236\u6EFF\u610F\u5EA6"
      },
      {
        id: "nurture",
        icon: "\u{1F331}",
        name: "\u6F5B\u5BA2\u57F9\u80B2",
        description: "\u50F9\u503C\u8F38\u51FA + \u4FE1\u4EFB\u5EFA\u7ACB",
        goal: "\u901A\u904E\u6301\u7E8C\u7684\u50F9\u503C\u8F38\u51FA\u57F9\u80B2\u6F5B\u5728\u5BA2\u6236\uFF0C\u63D0\u5347\u8CFC\u8CB7\u610F\u9858"
      },
      {
        id: "brand",
        icon: "\u{1F3C6}",
        name: "\u54C1\u724C\u63A8\u5EE3",
        description: "\u53E3\u7891\u50B3\u64AD + \u5F62\u8C61\u5EFA\u7ACB",
        goal: "\u63D0\u5347\u54C1\u724C\u77E5\u540D\u5EA6\u548C\u597D\u611F\u5EA6\uFF0C\u8B93\u66F4\u591A\u4EBA\u4E86\u89E3\u6211\u5011"
      }
    ];
    this.runningCount = computed(() => this.engine.executions().filter((e) => e.status === "running").length, ...ngDevMode ? [{ debugName: "runningCount" }] : []);
    this.todayMessages = computed(() => {
      return this.engine.executions().filter((e) => e.status === "running").reduce((sum, e) => sum + e.stats.messagesSent, 0);
    }, ...ngDevMode ? [{ debugName: "todayMessages" }] : []);
    this.todayConversions = computed(() => {
      return 0;
    }, ...ngDevMode ? [{ debugName: "todayConversions" }] : []);
    this.completedExecutions = computed(() => this.engine.executions().filter((e) => e.status === "completed"), ...ngDevMode ? [{ debugName: "completedExecutions" }] : []);
    this.activeExecutions = computed(() => this.engine.executions().filter((e) => e.status === "running" || e.status === "planning" || e.status === "paused"), ...ngDevMode ? [{ debugName: "activeExecutions" }] : []);
    effect(() => {
      const strategy = this.incomingStrategy();
      if (strategy) {
        this.handleIncomingStrategy(strategy);
      }
    });
  }
  ngOnInit() {
  }
  ngOnDestroy() {
  }
  // ============ 方法 ============
  onEnterKey(event) {
    const keyEvent = event;
    if (!keyEvent.shiftKey) {
      keyEvent.preventDefault();
      this.startFromGoal();
    }
  }
  async startFromGoal() {
    if (!this.userGoal.trim())
      return;
    const result = await this.engine.startFromOnePhrase(this.userGoal);
    if (result) {
      this.pendingExecution.set(result);
      this.showPlanningResult.set(true);
    }
  }
  quickStart(goal) {
    this.userGoal = goal;
    this.startFromGoal();
  }
  confirmPendingExecution() {
    const execution = this.pendingExecution();
    if (execution) {
      this.engine.confirmAndStart(execution.id);
      this.showPlanningResult.set(false);
      this.pendingExecution.set(null);
      this.userGoal = "";
      this.activeTab.set("running");
    }
  }
  cancelPendingExecution() {
    const execution = this.pendingExecution();
    if (execution) {
      this.engine.stopExecution(execution.id);
    }
    this.showPlanningResult.set(false);
    this.pendingExecution.set(null);
  }
  confirmStart(execution) {
    this.engine.confirmAndStart(execution.id);
  }
  pauseExecution(execution) {
    this.engine.pauseExecution(execution.id);
    this.toast.info("\u5DF2\u66AB\u505C\u57F7\u884C");
  }
  resumeExecution(execution) {
    this.engine.resumeExecution(execution.id);
    this.toast.success("\u5DF2\u6062\u5FA9\u57F7\u884C");
  }
  stopExecution(execution) {
    if (confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u9019\u500B\u4EFB\u52D9\u55CE\uFF1F")) {
      this.engine.stopExecution(execution.id);
      this.toast.info("\u4EFB\u52D9\u5DF2\u505C\u6B62");
    }
  }
  getStatusLabel(status) {
    const labels = {
      idle: "\u5F85\u547D",
      planning: "\u7B56\u5283\u4E2D",
      running: "\u57F7\u884C\u4E2D",
      paused: "\u5DF2\u66AB\u505C",
      completed: "\u5DF2\u5B8C\u6210"
    };
    return labels[status];
  }
  getExecutionDuration(execution) {
    const start = new Date(execution.stats.startTime);
    const now = /* @__PURE__ */ new Date();
    const diffMs = now.getTime() - start.getTime();
    const diffMins = Math.floor(diffMs / 6e4);
    if (diffMins < 60)
      return `${diffMins} \u5206\u9418`;
    const diffHours = Math.floor(diffMins / 60);
    if (diffHours < 24)
      return `${diffHours} \u5C0F\u6642`;
    return `${Math.floor(diffHours / 24)} \u5929`;
  }
  formatDate(dateStr) {
    const date = new Date(dateStr);
    return date.toLocaleDateString("zh-TW", {
      month: "short",
      day: "numeric",
      hour: "2-digit",
      minute: "2-digit"
    });
  }
  /**
   * 為執行中的任務創建協作群組
   */
  async createGroupForExecution(execution) {
    if (!execution.targetUsers || execution.targetUsers.length === 0) {
      this.toast.warning("\u66AB\u7121\u9AD8\u610F\u5411\u76EE\u6A19\u7528\u6236\uFF0C\u8ACB\u7E7C\u7E8C\u7B49\u5F85...");
      return;
    }
    const highIntentUsers = execution.targetUsers.filter((u) => u.intentScore >= 50);
    if (highIntentUsers.length === 0) {
      this.toast.warning("\u66AB\u7121\u9AD8\u610F\u5411\u7528\u6236\u53EF\u5EFA\u7FA4");
      return;
    }
    const targetUser = highIntentUsers[0];
    const request = {
      targetCustomer: {
        id: targetUser.id.toString(),
        username: targetUser.username,
        firstName: targetUser.firstName || targetUser.username
      },
      groupName: this.autoGroup.generateGroupName(targetUser.firstName || targetUser.username || "VIP", "{\u5BA2\u6236\u540D}\u5C08\u5C6C\u670D\u52D9\u7FA4"),
      roleAccounts: execution.roles.map((role, idx) => ({
        roleId: role.id,
        accountId: role.accountId || idx + 1
        // 使用角色配置的帳號 ID
      })),
      scriptId: void 0,
      // 使用 AI 自由對話模式
      inviteMessage: `\u60A8\u597D ${targetUser.firstName || ""}\uFF01\u6211\u5011\u70BA\u60A8\u5275\u5EFA\u4E86\u5C08\u5C6C\u670D\u52D9\u7FA4\u7D44\uFF0C\u6211\u5011\u7684\u5C08\u696D\u5718\u968A\u5C07\u70BA\u60A8\u63D0\u4F9B\u4E00\u5C0D\u4E00\u670D\u52D9\u3002`,
      intentScore: targetUser.intentScore
    };
    this.toast.info("\u6B63\u5728\u70BA\u9AD8\u610F\u5411\u5BA2\u6236\u5275\u5EFA\u5C08\u5C6C\u7FA4\u7D44...");
    const result = await this.autoGroup.createGroup(request);
    if (result.success) {
      this.toast.success(`\u{1F389} \u5DF2\u70BA ${targetUser.firstName || targetUser.username} \u5275\u5EFA\u5C08\u5C6C\u7FA4\u7D44\uFF01`);
    } else {
      this.toast.error(`\u5EFA\u7FA4\u5931\u6557: ${result.error}`);
    }
  }
  /**
   * 處理從 AI 營銷助手傳入的策略
   */
  handleIncomingStrategy(strategy) {
    console.log("[AITeamHub] \u6536\u5230 AI \u71DF\u92B7\u52A9\u624B\u7B56\u7565:", strategy);
    this.hasIncomingStrategy.set(true);
    this.receivedStrategy = strategy;
    const goalParts = [
      `\u5728${strategy.industry}\u884C\u696D`,
      `\u5C0B\u627E${strategy.targetAudience}`
    ];
    if (strategy.keywords.highIntent.length > 0) {
      goalParts.push(`\u95DC\u6CE8\u300C${strategy.keywords.highIntent.slice(0, 3).join("\u3001")}\u300D\u7B49\u95DC\u9375\u8A5E`);
    }
    if (strategy.customerProfile.needs.length > 0) {
      goalParts.push(`\u6EFF\u8DB3\u5BA2\u6236\u300C${strategy.customerProfile.needs[0]}\u300D\u7684\u9700\u6C42`);
    }
    const generatedGoal = goalParts.join("\uFF0C") + "\uFF0C\u4FC3\u6210\u6210\u4EA4";
    this.userGoal = generatedGoal;
    this.toast.success(`\u{1F916} \u5DF2\u63A5\u6536 AI \u71DF\u92B7\u52A9\u624B\u7684\u7B56\u7565\uFF01\u884C\u696D: ${strategy.industry}`);
    this.activeTab.set("start");
    setTimeout(() => {
      this.startWithFullStrategy();
    }, 500);
  }
  /**
   * 清除傳入策略標記
   */
  clearIncomingStrategy() {
    this.hasIncomingStrategy.set(false);
    this.receivedStrategy = null;
    this.userGoal = "";
  }
  /**
   * 使用完整策略啟動（從 AI 營銷助手傳入）
   */
  async startWithFullStrategy() {
    if (!this.receivedStrategy) {
      this.startFromGoal();
      return;
    }
    const strategy = this.receivedStrategy;
    const result = await this.engine.startWithMarketingStrategy(this.userGoal, strategy);
    if (result) {
      this.pendingExecution.set(result);
      this.showPlanningResult.set(true);
      this.hasIncomingStrategy.set(false);
    }
  }
  static {
    this.\u0275fac = function AiTeamHubComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _AiTeamHubComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _AiTeamHubComponent, selectors: [["app-ai-team-hub"]], inputs: { incomingStrategy: [1, "incomingStrategy"] }, decls: 46, vars: 37, consts: [[1, "ai-team-hub", "h-full", "flex", "flex-col", "bg-slate-900"], [1, "p-4", "border-b", "border-slate-700/50", "bg-slate-900/80", "backdrop-blur-sm"], [1, "flex", "items-center", "justify-between"], [1, "flex", "items-center", "gap-4"], [1, "text-2xl", "font-bold", "text-white", "flex", "items-center", "gap-3"], [1, "text-2xl"], [1, "flex", "items-center", "gap-2", "px-3", "py-1", "bg-green-500/20", "text-green-400", "rounded-full", "text-sm", "animate-pulse"], [1, "flex", "items-center", "gap-4", "px-4", "py-2", "bg-slate-800/80", "rounded-xl", "border", "border-slate-700/50"], [1, "text-center"], [1, "text-lg", "font-bold", "text-green-400"], [1, "text-xs", "text-slate-500"], [1, "w-px", "h-8", "bg-slate-700"], [1, "text-lg", "font-bold", "text-cyan-400"], [1, "text-lg", "font-bold", "text-purple-400"], [1, "flex", "gap-1", "mt-4", "bg-slate-800/50", "p-1", "rounded-xl", "w-fit"], [1, "px-6", "py-2.5", "rounded-lg", "transition-all", "flex", "items-center", "gap-2", "text-sm", "font-medium", 3, "click"], [1, "bg-white/20", "px-2", "py-0.5", "rounded-full", "text-xs"], [1, "flex-1", "overflow-y-auto", "p-6"], [1, "max-w-3xl", "mx-auto", "space-y-8"], [1, "space-y-6"], [1, "space-y-4"], [1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-50", "p-4"], [1, "w-2", "h-2", "bg-green-500", "rounded-full"], [1, "p-4", "bg-gradient-to-r", "from-emerald-500/20", "to-cyan-500/20", "border", "border-emerald-500/30", "rounded-2xl"], [1, "bg-gradient-to-br", "from-purple-500/10", "via-pink-500/10", "to-cyan-500/10", "rounded-3xl", "border", "border-purple-500/30", "p-8"], [1, "text-center", "mb-6"], [1, "text-2xl", "font-bold", "text-white", "mb-2"], [1, "text-slate-400"], [1, "relative"], ["rows", "3", "placeholder", "\u4F8B\u5982\uFF1A\u6211\u60F3\u8B93\u7FA4\u88E1\u90A3\u4E9B\u770B\u904E\u7522\u54C1\u4F46\u9084\u6C92\u4E0B\u55AE\u7684\u4EBA\u8CFC\u8CB7...", 1, "w-full", "px-6", "py-4", "bg-slate-800/80", "border", "border-slate-600", "rounded-2xl", "text-white", "text-lg", "placeholder-slate-500", "resize-none", "focus:ring-2", "focus:ring-purple-500", "focus:border-transparent", 3, "ngModelChange", "keydown.enter", "ngModel"], [1, "absolute", "right-3", "bottom-3", "px-6", "py-2.5", "bg-gradient-to-r", "from-purple-500", "to-pink-500", "text-white", "font-medium", "rounded-xl", "hover:opacity-90", "transition-all", "disabled:opacity-50", "disabled:cursor-not-allowed", "flex", "items-center", "gap-2", 3, "click", "disabled"], [1, "text-sm", "text-slate-400", "mb-4", "flex", "items-center", "gap-2"], [1, "grid", "grid-cols-2", "md:grid-cols-3", "gap-4"], [1, "p-4", "bg-slate-800/50", "border", "border-slate-700/50", "rounded-xl", "text-left", "hover:bg-slate-800", "hover:border-purple-500/30", "transition-all", "group"], [1, "grid", "grid-cols-3", "gap-4"], [1, "p-4", "bg-slate-800/30", "rounded-xl", "text-center"], [1, "text-2xl", "mb-2"], [1, "text-sm", "text-white", "font-medium"], [1, "text-xs", "text-slate-400", "mt-1"], [1, "flex", "items-center", "gap-3"], [1, "text-emerald-400", "font-medium"], [1, "text-slate-400", "text-sm"], [1, "p-2", "text-slate-400", "hover:text-white", "hover:bg-slate-700", "rounded-lg", "transition-colors", 3, "click"], [1, "animate-spin"], [1, "p-4", "bg-slate-800/50", "border", "border-slate-700/50", "rounded-xl", "text-left", "hover:bg-slate-800", "hover:border-purple-500/30", "transition-all", "group", 3, "click"], [1, "font-medium", "text-white", "group-hover:text-purple-400", "transition-colors"], [1, "text-center", "py-16"], [1, "text-6xl", "mb-4"], [1, "text-xl", "text-white", "mb-2"], [1, "text-slate-400", "mb-6"], [1, "px-6", "py-3", "bg-purple-500", "text-white", "rounded-xl", "hover:bg-purple-400", "transition-colors", 3, "click"], [1, "bg-slate-800/50", "border", "border-slate-700/50", "rounded-2xl", "overflow-hidden"], [1, "p-4", "border-b", "border-slate-700/50", "flex", "items-center", "justify-between"], [1, "w-3", "h-3", "rounded-full"], [1, "font-medium", "text-white"], [1, "text-xs", "text-slate-400", "flex", "items-center", "gap-2"], [1, "flex", "items-center", "gap-2"], [1, "px-4", "py-2", "bg-green-500", "text-white", "rounded-lg", "hover:bg-green-400", "transition-colors", "text-sm"], [1, "px-4", "py-2", "bg-orange-500/20", "text-orange-400", "rounded-lg", "hover:bg-orange-500/30", "transition-colors", "text-sm"], [1, "px-4", "py-2", "bg-green-500/20", "text-green-400", "rounded-lg", "hover:bg-green-500/30", "transition-colors", "text-sm"], [1, "px-4", "py-2", "bg-red-500/20", "text-red-400", "rounded-lg", "hover:bg-red-500/30", "transition-colors", "text-sm", 3, "click"], [1, "p-4"], [1, "mb-4", "p-3", "bg-purple-500/10", "border", "border-purple-500/20", "rounded-xl"], [1, "mb-4"], [1, "grid", "grid-cols-4", "gap-4"], [1, "p-3", "bg-slate-700/30", "rounded-lg", "text-center"], [1, "text-xs", "text-slate-400"], [1, "text-lg", "font-bold", "text-yellow-400"], [1, "mt-4", "p-3", "bg-cyan-500/10", "border", "border-cyan-500/20", "rounded-xl"], [1, "mt-4", "p-4", "bg-gradient-to-r", "from-amber-500/10", "to-orange-500/10", "border", "border-amber-500/20", "rounded-xl"], [1, "px-4", "py-2", "bg-green-500", "text-white", "rounded-lg", "hover:bg-green-400", "transition-colors", "text-sm", 3, "click"], [1, "px-4", "py-2", "bg-orange-500/20", "text-orange-400", "rounded-lg", "hover:bg-orange-500/30", "transition-colors", "text-sm", 3, "click"], [1, "px-4", "py-2", "bg-green-500/20", "text-green-400", "rounded-lg", "hover:bg-green-500/30", "transition-colors", "text-sm", 3, "click"], [1, "flex", "items-center", "gap-2", "text-purple-400", "text-sm", "mb-2"], [1, "text-white"], [1, "flex", "items-center", "gap-4", "mt-2", "text-xs", "text-slate-400"], [1, "text-sm", "text-slate-400", "mb-2"], [1, "flex", "flex-wrap", "gap-2"], [1, "flex", "items-center", "gap-2", "px-3", "py-2", "bg-slate-700/50", "rounded-lg"], [1, "text-xl"], [1, "text-sm", "text-white"], [1, "flex", "items-center"], [1, "px-3", "py-1.5", "rounded-lg", "text-xs"], ["fill", "none", "stroke", "currentColor", "viewBox", "0 0 24 24", 1, "w-4", "h-4", "text-slate-500", "mx-1"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M9 5l7 7-7 7"], [1, "flex", "items-center", "gap-2", "text-cyan-400", "text-sm", "mb-2"], [1, "text-white", "text-sm"], [1, "text-xs", "text-slate-400", "mt-2"], [1, "flex", "items-center", "gap-2", "text-amber-400", "text-sm", "mb-1"], [1, "px-4", "py-2", "bg-gradient-to-r", "from-amber-500", "to-orange-500", "text-white", "rounded-lg", "hover:from-amber-400", "hover:to-orange-400", "transition-all", "text-sm", "font-medium", "flex", "items-center", "gap-2", "whitespace-nowrap", 3, "click"], [1, "p-4", "bg-slate-800/50", "border", "border-slate-700/50", "rounded-xl"], [1, "text-sm", "text-slate-400", "mt-1"], [1, "text-right"], [1, "text-sm", "text-slate-400"], [1, "text-xs", "text-green-400"], [1, "bg-slate-900", "rounded-2xl", "w-full", "max-w-2xl", "shadow-2xl", "border", "border-purple-500/30", "overflow-hidden", "max-h-[90vh]", "overflow-y-auto"], [1, "p-6", "bg-gradient-to-r", "from-purple-500/20", "to-pink-500/20", "border-b", "border-slate-700/50"], [1, "w-12", "h-12", "rounded-full", "bg-gradient-to-br", "from-purple-500", "to-pink-500", "flex", "items-center", "justify-center", "text-2xl"], [1, "text-xl", "font-bold", "text-white"], [1, "p-6", "space-y-6"], [1, "p-6", "border-t", "border-slate-700/50", "flex", "gap-3"], [1, "flex-1", "py-3", "bg-slate-700", "text-slate-300", "rounded-xl", "hover:bg-slate-600", "transition-colors", 3, "click"], [1, "flex-1", "py-3", "bg-gradient-to-r", "from-green-500", "to-emerald-500", "text-white", "font-medium", "rounded-xl", "hover:opacity-90", "transition-opacity", "flex", "items-center", "justify-center", "gap-2", 3, "click"], [1, "p-4", "bg-slate-800/50", "rounded-xl"], [1, "flex", "items-center", "gap-4", "mt-2", "text-xs"], [1, "text-purple-400"], [1, "text-cyan-400"], [1, "text-sm", "text-slate-400", "mb-3"], [1, "grid", "grid-cols-1", "md:grid-cols-3", "gap-3"], [1, "space-y-3"], [1, "flex", "items-start", "gap-4", "p-3", "bg-slate-800/50", "rounded-lg"], [1, "p-4", "bg-cyan-500/10", "border", "border-cyan-500/20", "rounded-xl"], [1, "text-sm", "text-slate-300", "space-y-1"], [1, "flex", "items-center", "gap-2", "mb-2"], [1, "text-white", "font-medium"], [1, "text-xs", "text-cyan-400", "mt-1"], [1, "w-8", "h-8", "rounded-full", "bg-purple-500/30", "text-purple-400", "flex", "items-center", "justify-center", "flex-shrink-0"], [1, "flex-1"]], template: function AiTeamHubComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0)(1, "div", 1)(2, "div", 2)(3, "div", 3)(4, "h1", 4)(5, "span", 5);
        \u0275\u0275text(6, "\u{1F916}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(7, " AI \u5718\u968A\u92B7\u552E ");
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(8, AiTeamHubComponent_Conditional_8_Template, 3, 0, "span", 6);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(9, "div", 7)(10, "div", 8)(11, "div", 9);
        \u0275\u0275text(12);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(13, "div", 10);
        \u0275\u0275text(14, "\u57F7\u884C\u4E2D");
        \u0275\u0275elementEnd()();
        \u0275\u0275element(15, "div", 11);
        \u0275\u0275elementStart(16, "div", 8)(17, "div", 12);
        \u0275\u0275text(18);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(19, "div", 10);
        \u0275\u0275text(20, "\u4ECA\u65E5\u6D88\u606F");
        \u0275\u0275elementEnd()();
        \u0275\u0275element(21, "div", 11);
        \u0275\u0275elementStart(22, "div", 8)(23, "div", 13);
        \u0275\u0275text(24);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(25, "div", 10);
        \u0275\u0275text(26, "\u6210\u4EA4");
        \u0275\u0275elementEnd()()()();
        \u0275\u0275elementStart(27, "div", 14)(28, "button", 15);
        \u0275\u0275listener("click", function AiTeamHubComponent_Template_button_click_28_listener() {
          return ctx.activeTab.set("start");
        });
        \u0275\u0275elementStart(29, "span");
        \u0275\u0275text(30, "\u{1F680}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(31, " \u4E00\u9375\u555F\u52D5 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(32, "button", 15);
        \u0275\u0275listener("click", function AiTeamHubComponent_Template_button_click_32_listener() {
          return ctx.activeTab.set("running");
        });
        \u0275\u0275elementStart(33, "span");
        \u0275\u0275text(34, "\u{1F4CA}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(35, " \u57F7\u884C\u76E3\u63A7 ");
        \u0275\u0275conditionalCreate(36, AiTeamHubComponent_Conditional_36_Template, 2, 1, "span", 16);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(37, "button", 15);
        \u0275\u0275listener("click", function AiTeamHubComponent_Template_button_click_37_listener() {
          return ctx.activeTab.set("history");
        });
        \u0275\u0275elementStart(38, "span");
        \u0275\u0275text(39, "\u{1F4DC}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(40, " \u6B77\u53F2\u8A18\u9304 ");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(41, "div", 17);
        \u0275\u0275conditionalCreate(42, AiTeamHubComponent_Case_42_Template, 44, 4, "div", 18)(43, AiTeamHubComponent_Case_43_Template, 3, 1, "div", 19)(44, AiTeamHubComponent_Case_44_Template, 3, 1, "div", 20);
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(45, AiTeamHubComponent_Conditional_45_Template, 19, 1, "div", 21);
        \u0275\u0275elementEnd();
      }
      if (rf & 2) {
        let tmp_0_0;
        let tmp_20_0;
        \u0275\u0275advance(8);
        \u0275\u0275conditional(((tmp_0_0 = ctx.engine.currentExecution()) == null ? null : tmp_0_0.status) === "running" ? 8 : -1);
        \u0275\u0275advance(4);
        \u0275\u0275textInterpolate(ctx.runningCount());
        \u0275\u0275advance(6);
        \u0275\u0275textInterpolate(ctx.todayMessages());
        \u0275\u0275advance(6);
        \u0275\u0275textInterpolate(ctx.todayConversions());
        \u0275\u0275advance(4);
        \u0275\u0275classProp("bg-gradient-to-r", ctx.activeTab() === "start")("from-purple-500", ctx.activeTab() === "start")("to-pink-500", ctx.activeTab() === "start")("text-white", ctx.activeTab() === "start")("text-slate-400", ctx.activeTab() !== "start");
        \u0275\u0275advance(4);
        \u0275\u0275classProp("bg-gradient-to-r", ctx.activeTab() === "running")("from-green-500", ctx.activeTab() === "running")("to-emerald-500", ctx.activeTab() === "running")("text-white", ctx.activeTab() === "running")("text-slate-400", ctx.activeTab() !== "running");
        \u0275\u0275advance(4);
        \u0275\u0275conditional(ctx.runningCount() > 0 ? 36 : -1);
        \u0275\u0275advance();
        \u0275\u0275classProp("bg-gradient-to-r", ctx.activeTab() === "history")("from-slate-600", ctx.activeTab() === "history")("to-slate-500", ctx.activeTab() === "history")("text-white", ctx.activeTab() === "history")("text-slate-400", ctx.activeTab() !== "history");
        \u0275\u0275advance(5);
        \u0275\u0275conditional((tmp_20_0 = ctx.activeTab()) === "start" ? 42 : tmp_20_0 === "running" ? 43 : tmp_20_0 === "history" ? 44 : -1);
        \u0275\u0275advance(3);
        \u0275\u0275conditional(ctx.showPlanningResult() ? 45 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, DefaultValueAccessor, NgControlStatus, NgModel], encapsulation: 2 });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AiTeamHubComponent, [{
    type: Component,
    args: [{
      selector: "app-ai-team-hub",
      standalone: true,
      imports: [CommonModule, FormsModule],
      template: `
    <div class="ai-team-hub h-full flex flex-col bg-slate-900">
      <!-- \u9802\u90E8\u6A19\u984C -->
      <div class="p-4 border-b border-slate-700/50 bg-slate-900/80 backdrop-blur-sm">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <h1 class="text-2xl font-bold text-white flex items-center gap-3">
              <span class="text-2xl">\u{1F916}</span>
              AI \u5718\u968A\u92B7\u552E
            </h1>
            
            @if (engine.currentExecution()?.status === 'running') {
              <span class="flex items-center gap-2 px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm animate-pulse">
                <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                \u57F7\u884C\u4E2D
              </span>
            }
          </div>
          
          <!-- \u5FEB\u901F\u7D71\u8A08 -->
          <div class="flex items-center gap-4 px-4 py-2 bg-slate-800/80 rounded-xl border border-slate-700/50">
            <div class="text-center">
              <div class="text-lg font-bold text-green-400">{{ runningCount() }}</div>
              <div class="text-xs text-slate-500">\u57F7\u884C\u4E2D</div>
            </div>
            <div class="w-px h-8 bg-slate-700"></div>
            <div class="text-center">
              <div class="text-lg font-bold text-cyan-400">{{ todayMessages() }}</div>
              <div class="text-xs text-slate-500">\u4ECA\u65E5\u6D88\u606F</div>
            </div>
            <div class="w-px h-8 bg-slate-700"></div>
            <div class="text-center">
              <div class="text-lg font-bold text-purple-400">{{ todayConversions() }}</div>
              <div class="text-xs text-slate-500">\u6210\u4EA4</div>
            </div>
          </div>
        </div>
        
        <!-- \u7C21\u5316\u7684 Tab -->
        <div class="flex gap-1 mt-4 bg-slate-800/50 p-1 rounded-xl w-fit">
          <button (click)="activeTab.set('start')"
                  class="px-6 py-2.5 rounded-lg transition-all flex items-center gap-2 text-sm font-medium"
                  [class.bg-gradient-to-r]="activeTab() === 'start'"
                  [class.from-purple-500]="activeTab() === 'start'"
                  [class.to-pink-500]="activeTab() === 'start'"
                  [class.text-white]="activeTab() === 'start'"
                  [class.text-slate-400]="activeTab() !== 'start'">
            <span>\u{1F680}</span> \u4E00\u9375\u555F\u52D5
          </button>
          <button (click)="activeTab.set('running')"
                  class="px-6 py-2.5 rounded-lg transition-all flex items-center gap-2 text-sm font-medium"
                  [class.bg-gradient-to-r]="activeTab() === 'running'"
                  [class.from-green-500]="activeTab() === 'running'"
                  [class.to-emerald-500]="activeTab() === 'running'"
                  [class.text-white]="activeTab() === 'running'"
                  [class.text-slate-400]="activeTab() !== 'running'">
            <span>\u{1F4CA}</span> \u57F7\u884C\u76E3\u63A7
            @if (runningCount() > 0) {
              <span class="bg-white/20 px-2 py-0.5 rounded-full text-xs">{{ runningCount() }}</span>
            }
          </button>
          <button (click)="activeTab.set('history')"
                  class="px-6 py-2.5 rounded-lg transition-all flex items-center gap-2 text-sm font-medium"
                  [class.bg-gradient-to-r]="activeTab() === 'history'"
                  [class.from-slate-600]="activeTab() === 'history'"
                  [class.to-slate-500]="activeTab() === 'history'"
                  [class.text-white]="activeTab() === 'history'"
                  [class.text-slate-400]="activeTab() !== 'history'">
            <span>\u{1F4DC}</span> \u6B77\u53F2\u8A18\u9304
          </button>
        </div>
      </div>
      
      <!-- \u5167\u5BB9\u5340 -->
      <div class="flex-1 overflow-y-auto p-6">
        @switch (activeTab()) {
          @case ('start') {
            <!-- \u4E00\u53E5\u8A71\u555F\u52D5 -->
            <div class="max-w-3xl mx-auto space-y-8">
              
              <!-- \u4F86\u81EA AI \u71DF\u92B7\u52A9\u624B\u7684\u7B56\u7565\u63D0\u793A -->
              @if (hasIncomingStrategy()) {
                <div class="p-4 bg-gradient-to-r from-emerald-500/20 to-cyan-500/20 border border-emerald-500/30 rounded-2xl">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                      <span class="text-2xl">\u{1F517}</span>
                      <div>
                        <p class="text-emerald-400 font-medium">\u5DF2\u63A5\u6536 AI \u71DF\u92B7\u52A9\u624B\u7684\u7B56\u7565</p>
                        <p class="text-slate-400 text-sm">\u7B56\u7565\u5DF2\u81EA\u52D5\u586B\u5165\uFF0C\u78BA\u8A8D\u5F8C\u5373\u53EF\u958B\u59CB\u57F7\u884C</p>
                      </div>
                    </div>
                    <button (click)="clearIncomingStrategy()"
                            class="p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors">
                      \u2715 \u6E05\u9664
                    </button>
                  </div>
                </div>
              }
              
              <!-- \u4E3B\u8F38\u5165\u5340 -->
              <div class="bg-gradient-to-br from-purple-500/10 via-pink-500/10 to-cyan-500/10 rounded-3xl border border-purple-500/30 p-8">
                <div class="text-center mb-6">
                  <h2 class="text-2xl font-bold text-white mb-2">\u{1F3AF} \u4E00\u53E5\u8A71\uFF0C\u555F\u52D5\u4F60\u7684 AI \u92B7\u552E\u5718\u968A</h2>
                  <p class="text-slate-400">\u544A\u8A34 AI \u4F60\u60F3\u8981\u4EC0\u9EBC\uFF0C\u5269\u4E0B\u7684\u4EA4\u7D66\u6211\u5011</p>
                </div>
                
                <div class="relative">
                  <textarea rows="3"
                            [(ngModel)]="userGoal"
                            (keydown.enter)="onEnterKey($event)"
                            placeholder="\u4F8B\u5982\uFF1A\u6211\u60F3\u8B93\u7FA4\u88E1\u90A3\u4E9B\u770B\u904E\u7522\u54C1\u4F46\u9084\u6C92\u4E0B\u55AE\u7684\u4EBA\u8CFC\u8CB7..."
                            class="w-full px-6 py-4 bg-slate-800/80 border border-slate-600 rounded-2xl text-white text-lg placeholder-slate-500 resize-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                  </textarea>
                  
                  <button (click)="startFromGoal()"
                          [disabled]="!userGoal.trim() || engine.isProcessing()"
                          class="absolute right-3 bottom-3 px-6 py-2.5 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-medium rounded-xl hover:opacity-90 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                    @if (engine.isProcessing()) {
                      <span class="animate-spin">\u23F3</span> \u7B56\u5283\u4E2D...
                    } @else {
                      <span>\u{1F680}</span> AI \u958B\u59CB\u5DE5\u4F5C
                    }
                  </button>
                </div>
              </div>
              
              <!-- \u5FEB\u901F\u76EE\u6A19\u9078\u64C7 -->
              <div>
                <h3 class="text-sm text-slate-400 mb-4 flex items-center gap-2">
                  <span>\u{1F4A1}</span> \u6216\u9078\u64C7\u5E38\u898B\u76EE\u6A19\uFF0C\u4E00\u9375\u958B\u59CB
                </h3>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                  @for (preset of presetGoals; track preset.id) {
                    <button (click)="quickStart(preset.goal)"
                            class="p-4 bg-slate-800/50 border border-slate-700/50 rounded-xl text-left hover:bg-slate-800 hover:border-purple-500/30 transition-all group">
                      <div class="text-2xl mb-2">{{ preset.icon }}</div>
                      <div class="font-medium text-white group-hover:text-purple-400 transition-colors">{{ preset.name }}</div>
                      <div class="text-xs text-slate-400 mt-1">{{ preset.description }}</div>
                    </button>
                  }
                </div>
              </div>
              
              <!-- AI \u7279\u9EDE\u8AAA\u660E -->
              <div class="grid grid-cols-3 gap-4">
                <div class="p-4 bg-slate-800/30 rounded-xl text-center">
                  <div class="text-2xl mb-2">\u{1F3AD}</div>
                  <div class="text-sm text-white font-medium">\u50CF\u771F\u4EBA\u4E00\u6A23</div>
                  <div class="text-xs text-slate-400 mt-1">\u804A\u751F\u6D3B\u3001\u804A\u65B0\u805E\u3001\u81EA\u7136\u5F15\u5C0E</div>
                </div>
                <div class="p-4 bg-slate-800/30 rounded-xl text-center">
                  <div class="text-2xl mb-2">\u{1F504}</div>
                  <div class="text-sm text-white font-medium">\u5BE6\u6642\u8ABF\u6574</div>
                  <div class="text-xs text-slate-400 mt-1">\u6BCF10\u689D\u6D88\u606F\u5206\u6790\u4E00\u6B21</div>
                </div>
                <div class="p-4 bg-slate-800/30 rounded-xl text-center">
                  <div class="text-2xl mb-2">\u{1F91D}</div>
                  <div class="text-sm text-white font-medium">\u591A\u89D2\u8272\u914D\u5408</div>
                  <div class="text-xs text-slate-400 mt-1">AI \u81EA\u52D5\u5354\u8ABF\u6700\u4F73\u7D44\u5408</div>
                </div>
              </div>
            </div>
          }
          
          @case ('running') {
            <!-- \u57F7\u884C\u76E3\u63A7 -->
            <div class="space-y-6">
              @if (activeExecutions().length === 0) {
                <div class="text-center py-16">
                  <div class="text-6xl mb-4">\u{1F680}</div>
                  <p class="text-xl text-white mb-2">\u66AB\u7121\u57F7\u884C\u4E2D\u7684\u4EFB\u52D9</p>
                  <p class="text-slate-400 mb-6">\u524D\u5F80\u300C\u4E00\u9375\u555F\u52D5\u300D\u5275\u5EFA\u65B0\u4EFB\u52D9</p>
                  <button (click)="activeTab.set('start')"
                          class="px-6 py-3 bg-purple-500 text-white rounded-xl hover:bg-purple-400 transition-colors">
                    \u{1F680} \u5275\u5EFA\u4EFB\u52D9
                  </button>
                </div>
              } @else {
                @for (execution of activeExecutions(); track execution.id) {
                  @if (true) {
                    <div class="bg-slate-800/50 border border-slate-700/50 rounded-2xl overflow-hidden">
                      <!-- \u4EFB\u52D9\u982D\u90E8 -->
                      <div class="p-4 border-b border-slate-700/50 flex items-center justify-between">
                        <div class="flex items-center gap-4">
                          <div class="w-3 h-3 rounded-full"
                               [class.bg-green-500]="execution.status === 'running'"
                               [class.bg-yellow-500]="execution.status === 'planning'"
                               [class.bg-orange-500]="execution.status === 'paused'"
                               [class.animate-pulse]="execution.status === 'running'">
                          </div>
                          <div>
                            <div class="font-medium text-white">{{ execution.goal }}</div>
                            <div class="text-xs text-slate-400 flex items-center gap-2">
                              <span>{{ getStatusLabel(execution.status) }}</span>
                              <span>\xB7</span>
                              <span>{{ getExecutionDuration(execution) }}</span>
                            </div>
                          </div>
                        </div>
                        
                        <div class="flex items-center gap-2">
                          @if (execution.status === 'planning') {
                            <button (click)="confirmStart(execution)"
                                    class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-400 transition-colors text-sm">
                              \u25B6\uFE0F \u78BA\u8A8D\u958B\u59CB
                            </button>
                          }
                          @if (execution.status === 'running') {
                            <button (click)="pauseExecution(execution)"
                                    class="px-4 py-2 bg-orange-500/20 text-orange-400 rounded-lg hover:bg-orange-500/30 transition-colors text-sm">
                              \u23F8\uFE0F \u66AB\u505C
                            </button>
                          }
                          @if (execution.status === 'paused') {
                            <button (click)="resumeExecution(execution)"
                                    class="px-4 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-sm">
                              \u25B6\uFE0F \u7E7C\u7E8C
                            </button>
                          }
                          <button (click)="stopExecution(execution)"
                                  class="px-4 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-colors text-sm">
                            \u23F9\uFE0F \u505C\u6B62
                          </button>
                        </div>
                      </div>
                      
                      <!-- \u4EFB\u52D9\u5167\u5BB9 -->
                      <div class="p-4">
                        <!-- \u610F\u5716\u5206\u6790\u7D50\u679C -->
                        @if (execution.intent) {
                          <div class="mb-4 p-3 bg-purple-500/10 border border-purple-500/20 rounded-xl">
                            <div class="flex items-center gap-2 text-purple-400 text-sm mb-2">
                              <span>\u{1F916}</span> AI \u7406\u89E3
                            </div>
                            <p class="text-white">{{ execution.intent.goal }}</p>
                            <div class="flex items-center gap-4 mt-2 text-xs text-slate-400">
                              <span>\u7F6E\u4FE1\u5EA6: {{ execution.intent.confidence }}%</span>
                              <span>\u76EE\u6A19\u7FA4\u9AD4: {{ execution.intent.targetAudience }}</span>
                              <span>\u5EFA\u8B70\u9031\u671F: {{ execution.intent.suggestedDuration }}</span>
                            </div>
                          </div>
                        }
                        
                        <!-- \u89D2\u8272\u5718\u968A -->
                        @if (execution.roles.length > 0) {
                          <div class="mb-4">
                            <div class="text-sm text-slate-400 mb-2">\u{1F3AD} AI \u5718\u968A</div>
                            <div class="flex flex-wrap gap-2">
                              @for (role of execution.roles; track role.id) {
                                <div class="flex items-center gap-2 px-3 py-2 bg-slate-700/50 rounded-lg">
                                  <span class="text-xl">{{ role.icon }}</span>
                                  <div>
                                    <div class="text-sm text-white">{{ role.name }}</div>
                                    <div class="text-xs text-slate-400">{{ role.purpose }}</div>
                                  </div>
                                </div>
                              }
                            </div>
                          </div>
                        }
                        
                        <!-- \u7B56\u7565\u968E\u6BB5 -->
                        @if (execution.strategy) {
                          <div class="mb-4">
                            <div class="text-sm text-slate-400 mb-2">\u{1F4CB} \u57F7\u884C\u968E\u6BB5</div>
                            <div class="flex items-center gap-2">
                              @for (phase of execution.strategy.phases; track phase.id; let i = $index) {
                                <div class="flex items-center">
                                  <div class="px-3 py-1.5 rounded-lg text-xs"
                                       [class.bg-green-500]="i < execution.stats.currentPhase"
                                       [class.text-white]="i < execution.stats.currentPhase"
                                       [class.bg-purple-500]="i === execution.stats.currentPhase"
                                       [class.text-white]="i === execution.stats.currentPhase"
                                       [class.bg-slate-700]="i > execution.stats.currentPhase"
                                       [class.text-slate-400]="i > execution.stats.currentPhase">
                                    {{ phase.name }}
                                  </div>
                                  @if (i < execution.strategy!.phases.length - 1) {
                                    <svg class="w-4 h-4 text-slate-500 mx-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                    </svg>
                                  }
                                </div>
                              }
                            </div>
                          </div>
                        }
                        
                        <!-- \u5BE6\u6642\u7D71\u8A08 -->
                        <div class="grid grid-cols-4 gap-4">
                          <div class="p-3 bg-slate-700/30 rounded-lg text-center">
                            <div class="text-lg font-bold text-cyan-400">{{ execution.stats.messagesSent }}</div>
                            <div class="text-xs text-slate-400">\u5DF2\u767C\u6D88\u606F</div>
                          </div>
                          <div class="p-3 bg-slate-700/30 rounded-lg text-center">
                            <div class="text-lg font-bold text-green-400">{{ execution.stats.responsesReceived }}</div>
                            <div class="text-xs text-slate-400">\u6536\u5230\u56DE\u8986</div>
                          </div>
                          <div class="p-3 bg-slate-700/30 rounded-lg text-center">
                            <div class="text-lg font-bold text-purple-400">{{ execution.stats.interestScore }}%</div>
                            <div class="text-xs text-slate-400">\u8208\u8DA3\u5EA6</div>
                          </div>
                          <div class="p-3 bg-slate-700/30 rounded-lg text-center">
                            <div class="text-lg font-bold text-yellow-400">{{ execution.stats.currentPhase + 1 }}/{{ execution.strategy?.phases?.length || 0 }}</div>
                            <div class="text-xs text-slate-400">\u7576\u524D\u968E\u6BB5</div>
                          </div>
                        </div>
                        
                        <!-- \u6700\u65B0\u5206\u6790 -->
                        @if (execution.stats.lastAnalysis) {
                          <div class="mt-4 p-3 bg-cyan-500/10 border border-cyan-500/20 rounded-xl">
                            <div class="flex items-center gap-2 text-cyan-400 text-sm mb-2">
                              <span>\u{1F50D}</span> AI \u6700\u65B0\u5206\u6790
                            </div>
                            <p class="text-white text-sm">{{ execution.stats.lastAnalysis.suggestions.reasoning }}</p>
                            <div class="text-xs text-slate-400 mt-2">
                              \u5EFA\u8B70: {{ execution.stats.lastAnalysis.suggestions.topicSuggestion }}
                            </div>
                          </div>
                        }
                        
                        <!-- \u9AD8\u610F\u5411\u5BA2\u6236\u5EFA\u7FA4 -->
                        @if (execution.stats.interestScore >= 50 && execution.status === 'running') {
                          <div class="mt-4 p-4 bg-gradient-to-r from-amber-500/10 to-orange-500/10 border border-amber-500/20 rounded-xl">
                            <div class="flex items-center justify-between">
                              <div>
                                <div class="flex items-center gap-2 text-amber-400 text-sm mb-1">
                                  <span>\u{1F3AF}</span> \u9AD8\u610F\u5411\u5BA2\u6236
                                </div>
                                <p class="text-white text-sm">\u6AA2\u6E2C\u5230\u9AD8\u610F\u5411\u5BA2\u6236\uFF0C\u5EFA\u8B70\u5275\u5EFA\u5C08\u5C6C\u7FA4\u7D44\u9032\u884C\u591A\u89D2\u8272\u5354\u4F5C\u6210\u4EA4</p>
                              </div>
                              <button (click)="createGroupForExecution(execution)"
                                      class="px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg hover:from-amber-400 hover:to-orange-400 transition-all text-sm font-medium flex items-center gap-2 whitespace-nowrap">
                                <span>\u{1F465}</span> \u4E00\u9375\u5EFA\u7FA4
                              </button>
                            </div>
                          </div>
                        }
                      </div>
                    </div>
                  }
                }
              }
            </div>
          }
          
          @case ('history') {
            <!-- \u6B77\u53F2\u8A18\u9304 -->
            <div class="space-y-4">
              @if (completedExecutions().length === 0) {
                <div class="text-center py-16">
                  <div class="text-6xl mb-4">\u{1F4DC}</div>
                  <p class="text-xl text-white mb-2">\u66AB\u7121\u6B77\u53F2\u8A18\u9304</p>
                  <p class="text-slate-400">\u5B8C\u6210\u7684\u4EFB\u52D9\u6703\u986F\u793A\u5728\u9019\u88E1</p>
                </div>
              } @else {
                @for (execution of completedExecutions(); track execution.id) {
                  <div class="p-4 bg-slate-800/50 border border-slate-700/50 rounded-xl">
                    <div class="flex items-center justify-between">
                      <div>
                        <div class="font-medium text-white">{{ execution.goal }}</div>
                        <div class="text-sm text-slate-400 mt-1">
                          {{ execution.intent?.goal }} \xB7 {{ execution.stats.messagesSent }} \u689D\u6D88\u606F
                        </div>
                      </div>
                      <div class="text-right">
                        <div class="text-sm text-slate-400">{{ formatDate(execution.stats.startTime) }}</div>
                        <div class="text-xs text-green-400">\u5DF2\u5B8C\u6210</div>
                      </div>
                    </div>
                  </div>
                }
              }
            </div>
          }
        }
      </div>
      
      <!-- \u7B56\u5283\u7D50\u679C\u78BA\u8A8D\u5C0D\u8A71\u6846 -->
      @if (showPlanningResult()) {
        <div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4">
          <div class="bg-slate-900 rounded-2xl w-full max-w-2xl shadow-2xl border border-purple-500/30 overflow-hidden max-h-[90vh] overflow-y-auto">
            <!-- \u982D\u90E8 -->
            <div class="p-6 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border-b border-slate-700/50">
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-2xl">
                  \u{1F916}
                </div>
                <div>
                  <h2 class="text-xl font-bold text-white">AI \u7B56\u5283\u5B8C\u6210\uFF01</h2>
                  <p class="text-slate-400">\u78BA\u8A8D\u4EE5\u4E0B\u65B9\u6848\uFF0C\u5373\u53EF\u958B\u59CB\u57F7\u884C</p>
                </div>
              </div>
            </div>
            
            <!-- \u5167\u5BB9 -->
            @if (pendingExecution()) {
              <div class="p-6 space-y-6">
                <!-- \u76EE\u6A19\u7406\u89E3 -->
                <div class="p-4 bg-slate-800/50 rounded-xl">
                  <div class="text-sm text-slate-400 mb-2">\u{1F3AF} AI \u7406\u89E3\u7684\u76EE\u6A19</div>
                  <p class="text-white">{{ pendingExecution()?.intent?.goal }}</p>
                  <div class="flex items-center gap-4 mt-2 text-xs">
                    <span class="text-purple-400">\u7F6E\u4FE1\u5EA6: {{ pendingExecution()?.intent?.confidence }}%</span>
                    <span class="text-cyan-400">\u5EFA\u8B70\u9031\u671F: {{ pendingExecution()?.intent?.suggestedDuration }}</span>
                  </div>
                </div>
                
                <!-- \u63A8\u85A6\u5718\u968A -->
                <div>
                  <div class="text-sm text-slate-400 mb-3">\u{1F3AD} AI \u63A8\u85A6\u7684\u5718\u968A</div>
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    @for (role of pendingExecution()?.roles; track role.id) {
                      <div class="p-4 bg-slate-800/50 rounded-xl">
                        <div class="flex items-center gap-2 mb-2">
                          <span class="text-2xl">{{ role.icon }}</span>
                          <span class="text-white font-medium">{{ role.name }}</span>
                        </div>
                        <p class="text-xs text-slate-400">{{ role.purpose }}</p>
                        <p class="text-xs text-cyan-400 mt-1">{{ role.entryTiming }}</p>
                      </div>
                    }
                  </div>
                </div>
                
                <!-- \u57F7\u884C\u8A08\u5283 -->
                <div>
                  <div class="text-sm text-slate-400 mb-3">\u{1F4CB} \u57F7\u884C\u8A08\u5283</div>
                  <div class="space-y-3">
                    @for (phase of pendingExecution()?.strategy?.phases; track phase.id; let i = $index) {
                      <div class="flex items-start gap-4 p-3 bg-slate-800/50 rounded-lg">
                        <div class="w-8 h-8 rounded-full bg-purple-500/30 text-purple-400 flex items-center justify-center flex-shrink-0">
                          {{ i + 1 }}
                        </div>
                        <div class="flex-1">
                          <div class="flex items-center justify-between">
                            <span class="text-white font-medium">{{ phase.name }}</span>
                            <span class="text-xs text-slate-400">{{ phase.duration }}</span>
                          </div>
                          <p class="text-sm text-slate-400 mt-1">{{ phase.goal }}</p>
                        </div>
                      </div>
                    }
                  </div>
                </div>
                
                <!-- AI \u8AAA\u660E -->
                <div class="p-4 bg-cyan-500/10 border border-cyan-500/20 rounded-xl">
                  <div class="flex items-center gap-2 text-cyan-400 text-sm mb-2">
                    <span>\u{1F4A1}</span> AI \u6703\u9019\u6A23\u505A
                  </div>
                  <ul class="text-sm text-slate-300 space-y-1">
                    <li>\u2022 \u50CF\u771F\u4EBA\u4E00\u6A23\u5728\u7FA4\u88E1\u804A\u5929\uFF0C\u804A\u751F\u6D3B\u3001\u804A\u65B0\u805E</li>
                    <li>\u2022 \u81EA\u7136\u5730\u5F15\u5165\u7522\u54C1\u8A71\u984C\uFF0C\u4E0D\u751F\u786C\u63A8\u92B7</li>
                    <li>\u2022 \u6BCF 10 \u689D\u6D88\u606F\u5206\u6790\u4E00\u6B21\uFF0C\u52D5\u614B\u8ABF\u6574\u7B56\u7565</li>
                    <li>\u2022 \u6839\u64DA\u5BA2\u6236\u53CD\u61C9\u9748\u6D3B\u5207\u63DB\u89D2\u8272</li>
                  </ul>
                </div>
              </div>
            }
            
            <!-- \u5E95\u90E8\u6309\u9215 -->
            <div class="p-6 border-t border-slate-700/50 flex gap-3">
              <button (click)="cancelPendingExecution()"
                      class="flex-1 py-3 bg-slate-700 text-slate-300 rounded-xl hover:bg-slate-600 transition-colors">
                \u53D6\u6D88
              </button>
              <button (click)="confirmPendingExecution()"
                      class="flex-1 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-medium rounded-xl hover:opacity-90 transition-opacity flex items-center justify-center gap-2">
                <span>\u25B6\uFE0F</span> \u78BA\u8A8D\u958B\u59CB
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  `
    }]
  }], () => [], { incomingStrategy: [{ type: Input, args: [{ isSignal: true, alias: "incomingStrategy", required: false }] }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(AiTeamHubComponent, { className: "AiTeamHubComponent", filePath: "src/multi-role/ai-team-hub.component.ts", lineNumber: 524 });
})();

// src/member-database/member-database.component.ts
var _forTrack019 = ($index, $item) => $item.group;
var _forTrack16 = ($index, $item) => $item.user_id;
function MemberDatabaseComponent_Conditional_13_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 9)(1, "button", 50);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_13_Template_button_click_1_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      ctx_r1.deduplicateMembers();
      return \u0275\u0275resetView(ctx_r1.showAdvancedMenu.set(false));
    });
    \u0275\u0275text(2, " \u{1F504} \u667A\u80FD\u53BB\u91CD ");
    \u0275\u0275elementStart(3, "span", 51);
    \u0275\u0275text(4, "\u8DE8\u7FA4\u7D44\u5408\u4F75");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(5, "button", 50);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_13_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      ctx_r1.recalculateScores();
      return \u0275\u0275resetView(ctx_r1.showAdvancedMenu.set(false));
    });
    \u0275\u0275text(6, " \u{1F4CA} \u91CD\u7B97\u8A55\u5206 ");
    \u0275\u0275elementStart(7, "span", 51);
    \u0275\u0275text(8, "\u66F4\u65B0\u50F9\u503C\u7B49\u7D1A");
    \u0275\u0275elementEnd()();
    \u0275\u0275element(9, "div", 52);
    \u0275\u0275elementStart(10, "button", 50);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_13_Template_button_click_10_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      ctx_r1.showGroupProfile();
      return \u0275\u0275resetView(ctx_r1.showAdvancedMenu.set(false));
    });
    \u0275\u0275text(11, " \u{1F4C8} \u7FA4\u7D44\u756B\u50CF ");
    \u0275\u0275elementStart(12, "span", 51);
    \u0275\u0275text(13, "\u8CEA\u91CF\u5206\u6790");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(14, "button", 50);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_13_Template_button_click_14_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      ctx_r1.compareGroups();
      return \u0275\u0275resetView(ctx_r1.showAdvancedMenu.set(false));
    });
    \u0275\u0275text(15, " \u{1F4CA} \u7FA4\u7D44\u5C0D\u6BD4 ");
    \u0275\u0275elementStart(16, "span", 51);
    \u0275\u0275text(17, "\u591A\u7FA4\u5C0D\u6BD4");
    \u0275\u0275elementEnd()();
    \u0275\u0275element(18, "div", 52);
    \u0275\u0275elementStart(19, "button", 50);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_13_Template_button_click_19_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      ctx_r1.viewExtractionStats();
      return \u0275\u0275resetView(ctx_r1.showAdvancedMenu.set(false));
    });
    \u0275\u0275text(20, " \u{1F4C9} \u63D0\u53D6\u7D71\u8A08 ");
    \u0275\u0275elementStart(21, "span", 51);
    \u0275\u0275text(22, "\u6210\u529F\u7387/\u6548\u80FD");
    \u0275\u0275elementEnd()()();
  }
}
function MemberDatabaseComponent_Conditional_30_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 18);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("+", ctx_r1.stats().todayNew, " \u4ECA\u65E5");
  }
}
function MemberDatabaseComponent_Conditional_92_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 53);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_92_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.clearSearch());
    });
    \u0275\u0275text(1, "\u2715");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_For_97_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "option", 33);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const source_r4 = ctx.$implicit;
    \u0275\u0275property("value", source_r4.group);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2("", source_r4.title, " (", source_r4.count, ")");
  }
}
function MemberDatabaseComponent_Conditional_143_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 54);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_143_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.clearFilters());
    });
    \u0275\u0275text(1, " \u{1F5D1}\uFE0F \u6E05\u9664\u7BE9\u9078 ");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_151_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 48);
    \u0275\u0275element(1, "div", 55);
    \u0275\u0275elementStart(2, "p");
    \u0275\u0275text(3, "\u6B63\u5728\u8F09\u5165\u6210\u54E1\u6578\u64DA...");
    \u0275\u0275elementEnd()();
  }
}
function MemberDatabaseComponent_Conditional_152_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 49)(1, "div", 56);
    \u0275\u0275text(2, "\u{1F4ED}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "h3");
    \u0275\u0275text(4, "\u66AB\u7121\u6210\u54E1\u6578\u64DA");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p");
    \u0275\u0275text(6, "\u8ACB\u5148\u5F9E\u300C\u8CC7\u6E90\u767C\u73FE\u300D\u9801\u9762\u63D0\u53D6\u7FA4\u7D44\u6210\u54E1");
    \u0275\u0275elementEnd()();
  }
}
function MemberDatabaseComponent_Conditional_153_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 57)(1, "span", 78);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 79)(4, "button", 80);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_Conditional_0_Template_button_click_4_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.batchSendMessage());
    });
    \u0275\u0275text(5, " \u{1F4E8} \u6279\u91CF\u767C\u6D88\u606F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "button", 80);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_Conditional_0_Template_button_click_6_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.batchAddTags());
    });
    \u0275\u0275text(7, " \u{1F3F7}\uFE0F \u6279\u91CF\u6A19\u7C64 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "button", 80);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_Conditional_0_Template_button_click_8_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.batchMarkContacted());
    });
    \u0275\u0275text(9, " \u2705 \u6A19\u8A18\u5DF2\u806F\u7E6B ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "button", 80);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_Conditional_0_Template_button_click_10_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.batchExport());
    });
    \u0275\u0275text(11, " \u{1F4E5} \u5C0E\u51FA\u9078\u4E2D ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "button", 81);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_Conditional_0_Template_button_click_12_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.clearSelection());
    });
    \u0275\u0275text(13, " \u2715 \u53D6\u6D88\u9078\u64C7 ");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u5DF2\u9078\u64C7 ", ctx_r1.selectedMemberIds().length, " \u500B\u6210\u54E1");
  }
}
function MemberDatabaseComponent_Conditional_153_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span");
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(ctx_r1.sortDirection === "asc" ? "\u2191" : "\u2193");
  }
}
function MemberDatabaseComponent_Conditional_153_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span");
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(ctx_r1.sortDirection === "asc" ? "\u2191" : "\u2193");
  }
}
function MemberDatabaseComponent_Conditional_153_Conditional_17_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span");
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(ctx_r1.sortDirection === "asc" ? "\u2191" : "\u2193");
  }
}
function MemberDatabaseComponent_Conditional_153_Conditional_20_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span");
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(ctx_r1.sortDirection === "asc" ? "\u2191" : "\u2193");
  }
}
function MemberDatabaseComponent_Conditional_153_For_31_Conditional_13_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 92);
    \u0275\u0275text(1, "\u2B50");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_153_For_31_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 93);
    \u0275\u0275text(1, "\u2713");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_153_For_31_Conditional_15_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 94);
    \u0275\u0275text(1, "\u{1F1E8}\u{1F1F3}");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_153_For_31_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 95);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const member_r9 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275property("title", member_r9.bio);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(member_r9.bio);
  }
}
function MemberDatabaseComponent_Conditional_153_For_31_Conditional_18_Template(rf, ctx) {
  if (rf & 1) {
    const _r10 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "a", 112);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_For_31_Conditional_18_Template_a_click_0_listener($event) {
      \u0275\u0275restoreView(_r10);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const member_r9 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275property("href", "https://t.me/" + member_r9.username, \u0275\u0275sanitizeUrl);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" @", member_r9.username, " ");
  }
}
function MemberDatabaseComponent_Conditional_153_For_31_Conditional_19_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 97);
    \u0275\u0275text(1, "-");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_153_For_31_Conditional_30_For_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 113);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const tag_r11 = ctx.$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(tag_r11);
  }
}
function MemberDatabaseComponent_Conditional_153_For_31_Conditional_30_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 114);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const member_r9 = \u0275\u0275nextContext(2).$implicit;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("+", ctx_r1.getMemberTags(member_r9).length - 2);
  }
}
function MemberDatabaseComponent_Conditional_153_For_31_Conditional_30_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 103);
    \u0275\u0275repeaterCreate(1, MemberDatabaseComponent_Conditional_153_For_31_Conditional_30_For_2_Template, 2, 1, "span", 113, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275conditionalCreate(3, MemberDatabaseComponent_Conditional_153_For_31_Conditional_30_Conditional_3_Template, 2, 1, "span", 114);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const member_r9 = \u0275\u0275nextContext().$implicit;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r1.getMemberTags(member_r9).slice(0, 2));
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.getMemberTags(member_r9).length > 2 ? 3 : -1);
  }
}
function MemberDatabaseComponent_Conditional_153_For_31_Conditional_31_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 104);
    \u0275\u0275text(1, "-");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_153_For_31_Conditional_33_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 105);
    \u0275\u0275text(1, " \u2705 \u5DF2\u806F\u7E6B ");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_153_For_31_Conditional_34_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 106);
    \u0275\u0275text(1, " \u{1F4ED} \u672A\u806F\u7E6B ");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_153_For_31_Template(rf, ctx) {
  if (rf & 1) {
    const _r8 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "tr", 82);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_For_31_Template_tr_click_0_listener() {
      const member_r9 = \u0275\u0275restoreView(_r8).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.openMemberDetail(member_r9));
    });
    \u0275\u0275elementStart(1, "td", 83);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_For_31_Template_td_click_1_listener($event) {
      \u0275\u0275restoreView(_r8);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275elementStart(2, "input", 84);
    \u0275\u0275listener("change", function MemberDatabaseComponent_Conditional_153_For_31_Template_input_change_2_listener() {
      const member_r9 = \u0275\u0275restoreView(_r8).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.toggleMemberSelection(member_r9.user_id));
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(3, "td", 85)(4, "span", 86);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "td", 87)(7, "div", 88)(8, "div", 89);
    \u0275\u0275text(9);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "div", 90)(11, "span", 91);
    \u0275\u0275text(12);
    \u0275\u0275conditionalCreate(13, MemberDatabaseComponent_Conditional_153_For_31_Conditional_13_Template, 2, 0, "span", 92);
    \u0275\u0275conditionalCreate(14, MemberDatabaseComponent_Conditional_153_For_31_Conditional_14_Template, 2, 0, "span", 93);
    \u0275\u0275conditionalCreate(15, MemberDatabaseComponent_Conditional_153_For_31_Conditional_15_Template, 2, 0, "span", 94);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(16, MemberDatabaseComponent_Conditional_153_For_31_Conditional_16_Template, 2, 2, "span", 95);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(17, "td", 64);
    \u0275\u0275conditionalCreate(18, MemberDatabaseComponent_Conditional_153_For_31_Conditional_18_Template, 2, 2, "a", 96)(19, MemberDatabaseComponent_Conditional_153_For_31_Conditional_19_Template, 2, 0, "span", 97);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(20, "td", 98)(21, "span", 99);
    \u0275\u0275text(22);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(23, "td", 100)(24, "span", 101);
    \u0275\u0275text(25);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(26, "td", 67)(27, "span", 102);
    \u0275\u0275text(28);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(29, "td", 68);
    \u0275\u0275conditionalCreate(30, MemberDatabaseComponent_Conditional_153_For_31_Conditional_30_Template, 4, 1, "div", 103)(31, MemberDatabaseComponent_Conditional_153_For_31_Conditional_31_Template, 2, 0, "span", 104);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(32, "td", 69);
    \u0275\u0275conditionalCreate(33, MemberDatabaseComponent_Conditional_153_For_31_Conditional_33_Template, 2, 0, "span", 105)(34, MemberDatabaseComponent_Conditional_153_For_31_Conditional_34_Template, 2, 0, "span", 106);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(35, "td", 107);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_For_31_Template_td_click_35_listener($event) {
      \u0275\u0275restoreView(_r8);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275elementStart(36, "div", 108)(37, "button", 109);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_For_31_Template_button_click_37_listener() {
      const member_r9 = \u0275\u0275restoreView(_r8).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.sendMessage(member_r9));
    });
    \u0275\u0275text(38, " \u{1F4AC} ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(39, "button", 110);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_For_31_Template_button_click_39_listener() {
      const member_r9 = \u0275\u0275restoreView(_r8).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.addToFunnel(member_r9));
    });
    \u0275\u0275text(40, " \u{1F4E4} ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(41, "button", 111);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_For_31_Template_button_click_41_listener() {
      const member_r9 = \u0275\u0275restoreView(_r8).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.openMemberDetail(member_r9));
    });
    \u0275\u0275text(42, " \u{1F441}\uFE0F ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const member_r9 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275classProp("selected", ctx_r1.isMemberSelected(member_r9.user_id));
    \u0275\u0275advance(2);
    \u0275\u0275property("checked", ctx_r1.isMemberSelected(member_r9.user_id));
    \u0275\u0275advance(2);
    \u0275\u0275property("title", member_r9.user_id);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(member_r9.user_id);
    \u0275\u0275advance(3);
    \u0275\u0275classProp("has-photo", member_r9.has_photo);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.getAvatarLetter(member_r9), " ");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate2(" ", member_r9.first_name, " ", member_r9.last_name, " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(member_r9.is_premium ? 13 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(member_r9.is_verified ? 14 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isChinese(member_r9) ? 15 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(member_r9.bio ? 16 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(member_r9.username ? 18 : 19);
    \u0275\u0275advance(3);
    \u0275\u0275classMap("status-" + member_r9.online_status);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", ctx_r1.getStatusIcon(member_r9.online_status), " ", ctx_r1.getStatusText(member_r9.online_status), " ");
    \u0275\u0275advance(2);
    \u0275\u0275classMap("level-" + member_r9.value_level);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", member_r9.value_level, " ");
    \u0275\u0275advance(2);
    \u0275\u0275property("title", member_r9.source_chat_title);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", member_r9.source_chat_title || "\u672A\u77E5", " ");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.getMemberTags(member_r9).length > 0 ? 30 : 31);
    \u0275\u0275advance(3);
    \u0275\u0275conditional(member_r9.contacted ? 33 : 34);
  }
}
function MemberDatabaseComponent_Conditional_153_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275conditionalCreate(0, MemberDatabaseComponent_Conditional_153_Conditional_0_Template, 14, 1, "div", 57);
    \u0275\u0275elementStart(1, "div", 58)(2, "table", 59)(3, "thead")(4, "tr")(5, "th", 60)(6, "input", 61);
    \u0275\u0275listener("change", function MemberDatabaseComponent_Conditional_153_Template_input_change_6_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.toggleSelectAll());
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(7, "th", 62);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_Template_th_click_7_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.sortBy("user_id"));
    });
    \u0275\u0275text(8, " ID ");
    \u0275\u0275conditionalCreate(9, MemberDatabaseComponent_Conditional_153_Conditional_9_Template, 2, 1, "span");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "th", 63);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_Template_th_click_10_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.sortBy("first_name"));
    });
    \u0275\u0275text(11, " \u7528\u6236 ");
    \u0275\u0275conditionalCreate(12, MemberDatabaseComponent_Conditional_153_Conditional_12_Template, 2, 1, "span");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "th", 64);
    \u0275\u0275text(14, "\u7528\u6236\u540D");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "th", 65);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_Template_th_click_15_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.sortBy("online_status"));
    });
    \u0275\u0275text(16, " \u72C0\u614B ");
    \u0275\u0275conditionalCreate(17, MemberDatabaseComponent_Conditional_153_Conditional_17_Template, 2, 1, "span");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "th", 66);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_Template_th_click_18_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.sortBy("value_level"));
    });
    \u0275\u0275text(19, " \u7B49\u7D1A ");
    \u0275\u0275conditionalCreate(20, MemberDatabaseComponent_Conditional_153_Conditional_20_Template, 2, 1, "span");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(21, "th", 67);
    \u0275\u0275text(22, "\u4F86\u6E90\u7FA4\u7D44");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(23, "th", 68);
    \u0275\u0275text(24, "\u6A19\u7C64");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(25, "th", 69);
    \u0275\u0275text(26, "\u806F\u7E6B\u72C0\u614B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(27, "th", 70);
    \u0275\u0275text(28, "\u64CD\u4F5C");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(29, "tbody");
    \u0275\u0275repeaterCreate(30, MemberDatabaseComponent_Conditional_153_For_31_Template, 43, 26, "tr", 71, _forTrack16);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(32, "div", 72)(33, "div", 73);
    \u0275\u0275text(34);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(35, "div", 74)(36, "button", 75);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_Template_button_click_36_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.goToPage(1));
    });
    \u0275\u0275text(37, " \u23EE\uFE0F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(38, "button", 75);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_Template_button_click_38_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.goToPage(ctx_r1.currentPage - 1));
    });
    \u0275\u0275text(39, " \u25C0\uFE0F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(40, "span", 76);
    \u0275\u0275text(41);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(42, "button", 75);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_Template_button_click_42_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.goToPage(ctx_r1.currentPage + 1));
    });
    \u0275\u0275text(43, " \u25B6\uFE0F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(44, "button", 75);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_153_Template_button_click_44_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.goToPage(ctx_r1.totalPages()));
    });
    \u0275\u0275text(45, " \u23ED\uFE0F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(46, "select", 77);
    \u0275\u0275twoWayListener("ngModelChange", function MemberDatabaseComponent_Conditional_153_Template_select_ngModelChange_46_listener($event) {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.pageSize, $event) || (ctx_r1.pageSize = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275listener("ngModelChange", function MemberDatabaseComponent_Conditional_153_Template_select_ngModelChange_46_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.onPageSizeChange());
    });
    \u0275\u0275elementStart(47, "option", 33);
    \u0275\u0275text(48, "25 / \u9801");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(49, "option", 33);
    \u0275\u0275text(50, "50 / \u9801");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(51, "option", 33);
    \u0275\u0275text(52, "100 / \u9801");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(53, "option", 33);
    \u0275\u0275text(54, "200 / \u9801");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275conditional(ctx_r1.selectedMemberIds().length > 0 ? 0 : -1);
    \u0275\u0275advance(6);
    \u0275\u0275property("checked", ctx_r1.isAllSelected())("indeterminate", ctx_r1.isPartialSelected());
    \u0275\u0275advance(3);
    \u0275\u0275conditional(ctx_r1.sortField === "user_id" ? 9 : -1);
    \u0275\u0275advance(3);
    \u0275\u0275conditional(ctx_r1.sortField === "first_name" ? 12 : -1);
    \u0275\u0275advance(5);
    \u0275\u0275conditional(ctx_r1.sortField === "online_status" ? 17 : -1);
    \u0275\u0275advance(3);
    \u0275\u0275conditional(ctx_r1.sortField === "value_level" ? 20 : -1);
    \u0275\u0275advance(10);
    \u0275\u0275repeater(ctx_r1.paginatedMembers());
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate3(" \u986F\u793A ", ctx_r1.getPageStart(), " - ", ctx_r1.getPageEnd(), " / ", ctx_r1.filteredMembers().length, " \u500B\u6210\u54E1 ");
    \u0275\u0275advance(2);
    \u0275\u0275property("disabled", ctx_r1.currentPage === 1);
    \u0275\u0275advance(2);
    \u0275\u0275property("disabled", ctx_r1.currentPage === 1);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate2("", ctx_r1.currentPage, " / ", ctx_r1.totalPages());
    \u0275\u0275advance();
    \u0275\u0275property("disabled", ctx_r1.currentPage >= ctx_r1.totalPages());
    \u0275\u0275advance(2);
    \u0275\u0275property("disabled", ctx_r1.currentPage >= ctx_r1.totalPages());
    \u0275\u0275advance(2);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.pageSize);
    \u0275\u0275advance();
    \u0275\u0275property("value", 25);
    \u0275\u0275advance(2);
    \u0275\u0275property("value", 50);
    \u0275\u0275advance(2);
    \u0275\u0275property("value", 100);
    \u0275\u0275advance(2);
    \u0275\u0275property("value", 200);
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_15_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 125);
    \u0275\u0275text(1, "\u2B50");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "a", 126);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275property("href", "https://t.me/" + ctx_r1.selectedMember().username, \u0275\u0275sanitizeUrl);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" @", ctx_r1.selectedMember().username, " ");
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_30_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 129)(1, "span", 130);
    \u0275\u0275text(2, "\u96FB\u8A71\u865F\u78BC");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 133);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r1.selectedMember().phone);
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_31_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 129)(1, "span", 130);
    \u0275\u0275text(2, "\u8A9E\u8A00");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 133);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r1.selectedMember().language_code);
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_47_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 135);
    \u0275\u0275text(1, "\u2B50 Premium");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_48_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 136);
    \u0275\u0275text(1, "\u2713 \u5DF2\u9A57\u8B49");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_49_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 137);
    \u0275\u0275text(1, "\u{1F4F7} \u6709\u982D\u50CF");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_50_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 138);
    \u0275\u0275text(1, "\u{1F1E8}\u{1F1F3} \u83EF\u4EBA");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_51_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 139);
    \u0275\u0275text(1, "\u26A0\uFE0F \u8A50\u9A19\u6A19\u8A18");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_52_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 140);
    \u0275\u0275text(1, "\u{1F5D1}\uFE0F \u5DF2\u522A\u9664");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_53_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 120)(1, "h4", 127);
    \u0275\u0275text(2, "\u{1F4DD} \u500B\u4EBA\u7C21\u4ECB");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 156);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r1.selectedMember().bio);
  }
}
function MemberDatabaseComponent_Conditional_154_For_64_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 142)(1, "span", 143);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const groupId_r13 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u7FA4\u7D44 ", groupId_r13);
  }
}
function MemberDatabaseComponent_Conditional_154_For_64_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275conditionalCreate(0, MemberDatabaseComponent_Conditional_154_For_64_Conditional_0_Template, 3, 1, "div", 142);
  }
  if (rf & 2) {
    const groupId_r13 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275conditional(groupId_r13 !== ctx_r1.selectedMember().source_chat_id ? 0 : -1);
  }
}
function MemberDatabaseComponent_Conditional_154_For_70_Template(rf, ctx) {
  if (rf & 1) {
    const _r14 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "span", 146);
    \u0275\u0275text(1);
    \u0275\u0275elementStart(2, "button", 157);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_154_For_70_Template_button_click_2_listener() {
      const tag_r15 = \u0275\u0275restoreView(_r14).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.removeTag(ctx_r1.selectedMember(), tag_r15));
    });
    \u0275\u0275text(3, "\u2715");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const tag_r15 = ctx.$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", tag_r15, " ");
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_86_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 150)(1, "span", 151);
    \u0275\u0275text(2, "\u806F\u7E6B\u6642\u9593");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 152);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r1.formatDate(ctx_r1.selectedMember().contacted_at));
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_87_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 150)(1, "span", 151);
    \u0275\u0275text(2, "\u56DE\u8986\u72C0\u614B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 152);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r1.selectedMember().response_status);
  }
}
function MemberDatabaseComponent_Conditional_154_Conditional_98_Template(rf, ctx) {
  if (rf & 1) {
    const _r16 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 8);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_154_Conditional_98_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r16);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.markAsContacted(ctx_r1.selectedMember()));
    });
    \u0275\u0275text(1, " \u2705 \u6A19\u8A18\u5DF2\u806F\u7E6B ");
    \u0275\u0275elementEnd();
  }
}
function MemberDatabaseComponent_Conditional_154_Template(rf, ctx) {
  if (rf & 1) {
    const _r12 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 115);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_154_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r12);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.closeMemberDetail());
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(1, "div", 116)(2, "div", 117)(3, "h2");
    \u0275\u0275text(4, "\u6210\u54E1\u8A73\u60C5");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "button", 118);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_154_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r12);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.closeMemberDetail());
    });
    \u0275\u0275text(6, "\u2715");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(7, "div", 119)(8, "div", 120)(9, "div", 121)(10, "div", 122);
    \u0275\u0275text(11);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "div", 123)(13, "h3", 124);
    \u0275\u0275text(14);
    \u0275\u0275conditionalCreate(15, MemberDatabaseComponent_Conditional_154_Conditional_15_Template, 2, 0, "span", 125);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(16, MemberDatabaseComponent_Conditional_154_Conditional_16_Template, 2, 2, "a", 126);
    \u0275\u0275elementStart(17, "span", 99);
    \u0275\u0275text(18);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(19, "div", 120)(20, "h4", 127);
    \u0275\u0275text(21, "\u{1F4CB} \u57FA\u672C\u4FE1\u606F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(22, "div", 128)(23, "div", 129)(24, "span", 130);
    \u0275\u0275text(25, "Telegram ID");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(26, "span", 131);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_154_Template_span_click_26_listener() {
      \u0275\u0275restoreView(_r12);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.copyToClipboard(ctx_r1.selectedMember().user_id));
    });
    \u0275\u0275text(27);
    \u0275\u0275elementStart(28, "span", 132);
    \u0275\u0275text(29, "\u{1F4CB}");
    \u0275\u0275elementEnd()()();
    \u0275\u0275conditionalCreate(30, MemberDatabaseComponent_Conditional_154_Conditional_30_Template, 5, 1, "div", 129);
    \u0275\u0275conditionalCreate(31, MemberDatabaseComponent_Conditional_154_Conditional_31_Template, 5, 1, "div", 129);
    \u0275\u0275elementStart(32, "div", 129)(33, "span", 130);
    \u0275\u0275text(34, "\u50F9\u503C\u7B49\u7D1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(35, "span", 133)(36, "span", 101);
    \u0275\u0275text(37);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(38, "div", 129)(39, "span", 130);
    \u0275\u0275text(40, "\u6D3B\u8E8D\u5EA6\u8A55\u5206");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(41, "span", 133);
    \u0275\u0275text(42);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275elementStart(43, "div", 120)(44, "h4", 127);
    \u0275\u0275text(45, "\u{1F516} \u5E33\u865F\u72C0\u614B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(46, "div", 134);
    \u0275\u0275conditionalCreate(47, MemberDatabaseComponent_Conditional_154_Conditional_47_Template, 2, 0, "span", 135);
    \u0275\u0275conditionalCreate(48, MemberDatabaseComponent_Conditional_154_Conditional_48_Template, 2, 0, "span", 136);
    \u0275\u0275conditionalCreate(49, MemberDatabaseComponent_Conditional_154_Conditional_49_Template, 2, 0, "span", 137);
    \u0275\u0275conditionalCreate(50, MemberDatabaseComponent_Conditional_154_Conditional_50_Template, 2, 0, "span", 138);
    \u0275\u0275conditionalCreate(51, MemberDatabaseComponent_Conditional_154_Conditional_51_Template, 2, 0, "span", 139);
    \u0275\u0275conditionalCreate(52, MemberDatabaseComponent_Conditional_154_Conditional_52_Template, 2, 0, "span", 140);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(53, MemberDatabaseComponent_Conditional_154_Conditional_53_Template, 5, 1, "div", 120);
    \u0275\u0275elementStart(54, "div", 120)(55, "h4", 127);
    \u0275\u0275text(56, "\u{1F4CD} \u4F86\u6E90\u7FA4\u7D44");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(57, "div", 141)(58, "div", 142)(59, "span", 143);
    \u0275\u0275text(60);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(61, "span", 144);
    \u0275\u0275text(62);
    \u0275\u0275elementEnd()();
    \u0275\u0275repeaterCreate(63, MemberDatabaseComponent_Conditional_154_For_64_Template, 1, 1, null, null, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(65, "div", 120)(66, "h4", 127);
    \u0275\u0275text(67, "\u{1F3F7}\uFE0F \u6A19\u7C64");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(68, "div", 145);
    \u0275\u0275repeaterCreate(69, MemberDatabaseComponent_Conditional_154_For_70_Template, 4, 1, "span", 146, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275elementStart(71, "button", 147);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_154_Template_button_click_71_listener() {
      \u0275\u0275restoreView(_r12);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.openAddTagDialog());
    });
    \u0275\u0275text(72, "+ \u6DFB\u52A0\u6A19\u7C64");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(73, "div", 120)(74, "h4", 127);
    \u0275\u0275text(75, "\u{1F4DD} \u5099\u8A3B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(76, "textarea", 148);
    \u0275\u0275twoWayListener("ngModelChange", function MemberDatabaseComponent_Conditional_154_Template_textarea_ngModelChange_76_listener($event) {
      \u0275\u0275restoreView(_r12);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.memberNotes, $event) || (ctx_r1.memberNotes = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275listener("blur", function MemberDatabaseComponent_Conditional_154_Template_textarea_blur_76_listener() {
      \u0275\u0275restoreView(_r12);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.saveMemberNotes());
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(77, "div", 120)(78, "h4", 127);
    \u0275\u0275text(79, "\u{1F4CA} \u71DF\u92B7\u72C0\u614B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(80, "div", 149)(81, "div", 150)(82, "span", 151);
    \u0275\u0275text(83, "\u806F\u7E6B\u72C0\u614B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(84, "span", 152);
    \u0275\u0275text(85);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(86, MemberDatabaseComponent_Conditional_154_Conditional_86_Template, 5, 1, "div", 150);
    \u0275\u0275conditionalCreate(87, MemberDatabaseComponent_Conditional_154_Conditional_87_Template, 5, 1, "div", 150);
    \u0275\u0275elementStart(88, "div", 150)(89, "span", 151);
    \u0275\u0275text(90, "\u8F49\u5316\u72C0\u614B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(91, "span", 152);
    \u0275\u0275text(92);
    \u0275\u0275elementEnd()()()()();
    \u0275\u0275elementStart(93, "div", 153)(94, "button", 154);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_154_Template_button_click_94_listener() {
      \u0275\u0275restoreView(_r12);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.sendMessage(ctx_r1.selectedMember()));
    });
    \u0275\u0275text(95, " \u{1F4AC} \u767C\u6D88\u606F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(96, "button", 8);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_154_Template_button_click_96_listener() {
      \u0275\u0275restoreView(_r12);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.addToFunnel(ctx_r1.selectedMember()));
    });
    \u0275\u0275text(97, " \u{1F4E4} \u52A0\u5165\u6F0F\u6597 ");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(98, MemberDatabaseComponent_Conditional_154_Conditional_98_Template, 2, 0, "button", 155);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(10);
    \u0275\u0275classProp("has-photo", ctx_r1.selectedMember().has_photo);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.getAvatarLetter(ctx_r1.selectedMember()), " ");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate2(" ", ctx_r1.selectedMember().first_name, " ", ctx_r1.selectedMember().last_name, " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.selectedMember().is_premium ? 15 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.selectedMember().username ? 16 : -1);
    \u0275\u0275advance();
    \u0275\u0275classMap("status-" + ctx_r1.selectedMember().online_status);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", ctx_r1.getStatusIcon(ctx_r1.selectedMember().online_status), " ", ctx_r1.getStatusText(ctx_r1.selectedMember().online_status), " ");
    \u0275\u0275advance(9);
    \u0275\u0275textInterpolate1(" ", ctx_r1.selectedMember().user_id, " ");
    \u0275\u0275advance(3);
    \u0275\u0275conditional(ctx_r1.selectedMember().phone ? 30 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.selectedMember().language_code ? 31 : -1);
    \u0275\u0275advance(5);
    \u0275\u0275classMap("level-" + ctx_r1.selectedMember().value_level);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.selectedMember().value_level, " \u7D1A ");
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate1("", ctx_r1.selectedMember().activity_score, "/100");
    \u0275\u0275advance(5);
    \u0275\u0275conditional(ctx_r1.selectedMember().is_premium ? 47 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.selectedMember().is_verified ? 48 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.selectedMember().has_photo ? 49 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.isChinese(ctx_r1.selectedMember()) ? 50 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.selectedMember().is_scam ? 51 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.selectedMember().is_deleted ? 52 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.selectedMember().bio ? 53 : -1);
    \u0275\u0275advance(7);
    \u0275\u0275textInterpolate(ctx_r1.selectedMember().source_chat_title);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r1.formatDate(ctx_r1.selectedMember().extracted_at));
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r1.getGroupsList(ctx_r1.selectedMember()));
    \u0275\u0275advance(6);
    \u0275\u0275repeater(ctx_r1.getMemberTags(ctx_r1.selectedMember()));
    \u0275\u0275advance(7);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.memberNotes);
    \u0275\u0275advance(8);
    \u0275\u0275classProp("contacted", ctx_r1.selectedMember().contacted);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.selectedMember().contacted ? "\u2705 \u5DF2\u806F\u7E6B" : "\u{1F4ED} \u672A\u806F\u7E6B", " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.selectedMember().contacted_at ? 86 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.selectedMember().response_status ? 87 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275classProp("converted", ctx_r1.selectedMember().converted);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.selectedMember().converted ? "\u2705 \u5DF2\u8F49\u5316" : "\u23F3 \u5F85\u8F49\u5316", " ");
    \u0275\u0275advance(6);
    \u0275\u0275conditional(!ctx_r1.selectedMember().contacted ? 98 : -1);
  }
}
function MemberDatabaseComponent_Conditional_155_For_14_Template(rf, ctx) {
  if (rf & 1) {
    const _r18 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 168);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_155_For_14_Template_button_click_0_listener() {
      const tag_r19 = \u0275\u0275restoreView(_r18).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.addSuggestedTag(tag_r19));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const tag_r19 = ctx.$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(tag_r19);
  }
}
function MemberDatabaseComponent_Conditional_155_Template(rf, ctx) {
  if (rf & 1) {
    const _r17 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 158);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_155_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r17);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.closeAddTagDialog());
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(1, "div", 159)(2, "div", 160)(3, "h3");
    \u0275\u0275text(4, "\u6DFB\u52A0\u6A19\u7C64");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "button", 118);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_155_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r17);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.closeAddTagDialog());
    });
    \u0275\u0275text(6, "\u2715");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(7, "div", 161)(8, "input", 162);
    \u0275\u0275twoWayListener("ngModelChange", function MemberDatabaseComponent_Conditional_155_Template_input_ngModelChange_8_listener($event) {
      \u0275\u0275restoreView(_r17);
      const ctx_r1 = \u0275\u0275nextContext();
      \u0275\u0275twoWayBindingSet(ctx_r1.newTagName, $event) || (ctx_r1.newTagName = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275listener("keyup.enter", function MemberDatabaseComponent_Conditional_155_Template_input_keyup_enter_8_listener() {
      \u0275\u0275restoreView(_r17);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.addTag());
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "div", 163)(10, "p", 164);
    \u0275\u0275text(11, "\u5E38\u7528\u6A19\u7C64\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "div", 165);
    \u0275\u0275repeaterCreate(13, MemberDatabaseComponent_Conditional_155_For_14_Template, 2, 1, "button", 166, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(15, "div", 167)(16, "button", 8);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_155_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r17);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.closeAddTagDialog());
    });
    \u0275\u0275text(17, "\u53D6\u6D88");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "button", 11);
    \u0275\u0275listener("click", function MemberDatabaseComponent_Conditional_155_Template_button_click_18_listener() {
      \u0275\u0275restoreView(_r17);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.addTag());
    });
    \u0275\u0275text(19, "\u6DFB\u52A0");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(8);
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.newTagName);
    \u0275\u0275advance(5);
    \u0275\u0275repeater(ctx_r1.suggestedTags);
    \u0275\u0275advance(5);
    \u0275\u0275property("disabled", !ctx_r1.newTagName);
  }
}
var MemberDatabaseComponent = class _MemberDatabaseComponent {
  constructor() {
    this.ipcService = inject(ElectronIpcService);
    this.toastService = inject(ToastService);
    this.sendMessageEvent = output();
    this.addToFunnelEvent = output();
    this.batchSendMessageEvent = output();
    this.members = signal([], ...ngDevMode ? [{ debugName: "members" }] : []);
    this.filteredMembers = signal([], ...ngDevMode ? [{ debugName: "filteredMembers" }] : []);
    this.isLoading = signal(false, ...ngDevMode ? [{ debugName: "isLoading" }] : []);
    this.stats = signal({
      total: 0,
      online: 0,
      recently: 0,
      premium: 0,
      chinese: 0,
      contacted: 0,
      converted: 0,
      todayNew: 0,
      byValueLevel: {},
      bySource: []
    }, ...ngDevMode ? [{ debugName: "stats" }] : []);
    this.sourceGroups = signal([], ...ngDevMode ? [{ debugName: "sourceGroups" }] : []);
    this.searchQuery = "";
    this.selectedSource = "";
    this.selectedOnlineStatus = "";
    this.selectedValueLevel = "";
    this.filterPremium = false;
    this.filterChinese = false;
    this.filterHasUsername = false;
    this.filterNotContacted = false;
    this.filterHasPhoto = false;
    this.sortField = "extracted_at";
    this.sortDirection = "desc";
    this.currentPage = 1;
    this.pageSize = 50;
    this.selectedMemberIds = signal([], ...ngDevMode ? [{ debugName: "selectedMemberIds" }] : []);
    this.selectedMember = signal(null, ...ngDevMode ? [{ debugName: "selectedMember" }] : []);
    this.memberNotes = "";
    this.showAddTagDialog = signal(false, ...ngDevMode ? [{ debugName: "showAddTagDialog" }] : []);
    this.newTagName = "";
    this.suggestedTags = ["\u9AD8\u610F\u5411", "\u5E63\u5708", "DeFi", "NFT", "\u6295\u8CC7", "\u4EA4\u6613", "\u91CF\u5316", "\u7926\u5DE5", "\u958B\u767C\u8005", "\u904B\u71DF"];
    this.showAdvancedMenu = signal(false, ...ngDevMode ? [{ debugName: "showAdvancedMenu" }] : []);
    this.loadTimeout = null;
    this.paginatedMembers = computed(() => {
      const start = (this.currentPage - 1) * this.pageSize;
      const end = start + this.pageSize;
      return this.filteredMembers().slice(start, end);
    }, ...ngDevMode ? [{ debugName: "paginatedMembers" }] : []);
    this.totalPages = computed(() => Math.ceil(this.filteredMembers().length / this.pageSize) || 1, ...ngDevMode ? [{ debugName: "totalPages" }] : []);
  }
  ngOnInit() {
    this.loadMembers();
    this.setupEventListeners();
  }
  ngOnDestroy() {
  }
  setupEventListeners() {
    this.ipcService.on("extracted-members-list", (data) => {
      console.log("[MemberDatabase] Received extracted-members-list event:", data);
      if (this.loadTimeout) {
        clearTimeout(this.loadTimeout);
        this.loadTimeout = null;
      }
      if (data.success) {
        console.log(`[MemberDatabase] Loaded ${data.members?.length || 0} members`);
        this.members.set(data.members || []);
        this.applyFilters();
        this.calculateStats();
        this.isLoading.set(false);
      } else {
        console.error("[MemberDatabase] Load failed:", data.error);
        this.toastService.error(`\u8F09\u5165\u5931\u6557: ${data.error}`);
        this.isLoading.set(false);
      }
    });
    this.ipcService.on("member-stats", (data) => {
      if (data.success) {
        this.stats.update((s) => __spreadValues(__spreadValues({}, s), data));
      }
    });
  }
  loadMembers() {
    console.log("[MemberDatabase] loadMembers called");
    this.isLoading.set(true);
    if (this.loadTimeout) {
      clearTimeout(this.loadTimeout);
    }
    this.loadTimeout = setTimeout(() => {
      if (this.isLoading()) {
        console.warn("[MemberDatabase] Load timeout after 15 seconds");
        this.isLoading.set(false);
        this.toastService.error("\u8F09\u5165\u8D85\u6642\uFF0C\u8ACB\u91CD\u8A66");
      }
    }, 15e3);
    console.log("[MemberDatabase] Sending get-extracted-members request");
    this.ipcService.send("get-extracted-members", {
      limit: 500,
      offset: 0
    });
  }
  refreshMembers() {
    this.loadMembers();
    this.toastService.info("\u6B63\u5728\u5237\u65B0\u6578\u64DA...");
  }
  // 篩選相關
  onSearchChange(query) {
    this.searchQuery = query;
    this.applyFilters();
  }
  clearSearch() {
    this.searchQuery = "";
    this.applyFilters();
  }
  applyFilters() {
    let result = [...this.members()];
    if (this.searchQuery) {
      const q = this.searchQuery.toLowerCase();
      result = result.filter((m) => m.user_id.includes(q) || m.username?.toLowerCase().includes(q) || m.first_name?.toLowerCase().includes(q) || m.last_name?.toLowerCase().includes(q));
    }
    if (this.selectedSource) {
      result = result.filter((m) => m.source_chat_id === this.selectedSource);
    }
    if (this.selectedOnlineStatus) {
      result = result.filter((m) => m.online_status === this.selectedOnlineStatus);
    }
    if (this.selectedValueLevel) {
      result = result.filter((m) => m.value_level === this.selectedValueLevel);
    }
    if (this.filterPremium) {
      result = result.filter((m) => m.is_premium);
    }
    if (this.filterChinese) {
      result = result.filter((m) => this.isChinese(m));
    }
    if (this.filterHasUsername) {
      result = result.filter((m) => m.username);
    }
    if (this.filterNotContacted) {
      result = result.filter((m) => !m.contacted);
    }
    if (this.filterHasPhoto) {
      result = result.filter((m) => m.has_photo);
    }
    result.sort((a, b) => {
      let aVal = a[this.sortField];
      let bVal = b[this.sortField];
      if (typeof aVal === "string")
        aVal = aVal.toLowerCase();
      if (typeof bVal === "string")
        bVal = bVal.toLowerCase();
      if (aVal < bVal)
        return this.sortDirection === "asc" ? -1 : 1;
      if (aVal > bVal)
        return this.sortDirection === "asc" ? 1 : -1;
      return 0;
    });
    this.filteredMembers.set(result);
    this.currentPage = 1;
  }
  hasActiveFilters() {
    return !!(this.searchQuery || this.selectedSource || this.selectedOnlineStatus || this.selectedValueLevel || this.filterPremium || this.filterChinese || this.filterHasUsername || this.filterNotContacted || this.filterHasPhoto);
  }
  clearFilters() {
    this.searchQuery = "";
    this.selectedSource = "";
    this.selectedOnlineStatus = "";
    this.selectedValueLevel = "";
    this.filterPremium = false;
    this.filterChinese = false;
    this.filterHasUsername = false;
    this.filterNotContacted = false;
    this.filterHasPhoto = false;
    this.applyFilters();
  }
  sortBy(field) {
    if (this.sortField === field) {
      this.sortDirection = this.sortDirection === "asc" ? "desc" : "asc";
    } else {
      this.sortField = field;
      this.sortDirection = "asc";
    }
    this.applyFilters();
  }
  getPageStart() {
    return (this.currentPage - 1) * this.pageSize + 1;
  }
  getPageEnd() {
    return Math.min(this.currentPage * this.pageSize, this.filteredMembers().length);
  }
  goToPage(page) {
    if (page >= 1 && page <= this.totalPages()) {
      this.currentPage = page;
    }
  }
  onPageSizeChange() {
    this.currentPage = 1;
  }
  // 選擇相關
  isAllSelected() {
    return this.paginatedMembers().length > 0 && this.paginatedMembers().every((m) => this.selectedMemberIds().includes(m.user_id));
  }
  isPartialSelected() {
    const selected = this.paginatedMembers().filter((m) => this.selectedMemberIds().includes(m.user_id));
    return selected.length > 0 && selected.length < this.paginatedMembers().length;
  }
  toggleSelectAll() {
    if (this.isAllSelected()) {
      const currentIds = this.paginatedMembers().map((m) => m.user_id);
      this.selectedMemberIds.update((ids) => ids.filter((id) => !currentIds.includes(id)));
    } else {
      const currentIds = this.paginatedMembers().map((m) => m.user_id);
      this.selectedMemberIds.update((ids) => [.../* @__PURE__ */ new Set([...ids, ...currentIds])]);
    }
  }
  isMemberSelected(userId) {
    return this.selectedMemberIds().includes(userId);
  }
  toggleMemberSelection(userId) {
    this.selectedMemberIds.update((ids) => {
      if (ids.includes(userId)) {
        return ids.filter((id) => id !== userId);
      } else {
        return [...ids, userId];
      }
    });
  }
  clearSelection() {
    this.selectedMemberIds.set([]);
  }
  // 統計相關
  calculateStats() {
    const members = this.members();
    const today = (/* @__PURE__ */ new Date()).toDateString();
    const stats = {
      total: members.length,
      online: members.filter((m) => m.online_status === "online").length,
      recently: members.filter((m) => m.online_status === "recently").length,
      premium: members.filter((m) => m.is_premium).length,
      chinese: members.filter((m) => this.isChinese(m)).length,
      contacted: members.filter((m) => m.contacted).length,
      converted: members.filter((m) => m.converted).length,
      todayNew: members.filter((m) => new Date(m.created_at).toDateString() === today).length,
      byValueLevel: {},
      bySource: []
    };
    const sourceMap = /* @__PURE__ */ new Map();
    members.forEach((m) => {
      if (m.source_chat_id) {
        const existing = sourceMap.get(m.source_chat_id);
        if (existing) {
          existing.count++;
        } else {
          sourceMap.set(m.source_chat_id, { title: m.source_chat_title || m.source_chat_id, count: 1 });
        }
      }
    });
    this.sourceGroups.set(Array.from(sourceMap.entries()).map(([group, data]) => ({
      group,
      title: data.title,
      count: data.count
    })).sort((a, b) => b.count - a.count));
    this.stats.set(stats);
  }
  getOnlinePercent() {
    const total = this.stats().total;
    return total > 0 ? (this.stats().online / total * 100).toFixed(1) : "0";
  }
  getPremiumPercent() {
    const total = this.stats().total;
    return total > 0 ? (this.stats().premium / total * 100).toFixed(1) : "0";
  }
  getChinesePercent() {
    const total = this.stats().total;
    return total > 0 ? (this.stats().chinese / total * 100).toFixed(1) : "0";
  }
  getContactedPercent() {
    const total = this.stats().total;
    return total > 0 ? (this.stats().contacted / total * 100).toFixed(1) : "0";
  }
  getConvertedPercent() {
    const contacted = this.stats().contacted;
    return contacted > 0 ? (this.stats().converted / contacted * 100).toFixed(1) : "0";
  }
  // 工具方法
  getAvatarLetter(member) {
    return (member.first_name || member.username || "?").charAt(0).toUpperCase();
  }
  getStatusIcon(status) {
    switch (status) {
      case "online":
        return "\u{1F7E2}";
      case "recently":
        return "\u{1F7E1}";
      case "last_week":
        return "\u{1F7E0}";
      case "last_month":
        return "\u26AA";
      default:
        return "\u26AA";
    }
  }
  getStatusText(status) {
    switch (status) {
      case "online":
        return "\u5728\u7DDA";
      case "recently":
        return "\u6700\u8FD1";
      case "last_week":
        return "\u672C\u9031";
      case "last_month":
        return "\u672C\u6708";
      case "long_ago":
        return "\u96E2\u7DDA";
      default:
        return "\u672A\u77E5";
    }
  }
  isChinese(member) {
    const name = (member.first_name || "") + (member.last_name || "");
    const bio = member.bio || "";
    const chineseRegex = /[\u4e00-\u9fff]/;
    return chineseRegex.test(name) || chineseRegex.test(bio);
  }
  getMemberTags(member) {
    if (!member.tags)
      return [];
    try {
      return JSON.parse(member.tags);
    } catch {
      return [];
    }
  }
  getGroupsList(member) {
    if (!member.groups)
      return [];
    try {
      return JSON.parse(member.groups);
    } catch {
      return [];
    }
  }
  formatDate(dateStr) {
    if (!dateStr)
      return "-";
    try {
      const date = new Date(dateStr);
      return date.toLocaleDateString("zh-TW", {
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit"
      });
    } catch {
      return dateStr;
    }
  }
  copyToClipboard(text) {
    navigator.clipboard.writeText(text);
    this.toastService.success("\u5DF2\u8907\u88FD\u5230\u526A\u8CBC\u677F");
  }
  // 詳情側邊欄
  openMemberDetail(member) {
    this.selectedMember.set(member);
    this.memberNotes = member.notes || "";
  }
  closeMemberDetail() {
    this.selectedMember.set(null);
    this.memberNotes = "";
  }
  saveMemberNotes() {
    const member = this.selectedMember();
    if (!member)
      return;
    this.ipcService.send("update-member", {
      userId: member.user_id,
      updates: { notes: this.memberNotes }
    });
    this.members.update((list) => list.map((m) => m.user_id === member.user_id ? __spreadProps(__spreadValues({}, m), { notes: this.memberNotes }) : m));
  }
  // 標籤管理
  openAddTagDialog() {
    this.showAddTagDialog.set(true);
    this.newTagName = "";
  }
  closeAddTagDialog() {
    this.showAddTagDialog.set(false);
    this.newTagName = "";
  }
  addTag() {
    if (!this.newTagName.trim())
      return;
    const member = this.selectedMember();
    if (!member)
      return;
    const tags = this.getMemberTags(member);
    if (!tags.includes(this.newTagName)) {
      tags.push(this.newTagName);
      this.ipcService.send("update-member", {
        userId: member.user_id,
        updates: { tags: JSON.stringify(tags) }
      });
      this.members.update((list) => list.map((m) => m.user_id === member.user_id ? __spreadProps(__spreadValues({}, m), { tags: JSON.stringify(tags) }) : m));
      this.selectedMember.update((m) => m ? __spreadProps(__spreadValues({}, m), { tags: JSON.stringify(tags) }) : null);
    }
    this.closeAddTagDialog();
  }
  addSuggestedTag(tag) {
    this.newTagName = tag;
    this.addTag();
  }
  removeTag(member, tag) {
    const tags = this.getMemberTags(member).filter((t) => t !== tag);
    this.ipcService.send("update-member", {
      userId: member.user_id,
      updates: { tags: JSON.stringify(tags) }
    });
    this.members.update((list) => list.map((m) => m.user_id === member.user_id ? __spreadProps(__spreadValues({}, m), { tags: JSON.stringify(tags) }) : m));
    this.selectedMember.update((m) => m ? __spreadProps(__spreadValues({}, m), { tags: JSON.stringify(tags) }) : null);
  }
  // 操作方法
  sendMessage(member) {
    this.sendMessageEvent.emit(member);
  }
  addToFunnel(member) {
    this.addToFunnelEvent.emit(member);
  }
  markAsContacted(member) {
    this.ipcService.send("update-member", {
      userId: member.user_id,
      updates: {
        contacted: true,
        contacted_at: (/* @__PURE__ */ new Date()).toISOString()
      }
    });
    this.members.update((list) => list.map((m) => m.user_id === member.user_id ? __spreadProps(__spreadValues({}, m), { contacted: true, contacted_at: (/* @__PURE__ */ new Date()).toISOString() }) : m));
    this.selectedMember.update((m) => m ? __spreadProps(__spreadValues({}, m), { contacted: true, contacted_at: (/* @__PURE__ */ new Date()).toISOString() }) : null);
    this.calculateStats();
    this.toastService.success("\u5DF2\u6A19\u8A18\u70BA\u5DF2\u806F\u7E6B");
  }
  // 批量操作
  batchSendMessage() {
    const selectedMembers = this.members().filter((m) => this.selectedMemberIds().includes(m.user_id));
    if (selectedMembers.length > 0) {
      this.batchSendMessageEvent.emit(selectedMembers);
    }
  }
  batchAddTags() {
    this.toastService.info("\u6279\u91CF\u6DFB\u52A0\u6A19\u7C64\u529F\u80FD\u958B\u767C\u4E2D...");
  }
  batchMarkContacted() {
    const ids = this.selectedMemberIds();
    const now = (/* @__PURE__ */ new Date()).toISOString();
    ids.forEach((userId) => {
      this.ipcService.send("update-member", {
        userId,
        updates: { contacted: true, contacted_at: now }
      });
    });
    this.members.update((list) => list.map((m) => ids.includes(m.user_id) ? __spreadProps(__spreadValues({}, m), { contacted: true, contacted_at: now }) : m));
    this.calculateStats();
    this.applyFilters();
    this.clearSelection();
    this.toastService.success(`\u5DF2\u5C07 ${ids.length} \u500B\u6210\u54E1\u6A19\u8A18\u70BA\u5DF2\u806F\u7E6B`);
  }
  batchExport() {
    const ids = this.selectedMemberIds();
    const members = this.members().filter((m) => ids.includes(m.user_id));
    this.exportMembersToCSV(members);
  }
  // 導出
  exportMembers() {
    this.exportMembersToCSV(this.filteredMembers());
  }
  exportMembersToCSV(members) {
    const headers = [
      "Telegram ID",
      "\u7528\u6236\u540D",
      "\u59D3",
      "\u540D",
      "\u96FB\u8A71",
      "\u7C21\u4ECB",
      "\u8A9E\u8A00",
      "Premium",
      "\u5DF2\u9A57\u8B49",
      "\u6709\u982D\u50CF",
      "\u5728\u7DDA\u72C0\u614B",
      "\u6700\u5F8C\u5728\u7DDA",
      "\u6D3B\u8E8D\u5206\u6578",
      "\u50F9\u503C\u7B49\u7D1A",
      "\u4F86\u6E90\u7FA4\u7D44",
      "\u4F86\u6E90\u7FA4\u7D44ID",
      "\u63D0\u53D6\u6642\u9593",
      "\u6A19\u7C64",
      "\u5099\u8A3B",
      "\u5DF2\u806F\u7E6B",
      "\u806F\u7E6B\u6642\u9593",
      "\u5DF2\u8F49\u5316"
    ];
    const rows = members.map((m) => [
      m.user_id,
      m.username || "",
      m.last_name || "",
      m.first_name || "",
      m.phone || "",
      m.bio || "",
      m.language_code || "",
      m.is_premium ? "\u662F" : "\u5426",
      m.is_verified ? "\u662F" : "\u5426",
      m.has_photo ? "\u662F" : "\u5426",
      this.getStatusText(m.online_status),
      m.last_online || "",
      m.activity_score?.toString() || "",
      m.value_level || "",
      m.source_chat_title || "",
      m.source_chat_id || "",
      m.extracted_at || "",
      this.getMemberTags(m).join("; "),
      m.notes || "",
      m.contacted ? "\u662F" : "\u5426",
      m.contacted_at || "",
      m.converted ? "\u662F" : "\u5426"
    ]);
    const escapeCSV = (str) => {
      if (str.includes(",") || str.includes('"') || str.includes("\n")) {
        return `"${str.replace(/"/g, '""')}"`;
      }
      return str;
    };
    const csv = [headers, ...rows].map((row) => row.map(escapeCSV).join(",")).join("\n");
    const blob = new Blob(["\uFEFF" + csv], { type: "text/csv;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `members_${(/* @__PURE__ */ new Date()).toISOString().slice(0, 10)}.csv`;
    a.click();
    URL.revokeObjectURL(url);
    this.toastService.success(`\u2705 \u5DF2\u5C0E\u51FA ${members.length} \u500B\u6210\u54E1`);
  }
  // ==================== P4 高級功能 ====================
  /**
   * 智能去重 - 跨群組合併重複成員
   */
  deduplicateMembers() {
    this.toastService.info("\u{1F504} \u6B63\u5728\u57F7\u884C\u667A\u80FD\u53BB\u91CD...");
    this.ipcService.send("deduplicate-members", {});
    const cleanup = this.ipcService.on("members-deduplicated", (data) => {
      cleanup();
      if (data.success) {
        this.toastService.success(`\u2705 \u53BB\u91CD\u5B8C\u6210\uFF01\u5408\u4F75\u4E86 ${data.mergedCount || 0} \u500B\u91CD\u8907\u6210\u54E1`);
        this.loadMembers();
      } else {
        this.toastService.error(`\u53BB\u91CD\u5931\u6557: ${data.error}`);
      }
    });
  }
  /**
   * 重新計算評分 - 更新所有成員的價值等級
   */
  recalculateScores() {
    this.toastService.info("\u{1F4CA} \u6B63\u5728\u91CD\u65B0\u8A08\u7B97\u8A55\u5206...");
    this.ipcService.send("recalculate-scores", {});
    const cleanup = this.ipcService.on("scores-recalculated", (data) => {
      cleanup();
      if (data.success) {
        this.toastService.success(`\u2705 \u8A55\u5206\u8A08\u7B97\u5B8C\u6210\uFF01\u66F4\u65B0\u4E86 ${data.updatedCount || 0} \u500B\u6210\u54E1`);
        this.loadMembers();
      } else {
        this.toastService.error(`\u8A08\u7B97\u5931\u6557: ${data.error}`);
      }
    });
  }
  /**
   * 顯示群組畫像 - 分析當前選中群組的質量
   */
  showGroupProfile() {
    if (!this.selectedSource) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u4E00\u500B\u4F86\u6E90\u7FA4\u7D44");
      return;
    }
    this.toastService.info("\u{1F4C8} \u6B63\u5728\u751F\u6210\u7FA4\u7D44\u756B\u50CF...");
    this.ipcService.send("get-group-profile", { chatId: this.selectedSource });
    const cleanup = this.ipcService.on("group-profile-result", (data) => {
      cleanup();
      if (data.success && data.profile) {
        const p = data.profile;
        this.toastService.success(`
          \u{1F4CA} \u7FA4\u7D44\u756B\u50CF\uFF1A
          \u8CEA\u91CF\u5206\u6578: ${p.qualityScore}/100
          \u7E3D\u6210\u54E1: ${p.totalMembers}
          Premium: ${p.premiumRate}%
          \u6D3B\u8E8D\u7387: ${p.activeRate}%
        `.trim());
      } else {
        this.toastService.error(`\u7372\u53D6\u756B\u50CF\u5931\u6557: ${data.error}`);
      }
    });
  }
  /**
   * 群組對比 - 比較多個群組的成員質量
   */
  compareGroups() {
    const sources = this.sourceGroups();
    if (sources.length < 2) {
      this.toastService.warning("\u9700\u8981\u81F3\u5C112\u500B\u7FA4\u7D44\u624D\u80FD\u9032\u884C\u5C0D\u6BD4");
      return;
    }
    const chatIds = sources.slice(0, 5).map((s) => s.group);
    this.toastService.info("\u{1F4CA} \u6B63\u5728\u5C0D\u6BD4\u7FA4\u7D44...");
    this.ipcService.send("compare-groups", { chatIds });
    const cleanup = this.ipcService.on("groups-compared", (data) => {
      cleanup();
      if (data.success && data.comparison) {
        const c = data.comparison;
        this.toastService.success(`
          \u{1F4CA} \u7FA4\u7D44\u5C0D\u6BD4\u5B8C\u6210\uFF01
          \u6700\u9AD8\u8CEA\u91CF: ${c.bestGroup?.name || "\u672A\u77E5"}
          \u5E73\u5747\u8CEA\u91CF: ${c.avgQuality}/100
          \u5C0D\u6BD4\u7FA4\u7D44\u6578: ${c.groupCount}
        `.trim());
      } else {
        this.toastService.error(`\u5C0D\u6BD4\u5931\u6557: ${data.error}`);
      }
    });
  }
  /**
   * 查看提取統計 - 顯示提取成功率和效能
   */
  viewExtractionStats() {
    this.toastService.info("\u{1F4C9} \u6B63\u5728\u7372\u53D6\u63D0\u53D6\u7D71\u8A08...");
    this.ipcService.send("get-extraction-stats", {});
    const cleanup = this.ipcService.on("extraction-stats-result", (data) => {
      cleanup();
      if (data.success && data.stats) {
        const s = data.stats;
        this.toastService.success(`
          \u{1F4C9} \u63D0\u53D6\u7D71\u8A08\uFF1A
          \u6210\u529F\u7387: ${s.successRate}%
          \u7E3D\u63D0\u53D6: ${s.totalExtractions}
          \u6210\u529F: ${s.successCount}
          \u5931\u6557: ${s.failedCount}
        `.trim());
      } else {
        this.toastService.error(`\u7372\u53D6\u7D71\u8A08\u5931\u6557: ${data.error}`);
      }
    });
  }
  static {
    this.\u0275fac = function MemberDatabaseComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _MemberDatabaseComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _MemberDatabaseComponent, selectors: [["app-member-database"]], outputs: { sendMessageEvent: "sendMessageEvent", addToFunnelEvent: "addToFunnelEvent", batchSendMessageEvent: "batchSendMessageEvent" }, decls: 156, vars: 47, consts: [[1, "member-database-container"], [1, "page-header"], [1, "header-left"], [1, "page-title"], [1, "title-icon"], [1, "page-desc"], [1, "header-actions"], [1, "relative", "inline-block", 2, "position", "relative"], [1, "btn-secondary", 3, "click"], [1, "absolute", "right-0", "mt-2", "w-56", "bg-slate-800", "rounded-xl", "shadow-xl", "border", "border-slate-700", "py-2", "z-50", 2, "position", "absolute", "right", "0", "margin-top", "8px", "width", "240px"], [1, "btn-secondary", 3, "click", "disabled"], [1, "btn-primary", 3, "click", "disabled"], [1, "stats-grid"], [1, "stat-card"], [1, "stat-icon"], [1, "stat-content"], [1, "stat-value"], [1, "stat-label"], [1, "stat-badge", "success"], [1, "stat-card", "online"], [1, "stat-percent"], [1, "stat-card", "premium"], [1, "stat-card", "chinese"], [1, "stat-card", "contacted"], [1, "stat-card", "converted"], [1, "filter-section"], [1, "filter-row"], [1, "search-box"], [1, "search-icon"], ["type", "text", "placeholder", "\u641C\u7D22\u59D3\u540D\u3001\u7528\u6236\u540D\u3001ID...", 1, "search-input", 3, "ngModelChange", "ngModel"], [1, "search-clear"], [1, "filter-select", 3, "ngModelChange", "ngModel"], ["value", ""], [3, "value"], ["value", "online"], ["value", "recently"], ["value", "last_week"], ["value", "long_ago"], ["value", "S"], ["value", "A"], ["value", "B"], ["value", "C"], ["value", "D"], [1, "filter-checkbox"], ["type", "checkbox", 3, "ngModelChange", "ngModel"], [1, "btn-text"], [1, "filter-result"], [1, "member-list-section"], [1, "loading-state"], [1, "empty-state"], [1, "w-full", "px-4", "py-2", "text-left", "hover:bg-slate-700", "flex", "items-center", "gap-2", 2, "display", "flex", "align-items", "center", "padding", "8px 16px", 3, "click"], [1, "ml-auto", "text-xs", "text-slate-400", 2, "margin-left", "auto", "font-size", "11px", "color", "#94a3b8"], [1, "border-t", "border-slate-700", "my-1", 2, "border-top", "1px solid #334155", "margin", "4px 0"], [1, "search-clear", 3, "click"], [1, "btn-text", 3, "click"], [1, "loading-spinner"], [1, "empty-icon"], [1, "batch-action-bar"], [1, "member-table-container"], [1, "member-table"], [1, "col-checkbox"], ["type", "checkbox", 3, "change", "checked", "indeterminate"], [1, "col-id", 3, "click"], [1, "col-user", 3, "click"], [1, "col-username"], [1, "col-status", 3, "click"], [1, "col-level", 3, "click"], [1, "col-source"], [1, "col-tags"], [1, "col-contacted"], [1, "col-actions"], [3, "selected"], [1, "pagination"], [1, "page-info"], [1, "page-controls"], [1, "page-btn", 3, "click", "disabled"], [1, "page-number"], [1, "page-size-select", 3, "ngModelChange", "ngModel"], [1, "selected-count"], [1, "batch-actions"], [1, "btn-batch", 3, "click"], [1, "btn-batch", "danger", 3, "click"], [3, "click"], [1, "col-checkbox", 3, "click"], ["type", "checkbox", 3, "change", "checked"], [1, "col-id"], [1, "user-id", 3, "title"], [1, "col-user"], [1, "user-info"], [1, "user-avatar"], [1, "user-name-wrapper"], [1, "user-name"], ["title", "Premium", 1, "premium-badge"], ["title", "\u5DF2\u9A57\u8B49", 1, "verified-badge"], ["title", "\u83EF\u4EBA", 1, "chinese-badge"], [1, "user-bio", 3, "title"], ["target", "_blank", 1, "username-link", 3, "href"], [1, "no-username"], [1, "col-status"], [1, "status-badge"], [1, "col-level"], [1, "level-badge"], [1, "source-name", 3, "title"], [1, "tags-container"], [1, "no-tags"], [1, "contacted-badge", "yes"], [1, "contacted-badge", "no"], [1, "col-actions", 3, "click"], [1, "action-buttons"], ["title", "\u767C\u6D88\u606F", 1, "action-btn", 3, "click"], ["title", "\u52A0\u5165\u6F0F\u6597", 1, "action-btn", 3, "click"], ["title", "\u67E5\u770B\u8A73\u60C5", 1, "action-btn", 3, "click"], ["target", "_blank", 1, "username-link", 3, "click", "href"], [1, "tag"], [1, "tag-more"], [1, "member-detail-overlay", 3, "click"], [1, "member-detail-drawer"], [1, "drawer-header"], [1, "close-btn", 3, "click"], [1, "drawer-content"], [1, "detail-section"], [1, "member-profile"], [1, "profile-avatar"], [1, "profile-info"], [1, "profile-name"], [1, "premium-badge"], ["target", "_blank", 1, "profile-username", 3, "href"], [1, "section-title"], [1, "detail-grid"], [1, "detail-item"], [1, "detail-label"], [1, "detail-value", "copyable", 3, "click"], [1, "copy-icon"], [1, "detail-value"], [1, "status-tags"], [1, "status-tag", "premium"], [1, "status-tag", "verified"], [1, "status-tag", "photo"], [1, "status-tag", "chinese"], [1, "status-tag", "danger"], [1, "status-tag", "deleted"], [1, "source-list"], [1, "source-item"], [1, "source-name"], [1, "source-date"], [1, "tags-edit"], [1, "tag", "editable"], [1, "add-tag-btn", 3, "click"], ["placeholder", "\u6DFB\u52A0\u8DDF\u9032\u5099\u8A3B...", 1, "notes-textarea", 3, "ngModelChange", "blur", "ngModel"], [1, "marketing-status"], [1, "status-item"], [1, "status-label"], [1, "status-value"], [1, "drawer-footer"], [1, "btn-primary", 3, "click"], [1, "btn-secondary"], [1, "bio-text"], [1, "tag-remove", 3, "click"], [1, "dialog-overlay", 3, "click"], [1, "dialog"], [1, "dialog-header"], [1, "dialog-content"], ["type", "text", "placeholder", "\u8F38\u5165\u6A19\u7C64\u540D\u7A31...", 1, "tag-input", 3, "ngModelChange", "keyup.enter", "ngModel"], [1, "suggested-tags"], [1, "suggested-title"], [1, "suggested-list"], [1, "suggested-tag"], [1, "dialog-footer"], [1, "suggested-tag", 3, "click"]], template: function MemberDatabaseComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0)(1, "div", 1)(2, "div", 2)(3, "h1", 3)(4, "span", 4);
        \u0275\u0275text(5, "\u{1F4C1}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(6, " \u6210\u54E1\u8CC7\u6599\u5EAB ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(7, "p", 5);
        \u0275\u0275text(8, "\u7BA1\u7406\u548C\u5206\u6790\u63D0\u53D6\u7684 Telegram \u6210\u54E1\u6578\u64DA");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(9, "div", 6)(10, "div", 7)(11, "button", 8);
        \u0275\u0275listener("click", function MemberDatabaseComponent_Template_button_click_11_listener() {
          return ctx.showAdvancedMenu.set(!ctx.showAdvancedMenu());
        });
        \u0275\u0275text(12, " \u{1F6E0}\uFE0F \u9AD8\u7D1A\u5DE5\u5177 \u25BE ");
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(13, MemberDatabaseComponent_Conditional_13_Template, 23, 0, "div", 9);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(14, "button", 10);
        \u0275\u0275listener("click", function MemberDatabaseComponent_Template_button_click_14_listener() {
          return ctx.refreshMembers();
        });
        \u0275\u0275elementStart(15, "span");
        \u0275\u0275text(16, "\u{1F504}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(17);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(18, "button", 11);
        \u0275\u0275listener("click", function MemberDatabaseComponent_Template_button_click_18_listener() {
          return ctx.exportMembers();
        });
        \u0275\u0275text(19, " \u{1F4E5} \u5C0E\u51FA CSV ");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(20, "div", 12)(21, "div", 13)(22, "div", 14);
        \u0275\u0275text(23, "\u{1F465}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(24, "div", 15)(25, "div", 16);
        \u0275\u0275text(26);
        \u0275\u0275pipe(27, "number");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(28, "div", 17);
        \u0275\u0275text(29, "\u7E3D\u6210\u54E1\u6578");
        \u0275\u0275elementEnd()();
        \u0275\u0275conditionalCreate(30, MemberDatabaseComponent_Conditional_30_Template, 2, 1, "div", 18);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(31, "div", 19)(32, "div", 14);
        \u0275\u0275text(33, "\u{1F7E2}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(34, "div", 15)(35, "div", 16);
        \u0275\u0275text(36);
        \u0275\u0275pipe(37, "number");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(38, "div", 17);
        \u0275\u0275text(39, "\u5728\u7DDA\u6210\u54E1");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(40, "div", 20);
        \u0275\u0275text(41);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(42, "div", 21)(43, "div", 14);
        \u0275\u0275text(44, "\u2B50");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(45, "div", 15)(46, "div", 16);
        \u0275\u0275text(47);
        \u0275\u0275pipe(48, "number");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(49, "div", 17);
        \u0275\u0275text(50, "Premium \u7528\u6236");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(51, "div", 20);
        \u0275\u0275text(52);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(53, "div", 22)(54, "div", 14);
        \u0275\u0275text(55, "\u{1F1E8}\u{1F1F3}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(56, "div", 15)(57, "div", 16);
        \u0275\u0275text(58);
        \u0275\u0275pipe(59, "number");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(60, "div", 17);
        \u0275\u0275text(61, "\u83EF\u4EBA\u6210\u54E1");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(62, "div", 20);
        \u0275\u0275text(63);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(64, "div", 23)(65, "div", 14);
        \u0275\u0275text(66, "\u{1F4AC}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(67, "div", 15)(68, "div", 16);
        \u0275\u0275text(69);
        \u0275\u0275pipe(70, "number");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(71, "div", 17);
        \u0275\u0275text(72, "\u5DF2\u806F\u7E6B");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(73, "div", 20);
        \u0275\u0275text(74);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(75, "div", 24)(76, "div", 14);
        \u0275\u0275text(77, "\u2705");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(78, "div", 15)(79, "div", 16);
        \u0275\u0275text(80);
        \u0275\u0275pipe(81, "number");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(82, "div", 17);
        \u0275\u0275text(83, "\u5DF2\u8F49\u5316");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(84, "div", 20);
        \u0275\u0275text(85);
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(86, "div", 25)(87, "div", 26)(88, "div", 27)(89, "span", 28);
        \u0275\u0275text(90, "\u{1F50D}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(91, "input", 29);
        \u0275\u0275twoWayListener("ngModelChange", function MemberDatabaseComponent_Template_input_ngModelChange_91_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.searchQuery, $event) || (ctx.searchQuery = $event);
          return $event;
        });
        \u0275\u0275listener("ngModelChange", function MemberDatabaseComponent_Template_input_ngModelChange_91_listener($event) {
          return ctx.onSearchChange($event);
        });
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(92, MemberDatabaseComponent_Conditional_92_Template, 2, 0, "button", 30);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(93, "select", 31);
        \u0275\u0275twoWayListener("ngModelChange", function MemberDatabaseComponent_Template_select_ngModelChange_93_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.selectedSource, $event) || (ctx.selectedSource = $event);
          return $event;
        });
        \u0275\u0275listener("ngModelChange", function MemberDatabaseComponent_Template_select_ngModelChange_93_listener() {
          return ctx.applyFilters();
        });
        \u0275\u0275elementStart(94, "option", 32);
        \u0275\u0275text(95, "\u6240\u6709\u4F86\u6E90\u7FA4\u7D44");
        \u0275\u0275elementEnd();
        \u0275\u0275repeaterCreate(96, MemberDatabaseComponent_For_97_Template, 2, 3, "option", 33, _forTrack019);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(98, "select", 31);
        \u0275\u0275twoWayListener("ngModelChange", function MemberDatabaseComponent_Template_select_ngModelChange_98_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.selectedOnlineStatus, $event) || (ctx.selectedOnlineStatus = $event);
          return $event;
        });
        \u0275\u0275listener("ngModelChange", function MemberDatabaseComponent_Template_select_ngModelChange_98_listener() {
          return ctx.applyFilters();
        });
        \u0275\u0275elementStart(99, "option", 32);
        \u0275\u0275text(100, "\u6240\u6709\u72C0\u614B");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(101, "option", 34);
        \u0275\u0275text(102, "\u{1F7E2} \u5728\u7DDA");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(103, "option", 35);
        \u0275\u0275text(104, "\u{1F7E1} \u6700\u8FD1\u4E0A\u7DDA");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(105, "option", 36);
        \u0275\u0275text(106, "\u{1F7E0} \u672C\u9031\u4E0A\u7DDA");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(107, "option", 37);
        \u0275\u0275text(108, "\u26AA \u9577\u671F\u96E2\u7DDA");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(109, "select", 31);
        \u0275\u0275twoWayListener("ngModelChange", function MemberDatabaseComponent_Template_select_ngModelChange_109_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.selectedValueLevel, $event) || (ctx.selectedValueLevel = $event);
          return $event;
        });
        \u0275\u0275listener("ngModelChange", function MemberDatabaseComponent_Template_select_ngModelChange_109_listener() {
          return ctx.applyFilters();
        });
        \u0275\u0275elementStart(110, "option", 32);
        \u0275\u0275text(111, "\u6240\u6709\u7B49\u7D1A");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(112, "option", 38);
        \u0275\u0275text(113, "S \u7D1A - \u9802\u7D1A");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(114, "option", 39);
        \u0275\u0275text(115, "A \u7D1A - \u512A\u8CEA");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(116, "option", 40);
        \u0275\u0275text(117, "B \u7D1A - \u666E\u901A");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(118, "option", 41);
        \u0275\u0275text(119, "C \u7D1A - \u4E00\u822C");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(120, "option", 42);
        \u0275\u0275text(121, "D \u7D1A - \u4F4E\u50F9\u503C");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(122, "div", 26)(123, "label", 43)(124, "input", 44);
        \u0275\u0275twoWayListener("ngModelChange", function MemberDatabaseComponent_Template_input_ngModelChange_124_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.filterPremium, $event) || (ctx.filterPremium = $event);
          return $event;
        });
        \u0275\u0275listener("ngModelChange", function MemberDatabaseComponent_Template_input_ngModelChange_124_listener() {
          return ctx.applyFilters();
        });
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(125, "span");
        \u0275\u0275text(126, "\u2B50 Premium");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(127, "label", 43)(128, "input", 44);
        \u0275\u0275twoWayListener("ngModelChange", function MemberDatabaseComponent_Template_input_ngModelChange_128_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.filterChinese, $event) || (ctx.filterChinese = $event);
          return $event;
        });
        \u0275\u0275listener("ngModelChange", function MemberDatabaseComponent_Template_input_ngModelChange_128_listener() {
          return ctx.applyFilters();
        });
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(129, "span");
        \u0275\u0275text(130, "\u{1F1E8}\u{1F1F3} \u83EF\u4EBA");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(131, "label", 43)(132, "input", 44);
        \u0275\u0275twoWayListener("ngModelChange", function MemberDatabaseComponent_Template_input_ngModelChange_132_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.filterHasUsername, $event) || (ctx.filterHasUsername = $event);
          return $event;
        });
        \u0275\u0275listener("ngModelChange", function MemberDatabaseComponent_Template_input_ngModelChange_132_listener() {
          return ctx.applyFilters();
        });
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(133, "span");
        \u0275\u0275text(134, "\u{1F4DB} \u6709\u7528\u6236\u540D");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(135, "label", 43)(136, "input", 44);
        \u0275\u0275twoWayListener("ngModelChange", function MemberDatabaseComponent_Template_input_ngModelChange_136_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.filterNotContacted, $event) || (ctx.filterNotContacted = $event);
          return $event;
        });
        \u0275\u0275listener("ngModelChange", function MemberDatabaseComponent_Template_input_ngModelChange_136_listener() {
          return ctx.applyFilters();
        });
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(137, "span");
        \u0275\u0275text(138, "\u{1F4ED} \u672A\u806F\u7E6B");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(139, "label", 43)(140, "input", 44);
        \u0275\u0275twoWayListener("ngModelChange", function MemberDatabaseComponent_Template_input_ngModelChange_140_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.filterHasPhoto, $event) || (ctx.filterHasPhoto = $event);
          return $event;
        });
        \u0275\u0275listener("ngModelChange", function MemberDatabaseComponent_Template_input_ngModelChange_140_listener() {
          return ctx.applyFilters();
        });
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(141, "span");
        \u0275\u0275text(142, "\u{1F4F7} \u6709\u982D\u50CF");
        \u0275\u0275elementEnd()();
        \u0275\u0275conditionalCreate(143, MemberDatabaseComponent_Conditional_143_Template, 2, 0, "button", 45);
        \u0275\u0275elementStart(144, "div", 46);
        \u0275\u0275text(145, " \u627E\u5230 ");
        \u0275\u0275elementStart(146, "strong");
        \u0275\u0275text(147);
        \u0275\u0275pipe(148, "number");
        \u0275\u0275elementEnd();
        \u0275\u0275text(149, " \u500B\u6210\u54E1 ");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(150, "div", 47);
        \u0275\u0275conditionalCreate(151, MemberDatabaseComponent_Conditional_151_Template, 4, 0, "div", 48)(152, MemberDatabaseComponent_Conditional_152_Template, 7, 0, "div", 49)(153, MemberDatabaseComponent_Conditional_153_Template, 55, 21);
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(154, MemberDatabaseComponent_Conditional_154_Template, 99, 37);
        \u0275\u0275conditionalCreate(155, MemberDatabaseComponent_Conditional_155_Template, 20, 2);
        \u0275\u0275elementEnd();
      }
      if (rf & 2) {
        \u0275\u0275advance(13);
        \u0275\u0275conditional(ctx.showAdvancedMenu() ? 13 : -1);
        \u0275\u0275advance();
        \u0275\u0275property("disabled", ctx.isLoading());
        \u0275\u0275advance();
        \u0275\u0275classProp("animate-spin", ctx.isLoading());
        \u0275\u0275advance(2);
        \u0275\u0275textInterpolate1(" ", ctx.isLoading() ? "\u8F09\u5165\u4E2D..." : "\u5237\u65B0", " ");
        \u0275\u0275advance();
        \u0275\u0275property("disabled", ctx.filteredMembers().length === 0);
        \u0275\u0275advance(8);
        \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(27, 33, ctx.stats().total));
        \u0275\u0275advance(4);
        \u0275\u0275conditional(ctx.stats().todayNew > 0 ? 30 : -1);
        \u0275\u0275advance(6);
        \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(37, 35, ctx.stats().online));
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate1("", ctx.getOnlinePercent(), "%");
        \u0275\u0275advance(6);
        \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(48, 37, ctx.stats().premium));
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate1("", ctx.getPremiumPercent(), "%");
        \u0275\u0275advance(6);
        \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(59, 39, ctx.stats().chinese));
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate1("", ctx.getChinesePercent(), "%");
        \u0275\u0275advance(6);
        \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(70, 41, ctx.stats().contacted));
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate1("", ctx.getContactedPercent(), "%");
        \u0275\u0275advance(6);
        \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(81, 43, ctx.stats().converted));
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate1("", ctx.getConvertedPercent(), "%");
        \u0275\u0275advance(6);
        \u0275\u0275twoWayProperty("ngModel", ctx.searchQuery);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.searchQuery ? 92 : -1);
        \u0275\u0275advance();
        \u0275\u0275twoWayProperty("ngModel", ctx.selectedSource);
        \u0275\u0275advance(3);
        \u0275\u0275repeater(ctx.sourceGroups());
        \u0275\u0275advance(2);
        \u0275\u0275twoWayProperty("ngModel", ctx.selectedOnlineStatus);
        \u0275\u0275advance(11);
        \u0275\u0275twoWayProperty("ngModel", ctx.selectedValueLevel);
        \u0275\u0275advance(15);
        \u0275\u0275twoWayProperty("ngModel", ctx.filterPremium);
        \u0275\u0275advance(4);
        \u0275\u0275twoWayProperty("ngModel", ctx.filterChinese);
        \u0275\u0275advance(4);
        \u0275\u0275twoWayProperty("ngModel", ctx.filterHasUsername);
        \u0275\u0275advance(4);
        \u0275\u0275twoWayProperty("ngModel", ctx.filterNotContacted);
        \u0275\u0275advance(4);
        \u0275\u0275twoWayProperty("ngModel", ctx.filterHasPhoto);
        \u0275\u0275advance(3);
        \u0275\u0275conditional(ctx.hasActiveFilters() ? 143 : -1);
        \u0275\u0275advance(4);
        \u0275\u0275textInterpolate(\u0275\u0275pipeBind1(148, 45, ctx.filteredMembers().length));
        \u0275\u0275advance(4);
        \u0275\u0275conditional(ctx.isLoading() ? 151 : ctx.filteredMembers().length === 0 ? 152 : 153);
        \u0275\u0275advance(3);
        \u0275\u0275conditional(ctx.selectedMember() ? 154 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.showAddTagDialog() ? 155 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, NgSelectOption, \u0275NgSelectMultipleOption, DefaultValueAccessor, CheckboxControlValueAccessor, SelectControlValueAccessor, NgControlStatus, NgModel, DecimalPipe], styles: ["\n\n.member-database-container[_ngcontent-%COMP%] {\n  padding: 1.5rem;\n  height: 100%;\n  overflow-y: auto;\n}\n.page-header[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 1.5rem;\n}\n.page-title[_ngcontent-%COMP%] {\n  font-size: 1.5rem;\n  font-weight: 600;\n  color: white;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin: 0;\n}\n.title-icon[_ngcontent-%COMP%] {\n  font-size: 1.75rem;\n}\n.page-desc[_ngcontent-%COMP%] {\n  color: #94a3b8;\n  margin: 0.25rem 0 0 0;\n  font-size: 0.875rem;\n}\n.header-actions[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.75rem;\n}\n.btn-primary[_ngcontent-%COMP%] {\n  padding: 0.5rem 1rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 500;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  transition: all 0.2s;\n}\n.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);\n}\n.btn-primary[_ngcontent-%COMP%]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.btn-secondary[_ngcontent-%COMP%] {\n  padding: 0.5rem 1rem;\n  background: rgba(71, 85, 105, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.5rem;\n  color: #e2e8f0;\n  font-weight: 500;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  transition: all 0.2s;\n}\n.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled) {\n  background: rgba(71, 85, 105, 0.7);\n  border-color: rgba(148, 163, 184, 0.3);\n}\n.btn-secondary[_ngcontent-%COMP%]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.btn-text[_ngcontent-%COMP%] {\n  padding: 0.25rem 0.5rem;\n  background: transparent;\n  border: none;\n  color: #94a3b8;\n  cursor: pointer;\n  font-size: 0.875rem;\n}\n.btn-text[_ngcontent-%COMP%]:hover {\n  color: #f87171;\n}\n.stats-grid[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n}\n.stat-card[_ngcontent-%COMP%] {\n  background: rgba(30, 41, 59, 0.8);\n  border: 1px solid rgba(148, 163, 184, 0.1);\n  border-radius: 0.75rem;\n  padding: 1rem;\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  position: relative;\n}\n.stat-icon[_ngcontent-%COMP%] {\n  font-size: 1.5rem;\n}\n.stat-content[_ngcontent-%COMP%] {\n  flex: 1;\n}\n.stat-value[_ngcontent-%COMP%] {\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: white;\n}\n.stat-label[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: #94a3b8;\n}\n.stat-badge[_ngcontent-%COMP%] {\n  position: absolute;\n  top: 0.5rem;\n  right: 0.5rem;\n  padding: 0.125rem 0.375rem;\n  border-radius: 0.25rem;\n  font-size: 0.625rem;\n  font-weight: 600;\n}\n.stat-badge.success[_ngcontent-%COMP%] {\n  background: rgba(34, 197, 94, 0.2);\n  color: #86efac;\n}\n.stat-percent[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n  color: #94a3b8;\n}\n.stat-card.online[_ngcontent-%COMP%] {\n  border-left: 3px solid #22c55e;\n}\n.stat-card.premium[_ngcontent-%COMP%] {\n  border-left: 3px solid #f59e0b;\n}\n.stat-card.chinese[_ngcontent-%COMP%] {\n  border-left: 3px solid #ef4444;\n}\n.stat-card.contacted[_ngcontent-%COMP%] {\n  border-left: 3px solid #3b82f6;\n}\n.stat-card.converted[_ngcontent-%COMP%] {\n  border-left: 3px solid #8b5cf6;\n}\n.filter-section[_ngcontent-%COMP%] {\n  background: rgba(30, 41, 59, 0.6);\n  border: 1px solid rgba(148, 163, 184, 0.1);\n  border-radius: 0.75rem;\n  padding: 1rem;\n  margin-bottom: 1rem;\n}\n.filter-row[_ngcontent-%COMP%] {\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n  gap: 0.75rem;\n  margin-bottom: 0.75rem;\n}\n.filter-row[_ngcontent-%COMP%]:last-child {\n  margin-bottom: 0;\n}\n.search-box[_ngcontent-%COMP%] {\n  position: relative;\n  flex: 1;\n  min-width: 200px;\n  max-width: 300px;\n}\n.search-icon[_ngcontent-%COMP%] {\n  position: absolute;\n  left: 0.75rem;\n  top: 50%;\n  transform: translateY(-50%);\n  font-size: 0.875rem;\n}\n.search-input[_ngcontent-%COMP%] {\n  width: 100%;\n  padding: 0.5rem 2rem 0.5rem 2.25rem;\n  background: rgba(15, 23, 42, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.5rem;\n  color: white;\n  font-size: 0.875rem;\n}\n.search-input[_ngcontent-%COMP%]:focus {\n  outline: none;\n  border-color: #06b6d4;\n}\n.search-clear[_ngcontent-%COMP%] {\n  position: absolute;\n  right: 0.5rem;\n  top: 50%;\n  transform: translateY(-50%);\n  background: none;\n  border: none;\n  color: #94a3b8;\n  cursor: pointer;\n  font-size: 0.75rem;\n}\n.filter-select[_ngcontent-%COMP%] {\n  padding: 0.5rem 0.75rem;\n  background: rgba(15, 23, 42, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.5rem;\n  color: white;\n  font-size: 0.875rem;\n  min-width: 140px;\n}\n.filter-select[_ngcontent-%COMP%]:focus {\n  outline: none;\n  border-color: #06b6d4;\n}\n.filter-checkbox[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.375rem;\n  padding: 0.375rem 0.75rem;\n  background: rgba(15, 23, 42, 0.3);\n  border: 1px solid rgba(148, 163, 184, 0.15);\n  border-radius: 0.5rem;\n  color: #e2e8f0;\n  font-size: 0.8rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.filter-checkbox[_ngcontent-%COMP%]:hover {\n  background: rgba(15, 23, 42, 0.5);\n  border-color: rgba(148, 163, 184, 0.25);\n}\n.filter-checkbox[_ngcontent-%COMP%]:has(input:checked) {\n  background: rgba(6, 182, 212, 0.15);\n  border-color: rgba(6, 182, 212, 0.4);\n}\n.filter-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] {\n  margin: 0;\n}\n.filter-result[_ngcontent-%COMP%] {\n  margin-left: auto;\n  color: #94a3b8;\n  font-size: 0.875rem;\n}\n.member-list-section[_ngcontent-%COMP%] {\n  background: rgba(30, 41, 59, 0.6);\n  border: 1px solid rgba(148, 163, 184, 0.1);\n  border-radius: 0.75rem;\n  overflow: hidden;\n}\n.loading-state[_ngcontent-%COMP%], \n.empty-state[_ngcontent-%COMP%] {\n  padding: 4rem 2rem;\n  text-align: center;\n  color: #94a3b8;\n}\n.loading-spinner[_ngcontent-%COMP%] {\n  width: 40px;\n  height: 40px;\n  border: 3px solid rgba(6, 182, 212, 0.2);\n  border-top-color: #06b6d4;\n  border-radius: 50%;\n  animation: _ngcontent-%COMP%_spin 1s linear infinite;\n  margin: 0 auto 1rem;\n}\n@keyframes _ngcontent-%COMP%_spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n.empty-icon[_ngcontent-%COMP%] {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n}\n.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%] {\n  color: white;\n  margin: 0 0 0.5rem;\n}\n.batch-action-bar[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0.75rem 1rem;\n  background: rgba(6, 182, 212, 0.1);\n  border-bottom: 1px solid rgba(6, 182, 212, 0.2);\n}\n.selected-count[_ngcontent-%COMP%] {\n  color: #22d3ee;\n  font-weight: 500;\n}\n.batch-actions[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.5rem;\n}\n.btn-batch[_ngcontent-%COMP%] {\n  padding: 0.375rem 0.75rem;\n  background: rgba(30, 41, 59, 0.8);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.375rem;\n  color: #e2e8f0;\n  font-size: 0.8rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.btn-batch[_ngcontent-%COMP%]:hover {\n  background: rgba(51, 65, 85, 0.8);\n}\n.btn-batch.danger[_ngcontent-%COMP%] {\n  color: #f87171;\n}\n.btn-batch.danger[_ngcontent-%COMP%]:hover {\n  background: rgba(239, 68, 68, 0.2);\n}\n.member-table-container[_ngcontent-%COMP%] {\n  overflow-x: auto;\n}\n.member-table[_ngcontent-%COMP%] {\n  width: 100%;\n  border-collapse: collapse;\n  font-size: 0.875rem;\n}\n.member-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {\n  padding: 0.75rem 1rem;\n  text-align: left;\n  background: rgba(15, 23, 42, 0.5);\n  color: #94a3b8;\n  font-weight: 500;\n  border-bottom: 1px solid rgba(148, 163, 184, 0.1);\n  cursor: pointer;\n  -webkit-user-select: none;\n  user-select: none;\n  white-space: nowrap;\n}\n.member-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:hover {\n  background: rgba(15, 23, 42, 0.7);\n}\n.member-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] {\n  padding: 0.75rem 1rem;\n  border-bottom: 1px solid rgba(148, 163, 184, 0.05);\n  color: #e2e8f0;\n}\n.member-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%] {\n  cursor: pointer;\n  transition: background 0.15s;\n}\n.member-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover {\n  background: rgba(51, 65, 85, 0.3);\n}\n.member-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%] {\n  background: rgba(6, 182, 212, 0.1);\n}\n.col-checkbox[_ngcontent-%COMP%] {\n  width: 40px;\n}\n.col-id[_ngcontent-%COMP%] {\n  width: 120px;\n}\n.col-user[_ngcontent-%COMP%] {\n  min-width: 180px;\n}\n.col-username[_ngcontent-%COMP%] {\n  width: 120px;\n}\n.col-status[_ngcontent-%COMP%] {\n  width: 100px;\n}\n.col-level[_ngcontent-%COMP%] {\n  width: 60px;\n}\n.col-source[_ngcontent-%COMP%] {\n  width: 150px;\n}\n.col-tags[_ngcontent-%COMP%] {\n  width: 120px;\n}\n.col-contacted[_ngcontent-%COMP%] {\n  width: 100px;\n}\n.col-actions[_ngcontent-%COMP%] {\n  width: 100px;\n}\n.user-id[_ngcontent-%COMP%] {\n  font-family: monospace;\n  font-size: 0.75rem;\n  color: #94a3b8;\n}\n.user-info[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.user-avatar[_ngcontent-%COMP%] {\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  background:\n    linear-gradient(\n      135deg,\n      #475569,\n      #334155);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  font-weight: 500;\n  font-size: 0.875rem;\n}\n.user-avatar.has-photo[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n}\n.user-name-wrapper[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n}\n.user-name[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n}\n.premium-badge[_ngcontent-%COMP%], \n.verified-badge[_ngcontent-%COMP%], \n.chinese-badge[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n}\n.user-bio[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  color: #64748b;\n  max-width: 150px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.username-link[_ngcontent-%COMP%] {\n  color: #22d3ee;\n  text-decoration: none;\n}\n.username-link[_ngcontent-%COMP%]:hover {\n  text-decoration: underline;\n}\n.no-username[_ngcontent-%COMP%], \n.no-tags[_ngcontent-%COMP%] {\n  color: #475569;\n}\n.status-badge[_ngcontent-%COMP%] {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n}\n.status-badge.status-online[_ngcontent-%COMP%] {\n  background: rgba(34, 197, 94, 0.2);\n  color: #86efac;\n}\n.status-badge.status-recently[_ngcontent-%COMP%] {\n  background: rgba(234, 179, 8, 0.2);\n  color: #fde047;\n}\n.status-badge.status-last_week[_ngcontent-%COMP%] {\n  background: rgba(249, 115, 22, 0.2);\n  color: #fdba74;\n}\n.status-badge.status-last_month[_ngcontent-%COMP%] {\n  background: rgba(148, 163, 184, 0.2);\n  color: #94a3b8;\n}\n.status-badge.status-long_ago[_ngcontent-%COMP%] {\n  background: rgba(71, 85, 105, 0.2);\n  color: #64748b;\n}\n.status-badge.status-unknown[_ngcontent-%COMP%] {\n  background: rgba(71, 85, 105, 0.2);\n  color: #64748b;\n}\n.level-badge[_ngcontent-%COMP%] {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  border-radius: 50%;\n  font-size: 0.75rem;\n  font-weight: 600;\n}\n.level-badge.level-S[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #f59e0b,\n      #d97706);\n  color: white;\n}\n.level-badge.level-A[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #8b5cf6,\n      #7c3aed);\n  color: white;\n}\n.level-badge.level-B[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #3b82f6,\n      #2563eb);\n  color: white;\n}\n.level-badge.level-C[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e,\n      #16a34a);\n  color: white;\n}\n.level-badge.level-D[_ngcontent-%COMP%] {\n  background: rgba(71, 85, 105, 0.5);\n  color: #94a3b8;\n}\n.source-name[_ngcontent-%COMP%] {\n  max-width: 150px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  display: block;\n}\n.tags-container[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.25rem;\n  flex-wrap: wrap;\n}\n.tag[_ngcontent-%COMP%] {\n  padding: 0.125rem 0.375rem;\n  background: rgba(59, 130, 246, 0.2);\n  border-radius: 0.25rem;\n  font-size: 0.7rem;\n  color: #93c5fd;\n}\n.tag-more[_ngcontent-%COMP%] {\n  padding: 0.125rem 0.375rem;\n  background: rgba(71, 85, 105, 0.3);\n  border-radius: 0.25rem;\n  font-size: 0.7rem;\n  color: #94a3b8;\n}\n.contacted-badge[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n}\n.contacted-badge.yes[_ngcontent-%COMP%] {\n  color: #86efac;\n}\n.contacted-badge.no[_ngcontent-%COMP%] {\n  color: #94a3b8;\n}\n.action-buttons[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 0.25rem;\n}\n.action-btn[_ngcontent-%COMP%] {\n  padding: 0.25rem 0.5rem;\n  background: rgba(51, 65, 85, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.25rem;\n  font-size: 0.875rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn[_ngcontent-%COMP%]:hover {\n  background: rgba(71, 85, 105, 0.7);\n}\n.pagination[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem 1rem;\n  background: rgba(15, 23, 42, 0.3);\n  border-top: 1px solid rgba(148, 163, 184, 0.1);\n}\n.page-info[_ngcontent-%COMP%] {\n  color: #94a3b8;\n  font-size: 0.875rem;\n}\n.page-controls[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.page-btn[_ngcontent-%COMP%] {\n  padding: 0.375rem 0.5rem;\n  background: rgba(51, 65, 85, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.page-btn[_ngcontent-%COMP%]:disabled {\n  opacity: 0.3;\n  cursor: not-allowed;\n}\n.page-btn[_ngcontent-%COMP%]:hover:not(:disabled) {\n  background: rgba(71, 85, 105, 0.7);\n}\n.page-number[_ngcontent-%COMP%] {\n  color: white;\n  font-size: 0.875rem;\n  padding: 0 0.5rem;\n}\n.page-size-select[_ngcontent-%COMP%] {\n  padding: 0.375rem 0.5rem;\n  background: rgba(15, 23, 42, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.25rem;\n  color: white;\n  font-size: 0.75rem;\n}\n.member-detail-overlay[_ngcontent-%COMP%] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 100;\n}\n.member-detail-drawer[_ngcontent-%COMP%] {\n  position: fixed;\n  top: 0;\n  right: 0;\n  width: 400px;\n  max-width: 90vw;\n  height: 100vh;\n  background: #1e293b;\n  border-left: 1px solid rgba(148, 163, 184, 0.1);\n  z-index: 101;\n  display: flex;\n  flex-direction: column;\n  animation: _ngcontent-%COMP%_slideIn 0.2s ease-out;\n}\n@keyframes _ngcontent-%COMP%_slideIn {\n  from {\n    transform: translateX(100%);\n  }\n  to {\n    transform: translateX(0);\n  }\n}\n.drawer-header[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid rgba(148, 163, 184, 0.1);\n}\n.drawer-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%] {\n  margin: 0;\n  font-size: 1.125rem;\n  color: white;\n}\n.close-btn[_ngcontent-%COMP%] {\n  padding: 0.375rem;\n  background: rgba(71, 85, 105, 0.5);\n  border: none;\n  border-radius: 0.375rem;\n  color: #94a3b8;\n  cursor: pointer;\n  font-size: 1rem;\n}\n.close-btn[_ngcontent-%COMP%]:hover {\n  background: rgba(71, 85, 105, 0.8);\n  color: white;\n}\n.drawer-content[_ngcontent-%COMP%] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 1.25rem;\n}\n.detail-section[_ngcontent-%COMP%] {\n  margin-bottom: 1.5rem;\n}\n.section-title[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n  color: #94a3b8;\n  margin: 0 0 0.75rem;\n  display: flex;\n  align-items: center;\n  gap: 0.375rem;\n}\n.member-profile[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.profile-avatar[_ngcontent-%COMP%] {\n  width: 64px;\n  height: 64px;\n  border-radius: 50%;\n  background:\n    linear-gradient(\n      135deg,\n      #475569,\n      #334155);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  font-weight: 600;\n  font-size: 1.5rem;\n}\n.profile-avatar.has-photo[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n}\n.profile-info[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.profile-name[_ngcontent-%COMP%] {\n  margin: 0;\n  font-size: 1.125rem;\n  color: white;\n  display: flex;\n  align-items: center;\n  gap: 0.375rem;\n}\n.profile-username[_ngcontent-%COMP%] {\n  color: #22d3ee;\n  text-decoration: none;\n  font-size: 0.875rem;\n}\n.profile-username[_ngcontent-%COMP%]:hover {\n  text-decoration: underline;\n}\n.detail-grid[_ngcontent-%COMP%] {\n  display: grid;\n  gap: 0.75rem;\n}\n.detail-item[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.detail-label[_ngcontent-%COMP%] {\n  color: #64748b;\n  font-size: 0.875rem;\n}\n.detail-value[_ngcontent-%COMP%] {\n  color: white;\n  font-size: 0.875rem;\n}\n.detail-value.copyable[_ngcontent-%COMP%] {\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 0.375rem;\n}\n.detail-value.copyable[_ngcontent-%COMP%]:hover {\n  color: #22d3ee;\n}\n.copy-icon[_ngcontent-%COMP%] {\n  font-size: 0.75rem;\n  opacity: 0.5;\n}\n.status-tags[_ngcontent-%COMP%] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.status-tag[_ngcontent-%COMP%] {\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n}\n.status-tag.premium[_ngcontent-%COMP%] {\n  background: rgba(245, 158, 11, 0.2);\n  color: #fbbf24;\n}\n.status-tag.verified[_ngcontent-%COMP%] {\n  background: rgba(34, 197, 94, 0.2);\n  color: #86efac;\n}\n.status-tag.photo[_ngcontent-%COMP%] {\n  background: rgba(59, 130, 246, 0.2);\n  color: #93c5fd;\n}\n.status-tag.chinese[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #fca5a5;\n}\n.status-tag.danger[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.3);\n  color: #f87171;\n}\n.status-tag.deleted[_ngcontent-%COMP%] {\n  background: rgba(71, 85, 105, 0.3);\n  color: #94a3b8;\n}\n.bio-text[_ngcontent-%COMP%] {\n  color: #cbd5e1;\n  font-size: 0.875rem;\n  line-height: 1.5;\n  background: rgba(15, 23, 42, 0.5);\n  padding: 0.75rem;\n  border-radius: 0.5rem;\n  margin: 0;\n}\n.source-list[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.source-item[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem 0.75rem;\n  background: rgba(15, 23, 42, 0.5);\n  border-radius: 0.375rem;\n}\n.source-item[_ngcontent-%COMP%]   .source-name[_ngcontent-%COMP%] {\n  color: white;\n  font-size: 0.875rem;\n}\n.source-date[_ngcontent-%COMP%] {\n  color: #64748b;\n  font-size: 0.75rem;\n}\n.tags-edit[_ngcontent-%COMP%] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.tag.editable[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n}\n.tag-remove[_ngcontent-%COMP%] {\n  background: none;\n  border: none;\n  color: #64748b;\n  cursor: pointer;\n  font-size: 0.625rem;\n  padding: 0;\n}\n.tag-remove[_ngcontent-%COMP%]:hover {\n  color: #f87171;\n}\n.add-tag-btn[_ngcontent-%COMP%] {\n  padding: 0.25rem 0.5rem;\n  background: rgba(51, 65, 85, 0.5);\n  border: 1px dashed rgba(148, 163, 184, 0.3);\n  border-radius: 0.25rem;\n  color: #94a3b8;\n  font-size: 0.75rem;\n  cursor: pointer;\n}\n.add-tag-btn[_ngcontent-%COMP%]:hover {\n  background: rgba(51, 65, 85, 0.7);\n  color: white;\n}\n.notes-textarea[_ngcontent-%COMP%] {\n  width: 100%;\n  min-height: 80px;\n  padding: 0.75rem;\n  background: rgba(15, 23, 42, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.5rem;\n  color: white;\n  font-size: 0.875rem;\n  resize: vertical;\n}\n.notes-textarea[_ngcontent-%COMP%]:focus {\n  outline: none;\n  border-color: #06b6d4;\n}\n.marketing-status[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.status-item[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem 0.75rem;\n  background: rgba(15, 23, 42, 0.3);\n  border-radius: 0.375rem;\n}\n.status-label[_ngcontent-%COMP%] {\n  color: #64748b;\n  font-size: 0.875rem;\n}\n.status-value[_ngcontent-%COMP%] {\n  font-size: 0.875rem;\n}\n.status-value.contacted[_ngcontent-%COMP%] {\n  color: #86efac;\n}\n.status-value.converted[_ngcontent-%COMP%] {\n  color: #c084fc;\n}\n.drawer-footer[_ngcontent-%COMP%] {\n  padding: 1rem 1.25rem;\n  border-top: 1px solid rgba(148, 163, 184, 0.1);\n  display: flex;\n  gap: 0.75rem;\n}\n.drawer-footer[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%], \n.drawer-footer[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%] {\n  flex: 1;\n  justify-content: center;\n}\n.dialog-overlay[_ngcontent-%COMP%] {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 200;\n}\n.dialog[_ngcontent-%COMP%] {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 400px;\n  max-width: 90vw;\n  background: #1e293b;\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.75rem;\n  z-index: 201;\n}\n.dialog-header[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid rgba(148, 163, 184, 0.1);\n}\n.dialog-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%] {\n  margin: 0;\n  color: white;\n}\n.dialog-content[_ngcontent-%COMP%] {\n  padding: 1.25rem;\n}\n.tag-input[_ngcontent-%COMP%] {\n  width: 100%;\n  padding: 0.75rem;\n  background: rgba(15, 23, 42, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.5rem;\n  color: white;\n  font-size: 0.875rem;\n  margin-bottom: 1rem;\n}\n.tag-input[_ngcontent-%COMP%]:focus {\n  outline: none;\n  border-color: #06b6d4;\n}\n.suggested-tags[_ngcontent-%COMP%] {\n  margin-top: 1rem;\n}\n.suggested-title[_ngcontent-%COMP%] {\n  color: #94a3b8;\n  font-size: 0.75rem;\n  margin: 0 0 0.5rem;\n}\n.suggested-list[_ngcontent-%COMP%] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.suggested-tag[_ngcontent-%COMP%] {\n  padding: 0.25rem 0.5rem;\n  background: rgba(51, 65, 85, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.25rem;\n  color: #e2e8f0;\n  font-size: 0.75rem;\n  cursor: pointer;\n}\n.suggested-tag[_ngcontent-%COMP%]:hover {\n  background: rgba(6, 182, 212, 0.2);\n  border-color: rgba(6, 182, 212, 0.4);\n}\n.dialog-footer[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.75rem;\n  padding: 1rem 1.25rem;\n  border-top: 1px solid rgba(148, 163, 184, 0.1);\n}\n.animate-spin[_ngcontent-%COMP%] {\n  animation: _ngcontent-%COMP%_spin 1s linear infinite;\n}\n/*# sourceMappingURL=member-database.component.css.map */"], changeDetection: 0 });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(MemberDatabaseComponent, [{
    type: Component,
    args: [{ selector: "app-member-database", standalone: true, imports: [CommonModule, FormsModule], changeDetection: ChangeDetectionStrategy.OnPush, template: `
    <div class="member-database-container">
      <!-- \u9801\u9762\u6A19\u984C -->
      <div class="page-header">
        <div class="header-left">
          <h1 class="page-title">
            <span class="title-icon">\u{1F4C1}</span>
            \u6210\u54E1\u8CC7\u6599\u5EAB
          </h1>
          <p class="page-desc">\u7BA1\u7406\u548C\u5206\u6790\u63D0\u53D6\u7684 Telegram \u6210\u54E1\u6578\u64DA</p>
        </div>
        <div class="header-actions">
          <!-- P4: \u9AD8\u7D1A\u5DE5\u5177\u6309\u9215\u7D44 -->
          <div class="relative inline-block" style="position: relative;">
            <button (click)="showAdvancedMenu.set(!showAdvancedMenu())" class="btn-secondary">
              \u{1F6E0}\uFE0F \u9AD8\u7D1A\u5DE5\u5177 \u25BE
            </button>
            @if (showAdvancedMenu()) {
              <div class="absolute right-0 mt-2 w-56 bg-slate-800 rounded-xl shadow-xl border border-slate-700 py-2 z-50" style="position: absolute; right: 0; margin-top: 8px; width: 240px;">
                <button (click)="deduplicateMembers(); showAdvancedMenu.set(false)" class="w-full px-4 py-2 text-left hover:bg-slate-700 flex items-center gap-2" style="display: flex; align-items: center; padding: 8px 16px;">
                  \u{1F504} \u667A\u80FD\u53BB\u91CD
                  <span class="ml-auto text-xs text-slate-400" style="margin-left: auto; font-size: 11px; color: #94a3b8;">\u8DE8\u7FA4\u7D44\u5408\u4F75</span>
                </button>
                <button (click)="recalculateScores(); showAdvancedMenu.set(false)" class="w-full px-4 py-2 text-left hover:bg-slate-700 flex items-center gap-2" style="display: flex; align-items: center; padding: 8px 16px;">
                  \u{1F4CA} \u91CD\u7B97\u8A55\u5206
                  <span class="ml-auto text-xs text-slate-400" style="margin-left: auto; font-size: 11px; color: #94a3b8;">\u66F4\u65B0\u50F9\u503C\u7B49\u7D1A</span>
                </button>
                <div class="border-t border-slate-700 my-1" style="border-top: 1px solid #334155; margin: 4px 0;"></div>
                <button (click)="showGroupProfile(); showAdvancedMenu.set(false)" class="w-full px-4 py-2 text-left hover:bg-slate-700 flex items-center gap-2" style="display: flex; align-items: center; padding: 8px 16px;">
                  \u{1F4C8} \u7FA4\u7D44\u756B\u50CF
                  <span class="ml-auto text-xs text-slate-400" style="margin-left: auto; font-size: 11px; color: #94a3b8;">\u8CEA\u91CF\u5206\u6790</span>
                </button>
                <button (click)="compareGroups(); showAdvancedMenu.set(false)" class="w-full px-4 py-2 text-left hover:bg-slate-700 flex items-center gap-2" style="display: flex; align-items: center; padding: 8px 16px;">
                  \u{1F4CA} \u7FA4\u7D44\u5C0D\u6BD4
                  <span class="ml-auto text-xs text-slate-400" style="margin-left: auto; font-size: 11px; color: #94a3b8;">\u591A\u7FA4\u5C0D\u6BD4</span>
                </button>
                <div class="border-t border-slate-700 my-1" style="border-top: 1px solid #334155; margin: 4px 0;"></div>
                <button (click)="viewExtractionStats(); showAdvancedMenu.set(false)" class="w-full px-4 py-2 text-left hover:bg-slate-700 flex items-center gap-2" style="display: flex; align-items: center; padding: 8px 16px;">
                  \u{1F4C9} \u63D0\u53D6\u7D71\u8A08
                  <span class="ml-auto text-xs text-slate-400" style="margin-left: auto; font-size: 11px; color: #94a3b8;">\u6210\u529F\u7387/\u6548\u80FD</span>
                </button>
              </div>
            }
          </div>
          
          <button (click)="refreshMembers()" [disabled]="isLoading()" class="btn-secondary">
            <span [class.animate-spin]="isLoading()">\u{1F504}</span>
            {{ isLoading() ? '\u8F09\u5165\u4E2D...' : '\u5237\u65B0' }}
          </button>
          <button (click)="exportMembers()" [disabled]="filteredMembers().length === 0" class="btn-primary">
            \u{1F4E5} \u5C0E\u51FA CSV
          </button>
        </div>
      </div>

      <!-- \u7D71\u8A08\u5361\u7247 -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">\u{1F465}</div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().total | number }}</div>
            <div class="stat-label">\u7E3D\u6210\u54E1\u6578</div>
          </div>
          @if (stats().todayNew > 0) {
            <div class="stat-badge success">+{{ stats().todayNew }} \u4ECA\u65E5</div>
          }
        </div>
        
        <div class="stat-card online">
          <div class="stat-icon">\u{1F7E2}</div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().online | number }}</div>
            <div class="stat-label">\u5728\u7DDA\u6210\u54E1</div>
          </div>
          <div class="stat-percent">{{ getOnlinePercent() }}%</div>
        </div>
        
        <div class="stat-card premium">
          <div class="stat-icon">\u2B50</div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().premium | number }}</div>
            <div class="stat-label">Premium \u7528\u6236</div>
          </div>
          <div class="stat-percent">{{ getPremiumPercent() }}%</div>
        </div>
        
        <div class="stat-card chinese">
          <div class="stat-icon">\u{1F1E8}\u{1F1F3}</div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().chinese | number }}</div>
            <div class="stat-label">\u83EF\u4EBA\u6210\u54E1</div>
          </div>
          <div class="stat-percent">{{ getChinesePercent() }}%</div>
        </div>
        
        <div class="stat-card contacted">
          <div class="stat-icon">\u{1F4AC}</div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().contacted | number }}</div>
            <div class="stat-label">\u5DF2\u806F\u7E6B</div>
          </div>
          <div class="stat-percent">{{ getContactedPercent() }}%</div>
        </div>
        
        <div class="stat-card converted">
          <div class="stat-icon">\u2705</div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().converted | number }}</div>
            <div class="stat-label">\u5DF2\u8F49\u5316</div>
          </div>
          <div class="stat-percent">{{ getConvertedPercent() }}%</div>
        </div>
      </div>

      <!-- \u7BE9\u9078\u5668 -->
      <div class="filter-section">
        <div class="filter-row">
          <!-- \u641C\u7D22\u6846 -->
          <div class="search-box">
            <span class="search-icon">\u{1F50D}</span>
            <input 
              type="text" 
              [(ngModel)]="searchQuery"
              (ngModelChange)="onSearchChange($event)"
              placeholder="\u641C\u7D22\u59D3\u540D\u3001\u7528\u6236\u540D\u3001ID..."
              class="search-input"
            />
            @if (searchQuery) {
              <button (click)="clearSearch()" class="search-clear">\u2715</button>
            }
          </div>
          
          <!-- \u4F86\u6E90\u7FA4\u7D44\u7BE9\u9078 -->
          <select [(ngModel)]="selectedSource" (ngModelChange)="applyFilters()" class="filter-select">
            <option value="">\u6240\u6709\u4F86\u6E90\u7FA4\u7D44</option>
            @for (source of sourceGroups(); track source.group) {
              <option [value]="source.group">{{ source.title }} ({{ source.count }})</option>
            }
          </select>
          
          <!-- \u5728\u7DDA\u72C0\u614B\u7BE9\u9078 -->
          <select [(ngModel)]="selectedOnlineStatus" (ngModelChange)="applyFilters()" class="filter-select">
            <option value="">\u6240\u6709\u72C0\u614B</option>
            <option value="online">\u{1F7E2} \u5728\u7DDA</option>
            <option value="recently">\u{1F7E1} \u6700\u8FD1\u4E0A\u7DDA</option>
            <option value="last_week">\u{1F7E0} \u672C\u9031\u4E0A\u7DDA</option>
            <option value="long_ago">\u26AA \u9577\u671F\u96E2\u7DDA</option>
          </select>
          
          <!-- \u50F9\u503C\u7B49\u7D1A\u7BE9\u9078 -->
          <select [(ngModel)]="selectedValueLevel" (ngModelChange)="applyFilters()" class="filter-select">
            <option value="">\u6240\u6709\u7B49\u7D1A</option>
            <option value="S">S \u7D1A - \u9802\u7D1A</option>
            <option value="A">A \u7D1A - \u512A\u8CEA</option>
            <option value="B">B \u7D1A - \u666E\u901A</option>
            <option value="C">C \u7D1A - \u4E00\u822C</option>
            <option value="D">D \u7D1A - \u4F4E\u50F9\u503C</option>
          </select>
        </div>
        
        <div class="filter-row">
          <!-- \u5FEB\u6377\u7BE9\u9078 -->
          <label class="filter-checkbox">
            <input type="checkbox" [(ngModel)]="filterPremium" (ngModelChange)="applyFilters()" />
            <span>\u2B50 Premium</span>
          </label>
          <label class="filter-checkbox">
            <input type="checkbox" [(ngModel)]="filterChinese" (ngModelChange)="applyFilters()" />
            <span>\u{1F1E8}\u{1F1F3} \u83EF\u4EBA</span>
          </label>
          <label class="filter-checkbox">
            <input type="checkbox" [(ngModel)]="filterHasUsername" (ngModelChange)="applyFilters()" />
            <span>\u{1F4DB} \u6709\u7528\u6236\u540D</span>
          </label>
          <label class="filter-checkbox">
            <input type="checkbox" [(ngModel)]="filterNotContacted" (ngModelChange)="applyFilters()" />
            <span>\u{1F4ED} \u672A\u806F\u7E6B</span>
          </label>
          <label class="filter-checkbox">
            <input type="checkbox" [(ngModel)]="filterHasPhoto" (ngModelChange)="applyFilters()" />
            <span>\u{1F4F7} \u6709\u982D\u50CF</span>
          </label>
          
          @if (hasActiveFilters()) {
            <button (click)="clearFilters()" class="btn-text">
              \u{1F5D1}\uFE0F \u6E05\u9664\u7BE9\u9078
            </button>
          }
          
          <div class="filter-result">
            \u627E\u5230 <strong>{{ filteredMembers().length | number }}</strong> \u500B\u6210\u54E1
          </div>
        </div>
      </div>

      <!-- \u6210\u54E1\u5217\u8868 -->
      <div class="member-list-section">
        @if (isLoading()) {
          <div class="loading-state">
            <div class="loading-spinner"></div>
            <p>\u6B63\u5728\u8F09\u5165\u6210\u54E1\u6578\u64DA...</p>
          </div>
        } @else if (filteredMembers().length === 0) {
          <div class="empty-state">
            <div class="empty-icon">\u{1F4ED}</div>
            <h3>\u66AB\u7121\u6210\u54E1\u6578\u64DA</h3>
            <p>\u8ACB\u5148\u5F9E\u300C\u8CC7\u6E90\u767C\u73FE\u300D\u9801\u9762\u63D0\u53D6\u7FA4\u7D44\u6210\u54E1</p>
          </div>
        } @else {
          <!-- \u6279\u91CF\u64CD\u4F5C\u6B04 -->
          @if (selectedMemberIds().length > 0) {
            <div class="batch-action-bar">
              <span class="selected-count">\u5DF2\u9078\u64C7 {{ selectedMemberIds().length }} \u500B\u6210\u54E1</span>
              <div class="batch-actions">
                <button (click)="batchSendMessage()" class="btn-batch">
                  \u{1F4E8} \u6279\u91CF\u767C\u6D88\u606F
                </button>
                <button (click)="batchAddTags()" class="btn-batch">
                  \u{1F3F7}\uFE0F \u6279\u91CF\u6A19\u7C64
                </button>
                <button (click)="batchMarkContacted()" class="btn-batch">
                  \u2705 \u6A19\u8A18\u5DF2\u806F\u7E6B
                </button>
                <button (click)="batchExport()" class="btn-batch">
                  \u{1F4E5} \u5C0E\u51FA\u9078\u4E2D
                </button>
                <button (click)="clearSelection()" class="btn-batch danger">
                  \u2715 \u53D6\u6D88\u9078\u64C7
                </button>
              </div>
            </div>
          }
          
          <!-- \u5217\u8868\u8868\u683C -->
          <div class="member-table-container">
            <table class="member-table">
              <thead>
                <tr>
                  <th class="col-checkbox">
                    <input 
                      type="checkbox" 
                      [checked]="isAllSelected()" 
                      [indeterminate]="isPartialSelected()"
                      (change)="toggleSelectAll()"
                    />
                  </th>
                  <th class="col-id" (click)="sortBy('user_id')">
                    ID
                    @if (sortField === 'user_id') {
                      <span>{{ sortDirection === 'asc' ? '\u2191' : '\u2193' }}</span>
                    }
                  </th>
                  <th class="col-user" (click)="sortBy('first_name')">
                    \u7528\u6236
                    @if (sortField === 'first_name') {
                      <span>{{ sortDirection === 'asc' ? '\u2191' : '\u2193' }}</span>
                    }
                  </th>
                  <th class="col-username">\u7528\u6236\u540D</th>
                  <th class="col-status" (click)="sortBy('online_status')">
                    \u72C0\u614B
                    @if (sortField === 'online_status') {
                      <span>{{ sortDirection === 'asc' ? '\u2191' : '\u2193' }}</span>
                    }
                  </th>
                  <th class="col-level" (click)="sortBy('value_level')">
                    \u7B49\u7D1A
                    @if (sortField === 'value_level') {
                      <span>{{ sortDirection === 'asc' ? '\u2191' : '\u2193' }}</span>
                    }
                  </th>
                  <th class="col-source">\u4F86\u6E90\u7FA4\u7D44</th>
                  <th class="col-tags">\u6A19\u7C64</th>
                  <th class="col-contacted">\u806F\u7E6B\u72C0\u614B</th>
                  <th class="col-actions">\u64CD\u4F5C</th>
                </tr>
              </thead>
              <tbody>
                @for (member of paginatedMembers(); track member.user_id) {
                  <tr [class.selected]="isMemberSelected(member.user_id)" (click)="openMemberDetail(member)">
                    <td class="col-checkbox" (click)="$event.stopPropagation()">
                      <input 
                        type="checkbox" 
                        [checked]="isMemberSelected(member.user_id)"
                        (change)="toggleMemberSelection(member.user_id)"
                      />
                    </td>
                    <td class="col-id">
                      <span class="user-id" [title]="member.user_id">{{ member.user_id }}</span>
                    </td>
                    <td class="col-user">
                      <div class="user-info">
                        <div class="user-avatar" [class.has-photo]="member.has_photo">
                          {{ getAvatarLetter(member) }}
                        </div>
                        <div class="user-name-wrapper">
                          <span class="user-name">
                            {{ member.first_name }} {{ member.last_name }}
                            @if (member.is_premium) {
                              <span class="premium-badge" title="Premium">\u2B50</span>
                            }
                            @if (member.is_verified) {
                              <span class="verified-badge" title="\u5DF2\u9A57\u8B49">\u2713</span>
                            }
                            @if (isChinese(member)) {
                              <span class="chinese-badge" title="\u83EF\u4EBA">\u{1F1E8}\u{1F1F3}</span>
                            }
                          </span>
                          @if (member.bio) {
                            <span class="user-bio" [title]="member.bio">{{ member.bio }}</span>
                          }
                        </div>
                      </div>
                    </td>
                    <td class="col-username">
                      @if (member.username) {
                        <a [href]="'https://t.me/' + member.username" target="_blank" class="username-link" (click)="$event.stopPropagation()">
                          @{{ member.username }}
                        </a>
                      } @else {
                        <span class="no-username">-</span>
                      }
                    </td>
                    <td class="col-status">
                      <span class="status-badge" [class]="'status-' + member.online_status">
                        {{ getStatusIcon(member.online_status) }}
                        {{ getStatusText(member.online_status) }}
                      </span>
                    </td>
                    <td class="col-level">
                      <span class="level-badge" [class]="'level-' + member.value_level">
                        {{ member.value_level }}
                      </span>
                    </td>
                    <td class="col-source">
                      <span class="source-name" [title]="member.source_chat_title">
                        {{ member.source_chat_title || '\u672A\u77E5' }}
                      </span>
                    </td>
                    <td class="col-tags">
                      @if (getMemberTags(member).length > 0) {
                        <div class="tags-container">
                          @for (tag of getMemberTags(member).slice(0, 2); track tag) {
                            <span class="tag">{{ tag }}</span>
                          }
                          @if (getMemberTags(member).length > 2) {
                            <span class="tag-more">+{{ getMemberTags(member).length - 2 }}</span>
                          }
                        </div>
                      } @else {
                        <span class="no-tags">-</span>
                      }
                    </td>
                    <td class="col-contacted">
                      @if (member.contacted) {
                        <span class="contacted-badge yes">
                          \u2705 \u5DF2\u806F\u7E6B
                        </span>
                      } @else {
                        <span class="contacted-badge no">
                          \u{1F4ED} \u672A\u806F\u7E6B
                        </span>
                      }
                    </td>
                    <td class="col-actions" (click)="$event.stopPropagation()">
                      <div class="action-buttons">
                        <button (click)="sendMessage(member)" class="action-btn" title="\u767C\u6D88\u606F">
                          \u{1F4AC}
                        </button>
                        <button (click)="addToFunnel(member)" class="action-btn" title="\u52A0\u5165\u6F0F\u6597">
                          \u{1F4E4}
                        </button>
                        <button (click)="openMemberDetail(member)" class="action-btn" title="\u67E5\u770B\u8A73\u60C5">
                          \u{1F441}\uFE0F
                        </button>
                      </div>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
          
          <!-- \u5206\u9801 -->
          <div class="pagination">
            <div class="page-info">
              \u986F\u793A {{ getPageStart() }} - {{ getPageEnd() }} / {{ filteredMembers().length }} \u500B\u6210\u54E1
            </div>
            <div class="page-controls">
              <button (click)="goToPage(1)" [disabled]="currentPage === 1" class="page-btn">
                \u23EE\uFE0F
              </button>
              <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1" class="page-btn">
                \u25C0\uFE0F
              </button>
              <span class="page-number">{{ currentPage }} / {{ totalPages() }}</span>
              <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage >= totalPages()" class="page-btn">
                \u25B6\uFE0F
              </button>
              <button (click)="goToPage(totalPages())" [disabled]="currentPage >= totalPages()" class="page-btn">
                \u23ED\uFE0F
              </button>
              <select [(ngModel)]="pageSize" (ngModelChange)="onPageSizeChange()" class="page-size-select">
                <option [value]="25">25 / \u9801</option>
                <option [value]="50">50 / \u9801</option>
                <option [value]="100">100 / \u9801</option>
                <option [value]="200">200 / \u9801</option>
              </select>
            </div>
          </div>
        }
      </div>

      <!-- \u6210\u54E1\u8A73\u60C5\u5074\u908A\u6B04 -->
      @if (selectedMember()) {
        <div class="member-detail-overlay" (click)="closeMemberDetail()"></div>
        <div class="member-detail-drawer">
          <div class="drawer-header">
            <h2>\u6210\u54E1\u8A73\u60C5</h2>
            <button (click)="closeMemberDetail()" class="close-btn">\u2715</button>
          </div>
          
          <div class="drawer-content">
            <!-- \u57FA\u672C\u4FE1\u606F -->
            <div class="detail-section">
              <div class="member-profile">
                <div class="profile-avatar" [class.has-photo]="selectedMember()!.has_photo">
                  {{ getAvatarLetter(selectedMember()!) }}
                </div>
                <div class="profile-info">
                  <h3 class="profile-name">
                    {{ selectedMember()!.first_name }} {{ selectedMember()!.last_name }}
                    @if (selectedMember()!.is_premium) {
                      <span class="premium-badge">\u2B50</span>
                    }
                  </h3>
                  @if (selectedMember()!.username) {
                    <a [href]="'https://t.me/' + selectedMember()!.username" target="_blank" class="profile-username">
                      @{{ selectedMember()!.username }}
                    </a>
                  }
                  <span class="status-badge" [class]="'status-' + selectedMember()!.online_status">
                    {{ getStatusIcon(selectedMember()!.online_status) }}
                    {{ getStatusText(selectedMember()!.online_status) }}
                  </span>
                </div>
              </div>
            </div>
            
            <!-- ID \u548C\u96FB\u8A71 -->
            <div class="detail-section">
              <h4 class="section-title">\u{1F4CB} \u57FA\u672C\u4FE1\u606F</h4>
              <div class="detail-grid">
                <div class="detail-item">
                  <span class="detail-label">Telegram ID</span>
                  <span class="detail-value copyable" (click)="copyToClipboard(selectedMember()!.user_id)">
                    {{ selectedMember()!.user_id }}
                    <span class="copy-icon">\u{1F4CB}</span>
                  </span>
                </div>
                @if (selectedMember()!.phone) {
                  <div class="detail-item">
                    <span class="detail-label">\u96FB\u8A71\u865F\u78BC</span>
                    <span class="detail-value">{{ selectedMember()!.phone }}</span>
                  </div>
                }
                @if (selectedMember()!.language_code) {
                  <div class="detail-item">
                    <span class="detail-label">\u8A9E\u8A00</span>
                    <span class="detail-value">{{ selectedMember()!.language_code }}</span>
                  </div>
                }
                <div class="detail-item">
                  <span class="detail-label">\u50F9\u503C\u7B49\u7D1A</span>
                  <span class="detail-value">
                    <span class="level-badge" [class]="'level-' + selectedMember()!.value_level">
                      {{ selectedMember()!.value_level }} \u7D1A
                    </span>
                  </span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">\u6D3B\u8E8D\u5EA6\u8A55\u5206</span>
                  <span class="detail-value">{{ selectedMember()!.activity_score }}/100</span>
                </div>
              </div>
            </div>
            
            <!-- \u5E33\u865F\u72C0\u614B -->
            <div class="detail-section">
              <h4 class="section-title">\u{1F516} \u5E33\u865F\u72C0\u614B</h4>
              <div class="status-tags">
                @if (selectedMember()!.is_premium) {
                  <span class="status-tag premium">\u2B50 Premium</span>
                }
                @if (selectedMember()!.is_verified) {
                  <span class="status-tag verified">\u2713 \u5DF2\u9A57\u8B49</span>
                }
                @if (selectedMember()!.has_photo) {
                  <span class="status-tag photo">\u{1F4F7} \u6709\u982D\u50CF</span>
                }
                @if (isChinese(selectedMember()!)) {
                  <span class="status-tag chinese">\u{1F1E8}\u{1F1F3} \u83EF\u4EBA</span>
                }
                @if (selectedMember()!.is_scam) {
                  <span class="status-tag danger">\u26A0\uFE0F \u8A50\u9A19\u6A19\u8A18</span>
                }
                @if (selectedMember()!.is_deleted) {
                  <span class="status-tag deleted">\u{1F5D1}\uFE0F \u5DF2\u522A\u9664</span>
                }
              </div>
            </div>
            
            <!-- \u500B\u4EBA\u7C21\u4ECB -->
            @if (selectedMember()!.bio) {
              <div class="detail-section">
                <h4 class="section-title">\u{1F4DD} \u500B\u4EBA\u7C21\u4ECB</h4>
                <p class="bio-text">{{ selectedMember()!.bio }}</p>
              </div>
            }
            
            <!-- \u4F86\u6E90\u7FA4\u7D44 -->
            <div class="detail-section">
              <h4 class="section-title">\u{1F4CD} \u4F86\u6E90\u7FA4\u7D44</h4>
              <div class="source-list">
                <div class="source-item">
                  <span class="source-name">{{ selectedMember()!.source_chat_title }}</span>
                  <span class="source-date">{{ formatDate(selectedMember()!.extracted_at) }}</span>
                </div>
                @for (groupId of getGroupsList(selectedMember()!); track groupId) {
                  @if (groupId !== selectedMember()!.source_chat_id) {
                    <div class="source-item">
                      <span class="source-name">\u7FA4\u7D44 {{ groupId }}</span>
                    </div>
                  }
                }
              </div>
            </div>
            
            <!-- \u6A19\u7C64 -->
            <div class="detail-section">
              <h4 class="section-title">\u{1F3F7}\uFE0F \u6A19\u7C64</h4>
              <div class="tags-edit">
                @for (tag of getMemberTags(selectedMember()!); track tag) {
                  <span class="tag editable">
                    {{ tag }}
                    <button (click)="removeTag(selectedMember()!, tag)" class="tag-remove">\u2715</button>
                  </span>
                }
                <button (click)="openAddTagDialog()" class="add-tag-btn">+ \u6DFB\u52A0\u6A19\u7C64</button>
              </div>
            </div>
            
            <!-- \u5099\u8A3B -->
            <div class="detail-section">
              <h4 class="section-title">\u{1F4DD} \u5099\u8A3B</h4>
              <textarea 
                [(ngModel)]="memberNotes"
                (blur)="saveMemberNotes()"
                placeholder="\u6DFB\u52A0\u8DDF\u9032\u5099\u8A3B..."
                class="notes-textarea"
              ></textarea>
            </div>
            
            <!-- \u71DF\u92B7\u72C0\u614B -->
            <div class="detail-section">
              <h4 class="section-title">\u{1F4CA} \u71DF\u92B7\u72C0\u614B</h4>
              <div class="marketing-status">
                <div class="status-item">
                  <span class="status-label">\u806F\u7E6B\u72C0\u614B</span>
                  <span class="status-value" [class.contacted]="selectedMember()!.contacted">
                    {{ selectedMember()!.contacted ? '\u2705 \u5DF2\u806F\u7E6B' : '\u{1F4ED} \u672A\u806F\u7E6B' }}
                  </span>
                </div>
                @if (selectedMember()!.contacted_at) {
                  <div class="status-item">
                    <span class="status-label">\u806F\u7E6B\u6642\u9593</span>
                    <span class="status-value">{{ formatDate(selectedMember()!.contacted_at) }}</span>
                  </div>
                }
                @if (selectedMember()!.response_status) {
                  <div class="status-item">
                    <span class="status-label">\u56DE\u8986\u72C0\u614B</span>
                    <span class="status-value">{{ selectedMember()!.response_status }}</span>
                  </div>
                }
                <div class="status-item">
                  <span class="status-label">\u8F49\u5316\u72C0\u614B</span>
                  <span class="status-value" [class.converted]="selectedMember()!.converted">
                    {{ selectedMember()!.converted ? '\u2705 \u5DF2\u8F49\u5316' : '\u23F3 \u5F85\u8F49\u5316' }}
                  </span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- \u64CD\u4F5C\u6309\u9215 -->
          <div class="drawer-footer">
            <button (click)="sendMessage(selectedMember()!)" class="btn-primary">
              \u{1F4AC} \u767C\u6D88\u606F
            </button>
            <button (click)="addToFunnel(selectedMember()!)" class="btn-secondary">
              \u{1F4E4} \u52A0\u5165\u6F0F\u6597
            </button>
            @if (!selectedMember()!.contacted) {
              <button (click)="markAsContacted(selectedMember()!)" class="btn-secondary">
                \u2705 \u6A19\u8A18\u5DF2\u806F\u7E6B
              </button>
            }
          </div>
        </div>
      }

      <!-- \u6DFB\u52A0\u6A19\u7C64\u5C0D\u8A71\u6846 -->
      @if (showAddTagDialog()) {
        <div class="dialog-overlay" (click)="closeAddTagDialog()"></div>
        <div class="dialog">
          <div class="dialog-header">
            <h3>\u6DFB\u52A0\u6A19\u7C64</h3>
            <button (click)="closeAddTagDialog()" class="close-btn">\u2715</button>
          </div>
          <div class="dialog-content">
            <input 
              type="text" 
              [(ngModel)]="newTagName"
              placeholder="\u8F38\u5165\u6A19\u7C64\u540D\u7A31..."
              class="tag-input"
              (keyup.enter)="addTag()"
            />
            <div class="suggested-tags">
              <p class="suggested-title">\u5E38\u7528\u6A19\u7C64\uFF1A</p>
              <div class="suggested-list">
                @for (tag of suggestedTags; track tag) {
                  <button (click)="addSuggestedTag(tag)" class="suggested-tag">{{ tag }}</button>
                }
              </div>
            </div>
          </div>
          <div class="dialog-footer">
            <button (click)="closeAddTagDialog()" class="btn-secondary">\u53D6\u6D88</button>
            <button (click)="addTag()" [disabled]="!newTagName" class="btn-primary">\u6DFB\u52A0</button>
          </div>
        </div>
      }
    </div>
  `, styles: ["/* angular:styles/component:css;2054b0ed0dbda79150feb4024d743629b565bafe96b59ecdb780745829f7b411;D:/tgkz2026/src/member-database/member-database.component.ts */\n.member-database-container {\n  padding: 1.5rem;\n  height: 100%;\n  overflow-y: auto;\n}\n.page-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 1.5rem;\n}\n.page-title {\n  font-size: 1.5rem;\n  font-weight: 600;\n  color: white;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin: 0;\n}\n.title-icon {\n  font-size: 1.75rem;\n}\n.page-desc {\n  color: #94a3b8;\n  margin: 0.25rem 0 0 0;\n  font-size: 0.875rem;\n}\n.header-actions {\n  display: flex;\n  gap: 0.75rem;\n}\n.btn-primary {\n  padding: 0.5rem 1rem;\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n  border: none;\n  border-radius: 0.5rem;\n  color: white;\n  font-weight: 500;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  transition: all 0.2s;\n}\n.btn-primary:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);\n}\n.btn-primary:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.btn-secondary {\n  padding: 0.5rem 1rem;\n  background: rgba(71, 85, 105, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.5rem;\n  color: #e2e8f0;\n  font-weight: 500;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  transition: all 0.2s;\n}\n.btn-secondary:hover:not(:disabled) {\n  background: rgba(71, 85, 105, 0.7);\n  border-color: rgba(148, 163, 184, 0.3);\n}\n.btn-secondary:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.btn-text {\n  padding: 0.25rem 0.5rem;\n  background: transparent;\n  border: none;\n  color: #94a3b8;\n  cursor: pointer;\n  font-size: 0.875rem;\n}\n.btn-text:hover {\n  color: #f87171;\n}\n.stats-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n}\n.stat-card {\n  background: rgba(30, 41, 59, 0.8);\n  border: 1px solid rgba(148, 163, 184, 0.1);\n  border-radius: 0.75rem;\n  padding: 1rem;\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  position: relative;\n}\n.stat-icon {\n  font-size: 1.5rem;\n}\n.stat-content {\n  flex: 1;\n}\n.stat-value {\n  font-size: 1.5rem;\n  font-weight: 700;\n  color: white;\n}\n.stat-label {\n  font-size: 0.75rem;\n  color: #94a3b8;\n}\n.stat-badge {\n  position: absolute;\n  top: 0.5rem;\n  right: 0.5rem;\n  padding: 0.125rem 0.375rem;\n  border-radius: 0.25rem;\n  font-size: 0.625rem;\n  font-weight: 600;\n}\n.stat-badge.success {\n  background: rgba(34, 197, 94, 0.2);\n  color: #86efac;\n}\n.stat-percent {\n  font-size: 0.875rem;\n  color: #94a3b8;\n}\n.stat-card.online {\n  border-left: 3px solid #22c55e;\n}\n.stat-card.premium {\n  border-left: 3px solid #f59e0b;\n}\n.stat-card.chinese {\n  border-left: 3px solid #ef4444;\n}\n.stat-card.contacted {\n  border-left: 3px solid #3b82f6;\n}\n.stat-card.converted {\n  border-left: 3px solid #8b5cf6;\n}\n.filter-section {\n  background: rgba(30, 41, 59, 0.6);\n  border: 1px solid rgba(148, 163, 184, 0.1);\n  border-radius: 0.75rem;\n  padding: 1rem;\n  margin-bottom: 1rem;\n}\n.filter-row {\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n  gap: 0.75rem;\n  margin-bottom: 0.75rem;\n}\n.filter-row:last-child {\n  margin-bottom: 0;\n}\n.search-box {\n  position: relative;\n  flex: 1;\n  min-width: 200px;\n  max-width: 300px;\n}\n.search-icon {\n  position: absolute;\n  left: 0.75rem;\n  top: 50%;\n  transform: translateY(-50%);\n  font-size: 0.875rem;\n}\n.search-input {\n  width: 100%;\n  padding: 0.5rem 2rem 0.5rem 2.25rem;\n  background: rgba(15, 23, 42, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.5rem;\n  color: white;\n  font-size: 0.875rem;\n}\n.search-input:focus {\n  outline: none;\n  border-color: #06b6d4;\n}\n.search-clear {\n  position: absolute;\n  right: 0.5rem;\n  top: 50%;\n  transform: translateY(-50%);\n  background: none;\n  border: none;\n  color: #94a3b8;\n  cursor: pointer;\n  font-size: 0.75rem;\n}\n.filter-select {\n  padding: 0.5rem 0.75rem;\n  background: rgba(15, 23, 42, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.5rem;\n  color: white;\n  font-size: 0.875rem;\n  min-width: 140px;\n}\n.filter-select:focus {\n  outline: none;\n  border-color: #06b6d4;\n}\n.filter-checkbox {\n  display: flex;\n  align-items: center;\n  gap: 0.375rem;\n  padding: 0.375rem 0.75rem;\n  background: rgba(15, 23, 42, 0.3);\n  border: 1px solid rgba(148, 163, 184, 0.15);\n  border-radius: 0.5rem;\n  color: #e2e8f0;\n  font-size: 0.8rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.filter-checkbox:hover {\n  background: rgba(15, 23, 42, 0.5);\n  border-color: rgba(148, 163, 184, 0.25);\n}\n.filter-checkbox:has(input:checked) {\n  background: rgba(6, 182, 212, 0.15);\n  border-color: rgba(6, 182, 212, 0.4);\n}\n.filter-checkbox input {\n  margin: 0;\n}\n.filter-result {\n  margin-left: auto;\n  color: #94a3b8;\n  font-size: 0.875rem;\n}\n.member-list-section {\n  background: rgba(30, 41, 59, 0.6);\n  border: 1px solid rgba(148, 163, 184, 0.1);\n  border-radius: 0.75rem;\n  overflow: hidden;\n}\n.loading-state,\n.empty-state {\n  padding: 4rem 2rem;\n  text-align: center;\n  color: #94a3b8;\n}\n.loading-spinner {\n  width: 40px;\n  height: 40px;\n  border: 3px solid rgba(6, 182, 212, 0.2);\n  border-top-color: #06b6d4;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin: 0 auto 1rem;\n}\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n.empty-icon {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n}\n.empty-state h3 {\n  color: white;\n  margin: 0 0 0.5rem;\n}\n.batch-action-bar {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0.75rem 1rem;\n  background: rgba(6, 182, 212, 0.1);\n  border-bottom: 1px solid rgba(6, 182, 212, 0.2);\n}\n.selected-count {\n  color: #22d3ee;\n  font-weight: 500;\n}\n.batch-actions {\n  display: flex;\n  gap: 0.5rem;\n}\n.btn-batch {\n  padding: 0.375rem 0.75rem;\n  background: rgba(30, 41, 59, 0.8);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.375rem;\n  color: #e2e8f0;\n  font-size: 0.8rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.btn-batch:hover {\n  background: rgba(51, 65, 85, 0.8);\n}\n.btn-batch.danger {\n  color: #f87171;\n}\n.btn-batch.danger:hover {\n  background: rgba(239, 68, 68, 0.2);\n}\n.member-table-container {\n  overflow-x: auto;\n}\n.member-table {\n  width: 100%;\n  border-collapse: collapse;\n  font-size: 0.875rem;\n}\n.member-table th {\n  padding: 0.75rem 1rem;\n  text-align: left;\n  background: rgba(15, 23, 42, 0.5);\n  color: #94a3b8;\n  font-weight: 500;\n  border-bottom: 1px solid rgba(148, 163, 184, 0.1);\n  cursor: pointer;\n  -webkit-user-select: none;\n  user-select: none;\n  white-space: nowrap;\n}\n.member-table th:hover {\n  background: rgba(15, 23, 42, 0.7);\n}\n.member-table td {\n  padding: 0.75rem 1rem;\n  border-bottom: 1px solid rgba(148, 163, 184, 0.05);\n  color: #e2e8f0;\n}\n.member-table tr {\n  cursor: pointer;\n  transition: background 0.15s;\n}\n.member-table tbody tr:hover {\n  background: rgba(51, 65, 85, 0.3);\n}\n.member-table tbody tr.selected {\n  background: rgba(6, 182, 212, 0.1);\n}\n.col-checkbox {\n  width: 40px;\n}\n.col-id {\n  width: 120px;\n}\n.col-user {\n  min-width: 180px;\n}\n.col-username {\n  width: 120px;\n}\n.col-status {\n  width: 100px;\n}\n.col-level {\n  width: 60px;\n}\n.col-source {\n  width: 150px;\n}\n.col-tags {\n  width: 120px;\n}\n.col-contacted {\n  width: 100px;\n}\n.col-actions {\n  width: 100px;\n}\n.user-id {\n  font-family: monospace;\n  font-size: 0.75rem;\n  color: #94a3b8;\n}\n.user-info {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n.user-avatar {\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  background:\n    linear-gradient(\n      135deg,\n      #475569,\n      #334155);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  font-weight: 500;\n  font-size: 0.875rem;\n}\n.user-avatar.has-photo {\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n}\n.user-name-wrapper {\n  display: flex;\n  flex-direction: column;\n}\n.user-name {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n}\n.premium-badge,\n.verified-badge,\n.chinese-badge {\n  font-size: 0.75rem;\n}\n.user-bio {\n  font-size: 0.75rem;\n  color: #64748b;\n  max-width: 150px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.username-link {\n  color: #22d3ee;\n  text-decoration: none;\n}\n.username-link:hover {\n  text-decoration: underline;\n}\n.no-username,\n.no-tags {\n  color: #475569;\n}\n.status-badge {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n}\n.status-badge.status-online {\n  background: rgba(34, 197, 94, 0.2);\n  color: #86efac;\n}\n.status-badge.status-recently {\n  background: rgba(234, 179, 8, 0.2);\n  color: #fde047;\n}\n.status-badge.status-last_week {\n  background: rgba(249, 115, 22, 0.2);\n  color: #fdba74;\n}\n.status-badge.status-last_month {\n  background: rgba(148, 163, 184, 0.2);\n  color: #94a3b8;\n}\n.status-badge.status-long_ago {\n  background: rgba(71, 85, 105, 0.2);\n  color: #64748b;\n}\n.status-badge.status-unknown {\n  background: rgba(71, 85, 105, 0.2);\n  color: #64748b;\n}\n.level-badge {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  border-radius: 50%;\n  font-size: 0.75rem;\n  font-weight: 600;\n}\n.level-badge.level-S {\n  background:\n    linear-gradient(\n      135deg,\n      #f59e0b,\n      #d97706);\n  color: white;\n}\n.level-badge.level-A {\n  background:\n    linear-gradient(\n      135deg,\n      #8b5cf6,\n      #7c3aed);\n  color: white;\n}\n.level-badge.level-B {\n  background:\n    linear-gradient(\n      135deg,\n      #3b82f6,\n      #2563eb);\n  color: white;\n}\n.level-badge.level-C {\n  background:\n    linear-gradient(\n      135deg,\n      #22c55e,\n      #16a34a);\n  color: white;\n}\n.level-badge.level-D {\n  background: rgba(71, 85, 105, 0.5);\n  color: #94a3b8;\n}\n.source-name {\n  max-width: 150px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  display: block;\n}\n.tags-container {\n  display: flex;\n  gap: 0.25rem;\n  flex-wrap: wrap;\n}\n.tag {\n  padding: 0.125rem 0.375rem;\n  background: rgba(59, 130, 246, 0.2);\n  border-radius: 0.25rem;\n  font-size: 0.7rem;\n  color: #93c5fd;\n}\n.tag-more {\n  padding: 0.125rem 0.375rem;\n  background: rgba(71, 85, 105, 0.3);\n  border-radius: 0.25rem;\n  font-size: 0.7rem;\n  color: #94a3b8;\n}\n.contacted-badge {\n  font-size: 0.75rem;\n}\n.contacted-badge.yes {\n  color: #86efac;\n}\n.contacted-badge.no {\n  color: #94a3b8;\n}\n.action-buttons {\n  display: flex;\n  gap: 0.25rem;\n}\n.action-btn {\n  padding: 0.25rem 0.5rem;\n  background: rgba(51, 65, 85, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.25rem;\n  font-size: 0.875rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn:hover {\n  background: rgba(71, 85, 105, 0.7);\n}\n.pagination {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.75rem 1rem;\n  background: rgba(15, 23, 42, 0.3);\n  border-top: 1px solid rgba(148, 163, 184, 0.1);\n}\n.page-info {\n  color: #94a3b8;\n  font-size: 0.875rem;\n}\n.page-controls {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n.page-btn {\n  padding: 0.375rem 0.5rem;\n  background: rgba(51, 65, 85, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.page-btn:disabled {\n  opacity: 0.3;\n  cursor: not-allowed;\n}\n.page-btn:hover:not(:disabled) {\n  background: rgba(71, 85, 105, 0.7);\n}\n.page-number {\n  color: white;\n  font-size: 0.875rem;\n  padding: 0 0.5rem;\n}\n.page-size-select {\n  padding: 0.375rem 0.5rem;\n  background: rgba(15, 23, 42, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.25rem;\n  color: white;\n  font-size: 0.75rem;\n}\n.member-detail-overlay {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 100;\n}\n.member-detail-drawer {\n  position: fixed;\n  top: 0;\n  right: 0;\n  width: 400px;\n  max-width: 90vw;\n  height: 100vh;\n  background: #1e293b;\n  border-left: 1px solid rgba(148, 163, 184, 0.1);\n  z-index: 101;\n  display: flex;\n  flex-direction: column;\n  animation: slideIn 0.2s ease-out;\n}\n@keyframes slideIn {\n  from {\n    transform: translateX(100%);\n  }\n  to {\n    transform: translateX(0);\n  }\n}\n.drawer-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid rgba(148, 163, 184, 0.1);\n}\n.drawer-header h2 {\n  margin: 0;\n  font-size: 1.125rem;\n  color: white;\n}\n.close-btn {\n  padding: 0.375rem;\n  background: rgba(71, 85, 105, 0.5);\n  border: none;\n  border-radius: 0.375rem;\n  color: #94a3b8;\n  cursor: pointer;\n  font-size: 1rem;\n}\n.close-btn:hover {\n  background: rgba(71, 85, 105, 0.8);\n  color: white;\n}\n.drawer-content {\n  flex: 1;\n  overflow-y: auto;\n  padding: 1.25rem;\n}\n.detail-section {\n  margin-bottom: 1.5rem;\n}\n.section-title {\n  font-size: 0.875rem;\n  color: #94a3b8;\n  margin: 0 0 0.75rem;\n  display: flex;\n  align-items: center;\n  gap: 0.375rem;\n}\n.member-profile {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n.profile-avatar {\n  width: 64px;\n  height: 64px;\n  border-radius: 50%;\n  background:\n    linear-gradient(\n      135deg,\n      #475569,\n      #334155);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  font-weight: 600;\n  font-size: 1.5rem;\n}\n.profile-avatar.has-photo {\n  background:\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #3b82f6);\n}\n.profile-info {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n.profile-name {\n  margin: 0;\n  font-size: 1.125rem;\n  color: white;\n  display: flex;\n  align-items: center;\n  gap: 0.375rem;\n}\n.profile-username {\n  color: #22d3ee;\n  text-decoration: none;\n  font-size: 0.875rem;\n}\n.profile-username:hover {\n  text-decoration: underline;\n}\n.detail-grid {\n  display: grid;\n  gap: 0.75rem;\n}\n.detail-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.detail-label {\n  color: #64748b;\n  font-size: 0.875rem;\n}\n.detail-value {\n  color: white;\n  font-size: 0.875rem;\n}\n.detail-value.copyable {\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 0.375rem;\n}\n.detail-value.copyable:hover {\n  color: #22d3ee;\n}\n.copy-icon {\n  font-size: 0.75rem;\n  opacity: 0.5;\n}\n.status-tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.status-tag {\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n}\n.status-tag.premium {\n  background: rgba(245, 158, 11, 0.2);\n  color: #fbbf24;\n}\n.status-tag.verified {\n  background: rgba(34, 197, 94, 0.2);\n  color: #86efac;\n}\n.status-tag.photo {\n  background: rgba(59, 130, 246, 0.2);\n  color: #93c5fd;\n}\n.status-tag.chinese {\n  background: rgba(239, 68, 68, 0.2);\n  color: #fca5a5;\n}\n.status-tag.danger {\n  background: rgba(239, 68, 68, 0.3);\n  color: #f87171;\n}\n.status-tag.deleted {\n  background: rgba(71, 85, 105, 0.3);\n  color: #94a3b8;\n}\n.bio-text {\n  color: #cbd5e1;\n  font-size: 0.875rem;\n  line-height: 1.5;\n  background: rgba(15, 23, 42, 0.5);\n  padding: 0.75rem;\n  border-radius: 0.5rem;\n  margin: 0;\n}\n.source-list {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.source-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem 0.75rem;\n  background: rgba(15, 23, 42, 0.5);\n  border-radius: 0.375rem;\n}\n.source-item .source-name {\n  color: white;\n  font-size: 0.875rem;\n}\n.source-date {\n  color: #64748b;\n  font-size: 0.75rem;\n}\n.tags-edit {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.tag.editable {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n}\n.tag-remove {\n  background: none;\n  border: none;\n  color: #64748b;\n  cursor: pointer;\n  font-size: 0.625rem;\n  padding: 0;\n}\n.tag-remove:hover {\n  color: #f87171;\n}\n.add-tag-btn {\n  padding: 0.25rem 0.5rem;\n  background: rgba(51, 65, 85, 0.5);\n  border: 1px dashed rgba(148, 163, 184, 0.3);\n  border-radius: 0.25rem;\n  color: #94a3b8;\n  font-size: 0.75rem;\n  cursor: pointer;\n}\n.add-tag-btn:hover {\n  background: rgba(51, 65, 85, 0.7);\n  color: white;\n}\n.notes-textarea {\n  width: 100%;\n  min-height: 80px;\n  padding: 0.75rem;\n  background: rgba(15, 23, 42, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.5rem;\n  color: white;\n  font-size: 0.875rem;\n  resize: vertical;\n}\n.notes-textarea:focus {\n  outline: none;\n  border-color: #06b6d4;\n}\n.marketing-status {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.status-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem 0.75rem;\n  background: rgba(15, 23, 42, 0.3);\n  border-radius: 0.375rem;\n}\n.status-label {\n  color: #64748b;\n  font-size: 0.875rem;\n}\n.status-value {\n  font-size: 0.875rem;\n}\n.status-value.contacted {\n  color: #86efac;\n}\n.status-value.converted {\n  color: #c084fc;\n}\n.drawer-footer {\n  padding: 1rem 1.25rem;\n  border-top: 1px solid rgba(148, 163, 184, 0.1);\n  display: flex;\n  gap: 0.75rem;\n}\n.drawer-footer .btn-primary,\n.drawer-footer .btn-secondary {\n  flex: 1;\n  justify-content: center;\n}\n.dialog-overlay {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 200;\n}\n.dialog {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 400px;\n  max-width: 90vw;\n  background: #1e293b;\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.75rem;\n  z-index: 201;\n}\n.dialog-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 1.25rem;\n  border-bottom: 1px solid rgba(148, 163, 184, 0.1);\n}\n.dialog-header h3 {\n  margin: 0;\n  color: white;\n}\n.dialog-content {\n  padding: 1.25rem;\n}\n.tag-input {\n  width: 100%;\n  padding: 0.75rem;\n  background: rgba(15, 23, 42, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.5rem;\n  color: white;\n  font-size: 0.875rem;\n  margin-bottom: 1rem;\n}\n.tag-input:focus {\n  outline: none;\n  border-color: #06b6d4;\n}\n.suggested-tags {\n  margin-top: 1rem;\n}\n.suggested-title {\n  color: #94a3b8;\n  font-size: 0.75rem;\n  margin: 0 0 0.5rem;\n}\n.suggested-list {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n}\n.suggested-tag {\n  padding: 0.25rem 0.5rem;\n  background: rgba(51, 65, 85, 0.5);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 0.25rem;\n  color: #e2e8f0;\n  font-size: 0.75rem;\n  cursor: pointer;\n}\n.suggested-tag:hover {\n  background: rgba(6, 182, 212, 0.2);\n  border-color: rgba(6, 182, 212, 0.4);\n}\n.dialog-footer {\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.75rem;\n  padding: 1rem 1.25rem;\n  border-top: 1px solid rgba(148, 163, 184, 0.1);\n}\n.animate-spin {\n  animation: spin 1s linear infinite;\n}\n/*# sourceMappingURL=member-database.component.css.map */\n"] }]
  }], null, { sendMessageEvent: [{ type: Output, args: ["sendMessageEvent"] }], addToFunnelEvent: [{ type: Output, args: ["addToFunnelEvent"] }], batchSendMessageEvent: [{ type: Output, args: ["batchSendMessageEvent"] }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(MemberDatabaseComponent, { className: "MemberDatabaseComponent", filePath: "src/member-database/member-database.component.ts", lineNumber: 1752 });
})();

// src/services/rag-brain.service.ts
var RAGBrainService = class _RAGBrainService {
  // 清除錯誤狀態
  clearLastError() {
    this._lastError.set(null);
  }
  constructor(ipcService, toastService) {
    this.ipcService = ipcService;
    this.toastService = toastService;
    this._isInitialized = signal(false, ...ngDevMode ? [{ debugName: "_isInitialized" }] : []);
    this._isLoading = signal(false, ...ngDevMode ? [{ debugName: "_isLoading" }] : []);
    this._isSearching = signal(false, ...ngDevMode ? [{ debugName: "_isSearching" }] : []);
    this._stats = signal(null, ...ngDevMode ? [{ debugName: "_stats" }] : []);
    this._recentKnowledge = signal([], ...ngDevMode ? [{ debugName: "_recentKnowledge" }] : []);
    this._learningEvents = signal([], ...ngDevMode ? [{ debugName: "_learningEvents" }] : []);
    this._searchResults = signal([], ...ngDevMode ? [{ debugName: "_searchResults" }] : []);
    this._buildProgress = signal(null, ...ngDevMode ? [{ debugName: "_buildProgress" }] : []);
    this._healthScore = signal(0, ...ngDevMode ? [{ debugName: "_healthScore" }] : []);
    this._knowledgeGaps = signal([], ...ngDevMode ? [{ debugName: "_knowledgeGaps" }] : []);
    this._healthReport = signal(null, ...ngDevMode ? [{ debugName: "_healthReport" }] : []);
    this._guidedQuestion = signal(null, ...ngDevMode ? [{ debugName: "_guidedQuestion" }] : []);
    this._guidedAnswers = signal({}, ...ngDevMode ? [{ debugName: "_guidedAnswers" }] : []);
    this._lastImportResult = signal(null, ...ngDevMode ? [{ debugName: "_lastImportResult" }] : []);
    this._lastError = signal(null, ...ngDevMode ? [{ debugName: "_lastError" }] : []);
    this.lastError = computed(() => this._lastError(), ...ngDevMode ? [{ debugName: "lastError" }] : []);
    this._pendingRequests = /* @__PURE__ */ new Map();
    this.REQUEST_TIMEOUT = 15e3;
    this._currentRequest = signal(null, ...ngDevMode ? [{ debugName: "_currentRequest" }] : []);
    this._requestStartTime = signal(0, ...ngDevMode ? [{ debugName: "_requestStartTime" }] : []);
    this.currentRequest = computed(() => this._currentRequest(), ...ngDevMode ? [{ debugName: "currentRequest" }] : []);
    this.requestElapsed = computed(() => {
      const start = this._requestStartTime();
      if (!start)
        return 0;
      return Date.now() - start;
    }, ...ngDevMode ? [{ debugName: "requestElapsed" }] : []);
    this.isInitialized = computed(() => this._isInitialized(), ...ngDevMode ? [{ debugName: "isInitialized" }] : []);
    this.isLoading = computed(() => this._isLoading(), ...ngDevMode ? [{ debugName: "isLoading" }] : []);
    this.isSearching = computed(() => this._isSearching(), ...ngDevMode ? [{ debugName: "isSearching" }] : []);
    this.stats = computed(() => this._stats(), ...ngDevMode ? [{ debugName: "stats" }] : []);
    this.recentKnowledge = computed(() => this._recentKnowledge(), ...ngDevMode ? [{ debugName: "recentKnowledge" }] : []);
    this.learningEvents = computed(() => this._learningEvents(), ...ngDevMode ? [{ debugName: "learningEvents" }] : []);
    this.searchResults = computed(() => this._searchResults(), ...ngDevMode ? [{ debugName: "searchResults" }] : []);
    this.buildProgress = computed(() => this._buildProgress(), ...ngDevMode ? [{ debugName: "buildProgress" }] : []);
    this.healthScore = computed(() => this._healthScore(), ...ngDevMode ? [{ debugName: "healthScore" }] : []);
    this.knowledgeGaps = computed(() => this._knowledgeGaps(), ...ngDevMode ? [{ debugName: "knowledgeGaps" }] : []);
    this.healthReport = computed(() => this._healthReport(), ...ngDevMode ? [{ debugName: "healthReport" }] : []);
    this.guidedQuestion = computed(() => this._guidedQuestion(), ...ngDevMode ? [{ debugName: "guidedQuestion" }] : []);
    this.gapsCount = computed(() => this._knowledgeGaps().length, ...ngDevMode ? [{ debugName: "gapsCount" }] : []);
    this.totalKnowledge = computed(() => this._stats()?.totalKnowledge || 0, ...ngDevMode ? [{ debugName: "totalKnowledge" }] : []);
    this.hitRate = computed(() => {
      const s = this._stats();
      if (!s || s.totalKnowledge === 0)
        return 0;
      return Math.round(s.totalUses / Math.max(1, s.totalKnowledge * 10) * 100);
    }, ...ngDevMode ? [{ debugName: "hitRate" }] : []);
    this.todayLearned = computed(() => {
      return this._learningEvents().filter((e) => {
        const today = (/* @__PURE__ */ new Date()).toDateString();
        return new Date(e.timestamp).toDateString() === today;
      }).length;
    }, ...ngDevMode ? [{ debugName: "todayLearned" }] : []);
    this.setupEventListeners();
  }
  // ==================== 🔧 P0: 超時管理 ====================
  /**
   * 開始帶超時的請求
   * @param requestId 請求標識符（用於取消）
   * @param timeoutMs 超時毫秒數（默認 15 秒）
   */
  startRequestWithTimeout(requestId, timeoutMs = this.REQUEST_TIMEOUT) {
    this.cancelRequest(requestId);
    this._currentRequest.set(requestId);
    this._requestStartTime.set(Date.now());
    const timer = setTimeout(() => {
      console.warn(`[RAGBrain] Request timeout: ${requestId}`);
      this._isLoading.set(false);
      this._currentRequest.set(null);
      this._requestStartTime.set(0);
      this._pendingRequests.delete(requestId);
      this.toastService.error(`\u8ACB\u6C42\u8D85\u6642\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66 (${this.getRequestDisplayName(requestId)})`);
      if (requestId === "build" || requestId === "guided-build") {
        this._buildProgress.set(null);
      }
      if (requestId === "search") {
        this._searchResults.set([]);
      }
    }, timeoutMs);
    this._pendingRequests.set(requestId, timer);
  }
  /**
   * 獲取請求的顯示名稱
   */
  getRequestDisplayName(requestId) {
    const names = {
      "initialize": "\u521D\u59CB\u5316",
      "search": "\u641C\u7D22",
      "build": "\u69CB\u5EFA\u77E5\u8B58\u5EAB",
      "guided-build": "\u5F15\u5C0E\u5F0F\u69CB\u5EFA",
      "import-url": "\u7DB2\u9801\u5C0E\u5165",
      "import-doc": "\u6587\u6A94\u5C0E\u5165"
    };
    return names[requestId] || requestId;
  }
  /**
   * 🔧 P1: 獲取當前請求的顯示名稱
   */
  getCurrentRequestName() {
    const current = this._currentRequest();
    return current ? this.getRequestDisplayName(current) : "";
  }
  /**
   * 請求完成，取消超時計時器
   */
  completeRequest(requestId) {
    const timer = this._pendingRequests.get(requestId);
    if (timer) {
      clearTimeout(timer);
      this._pendingRequests.delete(requestId);
    }
    if (this._currentRequest() === requestId) {
      this._currentRequest.set(null);
      this._requestStartTime.set(0);
    }
  }
  /**
   * 取消特定請求的超時計時器
   */
  cancelRequest(requestId) {
    const timer = this._pendingRequests.get(requestId);
    if (timer) {
      clearTimeout(timer);
      this._pendingRequests.delete(requestId);
    }
    if (this._currentRequest() === requestId) {
      this._currentRequest.set(null);
      this._requestStartTime.set(0);
    }
  }
  /**
   * 取消所有待處理請求
   */
  cancelAllRequests() {
    this._pendingRequests.forEach((timer) => clearTimeout(timer));
    this._pendingRequests.clear();
    this._currentRequest.set(null);
    this._requestStartTime.set(0);
  }
  /**
   * 🔧 P1: 公開取消當前請求的方法
   */
  cancelCurrentRequest() {
    const current = this._currentRequest();
    if (current) {
      this.cancelRequest(current);
      this._isLoading.set(false);
      this._buildProgress.set(null);
      this.toastService.info("\u5DF2\u53D6\u6D88\u8ACB\u6C42");
    }
  }
  // ==================== 事件監聽 ====================
  setupEventListeners() {
    this.ipcService.on("rag-initialized", (data) => {
      console.log("[RAGBrain] System initialized:", data);
      this.completeRequest("initialize");
      this._isLoading.set(false);
      if (data.success) {
        this._isInitialized.set(true);
        this.refreshStats();
        this.toastService.success("\u{1F9E0} AI \u77E5\u8B58\u5927\u8166\u5DF2\u555F\u52D5");
      } else {
        this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
      }
    });
    this.ipcService.on("rag-search-results", (data) => {
      console.log("[RAGBrain] Search results:", data);
      this.completeRequest("search");
      this._isLoading.set(false);
      if (data.success && data.results) {
        this._searchResults.set(data.results.map(this.mapSearchResult));
      } else if (!data.success) {
        this.toastService.error(`\u641C\u7D22\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
        this._searchResults.set([]);
      }
    });
    this.ipcService.on("rag-stats-updated", (data) => {
      console.log("[RAGBrain] Stats updated:", data);
      if (data.success && data.stats) {
        this._stats.set(this.mapStats(data.stats));
        this.calculateHealthScore();
      }
    });
    this.ipcService.on("rag-knowledge-added", (data) => {
      console.log("[RAGBrain] Knowledge added:", data);
      if (data.success) {
        this.addLearningEvent({
          type: "new_knowledge",
          description: `\u6DFB\u52A0\u4E86\u65B0${this.getTypeName(data.knowledgeType)}\u77E5\u8B58`,
          details: { knowledgeType: data.knowledgeType }
        });
        this.refreshStats();
      }
    });
    this.ipcService.on("rag-auto-learned", (data) => {
      console.log("[RAGBrain] Auto learned:", data);
      if (data.success && data.result) {
        const r = data.result;
        const total = (r.qa_extracted || 0) + (r.scripts_extracted || 0) + (r.objections_extracted || 0);
        if (total > 0) {
          this.addLearningEvent({
            type: "auto_learn",
            description: `\u5F9E\u5C0D\u8A71\u5B78\u7FD2\u4E86 ${total} \u689D\u77E5\u8B58`,
            details: {
              userId: data.userId,
              count: total,
              quality: r.quality_score
            }
          });
          this.refreshStats();
          this.toastService.info(`\u{1F4AC} \u5F9E\u5C0D\u8A71\u5B78\u7FD2\u4E86 ${total} \u689D\u77E5\u8B58`);
        }
      }
    });
    this.ipcService.on("rag-build-progress", (data) => {
      console.log("[RAGBrain] Build progress:", data);
      if (data.progress) {
        this._buildProgress.set(data.progress);
      }
    });
    this.ipcService.on("rag-build-complete", (data) => {
      console.log("[RAGBrain] Build complete:", data);
      this.completeRequest("build");
      this._buildProgress.set(null);
      this._isLoading.set(false);
      if (data.success) {
        this.addLearningEvent({
          type: "new_knowledge",
          description: `\u901A\u904E\u5C0D\u8A71\u69CB\u5EFA\u4E86 ${data.totalItems} \u689D\u77E5\u8B58`,
          details: { count: data.totalItems }
        });
        this.refreshStats();
        this._lastImportResult.set({
          success: true,
          totalItems: data.totalItems || 0,
          stats: data.stats || {},
          source: "conversation"
        });
        this.toastService.success(`\u2728 \u77E5\u8B58\u5927\u8166\u69CB\u5EFA\u5B8C\u6210\uFF01\u5171 ${data.totalItems} \u689D\u77E5\u8B58`);
      } else {
        this.toastService.error(`\u69CB\u5EFA\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
      }
    });
    this.ipcService.on("rag-url-imported", (data) => {
      console.log("[RAGBrain] URL imported:", data);
      this.completeRequest("import-url");
      this._isLoading.set(false);
      if (data.success) {
        this.addLearningEvent({
          type: "new_knowledge",
          description: `\u5F9E\u7DB2\u9801\u5C0E\u5165\u4E86 ${data.itemsCount} \u689D\u77E5\u8B58`,
          details: { count: data.itemsCount }
        });
        this.refreshStats();
        this.toastService.success(`\u{1F310} \u5DF2\u5F9E\u7DB2\u9801\u5C0E\u5165 ${data.itemsCount} \u689D\u77E5\u8B58`);
      } else {
        if (data.needsApiKey) {
          this.toastService.error(`\u26A0\uFE0F ${data.error}`, 8e3);
          this._lastError.set({
            type: "api_key_missing",
            message: data.error,
            action: "configure_ai"
          });
        } else {
          this.toastService.error(`\u5C0E\u5165\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
        }
      }
    });
    this.ipcService.on("rag-document-imported", (data) => {
      console.log("[RAGBrain] Document imported:", data);
      this.completeRequest("import-doc");
      this._isLoading.set(false);
      if (data.success) {
        this.addLearningEvent({
          type: "new_knowledge",
          description: `\u5F9E\u6587\u6A94\u5C0E\u5165\u4E86 ${data.itemsCount} \u689D\u77E5\u8B58`,
          details: { count: data.itemsCount }
        });
        this.refreshStats();
        this.toastService.success(`\u{1F4C4} \u5DF2\u5F9E\u6587\u6A94\u5C0E\u5165 ${data.itemsCount} \u689D\u77E5\u8B58`);
      } else {
        this.toastService.error(`\u5C0E\u5165\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
      }
    });
    this.ipcService.on("rag-gaps-list", (data) => {
      console.log("[RAGBrain] Gaps list:", data);
      if (data.success && data.gaps) {
        this._knowledgeGaps.set(data.gaps);
      }
    });
    this.ipcService.on("rag-gap-resolved", (data) => {
      console.log("[RAGBrain] Gap resolved:", data);
      if (data.success) {
        this._knowledgeGaps.update((gaps) => gaps.filter((g) => g.id !== data.gapId));
        this.toastService.success("\u2705 \u77E5\u8B58\u7F3A\u53E3\u5DF2\u89E3\u6C7A\uFF01");
        this.refreshStats();
      }
    });
    this.ipcService.on("rag-gap-ignored", (data) => {
      if (data.success) {
        this._knowledgeGaps.update((gaps) => gaps.filter((g) => g.id !== data.gapId));
      }
    });
    this.ipcService.on("rag-gap-suggestion", (data) => {
      console.log("[RAGBrain] Gap suggestion:", data);
      if (data.success && data.suggestedAnswer) {
        this._knowledgeGaps.update((gaps) => gaps.map((g) => g.id === data.gapId ? __spreadProps(__spreadValues({}, g), { suggestedAnswer: data.suggestedAnswer }) : g));
      }
    });
    this.ipcService.on("rag-health-report", (data) => {
      console.log("[RAGBrain] Health report:", data);
      if (data.success && data.report) {
        this._healthReport.set(data.report);
        this._healthScore.set(data.report.overallScore || 0);
      }
    });
    this.ipcService.on("rag-guided-question", (data) => {
      console.log("[RAGBrain] Guided question:", data);
      this.completeRequest("guided-build");
      this._isLoading.set(false);
      if (data.success) {
        this._guidedQuestion.set({
          step: data.step,
          totalSteps: data.totalSteps,
          title: data.title,
          question: data.question,
          type: data.type,
          options: data.options,
          placeholder: data.placeholder,
          suggestions: data.suggestions
        });
      } else {
        this.toastService.error(`\u5F15\u5C0E\u5F0F\u69CB\u5EFA\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
      }
    });
    this.ipcService.on("rag-error", (data) => {
      console.error("[RAGBrain] Error event:", data);
      this.cancelAllRequests();
      this._isLoading.set(false);
      this._buildProgress.set(null);
      this.toastService.error(`RAG \u932F\u8AA4: ${data.error || "\u64CD\u4F5C\u5931\u6557"}`);
    });
    this.ipcService.on("backend-status", (data) => {
      if (!data.running) {
        console.warn("[RAGBrain] Backend disconnected, resetting states");
        this.cancelAllRequests();
        this._isLoading.set(false);
        this._isInitialized.set(false);
        this._buildProgress.set(null);
      }
    });
  }
  // ==================== 公開方法 ====================
  /**
   * 初始化 RAG 系統
   */
  async initialize() {
    if (this._isInitialized())
      return;
    if (this._isLoading())
      return;
    console.log("[RAGBrain] Initializing...");
    this._isLoading.set(true);
    this.startRequestWithTimeout("initialize", 3e4);
    this.ipcService.send("rag-initialize", {
      useChromadb: true,
      useNeural: true
    });
  }
  /**
   * 刷新統計數據
   */
  refreshStats() {
    this.ipcService.send("rag-get-stats", {});
  }
  /**
   * 語義搜索知識
   */
  search(query, options) {
    if (this._isLoading())
      return;
    this._isLoading.set(true);
    this._searchResults.set([]);
    this.startRequestWithTimeout("search");
    this.ipcService.send("rag-search", {
      query,
      limit: options?.limit || 5,
      knowledgeType: options?.type,
      minScore: options?.minScore || 0.3
    });
  }
  /**
   * 🌟 對話式知識構建
   * 用戶只需描述業務，AI 自動生成完整知識庫
   */
  async buildFromConversation(request) {
    if (this._isLoading())
      return;
    this._isLoading.set(true);
    this._buildProgress.set({
      step: 1,
      totalSteps: 5,
      currentAction: "\u5206\u6790\u696D\u52D9\u63CF\u8FF0...",
      itemsGenerated: 0
    });
    this.startRequestWithTimeout("build", 12e4);
    this.ipcService.send("rag-build-from-conversation", request);
  }
  /**
   * 🌐 從 URL 導入知識
   */
  importFromUrl(url) {
    if (this._isLoading())
      return;
    this._isLoading.set(true);
    this.startRequestWithTimeout("import-url", 6e4);
    this.toastService.info("\u{1F50D} \u6B63\u5728\u89E3\u6790\u7DB2\u9801\u5167\u5BB9...");
    this.ipcService.send("rag-import-url", { url });
  }
  /**
   * 📄 從文檔導入知識
   */
  importFromDocument(filePath, fileType) {
    if (this._isLoading())
      return;
    this._isLoading.set(true);
    this.startRequestWithTimeout("import-doc", 6e4);
    this.toastService.info("\u{1F4D6} \u6B63\u5728\u89E3\u6790\u6587\u6A94...");
    this.ipcService.send("rag-import-document", { filePath, fileType });
  }
  /**
   * 手動添加知識
   */
  addKnowledge(type, question, answer, context) {
    this.ipcService.send("rag-add-knowledge", {
      knowledgeType: type,
      question,
      answer,
      context: context || ""
    });
  }
  /**
   * 記錄知識反饋
   */
  recordFeedback(knowledgeId, isPositive) {
    this.ipcService.send("rag-record-feedback", {
      knowledgeId,
      isPositive
    });
    this.addLearningEvent({
      type: "feedback",
      description: `\u6536\u5230${isPositive ? "\u6B63\u9762" : "\u8CA0\u9762"}\u53CD\u994B`,
      details: {}
    });
  }
  /**
   * 獲取最近知識列表
   */
  getRecentKnowledge(limit = 20) {
    this.ipcService.send("rag-get-recent", { limit });
  }
  /**
   * 清理低質量知識
   */
  cleanupLowQuality() {
    this.ipcService.send("rag-cleanup", {
      minScore: 0.2,
      minUses: 0,
      daysOld: 30
    });
  }
  /**
   * 合併相似知識
   */
  mergeSimilar() {
    this.ipcService.send("rag-merge-similar", {
      similarityThreshold: 0.9
    });
  }
  // ==================== 🆕 知識缺口管理 ====================
  /**
   * 獲取知識缺口列表
   */
  getKnowledgeGaps(minHits = 1) {
    this.ipcService.send("rag-get-gaps", {
      status: "pending",
      limit: 50,
      // 增加限制
      minHits
    });
  }
  /**
   * 解決知識缺口
   */
  resolveGap(gapId, knowledgeType, question, answer) {
    this.ipcService.send("rag-resolve-gap", {
      gapId,
      knowledgeType,
      question,
      answer
    });
  }
  /**
   * 忽略知識缺口
   */
  ignoreGap(gapId) {
    this.ipcService.send("rag-ignore-gap", { gapId });
  }
  /**
   * 🆕 刪除單條知識缺口（無需確認）
   */
  deleteGap(gapId) {
    this.ipcService.send("rag-delete-gap", { gapId });
    this._knowledgeGaps.update((gaps) => gaps.filter((g) => g.id !== gapId));
  }
  /**
   * 🆕 批量刪除知識缺口
   */
  deleteGapsBatch(gapIds) {
    this.ipcService.send("rag-delete-gaps-batch", { gapIds });
    this._knowledgeGaps.update((gaps) => gaps.filter((g) => !gapIds.includes(g.id)));
  }
  /**
   * 🆕 清理重複的知識缺口
   */
  cleanupDuplicateGaps() {
    this.ipcService.send("rag-cleanup-duplicate-gaps", {});
    setTimeout(() => this.getKnowledgeGaps(), 1e3);
  }
  /**
   * 請求 AI 生成缺口建議答案
   */
  suggestGapAnswer(gapId, query) {
    this.ipcService.send("rag-suggest-gap-answer", { gapId, query });
  }
  // ==================== 🆕 健康度報告 ====================
  /**
   * 獲取知識庫健康度報告
   */
  getHealthReport() {
    this.ipcService.send("rag-get-health-report", {});
  }
  // ==================== 🆕 引導式構建 ====================
  /**
   * 開始引導式多輪構建
   */
  startGuidedBuild() {
    if (this._isLoading())
      return;
    this._guidedAnswers.set({});
    this._isLoading.set(true);
    this.startRequestWithTimeout("guided-build", 3e4);
    this.ipcService.send("rag-start-guided-build", { step: 1, answers: {} });
  }
  /**
   * 回答引導式問題並進入下一步
   */
  answerGuidedQuestion(answer) {
    const currentQuestion = this._guidedQuestion();
    if (!currentQuestion)
      return;
    const stepKey = `step${currentQuestion.step}`;
    this._guidedAnswers.update((answers) => __spreadProps(__spreadValues({}, answers), {
      [stepKey]: answer
    }));
    const nextStep = currentQuestion.step + 1;
    this._isLoading.set(true);
    const timeout = nextStep > currentQuestion.totalSteps ? 12e4 : 3e4;
    this.startRequestWithTimeout("guided-build", timeout);
    if (nextStep <= currentQuestion.totalSteps) {
      this.ipcService.send("rag-start-guided-build", {
        step: nextStep,
        answers: this._guidedAnswers()
      });
    } else {
      this._guidedQuestion.set(null);
      this.ipcService.send("rag-start-guided-build", {
        step: nextStep,
        answers: this._guidedAnswers()
      });
    }
  }
  /**
   * 取消引導式構建
   */
  cancelGuidedBuild() {
    this.cancelRequest("guided-build");
    this._guidedQuestion.set(null);
    this._guidedAnswers.set({});
    this._isLoading.set(false);
  }
  // ==================== 輔助方法 ====================
  addLearningEvent(event) {
    const newEvent = __spreadValues({
      id: `event_${Date.now()}`,
      timestamp: (/* @__PURE__ */ new Date()).toISOString()
    }, event);
    this._learningEvents.update((events) => [newEvent, ...events].slice(0, 50));
  }
  calculateHealthScore() {
    const stats = this._stats();
    if (!stats) {
      this._healthScore.set(0);
      return;
    }
    let score = 0;
    score += Math.min(25, stats.totalKnowledge * 0.5);
    score += stats.avgScore * 25;
    const useRate = stats.totalUses / Math.max(1, stats.totalKnowledge);
    score += Math.min(25, useRate * 5);
    const typeCount = Object.keys(stats.byType).length;
    score += Math.min(25, typeCount * 5);
    this._healthScore.set(Math.round(score));
  }
  mapSearchResult(data) {
    return {
      item: {
        id: data.item.id,
        type: data.item.knowledge_type || data.item.type,
        question: data.item.question,
        answer: data.item.answer,
        context: data.item.context,
        keywords: data.item.keywords || [],
        successScore: data.item.success_score || data.item.successScore || 0.5,
        useCount: data.item.use_count || data.item.useCount || 0,
        feedbackPositive: data.item.feedback_positive || 0,
        feedbackNegative: data.item.feedback_negative || 0,
        createdAt: data.item.created_at || data.item.createdAt || "",
        updatedAt: data.item.updated_at || data.item.updatedAt || ""
      },
      similarity: data.similarity,
      source: data.source
    };
  }
  mapStats(data) {
    return {
      totalKnowledge: data.total_knowledge || data.totalKnowledge || 0,
      totalUses: data.total_uses || data.totalUses || 0,
      avgScore: data.avg_score || data.avgScore || 0,
      byType: data.by_type || data.byType || {},
      vectorCount: data.vector_count || data.vectorCount,
      chromadbEnabled: data.chromadb_enabled ?? data.chromadbEnabled ?? false,
      neuralEmbedding: data.neural_embedding ?? data.neuralEmbedding ?? false,
      learning: data.learning ? {
        sessionsProcessed: data.learning.sessions_processed || 0,
        totalQaExtracted: data.learning.total_qa_extracted || 0,
        totalScriptsExtracted: data.learning.total_scripts_extracted || 0,
        avgQualityScore: data.learning.avg_quality_score || 0
      } : void 0
    };
  }
  getTypeName(type) {
    const names = {
      "qa": "\u554F\u7B54",
      "script": "\u8A71\u8853",
      "product": "\u7522\u54C1",
      "objection": "\u7570\u8B70\u8655\u7406",
      "greeting": "\u958B\u5834\u767D",
      "closing": "\u6210\u4EA4",
      "faq": "FAQ",
      "custom": "\u81EA\u5B9A\u7FA9"
    };
    return names[type] || type;
  }
  static {
    this.\u0275fac = function RAGBrainService_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _RAGBrainService)(\u0275\u0275inject(ElectronIpcService), \u0275\u0275inject(ToastService));
    };
  }
  static {
    this.\u0275prov = /* @__PURE__ */ \u0275\u0275defineInjectable({ token: _RAGBrainService, factory: _RAGBrainService.\u0275fac, providedIn: "root" });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(RAGBrainService, [{
    type: Injectable,
    args: [{ providedIn: "root" }]
  }], () => [{ type: ElectronIpcService }, { type: ToastService }], null);
})();

// src/ai-center/ai-brain.component.ts
var _forTrack020 = ($index, $item) => $item.item.id;
var _forTrack17 = ($index, $item) => $item.id;
var _forTrack24 = ($index, $item) => $item.message;
var _forTrack3 = ($index, $item) => $item.name;
function AIBrainComponent_div_1_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 52);
    \u0275\u0275listener("click", function AIBrainComponent_div_1_Conditional_7_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.scrollToGaps());
    });
    \u0275\u0275elementStart(1, "span", 53);
    \u0275\u0275text(2, "\u{1F534}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 54);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "span", 55);
    \u0275\u0275text(6, "\u7ACB\u5373\u8655\u7406 \u2192");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate1("", ctx_r1.ragService.gapsCount(), " \u500B\u77E5\u8B58\u7F3A\u53E3\u5F85\u8655\u7406");
  }
}
function AIBrainComponent_div_1_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 50)(1, "span", 56);
    \u0275\u0275text(2, "\u{1F7E1}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 54);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "span", 55);
    \u0275\u0275text(6, "\u512A\u5316 \u2192");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate1("\u77E5\u8B58\u5EAB\u5065\u5EB7\u5EA6\u504F\u4F4E (", ctx_r1.ragService.healthScore(), "%)");
  }
}
function AIBrainComponent_div_1_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 57);
    \u0275\u0275listener("click", function AIBrainComponent_div_1_Conditional_9_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.focusBuildInput());
    });
    \u0275\u0275elementStart(1, "span", 58);
    \u0275\u0275text(2, "\u{1F7E2}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 54);
    \u0275\u0275text(4, "\u5EFA\u8B70\u6DFB\u52A0\u66F4\u591A\u77E5\u8B58");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "span", 55);
    \u0275\u0275text(6, "\u958B\u59CB \u2192");
    \u0275\u0275elementEnd()();
  }
}
function AIBrainComponent_div_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 45)(1, "div", 46)(2, "span", 47);
    \u0275\u0275text(3, "\u{1F4CC}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span");
    \u0275\u0275text(5, "\u4ECA\u65E5\u5F85\u8FA6");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div", 48);
    \u0275\u0275conditionalCreate(7, AIBrainComponent_div_1_Conditional_7_Template, 7, 1, "div", 49);
    \u0275\u0275conditionalCreate(8, AIBrainComponent_div_1_Conditional_8_Template, 7, 1, "div", 50);
    \u0275\u0275conditionalCreate(9, AIBrainComponent_div_1_Conditional_9_Template, 7, 0, "div", 51);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(7);
    \u0275\u0275conditional(ctx_r1.ragService.gapsCount() > 0 ? 7 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.ragService.healthScore() < 60 ? 8 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r1.ragService.totalKnowledge() < 10 ? 9 : -1);
  }
}
function AIBrainComponent_Conditional_42_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 19)(1, "div", 59);
    \u0275\u0275element(2, "div", 60);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 61);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const progress_r4 = ctx;
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("width", progress_r4.step / progress_r4.totalSteps * 100, "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2(" ", progress_r4.currentAction, " (", progress_r4.itemsGenerated, " \u689D) ");
  }
}
function AIBrainComponent_Conditional_44_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "span", 62);
    \u0275\u0275text(1, " \u69CB\u5EFA\u4E2D... ");
  }
}
function AIBrainComponent_Conditional_45_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 14);
    \u0275\u0275text(1, "\u2728");
    \u0275\u0275elementEnd();
    \u0275\u0275text(2, " \u4E00\u9375\u69CB\u5EFA\u77E5\u8B58\u5EAB ");
  }
}
function AIBrainComponent_Conditional_46_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 63);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_46_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.cancelCurrentRequest());
    });
    \u0275\u0275text(1, " \u2715 \u53D6\u6D88 ");
    \u0275\u0275elementEnd();
  }
}
function AIBrainComponent_Conditional_77_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 31);
    \u0275\u0275element(1, "span", 62);
    \u0275\u0275text(2, " \u6B63\u5728\u641C\u7D22... ");
    \u0275\u0275elementStart(3, "button", 64);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_77_Template_button_click_3_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.cancelCurrentRequest());
    });
    \u0275\u0275text(4, "\u53D6\u6D88");
    \u0275\u0275elementEnd()();
  }
}
function AIBrainComponent_Conditional_78_For_1_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 66)(1, "div", 67)(2, "span", 68);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span", 69);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div", 70);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 71);
    \u0275\u0275text(9);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "div", 72)(11, "button", 73);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_78_For_1_Template_button_click_11_listener() {
      const result_r8 = \u0275\u0275restoreView(_r7).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.recordFeedback(result_r8.item.id, true));
    });
    \u0275\u0275text(12, " \u{1F44D} \u6709\u7528 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "button", 74);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_78_For_1_Template_button_click_13_listener() {
      const result_r8 = \u0275\u0275restoreView(_r7).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.recordFeedback(result_r8.item.id, false));
    });
    \u0275\u0275text(14, " \u{1F44E} \u7121\u7528 ");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const result_r8 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275classProp("high-match", result_r8.similarity >= 0.8);
    \u0275\u0275advance(2);
    \u0275\u0275attribute("data-type", result_r8.item.type);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.getTypeName(result_r8.item.type), " ");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" \u5339\u914D\u5EA6: ", (result_r8.similarity * 100).toFixed(0), "% ");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(result_r8.item.question);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(result_r8.item.answer);
  }
}
function AIBrainComponent_Conditional_78_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275repeaterCreate(0, AIBrainComponent_Conditional_78_For_1_Template, 15, 7, "div", 65, _forTrack020);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275repeater(ctx_r1.ragService.searchResults());
  }
}
function AIBrainComponent_Conditional_79_Template(rf, ctx) {
  if (rf & 1) {
    const _r9 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 32)(1, "span", 14);
    \u0275\u0275text(2, "\u{1F50D}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p");
    \u0275\u0275text(4, "\u672A\u627E\u5230\u76F8\u95DC\u77E5\u8B58");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "button", 75);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_79_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r9);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.addNewKnowledge());
    });
    \u0275\u0275text(6, "\u6DFB\u52A0\u9019\u689D\u77E5\u8B58");
    \u0275\u0275elementEnd()();
  }
}
function AIBrainComponent_Conditional_80_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 33)(1, "span", 14);
    \u0275\u0275text(2, "\u{1F4A1}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p");
    \u0275\u0275text(4, "\u8F38\u5165\u554F\u984C\uFF0CAI \u6703\u7528\u8A9E\u7FA9\u7406\u89E3\u627E\u5230\u6700\u76F8\u95DC\u7684\u77E5\u8B58");
    \u0275\u0275elementEnd()();
  }
}
function AIBrainComponent_Conditional_89_For_1_Case_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u{1F4DA} ");
  }
}
function AIBrainComponent_Conditional_89_For_1_Case_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u{1F4AC} ");
  }
}
function AIBrainComponent_Conditional_89_For_1_Case_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u{1F44D} ");
  }
}
function AIBrainComponent_Conditional_89_For_1_Case_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u{1F4C8} ");
  }
}
function AIBrainComponent_Conditional_89_For_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 76)(1, "div", 77);
    \u0275\u0275conditionalCreate(2, AIBrainComponent_Conditional_89_For_1_Case_2_Template, 1, 0)(3, AIBrainComponent_Conditional_89_For_1_Case_3_Template, 1, 0)(4, AIBrainComponent_Conditional_89_For_1_Case_4_Template, 1, 0)(5, AIBrainComponent_Conditional_89_For_1_Case_5_Template, 1, 0);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "div", 78)(7, "div", 79);
    \u0275\u0275text(8);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "div", 80);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    let tmp_12_0;
    const event_r10 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275attribute("data-type", event_r10.type);
    \u0275\u0275advance(2);
    \u0275\u0275conditional((tmp_12_0 = event_r10.type) === "new_knowledge" ? 2 : tmp_12_0 === "auto_learn" ? 3 : tmp_12_0 === "feedback" ? 4 : tmp_12_0 === "quality_update" ? 5 : -1);
    \u0275\u0275advance(6);
    \u0275\u0275textInterpolate(event_r10.description);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r1.formatTime(event_r10.timestamp));
  }
}
function AIBrainComponent_Conditional_89_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275repeaterCreate(0, AIBrainComponent_Conditional_89_For_1_Template, 11, 4, "div", 76, _forTrack17);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275repeater(ctx_r1.ragService.learningEvents().slice(0, 10));
  }
}
function AIBrainComponent_Conditional_90_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 37)(1, "p");
    \u0275\u0275text(2, "\u7B49\u5F85\u5B78\u7FD2\u4E8B\u4EF6...");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 81);
    \u0275\u0275text(4, "AI \u6703\u5F9E\u5C0D\u8A71\u4E2D\u81EA\u52D5\u5B78\u7FD2");
    \u0275\u0275elementEnd()();
  }
}
function AIBrainComponent_Conditional_101_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    const _r12 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 91);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_101_Conditional_11_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r12);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.deleteSelectedGaps());
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (", ctx_r1.selectedGapIds().length, ") ");
  }
}
function AIBrainComponent_Conditional_101_For_16_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 99);
    \u0275\u0275text(1, "\u{1F525} \u71B1\u9580");
    \u0275\u0275elementEnd();
  }
}
function AIBrainComponent_Conditional_101_For_16_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 107);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const gap_r14 = \u0275\u0275nextContext().$implicit;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275classMap("cat-" + gap_r14.category);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.getCategoryLabel(gap_r14.category), " ");
  }
}
function AIBrainComponent_Conditional_101_For_16_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 102)(1, "span", 108);
    \u0275\u0275text(2, "\u{1F4A1} AI:");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 109);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const gap_r14 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(gap_r14.suggestedAnswer.length > 80 ? gap_r14.suggestedAnswer.slice(0, 80) + "..." : gap_r14.suggestedAnswer);
  }
}
function AIBrainComponent_Conditional_101_For_16_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    const _r15 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 110);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_101_For_16_Conditional_14_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r15);
      const gap_r14 = \u0275\u0275nextContext().$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.suggestAnswer(gap_r14));
    });
    \u0275\u0275text(1, " \u{1F916} \u751F\u6210 ");
    \u0275\u0275elementEnd();
  }
}
function AIBrainComponent_Conditional_101_For_16_Template(rf, ctx) {
  if (rf & 1) {
    const _r13 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 92)(1, "div", 93)(2, "input", 94);
    \u0275\u0275listener("change", function AIBrainComponent_Conditional_101_For_16_Template_input_change_2_listener() {
      const gap_r14 = \u0275\u0275restoreView(_r13).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.toggleGapSelection(gap_r14.id));
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(3, "div", 95)(4, "div", 96)(5, "span", 97);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div", 98);
    \u0275\u0275conditionalCreate(8, AIBrainComponent_Conditional_101_For_16_Conditional_8_Template, 2, 0, "span", 99);
    \u0275\u0275conditionalCreate(9, AIBrainComponent_Conditional_101_For_16_Conditional_9_Template, 2, 3, "span", 100);
    \u0275\u0275elementStart(10, "span", 101);
    \u0275\u0275text(11);
    \u0275\u0275elementEnd()()();
    \u0275\u0275conditionalCreate(12, AIBrainComponent_Conditional_101_For_16_Conditional_12_Template, 5, 1, "div", 102);
    \u0275\u0275elementStart(13, "div", 103);
    \u0275\u0275conditionalCreate(14, AIBrainComponent_Conditional_101_For_16_Conditional_14_Template, 2, 0, "button", 104);
    \u0275\u0275elementStart(15, "button", 105);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_101_For_16_Template_button_click_15_listener() {
      const gap_r14 = \u0275\u0275restoreView(_r13).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.resolveGap(gap_r14));
    });
    \u0275\u0275text(16, " \u2705 \u63A1\u7528 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(17, "button", 106);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_101_For_16_Template_button_click_17_listener() {
      const gap_r14 = \u0275\u0275restoreView(_r13).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.deleteGap(gap_r14));
    });
    \u0275\u0275text(18, " \u{1F5D1}\uFE0F ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const gap_r14 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275classProp("selected", ctx_r1.isGapSelected(gap_r14.id));
    \u0275\u0275advance(2);
    \u0275\u0275property("checked", ctx_r1.isGapSelected(gap_r14.id));
    \u0275\u0275advance(3);
    \u0275\u0275property("title", gap_r14.query);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", gap_r14.query.length > 60 ? gap_r14.query.slice(0, 60) + "..." : gap_r14.query, " ");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(gap_r14.hitCount >= 5 ? 8 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(gap_r14.category ? 9 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("", gap_r14.hitCount, "\u6B21");
    \u0275\u0275advance();
    \u0275\u0275conditional(gap_r14.suggestedAnswer ? 12 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(!gap_r14.suggestedAnswer ? 14 : -1);
  }
}
function AIBrainComponent_Conditional_101_Conditional_17_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 90)(1, "span");
    \u0275\u0275text(2);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u9084\u6709 ", ctx_r1.ragService.gapsCount() - 15, " \u689D\u672A\u986F\u793A");
  }
}
function AIBrainComponent_Conditional_101_Template(rf, ctx) {
  if (rf & 1) {
    const _r11 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 41)(1, "div", 82)(2, "h3", 13)(3, "span", 14);
    \u0275\u0275text(4, "\u{1F514}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(5, " \u77E5\u8B58\u7F3A\u53E3 ");
    \u0275\u0275elementStart(6, "span", 83);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(8, "div", 84)(9, "button", 85);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_101_Template_button_click_9_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.cleanupDuplicateGaps());
    });
    \u0275\u0275text(10, " \u{1F9F9} \u6DF1\u5EA6\u6E05\u7406 ");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(11, AIBrainComponent_Conditional_101_Conditional_11_Template, 2, 1, "button", 86);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(12, "p", 87);
    \u0275\u0275text(13, "\u{1F4A1} \u7528\u6236\u554F\u4E86\u4F46\u77E5\u8B58\u5EAB\u6C92\u6709\u597D\u7B54\u6848\u7684\u554F\u984C\uFF0C\u5EFA\u8B70\u512A\u5148\u8655\u7406\u71B1\u9580\u554F\u984C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "div", 88);
    \u0275\u0275repeaterCreate(15, AIBrainComponent_Conditional_101_For_16_Template, 19, 10, "div", 89, _forTrack17);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(17, AIBrainComponent_Conditional_101_Conditional_17_Template, 3, 1, "div", 90);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(7);
    \u0275\u0275textInterpolate1("(", ctx_r1.ragService.gapsCount(), ")");
    \u0275\u0275advance(4);
    \u0275\u0275conditional(ctx_r1.selectedGapIds().length > 0 ? 11 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275repeater(ctx_r1.ragService.knowledgeGaps().slice(0, 15));
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.ragService.gapsCount() > 15 ? 17 : -1);
  }
}
function AIBrainComponent_Conditional_102_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 42)(1, "span", 111);
    \u0275\u0275text(2, "\u2728");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p");
    \u0275\u0275text(4, "\u77E5\u8B58\u5EAB\u8986\u84CB\u826F\u597D\uFF0C\u66AB\u7121\u77E5\u8B58\u7F3A\u53E3");
    \u0275\u0275elementEnd()();
  }
}
function AIBrainComponent_Conditional_103_Conditional_0_Conditional_33_For_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 124)(1, "span", 125);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const suggestion_r16 = ctx.$implicit;
    \u0275\u0275attribute("data-priority", suggestion_r16.priority);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(suggestion_r16.priority === "high" ? "\u{1F534}" : suggestion_r16.priority === "medium" ? "\u{1F7E1}" : "\u{1F7E2}");
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", suggestion_r16.message, " ");
  }
}
function AIBrainComponent_Conditional_103_Conditional_0_Conditional_33_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 123)(1, "h4");
    \u0275\u0275text(2, "\u{1F4A1} \u512A\u5316\u5EFA\u8B70");
    \u0275\u0275elementEnd();
    \u0275\u0275repeaterCreate(3, AIBrainComponent_Conditional_103_Conditional_0_Conditional_33_For_4_Template, 4, 3, "div", 124, _forTrack24);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const report_r17 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(3);
    \u0275\u0275repeater(report_r17.suggestions);
  }
}
function AIBrainComponent_Conditional_103_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 112)(1, "h3", 13)(2, "span", 14);
    \u0275\u0275text(3, "\u{1F4CA}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(4, " \u77E5\u8B58\u5EAB\u5065\u5EB7\u5EA6\u5831\u544A ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "div", 113)(6, "div", 114)(7, "span", 115);
    \u0275\u0275text(8);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "span", 116);
    \u0275\u0275text(10, "\u7E3D\u5206");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(11, "div", 117)(12, "div", 118)(13, "span", 119);
    \u0275\u0275text(14, "\u5B8C\u6574\u6027");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "div", 120);
    \u0275\u0275element(16, "div", 121);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(17, "span", 122);
    \u0275\u0275text(18);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(19, "div", 118)(20, "span", 119);
    \u0275\u0275text(21, "\u6548\u679C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(22, "div", 120);
    \u0275\u0275element(23, "div", 121);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(24, "span", 122);
    \u0275\u0275text(25);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(26, "div", 118)(27, "span", 119);
    \u0275\u0275text(28, "\u6642\u6548\u6027");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(29, "div", 120);
    \u0275\u0275element(30, "div", 121);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(31, "span", 122);
    \u0275\u0275text(32);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275conditionalCreate(33, AIBrainComponent_Conditional_103_Conditional_0_Conditional_33_Template, 5, 0, "div", 123);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const report_r17 = \u0275\u0275nextContext();
    \u0275\u0275advance(6);
    \u0275\u0275classProp("healthy", report_r17.overallScore >= 70)("warning", report_r17.overallScore >= 40 && report_r17.overallScore < 70)("danger", report_r17.overallScore < 40);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(report_r17.overallScore);
    \u0275\u0275advance(8);
    \u0275\u0275styleProp("width", (report_r17.completeness == null ? null : report_r17.completeness.score) || 0, "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("", (report_r17.completeness == null ? null : report_r17.completeness.score) || 0, "%");
    \u0275\u0275advance(5);
    \u0275\u0275styleProp("width", (report_r17.effectiveness == null ? null : report_r17.effectiveness.score) || 0, "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("", (report_r17.effectiveness == null ? null : report_r17.effectiveness.score) || 0, "%");
    \u0275\u0275advance(5);
    \u0275\u0275styleProp("width", (report_r17.freshness == null ? null : report_r17.freshness.score) || 0, "%");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("", (report_r17.freshness == null ? null : report_r17.freshness.score) || 0, "%");
    \u0275\u0275advance();
    \u0275\u0275conditional(report_r17.suggestions && report_r17.suggestions.length > 0 ? 33 : -1);
  }
}
function AIBrainComponent_Conditional_103_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275conditionalCreate(0, AIBrainComponent_Conditional_103_Conditional_0_Template, 34, 17, "div", 112);
  }
  if (rf & 2) {
    \u0275\u0275conditional(ctx.overallScore !== void 0 ? 0 : -1);
  }
}
function AIBrainComponent_Conditional_104_For_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 127)(1, "div", 128);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 129)(4, "span", 130);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "span", 131);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(8, "div", 132);
    \u0275\u0275element(9, "div", 121);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const type_r18 = ctx.$implicit;
    const stats_r19 = \u0275\u0275nextContext();
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(type_r18.name);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("", type_r18.count, " \u689D");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u8A55\u5206: ", type_r18.avgScore);
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("width", type_r18.count / stats_r19.totalKnowledge * 100, "%")("background", ctx_r1.getTypeColor(type_r18.key));
  }
}
function AIBrainComponent_Conditional_104_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 43)(1, "h3");
    \u0275\u0275text(2, "\u77E5\u8B58\u5206\u5E03");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 126);
    \u0275\u0275repeaterCreate(4, AIBrainComponent_Conditional_104_For_5_Template, 10, 7, "div", 127, _forTrack3);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(4);
    \u0275\u0275repeater(ctx_r1.getStatTypes(ctx.byType));
  }
}
function AIBrainComponent_Conditional_105_Case_12_For_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r21 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 145);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_105_Case_12_For_2_Template_button_click_0_listener() {
      const opt_r22 = \u0275\u0275restoreView(_r21).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.guidedAnswer = opt_r22.id);
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const opt_r22 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275classProp("selected", ctx_r1.guidedAnswer === opt_r22.id);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", opt_r22.label, " ");
  }
}
function AIBrainComponent_Conditional_105_Case_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 139);
    \u0275\u0275repeaterCreate(1, AIBrainComponent_Conditional_105_Case_12_For_2_Template, 2, 3, "button", 144, _forTrack17);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const question_r23 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275repeater(question_r23.options);
  }
}
function AIBrainComponent_Conditional_105_Case_13_For_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r24 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 145);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_105_Case_13_For_2_Template_button_click_0_listener() {
      const opt_r25 = \u0275\u0275restoreView(_r24).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r1.toggleOption(opt_r25.id));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const opt_r25 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(3);
    \u0275\u0275classProp("selected", ctx_r1.isOptionSelected(opt_r25.id));
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", opt_r25.label, " ");
  }
}
function AIBrainComponent_Conditional_105_Case_13_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 140);
    \u0275\u0275repeaterCreate(1, AIBrainComponent_Conditional_105_Case_13_For_2_Template, 2, 3, "button", 144, _forTrack17);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const question_r23 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275repeater(question_r23.options);
  }
}
function AIBrainComponent_Conditional_105_Case_14_Conditional_1_For_4_Template(rf, ctx) {
  if (rf & 1) {
    const _r27 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 150);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_105_Case_14_Conditional_1_For_4_Template_button_click_0_listener() {
      const s_r28 = \u0275\u0275restoreView(_r27).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r1.addSuggestion(s_r28));
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const s_r28 = ctx.$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(s_r28);
  }
}
function AIBrainComponent_Conditional_105_Case_14_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 147)(1, "span", 148);
    \u0275\u0275text(2, "\u5E38\u898B:");
    \u0275\u0275elementEnd();
    \u0275\u0275repeaterCreate(3, AIBrainComponent_Conditional_105_Case_14_Conditional_1_For_4_Template, 2, 1, "button", 149, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const question_r23 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(3);
    \u0275\u0275repeater(question_r23.suggestions);
  }
}
function AIBrainComponent_Conditional_105_Case_14_Template(rf, ctx) {
  if (rf & 1) {
    const _r26 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "textarea", 146);
    \u0275\u0275twoWayListener("ngModelChange", function AIBrainComponent_Conditional_105_Case_14_Template_textarea_ngModelChange_0_listener($event) {
      \u0275\u0275restoreView(_r26);
      const ctx_r1 = \u0275\u0275nextContext(2);
      \u0275\u0275twoWayBindingSet(ctx_r1.guidedAnswer, $event) || (ctx_r1.guidedAnswer = $event);
      return \u0275\u0275resetView($event);
    });
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(1, AIBrainComponent_Conditional_105_Case_14_Conditional_1_Template, 5, 0, "div", 147);
  }
  if (rf & 2) {
    const question_r23 = \u0275\u0275nextContext();
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275twoWayProperty("ngModel", ctx_r1.guidedAnswer);
    \u0275\u0275property("placeholder", question_r23.placeholder || "");
    \u0275\u0275advance();
    \u0275\u0275conditional(question_r23.suggestions && question_r23.suggestions.length ? 1 : -1);
  }
}
function AIBrainComponent_Conditional_105_Conditional_19_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u4E0B\u4E00\u6B65 \u2192 ");
  }
}
function AIBrainComponent_Conditional_105_Conditional_20_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u958B\u59CB\u69CB\u5EFA \u2728 ");
  }
}
function AIBrainComponent_Conditional_105_Template(rf, ctx) {
  if (rf & 1) {
    const _r20 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 44)(1, "div", 133)(2, "div", 134)(3, "span", 135);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "h3");
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "button", 136);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_105_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r20);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.cancelGuidedBuild());
    });
    \u0275\u0275text(8, "\u2715");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(9, "div", 137)(10, "p", 138);
    \u0275\u0275text(11);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(12, AIBrainComponent_Conditional_105_Case_12_Template, 3, 0, "div", 139)(13, AIBrainComponent_Conditional_105_Case_13_Template, 3, 0, "div", 140)(14, AIBrainComponent_Conditional_105_Case_14_Template, 2, 3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "div", 141)(16, "button", 142);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_105_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r20);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.cancelGuidedBuild());
    });
    \u0275\u0275text(17, "\u53D6\u6D88");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "button", 143);
    \u0275\u0275listener("click", function AIBrainComponent_Conditional_105_Template_button_click_18_listener() {
      \u0275\u0275restoreView(_r20);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.submitGuidedAnswer());
    });
    \u0275\u0275conditionalCreate(19, AIBrainComponent_Conditional_105_Conditional_19_Template, 1, 0)(20, AIBrainComponent_Conditional_105_Conditional_20_Template, 1, 0);
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    let tmp_5_0;
    const question_r23 = ctx;
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate2("\u6B65\u9A5F ", question_r23.step, " / ", question_r23.totalSteps);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(question_r23.title);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(question_r23.question);
    \u0275\u0275advance();
    \u0275\u0275conditional((tmp_5_0 = question_r23.type) === "select" ? 12 : tmp_5_0 === "multiselect" ? 13 : tmp_5_0 === "textarea" ? 14 : -1);
    \u0275\u0275advance(6);
    \u0275\u0275property("disabled", !ctx_r1.guidedAnswer || ctx_r1.ragService.isLoading());
    \u0275\u0275advance();
    \u0275\u0275conditional(question_r23.step < question_r23.totalSteps ? 19 : 20);
  }
}
var AIBrainComponent = class _AIBrainComponent {
  constructor() {
    this.ragService = inject(RAGBrainService);
    this.dialogService = inject(DialogService);
    this.toastService = inject(ToastService);
    this.businessDescription = "";
    this.searchQuery = "";
    this.guidedAnswer = "";
    this.selectedOptions = [];
    this.selectedGapIds = signal([], ...ngDevMode ? [{ debugName: "selectedGapIds" }] : []);
  }
  ngOnInit() {
    this.ragService.initialize();
    this.ragService.refreshStats();
    this.ragService.getKnowledgeGaps();
    this.ragService.getHealthReport();
  }
  // 🆕 P1-3: 批量選擇方法
  isGapSelected(gapId) {
    return this.selectedGapIds().includes(gapId);
  }
  toggleGapSelection(gapId) {
    const current = this.selectedGapIds();
    if (current.includes(gapId)) {
      this.selectedGapIds.set(current.filter((id) => id !== gapId));
    } else {
      this.selectedGapIds.set([...current, gapId]);
    }
  }
  deleteSelectedGaps() {
    const ids = this.selectedGapIds();
    if (ids.length === 0)
      return;
    this.ragService.deleteGapsBatch(ids);
    this.selectedGapIds.set([]);
    this.toastService.success(`\u5DF2\u522A\u9664 ${ids.length} \u689D\u7F3A\u53E3`);
  }
  // 🆕 P1-1: 分類標籤
  getCategoryLabel(category) {
    const labels = {
      "price": "\u{1F4B0} \u50F9\u683C",
      "process": "\u{1F4CB} \u6D41\u7A0B",
      "product": "\u{1F4E6} \u7522\u54C1",
      "support": "\u{1F6E0}\uFE0F \u552E\u5F8C",
      "other": "\u2753 \u5176\u4ED6"
    };
    return labels[category] || category;
  }
  // 🆕 P1-2: 任務驅動式方法
  hasPendingTasks() {
    return this.ragService.gapsCount() > 0 || this.ragService.healthScore() < 60 || this.ragService.totalKnowledge() < 10;
  }
  scrollToGaps() {
    const gapsSection = document.querySelector(".gaps-section");
    if (gapsSection) {
      gapsSection.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  }
  focusBuildInput() {
    const input2 = document.querySelector(".build-textarea");
    if (input2) {
      input2.focus();
      input2.scrollIntoView({ behavior: "smooth", block: "center" });
    }
  }
  // ==================== 構建方法 ====================
  async startBuild() {
    if (!this.businessDescription.trim())
      return;
    await this.ragService.buildFromConversation({
      businessDescription: this.businessDescription
    });
  }
  importFromUrl() {
    const lastError = this.ragService.lastError();
    if (lastError?.type === "api_key_missing") {
      this.ragService.clearLastError?.();
    }
    this.dialogService.prompt({
      title: "\u5F9E\u7DB2\u9801\u5C0E\u5165\u77E5\u8B58",
      message: "\u8F38\u5165\u7DB2\u9801 URL\uFF0CAI \u6703\u81EA\u52D5\u63D0\u53D6\u77E5\u8B58\uFF1A\n\n\u{1F4A1} \u63D0\u793A\uFF1A\u9700\u8981\u5148\u5728\u300CAI \u4E2D\u5FC3\u300D\u2192\u300C\u6A21\u578B\u8A2D\u5B9A\u300D\u914D\u7F6E AI API Key",
      placeholder: "https://example.com/about",
      confirmText: "\u5C0E\u5165",
      onConfirm: (url) => {
        if (url) {
          this.ragService.importFromUrl(url);
        }
      }
    });
  }
  importFromDocument() {
    const input2 = document.createElement("input");
    input2.type = "file";
    input2.accept = ".txt,.pdf,.doc,.docx";
    input2.onchange = (e) => {
      const file = e.target.files?.[0];
      if (file) {
        const ext = file.name.split(".").pop() || "";
        this.toastService.info(`\u9078\u64C7\u4E86\u6587\u4EF6: ${file.name}\uFF0C\u6B63\u5728\u8655\u7406...`);
      }
    };
    input2.click();
  }
  openTemplateSelector() {
    this.dialogService.prompt({
      title: "\u9078\u64C7\u884C\u696D\u6A21\u677F",
      message: "\u8F38\u5165\u884C\u696D\u985E\u578B\uFF08payment/ecommerce/education/realestate/finance/healthcare/travel/legal\uFF09\uFF1A",
      placeholder: "payment",
      confirmText: "\u61C9\u7528",
      onConfirm: (templateId) => {
        if (templateId) {
          this.toastService.info(`\u6B63\u5728\u61C9\u7528\u300C${templateId}\u300D\u6A21\u677F...`);
        }
      }
    });
  }
  // ==================== 搜索方法 ====================
  search() {
    if (!this.searchQuery.trim())
      return;
    this.ragService.search(this.searchQuery);
  }
  recordFeedback(knowledgeId, isPositive) {
    this.ragService.recordFeedback(knowledgeId, isPositive);
    this.toastService.success(isPositive ? "\u611F\u8B1D\u60A8\u7684\u53CD\u994B\uFF01" : "\u5DF2\u8A18\u9304\uFF0C\u6211\u5011\u6703\u6539\u9032");
  }
  addNewKnowledge() {
    this.dialogService.prompt({
      title: "\u6DFB\u52A0\u65B0\u77E5\u8B58",
      message: "\u8F38\u5165\u56DE\u7B54\u5167\u5BB9\uFF1A",
      placeholder: "\u5C08\u696D\u7684\u56DE\u7B54...",
      confirmText: "\u6DFB\u52A0",
      onConfirm: (answer) => {
        if (answer) {
          this.ragService.addKnowledge("qa", this.searchQuery, answer);
        }
      }
    });
  }
  // ==================== 維護方法 ====================
  cleanupKnowledge() {
    this.dialogService.confirm({
      title: "\u6E05\u7406\u4F4E\u8CEA\u91CF\u77E5\u8B58",
      message: "\u5C07\u522A\u9664\u8A55\u5206\u4F4E\u65BC 0.2 \u4E14\u672A\u88AB\u4F7F\u7528\u7684\u820A\u77E5\u8B58\uFF0C\u78BA\u8A8D\u7E7C\u7E8C\uFF1F",
      confirmText: "\u6E05\u7406",
      type: "warning",
      onConfirm: () => {
        this.ragService.cleanupLowQuality();
        this.toastService.info("\u6B63\u5728\u6E05\u7406...");
      }
    });
  }
  mergeKnowledge() {
    this.ragService.mergeSimilar();
    this.toastService.info("\u6B63\u5728\u5408\u4F75\u76F8\u4F3C\u77E5\u8B58...");
  }
  refreshStats() {
    this.ragService.refreshStats();
    this.toastService.success("\u5DF2\u5237\u65B0\u7D71\u8A08");
  }
  /**
   * 🔧 P1: 取消當前請求
   */
  cancelCurrentRequest() {
    this.ragService.cancelCurrentRequest();
  }
  // ==================== 輔助方法 ====================
  getTypeName(type) {
    const names = {
      "qa": "\u554F\u7B54",
      "script": "\u8A71\u8853",
      "product": "\u7522\u54C1",
      "objection": "\u7570\u8B70\u8655\u7406",
      "greeting": "\u958B\u5834\u767D",
      "closing": "\u6210\u4EA4",
      "faq": "FAQ",
      "custom": "\u81EA\u5B9A\u7FA9"
    };
    return names[type] || type;
  }
  getTypeColor(type) {
    const colors = {
      "Q&A \u554F\u7B54": "#667eea",
      "\u6210\u529F\u8A71\u8853": "#10b981",
      "\u7522\u54C1\u4FE1\u606F": "#f59e0b",
      "\u7570\u8B70\u8655\u7406": "#ef4444",
      "\u958B\u5834\u767D": "#8b5cf6",
      "\u6210\u4EA4\u8A71\u8853": "#06b6d4",
      "FAQ": "#ec4899",
      "\u81EA\u5B9A\u7FA9": "#6b7280"
    };
    return colors[type] || "#667eea";
  }
  getStatTypes(byType) {
    return Object.entries(byType || {}).map(([name, data]) => ({
      key: name,
      name,
      count: data.count || 0,
      avgScore: data.avg_score || data.avgScore || 0
    }));
  }
  formatTime(timestamp) {
    const date = new Date(timestamp);
    const now = /* @__PURE__ */ new Date();
    const diff = now.getTime() - date.getTime();
    if (diff < 6e4)
      return "\u525B\u525B";
    if (diff < 36e5)
      return `${Math.floor(diff / 6e4)} \u5206\u9418\u524D`;
    if (diff < 864e5)
      return `${Math.floor(diff / 36e5)} \u5C0F\u6642\u524D`;
    return date.toLocaleDateString("zh-TW");
  }
  // ==================== 🆕 知識缺口方法 ====================
  suggestAnswer(gap) {
    this.ragService.suggestGapAnswer(gap.id, gap.query);
    this.toastService.info("\u6B63\u5728\u751F\u6210 AI \u5EFA\u8B70...");
  }
  resolveGap(gap) {
    const answer = gap.suggestedAnswer || "";
    this.dialogService.prompt({
      title: "\u89E3\u6C7A\u77E5\u8B58\u7F3A\u53E3",
      message: `\u554F\u984C: "${gap.query}"

\u8ACB\u8F38\u5165\u56DE\u7B54:`,
      placeholder: answer || "\u5C08\u696D\u7684\u56DE\u7B54...",
      defaultValue: answer,
      confirmText: "\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",
      onConfirm: (finalAnswer) => {
        if (finalAnswer) {
          this.ragService.resolveGap(gap.id, "faq", gap.query, finalAnswer);
        }
      }
    });
  }
  ignoreGap(gap) {
    this.ragService.ignoreGap(gap.id);
  }
  // 🆕 刪除單條缺口（無需確認）
  deleteGap(gap) {
    this.ragService.deleteGap(gap.id);
    this.toastService.success("\u5DF2\u522A\u9664");
  }
  // 🆕 清理重複缺口
  cleanupDuplicateGaps() {
    this.ragService.cleanupDuplicateGaps();
    this.toastService.info("\u6B63\u5728\u6E05\u7406\u91CD\u8907\u7F3A\u53E3...");
  }
  // ==================== 🆕 引導式構建方法 ====================
  startGuidedBuild() {
    this.guidedAnswer = "";
    this.selectedOptions = [];
    this.ragService.startGuidedBuild();
  }
  isOptionSelected(optionId) {
    return this.selectedOptions.includes(optionId);
  }
  toggleOption(optionId) {
    if (this.selectedOptions.includes(optionId)) {
      this.selectedOptions = this.selectedOptions.filter((id) => id !== optionId);
    } else {
      this.selectedOptions.push(optionId);
    }
    this.guidedAnswer = this.selectedOptions;
  }
  addSuggestion(suggestion) {
    if (typeof this.guidedAnswer === "string") {
      this.guidedAnswer = this.guidedAnswer ? `${this.guidedAnswer}
${suggestion}` : suggestion;
    }
  }
  submitGuidedAnswer() {
    this.ragService.answerGuidedQuestion(this.guidedAnswer);
    this.guidedAnswer = "";
    this.selectedOptions = [];
  }
  cancelGuidedBuild() {
    this.ragService.cancelGuidedBuild();
    this.guidedAnswer = "";
    this.selectedOptions = [];
  }
  static {
    this.\u0275fac = function AIBrainComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _AIBrainComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _AIBrainComponent, selectors: [["app-ai-brain"]], decls: 106, vars: 20, consts: [[1, "ai-brain-container"], ["class", "task-banner", 4, "ngIf"], [1, "brain-header"], [1, "brain-title"], [1, "brain-icon"], [1, "version-badge"], [1, "brain-stats"], [1, "stat-item"], [1, "stat-value"], [1, "stat-label"], [1, "stat-item", "health"], [1, "brain-content"], [1, "build-section"], [1, "section-title"], [1, "icon"], [1, "conversation-builder"], [1, "chat-bubble", "ai"], [1, "bubble-content"], ["placeholder", "\u4F8B\u5982\uFF1A\u6211\u662F\u505A\u8DE8\u5883\u652F\u4ED8\u7684\uFF0C\u4E3B\u8981\u5E6B\u5BA2\u6236\u514C\u63DB USDT\uFF0C\u532F\u7387\u6BD4\u5E02\u5834\u9AD8 0.5%\uFF0C10 \u5206\u9418\u5230\u8CEC...", "rows", "4", 1, "business-input", 3, "ngModelChange", "ngModel"], [1, "build-progress"], [1, "build-btn", 3, "click", "disabled"], [1, "cancel-request-btn"], [1, "quick-import"], [1, "import-buttons"], [1, "import-btn", "guided", 3, "click"], [1, "import-btn", 3, "click"], [1, "search-section"], [1, "search-box"], ["type", "text", "placeholder", "\u8F38\u5165\u554F\u984C\uFF0CAI \u6703\u627E\u5230\u6700\u76F8\u95DC\u7684\u77E5\u8B58...", 3, "ngModelChange", "keyup.enter", "ngModel"], [1, "search-btn", 3, "click", "disabled"], [1, "search-results"], [1, "loading-state"], [1, "empty-state"], [1, "placeholder-state"], [1, "learning-section"], [1, "live-badge"], [1, "learning-feed"], [1, "empty-learning"], [1, "maintenance-section"], [1, "maintenance-buttons"], [1, "maint-btn", 3, "click"], [1, "gaps-section"], [1, "gaps-empty"], [1, "knowledge-distribution"], [1, "guided-overlay"], [1, "task-banner"], [1, "task-title"], [1, "task-icon"], [1, "task-list"], [1, "task-item", "priority-high"], [1, "task-item", "priority-medium"], [1, "task-item", "priority-low"], [1, "task-item", "priority-high", 3, "click"], [1, "task-badge", "high"], [1, "task-text"], [1, "task-action"], [1, "task-badge", "medium"], [1, "task-item", "priority-low", 3, "click"], [1, "task-badge", "low"], [1, "progress-bar"], [1, "progress-fill"], [1, "progress-text"], [1, "spinner"], [1, "cancel-request-btn", 3, "click"], [1, "cancel-link", 3, "click"], [1, "result-card", 3, "high-match"], [1, "result-card"], [1, "result-header"], [1, "type-badge"], [1, "similarity"], [1, "result-question"], [1, "result-answer"], [1, "result-actions"], [1, "action-btn", "positive", 3, "click"], [1, "action-btn", "negative", 3, "click"], [1, "add-btn", 3, "click"], [1, "learning-event"], [1, "event-icon"], [1, "event-content"], [1, "event-desc"], [1, "event-time"], [1, "hint"], [1, "gaps-header"], [1, "gap-count"], [1, "gaps-actions-bar"], ["title", "\u4E00\u9375\u6E05\u7406\u6240\u6709\u5783\u573E\u6578\u64DA", 1, "batch-btn", "cleanup", 3, "click"], [1, "batch-btn", "delete-selected"], [1, "gaps-hint"], [1, "gaps-list"], [1, "gap-card", 3, "selected"], [1, "gaps-more"], [1, "batch-btn", "delete-selected", 3, "click"], [1, "gap-card"], [1, "gap-select"], ["type", "checkbox", 3, "change", "checked"], [1, "gap-main"], [1, "gap-top"], [1, "gap-query", 3, "title"], [1, "gap-tags"], [1, "tag", "hot"], [1, "tag", "category", 3, "class"], [1, "tag", "hits"], [1, "gap-suggestion"], [1, "gap-actions"], ["title", "\u8B93 AI \u751F\u6210\u5EFA\u8B70\u7B54\u6848", 1, "gap-btn", "suggest"], ["title", "\u63A1\u7528\u4E26\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB", 1, "gap-btn", "resolve", 3, "click"], ["title", "\u76F4\u63A5\u522A\u9664", 1, "gap-btn", "delete", 3, "click"], [1, "tag", "category"], [1, "suggestion-label"], [1, "suggestion-text"], ["title", "\u8B93 AI \u751F\u6210\u5EFA\u8B70\u7B54\u6848", 1, "gap-btn", "suggest", 3, "click"], [1, "empty-icon"], [1, "health-dashboard"], [1, "health-overview"], [1, "health-score-circle"], [1, "score-value"], [1, "score-label"], [1, "health-metrics"], [1, "metric"], [1, "metric-label"], [1, "metric-bar"], [1, "bar-fill"], [1, "metric-value"], [1, "health-suggestions"], [1, "suggestion-item"], [1, "priority-badge"], [1, "distribution-grid"], [1, "type-card"], [1, "type-name"], [1, "type-stats"], [1, "count"], [1, "score"], [1, "type-bar"], [1, "guided-dialog"], [1, "guided-header"], [1, "step-indicator"], [1, "close-btn", 3, "click"], [1, "guided-content"], [1, "question-text"], [1, "options-grid"], [1, "options-grid", "multi"], [1, "guided-footer"], [1, "cancel-btn", 3, "click"], [1, "next-btn", 3, "click", "disabled"], [1, "option-btn", 3, "selected"], [1, "option-btn", 3, "click"], [1, "guided-textarea", 3, "ngModelChange", "ngModel", "placeholder"], [1, "suggestions"], [1, "label"], [1, "suggestion-chip"], [1, "suggestion-chip", 3, "click"]], template: function AIBrainComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0);
        \u0275\u0275template(1, AIBrainComponent_div_1_Template, 10, 3, "div", 1);
        \u0275\u0275elementStart(2, "div", 2)(3, "div", 3)(4, "span", 4);
        \u0275\u0275text(5, "\u{1F9E0}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(6, "span");
        \u0275\u0275text(7, "AI \u77E5\u8B58\u5927\u8166");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(8, "span", 5);
        \u0275\u0275text(9, "2.0");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(10, "div", 6)(11, "div", 7)(12, "span", 8);
        \u0275\u0275text(13);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(14, "span", 9);
        \u0275\u0275text(15, "\u77E5\u8B58\u7E3D\u6578");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(16, "div", 7)(17, "span", 8);
        \u0275\u0275text(18);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(19, "span", 9);
        \u0275\u0275text(20, "\u547D\u4E2D\u7387");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(21, "div", 7)(22, "span", 8);
        \u0275\u0275text(23);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(24, "span", 9);
        \u0275\u0275text(25, "\u4ECA\u65E5\u5B78\u7FD2");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(26, "div", 10)(27, "span", 8);
        \u0275\u0275text(28);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(29, "span", 9);
        \u0275\u0275text(30, "\u5065\u5EB7\u5EA6");
        \u0275\u0275elementEnd()()()();
        \u0275\u0275elementStart(31, "div", 11)(32, "div", 12)(33, "h3", 13)(34, "span", 14);
        \u0275\u0275text(35, "\u{1F4AC}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(36, " \u5C0D\u8A71\u5F0F\u77E5\u8B58\u69CB\u5EFA ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(37, "div", 15)(38, "div", 16)(39, "div", 17);
        \u0275\u0275text(40, " \u544A\u8A34\u6211\u4F60\u7684\u696D\u52D9\uFF0C\u6211\u4F86\u5E6B\u4F60\u69CB\u5EFA\u77E5\u8B58\u5EAB... ");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(41, "textarea", 18);
        \u0275\u0275twoWayListener("ngModelChange", function AIBrainComponent_Template_textarea_ngModelChange_41_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.businessDescription, $event) || (ctx.businessDescription = $event);
          return $event;
        });
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(42, AIBrainComponent_Conditional_42_Template, 5, 4, "div", 19);
        \u0275\u0275elementStart(43, "button", 20);
        \u0275\u0275listener("click", function AIBrainComponent_Template_button_click_43_listener() {
          return ctx.startBuild();
        });
        \u0275\u0275conditionalCreate(44, AIBrainComponent_Conditional_44_Template, 2, 0)(45, AIBrainComponent_Conditional_45_Template, 3, 0);
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(46, AIBrainComponent_Conditional_46_Template, 2, 0, "button", 21);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(47, "div", 22)(48, "h4");
        \u0275\u0275text(49, "\u6216\u8005\u5FEB\u901F\u5C0E\u5165");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(50, "div", 23)(51, "button", 24);
        \u0275\u0275listener("click", function AIBrainComponent_Template_button_click_51_listener() {
          return ctx.startGuidedBuild();
        });
        \u0275\u0275elementStart(52, "span", 14);
        \u0275\u0275text(53, "\u{1F3AF}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(54, " \u5F15\u5C0E\u5F0F\u69CB\u5EFA (\u63A8\u85A6) ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(55, "button", 25);
        \u0275\u0275listener("click", function AIBrainComponent_Template_button_click_55_listener() {
          return ctx.importFromUrl();
        });
        \u0275\u0275elementStart(56, "span", 14);
        \u0275\u0275text(57, "\u{1F310}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(58, " \u5F9E\u7DB2\u9801\u5C0E\u5165 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(59, "button", 25);
        \u0275\u0275listener("click", function AIBrainComponent_Template_button_click_59_listener() {
          return ctx.importFromDocument();
        });
        \u0275\u0275elementStart(60, "span", 14);
        \u0275\u0275text(61, "\u{1F4C4}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(62, " \u4E0A\u50B3\u6587\u6A94 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(63, "button", 25);
        \u0275\u0275listener("click", function AIBrainComponent_Template_button_click_63_listener() {
          return ctx.openTemplateSelector();
        });
        \u0275\u0275elementStart(64, "span", 14);
        \u0275\u0275text(65, "\u{1F4DA}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(66, " \u884C\u696D\u6A21\u677F ");
        \u0275\u0275elementEnd()()()();
        \u0275\u0275elementStart(67, "div", 26)(68, "h3", 13)(69, "span", 14);
        \u0275\u0275text(70, "\u{1F50D}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(71, " \u8A9E\u7FA9\u641C\u7D22 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(72, "div", 27)(73, "input", 28);
        \u0275\u0275twoWayListener("ngModelChange", function AIBrainComponent_Template_input_ngModelChange_73_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.searchQuery, $event) || (ctx.searchQuery = $event);
          return $event;
        });
        \u0275\u0275listener("keyup.enter", function AIBrainComponent_Template_input_keyup_enter_73_listener() {
          return ctx.search();
        });
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(74, "button", 29);
        \u0275\u0275listener("click", function AIBrainComponent_Template_button_click_74_listener() {
          return ctx.search();
        });
        \u0275\u0275text(75, " \u641C\u7D22 ");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(76, "div", 30);
        \u0275\u0275conditionalCreate(77, AIBrainComponent_Conditional_77_Template, 5, 0, "div", 31)(78, AIBrainComponent_Conditional_78_Template, 2, 0)(79, AIBrainComponent_Conditional_79_Template, 7, 0, "div", 32)(80, AIBrainComponent_Conditional_80_Template, 5, 0, "div", 33);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(81, "div", 34)(82, "h3", 13)(83, "span", 14);
        \u0275\u0275text(84, "\u{1F534}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(85, "span", 35);
        \u0275\u0275text(86, "LIVE");
        \u0275\u0275elementEnd();
        \u0275\u0275text(87, " \u5BE6\u6642\u5B78\u7FD2 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(88, "div", 36);
        \u0275\u0275conditionalCreate(89, AIBrainComponent_Conditional_89_Template, 2, 0)(90, AIBrainComponent_Conditional_90_Template, 5, 0, "div", 37);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(91, "div", 38)(92, "h4");
        \u0275\u0275text(93, "\u77E5\u8B58\u7DAD\u8B77");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(94, "div", 39)(95, "button", 40);
        \u0275\u0275listener("click", function AIBrainComponent_Template_button_click_95_listener() {
          return ctx.cleanupKnowledge();
        });
        \u0275\u0275text(96, " \u{1F9F9} \u6E05\u7406\u4F4E\u8CEA\u91CF ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(97, "button", 40);
        \u0275\u0275listener("click", function AIBrainComponent_Template_button_click_97_listener() {
          return ctx.mergeKnowledge();
        });
        \u0275\u0275text(98, " \u{1F504} \u5408\u4F75\u76F8\u4F3C ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(99, "button", 40);
        \u0275\u0275listener("click", function AIBrainComponent_Template_button_click_99_listener() {
          return ctx.refreshStats();
        });
        \u0275\u0275text(100, " \u{1F4CA} \u5237\u65B0\u7D71\u8A08 ");
        \u0275\u0275elementEnd()()()()();
        \u0275\u0275conditionalCreate(101, AIBrainComponent_Conditional_101_Template, 18, 3, "div", 41)(102, AIBrainComponent_Conditional_102_Template, 5, 0, "div", 42);
        \u0275\u0275conditionalCreate(103, AIBrainComponent_Conditional_103_Template, 1, 1);
        \u0275\u0275conditionalCreate(104, AIBrainComponent_Conditional_104_Template, 6, 0, "div", 43);
        \u0275\u0275conditionalCreate(105, AIBrainComponent_Conditional_105_Template, 21, 7, "div", 44);
        \u0275\u0275elementEnd();
      }
      if (rf & 2) {
        let tmp_7_0;
        let tmp_16_0;
        let tmp_17_0;
        let tmp_18_0;
        \u0275\u0275advance();
        \u0275\u0275property("ngIf", ctx.hasPendingTasks());
        \u0275\u0275advance(12);
        \u0275\u0275textInterpolate(ctx.ragService.totalKnowledge());
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate1("", ctx.ragService.hitRate(), "%");
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate1("+", ctx.ragService.todayLearned());
        \u0275\u0275advance(3);
        \u0275\u0275classProp("healthy", ctx.ragService.healthScore() >= 70);
        \u0275\u0275advance(2);
        \u0275\u0275textInterpolate1("", ctx.ragService.healthScore(), "%");
        \u0275\u0275advance(13);
        \u0275\u0275twoWayProperty("ngModel", ctx.businessDescription);
        \u0275\u0275advance();
        \u0275\u0275conditional((tmp_7_0 = ctx.ragService.buildProgress()) ? 42 : -1, tmp_7_0);
        \u0275\u0275advance();
        \u0275\u0275property("disabled", !ctx.businessDescription || ctx.ragService.isLoading());
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.ragService.isLoading() && ctx.ragService.currentRequest() === "build" ? 44 : 45);
        \u0275\u0275advance(2);
        \u0275\u0275conditional(ctx.ragService.isLoading() && ctx.ragService.currentRequest() === "build" ? 46 : -1);
        \u0275\u0275advance(27);
        \u0275\u0275twoWayProperty("ngModel", ctx.searchQuery);
        \u0275\u0275advance();
        \u0275\u0275property("disabled", !ctx.searchQuery);
        \u0275\u0275advance(3);
        \u0275\u0275conditional(ctx.ragService.isLoading() && ctx.ragService.currentRequest() === "search" ? 77 : ctx.ragService.searchResults().length > 0 ? 78 : ctx.searchQuery && !ctx.ragService.isLoading() ? 79 : 80);
        \u0275\u0275advance(12);
        \u0275\u0275conditional(ctx.ragService.learningEvents().length > 0 ? 89 : 90);
        \u0275\u0275advance(12);
        \u0275\u0275conditional(ctx.ragService.knowledgeGaps().length > 0 ? 101 : 102);
        \u0275\u0275advance(2);
        \u0275\u0275conditional((tmp_16_0 = ctx.ragService.healthReport()) ? 103 : -1, tmp_16_0);
        \u0275\u0275advance();
        \u0275\u0275conditional((tmp_17_0 = ctx.ragService.stats()) ? 104 : -1, tmp_17_0);
        \u0275\u0275advance();
        \u0275\u0275conditional((tmp_18_0 = ctx.ragService.guidedQuestion()) ? 105 : -1, tmp_18_0);
      }
    }, dependencies: [CommonModule, NgIf, FormsModule, DefaultValueAccessor, NgControlStatus, NgModel], styles: ["\n\n.ai-brain-container[_ngcontent-%COMP%] {\n  padding: 24px;\n  background:\n    linear-gradient(\n      135deg,\n      #0f0f1a 0%,\n      #1a1a2e 100%);\n  min-height: 100vh;\n  color: #fff;\n}\n.task-banner[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(168, 85, 247, 0.15),\n      rgba(59, 130, 246, 0.15));\n  border: 1px solid rgba(168, 85, 247, 0.3);\n  border-radius: 16px;\n  padding: 16px 20px;\n  margin-bottom: 20px;\n}\n.task-title[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 16px;\n  font-weight: 600;\n  color: #e0e0e0;\n  margin-bottom: 12px;\n}\n.task-icon[_ngcontent-%COMP%] {\n  font-size: 18px;\n}\n.task-list[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.task-item[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 14px;\n  background: rgba(0, 0, 0, 0.3);\n  border-radius: 10px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.task-item[_ngcontent-%COMP%]:hover {\n  background: rgba(0, 0, 0, 0.5);\n  transform: translateX(4px);\n}\n.task-badge[_ngcontent-%COMP%] {\n  font-size: 12px;\n}\n.task-text[_ngcontent-%COMP%] {\n  flex: 1;\n  font-size: 14px;\n  color: #ccc;\n}\n.task-action[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #a855f7;\n  font-weight: 500;\n}\n.task-item.priority-high[_ngcontent-%COMP%]   .task-text[_ngcontent-%COMP%] {\n  color: #f87171;\n}\n.task-item.priority-medium[_ngcontent-%COMP%]   .task-text[_ngcontent-%COMP%] {\n  color: #fbbf24;\n}\n.task-item.priority-low[_ngcontent-%COMP%]   .task-text[_ngcontent-%COMP%] {\n  color: #34d399;\n}\n.brain-header[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 24px;\n  padding: 16px 24px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 16px;\n  -webkit-backdrop-filter: blur(10px);\n  backdrop-filter: blur(10px);\n}\n.brain-title[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  font-size: 24px;\n  font-weight: bold;\n}\n.brain-icon[_ngcontent-%COMP%] {\n  font-size: 32px;\n}\n.version-badge[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #667eea 0%,\n      #764ba2 100%);\n  padding: 4px 12px;\n  border-radius: 20px;\n  font-size: 12px;\n  font-weight: 600;\n}\n.brain-stats[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 32px;\n}\n.stat-item[_ngcontent-%COMP%] {\n  text-align: center;\n}\n.stat-value[_ngcontent-%COMP%] {\n  display: block;\n  font-size: 24px;\n  font-weight: bold;\n  color: #667eea;\n}\n.stat-label[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #888;\n}\n.stat-item.health[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%] {\n  color: #f59e0b;\n}\n.stat-item.health.healthy[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%] {\n  color: #10b981;\n}\n.brain-content[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: 1fr 1fr 1fr;\n  gap: 24px;\n  margin-bottom: 24px;\n}\n.section-title[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 16px;\n  font-size: 16px;\n  font-weight: 600;\n}\n.live-badge[_ngcontent-%COMP%] {\n  background: #ef4444;\n  padding: 2px 8px;\n  border-radius: 4px;\n  font-size: 10px;\n  animation: _ngcontent-%COMP%_pulse 2s infinite;\n}\n@keyframes _ngcontent-%COMP%_pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n.build-section[_ngcontent-%COMP%] {\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 16px;\n  padding: 20px;\n}\n.conversation-builder[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.chat-bubble.ai[_ngcontent-%COMP%] {\n  background: rgba(102, 126, 234, 0.2);\n  padding: 12px 16px;\n  border-radius: 16px 16px 16px 4px;\n  font-size: 14px;\n}\n.business-input[_ngcontent-%COMP%] {\n  background: rgba(0, 0, 0, 0.3);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 12px;\n  padding: 12px;\n  color: #fff;\n  font-size: 14px;\n  resize: none;\n}\n.business-input[_ngcontent-%COMP%]:focus {\n  outline: none;\n  border-color: #667eea;\n}\n.build-progress[_ngcontent-%COMP%] {\n  padding: 12px;\n  background: rgba(102, 126, 234, 0.1);\n  border-radius: 8px;\n}\n.progress-bar[_ngcontent-%COMP%] {\n  height: 4px;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 2px;\n  overflow: hidden;\n  margin-bottom: 8px;\n}\n.progress-fill[_ngcontent-%COMP%] {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #667eea,\n      #764ba2);\n  transition: width 0.3s;\n}\n.progress-text[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #888;\n}\n.build-btn[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  padding: 14px;\n  background:\n    linear-gradient(\n      135deg,\n      #667eea 0%,\n      #764ba2 100%);\n  border: none;\n  border-radius: 12px;\n  color: #fff;\n  font-size: 15px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s;\n}\n.build-btn[_ngcontent-%COMP%]:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);\n}\n.build-btn[_ngcontent-%COMP%]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.quick-import[_ngcontent-%COMP%] {\n  margin-top: 20px;\n  padding-top: 20px;\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\n}\n.quick-import[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%] {\n  font-size: 13px;\n  color: #888;\n  margin-bottom: 12px;\n}\n.import-buttons[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.import-btn[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 14px;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  color: #fff;\n  font-size: 13px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.import-btn[_ngcontent-%COMP%]:hover {\n  background: rgba(255, 255, 255, 0.1);\n  border-color: #667eea;\n}\n.import-btn.guided[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(102, 126, 234, 0.2),\n      rgba(118, 75, 162, 0.2));\n  border-color: #667eea;\n}\n.search-section[_ngcontent-%COMP%] {\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 16px;\n  padding: 20px;\n}\n.search-box[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 16px;\n}\n.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] {\n  flex: 1;\n  padding: 12px 16px;\n  background: rgba(0, 0, 0, 0.3);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  color: #fff;\n  font-size: 14px;\n}\n.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus {\n  outline: none;\n  border-color: #667eea;\n}\n.search-btn[_ngcontent-%COMP%] {\n  padding: 12px 20px;\n  background: #667eea;\n  border: none;\n  border-radius: 8px;\n  color: #fff;\n  font-weight: 600;\n  cursor: pointer;\n}\n.search-btn[_ngcontent-%COMP%]:disabled {\n  opacity: 0.5;\n}\n.search-results[_ngcontent-%COMP%] {\n  max-height: 400px;\n  overflow-y: auto;\n}\n.result-card[_ngcontent-%COMP%] {\n  background: rgba(0, 0, 0, 0.2);\n  border: 1px solid rgba(255, 255, 255, 0.05);\n  border-radius: 12px;\n  padding: 14px;\n  margin-bottom: 12px;\n}\n.result-card.high-match[_ngcontent-%COMP%] {\n  border-color: #10b981;\n}\n.result-header[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n.type-badge[_ngcontent-%COMP%] {\n  padding: 4px 10px;\n  border-radius: 12px;\n  font-size: 11px;\n  font-weight: 600;\n  background: rgba(102, 126, 234, 0.2);\n  color: #667eea;\n}\n.similarity[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #10b981;\n}\n.result-question[_ngcontent-%COMP%] {\n  font-weight: 600;\n  margin-bottom: 6px;\n  font-size: 14px;\n}\n.result-answer[_ngcontent-%COMP%] {\n  font-size: 13px;\n  color: #aaa;\n  line-height: 1.5;\n}\n.result-actions[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 8px;\n  margin-top: 12px;\n}\n.action-btn[_ngcontent-%COMP%] {\n  padding: 6px 12px;\n  border-radius: 6px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn.positive[_ngcontent-%COMP%] {\n  background: rgba(16, 185, 129, 0.1);\n  border: 1px solid rgba(16, 185, 129, 0.3);\n  color: #10b981;\n}\n.action-btn.negative[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  color: #ef4444;\n}\n.action-btn[_ngcontent-%COMP%]:hover {\n  transform: scale(1.05);\n}\n.empty-state[_ngcontent-%COMP%], \n.placeholder-state[_ngcontent-%COMP%], \n.loading-state[_ngcontent-%COMP%] {\n  text-align: center;\n  padding: 40px 20px;\n  color: #888;\n}\n.empty-state[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], \n.placeholder-state[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%] {\n  font-size: 48px;\n  margin-bottom: 12px;\n}\n.add-btn[_ngcontent-%COMP%] {\n  margin-top: 12px;\n  padding: 10px 20px;\n  background: #667eea;\n  border: none;\n  border-radius: 8px;\n  color: #fff;\n  cursor: pointer;\n}\n.learning-section[_ngcontent-%COMP%] {\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 16px;\n  padding: 20px;\n}\n.learning-feed[_ngcontent-%COMP%] {\n  max-height: 300px;\n  overflow-y: auto;\n}\n.learning-event[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 12px;\n  padding: 10px;\n  background: rgba(0, 0, 0, 0.2);\n  border-radius: 8px;\n  margin-bottom: 8px;\n}\n.event-icon[_ngcontent-%COMP%] {\n  font-size: 20px;\n}\n.event-desc[_ngcontent-%COMP%] {\n  font-size: 13px;\n}\n.event-time[_ngcontent-%COMP%] {\n  font-size: 11px;\n  color: #666;\n}\n.empty-learning[_ngcontent-%COMP%] {\n  text-align: center;\n  padding: 30px;\n  color: #666;\n}\n.empty-learning[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #555;\n}\n.maintenance-section[_ngcontent-%COMP%] {\n  margin-top: 20px;\n  padding-top: 16px;\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\n}\n.maintenance-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%] {\n  font-size: 13px;\n  color: #888;\n  margin-bottom: 12px;\n}\n.maintenance-buttons[_ngcontent-%COMP%] {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n.maint-btn[_ngcontent-%COMP%] {\n  padding: 8px 12px;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 6px;\n  color: #aaa;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.maint-btn[_ngcontent-%COMP%]:hover {\n  background: rgba(255, 255, 255, 0.1);\n  color: #fff;\n}\n.knowledge-distribution[_ngcontent-%COMP%] {\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 16px;\n  padding: 20px;\n}\n.knowledge-distribution[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%] {\n  margin-bottom: 16px;\n  font-size: 16px;\n}\n.distribution-grid[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n  gap: 12px;\n}\n.type-card[_ngcontent-%COMP%] {\n  background: rgba(0, 0, 0, 0.2);\n  border-radius: 8px;\n  padding: 12px;\n}\n.type-name[_ngcontent-%COMP%] {\n  font-weight: 600;\n  margin-bottom: 6px;\n}\n.type-stats[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  font-size: 12px;\n  color: #888;\n  margin-bottom: 8px;\n}\n.type-bar[_ngcontent-%COMP%] {\n  height: 4px;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 2px;\n  overflow: hidden;\n}\n.bar-fill[_ngcontent-%COMP%] {\n  height: 100%;\n  border-radius: 2px;\n}\n.spinner[_ngcontent-%COMP%] {\n  display: inline-block;\n  width: 16px;\n  height: 16px;\n  border: 2px solid rgba(255, 255, 255, 0.3);\n  border-top-color: #fff;\n  border-radius: 50%;\n  animation: _ngcontent-%COMP%_spin 0.8s linear infinite;\n}\n@keyframes _ngcontent-%COMP%_spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n.cancel-request-btn[_ngcontent-%COMP%] {\n  display: block;\n  width: 100%;\n  margin-top: 8px;\n  padding: 10px;\n  background: rgba(239, 68, 68, 0.2);\n  border: 1px solid rgba(239, 68, 68, 0.4);\n  border-radius: 8px;\n  color: #ef4444;\n  font-size: 13px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.cancel-request-btn[_ngcontent-%COMP%]:hover {\n  background: rgba(239, 68, 68, 0.3);\n}\n.cancel-link[_ngcontent-%COMP%] {\n  display: block;\n  margin-top: 8px;\n  background: none;\n  border: none;\n  color: #888;\n  font-size: 12px;\n  cursor: pointer;\n  text-decoration: underline;\n}\n.cancel-link[_ngcontent-%COMP%]:hover {\n  color: #ef4444;\n}\n@media (max-width: 1200px) {\n  .brain-content[_ngcontent-%COMP%] {\n    grid-template-columns: 1fr 1fr;\n  }\n  .learning-section[_ngcontent-%COMP%] {\n    grid-column: span 2;\n  }\n}\n@media (max-width: 768px) {\n  .brain-content[_ngcontent-%COMP%] {\n    grid-template-columns: 1fr;\n  }\n  .learning-section[_ngcontent-%COMP%] {\n    grid-column: auto;\n  }\n  .brain-header[_ngcontent-%COMP%] {\n    flex-direction: column;\n    gap: 16px;\n  }\n  .brain-stats[_ngcontent-%COMP%] {\n    flex-wrap: wrap;\n    justify-content: center;\n  }\n}\n.gaps-section[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(239, 68, 68, 0.08),\n      rgba(168, 85, 247, 0.08));\n  border: 1px solid rgba(239, 68, 68, 0.2);\n  border-radius: 16px;\n  padding: 20px;\n  margin-bottom: 24px;\n}\n.gaps-header[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n.gap-count[_ngcontent-%COMP%] {\n  color: #ef4444;\n  font-weight: bold;\n}\n.gaps-actions-bar[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 8px;\n}\n.gaps-hint[_ngcontent-%COMP%] {\n  font-size: 13px;\n  color: #888;\n  margin-bottom: 16px;\n}\n.gaps-list[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n.gap-card[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 12px;\n  background: rgba(0, 0, 0, 0.3);\n  border-radius: 12px;\n  padding: 12px;\n  transition: all 0.2s;\n  border: 1px solid transparent;\n}\n.gap-card[_ngcontent-%COMP%]:hover {\n  background: rgba(0, 0, 0, 0.4);\n  border-color: rgba(168, 85, 247, 0.3);\n}\n.gap-card.selected[_ngcontent-%COMP%] {\n  background: rgba(168, 85, 247, 0.15);\n  border-color: rgba(168, 85, 247, 0.5);\n}\n.gap-select[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: flex-start;\n  padding-top: 4px;\n}\n.gap-select[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%] {\n  width: 18px;\n  height: 18px;\n  cursor: pointer;\n  accent-color: #a855f7;\n}\n.gap-main[_ngcontent-%COMP%] {\n  flex: 1;\n  min-width: 0;\n}\n.gap-top[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  gap: 12px;\n  margin-bottom: 8px;\n}\n.gap-query[_ngcontent-%COMP%] {\n  font-size: 14px;\n  color: #e0e0e0;\n  flex: 1;\n  line-height: 1.4;\n}\n.gap-tags[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 6px;\n  flex-shrink: 0;\n}\n.tag[_ngcontent-%COMP%] {\n  font-size: 11px;\n  padding: 2px 8px;\n  border-radius: 10px;\n  white-space: nowrap;\n}\n.tag.hot[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.tag.hits[_ngcontent-%COMP%] {\n  background: rgba(100, 116, 139, 0.3);\n  color: #94a3b8;\n}\n.tag.category[_ngcontent-%COMP%] {\n  background: rgba(168, 85, 247, 0.2);\n  color: #c4b5fd;\n}\n.tag.cat-price[_ngcontent-%COMP%] {\n  background: rgba(234, 179, 8, 0.2);\n  color: #fbbf24;\n}\n.tag.cat-process[_ngcontent-%COMP%] {\n  background: rgba(59, 130, 246, 0.2);\n  color: #60a5fa;\n}\n.tag.cat-product[_ngcontent-%COMP%] {\n  background: rgba(16, 185, 129, 0.2);\n  color: #34d399;\n}\n.tag.cat-support[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.gap-suggestion[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 6px;\n  font-size: 12px;\n  color: #888;\n  margin-bottom: 8px;\n  padding: 6px 10px;\n  background: rgba(168, 85, 247, 0.1);\n  border-radius: 6px;\n}\n.suggestion-label[_ngcontent-%COMP%] {\n  color: #a855f7;\n  flex-shrink: 0;\n}\n.suggestion-text[_ngcontent-%COMP%] {\n  color: #aaa;\n}\n.gap-actions[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 6px;\n}\n.gap-btn[_ngcontent-%COMP%] {\n  padding: 4px 10px;\n  border-radius: 6px;\n  border: none;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.gap-btn.suggest[_ngcontent-%COMP%] {\n  background: rgba(168, 85, 247, 0.2);\n  color: #c4b5fd;\n}\n.gap-btn.resolve[_ngcontent-%COMP%] {\n  background: rgba(16, 185, 129, 0.2);\n  color: #34d399;\n}\n.gap-btn.delete[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.gap-btn[_ngcontent-%COMP%]:hover {\n  filter: brightness(1.2);\n}\n.batch-btn[_ngcontent-%COMP%] {\n  padding: 6px 12px;\n  border-radius: 8px;\n  border: none;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.batch-btn.cleanup[_ngcontent-%COMP%] {\n  background: rgba(234, 179, 8, 0.2);\n  color: #fbbf24;\n}\n.batch-btn.delete-selected[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.gaps-more[_ngcontent-%COMP%] {\n  text-align: center;\n  padding: 12px;\n  color: #666;\n  font-size: 13px;\n}\n.gaps-empty[_ngcontent-%COMP%] {\n  text-align: center;\n  padding: 40px;\n  color: #666;\n}\n.gaps-empty[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%] {\n  font-size: 48px;\n  display: block;\n  margin-bottom: 12px;\n}\n.gaps-list[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.gap-card[_ngcontent-%COMP%] {\n  background: rgba(0, 0, 0, 0.3);\n  border-radius: 12px;\n  padding: 14px;\n}\n.gap-header[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 10px;\n}\n.gap-query[_ngcontent-%COMP%] {\n  font-weight: 600;\n  color: #fff;\n}\n.gap-hits[_ngcontent-%COMP%] {\n  background: #ef4444;\n  padding: 2px 8px;\n  border-radius: 10px;\n  font-size: 11px;\n}\n.gap-suggestion[_ngcontent-%COMP%] {\n  background: rgba(102, 126, 234, 0.1);\n  padding: 10px;\n  border-radius: 8px;\n  font-size: 13px;\n  color: #aaa;\n  margin-bottom: 10px;\n}\n.gap-actions[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 8px;\n}\n.gap-btn[_ngcontent-%COMP%] {\n  padding: 6px 12px;\n  border-radius: 6px;\n  font-size: 12px;\n  cursor: pointer;\n  border: none;\n  transition: all 0.2s;\n}\n.gap-btn.suggest[_ngcontent-%COMP%] {\n  background: rgba(102, 126, 234, 0.2);\n  color: #667eea;\n}\n.gap-btn.resolve[_ngcontent-%COMP%] {\n  background: rgba(16, 185, 129, 0.2);\n  color: #10b981;\n}\n.gap-btn.ignore[_ngcontent-%COMP%] {\n  background: rgba(107, 114, 128, 0.2);\n  color: #9ca3af;\n}\n.gap-btn.delete[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #ef4444;\n}\n.gap-btn.delete[_ngcontent-%COMP%]:hover {\n  background: rgba(239, 68, 68, 0.4);\n}\n.gap-btn[_ngcontent-%COMP%]:hover {\n  transform: scale(1.05);\n}\n.batch-btn[_ngcontent-%COMP%] {\n  margin-left: auto;\n  padding: 6px 12px;\n  border: none;\n  border-radius: 8px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.batch-btn.cleanup[_ngcontent-%COMP%] {\n  background: rgba(245, 158, 11, 0.2);\n  color: #f59e0b;\n}\n.batch-btn.cleanup[_ngcontent-%COMP%]:hover {\n  background: rgba(245, 158, 11, 0.4);\n}\n.health-dashboard[_ngcontent-%COMP%] {\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 16px;\n  padding: 20px;\n  margin-bottom: 24px;\n}\n.health-overview[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 30px;\n  align-items: center;\n}\n.health-score-circle[_ngcontent-%COMP%] {\n  width: 100px;\n  height: 100px;\n  border-radius: 50%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  background: rgba(0, 0, 0, 0.3);\n  border: 3px solid #667eea;\n}\n.health-score-circle.healthy[_ngcontent-%COMP%] {\n  border-color: #10b981;\n}\n.health-score-circle.warning[_ngcontent-%COMP%] {\n  border-color: #f59e0b;\n}\n.health-score-circle.danger[_ngcontent-%COMP%] {\n  border-color: #ef4444;\n}\n.score-value[_ngcontent-%COMP%] {\n  font-size: 28px;\n  font-weight: bold;\n}\n.score-label[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #888;\n}\n.health-metrics[_ngcontent-%COMP%] {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.metric[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n.metric-label[_ngcontent-%COMP%] {\n  width: 60px;\n  font-size: 13px;\n  color: #888;\n}\n.metric-bar[_ngcontent-%COMP%] {\n  flex: 1;\n  height: 8px;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 4px;\n  overflow: hidden;\n}\n.metric-bar[_ngcontent-%COMP%]   .bar-fill[_ngcontent-%COMP%] {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #667eea,\n      #764ba2);\n  border-radius: 4px;\n}\n.metric-value[_ngcontent-%COMP%] {\n  width: 40px;\n  text-align: right;\n  font-size: 13px;\n  font-weight: 600;\n}\n.health-suggestions[_ngcontent-%COMP%] {\n  margin-top: 20px;\n  padding-top: 16px;\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\n}\n.health-suggestions[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%] {\n  font-size: 14px;\n  margin-bottom: 12px;\n}\n.suggestion-item[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  background: rgba(0, 0, 0, 0.2);\n  border-radius: 8px;\n  margin-bottom: 8px;\n  font-size: 13px;\n}\n.guided-overlay[_ngcontent-%COMP%] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.8);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n.guided-dialog[_ngcontent-%COMP%] {\n  background: #1a1a2e;\n  border-radius: 20px;\n  width: 90%;\n  max-width: 600px;\n  max-height: 80vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.guided-header[_ngcontent-%COMP%] {\n  padding: 20px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n  position: relative;\n}\n.step-indicator[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #667eea;\n  margin-bottom: 4px;\n  display: block;\n}\n.guided-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%] {\n  margin: 0;\n  font-size: 20px;\n}\n.close-btn[_ngcontent-%COMP%] {\n  position: absolute;\n  top: 16px;\n  right: 16px;\n  background: none;\n  border: none;\n  color: #888;\n  font-size: 20px;\n  cursor: pointer;\n}\n.guided-content[_ngcontent-%COMP%] {\n  padding: 20px;\n  flex: 1;\n  overflow-y: auto;\n}\n.question-text[_ngcontent-%COMP%] {\n  font-size: 16px;\n  margin-bottom: 20px;\n}\n.options-grid[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 10px;\n}\n.options-grid.multi[_ngcontent-%COMP%] {\n  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));\n}\n.option-btn[_ngcontent-%COMP%] {\n  padding: 14px;\n  background: rgba(255, 255, 255, 0.05);\n  border: 2px solid rgba(255, 255, 255, 0.1);\n  border-radius: 12px;\n  color: #fff;\n  font-size: 14px;\n  cursor: pointer;\n  transition: all 0.2s;\n  text-align: left;\n}\n.option-btn[_ngcontent-%COMP%]:hover {\n  border-color: #667eea;\n}\n.option-btn.selected[_ngcontent-%COMP%] {\n  border-color: #667eea;\n  background: rgba(102, 126, 234, 0.2);\n}\n.guided-textarea[_ngcontent-%COMP%] {\n  width: 100%;\n  min-height: 120px;\n  padding: 14px;\n  background: rgba(0, 0, 0, 0.3);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 12px;\n  color: #fff;\n  font-size: 14px;\n  resize: vertical;\n}\n.suggestions[_ngcontent-%COMP%] {\n  margin-top: 12px;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  align-items: center;\n}\n.suggestions[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #888;\n}\n.suggestion-chip[_ngcontent-%COMP%] {\n  padding: 4px 10px;\n  background: rgba(102, 126, 234, 0.2);\n  border: none;\n  border-radius: 12px;\n  color: #667eea;\n  font-size: 12px;\n  cursor: pointer;\n}\n.guided-footer[_ngcontent-%COMP%] {\n  padding: 16px 20px;\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n}\n.cancel-btn[_ngcontent-%COMP%] {\n  padding: 10px 20px;\n  background: transparent;\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  border-radius: 8px;\n  color: #888;\n  cursor: pointer;\n}\n.next-btn[_ngcontent-%COMP%] {\n  padding: 10px 24px;\n  background:\n    linear-gradient(\n      135deg,\n      #667eea,\n      #764ba2);\n  border: none;\n  border-radius: 8px;\n  color: #fff;\n  font-weight: 600;\n  cursor: pointer;\n}\n.next-btn[_ngcontent-%COMP%]:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n/*# sourceMappingURL=ai-brain.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AIBrainComponent, [{
    type: Component,
    args: [{ selector: "app-ai-brain", standalone: true, imports: [CommonModule, FormsModule], template: `
    <div class="ai-brain-container">
      <!-- \u{1F195} P1-2: \u4EFB\u52D9\u9A45\u52D5\u5F0F\u9802\u90E8\u5340\u57DF -->
      <div class="task-banner" *ngIf="hasPendingTasks()">
        <div class="task-title">
          <span class="task-icon">\u{1F4CC}</span>
          <span>\u4ECA\u65E5\u5F85\u8FA6</span>
        </div>
        <div class="task-list">
          @if (ragService.gapsCount() > 0) {
            <div class="task-item priority-high" (click)="scrollToGaps()">
              <span class="task-badge high">\u{1F534}</span>
              <span class="task-text">{{ ragService.gapsCount() }} \u500B\u77E5\u8B58\u7F3A\u53E3\u5F85\u8655\u7406</span>
              <span class="task-action">\u7ACB\u5373\u8655\u7406 \u2192</span>
            </div>
          }
          @if (ragService.healthScore() < 60) {
            <div class="task-item priority-medium">
              <span class="task-badge medium">\u{1F7E1}</span>
              <span class="task-text">\u77E5\u8B58\u5EAB\u5065\u5EB7\u5EA6\u504F\u4F4E ({{ ragService.healthScore() }}%)</span>
              <span class="task-action">\u512A\u5316 \u2192</span>
            </div>
          }
          @if (ragService.totalKnowledge() < 10) {
            <div class="task-item priority-low" (click)="focusBuildInput()">
              <span class="task-badge low">\u{1F7E2}</span>
              <span class="task-text">\u5EFA\u8B70\u6DFB\u52A0\u66F4\u591A\u77E5\u8B58</span>
              <span class="task-action">\u958B\u59CB \u2192</span>
            </div>
          }
        </div>
      </div>
      
      <!-- \u9802\u90E8\u72C0\u614B\u6B04 -->
      <div class="brain-header">
        <div class="brain-title">
          <span class="brain-icon">\u{1F9E0}</span>
          <span>AI \u77E5\u8B58\u5927\u8166</span>
          <span class="version-badge">2.0</span>
        </div>
        
        <div class="brain-stats">
          <div class="stat-item">
            <span class="stat-value">{{ ragService.totalKnowledge() }}</span>
            <span class="stat-label">\u77E5\u8B58\u7E3D\u6578</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ ragService.hitRate() }}%</span>
            <span class="stat-label">\u547D\u4E2D\u7387</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">+{{ ragService.todayLearned() }}</span>
            <span class="stat-label">\u4ECA\u65E5\u5B78\u7FD2</span>
          </div>
          <div class="stat-item health" [class.healthy]="ragService.healthScore() >= 70">
            <span class="stat-value">{{ ragService.healthScore() }}%</span>
            <span class="stat-label">\u5065\u5EB7\u5EA6</span>
          </div>
        </div>
      </div>
      
      <!-- \u4E3B\u8981\u5167\u5BB9\u5340 -->
      <div class="brain-content">
        <!-- \u5DE6\u5074\uFF1A\u5C0D\u8A71\u5F0F\u69CB\u5EFA -->
        <div class="build-section">
          <h3 class="section-title">
            <span class="icon">\u{1F4AC}</span>
            \u5C0D\u8A71\u5F0F\u77E5\u8B58\u69CB\u5EFA
          </h3>
          
          <div class="conversation-builder">
            <div class="chat-bubble ai">
              <div class="bubble-content">
                \u544A\u8A34\u6211\u4F60\u7684\u696D\u52D9\uFF0C\u6211\u4F86\u5E6B\u4F60\u69CB\u5EFA\u77E5\u8B58\u5EAB...
              </div>
            </div>
            
            <textarea 
              class="business-input"
              [(ngModel)]="businessDescription"
              placeholder="\u4F8B\u5982\uFF1A\u6211\u662F\u505A\u8DE8\u5883\u652F\u4ED8\u7684\uFF0C\u4E3B\u8981\u5E6B\u5BA2\u6236\u514C\u63DB USDT\uFF0C\u532F\u7387\u6BD4\u5E02\u5834\u9AD8 0.5%\uFF0C10 \u5206\u9418\u5230\u8CEC..."
              rows="4"
            ></textarea>
            
            <!-- \u9032\u5EA6\u6307\u793A\u5668 -->
            @if (ragService.buildProgress(); as progress) {
              <div class="build-progress">
                <div class="progress-bar">
                  <div class="progress-fill" 
                       [style.width.%]="(progress.step / progress.totalSteps) * 100">
                  </div>
                </div>
                <div class="progress-text">
                  {{ progress.currentAction }} ({{ progress.itemsGenerated }} \u689D)
                </div>
              </div>
            }
            
            <button 
              class="build-btn"
              [disabled]="!businessDescription || ragService.isLoading()"
              (click)="startBuild()">
              @if (ragService.isLoading() && ragService.currentRequest() === 'build') {
                <span class="spinner"></span>
                \u69CB\u5EFA\u4E2D...
              } @else {
                <span class="icon">\u2728</span>
                \u4E00\u9375\u69CB\u5EFA\u77E5\u8B58\u5EAB
              }
            </button>
            
            <!-- \u{1F527} P1: \u53D6\u6D88\u6309\u9215 -->
            @if (ragService.isLoading() && ragService.currentRequest() === 'build') {
              <button class="cancel-request-btn" (click)="cancelCurrentRequest()">
                \u2715 \u53D6\u6D88
              </button>
            }
          </div>
          
          <!-- \u5FEB\u901F\u5C0E\u5165 -->
          <div class="quick-import">
            <h4>\u6216\u8005\u5FEB\u901F\u5C0E\u5165</h4>
            <div class="import-buttons">
              <button class="import-btn guided" (click)="startGuidedBuild()">
                <span class="icon">\u{1F3AF}</span>
                \u5F15\u5C0E\u5F0F\u69CB\u5EFA (\u63A8\u85A6)
              </button>
              <button class="import-btn" (click)="importFromUrl()">
                <span class="icon">\u{1F310}</span>
                \u5F9E\u7DB2\u9801\u5C0E\u5165
              </button>
              <button class="import-btn" (click)="importFromDocument()">
                <span class="icon">\u{1F4C4}</span>
                \u4E0A\u50B3\u6587\u6A94
              </button>
              <button class="import-btn" (click)="openTemplateSelector()">
                <span class="icon">\u{1F4DA}</span>
                \u884C\u696D\u6A21\u677F
              </button>
            </div>
          </div>
        </div>
        
        <!-- \u4E2D\u9593\uFF1A\u8A9E\u7FA9\u641C\u7D22 -->
        <div class="search-section">
          <h3 class="section-title">
            <span class="icon">\u{1F50D}</span>
            \u8A9E\u7FA9\u641C\u7D22
          </h3>
          
          <div class="search-box">
            <input 
              type="text"
              [(ngModel)]="searchQuery"
              placeholder="\u8F38\u5165\u554F\u984C\uFF0CAI \u6703\u627E\u5230\u6700\u76F8\u95DC\u7684\u77E5\u8B58..."
              (keyup.enter)="search()"
            />
            <button class="search-btn" (click)="search()" [disabled]="!searchQuery">
              \u641C\u7D22
            </button>
          </div>
          
          <div class="search-results">
            @if (ragService.isLoading() && ragService.currentRequest() === 'search') {
              <div class="loading-state">
                <span class="spinner"></span>
                \u6B63\u5728\u641C\u7D22...
                <button class="cancel-link" (click)="cancelCurrentRequest()">\u53D6\u6D88</button>
              </div>
            } @else if (ragService.searchResults().length > 0) {
              @for (result of ragService.searchResults(); track result.item.id) {
                <div class="result-card" [class.high-match]="result.similarity >= 0.8">
                  <div class="result-header">
                    <span class="type-badge" [attr.data-type]="result.item.type">
                      {{ getTypeName(result.item.type) }}
                    </span>
                    <span class="similarity">
                      \u5339\u914D\u5EA6: {{ (result.similarity * 100).toFixed(0) }}%
                    </span>
                  </div>
                  <div class="result-question">{{ result.item.question }}</div>
                  <div class="result-answer">{{ result.item.answer }}</div>
                  <div class="result-actions">
                    <button class="action-btn positive" (click)="recordFeedback(result.item.id, true)">
                      \u{1F44D} \u6709\u7528
                    </button>
                    <button class="action-btn negative" (click)="recordFeedback(result.item.id, false)">
                      \u{1F44E} \u7121\u7528
                    </button>
                  </div>
                </div>
              }
            } @else if (searchQuery && !ragService.isLoading()) {
              <div class="empty-state">
                <span class="icon">\u{1F50D}</span>
                <p>\u672A\u627E\u5230\u76F8\u95DC\u77E5\u8B58</p>
                <button class="add-btn" (click)="addNewKnowledge()">\u6DFB\u52A0\u9019\u689D\u77E5\u8B58</button>
              </div>
            } @else {
              <div class="placeholder-state">
                <span class="icon">\u{1F4A1}</span>
                <p>\u8F38\u5165\u554F\u984C\uFF0CAI \u6703\u7528\u8A9E\u7FA9\u7406\u89E3\u627E\u5230\u6700\u76F8\u95DC\u7684\u77E5\u8B58</p>
              </div>
            }
          </div>
        </div>
        
        <!-- \u53F3\u5074\uFF1A\u5BE6\u6642\u5B78\u7FD2 -->
        <div class="learning-section">
          <h3 class="section-title">
            <span class="icon">\u{1F534}</span>
            <span class="live-badge">LIVE</span>
            \u5BE6\u6642\u5B78\u7FD2
          </h3>
          
          <div class="learning-feed">
            @if (ragService.learningEvents().length > 0) {
              @for (event of ragService.learningEvents().slice(0, 10); track event.id) {
                <div class="learning-event" [attr.data-type]="event.type">
                  <div class="event-icon">
                    @switch (event.type) {
                      @case ('new_knowledge') { \u{1F4DA} }
                      @case ('auto_learn') { \u{1F4AC} }
                      @case ('feedback') { \u{1F44D} }
                      @case ('quality_update') { \u{1F4C8} }
                    }
                  </div>
                  <div class="event-content">
                    <div class="event-desc">{{ event.description }}</div>
                    <div class="event-time">{{ formatTime(event.timestamp) }}</div>
                  </div>
                </div>
              }
            } @else {
              <div class="empty-learning">
                <p>\u7B49\u5F85\u5B78\u7FD2\u4E8B\u4EF6...</p>
                <p class="hint">AI \u6703\u5F9E\u5C0D\u8A71\u4E2D\u81EA\u52D5\u5B78\u7FD2</p>
              </div>
            }
          </div>
          
          <!-- \u7DAD\u8B77\u64CD\u4F5C -->
          <div class="maintenance-section">
            <h4>\u77E5\u8B58\u7DAD\u8B77</h4>
            <div class="maintenance-buttons">
              <button class="maint-btn" (click)="cleanupKnowledge()">
                \u{1F9F9} \u6E05\u7406\u4F4E\u8CEA\u91CF
              </button>
              <button class="maint-btn" (click)="mergeKnowledge()">
                \u{1F504} \u5408\u4F75\u76F8\u4F3C
              </button>
              <button class="maint-btn" (click)="refreshStats()">
                \u{1F4CA} \u5237\u65B0\u7D71\u8A08
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- \u{1F195} P0-3: \u77E5\u8B58\u7F3A\u53E3\u9762\u677F\uFF08\u512A\u5316\u7248\uFF09 -->
      @if (ragService.knowledgeGaps().length > 0) {
        <div class="gaps-section">
          <div class="gaps-header">
            <h3 class="section-title">
              <span class="icon">\u{1F514}</span>
              \u77E5\u8B58\u7F3A\u53E3
              <span class="gap-count">({{ ragService.gapsCount() }})</span>
            </h3>
            <div class="gaps-actions-bar">
              <button class="batch-btn cleanup" (click)="cleanupDuplicateGaps()" title="\u4E00\u9375\u6E05\u7406\u6240\u6709\u5783\u573E\u6578\u64DA">
                \u{1F9F9} \u6DF1\u5EA6\u6E05\u7406
              </button>
              @if (selectedGapIds().length > 0) {
                <button class="batch-btn delete-selected" (click)="deleteSelectedGaps()">
                  \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D ({{ selectedGapIds().length }})
                </button>
              }
            </div>
          </div>
          <p class="gaps-hint">\u{1F4A1} \u7528\u6236\u554F\u4E86\u4F46\u77E5\u8B58\u5EAB\u6C92\u6709\u597D\u7B54\u6848\u7684\u554F\u984C\uFF0C\u5EFA\u8B70\u512A\u5148\u8655\u7406\u71B1\u9580\u554F\u984C</p>
          
          <div class="gaps-list">
            @for (gap of ragService.knowledgeGaps().slice(0, 15); track gap.id; let i = $index) {
              <div class="gap-card" [class.selected]="isGapSelected(gap.id)">
                <!-- \u9078\u64C7\u6846 -->
                <div class="gap-select">
                  <input type="checkbox" 
                         [checked]="isGapSelected(gap.id)" 
                         (change)="toggleGapSelection(gap.id)">
                </div>
                
                <!-- \u4E3B\u5167\u5BB9 -->
                <div class="gap-main">
                  <!-- \u9802\u90E8\uFF1A\u554F\u984C + \u6A19\u7C64 -->
                  <div class="gap-top">
                    <span class="gap-query" [title]="gap.query">
                      {{ gap.query.length > 60 ? gap.query.slice(0, 60) + '...' : gap.query }}
                    </span>
                    <div class="gap-tags">
                      @if (gap.hitCount >= 5) {
                        <span class="tag hot">\u{1F525} \u71B1\u9580</span>
                      }
                      @if (gap.category) {
                        <span class="tag category" [class]="'cat-' + gap.category">
                          {{ getCategoryLabel(gap.category) }}
                        </span>
                      }
                      <span class="tag hits">{{ gap.hitCount }}\u6B21</span>
                    </div>
                  </div>
                  
                  <!-- AI \u5EFA\u8B70\uFF08\u5982\u679C\u6709\uFF09 -->
                  @if (gap.suggestedAnswer) {
                    <div class="gap-suggestion">
                      <span class="suggestion-label">\u{1F4A1} AI:</span>
                      <span class="suggestion-text">{{ gap.suggestedAnswer.length > 80 ? gap.suggestedAnswer.slice(0, 80) + '...' : gap.suggestedAnswer }}</span>
                    </div>
                  }
                  
                  <!-- \u64CD\u4F5C\u6309\u9215 -->
                  <div class="gap-actions">
                    @if (!gap.suggestedAnswer) {
                      <button class="gap-btn suggest" (click)="suggestAnswer(gap)" title="\u8B93 AI \u751F\u6210\u5EFA\u8B70\u7B54\u6848">
                        \u{1F916} \u751F\u6210
                      </button>
                    }
                    <button class="gap-btn resolve" (click)="resolveGap(gap)" title="\u63A1\u7528\u4E26\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB">
                      \u2705 \u63A1\u7528
                    </button>
                    <button class="gap-btn delete" (click)="deleteGap(gap)" title="\u76F4\u63A5\u522A\u9664">
                      \u{1F5D1}\uFE0F
                    </button>
                  </div>
                </div>
              </div>
            }
          </div>
          
          @if (ragService.gapsCount() > 15) {
            <div class="gaps-more">
              <span>\u9084\u6709 {{ ragService.gapsCount() - 15 }} \u689D\u672A\u986F\u793A</span>
            </div>
          }
        </div>
      } @else {
        <!-- \u7121\u7F3A\u53E3\u6642\u986F\u793A -->
        <div class="gaps-empty">
          <span class="empty-icon">\u2728</span>
          <p>\u77E5\u8B58\u5EAB\u8986\u84CB\u826F\u597D\uFF0C\u66AB\u7121\u77E5\u8B58\u7F3A\u53E3</p>
        </div>
      }
      
      <!-- \u{1F195} \u5065\u5EB7\u5EA6\u5100\u8868\u677F -->
      @if (ragService.healthReport(); as report) {
        @if (report.overallScore !== undefined) {
          <div class="health-dashboard">
            <h3 class="section-title">
              <span class="icon">\u{1F4CA}</span>
              \u77E5\u8B58\u5EAB\u5065\u5EB7\u5EA6\u5831\u544A
            </h3>
            
            <div class="health-overview">
              <div class="health-score-circle" 
                   [class.healthy]="report.overallScore >= 70"
                   [class.warning]="report.overallScore >= 40 && report.overallScore < 70"
                   [class.danger]="report.overallScore < 40">
                <span class="score-value">{{ report.overallScore }}</span>
                <span class="score-label">\u7E3D\u5206</span>
              </div>
              
              <div class="health-metrics">
                <div class="metric">
                  <span class="metric-label">\u5B8C\u6574\u6027</span>
                  <div class="metric-bar">
                    <div class="bar-fill" [style.width.%]="report.completeness?.score || 0"></div>
                  </div>
                  <span class="metric-value">{{ report.completeness?.score || 0 }}%</span>
                </div>
                
                <div class="metric">
                  <span class="metric-label">\u6548\u679C</span>
                  <div class="metric-bar">
                    <div class="bar-fill" [style.width.%]="report.effectiveness?.score || 0"></div>
                  </div>
                  <span class="metric-value">{{ report.effectiveness?.score || 0 }}%</span>
                </div>
                
                <div class="metric">
                  <span class="metric-label">\u6642\u6548\u6027</span>
                  <div class="metric-bar">
                    <div class="bar-fill" [style.width.%]="report.freshness?.score || 0"></div>
                  </div>
                  <span class="metric-value">{{ report.freshness?.score || 0 }}%</span>
                </div>
              </div>
            </div>
            
            @if (report.suggestions && report.suggestions.length > 0) {
              <div class="health-suggestions">
                <h4>\u{1F4A1} \u512A\u5316\u5EFA\u8B70</h4>
                @for (suggestion of report.suggestions; track suggestion.message) {
                  <div class="suggestion-item" [attr.data-priority]="suggestion.priority">
                    <span class="priority-badge">{{ suggestion.priority === 'high' ? '\u{1F534}' : suggestion.priority === 'medium' ? '\u{1F7E1}' : '\u{1F7E2}' }}</span>
                    {{ suggestion.message }}
                  </div>
                }
              </div>
            }
          </div>
        }
      }
      
      <!-- \u77E5\u8B58\u985E\u578B\u5206\u5E03 -->
      @if (ragService.stats(); as stats) {
        <div class="knowledge-distribution">
          <h3>\u77E5\u8B58\u5206\u5E03</h3>
          <div class="distribution-grid">
            @for (type of getStatTypes(stats.byType); track type.name) {
              <div class="type-card">
                <div class="type-name">{{ type.name }}</div>
                <div class="type-stats">
                  <span class="count">{{ type.count }} \u689D</span>
                  <span class="score">\u8A55\u5206: {{ type.avgScore }}</span>
                </div>
                <div class="type-bar">
                  <div class="bar-fill" 
                       [style.width.%]="(type.count / stats.totalKnowledge) * 100"
                       [style.background]="getTypeColor(type.key)">
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      }
      
      <!-- \u{1F195} \u5F15\u5C0E\u5F0F\u69CB\u5EFA\u5C0D\u8A71\u6846 -->
      @if (ragService.guidedQuestion(); as question) {
        <div class="guided-overlay">
          <div class="guided-dialog">
            <div class="guided-header">
              <span class="step-indicator">\u6B65\u9A5F {{ question.step }} / {{ question.totalSteps }}</span>
              <h3>{{ question.title }}</h3>
              <button class="close-btn" (click)="cancelGuidedBuild()">\u2715</button>
            </div>
            
            <div class="guided-content">
              <p class="question-text">{{ question.question }}</p>
              
              @switch (question.type) {
                @case ('select') {
                  <div class="options-grid">
                    @for (opt of question.options; track opt.id) {
                      <button class="option-btn" 
                              [class.selected]="guidedAnswer === opt.id"
                              (click)="guidedAnswer = opt.id">
                        {{ opt.label }}
                      </button>
                    }
                  </div>
                }
                
                @case ('multiselect') {
                  <div class="options-grid multi">
                    @for (opt of question.options; track opt.id) {
                      <button class="option-btn" 
                              [class.selected]="isOptionSelected(opt.id)"
                              (click)="toggleOption(opt.id)">
                        {{ opt.label }}
                      </button>
                    }
                  </div>
                }
                
                @case ('textarea') {
                  <textarea class="guided-textarea" 
                            [(ngModel)]="guidedAnswer"
                            [placeholder]="question.placeholder || ''"></textarea>
                  @if (question.suggestions && question.suggestions.length) {
                    <div class="suggestions">
                      <span class="label">\u5E38\u898B:</span>
                      @for (s of question.suggestions; track s) {
                        <button class="suggestion-chip" (click)="addSuggestion(s)">{{ s }}</button>
                      }
                    </div>
                  }
                }
              }
            </div>
            
            <div class="guided-footer">
              <button class="cancel-btn" (click)="cancelGuidedBuild()">\u53D6\u6D88</button>
              <button class="next-btn" 
                      [disabled]="!guidedAnswer || ragService.isLoading()"
                      (click)="submitGuidedAnswer()">
                @if (question.step < question.totalSteps) {
                  \u4E0B\u4E00\u6B65 \u2192
                } @else {
                  \u958B\u59CB\u69CB\u5EFA \u2728
                }
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  `, styles: ["/* angular:styles/component:css;d2d2310171463e26aa578f91c17076934a11ddbd8dd295138276659aee1e76b1;D:/tgkz2026/src/ai-center/ai-brain.component.ts */\n.ai-brain-container {\n  padding: 24px;\n  background:\n    linear-gradient(\n      135deg,\n      #0f0f1a 0%,\n      #1a1a2e 100%);\n  min-height: 100vh;\n  color: #fff;\n}\n.task-banner {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(168, 85, 247, 0.15),\n      rgba(59, 130, 246, 0.15));\n  border: 1px solid rgba(168, 85, 247, 0.3);\n  border-radius: 16px;\n  padding: 16px 20px;\n  margin-bottom: 20px;\n}\n.task-title {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 16px;\n  font-weight: 600;\n  color: #e0e0e0;\n  margin-bottom: 12px;\n}\n.task-icon {\n  font-size: 18px;\n}\n.task-list {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.task-item {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 14px;\n  background: rgba(0, 0, 0, 0.3);\n  border-radius: 10px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.task-item:hover {\n  background: rgba(0, 0, 0, 0.5);\n  transform: translateX(4px);\n}\n.task-badge {\n  font-size: 12px;\n}\n.task-text {\n  flex: 1;\n  font-size: 14px;\n  color: #ccc;\n}\n.task-action {\n  font-size: 12px;\n  color: #a855f7;\n  font-weight: 500;\n}\n.task-item.priority-high .task-text {\n  color: #f87171;\n}\n.task-item.priority-medium .task-text {\n  color: #fbbf24;\n}\n.task-item.priority-low .task-text {\n  color: #34d399;\n}\n.brain-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 24px;\n  padding: 16px 24px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 16px;\n  -webkit-backdrop-filter: blur(10px);\n  backdrop-filter: blur(10px);\n}\n.brain-title {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  font-size: 24px;\n  font-weight: bold;\n}\n.brain-icon {\n  font-size: 32px;\n}\n.version-badge {\n  background:\n    linear-gradient(\n      135deg,\n      #667eea 0%,\n      #764ba2 100%);\n  padding: 4px 12px;\n  border-radius: 20px;\n  font-size: 12px;\n  font-weight: 600;\n}\n.brain-stats {\n  display: flex;\n  gap: 32px;\n}\n.stat-item {\n  text-align: center;\n}\n.stat-value {\n  display: block;\n  font-size: 24px;\n  font-weight: bold;\n  color: #667eea;\n}\n.stat-label {\n  font-size: 12px;\n  color: #888;\n}\n.stat-item.health .stat-value {\n  color: #f59e0b;\n}\n.stat-item.health.healthy .stat-value {\n  color: #10b981;\n}\n.brain-content {\n  display: grid;\n  grid-template-columns: 1fr 1fr 1fr;\n  gap: 24px;\n  margin-bottom: 24px;\n}\n.section-title {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 16px;\n  font-size: 16px;\n  font-weight: 600;\n}\n.live-badge {\n  background: #ef4444;\n  padding: 2px 8px;\n  border-radius: 4px;\n  font-size: 10px;\n  animation: pulse 2s infinite;\n}\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n.build-section {\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 16px;\n  padding: 20px;\n}\n.conversation-builder {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.chat-bubble.ai {\n  background: rgba(102, 126, 234, 0.2);\n  padding: 12px 16px;\n  border-radius: 16px 16px 16px 4px;\n  font-size: 14px;\n}\n.business-input {\n  background: rgba(0, 0, 0, 0.3);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 12px;\n  padding: 12px;\n  color: #fff;\n  font-size: 14px;\n  resize: none;\n}\n.business-input:focus {\n  outline: none;\n  border-color: #667eea;\n}\n.build-progress {\n  padding: 12px;\n  background: rgba(102, 126, 234, 0.1);\n  border-radius: 8px;\n}\n.progress-bar {\n  height: 4px;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 2px;\n  overflow: hidden;\n  margin-bottom: 8px;\n}\n.progress-fill {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #667eea,\n      #764ba2);\n  transition: width 0.3s;\n}\n.progress-text {\n  font-size: 12px;\n  color: #888;\n}\n.build-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  padding: 14px;\n  background:\n    linear-gradient(\n      135deg,\n      #667eea 0%,\n      #764ba2 100%);\n  border: none;\n  border-radius: 12px;\n  color: #fff;\n  font-size: 15px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s;\n}\n.build-btn:hover:not(:disabled) {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);\n}\n.build-btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n.quick-import {\n  margin-top: 20px;\n  padding-top: 20px;\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\n}\n.quick-import h4 {\n  font-size: 13px;\n  color: #888;\n  margin-bottom: 12px;\n}\n.import-buttons {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.import-btn {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 14px;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  color: #fff;\n  font-size: 13px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.import-btn:hover {\n  background: rgba(255, 255, 255, 0.1);\n  border-color: #667eea;\n}\n.import-btn.guided {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(102, 126, 234, 0.2),\n      rgba(118, 75, 162, 0.2));\n  border-color: #667eea;\n}\n.search-section {\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 16px;\n  padding: 20px;\n}\n.search-box {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 16px;\n}\n.search-box input {\n  flex: 1;\n  padding: 12px 16px;\n  background: rgba(0, 0, 0, 0.3);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 8px;\n  color: #fff;\n  font-size: 14px;\n}\n.search-box input:focus {\n  outline: none;\n  border-color: #667eea;\n}\n.search-btn {\n  padding: 12px 20px;\n  background: #667eea;\n  border: none;\n  border-radius: 8px;\n  color: #fff;\n  font-weight: 600;\n  cursor: pointer;\n}\n.search-btn:disabled {\n  opacity: 0.5;\n}\n.search-results {\n  max-height: 400px;\n  overflow-y: auto;\n}\n.result-card {\n  background: rgba(0, 0, 0, 0.2);\n  border: 1px solid rgba(255, 255, 255, 0.05);\n  border-radius: 12px;\n  padding: 14px;\n  margin-bottom: 12px;\n}\n.result-card.high-match {\n  border-color: #10b981;\n}\n.result-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n.type-badge {\n  padding: 4px 10px;\n  border-radius: 12px;\n  font-size: 11px;\n  font-weight: 600;\n  background: rgba(102, 126, 234, 0.2);\n  color: #667eea;\n}\n.similarity {\n  font-size: 12px;\n  color: #10b981;\n}\n.result-question {\n  font-weight: 600;\n  margin-bottom: 6px;\n  font-size: 14px;\n}\n.result-answer {\n  font-size: 13px;\n  color: #aaa;\n  line-height: 1.5;\n}\n.result-actions {\n  display: flex;\n  gap: 8px;\n  margin-top: 12px;\n}\n.action-btn {\n  padding: 6px 12px;\n  border-radius: 6px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn.positive {\n  background: rgba(16, 185, 129, 0.1);\n  border: 1px solid rgba(16, 185, 129, 0.3);\n  color: #10b981;\n}\n.action-btn.negative {\n  background: rgba(239, 68, 68, 0.1);\n  border: 1px solid rgba(239, 68, 68, 0.3);\n  color: #ef4444;\n}\n.action-btn:hover {\n  transform: scale(1.05);\n}\n.empty-state,\n.placeholder-state,\n.loading-state {\n  text-align: center;\n  padding: 40px 20px;\n  color: #888;\n}\n.empty-state .icon,\n.placeholder-state .icon {\n  font-size: 48px;\n  margin-bottom: 12px;\n}\n.add-btn {\n  margin-top: 12px;\n  padding: 10px 20px;\n  background: #667eea;\n  border: none;\n  border-radius: 8px;\n  color: #fff;\n  cursor: pointer;\n}\n.learning-section {\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 16px;\n  padding: 20px;\n}\n.learning-feed {\n  max-height: 300px;\n  overflow-y: auto;\n}\n.learning-event {\n  display: flex;\n  gap: 12px;\n  padding: 10px;\n  background: rgba(0, 0, 0, 0.2);\n  border-radius: 8px;\n  margin-bottom: 8px;\n}\n.event-icon {\n  font-size: 20px;\n}\n.event-desc {\n  font-size: 13px;\n}\n.event-time {\n  font-size: 11px;\n  color: #666;\n}\n.empty-learning {\n  text-align: center;\n  padding: 30px;\n  color: #666;\n}\n.empty-learning .hint {\n  font-size: 12px;\n  color: #555;\n}\n.maintenance-section {\n  margin-top: 20px;\n  padding-top: 16px;\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\n}\n.maintenance-section h4 {\n  font-size: 13px;\n  color: #888;\n  margin-bottom: 12px;\n}\n.maintenance-buttons {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n.maint-btn {\n  padding: 8px 12px;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 6px;\n  color: #aaa;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.maint-btn:hover {\n  background: rgba(255, 255, 255, 0.1);\n  color: #fff;\n}\n.knowledge-distribution {\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 16px;\n  padding: 20px;\n}\n.knowledge-distribution h3 {\n  margin-bottom: 16px;\n  font-size: 16px;\n}\n.distribution-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n  gap: 12px;\n}\n.type-card {\n  background: rgba(0, 0, 0, 0.2);\n  border-radius: 8px;\n  padding: 12px;\n}\n.type-name {\n  font-weight: 600;\n  margin-bottom: 6px;\n}\n.type-stats {\n  display: flex;\n  justify-content: space-between;\n  font-size: 12px;\n  color: #888;\n  margin-bottom: 8px;\n}\n.type-bar {\n  height: 4px;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 2px;\n  overflow: hidden;\n}\n.bar-fill {\n  height: 100%;\n  border-radius: 2px;\n}\n.spinner {\n  display: inline-block;\n  width: 16px;\n  height: 16px;\n  border: 2px solid rgba(255, 255, 255, 0.3);\n  border-top-color: #fff;\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n.cancel-request-btn {\n  display: block;\n  width: 100%;\n  margin-top: 8px;\n  padding: 10px;\n  background: rgba(239, 68, 68, 0.2);\n  border: 1px solid rgba(239, 68, 68, 0.4);\n  border-radius: 8px;\n  color: #ef4444;\n  font-size: 13px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.cancel-request-btn:hover {\n  background: rgba(239, 68, 68, 0.3);\n}\n.cancel-link {\n  display: block;\n  margin-top: 8px;\n  background: none;\n  border: none;\n  color: #888;\n  font-size: 12px;\n  cursor: pointer;\n  text-decoration: underline;\n}\n.cancel-link:hover {\n  color: #ef4444;\n}\n@media (max-width: 1200px) {\n  .brain-content {\n    grid-template-columns: 1fr 1fr;\n  }\n  .learning-section {\n    grid-column: span 2;\n  }\n}\n@media (max-width: 768px) {\n  .brain-content {\n    grid-template-columns: 1fr;\n  }\n  .learning-section {\n    grid-column: auto;\n  }\n  .brain-header {\n    flex-direction: column;\n    gap: 16px;\n  }\n  .brain-stats {\n    flex-wrap: wrap;\n    justify-content: center;\n  }\n}\n.gaps-section {\n  background:\n    linear-gradient(\n      135deg,\n      rgba(239, 68, 68, 0.08),\n      rgba(168, 85, 247, 0.08));\n  border: 1px solid rgba(239, 68, 68, 0.2);\n  border-radius: 16px;\n  padding: 20px;\n  margin-bottom: 24px;\n}\n.gaps-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n.gap-count {\n  color: #ef4444;\n  font-weight: bold;\n}\n.gaps-actions-bar {\n  display: flex;\n  gap: 8px;\n}\n.gaps-hint {\n  font-size: 13px;\n  color: #888;\n  margin-bottom: 16px;\n}\n.gaps-list {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n.gap-card {\n  display: flex;\n  gap: 12px;\n  background: rgba(0, 0, 0, 0.3);\n  border-radius: 12px;\n  padding: 12px;\n  transition: all 0.2s;\n  border: 1px solid transparent;\n}\n.gap-card:hover {\n  background: rgba(0, 0, 0, 0.4);\n  border-color: rgba(168, 85, 247, 0.3);\n}\n.gap-card.selected {\n  background: rgba(168, 85, 247, 0.15);\n  border-color: rgba(168, 85, 247, 0.5);\n}\n.gap-select {\n  display: flex;\n  align-items: flex-start;\n  padding-top: 4px;\n}\n.gap-select input[type=checkbox] {\n  width: 18px;\n  height: 18px;\n  cursor: pointer;\n  accent-color: #a855f7;\n}\n.gap-main {\n  flex: 1;\n  min-width: 0;\n}\n.gap-top {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  gap: 12px;\n  margin-bottom: 8px;\n}\n.gap-query {\n  font-size: 14px;\n  color: #e0e0e0;\n  flex: 1;\n  line-height: 1.4;\n}\n.gap-tags {\n  display: flex;\n  gap: 6px;\n  flex-shrink: 0;\n}\n.tag {\n  font-size: 11px;\n  padding: 2px 8px;\n  border-radius: 10px;\n  white-space: nowrap;\n}\n.tag.hot {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.tag.hits {\n  background: rgba(100, 116, 139, 0.3);\n  color: #94a3b8;\n}\n.tag.category {\n  background: rgba(168, 85, 247, 0.2);\n  color: #c4b5fd;\n}\n.tag.cat-price {\n  background: rgba(234, 179, 8, 0.2);\n  color: #fbbf24;\n}\n.tag.cat-process {\n  background: rgba(59, 130, 246, 0.2);\n  color: #60a5fa;\n}\n.tag.cat-product {\n  background: rgba(16, 185, 129, 0.2);\n  color: #34d399;\n}\n.tag.cat-support {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.gap-suggestion {\n  display: flex;\n  gap: 6px;\n  font-size: 12px;\n  color: #888;\n  margin-bottom: 8px;\n  padding: 6px 10px;\n  background: rgba(168, 85, 247, 0.1);\n  border-radius: 6px;\n}\n.suggestion-label {\n  color: #a855f7;\n  flex-shrink: 0;\n}\n.suggestion-text {\n  color: #aaa;\n}\n.gap-actions {\n  display: flex;\n  gap: 6px;\n}\n.gap-btn {\n  padding: 4px 10px;\n  border-radius: 6px;\n  border: none;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.gap-btn.suggest {\n  background: rgba(168, 85, 247, 0.2);\n  color: #c4b5fd;\n}\n.gap-btn.resolve {\n  background: rgba(16, 185, 129, 0.2);\n  color: #34d399;\n}\n.gap-btn.delete {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.gap-btn:hover {\n  filter: brightness(1.2);\n}\n.batch-btn {\n  padding: 6px 12px;\n  border-radius: 8px;\n  border: none;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.batch-btn.cleanup {\n  background: rgba(234, 179, 8, 0.2);\n  color: #fbbf24;\n}\n.batch-btn.delete-selected {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.gaps-more {\n  text-align: center;\n  padding: 12px;\n  color: #666;\n  font-size: 13px;\n}\n.gaps-empty {\n  text-align: center;\n  padding: 40px;\n  color: #666;\n}\n.gaps-empty .empty-icon {\n  font-size: 48px;\n  display: block;\n  margin-bottom: 12px;\n}\n.gaps-list {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.gap-card {\n  background: rgba(0, 0, 0, 0.3);\n  border-radius: 12px;\n  padding: 14px;\n}\n.gap-header {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 10px;\n}\n.gap-query {\n  font-weight: 600;\n  color: #fff;\n}\n.gap-hits {\n  background: #ef4444;\n  padding: 2px 8px;\n  border-radius: 10px;\n  font-size: 11px;\n}\n.gap-suggestion {\n  background: rgba(102, 126, 234, 0.1);\n  padding: 10px;\n  border-radius: 8px;\n  font-size: 13px;\n  color: #aaa;\n  margin-bottom: 10px;\n}\n.gap-actions {\n  display: flex;\n  gap: 8px;\n}\n.gap-btn {\n  padding: 6px 12px;\n  border-radius: 6px;\n  font-size: 12px;\n  cursor: pointer;\n  border: none;\n  transition: all 0.2s;\n}\n.gap-btn.suggest {\n  background: rgba(102, 126, 234, 0.2);\n  color: #667eea;\n}\n.gap-btn.resolve {\n  background: rgba(16, 185, 129, 0.2);\n  color: #10b981;\n}\n.gap-btn.ignore {\n  background: rgba(107, 114, 128, 0.2);\n  color: #9ca3af;\n}\n.gap-btn.delete {\n  background: rgba(239, 68, 68, 0.2);\n  color: #ef4444;\n}\n.gap-btn.delete:hover {\n  background: rgba(239, 68, 68, 0.4);\n}\n.gap-btn:hover {\n  transform: scale(1.05);\n}\n.batch-btn {\n  margin-left: auto;\n  padding: 6px 12px;\n  border: none;\n  border-radius: 8px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.batch-btn.cleanup {\n  background: rgba(245, 158, 11, 0.2);\n  color: #f59e0b;\n}\n.batch-btn.cleanup:hover {\n  background: rgba(245, 158, 11, 0.4);\n}\n.health-dashboard {\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 16px;\n  padding: 20px;\n  margin-bottom: 24px;\n}\n.health-overview {\n  display: flex;\n  gap: 30px;\n  align-items: center;\n}\n.health-score-circle {\n  width: 100px;\n  height: 100px;\n  border-radius: 50%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  background: rgba(0, 0, 0, 0.3);\n  border: 3px solid #667eea;\n}\n.health-score-circle.healthy {\n  border-color: #10b981;\n}\n.health-score-circle.warning {\n  border-color: #f59e0b;\n}\n.health-score-circle.danger {\n  border-color: #ef4444;\n}\n.score-value {\n  font-size: 28px;\n  font-weight: bold;\n}\n.score-label {\n  font-size: 12px;\n  color: #888;\n}\n.health-metrics {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n.metric {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n.metric-label {\n  width: 60px;\n  font-size: 13px;\n  color: #888;\n}\n.metric-bar {\n  flex: 1;\n  height: 8px;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 4px;\n  overflow: hidden;\n}\n.metric-bar .bar-fill {\n  height: 100%;\n  background:\n    linear-gradient(\n      90deg,\n      #667eea,\n      #764ba2);\n  border-radius: 4px;\n}\n.metric-value {\n  width: 40px;\n  text-align: right;\n  font-size: 13px;\n  font-weight: 600;\n}\n.health-suggestions {\n  margin-top: 20px;\n  padding-top: 16px;\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\n}\n.health-suggestions h4 {\n  font-size: 14px;\n  margin-bottom: 12px;\n}\n.suggestion-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  background: rgba(0, 0, 0, 0.2);\n  border-radius: 8px;\n  margin-bottom: 8px;\n  font-size: 13px;\n}\n.guided-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.8);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n.guided-dialog {\n  background: #1a1a2e;\n  border-radius: 20px;\n  width: 90%;\n  max-width: 600px;\n  max-height: 80vh;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n.guided-header {\n  padding: 20px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n  position: relative;\n}\n.step-indicator {\n  font-size: 12px;\n  color: #667eea;\n  margin-bottom: 4px;\n  display: block;\n}\n.guided-header h3 {\n  margin: 0;\n  font-size: 20px;\n}\n.close-btn {\n  position: absolute;\n  top: 16px;\n  right: 16px;\n  background: none;\n  border: none;\n  color: #888;\n  font-size: 20px;\n  cursor: pointer;\n}\n.guided-content {\n  padding: 20px;\n  flex: 1;\n  overflow-y: auto;\n}\n.question-text {\n  font-size: 16px;\n  margin-bottom: 20px;\n}\n.options-grid {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 10px;\n}\n.options-grid.multi {\n  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));\n}\n.option-btn {\n  padding: 14px;\n  background: rgba(255, 255, 255, 0.05);\n  border: 2px solid rgba(255, 255, 255, 0.1);\n  border-radius: 12px;\n  color: #fff;\n  font-size: 14px;\n  cursor: pointer;\n  transition: all 0.2s;\n  text-align: left;\n}\n.option-btn:hover {\n  border-color: #667eea;\n}\n.option-btn.selected {\n  border-color: #667eea;\n  background: rgba(102, 126, 234, 0.2);\n}\n.guided-textarea {\n  width: 100%;\n  min-height: 120px;\n  padding: 14px;\n  background: rgba(0, 0, 0, 0.3);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 12px;\n  color: #fff;\n  font-size: 14px;\n  resize: vertical;\n}\n.suggestions {\n  margin-top: 12px;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  align-items: center;\n}\n.suggestions .label {\n  font-size: 12px;\n  color: #888;\n}\n.suggestion-chip {\n  padding: 4px 10px;\n  background: rgba(102, 126, 234, 0.2);\n  border: none;\n  border-radius: 12px;\n  color: #667eea;\n  font-size: 12px;\n  cursor: pointer;\n}\n.guided-footer {\n  padding: 16px 20px;\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n}\n.cancel-btn {\n  padding: 10px 20px;\n  background: transparent;\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  border-radius: 8px;\n  color: #888;\n  cursor: pointer;\n}\n.next-btn {\n  padding: 10px 24px;\n  background:\n    linear-gradient(\n      135deg,\n      #667eea,\n      #764ba2);\n  border: none;\n  border-radius: 8px;\n  color: #fff;\n  font-weight: 600;\n  cursor: pointer;\n}\n.next-btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n/*# sourceMappingURL=ai-brain.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(AIBrainComponent, { className: "AIBrainComponent", filePath: "src/ai-center/ai-brain.component.ts", lineNumber: 1760 });
})();

// src/ai-center/knowledge-gaps.component.ts
var _forTrack021 = ($index, $item) => $item.id;
function KnowledgeGapsComponent_Conditional_88_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 38);
    \u0275\u0275listener("click", function KnowledgeGapsComponent_Conditional_88_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.deleteSelected());
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "button", 39);
    \u0275\u0275listener("click", function KnowledgeGapsComponent_Conditional_88_Template_button_click_2_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.batchResolve());
    });
    \u0275\u0275text(3, " \u2705 \u6279\u91CF\u63A1\u7528 ");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (", ctx_r1.selectedIds().length, ") ");
  }
}
function KnowledgeGapsComponent_Conditional_90_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 36);
    \u0275\u0275element(1, "span", 40);
    \u0275\u0275elementStart(2, "span");
    \u0275\u0275text(3, "\u8F09\u5165\u4E2D...");
    \u0275\u0275elementEnd()();
  }
}
function KnowledgeGapsComponent_Conditional_91_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 37)(1, "span", 41);
    \u0275\u0275text(2, "\u2728");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "h3");
    \u0275\u0275text(4, "\u6C92\u6709\u5F85\u8655\u7406\u7684\u77E5\u8B58\u7F3A\u53E3");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p");
    \u0275\u0275text(6, "\u77E5\u8B58\u5EAB\u8986\u84CB\u826F\u597D\uFF0C\u7E7C\u7E8C\u4FDD\u6301\uFF01");
    \u0275\u0275elementEnd()();
  }
}
function KnowledgeGapsComponent_Conditional_92_For_1_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 52)(1, "span", 61);
    \u0275\u0275text(2, "\u{1F4A1} AI:");
    \u0275\u0275elementEnd();
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const gap_r4 = \u0275\u0275nextContext().$implicit;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", ctx_r1.truncateText(gap_r4.suggestedAnswer, 100), " ");
  }
}
function KnowledgeGapsComponent_Conditional_92_For_1_Conditional_15_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 55);
    \u0275\u0275text(1, "\u{1F525}");
    \u0275\u0275elementEnd();
  }
}
function KnowledgeGapsComponent_Conditional_92_For_1_Conditional_19_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 62);
    \u0275\u0275listener("click", function KnowledgeGapsComponent_Conditional_92_For_1_Conditional_19_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r5);
      const gap_r4 = \u0275\u0275nextContext().$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.generateAnswer(gap_r4));
    });
    \u0275\u0275text(1, " \u{1F916} ");
    \u0275\u0275elementEnd();
  }
}
function KnowledgeGapsComponent_Conditional_92_For_1_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 44)(1, "div", 45)(2, "input", 46);
    \u0275\u0275listener("change", function KnowledgeGapsComponent_Conditional_92_For_1_Template_input_change_2_listener() {
      const gap_r4 = \u0275\u0275restoreView(_r3).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.toggleSelect(gap_r4.id));
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(3, "div", 47);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "div", 48)(6, "span", 49);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(8, "div", 50)(9, "div", 51);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(11, KnowledgeGapsComponent_Conditional_92_For_1_Conditional_11_Template, 4, 1, "div", 52);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "div", 53)(13, "span", 54);
    \u0275\u0275text(14);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(15, KnowledgeGapsComponent_Conditional_92_For_1_Conditional_15_Template, 2, 0, "span", 55);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "div", 56);
    \u0275\u0275text(17);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "div", 57);
    \u0275\u0275conditionalCreate(19, KnowledgeGapsComponent_Conditional_92_For_1_Conditional_19_Template, 2, 0, "button", 58);
    \u0275\u0275elementStart(20, "button", 59);
    \u0275\u0275listener("click", function KnowledgeGapsComponent_Conditional_92_For_1_Template_button_click_20_listener() {
      const gap_r4 = \u0275\u0275restoreView(_r3).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.resolveGap(gap_r4));
    });
    \u0275\u0275text(21, " \u2705 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(22, "button", 60);
    \u0275\u0275listener("click", function KnowledgeGapsComponent_Conditional_92_For_1_Template_button_click_22_listener() {
      const gap_r4 = \u0275\u0275restoreView(_r3).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.deleteGap(gap_r4));
    });
    \u0275\u0275text(23, " \u{1F5D1}\uFE0F ");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const gap_r4 = ctx.$implicit;
    const \u0275$index_175_r6 = ctx.$index;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275classProp("selected", ctx_r1.isSelected(gap_r4.id));
    \u0275\u0275advance(2);
    \u0275\u0275property("checked", ctx_r1.isSelected(gap_r4.id));
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate((ctx_r1.currentPage() - 1) * ctx_r1.pageSize + \u0275$index_175_r6 + 1);
    \u0275\u0275advance(2);
    \u0275\u0275classMap("cat-" + (gap_r4.category || "other"));
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.getCategoryIcon(gap_r4.category), " ");
    \u0275\u0275advance(2);
    \u0275\u0275property("title", gap_r4.query);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.truncateText(gap_r4.query, 80), " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(gap_r4.suggestedAnswer ? 11 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275classProp("hot", gap_r4.hitCount >= 5);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", gap_r4.hitCount, "\u6B21 ");
    \u0275\u0275advance();
    \u0275\u0275conditional(gap_r4.hitCount >= 5 ? 15 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", ctx_r1.formatTime(gap_r4.createdAt), " ");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(!gap_r4.suggestedAnswer ? 19 : -1);
  }
}
function KnowledgeGapsComponent_Conditional_92_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 43)(1, "button", 63);
    \u0275\u0275listener("click", function KnowledgeGapsComponent_Conditional_92_Conditional_2_Template_button_click_1_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.goToPage(ctx_r1.currentPage() - 1));
    });
    \u0275\u0275text(2, " \u2190 \u4E0A\u4E00\u9801 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 64);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "button", 63);
    \u0275\u0275listener("click", function KnowledgeGapsComponent_Conditional_92_Conditional_2_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.goToPage(ctx_r1.currentPage() + 1));
    });
    \u0275\u0275text(6, " \u4E0B\u4E00\u9801 \u2192 ");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275property("disabled", ctx_r1.currentPage() === 1);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate3(" \u7B2C ", ctx_r1.currentPage(), " / ", ctx_r1.totalPages(), " \u9801 \uFF08\u5171 ", ctx_r1.filteredGaps().length, " \u689D\uFF09 ");
    \u0275\u0275advance();
    \u0275\u0275property("disabled", ctx_r1.currentPage() === ctx_r1.totalPages());
  }
}
function KnowledgeGapsComponent_Conditional_92_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275repeaterCreate(0, KnowledgeGapsComponent_Conditional_92_For_1_Template, 24, 16, "div", 42, _forTrack021);
    \u0275\u0275conditionalCreate(2, KnowledgeGapsComponent_Conditional_92_Conditional_2_Template, 7, 5, "div", 43);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275repeater(ctx_r1.paginatedGaps());
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.totalPages() > 1 ? 2 : -1);
  }
}
var KnowledgeGapsComponent = class _KnowledgeGapsComponent {
  constructor() {
    this.ragService = inject(RAGBrainService);
    this.dialogService = inject(DialogService);
    this.toastService = inject(ToastService);
    this.isLoading = signal(false, ...ngDevMode ? [{ debugName: "isLoading" }] : []);
    this.gaps = signal([], ...ngDevMode ? [{ debugName: "gaps" }] : []);
    this.selectedIds = signal([], ...ngDevMode ? [{ debugName: "selectedIds" }] : []);
    this.currentPage = signal(1, ...ngDevMode ? [{ debugName: "currentPage" }] : []);
    this.pageSize = 20;
    this.categoryFilter = "all";
    this.sortOption = "hitCount";
    this.filteredGaps = computed(() => {
      let result = [...this.gaps()];
      if (this.categoryFilter !== "all") {
        result = result.filter((g) => (g.category || "other") === this.categoryFilter);
      }
      result.sort((a, b) => {
        switch (this.sortOption) {
          case "hitCount":
            return b.hitCount - a.hitCount;
          case "createdAt":
            return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();
          case "category":
            return (a.category || "z").localeCompare(b.category || "z");
          default:
            return 0;
        }
      });
      return result;
    }, ...ngDevMode ? [{ debugName: "filteredGaps" }] : []);
    this.paginatedGaps = computed(() => {
      const start = (this.currentPage() - 1) * this.pageSize;
      return this.filteredGaps().slice(start, start + this.pageSize);
    }, ...ngDevMode ? [{ debugName: "paginatedGaps" }] : []);
    this.totalPages = computed(() => Math.ceil(this.filteredGaps().length / this.pageSize), ...ngDevMode ? [{ debugName: "totalPages" }] : []);
    this.totalGaps = computed(() => this.gaps().length, ...ngDevMode ? [{ debugName: "totalGaps" }] : []);
    this.hotGapsCount = computed(() => this.gaps().filter((g) => g.hitCount >= 5).length, ...ngDevMode ? [{ debugName: "hotGapsCount" }] : []);
    this.categoryStats = computed(() => {
      const stats = { price: 0, process: 0, product: 0, support: 0, other: 0 };
      this.gaps().forEach((g) => {
        const cat = g.category || "other";
        if (stats[cat] !== void 0)
          stats[cat]++;
      });
      return stats;
    }, ...ngDevMode ? [{ debugName: "categoryStats" }] : []);
  }
  ngOnInit() {
    this.loadGaps();
  }
  async loadGaps() {
    this.isLoading.set(true);
    try {
      await this.ragService.getKnowledgeGaps();
      this.gaps.set(this.ragService.knowledgeGaps());
    } finally {
      this.isLoading.set(false);
    }
  }
  refreshGaps() {
    this.loadGaps();
    this.toastService.success("\u5DF2\u5237\u65B0");
  }
  applyFilters() {
    this.currentPage.set(1);
    this.selectedIds.set([]);
  }
  // ==================== 選擇操作 ====================
  isSelected(id) {
    return this.selectedIds().includes(id);
  }
  toggleSelect(id) {
    const current = this.selectedIds();
    if (current.includes(id)) {
      this.selectedIds.set(current.filter((i) => i !== id));
    } else {
      this.selectedIds.set([...current, id]);
    }
  }
  isAllSelected() {
    const current = this.paginatedGaps();
    return current.length > 0 && current.every((g) => this.selectedIds().includes(g.id));
  }
  isPartialSelected() {
    const current = this.paginatedGaps();
    const selected = current.filter((g) => this.selectedIds().includes(g.id));
    return selected.length > 0 && selected.length < current.length;
  }
  toggleSelectAll() {
    const current = this.paginatedGaps();
    if (this.isAllSelected()) {
      const currentIds = current.map((g) => g.id);
      this.selectedIds.set(this.selectedIds().filter((id) => !currentIds.includes(id)));
    } else {
      const newIds = [.../* @__PURE__ */ new Set([...this.selectedIds(), ...current.map((g) => g.id)])];
      this.selectedIds.set(newIds);
    }
  }
  // ==================== 操作方法 ====================
  generateAnswer(gap) {
    this.ragService.suggestGapAnswer(gap.id, gap.query);
    this.toastService.info("\u6B63\u5728\u751F\u6210 AI \u5EFA\u8B70...");
  }
  resolveGap(gap) {
    const answer = gap.suggestedAnswer || "";
    this.dialogService.prompt({
      title: "\u89E3\u6C7A\u77E5\u8B58\u7F3A\u53E3",
      message: `\u554F\u984C: "${this.truncateText(gap.query, 60)}"

\u8ACB\u8F38\u5165\u56DE\u7B54:`,
      placeholder: answer || "\u5C08\u696D\u7684\u56DE\u7B54...",
      defaultValue: answer,
      confirmText: "\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB",
      onConfirm: (finalAnswer) => {
        if (finalAnswer) {
          this.ragService.resolveGap(gap.id, "faq", gap.query, finalAnswer);
          this.toastService.success("\u5DF2\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB");
          this.loadGaps();
        }
      }
    });
  }
  deleteGap(gap) {
    this.ragService.deleteGap(gap.id);
    this.gaps.set(this.gaps().filter((g) => g.id !== gap.id));
    this.toastService.success("\u5DF2\u522A\u9664");
  }
  deleteSelected() {
    const ids = this.selectedIds();
    if (ids.length === 0)
      return;
    this.ragService.deleteGapsBatch(ids);
    this.gaps.set(this.gaps().filter((g) => !ids.includes(g.id)));
    this.selectedIds.set([]);
    this.toastService.success(`\u5DF2\u522A\u9664 ${ids.length} \u689D`);
  }
  batchResolve() {
    const selected = this.paginatedGaps().filter((g) => this.selectedIds().includes(g.id) && g.suggestedAnswer);
    if (selected.length === 0) {
      this.toastService.warning("\u8ACB\u9078\u64C7\u6709 AI \u5EFA\u8B70\u7684\u7F3A\u53E3");
      return;
    }
    selected.forEach((gap) => {
      this.ragService.resolveGap(gap.id, "faq", gap.query, gap.suggestedAnswer);
    });
    this.selectedIds.set([]);
    this.toastService.success(`\u5DF2\u6279\u91CF\u63A1\u7528 ${selected.length} \u689D`);
    this.loadGaps();
  }
  cleanupAllInvalid() {
    this.ragService.cleanupDuplicateGaps();
    this.toastService.info("\u6B63\u5728\u6DF1\u5EA6\u6E05\u7406...");
    setTimeout(() => this.loadGaps(), 1500);
  }
  // ==================== 分頁 ====================
  goToPage(page) {
    if (page >= 1 && page <= this.totalPages()) {
      this.currentPage.set(page);
      this.selectedIds.set([]);
    }
  }
  // ==================== 輔助方法 ====================
  truncateText(text, maxLength) {
    if (!text)
      return "";
    return text.length > maxLength ? text.slice(0, maxLength) + "..." : text;
  }
  getCategoryIcon(category) {
    const icons = {
      "price": "\u{1F4B0}",
      "process": "\u{1F4CB}",
      "product": "\u{1F4E6}",
      "support": "\u{1F6E0}\uFE0F",
      "other": "\u2753"
    };
    return icons[category || "other"] || "\u2753";
  }
  formatTime(timestamp) {
    if (!timestamp)
      return "";
    const date = new Date(timestamp);
    const now = /* @__PURE__ */ new Date();
    const diff = now.getTime() - date.getTime();
    if (diff < 6e4)
      return "\u525B\u525B";
    if (diff < 36e5)
      return `${Math.floor(diff / 6e4)} \u5206\u9418\u524D`;
    if (diff < 864e5)
      return `${Math.floor(diff / 36e5)} \u5C0F\u6642\u524D`;
    if (diff < 6048e5)
      return `${Math.floor(diff / 864e5)} \u5929\u524D`;
    return date.toLocaleDateString("zh-TW");
  }
  static {
    this.\u0275fac = function KnowledgeGapsComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _KnowledgeGapsComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _KnowledgeGapsComponent, selectors: [["app-knowledge-gaps"]], decls: 93, vars: 11, consts: [[1, "gaps-page"], [1, "page-header"], [1, "header-left"], [1, "page-title"], [1, "title-icon"], [1, "page-desc"], [1, "header-actions"], [1, "action-btn", "cleanup", 3, "click"], [1, "action-btn", "refresh", 3, "click"], [1, "stats-overview"], [1, "stat-card", "total"], [1, "stat-icon"], [1, "stat-info"], [1, "stat-value"], [1, "stat-label"], [1, "stat-card", "hot"], [1, "stat-card", "price"], [1, "stat-card", "process"], [1, "stat-card", "product"], [1, "filter-bar"], [1, "filter-left"], [1, "select-all"], ["type", "checkbox", 3, "change", "checked", "indeterminate"], [1, "filter-group"], [3, "ngModelChange", "change", "ngModel"], ["value", "all"], ["value", "price"], ["value", "process"], ["value", "product"], ["value", "support"], ["value", "other"], ["value", "hitCount"], ["value", "createdAt"], ["value", "category"], [1, "filter-right"], [1, "gaps-list"], [1, "loading-state"], [1, "empty-state"], [1, "batch-btn", "delete", 3, "click"], [1, "batch-btn", "resolve", 3, "click"], [1, "spinner"], [1, "empty-icon"], [1, "gap-row", 3, "selected"], [1, "pagination"], [1, "gap-row"], [1, "gap-checkbox"], ["type", "checkbox", 3, "change", "checked"], [1, "gap-index"], [1, "gap-category"], [1, "category-tag"], [1, "gap-content"], [1, "gap-query", 3, "title"], [1, "gap-answer"], [1, "gap-hits"], [1, "hits-badge"], [1, "hot-tag"], [1, "gap-time"], [1, "gap-actions"], ["title", "AI \u751F\u6210\u7B54\u6848", 1, "btn-icon", "generate"], ["title", "\u63A1\u7528\u4E26\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB", 1, "btn-icon", "resolve", 3, "click"], ["title", "\u522A\u9664", 1, "btn-icon", "delete", 3, "click"], [1, "answer-label"], ["title", "AI \u751F\u6210\u7B54\u6848", 1, "btn-icon", "generate", 3, "click"], [1, "page-btn", 3, "click", "disabled"], [1, "page-info"]], template: function KnowledgeGapsComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0)(1, "div", 1)(2, "div", 2)(3, "h1", 3)(4, "span", 4);
        \u0275\u0275text(5, "\u2753");
        \u0275\u0275elementEnd();
        \u0275\u0275text(6, " \u77E5\u8B58\u7F3A\u53E3\u7BA1\u7406 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(7, "p", 5);
        \u0275\u0275text(8, "\u7528\u6236\u554F\u4E86\u4F46\u77E5\u8B58\u5EAB\u6C92\u6709\u7B54\u6848\u7684\u554F\u984C\uFF0C\u512A\u5148\u8655\u7406\u71B1\u9580\u554F\u984C\u53EF\u63D0\u5347 AI \u56DE\u8986\u8CEA\u91CF");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(9, "div", 6)(10, "button", 7);
        \u0275\u0275listener("click", function KnowledgeGapsComponent_Template_button_click_10_listener() {
          return ctx.cleanupAllInvalid();
        });
        \u0275\u0275text(11, " \u{1F9F9} \u6DF1\u5EA6\u6E05\u7406 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(12, "button", 8);
        \u0275\u0275listener("click", function KnowledgeGapsComponent_Template_button_click_12_listener() {
          return ctx.refreshGaps();
        });
        \u0275\u0275text(13, " \u{1F504} \u5237\u65B0 ");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(14, "div", 9)(15, "div", 10)(16, "div", 11);
        \u0275\u0275text(17, "\u{1F4CB}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(18, "div", 12)(19, "span", 13);
        \u0275\u0275text(20);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(21, "span", 14);
        \u0275\u0275text(22, "\u5F85\u8655\u7406");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(23, "div", 15)(24, "div", 11);
        \u0275\u0275text(25, "\u{1F525}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(26, "div", 12)(27, "span", 13);
        \u0275\u0275text(28);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(29, "span", 14);
        \u0275\u0275text(30, "\u71B1\u9580\u554F\u984C");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(31, "div", 16)(32, "div", 11);
        \u0275\u0275text(33, "\u{1F4B0}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(34, "div", 12)(35, "span", 13);
        \u0275\u0275text(36);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(37, "span", 14);
        \u0275\u0275text(38, "\u50F9\u683C\u76F8\u95DC");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(39, "div", 17)(40, "div", 11);
        \u0275\u0275text(41, "\u{1F4CB}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(42, "div", 12)(43, "span", 13);
        \u0275\u0275text(44);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(45, "span", 14);
        \u0275\u0275text(46, "\u6D41\u7A0B\u76F8\u95DC");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(47, "div", 18)(48, "div", 11);
        \u0275\u0275text(49, "\u{1F4E6}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(50, "div", 12)(51, "span", 13);
        \u0275\u0275text(52);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(53, "span", 14);
        \u0275\u0275text(54, "\u7522\u54C1\u76F8\u95DC");
        \u0275\u0275elementEnd()()()();
        \u0275\u0275elementStart(55, "div", 19)(56, "div", 20)(57, "label", 21)(58, "input", 22);
        \u0275\u0275listener("change", function KnowledgeGapsComponent_Template_input_change_58_listener() {
          return ctx.toggleSelectAll();
        });
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(59, "span");
        \u0275\u0275text(60, "\u5168\u9078");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(61, "div", 23)(62, "label");
        \u0275\u0275text(63, "\u5206\u985E\uFF1A");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(64, "select", 24);
        \u0275\u0275twoWayListener("ngModelChange", function KnowledgeGapsComponent_Template_select_ngModelChange_64_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.categoryFilter, $event) || (ctx.categoryFilter = $event);
          return $event;
        });
        \u0275\u0275listener("change", function KnowledgeGapsComponent_Template_select_change_64_listener() {
          return ctx.applyFilters();
        });
        \u0275\u0275elementStart(65, "option", 25);
        \u0275\u0275text(66, "\u5168\u90E8");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(67, "option", 26);
        \u0275\u0275text(68, "\u{1F4B0} \u50F9\u683C");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(69, "option", 27);
        \u0275\u0275text(70, "\u{1F4CB} \u6D41\u7A0B");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(71, "option", 28);
        \u0275\u0275text(72, "\u{1F4E6} \u7522\u54C1");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(73, "option", 29);
        \u0275\u0275text(74, "\u{1F6E0}\uFE0F \u552E\u5F8C");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(75, "option", 30);
        \u0275\u0275text(76, "\u2753 \u5176\u4ED6");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(77, "div", 23)(78, "label");
        \u0275\u0275text(79, "\u6392\u5E8F\uFF1A");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(80, "select", 24);
        \u0275\u0275twoWayListener("ngModelChange", function KnowledgeGapsComponent_Template_select_ngModelChange_80_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.sortOption, $event) || (ctx.sortOption = $event);
          return $event;
        });
        \u0275\u0275listener("change", function KnowledgeGapsComponent_Template_select_change_80_listener() {
          return ctx.applyFilters();
        });
        \u0275\u0275elementStart(81, "option", 31);
        \u0275\u0275text(82, "\u{1F525} \u71B1\u5EA6");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(83, "option", 32);
        \u0275\u0275text(84, "\u{1F550} \u6642\u9593");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(85, "option", 33);
        \u0275\u0275text(86, "\u{1F4C2} \u5206\u985E");
        \u0275\u0275elementEnd()()()();
        \u0275\u0275elementStart(87, "div", 34);
        \u0275\u0275conditionalCreate(88, KnowledgeGapsComponent_Conditional_88_Template, 4, 1);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(89, "div", 35);
        \u0275\u0275conditionalCreate(90, KnowledgeGapsComponent_Conditional_90_Template, 4, 0, "div", 36)(91, KnowledgeGapsComponent_Conditional_91_Template, 7, 0, "div", 37)(92, KnowledgeGapsComponent_Conditional_92_Template, 3, 1);
        \u0275\u0275elementEnd()();
      }
      if (rf & 2) {
        \u0275\u0275advance(20);
        \u0275\u0275textInterpolate(ctx.totalGaps());
        \u0275\u0275advance(8);
        \u0275\u0275textInterpolate(ctx.hotGapsCount());
        \u0275\u0275advance(8);
        \u0275\u0275textInterpolate(ctx.categoryStats().price);
        \u0275\u0275advance(8);
        \u0275\u0275textInterpolate(ctx.categoryStats().process);
        \u0275\u0275advance(8);
        \u0275\u0275textInterpolate(ctx.categoryStats().product);
        \u0275\u0275advance(6);
        \u0275\u0275property("checked", ctx.isAllSelected())("indeterminate", ctx.isPartialSelected());
        \u0275\u0275advance(6);
        \u0275\u0275twoWayProperty("ngModel", ctx.categoryFilter);
        \u0275\u0275advance(16);
        \u0275\u0275twoWayProperty("ngModel", ctx.sortOption);
        \u0275\u0275advance(8);
        \u0275\u0275conditional(ctx.selectedIds().length > 0 ? 88 : -1);
        \u0275\u0275advance(2);
        \u0275\u0275conditional(ctx.isLoading() ? 90 : ctx.filteredGaps().length === 0 ? 91 : 92);
      }
    }, dependencies: [CommonModule, FormsModule, NgSelectOption, \u0275NgSelectMultipleOption, SelectControlValueAccessor, NgControlStatus, NgModel], styles: ["\n\n.gaps-page[_ngcontent-%COMP%] {\n  padding: 24px;\n  background:\n    linear-gradient(\n      135deg,\n      #0f0f1a 0%,\n      #1a1a2e 100%);\n  min-height: 100vh;\n  color: #fff;\n}\n.page-header[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 24px;\n}\n.page-title[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  font-size: 24px;\n  font-weight: 700;\n  margin: 0 0 8px 0;\n}\n.title-icon[_ngcontent-%COMP%] {\n  font-size: 28px;\n}\n.page-desc[_ngcontent-%COMP%] {\n  color: #888;\n  font-size: 14px;\n  margin: 0;\n}\n.header-actions[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 10px;\n}\n.action-btn[_ngcontent-%COMP%] {\n  padding: 10px 16px;\n  border: none;\n  border-radius: 10px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn.cleanup[_ngcontent-%COMP%] {\n  background: rgba(234, 179, 8, 0.2);\n  color: #fbbf24;\n}\n.action-btn.refresh[_ngcontent-%COMP%] {\n  background: rgba(59, 130, 246, 0.2);\n  color: #60a5fa;\n}\n.action-btn[_ngcontent-%COMP%]:hover {\n  filter: brightness(1.2);\n  transform: translateY(-1px);\n}\n.stats-overview[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: repeat(5, 1fr);\n  gap: 16px;\n  margin-bottom: 24px;\n}\n.stat-card[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 14px;\n  padding: 16px 20px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 14px;\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  transition: all 0.2s;\n}\n.stat-card[_ngcontent-%COMP%]:hover {\n  background: rgba(255, 255, 255, 0.08);\n  border-color: rgba(255, 255, 255, 0.15);\n}\n.stat-icon[_ngcontent-%COMP%] {\n  font-size: 28px;\n}\n.stat-info[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n}\n.stat-value[_ngcontent-%COMP%] {\n  font-size: 22px;\n  font-weight: 700;\n  color: #fff;\n}\n.stat-label[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #888;\n}\n.stat-card.total[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%] {\n  color: #a78bfa;\n}\n.stat-card.hot[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%] {\n  color: #f87171;\n}\n.stat-card.price[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%] {\n  color: #fbbf24;\n}\n.stat-card.process[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%] {\n  color: #60a5fa;\n}\n.stat-card.product[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%] {\n  color: #34d399;\n}\n.filter-bar[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 14px 18px;\n  background: rgba(255, 255, 255, 0.03);\n  border-radius: 12px;\n  margin-bottom: 16px;\n}\n.filter-left[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n}\n.select-all[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  cursor: pointer;\n  font-size: 14px;\n  color: #aaa;\n}\n.select-all[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] {\n  width: 18px;\n  height: 18px;\n  accent-color: #a855f7;\n}\n.filter-group[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%] {\n  font-size: 13px;\n  color: #888;\n}\n.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%] {\n  padding: 6px 12px;\n  background: rgba(0, 0, 0, 0.3);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  border-radius: 8px;\n  color: #fff;\n  font-size: 13px;\n  cursor: pointer;\n}\n.filter-right[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 10px;\n}\n.batch-btn[_ngcontent-%COMP%] {\n  padding: 8px 14px;\n  border: none;\n  border-radius: 8px;\n  font-size: 13px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.batch-btn.delete[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.batch-btn.resolve[_ngcontent-%COMP%] {\n  background: rgba(16, 185, 129, 0.2);\n  color: #34d399;\n}\n.batch-btn[_ngcontent-%COMP%]:hover {\n  filter: brightness(1.2);\n}\n.gaps-list[_ngcontent-%COMP%] {\n  background: rgba(255, 255, 255, 0.03);\n  border-radius: 14px;\n  overflow: hidden;\n}\n.gap-row[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: 40px 40px 50px 1fr 80px 80px 100px;\n  align-items: center;\n  gap: 12px;\n  padding: 14px 18px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n  transition: all 0.15s;\n}\n.gap-row[_ngcontent-%COMP%]:hover {\n  background: rgba(255, 255, 255, 0.04);\n}\n.gap-row.selected[_ngcontent-%COMP%] {\n  background: rgba(168, 85, 247, 0.1);\n}\n.gap-row[_ngcontent-%COMP%]:last-child {\n  border-bottom: none;\n}\n.gap-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] {\n  width: 18px;\n  height: 18px;\n  accent-color: #a855f7;\n  cursor: pointer;\n}\n.gap-index[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #666;\n  text-align: center;\n}\n.gap-category[_ngcontent-%COMP%] {\n  text-align: center;\n}\n.category-tag[_ngcontent-%COMP%] {\n  font-size: 18px;\n}\n.gap-content[_ngcontent-%COMP%] {\n  min-width: 0;\n}\n.gap-query[_ngcontent-%COMP%] {\n  font-size: 14px;\n  color: #e0e0e0;\n  line-height: 1.4;\n  margin-bottom: 4px;\n}\n.gap-answer[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #888;\n  padding: 6px 10px;\n  background: rgba(168, 85, 247, 0.1);\n  border-radius: 6px;\n  margin-top: 6px;\n}\n.answer-label[_ngcontent-%COMP%] {\n  color: #a855f7;\n  margin-right: 4px;\n}\n.gap-hits[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  justify-content: center;\n}\n.hits-badge[_ngcontent-%COMP%] {\n  padding: 3px 8px;\n  background: rgba(100, 116, 139, 0.2);\n  border-radius: 10px;\n  font-size: 12px;\n  color: #94a3b8;\n}\n.hits-badge.hot[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.hot-tag[_ngcontent-%COMP%] {\n  font-size: 14px;\n}\n.gap-time[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #666;\n  text-align: center;\n}\n.gap-actions[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 6px;\n  justify-content: flex-end;\n}\n.btn-icon[_ngcontent-%COMP%] {\n  width: 32px;\n  height: 32px;\n  border: none;\n  border-radius: 8px;\n  font-size: 14px;\n  cursor: pointer;\n  transition: all 0.15s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.btn-icon.generate[_ngcontent-%COMP%] {\n  background: rgba(168, 85, 247, 0.2);\n}\n.btn-icon.resolve[_ngcontent-%COMP%] {\n  background: rgba(16, 185, 129, 0.2);\n}\n.btn-icon.delete[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n}\n.btn-icon[_ngcontent-%COMP%]:hover {\n  filter: brightness(1.3);\n  transform: scale(1.08);\n}\n.pagination[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 16px;\n  padding: 16px;\n  border-top: 1px solid rgba(255, 255, 255, 0.05);\n}\n.page-btn[_ngcontent-%COMP%] {\n  padding: 8px 16px;\n  background: rgba(255, 255, 255, 0.08);\n  border: none;\n  border-radius: 8px;\n  color: #aaa;\n  font-size: 13px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.page-btn[_ngcontent-%COMP%]:hover:not(:disabled) {\n  background: rgba(255, 255, 255, 0.12);\n  color: #fff;\n}\n.page-btn[_ngcontent-%COMP%]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n.page-info[_ngcontent-%COMP%] {\n  font-size: 13px;\n  color: #888;\n}\n.empty-state[_ngcontent-%COMP%] {\n  text-align: center;\n  padding: 60px 20px;\n}\n.empty-icon[_ngcontent-%COMP%] {\n  font-size: 64px;\n  display: block;\n  margin-bottom: 16px;\n}\n.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%] {\n  font-size: 18px;\n  margin: 0 0 8px 0;\n  color: #e0e0e0;\n}\n.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n  font-size: 14px;\n  color: #888;\n  margin: 0;\n}\n.loading-state[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 60px;\n  color: #888;\n}\n.spinner[_ngcontent-%COMP%] {\n  width: 20px;\n  height: 20px;\n  border: 2px solid rgba(255, 255, 255, 0.2);\n  border-top-color: #a855f7;\n  border-radius: 50%;\n  animation: _ngcontent-%COMP%_spin 0.8s linear infinite;\n}\n@keyframes _ngcontent-%COMP%_spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n@media (max-width: 1200px) {\n  .stats-overview[_ngcontent-%COMP%] {\n    grid-template-columns: repeat(3, 1fr);\n  }\n}\n@media (max-width: 900px) {\n  .gap-row[_ngcontent-%COMP%] {\n    grid-template-columns: 40px 40px 1fr 60px 80px;\n  }\n  .gap-category[_ngcontent-%COMP%], \n   .gap-time[_ngcontent-%COMP%] {\n    display: none;\n  }\n  .stats-overview[_ngcontent-%COMP%] {\n    grid-template-columns: repeat(2, 1fr);\n  }\n}\n@media (max-width: 600px) {\n  .page-header[_ngcontent-%COMP%] {\n    flex-direction: column;\n    gap: 16px;\n  }\n  .filter-bar[_ngcontent-%COMP%] {\n    flex-direction: column;\n    gap: 12px;\n  }\n  .filter-left[_ngcontent-%COMP%], \n   .filter-right[_ngcontent-%COMP%] {\n    width: 100%;\n    justify-content: space-between;\n  }\n  .stats-overview[_ngcontent-%COMP%] {\n    grid-template-columns: 1fr;\n  }\n}\n/*# sourceMappingURL=knowledge-gaps.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(KnowledgeGapsComponent, [{
    type: Component,
    args: [{ selector: "app-knowledge-gaps", standalone: true, imports: [CommonModule, FormsModule], template: `
    <div class="gaps-page">
      <!-- \u9801\u9762\u982D\u90E8 -->
      <div class="page-header">
        <div class="header-left">
          <h1 class="page-title">
            <span class="title-icon">\u2753</span>
            \u77E5\u8B58\u7F3A\u53E3\u7BA1\u7406
          </h1>
          <p class="page-desc">\u7528\u6236\u554F\u4E86\u4F46\u77E5\u8B58\u5EAB\u6C92\u6709\u7B54\u6848\u7684\u554F\u984C\uFF0C\u512A\u5148\u8655\u7406\u71B1\u9580\u554F\u984C\u53EF\u63D0\u5347 AI \u56DE\u8986\u8CEA\u91CF</p>
        </div>
        <div class="header-actions">
          <button class="action-btn cleanup" (click)="cleanupAllInvalid()">
            \u{1F9F9} \u6DF1\u5EA6\u6E05\u7406
          </button>
          <button class="action-btn refresh" (click)="refreshGaps()">
            \u{1F504} \u5237\u65B0
          </button>
        </div>
      </div>
      
      <!-- \u{1F4CA} \u7D71\u8A08\u6982\u89BD -->
      <div class="stats-overview">
        <div class="stat-card total">
          <div class="stat-icon">\u{1F4CB}</div>
          <div class="stat-info">
            <span class="stat-value">{{ totalGaps() }}</span>
            <span class="stat-label">\u5F85\u8655\u7406</span>
          </div>
        </div>
        <div class="stat-card hot">
          <div class="stat-icon">\u{1F525}</div>
          <div class="stat-info">
            <span class="stat-value">{{ hotGapsCount() }}</span>
            <span class="stat-label">\u71B1\u9580\u554F\u984C</span>
          </div>
        </div>
        <div class="stat-card price">
          <div class="stat-icon">\u{1F4B0}</div>
          <div class="stat-info">
            <span class="stat-value">{{ categoryStats().price }}</span>
            <span class="stat-label">\u50F9\u683C\u76F8\u95DC</span>
          </div>
        </div>
        <div class="stat-card process">
          <div class="stat-icon">\u{1F4CB}</div>
          <div class="stat-info">
            <span class="stat-value">{{ categoryStats().process }}</span>
            <span class="stat-label">\u6D41\u7A0B\u76F8\u95DC</span>
          </div>
        </div>
        <div class="stat-card product">
          <div class="stat-icon">\u{1F4E6}</div>
          <div class="stat-info">
            <span class="stat-value">{{ categoryStats().product }}</span>
            <span class="stat-label">\u7522\u54C1\u76F8\u95DC</span>
          </div>
        </div>
      </div>
      
      <!-- \u{1F527} \u904E\u6FFE\u548C\u64CD\u4F5C\u6B04 -->
      <div class="filter-bar">
        <div class="filter-left">
          <label class="select-all">
            <input type="checkbox" 
                   [checked]="isAllSelected()" 
                   [indeterminate]="isPartialSelected()"
                   (change)="toggleSelectAll()">
            <span>\u5168\u9078</span>
          </label>
          
          <div class="filter-group">
            <label>\u5206\u985E\uFF1A</label>
            <select [(ngModel)]="categoryFilter" (change)="applyFilters()">
              <option value="all">\u5168\u90E8</option>
              <option value="price">\u{1F4B0} \u50F9\u683C</option>
              <option value="process">\u{1F4CB} \u6D41\u7A0B</option>
              <option value="product">\u{1F4E6} \u7522\u54C1</option>
              <option value="support">\u{1F6E0}\uFE0F \u552E\u5F8C</option>
              <option value="other">\u2753 \u5176\u4ED6</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label>\u6392\u5E8F\uFF1A</label>
            <select [(ngModel)]="sortOption" (change)="applyFilters()">
              <option value="hitCount">\u{1F525} \u71B1\u5EA6</option>
              <option value="createdAt">\u{1F550} \u6642\u9593</option>
              <option value="category">\u{1F4C2} \u5206\u985E</option>
            </select>
          </div>
        </div>
        
        <div class="filter-right">
          @if (selectedIds().length > 0) {
            <button class="batch-btn delete" (click)="deleteSelected()">
              \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D ({{ selectedIds().length }})
            </button>
            <button class="batch-btn resolve" (click)="batchResolve()">
              \u2705 \u6279\u91CF\u63A1\u7528
            </button>
          }
        </div>
      </div>
      
      <!-- \u{1F4CB} \u7F3A\u53E3\u5217\u8868 -->
      <div class="gaps-list">
        @if (isLoading()) {
          <div class="loading-state">
            <span class="spinner"></span>
            <span>\u8F09\u5165\u4E2D...</span>
          </div>
        } @else if (filteredGaps().length === 0) {
          <div class="empty-state">
            <span class="empty-icon">\u2728</span>
            <h3>\u6C92\u6709\u5F85\u8655\u7406\u7684\u77E5\u8B58\u7F3A\u53E3</h3>
            <p>\u77E5\u8B58\u5EAB\u8986\u84CB\u826F\u597D\uFF0C\u7E7C\u7E8C\u4FDD\u6301\uFF01</p>
          </div>
        } @else {
          @for (gap of paginatedGaps(); track gap.id; let i = $index) {
            <div class="gap-row" [class.selected]="isSelected(gap.id)">
              <!-- \u9078\u64C7\u6846 -->
              <div class="gap-checkbox">
                <input type="checkbox" 
                       [checked]="isSelected(gap.id)" 
                       (change)="toggleSelect(gap.id)">
              </div>
              
              <!-- \u5E8F\u865F -->
              <div class="gap-index">{{ (currentPage() - 1) * pageSize + i + 1 }}</div>
              
              <!-- \u5206\u985E\u6A19\u7C64 -->
              <div class="gap-category">
                <span class="category-tag" [class]="'cat-' + (gap.category || 'other')">
                  {{ getCategoryIcon(gap.category) }}
                </span>
              </div>
              
              <!-- \u554F\u984C\u5167\u5BB9 -->
              <div class="gap-content">
                <div class="gap-query" [title]="gap.query">
                  {{ truncateText(gap.query, 80) }}
                </div>
                @if (gap.suggestedAnswer) {
                  <div class="gap-answer">
                    <span class="answer-label">\u{1F4A1} AI:</span>
                    {{ truncateText(gap.suggestedAnswer, 100) }}
                  </div>
                }
              </div>
              
              <!-- \u71B1\u5EA6 -->
              <div class="gap-hits">
                <span class="hits-badge" [class.hot]="gap.hitCount >= 5">
                  {{ gap.hitCount }}\u6B21
                </span>
                @if (gap.hitCount >= 5) {
                  <span class="hot-tag">\u{1F525}</span>
                }
              </div>
              
              <!-- \u6642\u9593 -->
              <div class="gap-time">
                {{ formatTime(gap.createdAt) }}
              </div>
              
              <!-- \u64CD\u4F5C\u6309\u9215 -->
              <div class="gap-actions">
                @if (!gap.suggestedAnswer) {
                  <button class="btn-icon generate" 
                          (click)="generateAnswer(gap)" 
                          title="AI \u751F\u6210\u7B54\u6848">
                    \u{1F916}
                  </button>
                }
                <button class="btn-icon resolve" 
                        (click)="resolveGap(gap)" 
                        title="\u63A1\u7528\u4E26\u6DFB\u52A0\u5230\u77E5\u8B58\u5EAB">
                  \u2705
                </button>
                <button class="btn-icon delete" 
                        (click)="deleteGap(gap)" 
                        title="\u522A\u9664">
                  \u{1F5D1}\uFE0F
                </button>
              </div>
            </div>
          }
          
          <!-- \u5206\u9801 -->
          @if (totalPages() > 1) {
            <div class="pagination">
              <button class="page-btn" 
                      [disabled]="currentPage() === 1"
                      (click)="goToPage(currentPage() - 1)">
                \u2190 \u4E0A\u4E00\u9801
              </button>
              <span class="page-info">
                \u7B2C {{ currentPage() }} / {{ totalPages() }} \u9801
                \uFF08\u5171 {{ filteredGaps().length }} \u689D\uFF09
              </span>
              <button class="page-btn" 
                      [disabled]="currentPage() === totalPages()"
                      (click)="goToPage(currentPage() + 1)">
                \u4E0B\u4E00\u9801 \u2192
              </button>
            </div>
          }
        }
      </div>
    </div>
  `, styles: ["/* angular:styles/component:css;cd1b5fa56e3581128bf6ad32f9346a913e82e29b406d075e0cc59ed9ce15c57a;D:/tgkz2026/src/ai-center/knowledge-gaps.component.ts */\n.gaps-page {\n  padding: 24px;\n  background:\n    linear-gradient(\n      135deg,\n      #0f0f1a 0%,\n      #1a1a2e 100%);\n  min-height: 100vh;\n  color: #fff;\n}\n.page-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 24px;\n}\n.page-title {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  font-size: 24px;\n  font-weight: 700;\n  margin: 0 0 8px 0;\n}\n.title-icon {\n  font-size: 28px;\n}\n.page-desc {\n  color: #888;\n  font-size: 14px;\n  margin: 0;\n}\n.header-actions {\n  display: flex;\n  gap: 10px;\n}\n.action-btn {\n  padding: 10px 16px;\n  border: none;\n  border-radius: 10px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn.cleanup {\n  background: rgba(234, 179, 8, 0.2);\n  color: #fbbf24;\n}\n.action-btn.refresh {\n  background: rgba(59, 130, 246, 0.2);\n  color: #60a5fa;\n}\n.action-btn:hover {\n  filter: brightness(1.2);\n  transform: translateY(-1px);\n}\n.stats-overview {\n  display: grid;\n  grid-template-columns: repeat(5, 1fr);\n  gap: 16px;\n  margin-bottom: 24px;\n}\n.stat-card {\n  display: flex;\n  align-items: center;\n  gap: 14px;\n  padding: 16px 20px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 14px;\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  transition: all 0.2s;\n}\n.stat-card:hover {\n  background: rgba(255, 255, 255, 0.08);\n  border-color: rgba(255, 255, 255, 0.15);\n}\n.stat-icon {\n  font-size: 28px;\n}\n.stat-info {\n  display: flex;\n  flex-direction: column;\n}\n.stat-value {\n  font-size: 22px;\n  font-weight: 700;\n  color: #fff;\n}\n.stat-label {\n  font-size: 12px;\n  color: #888;\n}\n.stat-card.total .stat-value {\n  color: #a78bfa;\n}\n.stat-card.hot .stat-value {\n  color: #f87171;\n}\n.stat-card.price .stat-value {\n  color: #fbbf24;\n}\n.stat-card.process .stat-value {\n  color: #60a5fa;\n}\n.stat-card.product .stat-value {\n  color: #34d399;\n}\n.filter-bar {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 14px 18px;\n  background: rgba(255, 255, 255, 0.03);\n  border-radius: 12px;\n  margin-bottom: 16px;\n}\n.filter-left {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n}\n.select-all {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  cursor: pointer;\n  font-size: 14px;\n  color: #aaa;\n}\n.select-all input {\n  width: 18px;\n  height: 18px;\n  accent-color: #a855f7;\n}\n.filter-group {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.filter-group label {\n  font-size: 13px;\n  color: #888;\n}\n.filter-group select {\n  padding: 6px 12px;\n  background: rgba(0, 0, 0, 0.3);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  border-radius: 8px;\n  color: #fff;\n  font-size: 13px;\n  cursor: pointer;\n}\n.filter-right {\n  display: flex;\n  gap: 10px;\n}\n.batch-btn {\n  padding: 8px 14px;\n  border: none;\n  border-radius: 8px;\n  font-size: 13px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.batch-btn.delete {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.batch-btn.resolve {\n  background: rgba(16, 185, 129, 0.2);\n  color: #34d399;\n}\n.batch-btn:hover {\n  filter: brightness(1.2);\n}\n.gaps-list {\n  background: rgba(255, 255, 255, 0.03);\n  border-radius: 14px;\n  overflow: hidden;\n}\n.gap-row {\n  display: grid;\n  grid-template-columns: 40px 40px 50px 1fr 80px 80px 100px;\n  align-items: center;\n  gap: 12px;\n  padding: 14px 18px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n  transition: all 0.15s;\n}\n.gap-row:hover {\n  background: rgba(255, 255, 255, 0.04);\n}\n.gap-row.selected {\n  background: rgba(168, 85, 247, 0.1);\n}\n.gap-row:last-child {\n  border-bottom: none;\n}\n.gap-checkbox input {\n  width: 18px;\n  height: 18px;\n  accent-color: #a855f7;\n  cursor: pointer;\n}\n.gap-index {\n  font-size: 12px;\n  color: #666;\n  text-align: center;\n}\n.gap-category {\n  text-align: center;\n}\n.category-tag {\n  font-size: 18px;\n}\n.gap-content {\n  min-width: 0;\n}\n.gap-query {\n  font-size: 14px;\n  color: #e0e0e0;\n  line-height: 1.4;\n  margin-bottom: 4px;\n}\n.gap-answer {\n  font-size: 12px;\n  color: #888;\n  padding: 6px 10px;\n  background: rgba(168, 85, 247, 0.1);\n  border-radius: 6px;\n  margin-top: 6px;\n}\n.answer-label {\n  color: #a855f7;\n  margin-right: 4px;\n}\n.gap-hits {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  justify-content: center;\n}\n.hits-badge {\n  padding: 3px 8px;\n  background: rgba(100, 116, 139, 0.2);\n  border-radius: 10px;\n  font-size: 12px;\n  color: #94a3b8;\n}\n.hits-badge.hot {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.hot-tag {\n  font-size: 14px;\n}\n.gap-time {\n  font-size: 12px;\n  color: #666;\n  text-align: center;\n}\n.gap-actions {\n  display: flex;\n  gap: 6px;\n  justify-content: flex-end;\n}\n.btn-icon {\n  width: 32px;\n  height: 32px;\n  border: none;\n  border-radius: 8px;\n  font-size: 14px;\n  cursor: pointer;\n  transition: all 0.15s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.btn-icon.generate {\n  background: rgba(168, 85, 247, 0.2);\n}\n.btn-icon.resolve {\n  background: rgba(16, 185, 129, 0.2);\n}\n.btn-icon.delete {\n  background: rgba(239, 68, 68, 0.2);\n}\n.btn-icon:hover {\n  filter: brightness(1.3);\n  transform: scale(1.08);\n}\n.pagination {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 16px;\n  padding: 16px;\n  border-top: 1px solid rgba(255, 255, 255, 0.05);\n}\n.page-btn {\n  padding: 8px 16px;\n  background: rgba(255, 255, 255, 0.08);\n  border: none;\n  border-radius: 8px;\n  color: #aaa;\n  font-size: 13px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.page-btn:hover:not(:disabled) {\n  background: rgba(255, 255, 255, 0.12);\n  color: #fff;\n}\n.page-btn:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n.page-info {\n  font-size: 13px;\n  color: #888;\n}\n.empty-state {\n  text-align: center;\n  padding: 60px 20px;\n}\n.empty-icon {\n  font-size: 64px;\n  display: block;\n  margin-bottom: 16px;\n}\n.empty-state h3 {\n  font-size: 18px;\n  margin: 0 0 8px 0;\n  color: #e0e0e0;\n}\n.empty-state p {\n  font-size: 14px;\n  color: #888;\n  margin: 0;\n}\n.loading-state {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 60px;\n  color: #888;\n}\n.spinner {\n  width: 20px;\n  height: 20px;\n  border: 2px solid rgba(255, 255, 255, 0.2);\n  border-top-color: #a855f7;\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n@media (max-width: 1200px) {\n  .stats-overview {\n    grid-template-columns: repeat(3, 1fr);\n  }\n}\n@media (max-width: 900px) {\n  .gap-row {\n    grid-template-columns: 40px 40px 1fr 60px 80px;\n  }\n  .gap-category,\n  .gap-time {\n    display: none;\n  }\n  .stats-overview {\n    grid-template-columns: repeat(2, 1fr);\n  }\n}\n@media (max-width: 600px) {\n  .page-header {\n    flex-direction: column;\n    gap: 16px;\n  }\n  .filter-bar {\n    flex-direction: column;\n    gap: 12px;\n  }\n  .filter-left,\n  .filter-right {\n    width: 100%;\n    justify-content: space-between;\n  }\n  .stats-overview {\n    grid-template-columns: 1fr;\n  }\n}\n/*# sourceMappingURL=knowledge-gaps.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(KnowledgeGapsComponent, { className: "KnowledgeGapsComponent", filePath: "src/ai-center/knowledge-gaps.component.ts", lineNumber: 712 });
})();

// src/ai-center/knowledge-manage.component.ts
var _forTrack022 = ($index, $item) => $item.id;
function KnowledgeManageComponent_Conditional_92_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 42);
    \u0275\u0275listener("click", function KnowledgeManageComponent_Conditional_92_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r1);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.deleteSelected());
    });
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D (", ctx_r1.selectedIds().length, ") ");
  }
}
function KnowledgeManageComponent_Conditional_94_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 40);
    \u0275\u0275element(1, "span", 43);
    \u0275\u0275elementStart(2, "span");
    \u0275\u0275text(3, "\u8F09\u5165\u4E2D...");
    \u0275\u0275elementEnd()();
  }
}
function KnowledgeManageComponent_Conditional_95_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 41)(1, "span", 44);
    \u0275\u0275text(2, "\u{1F4DA}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "h3");
    \u0275\u0275text(4, "\u66AB\u7121\u77E5\u8B58");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p");
    \u0275\u0275text(6, "\u9EDE\u64CA\u300C\u6DFB\u52A0\u77E5\u8B58\u300D\u958B\u59CB\u69CB\u5EFA\u77E5\u8B58\u5EAB");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "button", 45);
    \u0275\u0275listener("click", function KnowledgeManageComponent_Conditional_95_Template_button_click_7_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r1 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r1.addKnowledge());
    });
    \u0275\u0275text(8, "\u2795 \u6DFB\u52A0\u77E5\u8B58");
    \u0275\u0275elementEnd()();
  }
}
function KnowledgeManageComponent_Conditional_96_For_1_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 48)(1, "div", 49)(2, "input", 50);
    \u0275\u0275listener("change", function KnowledgeManageComponent_Conditional_96_For_1_Template_input_change_2_listener() {
      const item_r5 = \u0275\u0275restoreView(_r4).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.toggleSelect(item_r5.id));
    });
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(3, "div", 51)(4, "span", 52);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div", 53);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 54);
    \u0275\u0275text(9);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "div", 55)(11, "span", 56);
    \u0275\u0275text(12);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(13, "div", 57);
    \u0275\u0275text(14);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "div", 58)(16, "button", 59);
    \u0275\u0275listener("click", function KnowledgeManageComponent_Conditional_96_For_1_Template_button_click_16_listener() {
      const item_r5 = \u0275\u0275restoreView(_r4).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.editKnowledge(item_r5));
    });
    \u0275\u0275text(17, " \u270F\uFE0F ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "button", 60);
    \u0275\u0275listener("click", function KnowledgeManageComponent_Conditional_96_For_1_Template_button_click_18_listener() {
      const item_r5 = \u0275\u0275restoreView(_r4).$implicit;
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.deleteKnowledge(item_r5));
    });
    \u0275\u0275text(19, " \u{1F5D1}\uFE0F ");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const item_r5 = ctx.$implicit;
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275classProp("selected", ctx_r1.isSelected(item_r5.id));
    \u0275\u0275advance(2);
    \u0275\u0275property("checked", ctx_r1.isSelected(item_r5.id));
    \u0275\u0275advance(2);
    \u0275\u0275classMap("type-" + item_r5.type);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", ctx_r1.getTypeIcon(item_r5.type), " ", ctx_r1.getTypeName(item_r5.type), " ");
    \u0275\u0275advance();
    \u0275\u0275property("title", item_r5.question);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.truncateText(item_r5.question, 60), " ");
    \u0275\u0275advance();
    \u0275\u0275property("title", item_r5.answer);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r1.truncateText(item_r5.answer, 80), " ");
    \u0275\u0275advance(2);
    \u0275\u0275classProp("high", item_r5.successScore >= 0.7)("low", item_r5.successScore < 0.4);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", (item_r5.successScore * 10).toFixed(1), " ");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", item_r5.useCount, "\u6B21 ");
  }
}
function KnowledgeManageComponent_Conditional_96_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 47)(1, "button", 61);
    \u0275\u0275listener("click", function KnowledgeManageComponent_Conditional_96_Conditional_2_Template_button_click_1_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.goToPage(ctx_r1.currentPage() - 1));
    });
    \u0275\u0275text(2, " \u2190 \u4E0A\u4E00\u9801 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 62);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "button", 61);
    \u0275\u0275listener("click", function KnowledgeManageComponent_Conditional_96_Conditional_2_Template_button_click_5_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r1 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r1.goToPage(ctx_r1.currentPage() + 1));
    });
    \u0275\u0275text(6, " \u4E0B\u4E00\u9801 \u2192 ");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275property("disabled", ctx_r1.currentPage() === 1);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate3(" \u7B2C ", ctx_r1.currentPage(), " / ", ctx_r1.totalPages(), " \u9801 \uFF08\u5171 ", ctx_r1.filteredKnowledge().length, " \u689D\uFF09 ");
    \u0275\u0275advance();
    \u0275\u0275property("disabled", ctx_r1.currentPage() === ctx_r1.totalPages());
  }
}
function KnowledgeManageComponent_Conditional_96_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275repeaterCreate(0, KnowledgeManageComponent_Conditional_96_For_1_Template, 20, 17, "div", 46, _forTrack022);
    \u0275\u0275conditionalCreate(2, KnowledgeManageComponent_Conditional_96_Conditional_2_Template, 7, 5, "div", 47);
  }
  if (rf & 2) {
    const ctx_r1 = \u0275\u0275nextContext();
    \u0275\u0275repeater(ctx_r1.paginatedKnowledge());
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r1.totalPages() > 1 ? 2 : -1);
  }
}
var KnowledgeManageComponent = class _KnowledgeManageComponent {
  constructor() {
    this.ragService = inject(RAGBrainService);
    this.dialogService = inject(DialogService);
    this.toastService = inject(ToastService);
    this.ipc = inject(ElectronIpcService);
    this.isLoading = signal(false, ...ngDevMode ? [{ debugName: "isLoading" }] : []);
    this.knowledge = signal([], ...ngDevMode ? [{ debugName: "knowledge" }] : []);
    this.selectedIds = signal([], ...ngDevMode ? [{ debugName: "selectedIds" }] : []);
    this.currentPage = signal(1, ...ngDevMode ? [{ debugName: "currentPage" }] : []);
    this.pageSize = 20;
    this.searchQuery = "";
    this.typeFilter = "all";
    this.sortOption = "createdAt";
    this.filteredKnowledge = computed(() => {
      let result = [...this.knowledge()];
      if (this.searchQuery.trim()) {
        const query = this.searchQuery.toLowerCase();
        result = result.filter((k) => k.question.toLowerCase().includes(query) || k.answer.toLowerCase().includes(query));
      }
      if (this.typeFilter !== "all") {
        result = result.filter((k) => k.type === this.typeFilter);
      }
      result.sort((a, b) => {
        switch (this.sortOption) {
          case "createdAt":
            return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();
          case "useCount":
            return b.useCount - a.useCount;
          case "successScore":
            return b.successScore - a.successScore;
          case "type":
            return a.type.localeCompare(b.type);
          default:
            return 0;
        }
      });
      return result;
    }, ...ngDevMode ? [{ debugName: "filteredKnowledge" }] : []);
    this.paginatedKnowledge = computed(() => {
      const start = (this.currentPage() - 1) * this.pageSize;
      return this.filteredKnowledge().slice(start, start + this.pageSize);
    }, ...ngDevMode ? [{ debugName: "paginatedKnowledge" }] : []);
    this.totalPages = computed(() => Math.ceil(this.filteredKnowledge().length / this.pageSize), ...ngDevMode ? [{ debugName: "totalPages" }] : []);
    this.totalKnowledge = computed(() => this.knowledge().length, ...ngDevMode ? [{ debugName: "totalKnowledge" }] : []);
    this.typeStats = computed(() => {
      const stats = { product: 0, qa: 0, script: 0, faq: 0, objection: 0, greeting: 0, closing: 0 };
      this.knowledge().forEach((k) => {
        const type = k.type;
        if (stats[type] !== void 0)
          stats[type]++;
      });
      return stats;
    }, ...ngDevMode ? [{ debugName: "typeStats" }] : []);
    this.avgScore = computed(() => {
      const items = this.knowledge();
      if (items.length === 0)
        return 0;
      return items.reduce((sum, k) => sum + k.successScore, 0) / items.length;
    }, ...ngDevMode ? [{ debugName: "avgScore" }] : []);
  }
  ngOnInit() {
    this.loadKnowledge();
  }
  async loadKnowledge() {
    this.isLoading.set(true);
    try {
      const result = await this.ipc.invoke("rag-get-all-knowledge", {});
      if (result?.success && result.knowledge) {
        this.knowledge.set(result.knowledge.map((k) => ({
          id: k.id,
          type: k.knowledge_type || k.type || "qa",
          question: k.question || "",
          answer: k.answer || "",
          context: k.context || "",
          successScore: k.success_score || k.successScore || 0.5,
          useCount: k.use_count || k.useCount || 0,
          feedbackPositive: k.feedback_positive || 0,
          feedbackNegative: k.feedback_negative || 0,
          isActive: k.is_active !== false,
          createdAt: k.created_at || k.createdAt || (/* @__PURE__ */ new Date()).toISOString(),
          updatedAt: k.updated_at || k.updatedAt
        })));
      }
    } catch (err) {
      console.error("Failed to load knowledge:", err);
      this.toastService.error("\u8F09\u5165\u77E5\u8B58\u5931\u6557");
    } finally {
      this.isLoading.set(false);
    }
  }
  applyFilters() {
    this.currentPage.set(1);
    this.selectedIds.set([]);
  }
  // 選擇操作
  isSelected(id) {
    return this.selectedIds().includes(id);
  }
  toggleSelect(id) {
    const current = this.selectedIds();
    if (current.includes(id)) {
      this.selectedIds.set(current.filter((i) => i !== id));
    } else {
      this.selectedIds.set([...current, id]);
    }
  }
  // 操作
  addKnowledge() {
    this.dialogService.prompt({
      title: "\u6DFB\u52A0\u77E5\u8B58",
      message: "\u8ACB\u8F38\u5165\u554F\u984C\uFF1A",
      placeholder: "\u4F8B\u5982\uFF1A\u8CBB\u7387\u662F\u591A\u5C11\uFF1F",
      confirmText: "\u4E0B\u4E00\u6B65",
      onConfirm: (question) => {
        if (question) {
          this.dialogService.prompt({
            title: "\u6DFB\u52A0\u77E5\u8B58",
            message: `\u554F\u984C: "${question}"

\u8ACB\u8F38\u5165\u7B54\u6848\uFF1A`,
            placeholder: "\u5C08\u696D\u7684\u56DE\u7B54...",
            confirmText: "\u6DFB\u52A0",
            onConfirm: async (answer) => {
              if (answer) {
                try {
                  await this.ipc.invoke("rag-add-knowledge", {
                    type: "qa",
                    question,
                    answer
                  });
                  this.toastService.success("\u6DFB\u52A0\u6210\u529F");
                  this.loadKnowledge();
                } catch {
                  this.toastService.error("\u6DFB\u52A0\u5931\u6557");
                }
              }
            }
          });
        }
      }
    });
  }
  editKnowledge(item) {
    this.dialogService.prompt({
      title: "\u7DE8\u8F2F\u77E5\u8B58",
      message: `\u554F\u984C: "${item.question}"

\u8ACB\u4FEE\u6539\u7B54\u6848\uFF1A`,
      placeholder: item.answer,
      defaultValue: item.answer,
      confirmText: "\u4FDD\u5B58",
      onConfirm: async (newAnswer) => {
        if (newAnswer && newAnswer !== item.answer) {
          try {
            await this.ipc.invoke("rag-update-knowledge", {
              id: item.id,
              answer: newAnswer
            });
            this.toastService.success("\u66F4\u65B0\u6210\u529F");
            this.loadKnowledge();
          } catch {
            this.toastService.error("\u66F4\u65B0\u5931\u6557");
          }
        }
      }
    });
  }
  async deleteKnowledge(item) {
    try {
      await this.ipc.invoke("rag-delete-knowledge", { id: item.id });
      this.knowledge.set(this.knowledge().filter((k) => k.id !== item.id));
      this.toastService.success("\u5DF2\u522A\u9664");
    } catch {
      this.toastService.error("\u522A\u9664\u5931\u6557");
    }
  }
  async deleteSelected() {
    const ids = this.selectedIds();
    if (ids.length === 0)
      return;
    try {
      await this.ipc.invoke("rag-delete-knowledge-batch", { ids });
      this.knowledge.set(this.knowledge().filter((k) => !ids.includes(k.id)));
      this.selectedIds.set([]);
      this.toastService.success(`\u5DF2\u522A\u9664 ${ids.length} \u689D`);
    } catch {
      this.toastService.error("\u522A\u9664\u5931\u6557");
    }
  }
  // 分頁
  goToPage(page) {
    if (page >= 1 && page <= this.totalPages()) {
      this.currentPage.set(page);
    }
  }
  // 輔助方法
  truncateText(text, maxLength) {
    if (!text)
      return "";
    return text.length > maxLength ? text.slice(0, maxLength) + "..." : text;
  }
  getTypeIcon(type) {
    const icons = {
      "product": "\u{1F4E6}",
      "qa": "\u{1F4AC}",
      "script": "\u{1F4DC}",
      "faq": "\u2753",
      "objection": "\u{1F6E1}\uFE0F",
      "greeting": "\u{1F44B}",
      "closing": "\u{1F3AF}"
    };
    return icons[type] || "\u{1F4DD}";
  }
  getTypeName(type) {
    const names = {
      "product": "\u7522\u54C1",
      "qa": "\u554F\u7B54",
      "script": "\u8A71\u8853",
      "faq": "FAQ",
      "objection": "\u7570\u8B70",
      "greeting": "\u958B\u5834",
      "closing": "\u6210\u4EA4"
    };
    return names[type] || type;
  }
  static {
    this.\u0275fac = function KnowledgeManageComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _KnowledgeManageComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _KnowledgeManageComponent, selectors: [["app-knowledge-manage"]], decls: 97, vars: 10, consts: [[1, "knowledge-page"], [1, "page-header"], [1, "header-left"], [1, "page-title"], [1, "title-icon"], [1, "page-desc"], [1, "header-actions"], [1, "action-btn", "add", 3, "click"], [1, "action-btn", "refresh", 3, "click"], [1, "stats-overview"], [1, "stat-card", "total"], [1, "stat-icon"], [1, "stat-info"], [1, "stat-value"], [1, "stat-label"], [1, "stat-card", "product"], [1, "stat-card", "qa"], [1, "stat-card", "script"], [1, "stat-card", "score"], [1, "filter-bar"], [1, "filter-left"], [1, "search-box"], ["type", "text", "placeholder", "\u641C\u7D22\u77E5\u8B58...", 3, "ngModelChange", "input", "ngModel"], [1, "filter-group"], [3, "ngModelChange", "change", "ngModel"], ["value", "all"], ["value", "product"], ["value", "qa"], ["value", "script"], ["value", "faq"], ["value", "objection"], ["value", "greeting"], ["value", "closing"], ["value", "createdAt"], ["value", "useCount"], ["value", "successScore"], ["value", "type"], [1, "filter-right"], [1, "batch-btn", "delete"], [1, "knowledge-list"], [1, "loading-state"], [1, "empty-state"], [1, "batch-btn", "delete", 3, "click"], [1, "spinner"], [1, "empty-icon"], [1, "add-btn", 3, "click"], [1, "knowledge-row", 3, "selected"], [1, "pagination"], [1, "knowledge-row"], [1, "item-checkbox"], ["type", "checkbox", 3, "change", "checked"], [1, "item-type"], [1, "type-tag"], [1, "item-question", 3, "title"], [1, "item-answer", 3, "title"], [1, "item-score"], [1, "score-badge"], [1, "item-usage"], [1, "item-actions"], ["title", "\u7DE8\u8F2F", 1, "btn-icon", "edit", 3, "click"], ["title", "\u522A\u9664", 1, "btn-icon", "delete", 3, "click"], [1, "page-btn", 3, "click", "disabled"], [1, "page-info"]], template: function KnowledgeManageComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0)(1, "div", 1)(2, "div", 2)(3, "h1", 3)(4, "span", 4);
        \u0275\u0275text(5, "\u{1F4DD}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(6, " \u77E5\u8B58\u7BA1\u7406 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(7, "p", 5);
        \u0275\u0275text(8, "\u67E5\u770B\u548C\u7BA1\u7406\u5DF2\u5C0E\u5165\u7684\u6240\u6709\u77E5\u8B58\uFF0C\u652F\u6301\u7DE8\u8F2F\u548C\u522A\u9664");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(9, "div", 6)(10, "button", 7);
        \u0275\u0275listener("click", function KnowledgeManageComponent_Template_button_click_10_listener() {
          return ctx.addKnowledge();
        });
        \u0275\u0275text(11, " \u2795 \u6DFB\u52A0\u77E5\u8B58 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(12, "button", 8);
        \u0275\u0275listener("click", function KnowledgeManageComponent_Template_button_click_12_listener() {
          return ctx.loadKnowledge();
        });
        \u0275\u0275text(13, " \u{1F504} \u5237\u65B0 ");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(14, "div", 9)(15, "div", 10)(16, "div", 11);
        \u0275\u0275text(17, "\u{1F4DA}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(18, "div", 12)(19, "span", 13);
        \u0275\u0275text(20);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(21, "span", 14);
        \u0275\u0275text(22, "\u77E5\u8B58\u7E3D\u6578");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(23, "div", 15)(24, "div", 11);
        \u0275\u0275text(25, "\u{1F4E6}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(26, "div", 12)(27, "span", 13);
        \u0275\u0275text(28);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(29, "span", 14);
        \u0275\u0275text(30, "\u7522\u54C1\u4FE1\u606F");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(31, "div", 16)(32, "div", 11);
        \u0275\u0275text(33, "\u{1F4AC}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(34, "div", 12)(35, "span", 13);
        \u0275\u0275text(36);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(37, "span", 14);
        \u0275\u0275text(38, "\u554F\u7B54");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(39, "div", 17)(40, "div", 11);
        \u0275\u0275text(41, "\u{1F4DC}");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(42, "div", 12)(43, "span", 13);
        \u0275\u0275text(44);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(45, "span", 14);
        \u0275\u0275text(46, "\u8A71\u8853");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(47, "div", 18)(48, "div", 11);
        \u0275\u0275text(49, "\u2B50");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(50, "div", 12)(51, "span", 13);
        \u0275\u0275text(52);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(53, "span", 14);
        \u0275\u0275text(54, "\u5E73\u5747\u8A55\u5206");
        \u0275\u0275elementEnd()()()();
        \u0275\u0275elementStart(55, "div", 19)(56, "div", 20)(57, "div", 21)(58, "input", 22);
        \u0275\u0275twoWayListener("ngModelChange", function KnowledgeManageComponent_Template_input_ngModelChange_58_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.searchQuery, $event) || (ctx.searchQuery = $event);
          return $event;
        });
        \u0275\u0275listener("input", function KnowledgeManageComponent_Template_input_input_58_listener() {
          return ctx.applyFilters();
        });
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(59, "div", 23)(60, "label");
        \u0275\u0275text(61, "\u985E\u578B\uFF1A");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(62, "select", 24);
        \u0275\u0275twoWayListener("ngModelChange", function KnowledgeManageComponent_Template_select_ngModelChange_62_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.typeFilter, $event) || (ctx.typeFilter = $event);
          return $event;
        });
        \u0275\u0275listener("change", function KnowledgeManageComponent_Template_select_change_62_listener() {
          return ctx.applyFilters();
        });
        \u0275\u0275elementStart(63, "option", 25);
        \u0275\u0275text(64, "\u5168\u90E8");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(65, "option", 26);
        \u0275\u0275text(66, "\u{1F4E6} \u7522\u54C1");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(67, "option", 27);
        \u0275\u0275text(68, "\u{1F4AC} \u554F\u7B54");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(69, "option", 28);
        \u0275\u0275text(70, "\u{1F4DC} \u8A71\u8853");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(71, "option", 29);
        \u0275\u0275text(72, "\u2753 FAQ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(73, "option", 30);
        \u0275\u0275text(74, "\u{1F6E1}\uFE0F \u7570\u8B70\u8655\u7406");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(75, "option", 31);
        \u0275\u0275text(76, "\u{1F44B} \u958B\u5834\u767D");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(77, "option", 32);
        \u0275\u0275text(78, "\u{1F3AF} \u6210\u4EA4");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(79, "div", 23)(80, "label");
        \u0275\u0275text(81, "\u6392\u5E8F\uFF1A");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(82, "select", 24);
        \u0275\u0275twoWayListener("ngModelChange", function KnowledgeManageComponent_Template_select_ngModelChange_82_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.sortOption, $event) || (ctx.sortOption = $event);
          return $event;
        });
        \u0275\u0275listener("change", function KnowledgeManageComponent_Template_select_change_82_listener() {
          return ctx.applyFilters();
        });
        \u0275\u0275elementStart(83, "option", 33);
        \u0275\u0275text(84, "\u{1F550} \u6642\u9593");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(85, "option", 34);
        \u0275\u0275text(86, "\u{1F4CA} \u4F7F\u7528\u6B21\u6578");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(87, "option", 35);
        \u0275\u0275text(88, "\u2B50 \u8A55\u5206");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(89, "option", 36);
        \u0275\u0275text(90, "\u{1F4C2} \u985E\u578B");
        \u0275\u0275elementEnd()()()();
        \u0275\u0275elementStart(91, "div", 37);
        \u0275\u0275conditionalCreate(92, KnowledgeManageComponent_Conditional_92_Template, 2, 1, "button", 38);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(93, "div", 39);
        \u0275\u0275conditionalCreate(94, KnowledgeManageComponent_Conditional_94_Template, 4, 0, "div", 40)(95, KnowledgeManageComponent_Conditional_95_Template, 9, 0, "div", 41)(96, KnowledgeManageComponent_Conditional_96_Template, 3, 1);
        \u0275\u0275elementEnd()();
      }
      if (rf & 2) {
        \u0275\u0275advance(20);
        \u0275\u0275textInterpolate(ctx.totalKnowledge());
        \u0275\u0275advance(8);
        \u0275\u0275textInterpolate(ctx.typeStats().product);
        \u0275\u0275advance(8);
        \u0275\u0275textInterpolate(ctx.typeStats().qa);
        \u0275\u0275advance(8);
        \u0275\u0275textInterpolate(ctx.typeStats().script);
        \u0275\u0275advance(8);
        \u0275\u0275textInterpolate(ctx.avgScore().toFixed(1));
        \u0275\u0275advance(6);
        \u0275\u0275twoWayProperty("ngModel", ctx.searchQuery);
        \u0275\u0275advance(4);
        \u0275\u0275twoWayProperty("ngModel", ctx.typeFilter);
        \u0275\u0275advance(20);
        \u0275\u0275twoWayProperty("ngModel", ctx.sortOption);
        \u0275\u0275advance(10);
        \u0275\u0275conditional(ctx.selectedIds().length > 0 ? 92 : -1);
        \u0275\u0275advance(2);
        \u0275\u0275conditional(ctx.isLoading() ? 94 : ctx.filteredKnowledge().length === 0 ? 95 : 96);
      }
    }, dependencies: [CommonModule, FormsModule, NgSelectOption, \u0275NgSelectMultipleOption, DefaultValueAccessor, SelectControlValueAccessor, NgControlStatus, NgModel], styles: ["\n\n.knowledge-page[_ngcontent-%COMP%] {\n  padding: 24px;\n  background:\n    linear-gradient(\n      135deg,\n      #0f0f1a 0%,\n      #1a1a2e 100%);\n  min-height: 100vh;\n  color: #fff;\n}\n.page-header[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 24px;\n}\n.page-title[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  font-size: 24px;\n  font-weight: 700;\n  margin: 0 0 8px 0;\n}\n.title-icon[_ngcontent-%COMP%] {\n  font-size: 28px;\n}\n.page-desc[_ngcontent-%COMP%] {\n  color: #888;\n  font-size: 14px;\n  margin: 0;\n}\n.header-actions[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 10px;\n}\n.action-btn[_ngcontent-%COMP%] {\n  padding: 10px 16px;\n  border: none;\n  border-radius: 10px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn.add[_ngcontent-%COMP%] {\n  background:\n    linear-gradient(\n      135deg,\n      #667eea,\n      #764ba2);\n  color: #fff;\n}\n.action-btn.refresh[_ngcontent-%COMP%] {\n  background: rgba(59, 130, 246, 0.2);\n  color: #60a5fa;\n}\n.action-btn[_ngcontent-%COMP%]:hover {\n  filter: brightness(1.2);\n  transform: translateY(-1px);\n}\n.stats-overview[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: repeat(5, 1fr);\n  gap: 16px;\n  margin-bottom: 24px;\n}\n.stat-card[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 14px;\n  padding: 16px 20px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 14px;\n  border: 1px solid rgba(255, 255, 255, 0.08);\n}\n.stat-icon[_ngcontent-%COMP%] {\n  font-size: 28px;\n}\n.stat-info[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n}\n.stat-value[_ngcontent-%COMP%] {\n  font-size: 22px;\n  font-weight: 700;\n  color: #fff;\n}\n.stat-label[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #888;\n}\n.stat-card.total[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%] {\n  color: #a78bfa;\n}\n.stat-card.product[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%] {\n  color: #34d399;\n}\n.stat-card.qa[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%] {\n  color: #60a5fa;\n}\n.stat-card.script[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%] {\n  color: #fbbf24;\n}\n.stat-card.score[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%] {\n  color: #f87171;\n}\n.filter-bar[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 14px 18px;\n  background: rgba(255, 255, 255, 0.03);\n  border-radius: 12px;\n  margin-bottom: 16px;\n}\n.filter-left[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] {\n  padding: 8px 14px;\n  background: rgba(0, 0, 0, 0.3);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  border-radius: 8px;\n  color: #fff;\n  font-size: 13px;\n  width: 200px;\n}\n.filter-group[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%] {\n  font-size: 13px;\n  color: #888;\n}\n.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%] {\n  padding: 6px 12px;\n  background: rgba(0, 0, 0, 0.3);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  border-radius: 8px;\n  color: #fff;\n  font-size: 13px;\n}\n.batch-btn[_ngcontent-%COMP%] {\n  padding: 8px 14px;\n  border: none;\n  border-radius: 8px;\n  font-size: 13px;\n  cursor: pointer;\n}\n.batch-btn.delete[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.knowledge-list[_ngcontent-%COMP%] {\n  background: rgba(255, 255, 255, 0.03);\n  border-radius: 14px;\n  overflow: hidden;\n}\n.knowledge-row[_ngcontent-%COMP%] {\n  display: grid;\n  grid-template-columns: 40px 100px 1fr 1.5fr 60px 60px 80px;\n  align-items: center;\n  gap: 12px;\n  padding: 14px 18px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n  transition: all 0.15s;\n}\n.knowledge-row[_ngcontent-%COMP%]:hover {\n  background: rgba(255, 255, 255, 0.04);\n}\n.knowledge-row.selected[_ngcontent-%COMP%] {\n  background: rgba(168, 85, 247, 0.1);\n}\n.knowledge-row[_ngcontent-%COMP%]:last-child {\n  border-bottom: none;\n}\n.item-checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] {\n  width: 18px;\n  height: 18px;\n  accent-color: #a855f7;\n}\n.type-tag[_ngcontent-%COMP%] {\n  padding: 4px 8px;\n  border-radius: 6px;\n  font-size: 11px;\n  font-weight: 500;\n  white-space: nowrap;\n}\n.type-tag.type-product[_ngcontent-%COMP%] {\n  background: rgba(16, 185, 129, 0.2);\n  color: #34d399;\n}\n.type-tag.type-qa[_ngcontent-%COMP%] {\n  background: rgba(59, 130, 246, 0.2);\n  color: #60a5fa;\n}\n.type-tag.type-script[_ngcontent-%COMP%] {\n  background: rgba(234, 179, 8, 0.2);\n  color: #fbbf24;\n}\n.type-tag.type-faq[_ngcontent-%COMP%] {\n  background: rgba(168, 85, 247, 0.2);\n  color: #c4b5fd;\n}\n.type-tag.type-objection[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.type-tag.type-greeting[_ngcontent-%COMP%] {\n  background: rgba(6, 182, 212, 0.2);\n  color: #22d3ee;\n}\n.type-tag.type-closing[_ngcontent-%COMP%] {\n  background: rgba(236, 72, 153, 0.2);\n  color: #f472b6;\n}\n.item-question[_ngcontent-%COMP%] {\n  font-size: 14px;\n  color: #e0e0e0;\n}\n.item-answer[_ngcontent-%COMP%] {\n  font-size: 13px;\n  color: #888;\n}\n.score-badge[_ngcontent-%COMP%] {\n  padding: 3px 8px;\n  border-radius: 10px;\n  font-size: 12px;\n  background: rgba(100, 116, 139, 0.2);\n  color: #94a3b8;\n}\n.score-badge.high[_ngcontent-%COMP%] {\n  background: rgba(16, 185, 129, 0.2);\n  color: #34d399;\n}\n.score-badge.low[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.item-usage[_ngcontent-%COMP%] {\n  font-size: 12px;\n  color: #666;\n  text-align: center;\n}\n.item-actions[_ngcontent-%COMP%] {\n  display: flex;\n  gap: 6px;\n  justify-content: flex-end;\n}\n.btn-icon[_ngcontent-%COMP%] {\n  width: 32px;\n  height: 32px;\n  border: none;\n  border-radius: 8px;\n  font-size: 14px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.btn-icon.edit[_ngcontent-%COMP%] {\n  background: rgba(59, 130, 246, 0.2);\n}\n.btn-icon.delete[_ngcontent-%COMP%] {\n  background: rgba(239, 68, 68, 0.2);\n}\n.btn-icon[_ngcontent-%COMP%]:hover {\n  filter: brightness(1.3);\n  transform: scale(1.08);\n}\n.pagination[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 16px;\n  padding: 16px;\n  border-top: 1px solid rgba(255, 255, 255, 0.05);\n}\n.page-btn[_ngcontent-%COMP%] {\n  padding: 8px 16px;\n  background: rgba(255, 255, 255, 0.08);\n  border: none;\n  border-radius: 8px;\n  color: #aaa;\n  font-size: 13px;\n  cursor: pointer;\n}\n.page-btn[_ngcontent-%COMP%]:hover:not(:disabled) {\n  background: rgba(255, 255, 255, 0.12);\n  color: #fff;\n}\n.page-btn[_ngcontent-%COMP%]:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n.page-info[_ngcontent-%COMP%] {\n  font-size: 13px;\n  color: #888;\n}\n.empty-state[_ngcontent-%COMP%] {\n  text-align: center;\n  padding: 60px 20px;\n}\n.empty-icon[_ngcontent-%COMP%] {\n  font-size: 64px;\n  display: block;\n  margin-bottom: 16px;\n}\n.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%] {\n  font-size: 18px;\n  margin: 0 0 8px 0;\n  color: #e0e0e0;\n}\n.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n  font-size: 14px;\n  color: #888;\n  margin: 0 0 20px 0;\n}\n.add-btn[_ngcontent-%COMP%] {\n  padding: 12px 24px;\n  background:\n    linear-gradient(\n      135deg,\n      #667eea,\n      #764ba2);\n  border: none;\n  border-radius: 10px;\n  color: #fff;\n  font-size: 14px;\n  cursor: pointer;\n}\n.loading-state[_ngcontent-%COMP%] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 60px;\n  color: #888;\n}\n.spinner[_ngcontent-%COMP%] {\n  width: 20px;\n  height: 20px;\n  border: 2px solid rgba(255, 255, 255, 0.2);\n  border-top-color: #a855f7;\n  border-radius: 50%;\n  animation: _ngcontent-%COMP%_spin 0.8s linear infinite;\n}\n@keyframes _ngcontent-%COMP%_spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n@media (max-width: 1200px) {\n  .stats-overview[_ngcontent-%COMP%] {\n    grid-template-columns: repeat(3, 1fr);\n  }\n  .knowledge-row[_ngcontent-%COMP%] {\n    grid-template-columns: 40px 80px 1fr 60px 60px;\n  }\n  .item-answer[_ngcontent-%COMP%] {\n    display: none;\n  }\n}\n@media (max-width: 768px) {\n  .stats-overview[_ngcontent-%COMP%] {\n    grid-template-columns: repeat(2, 1fr);\n  }\n  .filter-bar[_ngcontent-%COMP%] {\n    flex-direction: column;\n    gap: 12px;\n  }\n  .knowledge-row[_ngcontent-%COMP%] {\n    grid-template-columns: 40px 1fr 60px 60px;\n  }\n  .item-type[_ngcontent-%COMP%] {\n    display: none;\n  }\n}\n/*# sourceMappingURL=knowledge-manage.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(KnowledgeManageComponent, [{
    type: Component,
    args: [{ selector: "app-knowledge-manage", standalone: true, imports: [CommonModule, FormsModule], template: `
    <div class="knowledge-page">
      <!-- \u9801\u9762\u982D\u90E8 -->
      <div class="page-header">
        <div class="header-left">
          <h1 class="page-title">
            <span class="title-icon">\u{1F4DD}</span>
            \u77E5\u8B58\u7BA1\u7406
          </h1>
          <p class="page-desc">\u67E5\u770B\u548C\u7BA1\u7406\u5DF2\u5C0E\u5165\u7684\u6240\u6709\u77E5\u8B58\uFF0C\u652F\u6301\u7DE8\u8F2F\u548C\u522A\u9664</p>
        </div>
        <div class="header-actions">
          <button class="action-btn add" (click)="addKnowledge()">
            \u2795 \u6DFB\u52A0\u77E5\u8B58
          </button>
          <button class="action-btn refresh" (click)="loadKnowledge()">
            \u{1F504} \u5237\u65B0
          </button>
        </div>
      </div>
      
      <!-- \u{1F4CA} \u7D71\u8A08\u6982\u89BD -->
      <div class="stats-overview">
        <div class="stat-card total">
          <div class="stat-icon">\u{1F4DA}</div>
          <div class="stat-info">
            <span class="stat-value">{{ totalKnowledge() }}</span>
            <span class="stat-label">\u77E5\u8B58\u7E3D\u6578</span>
          </div>
        </div>
        <div class="stat-card product">
          <div class="stat-icon">\u{1F4E6}</div>
          <div class="stat-info">
            <span class="stat-value">{{ typeStats().product }}</span>
            <span class="stat-label">\u7522\u54C1\u4FE1\u606F</span>
          </div>
        </div>
        <div class="stat-card qa">
          <div class="stat-icon">\u{1F4AC}</div>
          <div class="stat-info">
            <span class="stat-value">{{ typeStats().qa }}</span>
            <span class="stat-label">\u554F\u7B54</span>
          </div>
        </div>
        <div class="stat-card script">
          <div class="stat-icon">\u{1F4DC}</div>
          <div class="stat-info">
            <span class="stat-value">{{ typeStats().script }}</span>
            <span class="stat-label">\u8A71\u8853</span>
          </div>
        </div>
        <div class="stat-card score">
          <div class="stat-icon">\u2B50</div>
          <div class="stat-info">
            <span class="stat-value">{{ avgScore().toFixed(1) }}</span>
            <span class="stat-label">\u5E73\u5747\u8A55\u5206</span>
          </div>
        </div>
      </div>
      
      <!-- \u{1F527} \u904E\u6FFE\u548C\u64CD\u4F5C\u6B04 -->
      <div class="filter-bar">
        <div class="filter-left">
          <div class="search-box">
            <input type="text" 
                   [(ngModel)]="searchQuery" 
                   placeholder="\u641C\u7D22\u77E5\u8B58..."
                   (input)="applyFilters()">
          </div>
          
          <div class="filter-group">
            <label>\u985E\u578B\uFF1A</label>
            <select [(ngModel)]="typeFilter" (change)="applyFilters()">
              <option value="all">\u5168\u90E8</option>
              <option value="product">\u{1F4E6} \u7522\u54C1</option>
              <option value="qa">\u{1F4AC} \u554F\u7B54</option>
              <option value="script">\u{1F4DC} \u8A71\u8853</option>
              <option value="faq">\u2753 FAQ</option>
              <option value="objection">\u{1F6E1}\uFE0F \u7570\u8B70\u8655\u7406</option>
              <option value="greeting">\u{1F44B} \u958B\u5834\u767D</option>
              <option value="closing">\u{1F3AF} \u6210\u4EA4</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label>\u6392\u5E8F\uFF1A</label>
            <select [(ngModel)]="sortOption" (change)="applyFilters()">
              <option value="createdAt">\u{1F550} \u6642\u9593</option>
              <option value="useCount">\u{1F4CA} \u4F7F\u7528\u6B21\u6578</option>
              <option value="successScore">\u2B50 \u8A55\u5206</option>
              <option value="type">\u{1F4C2} \u985E\u578B</option>
            </select>
          </div>
        </div>
        
        <div class="filter-right">
          @if (selectedIds().length > 0) {
            <button class="batch-btn delete" (click)="deleteSelected()">
              \u{1F5D1}\uFE0F \u522A\u9664\u9078\u4E2D ({{ selectedIds().length }})
            </button>
          }
        </div>
      </div>
      
      <!-- \u{1F4CB} \u77E5\u8B58\u5217\u8868 -->
      <div class="knowledge-list">
        @if (isLoading()) {
          <div class="loading-state">
            <span class="spinner"></span>
            <span>\u8F09\u5165\u4E2D...</span>
          </div>
        } @else if (filteredKnowledge().length === 0) {
          <div class="empty-state">
            <span class="empty-icon">\u{1F4DA}</span>
            <h3>\u66AB\u7121\u77E5\u8B58</h3>
            <p>\u9EDE\u64CA\u300C\u6DFB\u52A0\u77E5\u8B58\u300D\u958B\u59CB\u69CB\u5EFA\u77E5\u8B58\u5EAB</p>
            <button class="add-btn" (click)="addKnowledge()">\u2795 \u6DFB\u52A0\u77E5\u8B58</button>
          </div>
        } @else {
          @for (item of paginatedKnowledge(); track item.id; let i = $index) {
            <div class="knowledge-row" [class.selected]="isSelected(item.id)">
              <!-- \u9078\u64C7\u6846 -->
              <div class="item-checkbox">
                <input type="checkbox" 
                       [checked]="isSelected(item.id)" 
                       (change)="toggleSelect(item.id)">
              </div>
              
              <!-- \u985E\u578B\u6A19\u7C64 -->
              <div class="item-type">
                <span class="type-tag" [class]="'type-' + item.type">
                  {{ getTypeIcon(item.type) }} {{ getTypeName(item.type) }}
                </span>
              </div>
              
              <!-- \u554F\u984C/\u95DC\u9375\u8A5E -->
              <div class="item-question" [title]="item.question">
                {{ truncateText(item.question, 60) }}
              </div>
              
              <!-- \u7B54\u6848 -->
              <div class="item-answer" [title]="item.answer">
                {{ truncateText(item.answer, 80) }}
              </div>
              
              <!-- \u8A55\u5206 -->
              <div class="item-score">
                <span class="score-badge" [class.high]="item.successScore >= 0.7" [class.low]="item.successScore < 0.4">
                  {{ (item.successScore * 10).toFixed(1) }}
                </span>
              </div>
              
              <!-- \u4F7F\u7528\u6B21\u6578 -->
              <div class="item-usage">
                {{ item.useCount }}\u6B21
              </div>
              
              <!-- \u64CD\u4F5C\u6309\u9215 -->
              <div class="item-actions">
                <button class="btn-icon edit" (click)="editKnowledge(item)" title="\u7DE8\u8F2F">
                  \u270F\uFE0F
                </button>
                <button class="btn-icon delete" (click)="deleteKnowledge(item)" title="\u522A\u9664">
                  \u{1F5D1}\uFE0F
                </button>
              </div>
            </div>
          }
          
          <!-- \u5206\u9801 -->
          @if (totalPages() > 1) {
            <div class="pagination">
              <button class="page-btn" 
                      [disabled]="currentPage() === 1"
                      (click)="goToPage(currentPage() - 1)">
                \u2190 \u4E0A\u4E00\u9801
              </button>
              <span class="page-info">
                \u7B2C {{ currentPage() }} / {{ totalPages() }} \u9801
                \uFF08\u5171 {{ filteredKnowledge().length }} \u689D\uFF09
              </span>
              <button class="page-btn" 
                      [disabled]="currentPage() === totalPages()"
                      (click)="goToPage(currentPage() + 1)">
                \u4E0B\u4E00\u9801 \u2192
              </button>
            </div>
          }
        }
      </div>
    </div>
  `, styles: ["/* angular:styles/component:css;27f7827fe693a07d9c3199ba2119dbc7b380c2b5f005f756145b7ec38e0883b9;D:/tgkz2026/src/ai-center/knowledge-manage.component.ts */\n.knowledge-page {\n  padding: 24px;\n  background:\n    linear-gradient(\n      135deg,\n      #0f0f1a 0%,\n      #1a1a2e 100%);\n  min-height: 100vh;\n  color: #fff;\n}\n.page-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 24px;\n}\n.page-title {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  font-size: 24px;\n  font-weight: 700;\n  margin: 0 0 8px 0;\n}\n.title-icon {\n  font-size: 28px;\n}\n.page-desc {\n  color: #888;\n  font-size: 14px;\n  margin: 0;\n}\n.header-actions {\n  display: flex;\n  gap: 10px;\n}\n.action-btn {\n  padding: 10px 16px;\n  border: none;\n  border-radius: 10px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n.action-btn.add {\n  background:\n    linear-gradient(\n      135deg,\n      #667eea,\n      #764ba2);\n  color: #fff;\n}\n.action-btn.refresh {\n  background: rgba(59, 130, 246, 0.2);\n  color: #60a5fa;\n}\n.action-btn:hover {\n  filter: brightness(1.2);\n  transform: translateY(-1px);\n}\n.stats-overview {\n  display: grid;\n  grid-template-columns: repeat(5, 1fr);\n  gap: 16px;\n  margin-bottom: 24px;\n}\n.stat-card {\n  display: flex;\n  align-items: center;\n  gap: 14px;\n  padding: 16px 20px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 14px;\n  border: 1px solid rgba(255, 255, 255, 0.08);\n}\n.stat-icon {\n  font-size: 28px;\n}\n.stat-info {\n  display: flex;\n  flex-direction: column;\n}\n.stat-value {\n  font-size: 22px;\n  font-weight: 700;\n  color: #fff;\n}\n.stat-label {\n  font-size: 12px;\n  color: #888;\n}\n.stat-card.total .stat-value {\n  color: #a78bfa;\n}\n.stat-card.product .stat-value {\n  color: #34d399;\n}\n.stat-card.qa .stat-value {\n  color: #60a5fa;\n}\n.stat-card.script .stat-value {\n  color: #fbbf24;\n}\n.stat-card.score .stat-value {\n  color: #f87171;\n}\n.filter-bar {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 14px 18px;\n  background: rgba(255, 255, 255, 0.03);\n  border-radius: 12px;\n  margin-bottom: 16px;\n}\n.filter-left {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n.search-box input {\n  padding: 8px 14px;\n  background: rgba(0, 0, 0, 0.3);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  border-radius: 8px;\n  color: #fff;\n  font-size: 13px;\n  width: 200px;\n}\n.filter-group {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.filter-group label {\n  font-size: 13px;\n  color: #888;\n}\n.filter-group select {\n  padding: 6px 12px;\n  background: rgba(0, 0, 0, 0.3);\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  border-radius: 8px;\n  color: #fff;\n  font-size: 13px;\n}\n.batch-btn {\n  padding: 8px 14px;\n  border: none;\n  border-radius: 8px;\n  font-size: 13px;\n  cursor: pointer;\n}\n.batch-btn.delete {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.knowledge-list {\n  background: rgba(255, 255, 255, 0.03);\n  border-radius: 14px;\n  overflow: hidden;\n}\n.knowledge-row {\n  display: grid;\n  grid-template-columns: 40px 100px 1fr 1.5fr 60px 60px 80px;\n  align-items: center;\n  gap: 12px;\n  padding: 14px 18px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n  transition: all 0.15s;\n}\n.knowledge-row:hover {\n  background: rgba(255, 255, 255, 0.04);\n}\n.knowledge-row.selected {\n  background: rgba(168, 85, 247, 0.1);\n}\n.knowledge-row:last-child {\n  border-bottom: none;\n}\n.item-checkbox input {\n  width: 18px;\n  height: 18px;\n  accent-color: #a855f7;\n}\n.type-tag {\n  padding: 4px 8px;\n  border-radius: 6px;\n  font-size: 11px;\n  font-weight: 500;\n  white-space: nowrap;\n}\n.type-tag.type-product {\n  background: rgba(16, 185, 129, 0.2);\n  color: #34d399;\n}\n.type-tag.type-qa {\n  background: rgba(59, 130, 246, 0.2);\n  color: #60a5fa;\n}\n.type-tag.type-script {\n  background: rgba(234, 179, 8, 0.2);\n  color: #fbbf24;\n}\n.type-tag.type-faq {\n  background: rgba(168, 85, 247, 0.2);\n  color: #c4b5fd;\n}\n.type-tag.type-objection {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.type-tag.type-greeting {\n  background: rgba(6, 182, 212, 0.2);\n  color: #22d3ee;\n}\n.type-tag.type-closing {\n  background: rgba(236, 72, 153, 0.2);\n  color: #f472b6;\n}\n.item-question {\n  font-size: 14px;\n  color: #e0e0e0;\n}\n.item-answer {\n  font-size: 13px;\n  color: #888;\n}\n.score-badge {\n  padding: 3px 8px;\n  border-radius: 10px;\n  font-size: 12px;\n  background: rgba(100, 116, 139, 0.2);\n  color: #94a3b8;\n}\n.score-badge.high {\n  background: rgba(16, 185, 129, 0.2);\n  color: #34d399;\n}\n.score-badge.low {\n  background: rgba(239, 68, 68, 0.2);\n  color: #f87171;\n}\n.item-usage {\n  font-size: 12px;\n  color: #666;\n  text-align: center;\n}\n.item-actions {\n  display: flex;\n  gap: 6px;\n  justify-content: flex-end;\n}\n.btn-icon {\n  width: 32px;\n  height: 32px;\n  border: none;\n  border-radius: 8px;\n  font-size: 14px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.btn-icon.edit {\n  background: rgba(59, 130, 246, 0.2);\n}\n.btn-icon.delete {\n  background: rgba(239, 68, 68, 0.2);\n}\n.btn-icon:hover {\n  filter: brightness(1.3);\n  transform: scale(1.08);\n}\n.pagination {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 16px;\n  padding: 16px;\n  border-top: 1px solid rgba(255, 255, 255, 0.05);\n}\n.page-btn {\n  padding: 8px 16px;\n  background: rgba(255, 255, 255, 0.08);\n  border: none;\n  border-radius: 8px;\n  color: #aaa;\n  font-size: 13px;\n  cursor: pointer;\n}\n.page-btn:hover:not(:disabled) {\n  background: rgba(255, 255, 255, 0.12);\n  color: #fff;\n}\n.page-btn:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n.page-info {\n  font-size: 13px;\n  color: #888;\n}\n.empty-state {\n  text-align: center;\n  padding: 60px 20px;\n}\n.empty-icon {\n  font-size: 64px;\n  display: block;\n  margin-bottom: 16px;\n}\n.empty-state h3 {\n  font-size: 18px;\n  margin: 0 0 8px 0;\n  color: #e0e0e0;\n}\n.empty-state p {\n  font-size: 14px;\n  color: #888;\n  margin: 0 0 20px 0;\n}\n.add-btn {\n  padding: 12px 24px;\n  background:\n    linear-gradient(\n      135deg,\n      #667eea,\n      #764ba2);\n  border: none;\n  border-radius: 10px;\n  color: #fff;\n  font-size: 14px;\n  cursor: pointer;\n}\n.loading-state {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 60px;\n  color: #888;\n}\n.spinner {\n  width: 20px;\n  height: 20px;\n  border: 2px solid rgba(255, 255, 255, 0.2);\n  border-top-color: #a855f7;\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n@media (max-width: 1200px) {\n  .stats-overview {\n    grid-template-columns: repeat(3, 1fr);\n  }\n  .knowledge-row {\n    grid-template-columns: 40px 80px 1fr 60px 60px;\n  }\n  .item-answer {\n    display: none;\n  }\n}\n@media (max-width: 768px) {\n  .stats-overview {\n    grid-template-columns: repeat(2, 1fr);\n  }\n  .filter-bar {\n    flex-direction: column;\n    gap: 12px;\n  }\n  .knowledge-row {\n    grid-template-columns: 40px 1fr 60px 60px;\n  }\n  .item-type {\n    display: none;\n  }\n}\n/*# sourceMappingURL=knowledge-manage.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(KnowledgeManageComponent, { className: "KnowledgeManageComponent", filePath: "src/ai-center/knowledge-manage.component.ts", lineNumber: 531 });
})();

// src/components/marketing-report.component.ts
var _forTrack023 = ($index, $item) => $item.stage;
var _forTrack18 = ($index, $item) => $item.comboId;
function MarketingReportComponent_Conditional_28_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 48);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275classProp("bg-green-500/20", ctx_r0.comparison().changes.sessions > 0)("text-green-400", ctx_r0.comparison().changes.sessions > 0)("bg-red-500/20", ctx_r0.comparison().changes.sessions < 0)("text-red-400", ctx_r0.comparison().changes.sessions < 0);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", ctx_r0.comparison().changes.sessions > 0 ? "+" : "", "", ctx_r0.comparison().changes.sessions.toFixed(1), "% ");
  }
}
function MarketingReportComponent_Conditional_37_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 48);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275classProp("bg-green-500/20", ctx_r0.comparison().changes.conversions > 0)("text-green-400", ctx_r0.comparison().changes.conversions > 0)("bg-red-500/20", ctx_r0.comparison().changes.conversions < 0)("text-red-400", ctx_r0.comparison().changes.conversions < 0);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", ctx_r0.comparison().changes.conversions > 0 ? "+" : "", "", ctx_r0.comparison().changes.conversions.toFixed(1), "% ");
  }
}
function MarketingReportComponent_Conditional_54_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 48);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275classProp("bg-green-500/20", ctx_r0.comparison().changes.revenue > 0)("text-green-400", ctx_r0.comparison().changes.revenue > 0)("bg-red-500/20", ctx_r0.comparison().changes.revenue < 0)("text-red-400", ctx_r0.comparison().changes.revenue < 0);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" ", ctx_r0.comparison().changes.revenue > 0 ? "+" : "", "", ctx_r0.comparison().changes.revenue.toFixed(1), "% ");
  }
}
function MarketingReportComponent_For_67_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 28)(1, "div", 49)(2, "span", 50);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span", 17);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div", 51);
    \u0275\u0275element(7, "div", 52);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const stage_r2 = ctx.$implicit;
    const \u0275$index_116_r3 = ctx.$index;
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r0.getStageName(stage_r2.stage));
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2("", stage_r2.count, " (", stage_r2.rate.toFixed(1), "%)");
    \u0275\u0275advance(2);
    \u0275\u0275classMap(ctx_r0.getFunnelColor(\u0275$index_116_r3));
    \u0275\u0275styleProp("width", stage_r2.rate, "%");
  }
}
function MarketingReportComponent_Conditional_68_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 29);
    \u0275\u0275text(1, " \u66AB\u7121\u6578\u64DA ");
    \u0275\u0275elementEnd();
  }
}
function MarketingReportComponent_For_76_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 58);
    \u0275\u0275text(1, "\u2191");
    \u0275\u0275elementEnd();
  }
}
function MarketingReportComponent_For_76_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 59);
    \u0275\u0275text(1, "\u2193");
    \u0275\u0275elementEnd();
  }
}
function MarketingReportComponent_For_76_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 30)(1, "div", 13)(2, "div", 53)(3, "span", 54);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "span", 55);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(7, "div", 56)(8, "span", 57);
    \u0275\u0275text(9);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(10, MarketingReportComponent_For_76_Conditional_10_Template, 2, 0, "span", 58)(11, MarketingReportComponent_For_76_Conditional_11_Template, 2, 0, "span", 59);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(12, "div", 60)(13, "span", 61);
    \u0275\u0275text(14);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "span", 62);
    \u0275\u0275text(16);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(17, "div", 63);
    \u0275\u0275element(18, "div", 64);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const combo_r4 = ctx.$implicit;
    const \u0275$index_145_r5 = ctx.$index;
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r0.getMedalEmoji(\u0275$index_145_r5));
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(combo_r4.comboName);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("", combo_r4.conversionRate.toFixed(1), "%");
    \u0275\u0275advance();
    \u0275\u0275conditional(combo_r4.trend === "up" ? 10 : combo_r4.trend === "down" ? 11 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate2(" ", combo_r4.totalSessions, " \u6B21\u4F7F\u7528 \xB7 ", combo_r4.conversions, " \u6B21\u8F49\u5316 ");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" \u5E73\u5747 ", combo_r4.avgMessageCount.toFixed(0), " \u689D\u6D88\u606F ");
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("width", combo_r4.conversionRate, "%");
  }
}
function MarketingReportComponent_Conditional_77_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 29)(1, "div", 65);
    \u0275\u0275text(2, "\u{1F4CA}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div");
    \u0275\u0275text(4, "\u958B\u59CB\u71DF\u92B7\u5F8C\u5C07\u986F\u793A\u89D2\u8272\u7D44\u5408\u6548\u679C");
    \u0275\u0275elementEnd()();
  }
}
function MarketingReportComponent_Conditional_138_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 47)(1, "div", 66)(2, "div", 67);
    \u0275\u0275text(3, "\u{1F4A1}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div", 68)(5, "h4", 69);
    \u0275\u0275text(6, "\u63A8\u85A6\u4F7F\u7528\u89D2\u8272\u7D44\u5408");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "p", 70);
    \u0275\u0275text(8, " \u6839\u64DA\u6B77\u53F2\u6578\u64DA\uFF0C\u300C");
    \u0275\u0275elementStart(9, "span", 71);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd();
    \u0275\u0275text(11, "\u300D \u7D44\u5408\u8868\u73FE\u6700\u4F73\uFF0C\u8F49\u5316\u7387\u9054 ");
    \u0275\u0275elementStart(12, "span", 57);
    \u0275\u0275text(13);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(14, "button", 72);
    \u0275\u0275text(15, " \u4F7F\u7528\u6B64\u7D44\u5408 ");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(10);
    \u0275\u0275textInterpolate(ctx_r0.recommendedCombo().comboName);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("", ctx_r0.recommendedCombo().conversionRate.toFixed(1), "%");
  }
}
var MarketingReportComponent = class _MarketingReportComponent {
  constructor() {
    this.analytics = inject(MarketingAnalyticsService);
    this.selectedPeriod = "week";
    this.todayDate = (/* @__PURE__ */ new Date()).toLocaleDateString("zh-TW");
    this.totalStats = this.analytics.totalStats;
    this.todayStats = this.analytics.todayStats;
    this.topCombos = this.analytics.topRoleCombos;
    this.userProfiles = this.analytics.userProfiles;
    this.roleCombos = this.analytics.roleComboStats;
    this.todayReport = signal(this.getEmptyReport(), ...ngDevMode ? [{ debugName: "todayReport" }] : []);
    this.funnelData = signal([], ...ngDevMode ? [{ debugName: "funnelData" }] : []);
    this.comparison = signal({
      current: { sessions: 0, conversions: 0, revenue: 0 },
      previous: { sessions: 0, conversions: 0, revenue: 0 },
      changes: { sessions: 0, conversions: 0, revenue: 0 }
    }, ...ngDevMode ? [{ debugName: "comparison" }] : []);
    this.recommendedCombo = signal(null, ...ngDevMode ? [{ debugName: "recommendedCombo" }] : []);
  }
  ngOnInit() {
    this.refreshData();
  }
  refreshData() {
    const report = this.analytics.generateDailyReport();
    this.todayReport.set(report);
    this.funnelData.set(report.funnel);
    const comparison = this.analytics.generatePeriodComparison(7);
    this.comparison.set(comparison);
    const recommended = this.analytics.recommendRoleCombo();
    this.recommendedCombo.set(recommended);
  }
  onPeriodChange() {
    this.refreshData();
  }
  getStageName(stage) {
    const names = {
      "opening": "\u958B\u5834\u968E\u6BB5",
      "building_trust": "\u5EFA\u7ACB\u4FE1\u4EFB",
      "discovering_needs": "\u767C\u73FE\u9700\u6C42",
      "presenting_value": "\u5C55\u793A\u50F9\u503C",
      "handling_objections": "\u8655\u7406\u7570\u8B70",
      "closing": "\u4FC3\u6210\u6210\u4EA4",
      "follow_up": "\u8DDF\u9032\u670D\u52D9"
    };
    return names[stage] || stage;
  }
  getFunnelColor(index) {
    const colors = [
      "bg-blue-500",
      "bg-cyan-500",
      "bg-teal-500",
      "bg-green-500",
      "bg-lime-500",
      "bg-amber-500",
      "bg-orange-500"
    ];
    return colors[index % colors.length];
  }
  getMedalEmoji(index) {
    const medals = ["\u{1F947}", "\u{1F948}", "\u{1F949}", "4\uFE0F\u20E3", "5\uFE0F\u20E3"];
    return medals[index] || "\u{1F3C5}";
  }
  formatNumber(value) {
    if (value >= 1e4) {
      return (value / 1e4).toFixed(1) + "\u842C";
    }
    return value.toLocaleString();
  }
  getEmptyReport() {
    return {
      date: (/* @__PURE__ */ new Date()).toISOString().split("T")[0],
      totalSessions: 0,
      newUsers: 0,
      activeUsers: 0,
      conversions: 0,
      conversionRate: 0,
      totalRevenue: 0,
      totalMessages: 0,
      avgResponseTime: 0,
      accountUsage: [],
      topRoleCombos: [],
      funnel: []
    };
  }
  static {
    this.\u0275fac = function MarketingReportComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _MarketingReportComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _MarketingReportComponent, selectors: [["app-marketing-report"]], decls: 139, vars: 21, consts: [[1, "marketing-report", "p-6", "space-y-6"], [1, "flex", "items-center", "justify-between"], [1, "text-2xl", "font-bold", "text-white", "flex", "items-center", "gap-3"], [1, "text-slate-400", "mt-1"], [1, "flex", "items-center", "gap-3"], [1, "px-4", "py-2", "bg-slate-800", "border", "border-slate-700", "rounded-lg", "text-white", 3, "ngModelChange", "change", "ngModel"], ["value", "today"], ["value", "week"], ["value", "month"], ["value", "all"], [1, "px-4", "py-2", "bg-purple-500", "text-white", "rounded-lg", "hover:bg-purple-600", "flex", "items-center", "gap-2", 3, "click"], [1, "grid", "grid-cols-2", "md:grid-cols-4", "gap-4"], [1, "bg-gradient-to-br", "from-blue-500/20", "to-blue-600/10", "border", "border-blue-500/30", "rounded-xl", "p-4"], [1, "flex", "items-center", "justify-between", "mb-2"], [1, "text-blue-400", "text-2xl"], [1, "text-xs", "px-2", "py-1", "rounded-full", 3, "bg-green-500/20", "text-green-400", "bg-red-500/20", "text-red-400"], [1, "text-3xl", "font-bold", "text-white"], [1, "text-sm", "text-slate-400"], [1, "bg-gradient-to-br", "from-green-500/20", "to-green-600/10", "border", "border-green-500/30", "rounded-xl", "p-4"], [1, "text-green-400", "text-2xl"], [1, "bg-gradient-to-br", "from-purple-500/20", "to-purple-600/10", "border", "border-purple-500/30", "rounded-xl", "p-4"], [1, "text-purple-400", "text-2xl"], [1, "bg-gradient-to-br", "from-amber-500/20", "to-amber-600/10", "border", "border-amber-500/30", "rounded-xl", "p-4"], [1, "text-amber-400", "text-2xl"], [1, "grid", "grid-cols-1", "lg:grid-cols-2", "gap-6"], [1, "bg-slate-800/50", "border", "border-slate-700", "rounded-xl", "p-5"], [1, "text-lg", "font-semibold", "text-white", "mb-4", "flex", "items-center", "gap-2"], [1, "space-y-3"], [1, "relative"], [1, "text-center", "py-8", "text-slate-500"], [1, "p-3", "bg-slate-900/50", "rounded-lg", "border", "border-slate-700/50"], [1, "text-center", "p-4", "bg-slate-900/50", "rounded-lg"], [1, "text-2xl", "font-bold", "text-cyan-400"], [1, "text-sm", "text-slate-400", "mt-1"], [1, "text-2xl", "font-bold", "text-pink-400"], [1, "text-2xl", "font-bold", "text-orange-400"], [1, "text-2xl", "font-bold", "text-indigo-400"], [1, "flex", "items-center", "justify-between", "mb-4"], [1, "text-lg", "font-semibold", "text-white", "flex", "items-center", "gap-2"], [1, "grid", "grid-cols-2", "md:grid-cols-5", "gap-4"], [1, "text-center"], [1, "text-xl", "font-bold", "text-white"], [1, "text-xs", "text-slate-400"], [1, "text-xl", "font-bold", "text-green-400"], [1, "text-xl", "font-bold", "text-purple-400"], [1, "text-xl", "font-bold", "text-cyan-400"], [1, "text-xl", "font-bold", "text-amber-400"], [1, "bg-gradient-to-r", "from-purple-500/20", "to-pink-500/20", "border", "border-purple-500/30", "rounded-xl", "p-5"], [1, "text-xs", "px-2", "py-1", "rounded-full"], [1, "flex", "items-center", "justify-between", "mb-1"], [1, "text-sm", "text-slate-300"], [1, "h-8", "bg-slate-700", "rounded-lg", "overflow-hidden"], [1, "h-full", "transition-all", "duration-500"], [1, "flex", "items-center", "gap-2"], [1, "text-lg"], [1, "text-white", "font-medium"], [1, "flex", "items-center", "gap-1"], [1, "text-green-400", "font-bold"], [1, "text-green-400"], [1, "text-red-400"], [1, "flex", "items-center", "justify-between", "text-sm"], [1, "text-slate-400"], [1, "text-slate-500"], [1, "mt-2", "h-1.5", "bg-slate-700", "rounded-full", "overflow-hidden"], [1, "h-full", "bg-gradient-to-r", "from-green-500", "to-emerald-400", "rounded-full"], [1, "text-3xl", "mb-2"], [1, "flex", "items-center", "gap-4"], [1, "text-4xl"], [1, "flex-1"], [1, "text-white", "font-semibold"], [1, "text-slate-300", "mt-1"], [1, "text-purple-400", "font-medium"], [1, "px-4", "py-2", "bg-purple-500", "text-white", "rounded-lg", "hover:bg-purple-600"]], template: function MarketingReportComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275elementStart(0, "div", 0)(1, "div", 1)(2, "div")(3, "h2", 2)(4, "span");
        \u0275\u0275text(5, "\u{1F4CA}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(6, " \u71DF\u92B7\u6578\u64DA\u5831\u8868 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(7, "p", 3);
        \u0275\u0275text(8, "\u8FFD\u8E64\u71DF\u92B7\u6548\u679C\uFF0C\u512A\u5316\u89D2\u8272\u7D44\u5408");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(9, "div", 4)(10, "select", 5);
        \u0275\u0275twoWayListener("ngModelChange", function MarketingReportComponent_Template_select_ngModelChange_10_listener($event) {
          \u0275\u0275twoWayBindingSet(ctx.selectedPeriod, $event) || (ctx.selectedPeriod = $event);
          return $event;
        });
        \u0275\u0275listener("change", function MarketingReportComponent_Template_select_change_10_listener() {
          return ctx.onPeriodChange();
        });
        \u0275\u0275elementStart(11, "option", 6);
        \u0275\u0275text(12, "\u4ECA\u65E5");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(13, "option", 7);
        \u0275\u0275text(14, "\u672C\u9031");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(15, "option", 8);
        \u0275\u0275text(16, "\u672C\u6708");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(17, "option", 9);
        \u0275\u0275text(18, "\u5168\u90E8");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(19, "button", 10);
        \u0275\u0275listener("click", function MarketingReportComponent_Template_button_click_19_listener() {
          return ctx.refreshData();
        });
        \u0275\u0275elementStart(20, "span");
        \u0275\u0275text(21, "\u{1F504}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(22, " \u5237\u65B0 ");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(23, "div", 11)(24, "div", 12)(25, "div", 13)(26, "span", 14);
        \u0275\u0275text(27, "\u{1F4EC}");
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(28, MarketingReportComponent_Conditional_28_Template, 2, 10, "span", 15);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(29, "div", 16);
        \u0275\u0275text(30);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(31, "div", 17);
        \u0275\u0275text(32, "\u7E3D\u6703\u8A71\u6578");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(33, "div", 18)(34, "div", 13)(35, "span", 19);
        \u0275\u0275text(36, "\u2705");
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(37, MarketingReportComponent_Conditional_37_Template, 2, 10, "span", 15);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(38, "div", 16);
        \u0275\u0275text(39);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(40, "div", 17);
        \u0275\u0275text(41, "\u6210\u529F\u8F49\u5316");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(42, "div", 20)(43, "div", 13)(44, "span", 21);
        \u0275\u0275text(45, "\u{1F4C8}");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(46, "div", 16);
        \u0275\u0275text(47);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(48, "div", 17);
        \u0275\u0275text(49, "\u8F49\u5316\u7387");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(50, "div", 22)(51, "div", 13)(52, "span", 23);
        \u0275\u0275text(53, "\u{1F4B0}");
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(54, MarketingReportComponent_Conditional_54_Template, 2, 10, "span", 15);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(55, "div", 16);
        \u0275\u0275text(56);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(57, "div", 17);
        \u0275\u0275text(58, "\u7E3D\u6536\u5165");
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(59, "div", 24)(60, "div", 25)(61, "h3", 26)(62, "span");
        \u0275\u0275text(63, "\u{1F53B}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(64, " \u8F49\u5316\u6F0F\u6597 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(65, "div", 27);
        \u0275\u0275repeaterCreate(66, MarketingReportComponent_For_67_Template, 8, 7, "div", 28, _forTrack023);
        \u0275\u0275elementEnd();
        \u0275\u0275conditionalCreate(68, MarketingReportComponent_Conditional_68_Template, 2, 0, "div", 29);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(69, "div", 25)(70, "h3", 26)(71, "span");
        \u0275\u0275text(72, "\u{1F3C6}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(73, " \u6700\u4F73\u89D2\u8272\u7D44\u5408 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(74, "div", 27);
        \u0275\u0275repeaterCreate(75, MarketingReportComponent_For_76_Template, 19, 9, "div", 30, _forTrack18);
        \u0275\u0275conditionalCreate(77, MarketingReportComponent_Conditional_77_Template, 5, 0, "div", 29);
        \u0275\u0275elementEnd()()();
        \u0275\u0275elementStart(78, "div", 25)(79, "h3", 26)(80, "span");
        \u0275\u0275text(81, "\u{1F465}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(82, " \u7528\u6236\u4E92\u52D5\u5206\u6790 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(83, "div", 11)(84, "div", 31)(85, "div", 32);
        \u0275\u0275text(86);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(87, "div", 33);
        \u0275\u0275text(88, "\u5E73\u5747\u8208\u8DA3\u5EA6");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(89, "div", 31)(90, "div", 34);
        \u0275\u0275text(91);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(92, "div", 33);
        \u0275\u0275text(93, "\u5E73\u5747\u53C3\u8207\u5EA6");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(94, "div", 31)(95, "div", 35);
        \u0275\u0275text(96);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(97, "div", 33);
        \u0275\u0275text(98, "\u7528\u6236\u756B\u50CF\u6578");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(99, "div", 31)(100, "div", 36);
        \u0275\u0275text(101);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(102, "div", 33);
        \u0275\u0275text(103, "\u89D2\u8272\u7D44\u5408\u6578");
        \u0275\u0275elementEnd()()()();
        \u0275\u0275elementStart(104, "div", 25)(105, "div", 37)(106, "h3", 38)(107, "span");
        \u0275\u0275text(108, "\u{1F4C5}");
        \u0275\u0275elementEnd();
        \u0275\u0275text(109, " \u4ECA\u65E5\u8A73\u60C5 ");
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(110, "span", 17);
        \u0275\u0275text(111);
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(112, "div", 39)(113, "div", 40)(114, "div", 41);
        \u0275\u0275text(115);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(116, "div", 42);
        \u0275\u0275text(117, "\u6703\u8A71");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(118, "div", 40)(119, "div", 43);
        \u0275\u0275text(120);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(121, "div", 42);
        \u0275\u0275text(122, "\u8F49\u5316");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(123, "div", 40)(124, "div", 44);
        \u0275\u0275text(125);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(126, "div", 42);
        \u0275\u0275text(127, "\u8F49\u5316\u7387");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(128, "div", 40)(129, "div", 45);
        \u0275\u0275text(130);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(131, "div", 42);
        \u0275\u0275text(132, "\u6D88\u606F\u6578");
        \u0275\u0275elementEnd()();
        \u0275\u0275elementStart(133, "div", 40)(134, "div", 46);
        \u0275\u0275text(135);
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(136, "div", 42);
        \u0275\u0275text(137, "\u6536\u5165");
        \u0275\u0275elementEnd()()()();
        \u0275\u0275conditionalCreate(138, MarketingReportComponent_Conditional_138_Template, 16, 2, "div", 47);
        \u0275\u0275elementEnd();
      }
      if (rf & 2) {
        \u0275\u0275advance(10);
        \u0275\u0275twoWayProperty("ngModel", ctx.selectedPeriod);
        \u0275\u0275advance(18);
        \u0275\u0275conditional(ctx.comparison().changes.sessions !== 0 ? 28 : -1);
        \u0275\u0275advance(2);
        \u0275\u0275textInterpolate(ctx.totalStats().totalSessions);
        \u0275\u0275advance(7);
        \u0275\u0275conditional(ctx.comparison().changes.conversions !== 0 ? 37 : -1);
        \u0275\u0275advance(2);
        \u0275\u0275textInterpolate(ctx.totalStats().conversions);
        \u0275\u0275advance(8);
        \u0275\u0275textInterpolate1("", ctx.totalStats().conversionRate.toFixed(1), "%");
        \u0275\u0275advance(7);
        \u0275\u0275conditional(ctx.comparison().changes.revenue !== 0 ? 54 : -1);
        \u0275\u0275advance(2);
        \u0275\u0275textInterpolate1("\xA5", ctx.formatNumber(ctx.totalStats().totalRevenue));
        \u0275\u0275advance(10);
        \u0275\u0275repeater(ctx.funnelData());
        \u0275\u0275advance(2);
        \u0275\u0275conditional(ctx.funnelData().length === 0 ? 68 : -1);
        \u0275\u0275advance(7);
        \u0275\u0275repeater(ctx.topCombos());
        \u0275\u0275advance(2);
        \u0275\u0275conditional(ctx.topCombos().length === 0 ? 77 : -1);
        \u0275\u0275advance(9);
        \u0275\u0275textInterpolate(ctx.totalStats().avgInterestScore.toFixed(0));
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate(ctx.totalStats().avgEngagementScore.toFixed(0));
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate(ctx.userProfiles().length);
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate(ctx.roleCombos().length);
        \u0275\u0275advance(10);
        \u0275\u0275textInterpolate(ctx.todayDate);
        \u0275\u0275advance(4);
        \u0275\u0275textInterpolate(ctx.todayReport().totalSessions);
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate(ctx.todayReport().conversions);
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate1("", ctx.todayReport().conversionRate.toFixed(1), "%");
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate(ctx.todayReport().totalMessages);
        \u0275\u0275advance(5);
        \u0275\u0275textInterpolate1("\xA5", ctx.formatNumber(ctx.todayReport().totalRevenue));
        \u0275\u0275advance(3);
        \u0275\u0275conditional(ctx.recommendedCombo() ? 138 : -1);
      }
    }, dependencies: [CommonModule, FormsModule, NgSelectOption, \u0275NgSelectMultipleOption, SelectControlValueAccessor, NgControlStatus, NgModel], styles: ["\n\n.marketing-report[_ngcontent-%COMP%] {\n  max-width: 1400px;\n  margin: 0 auto;\n}\n/*# sourceMappingURL=marketing-report.component.css.map */"] });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(MarketingReportComponent, [{
    type: Component,
    args: [{ selector: "app-marketing-report", standalone: true, imports: [CommonModule, FormsModule], template: `
    <div class="marketing-report p-6 space-y-6">
      <!-- \u9802\u90E8\u6A19\u984C -->
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-2xl font-bold text-white flex items-center gap-3">
            <span>\u{1F4CA}</span>
            \u71DF\u92B7\u6578\u64DA\u5831\u8868
          </h2>
          <p class="text-slate-400 mt-1">\u8FFD\u8E64\u71DF\u92B7\u6548\u679C\uFF0C\u512A\u5316\u89D2\u8272\u7D44\u5408</p>
        </div>
        <div class="flex items-center gap-3">
          <!-- \u6642\u9593\u7BC4\u570D\u9078\u64C7 -->
          <select [(ngModel)]="selectedPeriod" 
                  (change)="onPeriodChange()"
                  class="px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white">
            <option value="today">\u4ECA\u65E5</option>
            <option value="week">\u672C\u9031</option>
            <option value="month">\u672C\u6708</option>
            <option value="all">\u5168\u90E8</option>
          </select>
          <button (click)="refreshData()" 
                  class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 flex items-center gap-2">
            <span>\u{1F504}</span> \u5237\u65B0
          </button>
        </div>
      </div>
      
      <!-- \u7E3D\u9AD4\u7D71\u8A08\u5361\u7247 -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <!-- \u7E3D\u6703\u8A71\u6578 -->
        <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/10 border border-blue-500/30 rounded-xl p-4">
          <div class="flex items-center justify-between mb-2">
            <span class="text-blue-400 text-2xl">\u{1F4EC}</span>
            @if (comparison().changes.sessions !== 0) {
              <span class="text-xs px-2 py-1 rounded-full"
                    [class.bg-green-500/20]="comparison().changes.sessions > 0"
                    [class.text-green-400]="comparison().changes.sessions > 0"
                    [class.bg-red-500/20]="comparison().changes.sessions < 0"
                    [class.text-red-400]="comparison().changes.sessions < 0">
                {{ comparison().changes.sessions > 0 ? '+' : '' }}{{ comparison().changes.sessions.toFixed(1) }}%
              </span>
            }
          </div>
          <div class="text-3xl font-bold text-white">{{ totalStats().totalSessions }}</div>
          <div class="text-sm text-slate-400">\u7E3D\u6703\u8A71\u6578</div>
        </div>
        
        <!-- \u8F49\u5316\u6578 -->
        <div class="bg-gradient-to-br from-green-500/20 to-green-600/10 border border-green-500/30 rounded-xl p-4">
          <div class="flex items-center justify-between mb-2">
            <span class="text-green-400 text-2xl">\u2705</span>
            @if (comparison().changes.conversions !== 0) {
              <span class="text-xs px-2 py-1 rounded-full"
                    [class.bg-green-500/20]="comparison().changes.conversions > 0"
                    [class.text-green-400]="comparison().changes.conversions > 0"
                    [class.bg-red-500/20]="comparison().changes.conversions < 0"
                    [class.text-red-400]="comparison().changes.conversions < 0">
                {{ comparison().changes.conversions > 0 ? '+' : '' }}{{ comparison().changes.conversions.toFixed(1) }}%
              </span>
            }
          </div>
          <div class="text-3xl font-bold text-white">{{ totalStats().conversions }}</div>
          <div class="text-sm text-slate-400">\u6210\u529F\u8F49\u5316</div>
        </div>
        
        <!-- \u8F49\u5316\u7387 -->
        <div class="bg-gradient-to-br from-purple-500/20 to-purple-600/10 border border-purple-500/30 rounded-xl p-4">
          <div class="flex items-center justify-between mb-2">
            <span class="text-purple-400 text-2xl">\u{1F4C8}</span>
          </div>
          <div class="text-3xl font-bold text-white">{{ totalStats().conversionRate.toFixed(1) }}%</div>
          <div class="text-sm text-slate-400">\u8F49\u5316\u7387</div>
        </div>
        
        <!-- \u7E3D\u6536\u5165 -->
        <div class="bg-gradient-to-br from-amber-500/20 to-amber-600/10 border border-amber-500/30 rounded-xl p-4">
          <div class="flex items-center justify-between mb-2">
            <span class="text-amber-400 text-2xl">\u{1F4B0}</span>
            @if (comparison().changes.revenue !== 0) {
              <span class="text-xs px-2 py-1 rounded-full"
                    [class.bg-green-500/20]="comparison().changes.revenue > 0"
                    [class.text-green-400]="comparison().changes.revenue > 0"
                    [class.bg-red-500/20]="comparison().changes.revenue < 0"
                    [class.text-red-400]="comparison().changes.revenue < 0">
                {{ comparison().changes.revenue > 0 ? '+' : '' }}{{ comparison().changes.revenue.toFixed(1) }}%
              </span>
            }
          </div>
          <div class="text-3xl font-bold text-white">\xA5{{ formatNumber(totalStats().totalRevenue) }}</div>
          <div class="text-sm text-slate-400">\u7E3D\u6536\u5165</div>
        </div>
      </div>
      
      <!-- \u4E3B\u5167\u5BB9\u5340 -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- \u8F49\u5316\u6F0F\u6597 -->
        <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-5">
          <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
            <span>\u{1F53B}</span> \u8F49\u5316\u6F0F\u6597
          </h3>
          <div class="space-y-3">
            @for (stage of funnelData(); track stage.stage; let i = $index) {
              <div class="relative">
                <div class="flex items-center justify-between mb-1">
                  <span class="text-sm text-slate-300">{{ getStageName(stage.stage) }}</span>
                  <span class="text-sm text-slate-400">{{ stage.count }} ({{ stage.rate.toFixed(1) }}%)</span>
                </div>
                <div class="h-8 bg-slate-700 rounded-lg overflow-hidden">
                  <div class="h-full transition-all duration-500"
                       [style.width.%]="stage.rate"
                       [class]="getFunnelColor(i)">
                  </div>
                </div>
              </div>
            }
          </div>
          @if (funnelData().length === 0) {
            <div class="text-center py-8 text-slate-500">
              \u66AB\u7121\u6578\u64DA
            </div>
          }
        </div>
        
        <!-- \u6700\u4F73\u89D2\u8272\u7D44\u5408 -->
        <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-5">
          <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
            <span>\u{1F3C6}</span> \u6700\u4F73\u89D2\u8272\u7D44\u5408
          </h3>
          <div class="space-y-3">
            @for (combo of topCombos(); track combo.comboId; let i = $index) {
              <div class="p-3 bg-slate-900/50 rounded-lg border border-slate-700/50">
                <div class="flex items-center justify-between mb-2">
                  <div class="flex items-center gap-2">
                    <span class="text-lg">{{ getMedalEmoji(i) }}</span>
                    <span class="text-white font-medium">{{ combo.comboName }}</span>
                  </div>
                  <div class="flex items-center gap-1">
                    <span class="text-green-400 font-bold">{{ combo.conversionRate.toFixed(1) }}%</span>
                    @if (combo.trend === 'up') {
                      <span class="text-green-400">\u2191</span>
                    } @else if (combo.trend === 'down') {
                      <span class="text-red-400">\u2193</span>
                    }
                  </div>
                </div>
                <div class="flex items-center justify-between text-sm">
                  <span class="text-slate-400">
                    {{ combo.totalSessions }} \u6B21\u4F7F\u7528 \xB7 {{ combo.conversions }} \u6B21\u8F49\u5316
                  </span>
                  <span class="text-slate-500">
                    \u5E73\u5747 {{ combo.avgMessageCount.toFixed(0) }} \u689D\u6D88\u606F
                  </span>
                </div>
                <!-- \u9032\u5EA6\u689D -->
                <div class="mt-2 h-1.5 bg-slate-700 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-green-500 to-emerald-400 rounded-full"
                       [style.width.%]="combo.conversionRate"></div>
                </div>
              </div>
            }
            @if (topCombos().length === 0) {
              <div class="text-center py-8 text-slate-500">
                <div class="text-3xl mb-2">\u{1F4CA}</div>
                <div>\u958B\u59CB\u71DF\u92B7\u5F8C\u5C07\u986F\u793A\u89D2\u8272\u7D44\u5408\u6548\u679C</div>
              </div>
            }
          </div>
        </div>
      </div>
      
      <!-- \u7528\u6236\u4E92\u52D5\u7D71\u8A08 -->
      <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-5">
        <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
          <span>\u{1F465}</span> \u7528\u6236\u4E92\u52D5\u5206\u6790
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="text-center p-4 bg-slate-900/50 rounded-lg">
            <div class="text-2xl font-bold text-cyan-400">{{ totalStats().avgInterestScore.toFixed(0) }}</div>
            <div class="text-sm text-slate-400 mt-1">\u5E73\u5747\u8208\u8DA3\u5EA6</div>
          </div>
          <div class="text-center p-4 bg-slate-900/50 rounded-lg">
            <div class="text-2xl font-bold text-pink-400">{{ totalStats().avgEngagementScore.toFixed(0) }}</div>
            <div class="text-sm text-slate-400 mt-1">\u5E73\u5747\u53C3\u8207\u5EA6</div>
          </div>
          <div class="text-center p-4 bg-slate-900/50 rounded-lg">
            <div class="text-2xl font-bold text-orange-400">{{ userProfiles().length }}</div>
            <div class="text-sm text-slate-400 mt-1">\u7528\u6236\u756B\u50CF\u6578</div>
          </div>
          <div class="text-center p-4 bg-slate-900/50 rounded-lg">
            <div class="text-2xl font-bold text-indigo-400">{{ roleCombos().length }}</div>
            <div class="text-sm text-slate-400 mt-1">\u89D2\u8272\u7D44\u5408\u6578</div>
          </div>
        </div>
      </div>
      
      <!-- \u4ECA\u65E5\u8A73\u60C5 -->
      <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-5">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-white flex items-center gap-2">
            <span>\u{1F4C5}</span> \u4ECA\u65E5\u8A73\u60C5
          </h3>
          <span class="text-sm text-slate-400">{{ todayDate }}</span>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
          <div class="text-center">
            <div class="text-xl font-bold text-white">{{ todayReport().totalSessions }}</div>
            <div class="text-xs text-slate-400">\u6703\u8A71</div>
          </div>
          <div class="text-center">
            <div class="text-xl font-bold text-green-400">{{ todayReport().conversions }}</div>
            <div class="text-xs text-slate-400">\u8F49\u5316</div>
          </div>
          <div class="text-center">
            <div class="text-xl font-bold text-purple-400">{{ todayReport().conversionRate.toFixed(1) }}%</div>
            <div class="text-xs text-slate-400">\u8F49\u5316\u7387</div>
          </div>
          <div class="text-center">
            <div class="text-xl font-bold text-cyan-400">{{ todayReport().totalMessages }}</div>
            <div class="text-xs text-slate-400">\u6D88\u606F\u6578</div>
          </div>
          <div class="text-center">
            <div class="text-xl font-bold text-amber-400">\xA5{{ formatNumber(todayReport().totalRevenue) }}</div>
            <div class="text-xs text-slate-400">\u6536\u5165</div>
          </div>
        </div>
      </div>
      
      <!-- \u63A8\u85A6\u63D0\u793A -->
      @if (recommendedCombo()) {
        <div class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-xl p-5">
          <div class="flex items-center gap-4">
            <div class="text-4xl">\u{1F4A1}</div>
            <div class="flex-1">
              <h4 class="text-white font-semibold">\u63A8\u85A6\u4F7F\u7528\u89D2\u8272\u7D44\u5408</h4>
              <p class="text-slate-300 mt-1">
                \u6839\u64DA\u6B77\u53F2\u6578\u64DA\uFF0C\u300C<span class="text-purple-400 font-medium">{{ recommendedCombo()!.comboName }}</span>\u300D
                \u7D44\u5408\u8868\u73FE\u6700\u4F73\uFF0C\u8F49\u5316\u7387\u9054 <span class="text-green-400 font-bold">{{ recommendedCombo()!.conversionRate.toFixed(1) }}%</span>
              </p>
            </div>
            <button class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600">
              \u4F7F\u7528\u6B64\u7D44\u5408
            </button>
          </div>
        </div>
      }
    </div>
  `, styles: ["/* angular:styles/component:css;e0bdd4b4da253e0b88f450891191075c2b7afefb6816a81486ae58ae3eead0d5;D:/tgkz2026/src/components/marketing-report.component.ts */\n.marketing-report {\n  max-width: 1400px;\n  margin: 0 auto;\n}\n/*# sourceMappingURL=marketing-report.component.css.map */\n"] }]
  }], null, null);
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(MarketingReportComponent, { className: "MarketingReportComponent", filePath: "src/components/marketing-report.component.ts", lineNumber: 278 });
})();

// src/app.component.ts
var _c04 = ["onboardingRef"];
var _c12 = ["monitoringGroupsRef"];
var _forTrack024 = ($index, $item) => $item.id;
var _forTrack19 = ($index, $item) => $item.name;
var _forTrack25 = ($index, $item) => $item.phone;
function AppComponent_Conditional_5_Conditional_1_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 15);
    \u0275\u0275text(1, "\u4F7F\u7528\u7DE9\u5B58\u6578\u64DA");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_5_Conditional_1_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 16);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("", ctx_r0.offlineCache.pendingOperations().length, " \u500B\u5F85\u540C\u6B65\u64CD\u4F5C");
  }
}
function AppComponent_Conditional_5_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 10);
    \u0275\u0275element(1, "div", 11);
    \u0275\u0275elementStart(2, "div", 12)(3, "div", 13)(4, "p", 14);
    \u0275\u0275text(5, "\u{1F4F4} \u96E2\u7DDA\u6A21\u5F0F");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(6, AppComponent_Conditional_5_Conditional_1_Conditional_6_Template, 2, 0, "p", 15);
    \u0275\u0275conditionalCreate(7, AppComponent_Conditional_5_Conditional_1_Conditional_7_Template, 2, 1, "p", 16);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(6);
    \u0275\u0275conditional(ctx_r0.offlineCache.isCacheValid() ? 6 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.offlineCache.hasPendingOperations() ? 7 : -1);
  }
}
function AppComponent_Conditional_5_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 10);
    \u0275\u0275element(1, "div", 17);
    \u0275\u0275elementStart(2, "div", 12)(3, "div", 13)(4, "p", 18);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r0.backendConnectionMessage());
  }
}
function AppComponent_Conditional_5_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    const _r2 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 10)(1, "div", 19);
    \u0275\u0275listener("click", function AppComponent_Conditional_5_Conditional_3_Template_div_click_1_listener() {
      \u0275\u0275restoreView(_r2);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.retryConnection());
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "div", 12)(3, "div", 13)(4, "p", 20);
    \u0275\u0275text(5, "\u964D\u7D1A\u6A21\u5F0F\uFF08\u9EDE\u64CA\u91CD\u9023\uFF09");
    \u0275\u0275elementEnd()()()();
  }
}
function AppComponent_Conditional_5_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 10)(1, "div", 21);
    \u0275\u0275listener("click", function AppComponent_Conditional_5_Conditional_4_Template_div_click_1_listener() {
      \u0275\u0275restoreView(_r3);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.retryConnection());
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "div", 12)(3, "div", 13)(4, "p", 22);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "p", 15);
    \u0275\u0275text(7, "\u9EDE\u64CA\u91CD\u8A66");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r0.backendConnectionMessage());
  }
}
function AppComponent_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 1);
    \u0275\u0275conditionalCreate(1, AppComponent_Conditional_5_Conditional_1_Template, 8, 2, "div", 10)(2, AppComponent_Conditional_5_Conditional_2_Template, 6, 1, "div", 10)(3, AppComponent_Conditional_5_Conditional_3_Template, 6, 0, "div", 10)(4, AppComponent_Conditional_5_Conditional_4_Template, 8, 1, "div", 10);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275conditional(!ctx_r0.offlineCache.isOnline() ? 1 : ctx_r0.backendConnectionState() === "connecting" ? 2 : ctx_r0.backendConnectionState() === "timeout" ? 3 : ctx_r0.backendConnectionState() === "error" ? 4 : -1);
  }
}
function AppComponent_Conditional_6_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 32);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_2_0;
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate((tmp_2_0 = ctx_r0.successOverlayConfig()) == null ? null : tmp_2_0.subtitle);
  }
}
function AppComponent_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 2);
    \u0275\u0275element(1, "div", 23);
    \u0275\u0275elementStart(2, "div", 24);
    \u0275\u0275element(3, "div", 25);
    \u0275\u0275elementStart(4, "div", 26)(5, "div", 27)(6, "div", 28)(7, "span", 29);
    \u0275\u0275text(8);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(9, "div", 30)(10, "h3", 31);
    \u0275\u0275text(11);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(12, AppComponent_Conditional_6_Conditional_12_Template, 2, 1, "p", 32);
    \u0275\u0275elementEnd();
    \u0275\u0275element(13, "div", 33)(14, "div", 34)(15, "div", 35)(16, "div", 36);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    let tmp_1_0;
    let tmp_2_0;
    let tmp_3_0;
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(8);
    \u0275\u0275textInterpolate(((tmp_1_0 = ctx_r0.successOverlayConfig()) == null ? null : tmp_1_0.icon) || "\u2705");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(((tmp_2_0 = ctx_r0.successOverlayConfig()) == null ? null : tmp_2_0.title) || "\u64CD\u4F5C\u6210\u529F");
    \u0275\u0275advance();
    \u0275\u0275conditional(((tmp_3_0 = ctx_r0.successOverlayConfig()) == null ? null : tmp_3_0.subtitle) ? 12 : -1);
  }
}
function AppComponent_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 7)(1, "div", 37);
    \u0275\u0275listener("click", function AppComponent_Conditional_14_Template_div_click_1_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.closeQrLogin());
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "div", 38)(3, "app-qr-login", 39);
    \u0275\u0275listener("closed", function AppComponent_Conditional_14_Template_app_qr_login_closed_3_listener() {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.closeQrLogin());
    })("loginSuccess", function AppComponent_Conditional_14_Template_app_qr_login_loginSuccess_3_listener($event) {
      \u0275\u0275restoreView(_r4);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.onQrLoginSuccess($event));
    });
    \u0275\u0275elementEnd()()();
  }
}
function AppComponent_Conditional_15_Conditional_4_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 128);
    \u0275\u0275text(1, " \u78BA\u5B9A\u8981\u522A\u9664\u5BA2\u6236 ");
    \u0275\u0275elementStart(2, "span", 134);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275text(4, " \u55CE\uFF1F ");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_5_0;
    const ctx_r0 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("@", ((tmp_5_0 = ctx_r0.deleteConfirmDialog().lead) == null ? null : tmp_5_0.username) || ((tmp_5_0 = ctx_r0.deleteConfirmDialog().lead) == null ? null : tmp_5_0.userId));
  }
}
function AppComponent_Conditional_15_Conditional_4_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 128);
    \u0275\u0275text(1, " \u78BA\u5B9A\u8981\u522A\u9664 ");
    \u0275\u0275elementStart(2, "span", 135);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275text(4, " \u500B\u9078\u4E2D\u7684\u5BA2\u6236\u55CE\uFF1F ");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r0.deleteConfirmDialog().count);
  }
}
function AppComponent_Conditional_15_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 118);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_4_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.cancelDeleteLeads());
    });
    \u0275\u0275elementStart(1, "div", 119);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_4_Template_div_click_1_listener($event) {
      \u0275\u0275restoreView(_r6);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275elementStart(2, "div", 120)(3, "div", 121);
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(4, "svg", 122);
    \u0275\u0275element(5, "path", 123)(6, "line", 124)(7, "line", 125);
    \u0275\u0275elementEnd()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(8, "h3", 126);
    \u0275\u0275text(9, "\u78BA\u8A8D\u522A\u9664");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(10, "div", 127);
    \u0275\u0275conditionalCreate(11, AppComponent_Conditional_15_Conditional_4_Conditional_11_Template, 5, 1, "p", 128)(12, AppComponent_Conditional_15_Conditional_4_Conditional_12_Template, 5, 1, "p", 128);
    \u0275\u0275elementStart(13, "div", 129);
    \u0275\u0275text(14, " \u26A0\uFE0F \u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\uFF0C\u6240\u6709\u76F8\u95DC\u8A18\u9304\u5C07\u88AB\u6C38\u4E45\u522A\u9664\u3002 ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(15, "div", 130)(16, "button", 131);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_4_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.cancelDeleteLeads());
    });
    \u0275\u0275text(17, " \u53D6\u6D88 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "button", 132);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_4_Template_button_click_18_listener() {
      \u0275\u0275restoreView(_r6);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.executeDeleteLeads());
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(19, "svg", 133);
    \u0275\u0275element(20, "path", 123);
    \u0275\u0275elementEnd();
    \u0275\u0275text(21, " \u78BA\u8A8D\u522A\u9664 ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(11);
    \u0275\u0275conditional(ctx_r0.deleteConfirmDialog().type === "single" ? 11 : 12);
  }
}
function AppComponent_Conditional_15_Conditional_5_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    const _r8 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 139)(1, "p", 143);
    \u0275\u0275text(2, "\u66AB\u7121\u5354\u4F5C\u7FA4\u7D44");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "button", 144);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_5_Conditional_12_Template_button_click_3_listener() {
      \u0275\u0275restoreView(_r8);
      const ctx_r0 = \u0275\u0275nextContext(3);
      ctx_r0.currentView.set("multi-role");
      return \u0275\u0275resetView(ctx_r0.showInviteGroupDialog.set(false));
    });
    \u0275\u0275text(4, " \u53BB\u5275\u5EFA\u7FA4\u7D44 \u2192 ");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Conditional_5_Conditional_13_For_2_Template(rf, ctx) {
  if (rf & 1) {
    const _r9 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 146);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_5_Conditional_13_For_2_Template_button_click_0_listener() {
      const group_r10 = \u0275\u0275restoreView(_r9).$implicit;
      const ctx_r0 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r0.executeInviteToGroup(group_r10.id));
    });
    \u0275\u0275elementStart(1, "div", 147)(2, "div")(3, "p", 148);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 149);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(7, "span", 150);
    \u0275\u0275text(8, "\u2192");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const group_r10 = ctx.$implicit;
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(group_r10.name);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("", (group_r10.members == null ? null : group_r10.members.length) || 0, " \u500B\u6210\u54E1");
  }
}
function AppComponent_Conditional_15_Conditional_5_Conditional_13_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 140);
    \u0275\u0275repeaterCreate(1, AppComponent_Conditional_15_Conditional_5_Conditional_13_For_2_Template, 9, 2, "button", 145, _forTrack024);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r0.collabGroups());
  }
}
function AppComponent_Conditional_15_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    const _r7 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 118);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_5_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.showInviteGroupDialog.set(false));
    });
    \u0275\u0275elementStart(1, "div", 119);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_5_Template_div_click_1_listener($event) {
      \u0275\u0275restoreView(_r7);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275elementStart(2, "div", 120)(3, "div", 136)(4, "span", 137);
    \u0275\u0275text(5, "\u{1F465}");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div")(7, "h3", 126);
    \u0275\u0275text(8, "\u9080\u8ACB\u9032\u7FA4");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "p", 32);
    \u0275\u0275text(10, "\u9078\u64C7\u5354\u4F5C\u7FA4\u7D44");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(11, "div", 138);
    \u0275\u0275conditionalCreate(12, AppComponent_Conditional_15_Conditional_5_Conditional_12_Template, 5, 0, "div", 139)(13, AppComponent_Conditional_15_Conditional_5_Conditional_13_Template, 3, 0, "div", 140);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "div", 141)(15, "button", 142);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_5_Template_button_click_15_listener() {
      \u0275\u0275restoreView(_r7);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.showInviteGroupDialog.set(false));
    });
    \u0275\u0275text(16, " \u53D6\u6D88 ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(12);
    \u0275\u0275conditional(ctx_r0.collabGroups().length === 0 ? 12 : 13);
  }
}
function AppComponent_Conditional_15_Conditional_27_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div")(1, "h1", 151);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 152);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r0.t("title"));
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r0.t("subtitle"));
  }
}
function AppComponent_Conditional_15_Conditional_35_Case_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 154);
    \u0275\u0275text(1, "\u{1F948}");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_35_Case_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 154);
    \u0275\u0275text(1, "\u{1F947}");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_35_Case_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 154);
    \u0275\u0275text(1, "\u{1F48E}");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_35_Case_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 154);
    \u0275\u0275text(1, "\u{1F31F}");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_35_Case_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 155);
    \u0275\u0275text(1, "\u{1F451}");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_35_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 153);
    \u0275\u0275conditionalCreate(1, AppComponent_Conditional_15_Conditional_35_Case_1_Template, 2, 0, "span", 154)(2, AppComponent_Conditional_15_Conditional_35_Case_2_Template, 2, 0, "span", 154)(3, AppComponent_Conditional_15_Conditional_35_Case_3_Template, 2, 0, "span", 154)(4, AppComponent_Conditional_15_Conditional_35_Case_4_Template, 2, 0, "span", 154)(5, AppComponent_Conditional_15_Conditional_35_Case_5_Template, 2, 0, "span", 155);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_9_0;
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275classProp("badge-silver", ctx_r0.userMembershipLevel() === "silver")("badge-gold", ctx_r0.userMembershipLevel() === "gold")("badge-diamond", ctx_r0.userMembershipLevel() === "diamond")("badge-star", ctx_r0.userMembershipLevel() === "star")("badge-king", ctx_r0.userMembershipLevel() === "king");
    \u0275\u0275advance();
    \u0275\u0275conditional((tmp_9_0 = ctx_r0.userMembershipLevel()) === "silver" ? 1 : tmp_9_0 === "gold" ? 2 : tmp_9_0 === "diamond" ? 3 : tmp_9_0 === "star" ? 4 : tmp_9_0 === "king" ? 5 : -1);
  }
}
function AppComponent_Conditional_15_Case_40_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 73)(1, "span", 156);
    \u0275\u0275text(2, "\u{1F948}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 157);
    \u0275\u0275text(4, "\u767D\u9280\u7CBE\u82F1");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Case_41_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 74)(1, "span", 156);
    \u0275\u0275text(2, "\u{1F947}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 157);
    \u0275\u0275text(4, "\u9EC3\u91D1\u5927\u5E2B");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Case_42_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 75)(1, "span", 156);
    \u0275\u0275text(2, "\u{1F48E}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 157);
    \u0275\u0275text(4, "\u947D\u77F3\u738B\u724C");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Case_43_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 76)(1, "span", 156);
    \u0275\u0275text(2, "\u{1F31F}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 157);
    \u0275\u0275text(4, "\u661F\u8000\u50B3\u8AAA");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Case_44_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 77)(1, "span", 156);
    \u0275\u0275text(2, "\u{1F451}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 157);
    \u0275\u0275text(4, "\u69AE\u8000\u738B\u8005");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Case_45_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 78)(1, "span", 156);
    \u0275\u0275text(2, "\u2694\uFE0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 157);
    \u0275\u0275text(4, "\u9752\u9285\u6230\u58EB");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Conditional_76_Template(rf, ctx) {
  if (rf & 1) {
    const _r11 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 97)(1, "a", 158);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_76_Template_a_click_1_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("accounts"));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(2, "svg", 84);
    \u0275\u0275element(3, "path", 159)(4, "circle", 160)(5, "path", 161)(6, "path", 162);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(7, "span");
    \u0275\u0275text(8);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(9, "a", 163);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_76_Template_a_click_9_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("search-discovery"));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(10, "svg", 84);
    \u0275\u0275element(11, "circle", 164)(12, "path", 165);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(13, "span");
    \u0275\u0275text(14, "\u641C\u7D22\u767C\u73FE");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "span", 166);
    \u0275\u0275text(16, "NEW");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(17, "a", 167);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_76_Template_a_click_17_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("resource-center"));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(18, "svg", 84);
    \u0275\u0275element(19, "ellipse", 168)(20, "path", 169)(21, "path", 170);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(22, "span");
    \u0275\u0275text(23, "\u8CC7\u6E90\u4E2D\u5FC3");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(24, "a", 83);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_76_Template_a_click_24_listener() {
      \u0275\u0275restoreView(_r11);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("leads"));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(25, "svg", 84);
    \u0275\u0275element(26, "path", 171)(27, "path", 172);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(28, "span");
    \u0275\u0275text(29, "\u767C\u9001\u63A7\u5236\u53F0");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    \u0275\u0275nextContext();
    const view_r12 = \u0275\u0275readContextLet(50);
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275styleProp("background-color", view_r12 === "accounts" || view_r12 === "add-account" || view_r12 === "api-credentials" ? "var(--sidebar-item-active)" : "transparent")("color", view_r12 === "accounts" || view_r12 === "add-account" || view_r12 === "api-credentials" ? "var(--sidebar-text-active)" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "accounts" || view_r12 === "add-account" || view_r12 === "api-credentials");
    \u0275\u0275advance(7);
    \u0275\u0275textInterpolate(ctx_r0.t("accounts"));
    \u0275\u0275advance();
    \u0275\u0275styleProp("background-color", view_r12 === "search-discovery" ? "rgba(6, 182, 212, 0.2)" : "transparent")("color", view_r12 === "search-discovery" ? "#22d3ee" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "search-discovery");
    \u0275\u0275advance(8);
    \u0275\u0275styleProp("background-color", view_r12 === "resource-center" || view_r12 === "resources" ? "rgba(6, 182, 212, 0.2)" : "transparent")("color", view_r12 === "resource-center" || view_r12 === "resources" ? "#22d3ee" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "resource-center" || view_r12 === "resources");
    \u0275\u0275advance(7);
    \u0275\u0275styleProp("background-color", view_r12 === "leads" ? "var(--sidebar-item-active)" : "transparent")("color", view_r12 === "leads" ? "var(--sidebar-text-active)" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "leads");
  }
}
function AppComponent_Conditional_15_Conditional_85_Template(rf, ctx) {
  if (rf & 1) {
    const _r13 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 97)(1, "a", 173);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_85_Template_a_click_1_listener() {
      \u0275\u0275restoreView(_r13);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("automation"));
    });
    \u0275\u0275elementStart(2, "div", 174)(3, "span", 175);
    \u0275\u0275text(4, "\u{1F4CA}");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(5, "div", 176)(6, "span", 177);
    \u0275\u0275text(7, "\u81EA\u52D5\u5316\u7E3D\u89BD");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "span", 178);
    \u0275\u0275text(9, "\u914D\u7F6E\u8207\u76E3\u63A7\u72C0\u614B");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(10, "a", 179);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_85_Template_a_click_10_listener() {
      \u0275\u0275restoreView(_r13);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("monitoring-accounts"));
    });
    \u0275\u0275elementStart(11, "span", 180);
    \u0275\u0275text(12, "\u{1F4F1}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "span");
    \u0275\u0275text(14, "\u76E3\u63A7\u5E33\u865F");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(15, "a", 179);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_85_Template_a_click_15_listener() {
      \u0275\u0275restoreView(_r13);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("monitoring-groups"));
    });
    \u0275\u0275elementStart(16, "span", 180);
    \u0275\u0275text(17, "\u{1F4AC}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "span");
    \u0275\u0275text(19, "\u76E3\u63A7\u7FA4\u7D44");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(20, "a", 179);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_85_Template_a_click_20_listener() {
      \u0275\u0275restoreView(_r13);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("keyword-sets"));
    });
    \u0275\u0275elementStart(21, "span", 180);
    \u0275\u0275text(22, "\u{1F511}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(23, "span");
    \u0275\u0275text(24, "\u95DC\u9375\u8A5E\u96C6");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(25, "a", 179);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_85_Template_a_click_25_listener() {
      \u0275\u0275restoreView(_r13);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("chat-templates"));
    });
    \u0275\u0275elementStart(26, "span", 180);
    \u0275\u0275text(27, "\u{1F4DD}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(28, "span");
    \u0275\u0275text(29, "\u804A\u5929\u6A21\u677F");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(30, "a", 179);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_85_Template_a_click_30_listener() {
      \u0275\u0275restoreView(_r13);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("trigger-rules"));
    });
    \u0275\u0275elementStart(31, "span", 180);
    \u0275\u0275text(32, "\u26A1");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(33, "span");
    \u0275\u0275text(34, "\u89F8\u767C\u898F\u5247");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(35, "a", 179);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_85_Template_a_click_35_listener() {
      \u0275\u0275restoreView(_r13);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("collected-users"));
    });
    \u0275\u0275elementStart(36, "span", 180);
    \u0275\u0275text(37, "\u{1F465}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(38, "span");
    \u0275\u0275text(39, "\u6536\u96C6\u7528\u6236");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(40, "span", 181);
    \u0275\u0275text(41, "NEW");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    \u0275\u0275nextContext();
    const view_r12 = \u0275\u0275readContextLet(50);
    \u0275\u0275advance();
    \u0275\u0275styleProp("background-color", view_r12 === "automation" ? "rgba(6, 182, 212, 0.15)" : "transparent")("color", view_r12 === "automation" ? "#22d3ee" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "automation");
    \u0275\u0275advance();
    \u0275\u0275classProp("bg-gradient-to-br", view_r12 === "automation")("from-cyan-500", view_r12 === "automation")("to-blue-500", view_r12 === "automation")("bg-slate-700/50", view_r12 !== "automation")("group-hover:bg-slate-700", view_r12 !== "automation");
    \u0275\u0275advance(8);
    \u0275\u0275styleProp("background-color", view_r12 === "monitoring-accounts" ? "rgba(6, 182, 212, 0.1)" : "transparent")("color", view_r12 === "monitoring-accounts" ? "#22d3ee" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "monitoring-accounts");
    \u0275\u0275advance(5);
    \u0275\u0275styleProp("background-color", view_r12 === "monitoring-groups" ? "rgba(16, 185, 129, 0.1)" : "transparent")("color", view_r12 === "monitoring-groups" ? "#34d399" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "monitoring-groups");
    \u0275\u0275advance(5);
    \u0275\u0275styleProp("background-color", view_r12 === "keyword-sets" ? "rgba(139, 92, 246, 0.1)" : "transparent")("color", view_r12 === "keyword-sets" ? "#a78bfa" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "keyword-sets");
    \u0275\u0275advance(5);
    \u0275\u0275styleProp("background-color", view_r12 === "chat-templates" ? "rgba(236, 72, 153, 0.1)" : "transparent")("color", view_r12 === "chat-templates" ? "#f472b6" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "chat-templates");
    \u0275\u0275advance(5);
    \u0275\u0275styleProp("background-color", view_r12 === "trigger-rules" ? "rgba(251, 146, 60, 0.1)" : "transparent")("color", view_r12 === "trigger-rules" ? "#fb923c" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "trigger-rules");
    \u0275\u0275advance(5);
    \u0275\u0275styleProp("background-color", view_r12 === "collected-users" ? "rgba(139, 92, 246, 0.1)" : "transparent")("color", view_r12 === "collected-users" ? "#a78bfa" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "collected-users");
  }
}
function AppComponent_Conditional_15_Conditional_94_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 183);
    \u0275\u0275text(1, "1");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_94_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 184);
    \u0275\u0275text(1, "\u{1F48E}");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_94_Conditional_21_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 186);
    \u0275\u0275text(1, "2");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_94_Conditional_22_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 184);
    \u0275\u0275text(1, "\u{1F48E}");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_94_Conditional_32_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 187);
    \u0275\u0275text(1, "3");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_94_Conditional_33_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 184);
    \u0275\u0275text(1, "\u{1F947}");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_94_Template(rf, ctx) {
  if (rf & 1) {
    const _r14 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 97)(1, "a", 182);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_94_Template_a_click_1_listener() {
      \u0275\u0275restoreView(_r14);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("ai-assistant"));
    });
    \u0275\u0275elementStart(2, "div", 174)(3, "span", 175);
    \u0275\u0275text(4, "\u{1F3AF}");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(5, "div", 176)(6, "span", 177);
    \u0275\u0275text(7, "\u7B56\u7565\u898F\u5283");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "span", 178);
    \u0275\u0275text(9, "AI \u71DF\u92B7\u52A9\u624B");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(10, AppComponent_Conditional_15_Conditional_94_Conditional_10_Template, 2, 0, "span", 183)(11, AppComponent_Conditional_15_Conditional_94_Conditional_11_Template, 2, 0, "span", 184);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "a", 185);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_94_Template_a_click_12_listener() {
      \u0275\u0275restoreView(_r14);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("ai-team"));
    });
    \u0275\u0275elementStart(13, "div", 174)(14, "span", 175);
    \u0275\u0275text(15, "\u{1F916}");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(16, "div", 176)(17, "span", 177);
    \u0275\u0275text(18, "\u81EA\u52D5\u57F7\u884C");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(19, "span", 178);
    \u0275\u0275text(20, "AI \u5718\u968A\u92B7\u552E");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(21, AppComponent_Conditional_15_Conditional_94_Conditional_21_Template, 2, 0, "span", 186)(22, AppComponent_Conditional_15_Conditional_94_Conditional_22_Template, 2, 0, "span", 184);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(23, "a", 185);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_94_Template_a_click_23_listener() {
      \u0275\u0275restoreView(_r14);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("analytics"));
    });
    \u0275\u0275elementStart(24, "div", 174)(25, "span", 175);
    \u0275\u0275text(26, "\u{1F4CA}");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(27, "div", 176)(28, "span", 177);
    \u0275\u0275text(29, "\u6578\u64DA\u6D1E\u5BDF");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(30, "span", 178);
    \u0275\u0275text(31, "\u667A\u80FD\u5206\u6790\u5831\u544A");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(32, AppComponent_Conditional_15_Conditional_94_Conditional_32_Template, 2, 0, "span", 187)(33, AppComponent_Conditional_15_Conditional_94_Conditional_33_Template, 2, 0, "span", 184);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    \u0275\u0275nextContext();
    const view_r12 = \u0275\u0275readContextLet(50);
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275styleProp("background-color", view_r12 === "ai-assistant" ? "rgba(249, 115, 22, 0.15)" : "transparent")("color", view_r12 === "ai-assistant" ? "#fb923c" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "ai-assistant")("opacity-50", !ctx_r0.membershipService.hasFeature("strategyPlanning"));
    \u0275\u0275property("title", !ctx_r0.membershipService.hasFeature("strategyPlanning") ? "\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1" : "");
    \u0275\u0275advance();
    \u0275\u0275classProp("bg-gradient-to-br", view_r12 === "ai-assistant")("from-orange-500", view_r12 === "ai-assistant")("to-amber-500", view_r12 === "ai-assistant")("bg-slate-700/50", view_r12 !== "ai-assistant")("group-hover:bg-slate-700", view_r12 !== "ai-assistant");
    \u0275\u0275advance(8);
    \u0275\u0275conditional(ctx_r0.membershipService.hasFeature("strategyPlanning") ? 10 : 11);
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("background-color", view_r12 === "ai-team" ? "rgba(168, 85, 247, 0.15)" : "transparent")("color", view_r12 === "ai-team" ? "#c084fc" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "ai-team")("opacity-50", !ctx_r0.membershipService.hasFeature("autoExecution"));
    \u0275\u0275property("title", !ctx_r0.membershipService.hasFeature("autoExecution") ? "\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1" : "");
    \u0275\u0275advance();
    \u0275\u0275classProp("bg-gradient-to-br", view_r12 === "ai-team")("from-purple-500", view_r12 === "ai-team")("to-pink-500", view_r12 === "ai-team")("bg-slate-700/50", view_r12 !== "ai-team")("group-hover:bg-slate-700", view_r12 !== "ai-team");
    \u0275\u0275advance(8);
    \u0275\u0275conditional(ctx_r0.membershipService.hasFeature("autoExecution") ? 21 : 22);
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("background-color", view_r12 === "analytics" ? "rgba(6, 182, 212, 0.15)" : "transparent")("color", view_r12 === "analytics" ? "#22d3ee" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "analytics")("opacity-50", !ctx_r0.membershipService.hasFeature("dataInsightsBasic"));
    \u0275\u0275property("title", !ctx_r0.membershipService.hasFeature("dataInsightsBasic") ? "\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1" : "");
    \u0275\u0275advance();
    \u0275\u0275classProp("bg-gradient-to-br", view_r12 === "analytics")("from-cyan-500", view_r12 === "analytics")("to-blue-500", view_r12 === "analytics")("bg-slate-700/50", view_r12 !== "analytics")("group-hover:bg-slate-700", view_r12 !== "analytics");
    \u0275\u0275advance(8);
    \u0275\u0275conditional(ctx_r0.membershipService.hasFeature("dataInsightsBasic") ? 32 : 33);
  }
}
function AppComponent_Conditional_15_Conditional_101_Conditional_24_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 195);
    \u0275\u0275text(1, "\u{1F48E}");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_101_Template(rf, ctx) {
  if (rf & 1) {
    const _r15 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 97)(1, "a", 83);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_101_Template_a_click_1_listener() {
      \u0275\u0275restoreView(_r15);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("analytics-center"));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(2, "svg", 84);
    \u0275\u0275element(3, "path", 188)(4, "path", 189)(5, "path", 190);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(6, "span");
    \u0275\u0275text(7, "\u5206\u6790\u4E2D\u5FC3");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(8, "a", 83);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_101_Template_a_click_8_listener() {
      \u0275\u0275restoreView(_r15);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("lead-nurturing"));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(9, "svg", 84);
    \u0275\u0275element(10, "path", 191)(11, "circle", 192);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(12, "span");
    \u0275\u0275text(13, "\u5BA2\u6236\u57F9\u80B2");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "span", 193);
    \u0275\u0275text(15, "AI");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(16, "a", 194);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_101_Template_a_click_16_listener() {
      \u0275\u0275restoreView(_r15);
      const ctx_r0 = \u0275\u0275nextContext(2);
      ctx_r0.changeView("multi-role");
      return \u0275\u0275resetView(ctx_r0.loadMultiRoleData());
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(17, "svg", 84);
    \u0275\u0275element(18, "path", 159)(19, "circle", 160)(20, "path", 161)(21, "path", 162);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(22, "span");
    \u0275\u0275text(23, "\u591A\u89D2\u8272\u5354\u4F5C");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(24, AppComponent_Conditional_15_Conditional_101_Conditional_24_Template, 2, 0, "span", 195);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    \u0275\u0275nextContext();
    const view_r12 = \u0275\u0275readContextLet(50);
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275styleProp("background-color", view_r12 === "analytics-center" || view_r12 === "nurturing-analytics" ? "rgba(6, 182, 212, 0.15)" : "transparent")("color", view_r12 === "analytics-center" || view_r12 === "nurturing-analytics" ? "#22d3ee" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "analytics-center" || view_r12 === "nurturing-analytics");
    \u0275\u0275advance(7);
    \u0275\u0275styleProp("background-color", view_r12 === "lead-nurturing" ? "rgba(236, 72, 153, 0.15)" : "transparent")("color", view_r12 === "lead-nurturing" ? "#f472b6" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "lead-nurturing");
    \u0275\u0275advance(8);
    \u0275\u0275styleProp("background-color", view_r12 === "multi-role" ? "rgba(99, 102, 241, 0.15)" : "transparent")("color", view_r12 === "multi-role" ? "#a5b4fc" : !ctx_r0.membershipService.hasFeature("multiRole") ? "var(--sidebar-text-muted)" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "multi-role")("opacity-50", !ctx_r0.membershipService.hasFeature("multiRole"))("cursor-not-allowed", !ctx_r0.membershipService.hasFeature("multiRole"));
    \u0275\u0275property("title", !ctx_r0.membershipService.hasFeature("multiRole") ? "\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1" : "");
    \u0275\u0275advance(8);
    \u0275\u0275conditional(!ctx_r0.membershipService.hasFeature("multiRole") ? 24 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_108_Conditional_9_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 203);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(ctx_r0.ragBrainService.gapsCount());
  }
}
function AppComponent_Conditional_15_Conditional_108_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    const _r17 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 199)(1, "a", 201);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_108_Conditional_9_Template_a_click_1_listener() {
      \u0275\u0275restoreView(_r17);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.changeView("knowledge-brain"));
    });
    \u0275\u0275elementStart(2, "span");
    \u0275\u0275text(3, "\u{1F4CA}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span");
    \u0275\u0275text(5, "\u7E3D\u89BD");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "a", 201);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_108_Conditional_9_Template_a_click_6_listener() {
      \u0275\u0275restoreView(_r17);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.changeView("knowledge-manage"));
    });
    \u0275\u0275elementStart(7, "span");
    \u0275\u0275text(8, "\u{1F4DD}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "span");
    \u0275\u0275text(10, "\u77E5\u8B58\u7BA1\u7406");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(11, "a", 202);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_108_Conditional_9_Template_a_click_11_listener() {
      \u0275\u0275restoreView(_r17);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.changeView("knowledge-gaps"));
    });
    \u0275\u0275elementStart(12, "span");
    \u0275\u0275text(13, "\u2753");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "span");
    \u0275\u0275text(15, "\u77E5\u8B58\u7F3A\u53E3");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(16, AppComponent_Conditional_15_Conditional_108_Conditional_9_Conditional_16_Template, 2, 1, "span", 203);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    \u0275\u0275nextContext(2);
    const view_r12 = \u0275\u0275readContextLet(50);
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275styleProp("background-color", view_r12 === "knowledge-brain" ? "rgba(236, 72, 153, 0.1)" : "transparent")("color", view_r12 === "knowledge-brain" ? "#f472b6" : "var(--sidebar-text-muted)");
    \u0275\u0275classProp("active", view_r12 === "knowledge-brain");
    \u0275\u0275advance(5);
    \u0275\u0275styleProp("background-color", view_r12 === "knowledge-manage" ? "rgba(236, 72, 153, 0.1)" : "transparent")("color", view_r12 === "knowledge-manage" ? "#f472b6" : "var(--sidebar-text-muted)");
    \u0275\u0275classProp("active", view_r12 === "knowledge-manage");
    \u0275\u0275advance(5);
    \u0275\u0275styleProp("background-color", view_r12 === "knowledge-gaps" ? "rgba(236, 72, 153, 0.1)" : "transparent")("color", view_r12 === "knowledge-gaps" ? "#f472b6" : "var(--sidebar-text-muted)");
    \u0275\u0275classProp("active", view_r12 === "knowledge-gaps");
    \u0275\u0275advance(5);
    \u0275\u0275conditional(ctx_r0.ragBrainService.gapsCount() > 0 ? 16 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_108_Template(rf, ctx) {
  if (rf & 1) {
    const _r16 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 97)(1, "div", 196)(2, "a", 83);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_108_Template_a_click_2_listener() {
      \u0275\u0275restoreView(_r16);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.toggleKnowledgeMenu());
    });
    \u0275\u0275elementStart(3, "span", 175);
    \u0275\u0275text(4, "\u{1F9E0}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "span", 197);
    \u0275\u0275text(6, "\u77E5\u8B58\u5927\u8166");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "span", 198);
    \u0275\u0275text(8, "\u25BC");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(9, AppComponent_Conditional_15_Conditional_108_Conditional_9_Template, 17, 19, "div", 199);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "a", 83);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_108_Template_a_click_10_listener() {
      \u0275\u0275restoreView(_r16);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("ai-center"));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(11, "svg", 84);
    \u0275\u0275element(12, "path", 200);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(13, "span");
    \u0275\u0275text(14);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    \u0275\u0275nextContext();
    const view_r12 = \u0275\u0275readContextLet(50);
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("background-color", ctx_r0.isKnowledgeView() ? "rgba(236, 72, 153, 0.15)" : "transparent")("color", ctx_r0.isKnowledgeView() ? "#f472b6" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", ctx_r0.isKnowledgeView());
    \u0275\u0275advance(5);
    \u0275\u0275classProp("rotate-180", ctx_r0.knowledgeMenuExpanded());
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.knowledgeMenuExpanded() ? 9 : -1);
    \u0275\u0275advance();
    \u0275\u0275styleProp("background-color", view_r12 === "ai-center" ? "rgba(168, 85, 247, 0.15)" : "transparent")("color", view_r12 === "ai-center" ? "#c084fc" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "ai-center");
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r0.t("aiCenter"));
  }
}
function AppComponent_Conditional_15_Conditional_115_Template(rf, ctx) {
  if (rf & 1) {
    const _r18 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 97)(1, "a", 83);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_115_Template_a_click_1_listener() {
      \u0275\u0275restoreView(_r18);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("settings"));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(2, "svg", 84);
    \u0275\u0275element(3, "circle", 204)(4, "path", 205);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(5, "span");
    \u0275\u0275text(6);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    \u0275\u0275nextContext();
    const view_r12 = \u0275\u0275readContextLet(50);
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275styleProp("background-color", view_r12 === "settings" ? "var(--sidebar-item-active)" : "transparent")("color", view_r12 === "settings" ? "var(--sidebar-text-active)" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r12 === "settings");
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(ctx_r0.t("settings"));
  }
}
function AppComponent_Conditional_15_Case_137_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-dashboard-view");
  }
}
function AppComponent_Conditional_15_Case_138_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-accounts-view");
  }
}
function AppComponent_Conditional_15_Case_139_Template(rf, ctx) {
  if (rf & 1) {
    const _r19 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "app-add-account-page", 206);
    \u0275\u0275listener("accountAdded", function AppComponent_Conditional_15_Case_139_Template_app_add_account_page_accountAdded_0_listener($event) {
      \u0275\u0275restoreView(_r19);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.onAccountAdded($event));
    })("back", function AppComponent_Conditional_15_Case_139_Template_app_add_account_page_back_0_listener() {
      \u0275\u0275restoreView(_r19);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.changeView("accounts"));
    });
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Case_140_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-api-credentials-view");
  }
}
function AppComponent_Conditional_15_Case_141_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-settings-view");
  }
}
function AppComponent_Conditional_15_Case_142_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-leads-view");
  }
}
function AppComponent_Conditional_15_Case_143_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-automation-view");
  }
}
function AppComponent_Conditional_15_Case_144_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-resource-discovery-view");
  }
}
function AppComponent_Conditional_15_Case_145_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-resource-discovery-view");
  }
}
function AppComponent_Conditional_15_Case_146_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-ai-center-view");
  }
}
function AppComponent_Conditional_15_Case_147_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 111);
    \u0275\u0275element(1, "app-ai-brain");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Case_148_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 112);
    \u0275\u0275element(1, "app-knowledge-gaps");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Case_149_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 112);
    \u0275\u0275element(1, "app-knowledge-manage");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Case_150_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-multi-role-view");
  }
}
function AppComponent_Conditional_15_Case_151_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-analytics-view");
  }
}
function AppComponent_Conditional_15_Case_152_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-monitoring-view");
  }
}
function AppComponent_Conditional_15_Case_153_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-monitoring-view");
  }
}
function AppComponent_Conditional_15_Case_154_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-monitoring-view");
  }
}
function AppComponent_Conditional_15_Case_155_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-monitoring-view");
  }
}
function AppComponent_Conditional_15_Case_156_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-monitoring-view");
  }
}
function AppComponent_Conditional_15_Case_157_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-monitoring-view");
  }
}
function AppComponent_Conditional_15_Case_158_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-monitoring-view");
  }
}
function AppComponent_Conditional_15_Case_159_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-runtime-logs-view");
  }
}
function AppComponent_Conditional_15_Case_160_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-membership-center");
  }
}
function AppComponent_Conditional_15_Case_161_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-wallet-view");
  }
}
function AppComponent_Conditional_15_Case_162_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-profile");
  }
}
function AppComponent_Conditional_15_Case_163_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-resource-center");
  }
}
function AppComponent_Conditional_15_Case_164_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-search-discovery");
  }
}
function AppComponent_Conditional_15_Case_165_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-ai-marketing-assistant");
  }
}
function AppComponent_Conditional_15_Case_166_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-ai-team-hub");
  }
}
function AppComponent_Conditional_15_Case_167_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-member-database");
  }
}
function AppComponent_Conditional_15_Case_168_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-leads-view");
  }
}
function AppComponent_Conditional_15_Case_169_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-analytics-view");
  }
}
function AppComponent_Conditional_15_Case_170_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-analytics-view");
  }
}
function AppComponent_Conditional_15_Case_171_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-automation-view");
  }
}
function AppComponent_Conditional_15_Case_172_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-automation-view");
  }
}
function AppComponent_Conditional_15_Case_173_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-analytics-view");
  }
}
function AppComponent_Conditional_15_Case_174_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-marketing-report");
  }
}
function AppComponent_Conditional_15_Case_175_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-runtime-logs-view");
  }
}
function AppComponent_Conditional_15_Case_176_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-runtime-logs-view");
  }
}
function AppComponent_Conditional_15_Case_177_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-runtime-logs-view");
  }
}
function AppComponent_Conditional_15_Case_178_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275element(0, "app-dashboard-view");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const lead_r21 = \u0275\u0275nextContext();
    \u0275\u0275textInterpolate1(" @", lead_r21.username, " ");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const lead_r21 = \u0275\u0275nextContext();
    \u0275\u0275textInterpolate2(" ", lead_r21.firstName, " ", lead_r21.lastName || "", " ");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
    \u0275\u0275pipe(1, "slice");
  }
  if (rf & 2) {
    const lead_r21 = \u0275\u0275nextContext();
    \u0275\u0275textInterpolate1(" ID: ", \u0275\u0275pipeBind3(1, 1, lead_r21.userId, 0, 12), " ");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 216);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const lead_r21 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("\u{1F4F1} ", lead_r21.phone);
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 218);
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "slice");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const lead_r21 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("\u{1F4CD} ", \u0275\u0275pipeBind3(2, 1, lead_r21.sourceGroup, 0, 20));
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_17_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 219);
    \u0275\u0275text(1);
    \u0275\u0275pipe(2, "slice");
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const lead_r21 = \u0275\u0275nextContext();
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("\u{1F511} ", \u0275\u0275pipeBind3(2, 1, lead_r21.triggeredKeyword, 0, 15));
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_18_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 228);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const lead_r21 = \u0275\u0275nextContext();
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275classMap(ctx_r0.getIntentLevelColor(lead_r21.intentLevel));
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2("", ctx_r0.getIntentLevelEmoji(lead_r21.intentLevel), " ", ctx_r0.t(lead_r21.intentLevel));
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "option", 232);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(ctx_r0.t("noSenderAccounts"));
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_6_For_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "option", 253);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const account_r23 = ctx.$implicit;
    const ctx_r0 = \u0275\u0275nextContext(5);
    \u0275\u0275property("value", account_r23.id);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2("", account_r23.phone, " (", account_r23.username || ctx_r0.t(account_r23.status), ")");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "option", 232);
    \u0275\u0275text(1, "\u9078\u64C7\u767C\u9001\u5E33\u865F...");
    \u0275\u0275elementEnd();
    \u0275\u0275repeaterCreate(2, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_6_For_3_Template, 2, 3, "option", 253, _forTrack024);
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(2);
    \u0275\u0275repeater(ctx_r0.senderAccounts());
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    const _r24 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 233)(1, "p", 20);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "a", 254);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_7_Template_a_click_3_listener() {
      \u0275\u0275restoreView(_r24);
      const ctx_r0 = \u0275\u0275nextContext(4);
      ctx_r0.currentView.set("accounts");
      return \u0275\u0275resetView(ctx_r0.closeLeadDetailModal());
    });
    \u0275\u0275text(4, "\u524D\u5F80\u5E33\u865F\u7BA1\u7406 \u2192");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u26A0\uFE0F ", ctx_r0.t("noSenderAccountsHint"));
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 256);
    \u0275\u0275text(1, "\u2713 \u5DF2\u9023\u63A5");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 257);
    \u0275\u0275text(1, "\u{1F4DA} RAG \u5DF2\u555F\u7528");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_9_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(6);
    \u0275\u0275textInterpolate1(" | \u4F86\u6E90: ", ctx_r0.generationState().lead.sourceGroup, " ");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_9_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0);
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(6);
    \u0275\u0275textInterpolate1(" | \u89F8\u767C\u8A5E: ", ctx_r0.generationState().lead.triggerKeyword, " ");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_9_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 258)(1, "strong", 267);
    \u0275\u0275text(2, "\u5BA2\u6236\u8CC7\u8A0A\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275text(3);
    \u0275\u0275conditionalCreate(4, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_9_Conditional_4_Template, 1, 1);
    \u0275\u0275conditionalCreate(5, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_9_Conditional_5_Template, 1, 1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(5);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" @", ctx_r0.generationState().lead.username, " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.generationState().lead.sourceGroup ? 4 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.generationState().lead.triggerKeyword ? 5 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_17_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 268);
    \u0275\u0275text(1, "\u27F3");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "span");
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(5);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r0.t("generating"));
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_18_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span");
    \u0275\u0275text(1, "\u2728");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "span");
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(5);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r0.t("generateWithAi"));
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_19_Template(rf, ctx) {
  if (rf & 1) {
    const _r26 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 269);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_19_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r26);
      const ctx_r0 = \u0275\u0275nextContext(5);
      return \u0275\u0275resetView(ctx_r0.generateMessage());
    });
    \u0275\u0275text(1, " \u{1F504} ");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_20_Template(rf, ctx) {
  if (rf & 1) {
    const _r27 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 264);
    \u0275\u0275text(1);
    \u0275\u0275elementStart(2, "a", 270);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_20_Template_a_click_2_listener() {
      \u0275\u0275restoreView(_r27);
      const ctx_r0 = \u0275\u0275nextContext(5);
      ctx_r0.currentView.set("settings");
      return \u0275\u0275resetView(ctx_r0.closeLeadDetailModal());
    });
    \u0275\u0275text(3);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(5);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u26A0\uFE0F ", ctx_r0.t("aiNotConfigured"), " ");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r0.t("goToSettings"));
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_21_Template(rf, ctx) {
  if (rf & 1) {
    const _r28 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 265)(1, "strong");
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275text(3);
    \u0275\u0275elementStart(4, "button", 271);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_21_Template_button_click_4_listener() {
      \u0275\u0275restoreView(_r28);
      const ctx_r0 = \u0275\u0275nextContext(5);
      return \u0275\u0275resetView(ctx_r0.generateMessage());
    });
    \u0275\u0275text(5, "\u91CD\u8A66");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(5);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("", ctx_r0.t("error"), ":");
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r0.generationState().error, " ");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_22_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 266)(1, "p", 272);
    \u0275\u0275text(2, "\u2713 AI \u5DF2\u751F\u6210\u6D88\u606F\uFF0C\u60A8\u53EF\u4EE5\u5728\u4E0B\u65B9\u7DE8\u8F2F\u5F8C\u767C\u9001");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Template(rf, ctx) {
  if (rf & 1) {
    const _r25 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 238)(1, "div", 255)(2, "div", 213)(3, "span", 175);
    \u0275\u0275text(4, "\u{1F916}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "span", 32);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(7, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_7_Template, 2, 0, "span", 256);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(8, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_8_Template, 2, 0, "span", 257);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(9, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_9_Template, 6, 3, "div", 258);
    \u0275\u0275elementStart(10, "div")(11, "label", 259);
    \u0275\u0275text(12);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(13, "textarea", 260);
    \u0275\u0275listener("ngModelChange", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Template_textarea_ngModelChange_13_listener($event) {
      \u0275\u0275restoreView(_r25);
      const ctx_r0 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r0.updateCustomPrompt($event));
    });
    \u0275\u0275text(14, "                        ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(15, "div", 261)(16, "button", 262);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r25);
      const ctx_r0 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r0.generateMessage());
    });
    \u0275\u0275conditionalCreate(17, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_17_Template, 4, 1)(18, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_18_Template, 4, 1);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(19, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_19_Template, 2, 0, "button", 263);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(20, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_20_Template, 4, 2, "div", 264);
    \u0275\u0275conditionalCreate(21, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_21_Template, 6, 2, "div", 265);
    \u0275\u0275conditionalCreate(22, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Conditional_22_Template, 3, 0, "div", 266);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(6);
    \u0275\u0275textInterpolate1(" ", ctx_r0.aiApiType() === "local" ? "\u672C\u5730 AI" : ctx_r0.aiApiType() === "openai" ? "OpenAI" : ctx_r0.aiApiType() === "custom" ? "\u81EA\u5B9A\u7FA9 API" : "Gemini", " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.isAiConfigured() ? 7 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.ragEnabled() ? 8 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.generationState().lead ? 9 : -1);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r0.t("customizePrompt"));
    \u0275\u0275advance();
    \u0275\u0275property("ngModel", ctx_r0.generationState().customPrompt)("placeholder", ctx_r0.t("aiPromptPlaceholder"));
    \u0275\u0275advance(3);
    \u0275\u0275property("disabled", ctx_r0.generationState().status === "loading" || !ctx_r0.isAiConfigured());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.generationState().status === "loading" ? 17 : 18);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.generationState().status === "success" ? 19 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(!ctx_r0.isAiConfigured() ? 20 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.generationState().status === "error" ? 21 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.generationState().status === "success" && ctx_r0.generationState().generatedMessage ? 22 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_25_For_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "option", 253);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const template_r30 = ctx.$implicit;
    \u0275\u0275property("value", template_r30.id);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(template_r30.name);
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_25_Template(rf, ctx) {
  if (rf & 1) {
    const _r29 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 229)(1, "label", 230);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "select", 273);
    \u0275\u0275listener("change", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_25_Template_select_change_3_listener($event) {
      \u0275\u0275restoreView(_r29);
      const ctx_r0 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r0.applyTemplate($event));
    });
    \u0275\u0275elementStart(4, "option", 232);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275repeaterCreate(6, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_25_For_7_Template, 2, 2, "option", 253, _forTrack024);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u{1F4CB} ", ctx_r0.t("selectTemplate"));
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r0.t("selectTemplatePlaceholder"));
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r0.messageTemplates());
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_40_Template(rf, ctx) {
  if (rf & 1) {
    const _r31 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 274);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_40_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r31);
      const ctx_r0 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r0.addMoreAttachments("file"));
    });
    \u0275\u0275text(1, " \u2795 \u6DFB\u52A0\u66F4\u591A ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "button", 275);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_40_Template_button_click_2_listener() {
      \u0275\u0275restoreView(_r31);
      const ctx_r0 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r0.clearAllAttachments());
    });
    \u0275\u0275text(3, " \u{1F5D1}\uFE0F \u6E05\u7A7A ");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_41_For_8_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 280);
    \u0275\u0275text(1, "\u{1F5BC}\uFE0F");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_41_For_8_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 281);
    \u0275\u0275text(1, "\u{1F4C4}");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_41_For_8_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 283);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const attachment_r33 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" (", (attachment_r33.fileSize / 1024 / 1024).toFixed(2), " MB) ");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_41_For_8_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 284);
    \u0275\u0275text(1, "\u2713");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_41_For_8_Template(rf, ctx) {
  if (rf & 1) {
    const _r32 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 278)(1, "div", 279);
    \u0275\u0275conditionalCreate(2, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_41_For_8_Conditional_2_Template, 2, 0, "span", 280)(3, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_41_For_8_Conditional_3_Template, 2, 0, "span", 281);
    \u0275\u0275elementStart(4, "span", 282);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(6, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_41_For_8_Conditional_6_Template, 2, 1, "span", 283);
    \u0275\u0275conditionalCreate(7, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_41_For_8_Conditional_7_Template, 2, 0, "span", 284);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "button", 285);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_41_For_8_Template_button_click_8_listener() {
      const \u0275$index_1260_r34 = \u0275\u0275restoreView(_r32).$index;
      const ctx_r0 = \u0275\u0275nextContext(5);
      return \u0275\u0275resetView(ctx_r0.removeAttachmentByIndex(\u0275$index_1260_r34));
    });
    \u0275\u0275text(9, "\xD7");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const attachment_r33 = ctx.$implicit;
    \u0275\u0275advance(2);
    \u0275\u0275conditional(attachment_r33.type === "image" ? 2 : 3);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(attachment_r33.name);
    \u0275\u0275advance();
    \u0275\u0275conditional(attachment_r33.fileSize ? 6 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(attachment_r33.filePath ? 7 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_41_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 245)(1, "div", 239)(2, "span", 276);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "span", 149);
    \u0275\u0275text(5);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(6, "div", 277);
    \u0275\u0275repeaterCreate(7, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_41_For_8_Template, 10, 4, "div", 278, _forTrack19);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("\u{1F4CE} \u9644\u4EF6\u5217\u8868 (", ctx_r0.generationState().attachments.length, ")");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" \u7E3D\u5927\u5C0F: ", ctx_r0.getTotalAttachmentSize(), " MB ");
    \u0275\u0275advance(2);
    \u0275\u0275repeater(ctx_r0.generationState().attachments);
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_42_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u26A0\uFE0F \u7121\u53EF\u7528\u767C\u9001\u5E33\u865F ");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_42_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u26A0\uFE0F \u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F ");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_42_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275text(0, " \u26A0\uFE0F \u8ACB\u8F38\u5165\u8A0A\u606F\u5167\u5BB9\u6216\u6DFB\u52A0\u9644\u4EF6 ");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_42_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 246)(1, "p", 286);
    \u0275\u0275conditionalCreate(2, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_42_Conditional_2_Template, 1, 0)(3, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_42_Conditional_3_Template, 1, 0)(4, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_42_Conditional_4_Template, 1, 0);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.senderAccounts().length === 0 ? 2 : !ctx_r0.selectedSenderId() ? 3 : ctx_r0.editableMessage().trim().length === 0 && !ctx_r0.generationState().attachment && ctx_r0.generationState().attachments.length === 0 ? 4 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_43_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 247)(1, "p", 287);
    \u0275\u0275text(2, "\u{1F6AB} \u6B64\u5BA2\u6236\u5DF2\u52A0\u5165\u9ED1\u540D\u55AE\uFF0C\u7121\u6CD5\u767C\u9001\u8A0A\u606F");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_28_Template(rf, ctx) {
  if (rf & 1) {
    const _r22 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 226)(1, "div", 229)(2, "label", 230);
    \u0275\u0275text(3);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "select", 231);
    \u0275\u0275listener("ngModelChange", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Template_select_ngModelChange_4_listener($event) {
      \u0275\u0275restoreView(_r22);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.selectedSenderId.set($event));
    });
    \u0275\u0275conditionalCreate(5, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_5_Template, 2, 1, "option", 232)(6, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_6_Template, 4, 0);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(7, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_7_Template, 5, 1, "div", 233);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div", 234)(9, "label", 235);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Template_label_click_9_listener() {
      \u0275\u0275restoreView(_r22);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.messageMode.set("manual"));
    });
    \u0275\u0275elementStart(10, "div", 236);
    \u0275\u0275text(11, "\u{1F4DD}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "span", 237);
    \u0275\u0275text(13);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(14, "label", 235);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Template_label_click_14_listener() {
      \u0275\u0275restoreView(_r22);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.messageMode.set("ai"));
    });
    \u0275\u0275elementStart(15, "div", 236);
    \u0275\u0275text(16, "\u{1F916}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(17, "span", 237);
    \u0275\u0275text(18);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(19, "label", 235);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Template_label_click_19_listener() {
      \u0275\u0275restoreView(_r22);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.messageMode.set("template"));
    });
    \u0275\u0275elementStart(20, "div", 236);
    \u0275\u0275text(21, "\u{1F4CB}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(22, "span", 237);
    \u0275\u0275text(23);
    \u0275\u0275elementEnd()()();
    \u0275\u0275conditionalCreate(24, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_24_Template, 23, 13, "div", 238);
    \u0275\u0275conditionalCreate(25, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_25_Template, 8, 2, "div", 229);
    \u0275\u0275elementStart(26, "div", 229)(27, "div", 239)(28, "label", 240);
    \u0275\u0275text(29);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(30, "span", 241);
    \u0275\u0275text(31);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(32, "textarea", 242);
    \u0275\u0275listener("ngModelChange", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Template_textarea_ngModelChange_32_listener($event) {
      \u0275\u0275restoreView(_r22);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.editableMessage.set($event));
    });
    \u0275\u0275text(33, "                ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(34, "div", 238)(35, "div", 243)(36, "button", 244);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Template_button_click_36_listener() {
      \u0275\u0275restoreView(_r22);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.selectAttachment("image", true));
    });
    \u0275\u0275text(37);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(38, "button", 244);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Template_button_click_38_listener() {
      \u0275\u0275restoreView(_r22);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.selectAttachment("file", true));
    });
    \u0275\u0275text(39);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(40, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_40_Template, 4, 0);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(41, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_41_Template, 9, 2, "div", 245);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(42, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_42_Template, 5, 1, "div", 246);
    \u0275\u0275conditionalCreate(43, AppComponent_Conditional_15_Conditional_179_Conditional_28_Conditional_43_Template, 3, 0, "div", 247);
    \u0275\u0275elementStart(44, "div", 248)(45, "button", 249);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Template_button_click_45_listener() {
      \u0275\u0275restoreView(_r22);
      const lead_r21 = \u0275\u0275nextContext();
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.addToDoNotContact(lead_r21.id));
    });
    \u0275\u0275text(46);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(47, "div", 250)(48, "button", 251);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Template_button_click_48_listener() {
      \u0275\u0275restoreView(_r22);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.closeLeadDetailModal());
    });
    \u0275\u0275text(49);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(50, "button", 252);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_28_Template_button_click_50_listener() {
      \u0275\u0275restoreView(_r22);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.sendMessageToLead());
    });
    \u0275\u0275text(51);
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const lead_r21 = \u0275\u0275nextContext();
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1("\u{1F4E4} ", ctx_r0.t("selectSenderAccount"));
    \u0275\u0275advance();
    \u0275\u0275property("ngModel", ctx_r0.selectedSenderId());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.senderAccounts().length === 0 ? 5 : 6);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.senderAccounts().length === 0 ? 7 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275classMap(ctx_r0.messageMode() === "manual" ? "bg-cyan-500/20 border-cyan-500 text-cyan-400" : "bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30");
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r0.t("manualInput"));
    \u0275\u0275advance();
    \u0275\u0275classMap(ctx_r0.messageMode() === "ai" ? "bg-gradient-to-br from-cyan-500/20 to-purple-500/20 border-cyan-500 text-cyan-400" : "bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30");
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r0.t("aiGenerate"));
    \u0275\u0275advance();
    \u0275\u0275classMap(ctx_r0.messageMode() === "template" ? "bg-cyan-500/20 border-cyan-500 text-cyan-400" : "bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30");
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r0.t("useTemplate"));
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.messageMode() === "ai" ? 24 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.messageMode() === "template" ? 25 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate1("\u270F\uFE0F ", ctx_r0.t("messageContent"));
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2("", ctx_r0.editableMessage().length, " ", ctx_r0.t("characters"));
    \u0275\u0275advance();
    \u0275\u0275property("ngModel", ctx_r0.editableMessage())("placeholder", ctx_r0.t("messageContentPlaceholder"));
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate1(" \u{1F5BC}\uFE0F ", ctx_r0.t("attachImage"), " ");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" \u{1F4CE} ", ctx_r0.t("attachFile"), " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.generationState().attachments.length > 0 ? 40 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.generationState().attachments.length > 0 ? 41 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(!ctx_r0.canSendMessage() && !lead_r21.doNotContact ? 42 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(lead_r21.doNotContact ? 43 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275property("disabled", lead_r21.doNotContact);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u{1F6AB} ", lead_r21.doNotContact ? ctx_r0.t("userOnDNC") : ctx_r0.t("addToDNC"), " ");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", ctx_r0.t("cancel"), " ");
    \u0275\u0275advance();
    \u0275\u0275property("disabled", !ctx_r0.canSendMessage() || lead_r21.doNotContact);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u2708\uFE0F ", ctx_r0.t("sendMessage"), " ");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 268);
    \u0275\u0275text(1, "\u27F3");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "span");
    \u0275\u0275text(3, "\u52A0\u8F09\u4E2D...");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span");
    \u0275\u0275text(1, "\u{1F4AC}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "span");
    \u0275\u0275text(3, "\u52A0\u8F09\u5B8C\u6574\u804A\u5929\u8A18\u9304");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 149);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("\u5171 ", ctx_r0.chatHistory().length, " \u689D\u6D88\u606F");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_For_2_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 298)(1, "div", 300)(2, "div", 301)(3, "p", 302);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(5, "p", 15);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const message_r37 = \u0275\u0275nextContext().$implicit;
    const ctx_r0 = \u0275\u0275nextContext(5);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(message_r37.content);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r0.formatTimestamp(message_r37.timestamp));
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_For_2_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 299)(1, "div", 300)(2, "div", 303)(3, "p", 302);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(5, "div", 304)(6, "span", 149);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "span", 305);
    \u0275\u0275text(9, "\u{1F916} AI");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const message_r37 = \u0275\u0275nextContext().$implicit;
    const ctx_r0 = \u0275\u0275nextContext(5);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(message_r37.content);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r0.formatTimestamp(message_r37.timestamp));
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_For_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275conditionalCreate(0, AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_For_2_Conditional_0_Template, 7, 2, "div", 298)(1, AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_For_2_Conditional_1_Template, 10, 2, "div", 299);
  }
  if (rf & 2) {
    const message_r37 = ctx.$implicit;
    \u0275\u0275conditional(message_r37.role === "user" ? 0 : message_r37.role === "assistant" ? 1 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 296)(1, "span", 306);
    \u0275\u0275text(2, "\u27F3");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 307);
    \u0275\u0275text(4, "\u52A0\u8F09\u4E2D...");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    const _r38 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 297)(1, "button", 308);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_Conditional_4_Template_button_click_1_listener() {
      \u0275\u0275restoreView(_r38);
      const ctx_r0 = \u0275\u0275nextContext(5);
      return \u0275\u0275resetView(ctx_r0.loadMoreChatHistory());
    });
    \u0275\u0275text(2, " \u52A0\u8F09\u66F4\u591A\u6D88\u606F ");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    const _r36 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 295);
    \u0275\u0275listener("scroll", function AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_Template_div_scroll_0_listener($event) {
      \u0275\u0275restoreView(_r36);
      const ctx_r0 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r0.onChatHistoryScroll($event));
    });
    \u0275\u0275repeaterCreate(1, AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_For_2_Template, 2, 1, null, null, \u0275\u0275componentInstance().trackByChatMessageId, true);
    \u0275\u0275conditionalCreate(3, AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_Conditional_3_Template, 5, 0, "div", 296);
    \u0275\u0275conditionalCreate(4, AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_Conditional_4_Template, 3, 0, "div", 297);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r0.chatHistory());
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.chatHistoryLoadingMore() ? 3 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.chatHistoryHasMore() && !ctx_r0.chatHistoryLoadingMore() ? 4 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_For_10_Conditional_0_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 305);
    \u0275\u0275text(1, "\u{1F916} AI");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_For_10_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 299)(1, "div", 300)(2, "div", 303)(3, "p", 302);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(5, "div", 304)(6, "span", 149);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(8, AppComponent_Conditional_15_Conditional_179_Conditional_29_For_10_Conditional_0_Conditional_8_Template, 2, 0, "span", 305);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const item_r39 = \u0275\u0275nextContext().$implicit;
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(item_r39.content);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate(ctx_r0.formatTimestamp(item_r39.timestamp));
    \u0275\u0275advance();
    \u0275\u0275conditional(item_r39.type.includes("AI") ? 8 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_For_10_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 298)(1, "div", 300)(2, "div", 301)(3, "p", 302);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(5, "p", 15);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const item_r39 = \u0275\u0275nextContext().$implicit;
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(item_r39.content);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate(ctx_r0.formatTimestamp(item_r39.timestamp));
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_For_10_Conditional_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 309)(1, "div", 310);
    \u0275\u0275text(2);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const item_r39 = \u0275\u0275nextContext().$implicit;
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate3(" ", item_r39.type, ": ", item_r39.content, " \xB7 ", ctx_r0.formatTimestamp(item_r39.timestamp), " ");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_For_10_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275conditionalCreate(0, AppComponent_Conditional_15_Conditional_179_Conditional_29_For_10_Conditional_0_Template, 9, 3, "div", 299)(1, AppComponent_Conditional_15_Conditional_179_Conditional_29_For_10_Conditional_1_Template, 7, 2, "div", 298)(2, AppComponent_Conditional_15_Conditional_179_Conditional_29_For_10_Conditional_2_Template, 3, 3, "div", 309);
  }
  if (rf & 2) {
    const item_r39 = ctx.$implicit;
    \u0275\u0275conditional(item_r39.type.includes("Sent") || item_r39.type.includes("Message") ? 0 : item_r39.type.includes("Reply") || item_r39.type.includes("Received") ? 1 : 2);
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_11_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 293)(1, "div", 311);
    \u0275\u0275text(2, "\u{1F4AC}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "p", 312);
    \u0275\u0275text(4);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 313);
    \u0275\u0275text(6, "\u9EDE\u64CA\u300C\u52A0\u8F09\u5B8C\u6574\u804A\u5929\u8A18\u9304\u300D\u67E5\u770B\u6240\u6709\u5C0D\u8A71");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r0.t("noHistoryFound"));
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 294)(1, "h4", 314)(2, "span");
    \u0275\u0275text(3, "\u{1F4CA}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(4, " AI \u5C0D\u8A71\u5206\u6790 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "div", 315)(6, "div", 316)(7, "p", 317);
    \u0275\u0275text(8, "\u7E3D\u4E92\u52D5");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "p", 126);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(11, "div", 316)(12, "p", 317);
    \u0275\u0275text(13, "\u5C0D\u8A71\u968E\u6BB5");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "p", 318);
    \u0275\u0275text(15);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(16, "div", 316)(17, "p", 317);
    \u0275\u0275text(18, "\u8208\u8DA3\u7A0B\u5EA6");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(19, "p", 175);
    \u0275\u0275text(20, "\u2B50\u2B50\u2B50");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const lead_r21 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(10);
    \u0275\u0275textInterpolate(lead_r21.interactionHistory.length);
    \u0275\u0275advance(5);
    \u0275\u0275textInterpolate(lead_r21.status || "\u521D\u6B21\u63A5\u89F8");
  }
}
function AppComponent_Conditional_15_Conditional_179_Conditional_29_Template(rf, ctx) {
  if (rf & 1) {
    const _r35 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 227)(1, "div", 288)(2, "button", 289);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Conditional_29_Template_button_click_2_listener() {
      \u0275\u0275restoreView(_r35);
      const lead_r21 = \u0275\u0275nextContext();
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.loadChatHistory(lead_r21.userId));
    });
    \u0275\u0275conditionalCreate(3, AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_3_Template, 4, 0)(4, AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_4_Template, 4, 0);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(5, AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_5_Template, 2, 1, "span", 149);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(6, AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_6_Template, 5, 2, "div", 290);
    \u0275\u0275elementStart(7, "div", 291)(8, "div", 292);
    \u0275\u0275repeaterCreate(9, AppComponent_Conditional_15_Conditional_179_Conditional_29_For_10_Template, 3, 1, null, null, \u0275\u0275componentInstance().trackByChatMessageId, true);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(11, AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_11_Template, 7, 1, "div", 293);
    \u0275\u0275conditionalCreate(12, AppComponent_Conditional_15_Conditional_179_Conditional_29_Conditional_12_Template, 21, 2, "div", 294);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const lead_r21 = \u0275\u0275nextContext();
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(2);
    \u0275\u0275property("disabled", ctx_r0.isLoadingChatHistory());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.isLoadingChatHistory() ? 3 : 4);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.selectedChatUserId() === lead_r21.userId && ctx_r0.chatHistory().length > 0 ? 5 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.selectedChatUserId() === lead_r21.userId && ctx_r0.chatHistory().length > 0 ? 6 : -1);
    \u0275\u0275advance(3);
    \u0275\u0275repeater(lead_r21.interactionHistory);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(lead_r21.interactionHistory.length === 0 && (!ctx_r0.selectedChatUserId() || ctx_r0.chatHistory().length === 0) ? 11 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(lead_r21.interactionHistory.length > 0 ? 12 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_179_Template(rf, ctx) {
  if (rf & 1) {
    const _r20 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 207);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r20);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.closeLeadDetailModal());
    });
    \u0275\u0275elementStart(1, "div", 208);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Template_div_click_1_listener($event) {
      \u0275\u0275restoreView(_r20);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275elementStart(2, "div", 209)(3, "div", 210)(4, "div", 211)(5, "div", 212);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div")(8, "div", 213)(9, "h3", 214);
    \u0275\u0275conditionalCreate(10, AppComponent_Conditional_15_Conditional_179_Conditional_10_Template, 1, 1)(11, AppComponent_Conditional_15_Conditional_179_Conditional_11_Template, 1, 2)(12, AppComponent_Conditional_15_Conditional_179_Conditional_12_Template, 2, 5);
    \u0275\u0275elementEnd();
    \u0275\u0275element(13, "span", 215);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(14, AppComponent_Conditional_15_Conditional_179_Conditional_14_Template, 2, 1, "p", 216);
    \u0275\u0275elementStart(15, "div", 217);
    \u0275\u0275conditionalCreate(16, AppComponent_Conditional_15_Conditional_179_Conditional_16_Template, 3, 5, "span", 218);
    \u0275\u0275conditionalCreate(17, AppComponent_Conditional_15_Conditional_179_Conditional_17_Template, 3, 5, "span", 219);
    \u0275\u0275conditionalCreate(18, AppComponent_Conditional_15_Conditional_179_Conditional_18_Template, 2, 4, "span", 220);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(19, "button", 221);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Template_button_click_19_listener() {
      \u0275\u0275restoreView(_r20);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.closeLeadDetailModal());
    });
    \u0275\u0275text(20, "\u2715");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(21, "div", 222)(22, "nav", 223)(23, "a", 224);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Template_a_click_23_listener() {
      \u0275\u0275restoreView(_r20);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.leadDetailView.set("sendMessage"));
    });
    \u0275\u0275text(24);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(25, "a", 224);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_179_Template_a_click_25_listener() {
      \u0275\u0275restoreView(_r20);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.leadDetailView.set("history"));
    });
    \u0275\u0275text(26);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(27, "div", 225);
    \u0275\u0275conditionalCreate(28, AppComponent_Conditional_15_Conditional_179_Conditional_28_Template, 52, 31, "div", 226);
    \u0275\u0275conditionalCreate(29, AppComponent_Conditional_15_Conditional_179_Conditional_29_Template, 13, 6, "div", 227);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const lead_r21 = ctx;
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(6);
    \u0275\u0275textInterpolate1(" ", (lead_r21.username || lead_r21.firstName || lead_r21.userId || "?")[0].toUpperCase(), " ");
    \u0275\u0275advance(4);
    \u0275\u0275conditional(lead_r21.username ? 10 : lead_r21.firstName ? 11 : 12);
    \u0275\u0275advance(3);
    \u0275\u0275classMap(ctx_r0.getOnlineStatusColor(lead_r21.onlineStatus));
    \u0275\u0275advance();
    \u0275\u0275conditional(lead_r21.phone ? 14 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275conditional(lead_r21.sourceGroup ? 16 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(lead_r21.triggeredKeyword && lead_r21.triggeredKeyword !== "\u7121" ? 17 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(lead_r21.intentLevel ? 18 : -1);
    \u0275\u0275advance(5);
    \u0275\u0275classProp("border-cyan-400", ctx_r0.leadDetailView() === "sendMessage")("text-cyan-400", ctx_r0.leadDetailView() === "sendMessage")("bg-cyan-500/10", ctx_r0.leadDetailView() === "sendMessage");
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u{1F4AC} ", ctx_r0.t("sendMessageTab"), " ");
    \u0275\u0275advance();
    \u0275\u0275classProp("border-cyan-400", ctx_r0.leadDetailView() === "history")("text-cyan-400", ctx_r0.leadDetailView() === "history")("bg-cyan-500/10", ctx_r0.leadDetailView() === "history");
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" \u{1F4CB} ", ctx_r0.t("historyTab"), " ");
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.leadDetailView() === "sendMessage" ? 28 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.leadDetailView() === "history" ? 29 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_180_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 332);
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(1, "svg", 335);
    \u0275\u0275element(2, "circle", 336)(3, "path", 337);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(4, "p");
    \u0275\u0275text(5, "\u66AB\u7121\u64CD\u4F5C\u6B77\u53F2");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Conditional_180_Conditional_15_For_2_Conditional_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 342);
    \u0275\u0275text(1, "\uFF08\u5DF2\u64A4\u92B7\uFF09");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_180_Conditional_15_For_2_Conditional_19_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 343);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const op_r41 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("", op_r41.failureCount, " \u5931\u6557");
  }
}
function AppComponent_Conditional_15_Conditional_180_Conditional_15_For_2_Conditional_20_Template(rf, ctx) {
  if (rf & 1) {
    const _r42 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 345);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_180_Conditional_15_For_2_Conditional_20_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r42);
      const op_r41 = \u0275\u0275nextContext().$implicit;
      const ctx_r0 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r0.undoBatchOperation(op_r41.id));
    });
    \u0275\u0275text(1, " \u64A4\u92B7 ");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_180_Conditional_15_For_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 339)(1, "div", 147)(2, "div", 64)(3, "div", 340);
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(4, "svg", 133);
    \u0275\u0275element(5, "rect", 88)(6, "rect", 89)(7, "rect", 90)(8, "rect", 91);
    \u0275\u0275elementEnd()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(9, "div")(10, "p", 341);
    \u0275\u0275text(11);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "p", 149);
    \u0275\u0275text(13);
    \u0275\u0275conditionalCreate(14, AppComponent_Conditional_15_Conditional_180_Conditional_15_For_2_Conditional_14_Template, 2, 0, "span", 342);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(15, "div", 64)(16, "div", 302)(17, "span", 280);
    \u0275\u0275text(18);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(19, AppComponent_Conditional_15_Conditional_180_Conditional_15_For_2_Conditional_19_Template, 2, 1, "span", 343);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(20, AppComponent_Conditional_15_Conditional_180_Conditional_15_For_2_Conditional_20_Template, 2, 0, "button", 344);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const op_r41 = ctx.$implicit;
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275classProp("opacity-50", op_r41.reversed);
    \u0275\u0275advance(3);
    \u0275\u0275classProp("bg-cyan-500/20", op_r41.operationType === "update_status")("bg-blue-500/20", op_r41.operationType === "add_tag")("bg-red-500/20", op_r41.operationType === "delete" || op_r41.operationType === "add_to_dnc");
    \u0275\u0275advance();
    \u0275\u0275classProp("text-cyan-400", op_r41.operationType === "update_status")("text-blue-400", op_r41.operationType === "add_tag")("text-red-400", op_r41.operationType === "delete" || op_r41.operationType === "add_to_dnc");
    \u0275\u0275advance(7);
    \u0275\u0275textInterpolate(ctx_r0.getOperationTypeName(op_r41.operationType));
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate2(" ", op_r41.itemCount, " \u9805 \xB7 ", ctx_r0.formatBatchOperationDate(op_r41.createdAt), " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(op_r41.reversed ? 14 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate1("", op_r41.successCount, " \u6210\u529F");
    \u0275\u0275advance();
    \u0275\u0275conditional(op_r41.failureCount > 0 ? 19 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(op_r41.isReversible && !op_r41.reversed ? 20 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_180_Conditional_15_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 238);
    \u0275\u0275repeaterCreate(1, AppComponent_Conditional_15_Conditional_180_Conditional_15_For_2_Template, 21, 21, "div", 338, _forTrack024);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(3);
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r0.batchOperationHistory());
  }
}
function AppComponent_Conditional_15_Conditional_180_Template(rf, ctx) {
  if (rf & 1) {
    const _r40 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 319);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_180_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r40);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.showBatchOperationHistory.set(false));
    });
    \u0275\u0275elementStart(1, "div", 320);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_180_Template_div_click_1_listener($event) {
      \u0275\u0275restoreView(_r40);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275elementStart(2, "div", 321)(3, "h3", 322);
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(4, "svg", 323);
    \u0275\u0275element(5, "path", 324)(6, "path", 325)(7, "path", 326);
    \u0275\u0275elementEnd();
    \u0275\u0275text(8, " \u6279\u91CF\u64CD\u4F5C\u6B77\u53F2 ");
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(9, "button", 327);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_180_Template_button_click_9_listener() {
      \u0275\u0275restoreView(_r40);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.showBatchOperationHistory.set(false));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(10, "svg", 328);
    \u0275\u0275element(11, "line", 329)(12, "line", 330);
    \u0275\u0275elementEnd()()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(13, "div", 331);
    \u0275\u0275conditionalCreate(14, AppComponent_Conditional_15_Conditional_180_Conditional_14_Template, 6, 0, "div", 332)(15, AppComponent_Conditional_15_Conditional_180_Conditional_15_Template, 3, 0, "div", 238);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "div", 333)(17, "button", 334);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_180_Template_button_click_17_listener() {
      \u0275\u0275restoreView(_r40);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.showBatchOperationHistory.set(false));
    });
    \u0275\u0275text(18, " \u95DC\u9589 ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(14);
    \u0275\u0275conditional(ctx_r0.batchOperationHistory().length === 0 ? 14 : 15);
  }
}
function AppComponent_Conditional_15_Conditional_181_Case_12_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 353)(1, "div", 359)(2, "div", 360)(3, "div", 361);
    \u0275\u0275text(4, "\u{1F916}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "div", 362);
    \u0275\u0275text(6, "AI \u81EA\u52D5\u56DE\u8986");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "div", 14);
    \u0275\u0275text(8, "\u667A\u80FD\u5BA2\u670D\u52A9\u624B");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(9, "div", 360)(10, "div", 361);
    \u0275\u0275text(11, "\u{1F50D}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "div", 362);
    \u0275\u0275text(13, "\u8CC7\u6E90\u767C\u73FE");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "div", 14);
    \u0275\u0275text(15, "\u81EA\u52D5\u641C\u7D22\u7FA4\u7D44");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(16, "div", 360)(17, "div", 361);
    \u0275\u0275text(18, "\u{1F4CA}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(19, "div", 362);
    \u0275\u0275text(20, "\u6578\u64DA\u5206\u6790");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(21, "div", 14);
    \u0275\u0275text(22, "\u8F49\u5316\u8FFD\u8E64\u5831\u8868");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(23, "p", 363);
    \u0275\u0275text(24, " TG-AI\u667A\u63A7\u738B \u5C07\u5E6B\u52A9\u60A8\u81EA\u52D5\u5316 Telegram \u71DF\u92B7\u6D41\u7A0B\uFF0C");
    \u0275\u0275element(25, "br");
    \u0275\u0275text(26, " \u8B93\u60A8\u5C08\u6CE8\u65BC\u696D\u52D9\u589E\u9577\u800C\u975E\u91CD\u8907\u64CD\u4F5C\u3002 ");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_15_Conditional_3_For_2_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "option", 253);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const model_r46 = ctx.$implicit;
    \u0275\u0275property("value", model_r46);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate(model_r46);
  }
}
function AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_15_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    const _r45 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "select", 372);
    \u0275\u0275listener("ngModelChange", function AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_15_Conditional_3_Template_select_ngModelChange_0_listener($event) {
      \u0275\u0275restoreView(_r45);
      const ctx_r0 = \u0275\u0275nextContext(5);
      return \u0275\u0275resetView(ctx_r0.localAiModel.set($event));
    });
    \u0275\u0275repeaterCreate(1, AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_15_Conditional_3_For_2_Template, 2, 2, "option", 253, \u0275\u0275repeaterTrackByIdentity);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(5);
    \u0275\u0275property("ngModel", ctx_r0.localAiModel());
    \u0275\u0275advance();
    \u0275\u0275repeater(ctx_r0.detectedOllamaModels());
  }
}
function AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_15_Conditional_4_Template(rf, ctx) {
  if (rf & 1) {
    const _r47 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "input", 373);
    \u0275\u0275listener("ngModelChange", function AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_15_Conditional_4_Template_input_ngModelChange_0_listener($event) {
      \u0275\u0275restoreView(_r47);
      const ctx_r0 = \u0275\u0275nextContext(5);
      return \u0275\u0275resetView(ctx_r0.localAiModel.set($event));
    });
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(5);
    \u0275\u0275property("ngModel", ctx_r0.localAiModel());
  }
}
function AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_15_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 360)(1, "label", 369);
    \u0275\u0275text(2, "\u9078\u64C7 AI \u6A21\u578B");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(3, AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_15_Conditional_3_Template, 3, 1, "select", 370)(4, AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_15_Conditional_4_Template, 1, 1, "input", 371);
    \u0275\u0275elementStart(5, "p", 15);
    \u0275\u0275text(6, "\u63A8\u85A6\uFF1Aqwen2:7b\uFF08\u4E2D\u82F1\u6587\u901A\u7528\uFF09");
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(3);
    \u0275\u0275conditional(ctx_r0.detectedOllamaModels().length > 0 ? 3 : 4);
  }
}
function AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_16_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    const _r49 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 379)(1, "select", 380);
    \u0275\u0275listener("ngModelChange", function AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_16_Conditional_16_Template_select_ngModelChange_1_listener($event) {
      \u0275\u0275restoreView(_r49);
      const ctx_r0 = \u0275\u0275nextContext(5);
      return \u0275\u0275resetView(ctx_r0.aiBackupProvider.set($event));
    });
    \u0275\u0275elementStart(2, "option", 381);
    \u0275\u0275text(3, "Google Gemini\uFF08\u514D\u8CBB\u984D\u5EA6\uFF09");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "option", 382);
    \u0275\u0275text(5, "OpenAI GPT");
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(5);
    \u0275\u0275advance();
    \u0275\u0275property("ngModel", ctx_r0.aiBackupProvider());
  }
}
function AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    const _r48 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 360)(1, "div", 374)(2, "p", 177);
    \u0275\u0275text(3, "\u{1F4E6} \u5B89\u88DD Ollama\uFF08\u514D\u8CBB\uFF09\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "code", 375);
    \u0275\u0275text(5, " curl -fsSL https://ollama.com/install.sh | sh ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(6, "p", 149);
    \u0275\u0275text(7, " \u5B89\u88DD\u5F8C\u904B\u884C ");
    \u0275\u0275elementStart(8, "code", 267);
    \u0275\u0275text(9, "ollama pull qwen2:7b");
    \u0275\u0275elementEnd();
    \u0275\u0275text(10, " \u4E0B\u8F09\u6A21\u578B ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(11, "div", 360)(12, "label", 376)(13, "input", 377);
    \u0275\u0275listener("change", function AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_16_Template_input_change_13_listener() {
      \u0275\u0275restoreView(_r48);
      const ctx_r0 = \u0275\u0275nextContext(4);
      return \u0275\u0275resetView(ctx_r0.aiAutoFallback.set(!ctx_r0.aiAutoFallback()));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "span", 378);
    \u0275\u0275text(15, "\u4F7F\u7528\u96F2\u7AEF AI \u4F5C\u70BA\u5099\u9078");
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(16, AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_16_Conditional_16_Template, 6, 1, "div", 379);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance(13);
    \u0275\u0275property("checked", ctx_r0.aiAutoFallback());
    \u0275\u0275advance(3);
    \u0275\u0275conditional(ctx_r0.aiAutoFallback() ? 16 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_181_Case_13_Template(rf, ctx) {
  if (rf & 1) {
    const _r44 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 226)(1, "h3", 364);
    \u0275\u0275text(2, "\u{1F999} AI \u670D\u52D9\u914D\u7F6E");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "div", 365)(4, "div", 147)(5, "div", 64)(6, "span", 366);
    \u0275\u0275text(7);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(8, "div")(9, "div", 367);
    \u0275\u0275text(10);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "div", 32);
    \u0275\u0275text(12);
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(13, "button", 368);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_181_Case_13_Template_button_click_13_listener() {
      \u0275\u0275restoreView(_r44);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.detectOllama());
    });
    \u0275\u0275text(14);
    \u0275\u0275elementEnd()()();
    \u0275\u0275conditionalCreate(15, AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_15_Template, 7, 1, "div", 360)(16, AppComponent_Conditional_15_Conditional_181_Case_13_Conditional_16_Template, 17, 2);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(3);
    \u0275\u0275classMap(ctx_r0.ollamaDetected() ? "bg-green-500/20 border border-green-500/30" : "bg-yellow-500/20 border border-yellow-500/30");
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r0.ollamaDetected() ? "\u2705" : "\u26A0\uFE0F");
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", ctx_r0.ollamaDetected() ? "Ollama \u5DF2\u6AA2\u6E2C\u5230" : "Ollama \u672A\u904B\u884C", " ");
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1(" ", ctx_r0.ollamaDetected() ? "\u672C\u5730 AI \u670D\u52D9\u53EF\u7528" : "\u5EFA\u8B70\u5B89\u88DD Ollama \u7372\u5F97\u514D\u8CBB AI \u80FD\u529B", " ");
    \u0275\u0275advance();
    \u0275\u0275property("disabled", ctx_r0.isDetectingOllama());
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ctx_r0.isDetectingOllama() ? "\u6AA2\u6E2C\u4E2D..." : "\u91CD\u65B0\u6AA2\u6E2C", " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.ollamaDetected() ? 15 : 16);
  }
}
function AppComponent_Conditional_15_Conditional_181_Case_14_Conditional_13_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p");
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(4);
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1("\u2705 \u6A21\u578B\uFF1A", ctx_r0.localAiModel());
  }
}
function AppComponent_Conditional_15_Conditional_181_Case_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 353)(1, "div", 383);
    \u0275\u0275text(2, "\u{1F389}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "h3", 384);
    \u0275\u0275text(4, "\u8A2D\u7F6E\u5B8C\u6210\uFF01");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 363);
    \u0275\u0275text(6, " \u60A8\u5DF2\u6E96\u5099\u597D\u958B\u59CB\u4F7F\u7528 TG-AI\u667A\u63A7\u738B\u3002");
    \u0275\u0275element(7, "br");
    \u0275\u0275text(8, " \u63A5\u4E0B\u4F86\u8ACB\u6DFB\u52A0\u60A8\u7684\u7B2C\u4E00\u500B Telegram \u5E33\u865F\u3002 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(9, "div", 385)(10, "div", 386)(11, "p");
    \u0275\u0275text(12);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(13, AppComponent_Conditional_15_Conditional_181_Case_14_Conditional_13_Template, 2, 1, "p");
    \u0275\u0275elementStart(14, "p");
    \u0275\u0275text(15);
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(12);
    \u0275\u0275textInterpolate1("\u2705 AI \u670D\u52D9\uFF1A", ctx_r0.ollamaDetected() ? "Ollama \u672C\u5730 AI" : "\u96F2\u7AEF AI");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.ollamaDetected() ? 13 : -1);
    \u0275\u0275advance(2);
    \u0275\u0275textInterpolate1("\u2705 \u81EA\u52D5\u964D\u7D1A\uFF1A", ctx_r0.aiAutoFallback() ? "\u5DF2\u555F\u7528" : "\u5DF2\u7981\u7528");
  }
}
function AppComponent_Conditional_15_Conditional_181_Conditional_19_Template(rf, ctx) {
  if (rf & 1) {
    const _r50 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 387);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_181_Conditional_19_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r50);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.welcomeStep.set(ctx_r0.welcomeStep() - 1));
    });
    \u0275\u0275text(1, " \u4E0A\u4E00\u6B65 ");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_181_Conditional_20_Template(rf, ctx) {
  if (rf & 1) {
    const _r51 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 388);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_181_Conditional_20_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r51);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.welcomeStep.set(ctx_r0.welcomeStep() + 1));
    });
    \u0275\u0275text(1, " \u4E0B\u4E00\u6B65 ");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_181_Conditional_21_Template(rf, ctx) {
  if (rf & 1) {
    const _r52 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "button", 389);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_181_Conditional_21_Template_button_click_0_listener() {
      \u0275\u0275restoreView(_r52);
      const ctx_r0 = \u0275\u0275nextContext(3);
      return \u0275\u0275resetView(ctx_r0.completeFirstRunSetup());
    });
    \u0275\u0275text(1, " \u958B\u59CB\u4F7F\u7528 \u{1F680} ");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_181_Template(rf, ctx) {
  if (rf & 1) {
    const _r43 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 115)(1, "div", 346)(2, "div", 347)(3, "h1", 348);
    \u0275\u0275text(4, "\u{1F680} \u6B61\u8FCE\u4F7F\u7528 TG-AI\u667A\u63A7\u738B");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "p", 349);
    \u0275\u0275text(6, "AI \u9A45\u52D5\u7684 Telegram \u71DF\u92B7\u81EA\u52D5\u5316\u5E73\u53F0");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(7, "div", 350);
    \u0275\u0275element(8, "div", 351)(9, "div", 351)(10, "div", 351);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "div", 352);
    \u0275\u0275conditionalCreate(12, AppComponent_Conditional_15_Conditional_181_Case_12_Template, 27, 0, "div", 353)(13, AppComponent_Conditional_15_Conditional_181_Case_13_Template, 17, 8, "div", 226)(14, AppComponent_Conditional_15_Conditional_181_Case_14_Template, 16, 3, "div", 353);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "div", 354)(16, "button", 355);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_181_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r43);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.skipFirstRunSetup());
    });
    \u0275\u0275text(17, " \u8DF3\u904E\u8A2D\u7F6E ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(18, "div", 250);
    \u0275\u0275conditionalCreate(19, AppComponent_Conditional_15_Conditional_181_Conditional_19_Template, 2, 0, "button", 356);
    \u0275\u0275conditionalCreate(20, AppComponent_Conditional_15_Conditional_181_Conditional_20_Template, 2, 0, "button", 357)(21, AppComponent_Conditional_15_Conditional_181_Conditional_21_Template, 2, 0, "button", 358);
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    let tmp_7_0;
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(8);
    \u0275\u0275classMap(ctx_r0.welcomeStep() >= 1 ? "bg-cyan-500" : "bg-slate-600");
    \u0275\u0275advance();
    \u0275\u0275classMap(ctx_r0.welcomeStep() >= 2 ? "bg-cyan-500" : "bg-slate-600");
    \u0275\u0275advance();
    \u0275\u0275classMap(ctx_r0.welcomeStep() >= 3 ? "bg-cyan-500" : "bg-slate-600");
    \u0275\u0275advance(2);
    \u0275\u0275conditional((tmp_7_0 = ctx_r0.welcomeStep()) === 1 ? 12 : tmp_7_0 === 2 ? 13 : tmp_7_0 === 3 ? 14 : -1);
    \u0275\u0275advance(7);
    \u0275\u0275conditional(ctx_r0.welcomeStep() > 1 ? 19 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.welcomeStep() < 3 ? 20 : 21);
  }
}
function AppComponent_Conditional_15_Conditional_182_For_14_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 405);
    \u0275\u0275text(1);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    const session_r54 = \u0275\u0275nextContext().$implicit;
    \u0275\u0275advance();
    \u0275\u0275textInterpolate2(" \u2713 \u6709\u5143\u6578\u64DA: ", session_r54.metadata.firstName || "", " ", session_r54.metadata.username ? "@" + session_r54.metadata.username : "", " ");
  }
}
function AppComponent_Conditional_15_Conditional_182_For_14_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "p", 406);
    \u0275\u0275text(1, "\u26A0 \u7121\u5143\u6578\u64DA\uFF0C\u9700\u8981\u91CD\u65B0\u767B\u9304\u9A57\u8B49");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_182_For_14_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 398)(1, "div", 64)(2, "span", 366);
    \u0275\u0275text(3, "\u{1F4F1}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(4, "div")(5, "p", 404);
    \u0275\u0275text(6);
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(7, AppComponent_Conditional_15_Conditional_182_For_14_Conditional_7_Template, 2, 2, "p", 405)(8, AppComponent_Conditional_15_Conditional_182_For_14_Conditional_8_Template, 2, 0, "p", 406);
    \u0275\u0275elementEnd()()();
  }
  if (rf & 2) {
    const session_r54 = ctx.$implicit;
    \u0275\u0275advance(6);
    \u0275\u0275textInterpolate1("+", session_r54.phone);
    \u0275\u0275advance();
    \u0275\u0275conditional(session_r54.hasMetadata && session_r54.metadata ? 7 : 8);
  }
}
function AppComponent_Conditional_15_Conditional_182_Conditional_25_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span", 268);
    \u0275\u0275text(1, "\u23F3");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "span");
    \u0275\u0275text(3, "\u6062\u5FA9\u4E2D...");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_182_Conditional_26_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "span");
    \u0275\u0275text(1, "\u{1F504}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(2, "span");
    \u0275\u0275text(3, "\u6062\u5FA9\u5E33\u865F");
    \u0275\u0275elementEnd();
  }
}
function AppComponent_Conditional_15_Conditional_182_Template(rf, ctx) {
  if (rf & 1) {
    const _r53 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 115)(1, "div", 390)(2, "div", 391)(3, "div", 392);
    \u0275\u0275text(4, "\u{1F504}");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "h2", 393);
    \u0275\u0275text(6, "\u767C\u73FE\u53EF\u6062\u5FA9\u7684\u5E33\u865F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(7, "p", 394);
    \u0275\u0275text(8);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(9, "div", 395)(10, "p", 396);
    \u0275\u0275text(11, " \u9019\u4E9B Session \u6587\u4EF6\u5B58\u5728\u65BC\u7CFB\u7D71\u4E2D\uFF0C\u4F46\u672A\u5728\u6578\u64DA\u5EAB\u4E2D\u627E\u5230\u5C0D\u61C9\u7684\u5E33\u865F\u8A18\u9304\u3002 \u60A8\u53EF\u4EE5\u5617\u8A66\u6062\u5FA9\u9019\u4E9B\u5E33\u865F\uFF0C\u6216\u9078\u64C7\u5FFD\u7565\u3002 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(12, "div", 397);
    \u0275\u0275repeaterCreate(13, AppComponent_Conditional_15_Conditional_182_For_14_Template, 9, 2, "div", 398, _forTrack25);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(15, "div", 399)(16, "p", 400);
    \u0275\u0275text(17, " \u{1F4A1} ");
    \u0275\u0275elementStart(18, "strong");
    \u0275\u0275text(19, "\u63D0\u793A\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275text(20, " \u6062\u5FA9\u5F8C\uFF0C\u5E33\u865F\u5C07\u4EE5\u300C\u96E2\u7DDA\u300D\u72C0\u614B\u6DFB\u52A0\u5230\u5217\u8868\u4E2D\u3002 \u60A8\u9700\u8981\u9EDE\u64CA\u300C\u767B\u9304\u300D\u4F86\u91CD\u65B0\u9023\u63A5\u5E33\u865F\u3002 ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(21, "div", 401)(22, "button", 402);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_182_Template_button_click_22_listener() {
      \u0275\u0275restoreView(_r53);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.dismissOrphanSessionDialog());
    });
    \u0275\u0275text(23, " \u7A0D\u5F8C\u8655\u7406 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(24, "button", 403);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_182_Template_button_click_24_listener() {
      \u0275\u0275restoreView(_r53);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.recoverOrphanSessions());
    });
    \u0275\u0275conditionalCreate(25, AppComponent_Conditional_15_Conditional_182_Conditional_25_Template, 4, 0)(26, AppComponent_Conditional_15_Conditional_182_Conditional_26_Template, 4, 0);
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(8);
    \u0275\u0275textInterpolate1(" \u767C\u73FE ", ctx_r0.orphanSessions().length, " \u500B Session \u6587\u4EF6\u9700\u8981\u624B\u52D5\u6062\u5FA9 ");
    \u0275\u0275advance(5);
    \u0275\u0275repeater(ctx_r0.orphanSessions());
    \u0275\u0275advance(11);
    \u0275\u0275property("disabled", ctx_r0.isRecoveringOrphanSessions());
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.isRecoveringOrphanSessions() ? 25 : 26);
  }
}
function AppComponent_Conditional_15_Conditional_183_Conditional_41_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 415)(1, "p", 416)(2, "span", 177);
    \u0275\u0275text(3, "\u932F\u8AA4\u8A73\u60C5\uFF1A");
    \u0275\u0275elementEnd();
    \u0275\u0275text(4);
    \u0275\u0275elementEnd()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(3);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate1(" ", ctx_r0.backendError(), " ");
  }
}
function AppComponent_Conditional_15_Conditional_183_Template(rf, ctx) {
  if (rf & 1) {
    const _r55 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 115)(1, "div", 407)(2, "div", 408)(3, "div", 392);
    \u0275\u0275text(4, "\u26A0\uFE0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(5, "h2", 409);
    \u0275\u0275text(6, "Python \u5F8C\u7AEF\u672A\u904B\u884C");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(7, "div", 395)(8, "p", 363);
    \u0275\u0275text(9, " \u7A0B\u5E8F\u9700\u8981 Python \u74B0\u5883\u624D\u80FD\u6B63\u5E38\u904B\u884C\u3002\u8ACB\u78BA\u4FDD\uFF1A ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "div", 410)(11, "div", 411)(12, "span", 267);
    \u0275\u0275text(13, "1.");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(14, "div")(15, "p", 404);
    \u0275\u0275text(16, "\u5B89\u88DD Python 3.9+");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(17, "a", 412);
    \u0275\u0275text(18, " https://www.python.org/downloads/ ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(19, "div", 411)(20, "span", 267);
    \u0275\u0275text(21, "2.");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(22, "div")(23, "p", 404);
    \u0275\u0275text(24, '\u5B89\u88DD\u6642\u52FE\u9078 "Add Python to PATH"');
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(25, "p", 413);
    \u0275\u0275text(26, "\u78BA\u4FDD Python \u6DFB\u52A0\u5230\u7CFB\u7D71\u74B0\u5883\u8B8A\u91CF");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(27, "div", 411)(28, "span", 267);
    \u0275\u0275text(29, "3.");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(30, "div")(31, "p", 404);
    \u0275\u0275text(32, "\u5B89\u88DD\u4F9D\u8CF4");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(33, "code", 414);
    \u0275\u0275text(34, " pip install pyrogram tgcrypto aiosqlite ");
    \u0275\u0275elementEnd()()();
    \u0275\u0275elementStart(35, "div", 411)(36, "span", 267);
    \u0275\u0275text(37, "4.");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(38, "div")(39, "p", 404);
    \u0275\u0275text(40, "\u91CD\u65B0\u555F\u52D5\u7A0B\u5E8F");
    \u0275\u0275elementEnd()()()();
    \u0275\u0275conditionalCreate(41, AppComponent_Conditional_15_Conditional_183_Conditional_41_Template, 5, 1, "div", 415);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(42, "div", 401)(43, "button", 402);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_183_Template_button_click_43_listener() {
      \u0275\u0275restoreView(_r55);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.showBackendErrorDialog.set(false));
    });
    \u0275\u0275text(44, " \u6211\u77E5\u9053\u4E86 ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(41);
    \u0275\u0275conditional(ctx_r0.backendError() ? 41 : -1);
  }
}
function AppComponent_Conditional_15_Conditional_184_Template(rf, ctx) {
  if (rf & 1) {
    const _r56 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 417);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_184_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r56);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.showBackendErrorDialog.set(true));
    });
    \u0275\u0275elementStart(1, "span", 154);
    \u0275\u0275text(2, "\u26A0\uFE0F");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(3, "span", 237);
    \u0275\u0275text(4, "Python \u5F8C\u7AEF\u672A\u904B\u884C");
    \u0275\u0275elementEnd()();
  }
}
function AppComponent_Conditional_15_Conditional_185_Template(rf, ctx) {
  if (rf & 1) {
    const _r57 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 418);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_185_Template_div_click_0_listener() {
      \u0275\u0275restoreView(_r57);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.cancelNewKeywordSet());
    });
    \u0275\u0275elementStart(1, "div", 419);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_185_Template_div_click_1_listener($event) {
      \u0275\u0275restoreView(_r57);
      return \u0275\u0275resetView($event.stopPropagation());
    });
    \u0275\u0275elementStart(2, "div", 420)(3, "h2", 421)(4, "span");
    \u0275\u0275text(5, "\u{1F511}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(6, " \u5275\u5EFA\u95DC\u9375\u8A5E\u96C6 ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(7, "div", 352)(8, "label", 422);
    \u0275\u0275text(9, "\u95DC\u9375\u8A5E\u96C6\u540D\u7A31");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(10, "input", 423);
    \u0275\u0275listener("input", function AppComponent_Conditional_15_Conditional_185_Template_input_input_10_listener($event) {
      \u0275\u0275restoreView(_r57);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.newKeywordSet.set({ name: $event.target.value }));
    })("keyup.enter", function AppComponent_Conditional_15_Conditional_185_Template_input_keyup_enter_10_listener() {
      \u0275\u0275restoreView(_r57);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.submitNewKeywordSet());
    });
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(11, "p", 313);
    \u0275\u0275text(12, " \u{1F4A1} \u5275\u5EFA\u5F8C\u53EF\u5728\u8A5E\u96C6\u4E2D\u6DFB\u52A0\u591A\u500B\u95DC\u9375\u8A5E ");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(13, "div", 401)(14, "button", 402);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_185_Template_button_click_14_listener() {
      \u0275\u0275restoreView(_r57);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.cancelNewKeywordSet());
    });
    \u0275\u0275text(15, " \u53D6\u6D88 ");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(16, "button", 424);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Conditional_185_Template_button_click_16_listener() {
      \u0275\u0275restoreView(_r57);
      const ctx_r0 = \u0275\u0275nextContext(2);
      return \u0275\u0275resetView(ctx_r0.submitNewKeywordSet());
    });
    \u0275\u0275text(17, " \u5275\u5EFA ");
    \u0275\u0275elementEnd()()()();
  }
  if (rf & 2) {
    const ctx_r0 = \u0275\u0275nextContext(2);
    \u0275\u0275advance(10);
    \u0275\u0275property("value", ctx_r0.newKeywordSet().name);
  }
}
function AppComponent_Conditional_15_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = \u0275\u0275getCurrentView();
    \u0275\u0275elementStart(0, "div", 8)(1, "app-onboarding", 40, 0);
    \u0275\u0275listener("navigateEvent", function AppComponent_Conditional_15_Template_app_onboarding_navigateEvent_1_listener($event) {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.handleOnboardingNavigate($event));
    });
    \u0275\u0275elementEnd();
    \u0275\u0275element(3, "app-progress-dialog", 41);
    \u0275\u0275conditionalCreate(4, AppComponent_Conditional_15_Conditional_4_Template, 22, 1, "div", 42);
    \u0275\u0275conditionalCreate(5, AppComponent_Conditional_15_Conditional_5_Template, 17, 1, "div", 42);
    \u0275\u0275elementStart(6, "aside", 43)(7, "div", 44)(8, "button", 45);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_button_click_8_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.toggleSidebarCollapse());
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(9, "svg", 46);
    \u0275\u0275element(10, "polyline", 47);
    \u0275\u0275elementEnd()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(11, "div", 48)(12, "div", 49);
    \u0275\u0275element(13, "div", 50);
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(14, "svg", 51);
    \u0275\u0275element(15, "path", 52)(16, "path", 53)(17, "path", 54)(18, "path", 55)(19, "circle", 56);
    \u0275\u0275elementStart(20, "defs")(21, "linearGradient", 57);
    \u0275\u0275element(22, "stop", 58)(23, "stop", 59);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(24, "linearGradient", 60);
    \u0275\u0275element(25, "stop", 61)(26, "stop", 62);
    \u0275\u0275elementEnd()()()();
    \u0275\u0275conditionalCreate(27, AppComponent_Conditional_15_Conditional_27_Template, 5, 2, "div");
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(28, "div", 63);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_div_click_28_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.changeView("profile"));
    });
    \u0275\u0275elementStart(29, "div", 64)(30, "div", 65);
    \u0275\u0275element(31, "div", 66);
    \u0275\u0275elementStart(32, "div", 67)(33, "div", 68);
    \u0275\u0275text(34);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(35, AppComponent_Conditional_15_Conditional_35_Template, 6, 11, "div", 69);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(36, "div", 70)(37, "div", 71);
    \u0275\u0275text(38);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(39, "div", 72);
    \u0275\u0275conditionalCreate(40, AppComponent_Conditional_15_Case_40_Template, 5, 0, "span", 73)(41, AppComponent_Conditional_15_Case_41_Template, 5, 0, "span", 74)(42, AppComponent_Conditional_15_Case_42_Template, 5, 0, "span", 75)(43, AppComponent_Conditional_15_Case_43_Template, 5, 0, "span", 76)(44, AppComponent_Conditional_15_Case_44_Template, 5, 0, "span", 77)(45, AppComponent_Conditional_15_Case_45_Template, 5, 0, "span", 78);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(46, "div", 79);
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(47, "svg", 80);
    \u0275\u0275element(48, "polyline", 81);
    \u0275\u0275elementEnd()()()()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(49, "nav", 82);
    \u0275\u0275declareLet(50);
    \u0275\u0275elementStart(51, "a", 83);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_a_click_51_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.changeView("membership-center"));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(52, "svg", 84);
    \u0275\u0275element(53, "polygon", 85);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(54, "span");
    \u0275\u0275text(55, "\u6703\u54E1\u4E2D\u5FC3");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(56, "a", 83);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_a_click_56_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.changeView("wallet"));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(57, "svg", 84);
    \u0275\u0275element(58, "rect", 86)(59, "line", 87);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(60, "span");
    \u0275\u0275text(61, "\u6211\u7684\u9322\u5305");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(62, "a", 83);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_a_click_62_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.changeView("dashboard"));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(63, "svg", 84);
    \u0275\u0275element(64, "rect", 88)(65, "rect", 89)(66, "rect", 90)(67, "rect", 91);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(68, "span");
    \u0275\u0275text(69);
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(70, "div", 92)(71, "button", 93);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_button_click_71_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.toggleSidebarGroup("manual"));
    });
    \u0275\u0275elementStart(72, "span", 94);
    \u0275\u0275text(73, " \u{1F527} \u624B\u52D5\u64CD\u4F5C ");
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(74, "svg", 95);
    \u0275\u0275element(75, "polyline", 96);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(76, AppComponent_Conditional_15_Conditional_76_Template, 30, 25, "div", 97);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(77, "div", 92)(78, "button", 93);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_button_click_78_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.toggleSidebarGroup("monitoring"));
    });
    \u0275\u0275elementStart(79, "span", 98)(80, "span", 99);
    \u0275\u0275text(81, "\u{1F4E1}");
    \u0275\u0275elementEnd();
    \u0275\u0275text(82, " \u76E3\u63A7\u4E2D\u5FC3 ");
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(83, "svg", 95);
    \u0275\u0275element(84, "polyline", 96);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(85, AppComponent_Conditional_15_Conditional_85_Template, 42, 52, "div", 97);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(86, "div", 92)(87, "button", 93);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_button_click_87_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.toggleSidebarGroup("marketing"));
    });
    \u0275\u0275elementStart(88, "span", 98)(89, "span", 100);
    \u0275\u0275text(90, "AI");
    \u0275\u0275elementEnd();
    \u0275\u0275text(91, " \u667A\u80FD\u71DF\u92B7 ");
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(92, "svg", 95);
    \u0275\u0275element(93, "polyline", 96);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(94, AppComponent_Conditional_15_Conditional_94_Template, 34, 60, "div", 97);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(95, "div", 92)(96, "button", 93);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_button_click_96_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.toggleSidebarGroup("analytics"));
    });
    \u0275\u0275elementStart(97, "span", 94);
    \u0275\u0275text(98, " \u{1F4CA} \u6578\u64DA\u5206\u6790 ");
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(99, "svg", 95);
    \u0275\u0275element(100, "polyline", 96);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(101, AppComponent_Conditional_15_Conditional_101_Template, 25, 24, "div", 97);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(102, "div", 92)(103, "button", 93);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_button_click_103_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.toggleSidebarGroup("ai"));
    });
    \u0275\u0275elementStart(104, "span", 94);
    \u0275\u0275text(105);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(106, "svg", 95);
    \u0275\u0275element(107, "polyline", 96);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(108, AppComponent_Conditional_15_Conditional_108_Template, 15, 16, "div", 97);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(109, "div", 92)(110, "button", 93);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_button_click_110_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.toggleSidebarGroup("system"));
    });
    \u0275\u0275elementStart(111, "span", 94);
    \u0275\u0275text(112);
    \u0275\u0275elementEnd();
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(113, "svg", 95);
    \u0275\u0275element(114, "polyline", 96);
    \u0275\u0275elementEnd()();
    \u0275\u0275conditionalCreate(115, AppComponent_Conditional_15_Conditional_115_Template, 7, 7, "div", 97);
    \u0275\u0275elementEnd()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(116, "div", 101)(117, "button", 102);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_button_click_117_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.openOnboarding());
    });
    \u0275\u0275elementStart(118, "span", 103);
    \u0275\u0275text(119, "\u2753");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(120, "span");
    \u0275\u0275text(121, "\u4F7F\u7528\u5E2E\u52A9");
    \u0275\u0275elementEnd()();
    \u0275\u0275elementStart(122, "div")(123, "label", 104);
    \u0275\u0275text(124);
    \u0275\u0275elementEnd();
    \u0275\u0275element(125, "app-language-switcher-compact");
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(126, "div")(127, "label", 104);
    \u0275\u0275text(128);
    \u0275\u0275elementEnd();
    \u0275\u0275elementStart(129, "div", 105)(130, "button", 106);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_button_click_130_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.theme.set("light"));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(131, "svg", 107);
    \u0275\u0275element(132, "path", 108);
    \u0275\u0275elementEnd()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(133, "button", 106);
    \u0275\u0275listener("click", function AppComponent_Conditional_15_Template_button_click_133_listener() {
      \u0275\u0275restoreView(_r5);
      const ctx_r0 = \u0275\u0275nextContext();
      return \u0275\u0275resetView(ctx_r0.theme.set("dark"));
    });
    \u0275\u0275namespaceSVG();
    \u0275\u0275elementStart(134, "svg", 107);
    \u0275\u0275element(135, "path", 109);
    \u0275\u0275elementEnd()()()()()();
    \u0275\u0275namespaceHTML();
    \u0275\u0275elementStart(136, "main", 110);
    \u0275\u0275conditionalCreate(137, AppComponent_Conditional_15_Case_137_Template, 1, 0, "app-dashboard-view")(138, AppComponent_Conditional_15_Case_138_Template, 1, 0, "app-accounts-view")(139, AppComponent_Conditional_15_Case_139_Template, 1, 0, "app-add-account-page")(140, AppComponent_Conditional_15_Case_140_Template, 1, 0, "app-api-credentials-view")(141, AppComponent_Conditional_15_Case_141_Template, 1, 0, "app-settings-view")(142, AppComponent_Conditional_15_Case_142_Template, 1, 0, "app-leads-view")(143, AppComponent_Conditional_15_Case_143_Template, 1, 0, "app-automation-view")(144, AppComponent_Conditional_15_Case_144_Template, 1, 0, "app-resource-discovery-view")(145, AppComponent_Conditional_15_Case_145_Template, 1, 0, "app-resource-discovery-view")(146, AppComponent_Conditional_15_Case_146_Template, 1, 0, "app-ai-center-view")(147, AppComponent_Conditional_15_Case_147_Template, 2, 0, "div", 111)(148, AppComponent_Conditional_15_Case_148_Template, 2, 0, "div", 112)(149, AppComponent_Conditional_15_Case_149_Template, 2, 0, "div", 112)(150, AppComponent_Conditional_15_Case_150_Template, 1, 0, "app-multi-role-view")(151, AppComponent_Conditional_15_Case_151_Template, 1, 0, "app-analytics-view")(152, AppComponent_Conditional_15_Case_152_Template, 1, 0, "app-monitoring-view")(153, AppComponent_Conditional_15_Case_153_Template, 1, 0, "app-monitoring-view")(154, AppComponent_Conditional_15_Case_154_Template, 1, 0, "app-monitoring-view")(155, AppComponent_Conditional_15_Case_155_Template, 1, 0, "app-monitoring-view")(156, AppComponent_Conditional_15_Case_156_Template, 1, 0, "app-monitoring-view")(157, AppComponent_Conditional_15_Case_157_Template, 1, 0, "app-monitoring-view")(158, AppComponent_Conditional_15_Case_158_Template, 1, 0, "app-monitoring-view")(159, AppComponent_Conditional_15_Case_159_Template, 1, 0, "app-runtime-logs-view")(160, AppComponent_Conditional_15_Case_160_Template, 1, 0, "app-membership-center")(161, AppComponent_Conditional_15_Case_161_Template, 1, 0, "app-wallet-view")(162, AppComponent_Conditional_15_Case_162_Template, 1, 0, "app-profile")(163, AppComponent_Conditional_15_Case_163_Template, 1, 0, "app-resource-center")(164, AppComponent_Conditional_15_Case_164_Template, 1, 0, "app-search-discovery")(165, AppComponent_Conditional_15_Case_165_Template, 1, 0, "app-ai-marketing-assistant")(166, AppComponent_Conditional_15_Case_166_Template, 1, 0, "app-ai-team-hub")(167, AppComponent_Conditional_15_Case_167_Template, 1, 0, "app-member-database")(168, AppComponent_Conditional_15_Case_168_Template, 1, 0, "app-leads-view")(169, AppComponent_Conditional_15_Case_169_Template, 1, 0, "app-analytics-view")(170, AppComponent_Conditional_15_Case_170_Template, 1, 0, "app-analytics-view")(171, AppComponent_Conditional_15_Case_171_Template, 1, 0, "app-automation-view")(172, AppComponent_Conditional_15_Case_172_Template, 1, 0, "app-automation-view")(173, AppComponent_Conditional_15_Case_173_Template, 1, 0, "app-analytics-view")(174, AppComponent_Conditional_15_Case_174_Template, 1, 0, "app-marketing-report")(175, AppComponent_Conditional_15_Case_175_Template, 1, 0, "app-runtime-logs-view")(176, AppComponent_Conditional_15_Case_176_Template, 1, 0, "app-runtime-logs-view")(177, AppComponent_Conditional_15_Case_177_Template, 1, 0, "app-runtime-logs-view")(178, AppComponent_Conditional_15_Case_178_Template, 1, 0, "app-dashboard-view");
    \u0275\u0275elementEnd();
    \u0275\u0275conditionalCreate(179, AppComponent_Conditional_15_Conditional_179_Template, 30, 24, "div", 113);
    \u0275\u0275conditionalCreate(180, AppComponent_Conditional_15_Conditional_180_Template, 19, 1, "div", 114);
    \u0275\u0275conditionalCreate(181, AppComponent_Conditional_15_Conditional_181_Template, 22, 9, "div", 115);
    \u0275\u0275conditionalCreate(182, AppComponent_Conditional_15_Conditional_182_Template, 27, 3, "div", 115);
    \u0275\u0275conditionalCreate(183, AppComponent_Conditional_15_Conditional_183_Template, 45, 1, "div", 115);
    \u0275\u0275conditionalCreate(184, AppComponent_Conditional_15_Conditional_184_Template, 5, 0, "div", 116);
    \u0275\u0275conditionalCreate(185, AppComponent_Conditional_15_Conditional_185_Template, 18, 1, "div", 117);
    \u0275\u0275elementEnd();
  }
  if (rf & 2) {
    let tmp_38_0;
    let tmp_40_0;
    let tmp_41_0;
    let tmp_75_0;
    let tmp_76_0;
    const ctx_r0 = \u0275\u0275nextContext();
    \u0275\u0275advance(3);
    \u0275\u0275property("show", ctx_r0.progressDialog().show)("title", ctx_r0.progressDialog().title)("progress", ctx_r0.progressDialog().progress)("cancellable", ctx_r0.progressDialog().cancellable);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.deleteConfirmDialog().show ? 4 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.showInviteGroupDialog() ? 5 : -1);
    \u0275\u0275advance();
    \u0275\u0275classProp("w-64", !ctx_r0.sidebarCollapsed())("w-16", ctx_r0.sidebarCollapsed());
    \u0275\u0275advance(2);
    \u0275\u0275property("title", ctx_r0.sidebarCollapsed() ? "\u5C55\u958B\u5074\u908A\u6B04" : "\u6536\u7E2E\u5074\u908A\u6B04");
    \u0275\u0275advance();
    \u0275\u0275classProp("rotate-180", ctx_r0.sidebarCollapsed());
    \u0275\u0275advance(2);
    \u0275\u0275classProp("justify-center", ctx_r0.sidebarCollapsed());
    \u0275\u0275advance(16);
    \u0275\u0275conditional(!ctx_r0.sidebarCollapsed() ? 27 : -1);
    \u0275\u0275advance();
    \u0275\u0275classProp("level-bronze", ctx_r0.userMembershipLevel() === "bronze")("level-silver", ctx_r0.userMembershipLevel() === "silver")("level-gold", ctx_r0.userMembershipLevel() === "gold")("level-diamond", ctx_r0.userMembershipLevel() === "diamond")("level-star", ctx_r0.userMembershipLevel() === "star")("level-king", ctx_r0.userMembershipLevel() === "king");
    \u0275\u0275advance(3);
    \u0275\u0275classProp("glow-bronze", ctx_r0.userMembershipLevel() === "bronze")("glow-silver", ctx_r0.userMembershipLevel() === "silver")("glow-gold", ctx_r0.userMembershipLevel() === "gold")("glow-diamond", ctx_r0.userMembershipLevel() === "diamond")("glow-star", ctx_r0.userMembershipLevel() === "star")("glow-king", ctx_r0.userMembershipLevel() === "king");
    \u0275\u0275advance();
    \u0275\u0275classProp("border-bronze", ctx_r0.userMembershipLevel() === "bronze")("border-silver", ctx_r0.userMembershipLevel() === "silver")("border-gold", ctx_r0.userMembershipLevel() === "gold")("border-diamond", ctx_r0.userMembershipLevel() === "diamond")("border-star", ctx_r0.userMembershipLevel() === "star")("border-king", ctx_r0.userMembershipLevel() === "king");
    \u0275\u0275advance();
    \u0275\u0275classProp("avatar-bronze", ctx_r0.userMembershipLevel() === "bronze")("avatar-silver", ctx_r0.userMembershipLevel() === "silver")("avatar-gold", ctx_r0.userMembershipLevel() === "gold")("avatar-diamond", ctx_r0.userMembershipLevel() === "diamond")("avatar-star", ctx_r0.userMembershipLevel() === "star")("avatar-king", ctx_r0.userMembershipLevel() === "king");
    \u0275\u0275advance();
    \u0275\u0275textInterpolate1(" ", ((tmp_38_0 = ctx_r0.currentUser()) == null ? null : tmp_38_0.username == null ? null : tmp_38_0.username.charAt(0).toUpperCase()) || "?", " ");
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.userMembershipLevel() !== "bronze" ? 35 : -1);
    \u0275\u0275advance(3);
    \u0275\u0275textInterpolate1(" ", ((tmp_40_0 = ctx_r0.currentUser()) == null ? null : tmp_40_0.username) || "\u7528\u6236", " ");
    \u0275\u0275advance(2);
    \u0275\u0275conditional((tmp_41_0 = ctx_r0.userMembershipLevel()) === "silver" ? 40 : tmp_41_0 === "gold" ? 41 : tmp_41_0 === "diamond" ? 42 : tmp_41_0 === "star" ? 43 : tmp_41_0 === "king" ? 44 : 45);
    \u0275\u0275advance(10);
    const view_r58 = \u0275\u0275storeLet(ctx_r0.currentView());
    \u0275\u0275advance();
    \u0275\u0275styleProp("background-color", view_r58 === "membership-center" ? "var(--sidebar-item-active)" : "transparent")("color", view_r58 === "membership-center" ? "var(--sidebar-text-active)" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r58 === "membership-center");
    \u0275\u0275advance(5);
    \u0275\u0275styleProp("background-color", view_r58 === "wallet" ? "var(--sidebar-item-active)" : "transparent")("color", view_r58 === "wallet" ? "var(--sidebar-text-active)" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r58 === "wallet");
    \u0275\u0275advance(6);
    \u0275\u0275styleProp("background-color", view_r58 === "dashboard" ? "var(--sidebar-item-active)" : "transparent")("color", view_r58 === "dashboard" ? "var(--sidebar-text-active)" : "var(--sidebar-text)");
    \u0275\u0275classProp("active", view_r58 === "dashboard");
    \u0275\u0275advance(7);
    \u0275\u0275textInterpolate(ctx_r0.t("dashboard"));
    \u0275\u0275advance(5);
    \u0275\u0275classProp("rotate-180", !ctx_r0.isSidebarGroupExpanded("manual"));
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.isSidebarGroupExpanded("manual") ? 76 : -1);
    \u0275\u0275advance(7);
    \u0275\u0275classProp("rotate-180", !ctx_r0.isSidebarGroupExpanded("monitoring"));
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.isSidebarGroupExpanded("monitoring") ? 85 : -1);
    \u0275\u0275advance(7);
    \u0275\u0275classProp("rotate-180", !ctx_r0.isSidebarGroupExpanded("marketing"));
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.isSidebarGroupExpanded("marketing") ? 94 : -1);
    \u0275\u0275advance(5);
    \u0275\u0275classProp("rotate-180", !ctx_r0.isSidebarGroupExpanded("analytics"));
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.isSidebarGroupExpanded("analytics") ? 101 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate1(" \u{1F9E0} ", ctx_r0.t("aiIntelligence"), " ");
    \u0275\u0275advance();
    \u0275\u0275classProp("rotate-180", !ctx_r0.isSidebarGroupExpanded("ai"));
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.isSidebarGroupExpanded("ai") ? 108 : -1);
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate1(" \u2699\uFE0F ", ctx_r0.t("systemMonitor"), " ");
    \u0275\u0275advance();
    \u0275\u0275classProp("rotate-180", !ctx_r0.isSidebarGroupExpanded("system"));
    \u0275\u0275advance(2);
    \u0275\u0275conditional(ctx_r0.isSidebarGroupExpanded("system") ? 115 : -1);
    \u0275\u0275advance(9);
    \u0275\u0275textInterpolate(ctx_r0.t("language"));
    \u0275\u0275advance(4);
    \u0275\u0275textInterpolate(ctx_r0.t("appearance"));
    \u0275\u0275advance(2);
    \u0275\u0275styleProp("background-color", ctx_r0.theme() === "light" ? "var(--bg-card)" : "transparent")("color", ctx_r0.theme() === "light" ? "var(--primary)" : "var(--text-muted)")("box-shadow", ctx_r0.theme() === "light" ? "var(--shadow-sm)" : "none");
    \u0275\u0275advance(3);
    \u0275\u0275styleProp("background-color", ctx_r0.theme() === "dark" ? "var(--primary-bg)" : "transparent")("color", ctx_r0.theme() === "dark" ? "var(--primary)" : "var(--text-muted)")("box-shadow", ctx_r0.theme() === "dark" ? "var(--shadow-sm)" : "none");
    \u0275\u0275advance(4);
    \u0275\u0275conditional((tmp_75_0 = ctx_r0.currentView()) === "dashboard" ? 137 : tmp_75_0 === "accounts" ? 138 : tmp_75_0 === "add-account" ? 139 : tmp_75_0 === "api-credentials" ? 140 : tmp_75_0 === "settings" ? 141 : tmp_75_0 === "leads" ? 142 : tmp_75_0 === "automation" ? 143 : tmp_75_0 === "resource-discovery" ? 144 : tmp_75_0 === "resources" ? 145 : tmp_75_0 === "ai-center" ? 146 : tmp_75_0 === "knowledge-brain" ? 147 : tmp_75_0 === "knowledge-gaps" ? 148 : tmp_75_0 === "knowledge-manage" ? 149 : tmp_75_0 === "multi-role" ? 150 : tmp_75_0 === "analytics" ? 151 : tmp_75_0 === "monitoring" ? 152 : tmp_75_0 === "monitoring-accounts" ? 153 : tmp_75_0 === "monitoring-groups" ? 154 : tmp_75_0 === "keyword-sets" ? 155 : tmp_75_0 === "chat-templates" ? 156 : tmp_75_0 === "trigger-rules" ? 157 : tmp_75_0 === "collected-users" ? 158 : tmp_75_0 === "runtime-logs" ? 159 : tmp_75_0 === "membership-center" ? 160 : tmp_75_0 === "wallet" ? 161 : tmp_75_0 === "profile" ? 162 : tmp_75_0 === "resource-center" ? 163 : tmp_75_0 === "search-discovery" ? 164 : tmp_75_0 === "ai-assistant" ? 165 : tmp_75_0 === "ai-team" ? 166 : tmp_75_0 === "member-database" ? 167 : tmp_75_0 === "lead-nurturing" ? 168 : tmp_75_0 === "nurturing-analytics" ? 169 : tmp_75_0 === "user-tracking" ? 170 : tmp_75_0 === "ads" ? 171 : tmp_75_0 === "campaigns" ? 172 : tmp_75_0 === "analytics-center" ? 173 : tmp_75_0 === "marketing-report" ? 174 : tmp_75_0 === "performance" ? 175 : tmp_75_0 === "alerts" ? 176 : tmp_75_0 === "logs" ? 177 : 178);
    \u0275\u0275advance(42);
    \u0275\u0275conditional((tmp_76_0 = ctx_r0.generationState().lead) ? 179 : -1, tmp_76_0);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.showBatchOperationHistory() ? 180 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.showWelcomeDialog() ? 181 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.showOrphanSessionDialog() ? 182 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.showBackendErrorDialog() ? 183 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(!ctx_r0.backendRunning() ? 184 : -1);
    \u0275\u0275advance();
    \u0275\u0275conditional(ctx_r0.showKeywordSetCreator() ? 185 : -1);
  }
}
function AppComponent_Conditional_16_Template(rf, ctx) {
  if (rf & 1) {
    \u0275\u0275elementStart(0, "div", 9);
    \u0275\u0275element(1, "router-outlet");
    \u0275\u0275elementEnd();
  }
}
var AppComponent = class _AppComponent {
  // 🆕 用於調試的路由 URL
  get routerUrl() {
    return this.router?.url || "N/A";
  }
  // 切換側邊欄分組展開狀態
  toggleSidebarGroup(group) {
    const current = this.sidebarGroups();
    this.sidebarGroups.set(__spreadProps(__spreadValues({}, current), {
      [group]: !current[group]
    }));
    localStorage.setItem("sidebar_groups", JSON.stringify(this.sidebarGroups()));
  }
  // 檢查分組是否展開
  isSidebarGroupExpanded(group) {
    return this.sidebarGroups()[group] ?? true;
  }
  // 從本地存儲加載側邊欄分組狀態
  loadSidebarGroupsState() {
    try {
      const saved = localStorage.getItem("sidebar_groups");
      if (saved) {
        const parsed = JSON.parse(saved);
        this.sidebarGroups.set(__spreadValues(__spreadValues({}, this.sidebarGroups()), parsed));
      }
      const collapsed = localStorage.getItem("sidebar_collapsed");
      if (collapsed === "true") {
        this.sidebarCollapsed.set(true);
      }
    } catch (e) {
      console.warn("[Sidebar] Failed to load sidebar groups state:", e);
    }
  }
  // 切換側邊欄收縮狀態
  toggleSidebarCollapse() {
    const newState = !this.sidebarCollapsed();
    this.sidebarCollapsed.set(newState);
    localStorage.setItem("sidebar_collapsed", String(newState));
  }
  // --- QR 掃碼登入 ---
  // 使用 DialogService 的狀態，實現統一管理
  get showQrLoginDialog() {
    return this.dialogService.showQrLoginDialog;
  }
  hideSearchSuggestions() {
    setTimeout(() => this.showSearchSuggestions.set(false), 200);
  }
  // 🆕 C方案：檢查是否處於搜索結果模式（有當前搜索關鍵詞）
  isInSearchResultMode() {
    return this.currentSearchKeyword().length > 0;
  }
  // 🆕 C方案：退出搜索結果模式，顯示歷史數據
  exitSearchResultMode() {
    this.currentSearchKeyword.set("");
    this.loadResources();
  }
  saveSettings() {
    if (this.saveSettingsTimer) {
      clearTimeout(this.saveSettingsTimer);
    }
    this.saveSettingsTimer = setTimeout(() => {
      this.ipcService.send("save-settings", {
        settings: {
          spintaxEnabled: this.spintaxEnabled(),
          autoReplyEnabled: this.autoReplyEnabled(),
          autoReplyMessage: this.autoReplyMessage(),
          smartSendingEnabled: this.smartSendingEnabled()
        }
      });
      this.saveSettingsTimer = null;
    }, 500);
  }
  showSettingsSavedToast() {
    this.toastService.success(this.t("settingsSaved"), 2e3);
  }
  async testAiConnection() {
    if (this.aiApiType() === "local") {
      await this.testLocalAiConnection();
      return;
    }
    if (!this.aiApiKey())
      return;
    this.isTestingAi.set(true);
    this.aiConnectionStatus.set(null);
    try {
      this.ipcService.send("test-ai-connection", {
        apiType: this.aiApiType(),
        apiKey: this.aiApiKey(),
        endpoint: this.customApiEndpoint()
      });
      await new Promise((resolve) => setTimeout(resolve, 1500));
      const key = this.aiApiKey();
      if (this.aiApiType() === "gemini" && key.startsWith("AIza")) {
        this.aiConnectionStatus.set("success");
      } else if (this.aiApiType() === "openai" && key.startsWith("sk-")) {
        this.aiConnectionStatus.set("success");
      } else if (this.aiApiType() === "custom" && key.length > 10) {
        this.aiConnectionStatus.set("success");
      } else {
        this.aiConnectionStatus.set("error");
        this.aiConnectionError.set(this.t("invalidApiKeyFormat"));
      }
    } catch (error) {
      this.aiConnectionStatus.set("error");
      this.aiConnectionError.set(error.message);
    } finally {
      this.isTestingAi.set(false);
    }
  }
  // 測試本地 AI 服務連接
  async testLocalAiConnection() {
    const endpoint = this.localAiEndpoint();
    if (!endpoint)
      return;
    this.isTestingLocalAi.set(true);
    this.localAiStatus.set(null);
    try {
      this.ipcService.send("test-local-ai", {
        endpoint,
        provider: this.localAiProvider(),
        model: this.localAiModel()
      });
      if (this.localAiProvider() === "ollama") {
        this.ipcService.send("get-ollama-models", { endpoint });
      }
      await new Promise((resolve) => setTimeout(resolve, 3e3));
      if (endpoint.startsWith("http://") || endpoint.startsWith("https://")) {
        this.localAiStatus.set("success");
        this.aiConnectionStatus.set("success");
        this.toastService.success("\u672C\u5730 AI \u670D\u52D9\u9023\u63A5\u6210\u529F");
      } else {
        this.localAiStatus.set("error");
        this.localAiError.set(this.t("invalidEndpointFormat"));
      }
    } catch (error) {
      this.localAiStatus.set("error");
      this.localAiError.set(error.message);
    } finally {
      this.isTestingLocalAi.set(false);
    }
  }
  // 刷新 Ollama 模型列表
  refreshOllamaModels() {
    const endpoint = this.localAiEndpoint();
    if (!endpoint)
      return;
    this.toastService.info("\u6B63\u5728\u7372\u53D6\u6A21\u578B\u5217\u8868...");
    this.ipcService.send("get-ollama-models", { endpoint });
  }
  // 設置本地 AI 提供者預設值
  setLocalAiPresets(provider) {
    this.localAiProvider.set(provider);
    switch (provider) {
      case "ollama":
        this.localAiEndpoint.set("http://localhost:11434");
        this.localAiModel.set("qwen2:7b");
        break;
      case "lmstudio":
        this.localAiEndpoint.set("http://localhost:1234");
        this.localAiModel.set("");
        break;
      case "custom":
        this.localAiEndpoint.set("");
        this.localAiModel.set("");
        break;
    }
  }
  // 測試 TTS 服務連接
  async testTtsConnection() {
    const endpoint = this.ttsEndpoint();
    if (!endpoint)
      return;
    this.isTestingTts.set(true);
    this.ttsStatus.set(null);
    try {
      this.ipcService.send("test-tts-service", { endpoint });
      await new Promise((resolve) => setTimeout(resolve, 2e3));
      if (endpoint.startsWith("http://") || endpoint.startsWith("https://")) {
        this.ttsStatus.set("success");
      } else {
        this.ttsStatus.set("error");
        this.ttsError.set(this.t("invalidEndpointFormat"));
      }
    } catch (error) {
      this.ttsStatus.set("error");
      this.ttsError.set(error.message);
    } finally {
      this.isTestingTts.set(false);
    }
  }
  // 測試 STT 服務連接
  async testSttConnection() {
    const endpoint = this.sttEndpoint();
    if (!endpoint)
      return;
    this.isTestingStt.set(true);
    this.sttStatus.set(null);
    try {
      this.ipcService.send("test-stt-service", { endpoint });
      await new Promise((resolve) => setTimeout(resolve, 2e3));
      if (endpoint.startsWith("http://") || endpoint.startsWith("https://")) {
        this.sttStatus.set("success");
      } else {
        this.sttStatus.set("error");
        this.sttError.set(this.t("invalidEndpointFormat"));
      }
    } catch (error) {
      this.sttStatus.set("error");
      this.sttError.set(error.message);
    } finally {
      this.isTestingStt.set(false);
    }
  }
  saveAiSettings() {
    localStorage.setItem("ai_api_key", this.aiApiKey());
    localStorage.setItem("ai_api_type", this.aiApiType());
    localStorage.setItem("ai_custom_endpoint", this.customApiEndpoint());
    localStorage.setItem("local_ai_endpoint", this.localAiEndpoint());
    localStorage.setItem("local_ai_model", this.localAiModel());
    localStorage.setItem("tts_endpoint", this.ttsEndpoint());
    localStorage.setItem("tts_enabled", String(this.ttsEnabled()));
    localStorage.setItem("tts_voice", this.ttsVoice());
    localStorage.setItem("stt_endpoint", this.sttEndpoint());
    localStorage.setItem("stt_enabled", String(this.sttEnabled()));
    this.ipcService.send("save-ai-settings", {
      apiType: this.aiApiType(),
      apiKey: this.aiApiKey(),
      endpoint: this.customApiEndpoint(),
      localAiEndpoint: this.localAiEndpoint(),
      localAiModel: this.localAiModel(),
      ttsEndpoint: this.ttsEndpoint(),
      ttsEnabled: this.ttsEnabled(),
      ttsVoice: this.ttsVoice(),
      sttEndpoint: this.sttEndpoint(),
      sttEnabled: this.sttEnabled()
    });
    if (this.aiApiType() === "gemini" && this.aiApiKey()) {
      this.geminiService.setApiKey(this.aiApiKey());
    }
    this.toastService.success(this.t("aiSettingsSaved"), 2e3);
  }
  // 切換 AI 自動聊天開關（自動保存）
  toggleAiAutoChat() {
    this.aiAutoChatEnabled.set(!this.aiAutoChatEnabled());
    this.saveAiChatSettings();
    this.toastService.success(this.aiAutoChatEnabled() ? "AI \u81EA\u52D5\u804A\u5929\u5DF2\u958B\u555F" : "AI \u81EA\u52D5\u804A\u5929\u5DF2\u95DC\u9589", 2e3);
  }
  // 切換自動問候開關（自動保存）
  toggleAiAutoGreeting() {
    this.aiAutoGreeting.set(!this.aiAutoGreeting());
    this.saveAiChatSettings();
    this.toastService.success(this.aiAutoGreeting() ? "\u81EA\u52D5\u554F\u5019\u5DF2\u958B\u555F" : "\u81EA\u52D5\u554F\u5019\u5DF2\u95DC\u9589", 2e3);
  }
  // 保存 AI 自動聊天設置
  saveAiChatSettings() {
    localStorage.setItem("ai_auto_chat_enabled", String(this.aiAutoChatEnabled()));
    localStorage.setItem("ai_auto_chat_mode", this.aiAutoChatMode());
    localStorage.setItem("ai_typing_speed", String(this.aiTypingSpeed()));
    localStorage.setItem("ai_reply_delay", JSON.stringify(this.aiReplyDelay()));
    localStorage.setItem("ai_system_prompt", this.aiSystemPrompt());
    localStorage.setItem("ai_max_context_messages", String(this.aiMaxContextMessages()));
    localStorage.setItem("ai_enable_memory", String(this.aiEnableMemory()));
    localStorage.setItem("ai_auto_greeting", String(this.aiAutoGreeting()));
    localStorage.setItem("ai_greeting_message", this.aiGreetingMessage());
    this.ipcService.send("update-ai-chat-settings", {
      settings: {
        auto_chat_enabled: this.aiAutoChatEnabled() ? 1 : 0,
        auto_chat_mode: this.aiAutoChatMode(),
        typing_speed: this.aiTypingSpeed(),
        reply_delay_min: this.aiReplyDelay()[0],
        reply_delay_max: this.aiReplyDelay()[1],
        system_prompt: this.aiSystemPrompt(),
        max_context_messages: this.aiMaxContextMessages(),
        enable_memory: this.aiEnableMemory() ? 1 : 0,
        auto_greeting: this.aiAutoGreeting() ? 1 : 0,
        greeting_message: this.aiGreetingMessage()
      },
      localAiEndpoint: this.localAiEndpoint(),
      localAiModel: this.localAiModel()
    });
    this.toastService.success(this.t("aiSettingsSaved"), 2e3);
  }
  // 加載 AI 自動聊天設置
  loadAiChatSettings() {
    const enabled = localStorage.getItem("ai_auto_chat_enabled");
    const mode = localStorage.getItem("ai_auto_chat_mode");
    const speed = localStorage.getItem("ai_typing_speed");
    const delay = localStorage.getItem("ai_reply_delay");
    const prompt = localStorage.getItem("ai_system_prompt");
    const maxContext = localStorage.getItem("ai_max_context_messages");
    const memory = localStorage.getItem("ai_enable_memory");
    const greeting = localStorage.getItem("ai_auto_greeting");
    const greetingMsg = localStorage.getItem("ai_greeting_message");
    if (enabled)
      this.aiAutoChatEnabled.set(enabled === "true");
    if (mode)
      this.aiAutoChatMode.set(mode);
    if (speed)
      this.aiTypingSpeed.set(parseInt(speed));
    if (delay) {
      try {
        this.aiReplyDelay.set(JSON.parse(delay));
      } catch (e) {
      }
    }
    if (prompt)
      this.aiSystemPrompt.set(prompt);
    if (maxContext)
      this.aiMaxContextMessages.set(parseInt(maxContext));
    if (memory)
      this.aiEnableMemory.set(memory === "true");
    if (greeting)
      this.aiAutoGreeting.set(greeting === "true");
    if (greetingMsg)
      this.aiGreetingMessage.set(greetingMsg);
  }
  // ==================== Telegram RAG System Methods ====================
  // 初始化 RAG 系統
  initRagSystem() {
    this.isInitializingRag.set(true);
    this.ipcService.send("init-rag-system", {});
  }
  // 觸發 RAG 學習
  triggerRagLearning() {
    this.isRagLearning.set(true);
    this.ipcService.send("trigger-rag-learning", {});
  }
  // 重新索引高價值對話
  reindexHighValueConversations() {
    this.isReindexing.set(true);
    this.ipcService.send("reindex-conversations", {
      highValueOnly: true,
      days: 30
    });
  }
  // 清理 RAG 知識庫
  cleanupRagKnowledge() {
    this.isCleaningRag.set(true);
    this.ipcService.send("cleanup-rag-knowledge", {
      minScore: 0.2,
      daysOld: 30,
      mergeSimilar: true
    });
  }
  // 重新索引對話
  reindexConversations() {
    this.isReindexing.set(true);
    this.ipcService.send("reindex-conversations", {
      highValueOnly: true,
      days: 30
    });
    this.toastService.info("\u958B\u59CB\u91CD\u5EFA\u7D22\u5F15...");
  }
  // 刷新 RAG 統計
  refreshRagStats() {
    this.ipcService.send("get-rag-stats", {});
  }
  // 搜索 RAG 知識庫
  searchRagKnowledge() {
    if (!this.ragSearchQuery.trim())
      return;
    this.isSearchingRag.set(true);
    this.ipcService.send("search-rag", {
      query: this.ragSearchQuery,
      limit: 10
    });
  }
  // 發送 RAG 反饋
  sendRagFeedback(knowledgeId, isPositive) {
    this.ipcService.send("rag-feedback", {
      knowledgeId,
      isPositive
    });
    this.toastService.info(isPositive ? "\u{1F44D} \u611F\u8B1D\u53CD\u994B\uFF01" : "\u{1F44E} \u5DF2\u8A18\u9304\u53CD\u994B");
  }
  // 添加手動知識
  addRagKnowledge() {
    if (!this.newRagKnowledge.answer.trim()) {
      this.toastService.error("\u8ACB\u586B\u5BEB\u56DE\u7B54\u5167\u5BB9");
      return;
    }
    this.ipcService.send("add-rag-knowledge", {
      type: this.newRagKnowledge.type,
      question: this.newRagKnowledge.question,
      answer: this.newRagKnowledge.answer,
      context: this.newRagKnowledge.context
    });
    this.newRagKnowledge = { type: "qa", question: "", answer: "", context: "" };
    this.showAddRagKnowledgeDialog.set(false);
  }
  // ==================== Vector Memory Methods ====================
  // 搜索向量記憶
  searchVectorMemory() {
    if (!this.vectorMemorySearchQuery.trim())
      return;
    this.isSearchingMemory.set(true);
    this.ipcService.send("search-vector-memories", {
      userId: this.selectedMemoryUserId() || "",
      query: this.vectorMemorySearchQuery,
      limit: 10
    });
  }
  // 添加向量記憶
  addVectorMemory() {
    if (!this.newMemory.content.trim()) {
      this.toastService.error("\u8ACB\u586B\u5BEB\u8A18\u61B6\u5167\u5BB9");
      return;
    }
    this.isAddingMemory.set(true);
    this.ipcService.send("add-vector-memory", {
      userId: this.newMemory.userId || "manual",
      content: this.newMemory.content,
      type: this.newMemory.type,
      importance: this.newMemory.importance
    });
  }
  // 獲取記憶統計
  refreshMemoryStats() {
    this.ipcService.send("get-memory-stats", { userId: "" });
  }
  // 刪除向量記憶
  deleteVectorMemory(memoryId) {
    this.ipcService.send("delete-vector-memory", { memoryId });
  }
  // 獲取用戶列表
  loadMemoryUserList() {
    this.ipcService.send("get-memory-user-list", {});
  }
  // 清理舊記憶
  cleanupOldMemories() {
    this.ipcService.send("cleanup-old-memories", { daysOld: 90 });
  }
  // 合併相似記憶
  mergeSimilarMemories() {
    const userId = this.selectedMemoryUserId();
    if (!userId) {
      this.toastService.error("\u8ACB\u5148\u9078\u64C7\u7528\u6236");
      return;
    }
    this.ipcService.send("merge-similar-memories", { userId, threshold: 0.85 });
  }
  // ==================== Resource Discovery Methods ====================
  // 獲取資源發現可用的帳號列表（優先探索號，其次監控號，最後任意在線帳號）
  getResourceDiscoveryAccounts() {
    const onlineAccounts = this.accounts().filter((a) => a.status === "Online");
    return onlineAccounts.sort((a, b) => {
      const priority = {
        "Explorer": 1,
        "Listener": 2,
        "Sender": 3,
        "AI": 4,
        "Backup": 5,
        "Unassigned": 6
      };
      return (priority[a.role] || 99) - (priority[b.role] || 99);
    });
  }
  // 獲取當前資源發現使用的帳號
  getSelectedResourceAccount() {
    const accountId = this.resourceAccountId();
    if (accountId) {
      return this.accounts().find((a) => a.id === accountId) || null;
    }
    const accounts = this.getResourceDiscoveryAccounts();
    return accounts.length > 0 ? accounts[0] : null;
  }
  // 選擇資源發現帳號
  selectResourceAccount(accountId) {
    this.resourceAccountId.set(accountId);
    const account = this.accounts().find((a) => a.id === accountId);
    if (account) {
      this.toastService.success(`\u8CC7\u6E90\u767C\u73FE\u5C07\u4F7F\u7528: ${account.phone}`);
    }
    this.showResourceAccountSelector.set(false);
  }
  // 獲取角色名稱
  getRoleDisplayName(role) {
    const roleNames = {
      "Explorer": "\u{1F50D} \u63A2\u7D22\u865F",
      "Listener": "\u{1F441}\uFE0F \u76E3\u63A7\u865F",
      "Sender": "\u{1F4E4} \u767C\u9001\u865F",
      "AI": "\u{1F916} AI\u865F",
      "Backup": "\u26A1 \u5099\u7528\u865F",
      "Unassigned": "\u2B55 \u672A\u5206\u914D"
    };
    return roleNames[role] || "\u2B55 \u672A\u5206\u914D";
  }
  // 初始化資源發現系統
  initResourceDiscovery() {
    const account = this.getSelectedResourceAccount();
    if (!account) {
      this.toastService.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F\uFF0C\u8ACB\u5148\u767B\u5165\u5E33\u865F");
      return;
    }
    this.toastService.info(`\u6B63\u5728\u4F7F\u7528 ${account.phone} \u521D\u59CB\u5316\u8CC7\u6E90\u767C\u73FE\u7CFB\u7D71...`);
    this.ipcService.send("init-resource-discovery", {
      accountId: account.id,
      phone: account.phone
    });
  }
  // 自動初始化（進入頁面時調用）
  autoInitResourceDiscovery() {
    if (!this.resourceDiscoveryInitialized()) {
      this.initResourceDiscovery();
    }
    this.refreshResourceStats();
    this.loadDiscoveryKeywords();
  }
  // 生成搜索會話 ID
  generateSearchSessionId() {
    return `search_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;
  }
  // 🆕 生成搜索緩存鍵
  generateSearchCacheKey(query, sources) {
    const normalizedQuery = query.toLowerCase().trim();
    const sortedSources = [...sources].sort().join(",");
    return `${normalizedQuery}|${sortedSources}`;
  }
  // 🆕 獲取緩存的搜索結果
  getSearchCache(cacheKey) {
    const cached = this.searchResultsCache.get(cacheKey);
    if (!cached)
      return null;
    if (Date.now() - cached.timestamp > this.CACHE_EXPIRY_MS) {
      this.searchResultsCache.delete(cacheKey);
      return null;
    }
    return cached.results;
  }
  // 🆕 設置搜索結果緩存
  setSearchCache(cacheKey, results) {
    if (this.searchResultsCache.size > 20) {
      const entries = Array.from(this.searchResultsCache.entries());
      entries.sort((a, b) => a[1].timestamp - b[1].timestamp);
      const toDelete = entries.slice(0, entries.length - 20);
      toDelete.forEach(([key]) => this.searchResultsCache.delete(key));
    }
    this.searchResultsCache.set(cacheKey, {
      results: [...results],
      timestamp: Date.now()
    });
    console.log(`[Search Cache] \u5DF2\u7DE9\u5B58\u641C\u7D22\u7D50\u679C: "${cacheKey}" (${results.length} \u689D)`);
  }
  // 🆕 清除搜索緩存
  clearSearchCache() {
    this.searchResultsCache.clear();
    console.log("[Search Cache] \u5DF2\u6E05\u9664\u6240\u6709\u7DE9\u5B58");
  }
  // 搜索资源（支持多渠道和多关键词）
  searchResources() {
    if (!this.resourceSearchQuery.trim()) {
      this.toastService.error(this.t("searchPlaceholder"));
      return;
    }
    if (this.selectedSearchSources().length === 0) {
      this.toastService.error("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u641C\u7D22\u6E20\u9053");
      return;
    }
    if (this.getOnlineAccountsCount() === 0) {
      this.toastService.error("\u8ACB\u5148\u767B\u9304\u5E33\u865F");
      return;
    }
    const query = this.resourceSearchQuery.trim();
    const sources = this.selectedSearchSources();
    const cacheKey = this.generateSearchCacheKey(query, sources);
    const cachedResult = this.getSearchCache(cacheKey);
    if (cachedResult) {
      console.log(`[Search Cache] \u4F7F\u7528\u7DE9\u5B58\u7D50\u679C: "${query}" (${cachedResult.length} \u689D)`);
      this.currentSearchKeyword.set(query);
      this.discoveredResources.set(cachedResult);
      this.showSearchHistory.set(false);
      const history2 = this.searchHistoryKeywords();
      const newHistory2 = [query, ...history2.filter((k) => k !== query)].slice(0, 10);
      this.searchHistoryKeywords.set(newHistory2);
      return;
    }
    const sessionId = this.generateSearchSessionId();
    this.currentSearchSessionId.set(sessionId);
    this.currentSearchKeyword.set(query);
    this.showSearchHistory.set(false);
    const history = this.searchHistoryKeywords();
    const newHistory = [query, ...history.filter((k) => k !== query)].slice(0, 10);
    this.searchHistoryKeywords.set(newHistory);
    this.discoveredResources.set([]);
    const keywords = query.split(/[,;，；]/).map((k) => k.trim()).filter((k) => k.length > 0);
    if (keywords.length > 1) {
      console.log(`[Search] \u6B63\u5728\u641C\u7D22 ${keywords.length} \u4E2A\u5173\u952E\u8BCD...`);
      this.searchMultipleKeywords(keywords);
    } else {
      this.isSearchingResources.set(true);
      this.searchError.set({ hasError: false, message: "", details: "", suggestions: [] });
      console.log(`[Search] \u6B63\u5728\u641C\u7D22 "${query}"...`);
      if (this.searchTimeout)
        clearTimeout(this.searchTimeout);
      this.searchTimeout = setTimeout(() => {
        if (this.isSearchingResources()) {
          this.isSearchingResources.set(false);
          this.toastService.error("\u641C\u7D22\u8D85\u65F6\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u6216\u7A0D\u540E\u518D\u8BD5");
        }
      }, 7e4);
      this.executeMultiSourceSearch(query, sources);
    }
  }
  // 执行多渠道搜索
  executeMultiSourceSearch(query, sources) {
    const phone = this.getSelectedResourceAccount()?.phone;
    const sessionId = this.currentSearchSessionId();
    if (sources.includes("telegram") || sources.includes("local")) {
      this.ipcService.send("search-resources", {
        query,
        phone,
        sources: sources.filter((s) => s !== "jiso"),
        // 排除 jiso，单独处理
        limit: 50,
        searchType: this.resourceSearchType(),
        minMembers: this.resourceMinMembers(),
        replaceMode: true,
        // 🆕 始終替換模式
        searchSessionId: sessionId,
        // 🆕 傳遞會話 ID
        searchKeyword: query
        // 🆕 傳遞搜索關鍵詞
      });
    }
    if (sources.includes("jiso")) {
      console.log("[Search] \u6B63\u5728\u901A\u8FC7\u6781\u641C Bot \u641C\u7D22...");
      this.ipcService.send("search-jiso", {
        keyword: query,
        phone,
        limit: 50,
        searchSessionId: sessionId,
        // 🆕 傳遞會話 ID
        searchKeyword: query
        // 🆕 傳遞搜索關鍵詞
      });
    }
    if (sources.includes("tgstat")) {
    }
  }
  // 多关键词搜索
  searchMultipleKeywords(keywords) {
    this.isSearchingResources.set(true);
    const sources = this.selectedSearchSources();
    if (this.searchTimeout)
      clearTimeout(this.searchTimeout);
    this.searchTimeout = setTimeout(() => {
      if (this.isSearchingResources()) {
        this.isSearchingResources.set(false);
        this.toastService.error("\u641C\u7D22\u8D85\u65F6");
      }
    }, keywords.length * 1e4 + 3e4);
    keywords.forEach((keyword, index) => {
      setTimeout(() => {
        this.executeMultiSourceSearch(keyword, sources);
      }, index * 5e3);
    });
  }
  // 打開群組鏈接
  openTelegramLink(resource) {
    const link = resource.username ? `https://t.me/${resource.username}` : resource.invite_link;
    if (link) {
      this.ipcService.send("open-external-link", { url: link });
    } else {
      this.toastService.warning("\u6B64\u7FA4\u7D44\u6C92\u6709\u516C\u958B\u93C8\u63A5");
    }
  }
  // 複製群組鏈接
  copyTelegramLink(resource) {
    const link = resource.username ? `https://t.me/${resource.username}` : resource.invite_link || "";
    if (link) {
      navigator.clipboard.writeText(link);
      this.toastService.success("\u93C8\u63A5\u5DF2\u8907\u88FD");
    } else {
      navigator.clipboard.writeText(resource.title);
      this.toastService.warning("\u6B64\u7FA4\u7D44\u7121\u516C\u958B\u93C8\u63A5\uFF0C\u5DF2\u8907\u88FD\u7FA4\u7D44\u540D\u7A31\uFF0C\u8ACB\u5728 Telegram \u4E2D\u624B\u52D5\u641C\u7D22");
    }
  }
  // 複製用戶名
  copyUsername(username) {
    const text = `@${username}`;
    navigator.clipboard.writeText(text);
    this.toastService.success("\u5DF2\u8907\u88FD " + text);
  }
  // 獲取資源類型圖標
  getResourceTypeIcon(type) {
    switch (type) {
      case "channel":
        return "\u{1F4E2}";
      case "supergroup":
        return "\u{1F465}";
      case "group":
        return "\u{1F4AC}";
      default:
        return "\u{1F4CC}";
    }
  }
  // 獲取資源類型標籤
  getResourceTypeLabel(type) {
    switch (type) {
      case "channel":
        return "\u983B\u9053";
      case "supergroup":
        return "\u8D85\u7D1A\u7FA4\u7D44";
      case "group":
        return "\u7FA4\u7D44";
      default:
        return "\u672A\u77E5";
    }
  }
  // 格式化成員數
  formatMemberCount(count) {
    if (count >= 1e6)
      return (count / 1e6).toFixed(1) + "M";
    if (count >= 1e3)
      return (count / 1e3).toFixed(1) + "K";
    return count.toString();
  }
  // 快速加入單個資源
  quickJoinResource(resourceId) {
    this.ipcService.send("batch-join-resources", {
      resourceIds: [resourceId]
    });
    this.toastService.info("\u6B63\u5728\u5617\u8A66\u52A0\u5165...");
  }
  // 加載資源列表
  loadResources() {
    this.ipcService.send("get-resources", {
      status: this.resourceFilterStatus() || void 0,
      type: this.resourceFilterType() || void 0,
      limit: 100,
      offset: 0
    });
  }
  // 根據鏈接狀態篩選資源（前端過濾）
  filterResourcesByLink() {
    const filterValue = this.resourceFilterLink();
    if (!filterValue) {
      this.loadResources();
      return;
    }
    const allResources = this.discoveredResources();
    const filtered = allResources.filter((r) => {
      const hasLink = !!(r.username || r.invite_link);
      if (filterValue === "has_link") {
        return hasLink;
      } else if (filterValue === "no_link") {
        return !hasLink;
      }
      return true;
    });
    this.discoveredResources.set(filtered);
  }
  // 刷新資源統計
  refreshResourceStats() {
    this.ipcService.send("get-resource-stats", {});
  }
  // ==================== 搜索渠道管理 ====================
  // 打開渠道管理對話框
  openChannelManageDialog() {
    this.loadSearchChannels();
    this.showChannelManageDialog.set(true);
  }
  // 關閉渠道管理對話框
  closeChannelManageDialog() {
    this.showChannelManageDialog.set(false);
  }
  // 加載搜索渠道列表
  loadSearchChannels() {
    this.ipcService.send("get-search-channels", {});
  }
  // 打開添加渠道對話框
  openAddChannelDialog() {
    this.newChannelUsername = "";
    this.newChannelDisplayName = "";
    this.newChannelQueryFormat = "{keyword}";
    this.newChannelPriority = "backup";
    this.newChannelNotes = "";
    this.showAddChannelDialog.set(true);
  }
  // 關閉添加渠道對話框
  closeAddChannelDialog() {
    this.showAddChannelDialog.set(false);
  }
  // 添加自定義渠道
  addSearchChannel() {
    if (!this.newChannelUsername.trim()) {
      this.toastService.error("\u8ACB\u8F38\u5165 Bot \u7528\u6236\u540D");
      return;
    }
    this.ipcService.send("add-search-channel", {
      botUsername: this.newChannelUsername.trim(),
      displayName: this.newChannelDisplayName.trim() || this.newChannelUsername.trim(),
      queryFormat: this.newChannelQueryFormat,
      priority: this.newChannelPriority,
      notes: this.newChannelNotes
    });
  }
  // 刪除自定義渠道
  deleteSearchChannel(channelId) {
    if (channelId < 0) {
      this.toastService.warning("\u7121\u6CD5\u522A\u9664\u7CFB\u7D71\u6E20\u9053");
      return;
    }
    if (confirm("\u78BA\u5B9A\u8981\u522A\u9664\u9019\u500B\u641C\u7D22\u6E20\u9053\u55CE\uFF1F")) {
      this.ipcService.send("delete-search-channel", { channelId });
    }
  }
  // 測試渠道
  testSearchChannel(botUsername) {
    this.isTestingChannel.set(true);
    this.toastService.info(`\u6B63\u5728\u6E2C\u8A66 @${botUsername}...`);
    this.ipcService.send("test-search-channel", { botUsername });
  }
  // 切換渠道啟用狀態
  toggleChannelEnabled(channelId, currentEnabled) {
    if (channelId < 0) {
      this.toastService.warning("\u7121\u6CD5\u4FEE\u6539\u7CFB\u7D71\u6E20\u9053");
      return;
    }
    this.ipcService.send("update-search-channel", {
      channelId,
      enabled: !currentEnabled
    });
  }
  // 獲取渠道狀態顏色
  getChannelStatusColor(status) {
    switch (status) {
      case "online":
        return "text-green-400";
      case "offline":
        return "text-red-400";
      case "captcha":
        return "text-yellow-400";
      default:
        return "text-gray-400";
    }
  }
  // 獲取渠道狀態圖標
  getChannelStatusIcon(status) {
    switch (status) {
      case "online":
        return "\u{1F7E2}";
      case "offline":
        return "\u{1F534}";
      case "captcha":
        return "\u{1F7E1}";
      default:
        return "\u26AA";
    }
  }
  // ==================== 加入並監控 ====================
  // 打開加入並監控對話框
  openJoinAndMonitorDialog(resource) {
    this.joinMonitorResource.set(resource);
    this.joinMonitorKeywords.set([]);
    this.joinMonitorNewKeyword = "";
    this.joinMonitorAutoEnable.set(true);
    this.loadAccountQuotas();
    if (resource.joined_by_phone) {
      this.joinMonitorSelectedPhone.set(resource.joined_by_phone);
    } else {
      this.joinMonitorSelectedPhone.set("");
    }
    const monitoredGroup = this.monitoredGroups().find((g) => g.url === resource.username || g.url === `@${resource.username}` || g.url === resource.telegram_id || g.id === resource.id);
    if (monitoredGroup && monitoredGroup.keywordSetIds) {
      this.joinMonitorSelectedKeywordSetIds.set([...monitoredGroup.keywordSetIds]);
    } else {
      this.joinMonitorSelectedKeywordSetIds.set([]);
    }
    this.showQuickCreateKeywordSet.set(false);
    this.quickCreateKeywordSetName = "";
    this.quickCreateKeywordSetKeywords.set([]);
    this.quickCreateKeywordSetNewKeyword = "";
    this.showJoinMonitorDialog.set(true);
  }
  // 關閉加入並監控對話框
  closeJoinMonitorDialog() {
    this.showJoinMonitorDialog.set(false);
    this.joinMonitorResource.set(null);
    this.showChangeMonitorAccount.set(false);
  }
  // 獲取可用於監控的帳號列表
  getAvailableAccountsForMonitor() {
    return this.accounts().filter((acc) => acc.status === "Online");
  }
  // 選擇監控帳號
  selectMonitorAccount(phone) {
    this.joinMonitorSelectedPhone.set(phone);
    this.showChangeMonitorAccount.set(false);
  }
  // 停止監控群組（但不退出）
  stopMonitoringGroup(resource) {
    if (!resource)
      return;
    const groupId = resource.telegram_id || resource.id || resource.username;
    if (!groupId) {
      this.toastService.error("\u7121\u6CD5\u8B58\u5225\u7FA4\u7D44");
      return;
    }
    this.ipcService.send("remove-group", {
      groupId,
      id: resource.id,
      telegramId: resource.telegram_id,
      username: resource.username,
      link: resource.link || resource.invite_link
    });
    this.updateResourceStatusLocally(resource, "joined");
    this.closeJoinMonitorDialog();
    this.closeResourceMenu();
    this.toastService.info("\u6B63\u5728\u505C\u6B62\u76E3\u63A7...");
    setTimeout(() => {
      this.loadResources();
      this.refreshResourceStats();
      this.ipcService.send("get-monitored-groups");
    }, 500);
  }
  // 確認退出群組
  confirmLeaveGroup(resource) {
    if (!resource)
      return;
    const title = resource.title || resource.username || "\u6B64\u7FA4\u7D44";
    if (confirm(`\u78BA\u5B9A\u8981\u9000\u51FA\u300C${title}\u300D\u55CE\uFF1F

\u6B64\u64CD\u4F5C\u5C07\uFF1A
\u2022 \u5F9E Telegram \u9000\u51FA\u7FA4\u7D44
\u2022 \u505C\u6B62\u6240\u6709\u76E3\u63A7
\u2022 \u522A\u9664\u76F8\u95DC\u6578\u64DA`)) {
      this.leaveGroup(resource);
    }
  }
  // 退出群組
  leaveGroup(resource) {
    if (!resource)
      return;
    const phone = resource.joined_by_phone || this.joinMonitorSelectedPhone();
    const groupId = resource.telegram_id || resource.username;
    if (!phone) {
      this.toastService.error("\u7121\u6CD5\u78BA\u5B9A\u4F7F\u7528\u7684\u5E33\u865F");
      return;
    }
    this.ipcService.send("leave-group", {
      phone,
      groupId,
      resourceId: resource.id
    });
    this.updateResourceStatusLocally(resource, "discovered");
    this.closeJoinMonitorDialog();
    this.toastService.info("\u6B63\u5728\u9000\u51FA\u7FA4\u7D44...");
    setTimeout(() => {
      this.loadResources();
      this.refreshResourceStats();
      this.ipcService.send("get-monitored-groups");
    }, 1e3);
  }
  // 在 Telegram 中打開資源
  openInTelegram(resource) {
    const link = resource.username ? `https://t.me/${resource.username}` : resource.invite_link || resource.link;
    if (link) {
      window.open(link, "_blank");
    } else {
      this.toastService.warning("\u6C92\u6709\u53EF\u7528\u7684\u93C8\u63A5");
    }
  }
  // 刪除資源記錄
  deleteResource(resource) {
    if (!resource?.id)
      return;
    if (confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u300C${resource.title || "\u6B64\u8CC7\u6E90"}\u300D\u7684\u8A18\u9304\u55CE\uFF1F`)) {
      this.ipcService.send("delete-resource", { resourceId: resource.id });
      const resources = this.discoveredResources();
      this.discoveredResources.set(resources.filter((r) => r.id !== resource.id));
      this.toastService.success("\u5DF2\u522A\u9664\u8CC7\u6E90\u8A18\u9304");
      this.refreshResourceStats();
    }
  }
  // 🆕 即時更新本地資源狀態（樂觀更新）
  updateResourceStatusLocally(resource, newStatus, phone, memberCount) {
    if (!resource)
      return;
    const resources = this.discoveredResources();
    const identifier = resource.telegram_id || resource.username || resource.title;
    const updated = resources.map((r) => {
      const rIdentifier = r.telegram_id || r.username || r.title;
      if (rIdentifier === identifier) {
        const updatedResource = __spreadProps(__spreadValues({}, r), {
          status: newStatus,
          joined_at: (/* @__PURE__ */ new Date()).toISOString()
        });
        if (phone) {
          updatedResource.joined_by_phone = phone;
        }
        if (memberCount && memberCount > 0) {
          updatedResource.member_count = memberCount;
        }
        return updatedResource;
      }
      return r;
    });
    this.discoveredResources.set(updated);
    console.log(`[Frontend] Updated resource status: ${identifier} -> ${newStatus}`);
  }
  // 🆕 顯示加入成功後的「下一步」選項
  showPostJoinOptions(resource, phone, keywordSetCount) {
    this.showJoinMonitorDialog.set(false);
    this.showSuccessAnimation({
      icon: "\u{1F680}",
      title: "\u52A0\u5165\u6210\u529F\uFF01",
      subtitle: resource?.title || "\u7FA4\u7D44\u5DF2\u6DFB\u52A0\u5230\u76E3\u63A7",
      duration: 1200
    });
    setTimeout(() => {
      this.postJoinResource.set(resource);
      this.postJoinPhone.set(phone);
      this.showPostJoinDialog.set(true);
    }, 1200);
  }
  // 🆕 關閉「下一步」對話框
  closePostJoinDialog() {
    this.showPostJoinDialog.set(false);
    this.postJoinResource.set(null);
    this.postJoinPhone.set("");
  }
  // 🆕 顯示成功動畫覆蓋層
  showSuccessAnimation(config) {
    this.successOverlayConfig.set(config);
    this.showSuccessOverlay.set(true);
    const duration = config.duration || 1500;
    setTimeout(() => {
      this.hideSuccessAnimation();
    }, duration);
  }
  // 🆕 隱藏成功動畫
  hideSuccessAnimation() {
    this.showSuccessOverlay.set(false);
    this.successOverlayConfig.set(null);
  }
  // 🆕 執行「下一步」操作：提取成員
  postJoinExtractMembers() {
    const resource = this.postJoinResource();
    if (resource) {
      this.closePostJoinDialog();
      this.openMemberListDialog(resource);
    }
  }
  // 🆕 執行「下一步」操作：發送消息
  postJoinSendMessage() {
    const resource = this.postJoinResource();
    if (resource) {
      this.closePostJoinDialog();
      this.openSingleMessageDialog(resource);
    }
  }
  // 🆕 執行「下一步」操作：繼續加入其他群組
  postJoinContinue() {
    this.closePostJoinDialog();
    this.toastService.info("\u7E7C\u7E8C\u700F\u89BD\u5176\u4ED6\u7FA4\u7D44", 2e3);
  }
  // 加載帳號配額信息
  loadAccountQuotas() {
    const accounts = this.accounts();
    const quotasRaw = accounts.filter((acc) => acc.status === "Online").map((acc) => {
      const joinedGroups = Math.floor(acc.dailySendCount / 10) || 0;
      const dailyLimit = 20;
      const dailyUsed = Math.floor(acc.dailySendCount / 5) || 0;
      const healthScore = acc.healthScore || 0;
      const quotaRemaining = dailyLimit > 0 ? (dailyLimit - dailyUsed) / dailyLimit * 100 : 0;
      const recommendScore = healthScore * 0.5 + quotaRemaining * 0.5;
      return {
        phone: acc.phone,
        nickname: acc.group || acc.phone,
        joinedGroups,
        dailyLimit,
        dailyUsed: Math.min(dailyUsed, dailyLimit),
        isRecommended: false,
        // 稍後設置
        recommendScore,
        healthScore
      };
    }).sort((a, b) => b.recommendScore - a.recommendScore);
    const quotas = quotasRaw.map((q, index) => {
      const meetsBasicCriteria = q.healthScore >= 70 && q.dailyUsed < q.dailyLimit * 0.8;
      const isTopAccount = index < 2 && meetsBasicCriteria;
      return __spreadProps(__spreadValues({}, q), {
        isRecommended: isTopAccount
      });
    });
    this.accountQuotas.set(quotas);
    if (!this.joinMonitorSelectedPhone()) {
      const recommended = quotas.find((q) => q.isRecommended);
      if (recommended) {
        this.joinMonitorSelectedPhone.set(recommended.phone);
      } else if (quotas.length > 0) {
        this.joinMonitorSelectedPhone.set(quotas[0].phone);
      }
    }
  }
  // ==================== 關鍵詞集選擇（新版） ====================
  // 切換關鍵詞集選擇
  toggleKeywordSetSelection(setId) {
    const current = this.joinMonitorSelectedKeywordSetIds();
    if (current.includes(setId)) {
      this.joinMonitorSelectedKeywordSetIds.set(current.filter((id) => id !== setId));
    } else {
      const keywordSet = this.keywordSets().find((s) => s.id === setId);
      if (keywordSet && (!keywordSet.keywords || keywordSet.keywords.length === 0)) {
        this.toastService.warning(`\u26A0\uFE0F \u300C${keywordSet.name}\u300D\u6C92\u6709\u95DC\u9375\u8A5E\uFF0C\u8ACB\u5148\u6DFB\u52A0\u95DC\u9375\u8A5E\u518D\u4F7F\u7528`);
        return;
      }
      this.joinMonitorSelectedKeywordSetIds.set([...current, setId]);
    }
  }
  // 檢查關鍵詞集是否被選中
  isKeywordSetSelected(setId) {
    return this.joinMonitorSelectedKeywordSetIds().includes(setId);
  }
  // 打開快速創建關鍵詞集對話框
  openQuickCreateKeywordSet() {
    this.showQuickCreateKeywordSet.set(true);
    this.quickCreateKeywordSetName = "";
    this.quickCreateKeywordSetKeywords.set([]);
    this.quickCreateKeywordSetNewKeyword = "";
  }
  // 關閉快速創建關鍵詞集對話框
  closeQuickCreateKeywordSet() {
    this.showQuickCreateKeywordSet.set(false);
  }
  // 快速創建詞集：添加關鍵詞
  addQuickKeyword() {
    const keyword = this.quickCreateKeywordSetNewKeyword.trim();
    if (keyword && !this.quickCreateKeywordSetKeywords().includes(keyword)) {
      this.quickCreateKeywordSetKeywords.update((kws) => [...kws, keyword]);
      this.quickCreateKeywordSetNewKeyword = "";
    }
  }
  // 快速創建詞集：移除關鍵詞
  removeQuickKeyword(keyword) {
    this.quickCreateKeywordSetKeywords.update((kws) => kws.filter((k) => k !== keyword));
  }
  // 快速創建詞集：添加推薦關鍵詞
  addQuickRecommendedKeyword(keyword) {
    if (!this.quickCreateKeywordSetKeywords().includes(keyword)) {
      this.quickCreateKeywordSetKeywords.update((kws) => [...kws, keyword]);
    }
  }
  // 執行快速創建關鍵詞集並綁定
  executeQuickCreateKeywordSet() {
    const name = this.quickCreateKeywordSetName.trim();
    const keywords = this.quickCreateKeywordSetKeywords();
    if (!name) {
      this.toastService.warning("\u8ACB\u8F38\u5165\u8A5E\u96C6\u540D\u7A31");
      return;
    }
    if (keywords.length === 0) {
      this.toastService.warning("\u8ACB\u81F3\u5C11\u6DFB\u52A0\u4E00\u500B\u95DC\u9375\u8A5E");
      return;
    }
    this.ipcService.send("add-keyword-set", { name });
    const handler = (data) => {
      if (data.success && data.setId) {
        for (const keyword of keywords) {
          this.ipcService.send("add-keyword", { setId: data.setId, keyword, isRegex: false });
        }
        this.joinMonitorSelectedKeywordSetIds.update((ids) => [...ids, data.setId]);
        this.toastService.success(`\u5DF2\u5275\u5EFA\u4E26\u7D81\u5B9A\u95DC\u9375\u8A5E\u96C6\u300C${name}\u300D`);
        this.closeQuickCreateKeywordSet();
        this.ipcService.send("get-keyword-sets");
      }
      this.ipcService.off("keyword-set-added", handler);
    };
    this.ipcService.on("keyword-set-added", handler);
  }
  // ==================== 舊版散列關鍵詞（向後兼容） ====================
  // 添加監控關鍵詞
  addMonitorKeyword() {
    const keyword = this.joinMonitorNewKeyword.trim();
    if (keyword && !this.joinMonitorKeywords().includes(keyword)) {
      this.joinMonitorKeywords.update((kws) => [...kws, keyword]);
      this.joinMonitorNewKeyword = "";
    }
  }
  // 移除監控關鍵詞
  removeMonitorKeyword(keyword) {
    this.joinMonitorKeywords.update((kws) => kws.filter((k) => k !== keyword));
  }
  // 添加推薦關鍵詞
  addRecommendedKeyword(keyword) {
    if (!this.joinMonitorKeywords().includes(keyword)) {
      this.joinMonitorKeywords.update((kws) => [...kws, keyword]);
    }
  }
  // 獲取推薦關鍵詞（基於群組標題）
  getRecommendedKeywords() {
    const resource = this.joinMonitorResource();
    if (!resource)
      return [];
    const title = resource.title || "";
    const recommendations = [];
    if (title.includes("\u4E8C\u624B") || title.includes("\u4EA4\u6613")) {
      recommendations.push("\u6C42\u8CFC", "\u51FA\u552E", "\u8F49\u8B93");
    }
    if (title.includes("\u62DB\u8058") || title.includes("\u6C42\u8077")) {
      recommendations.push("\u62DB\u4EBA", "\u6C42\u8077", "\u517C\u8077");
    }
    if (title.includes("\u83EF\u4EBA") || title.includes("\u6D77\u5916")) {
      recommendations.push("\u5408\u4F5C", "\u8CC7\u6E90", "\u6C42\u52A9");
    }
    if (recommendations.length === 0) {
      recommendations.push("\u6C42\u8CFC", "\u5408\u4F5C", "\u8AEE\u8A62");
    }
    return recommendations.filter((r) => !this.joinMonitorKeywords().includes(r));
  }
  // 獲取關鍵詞預覽文本（用於模板顯示）
  getKeywordPreview(keywords) {
    if (!keywords || keywords.length === 0)
      return "";
    const preview = keywords.slice(0, 3).map((k) => k.keyword || k.text || k).join(", ");
    return keywords.length > 3 ? preview + "..." : preview;
  }
  // 執行加入並監控
  executeJoinAndMonitor() {
    const resource = this.joinMonitorResource();
    const phone = this.joinMonitorSelectedPhone();
    if (!resource) {
      this.toastService.error("\u8ACB\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");
      return;
    }
    if (resource.status !== "joined" && resource.status !== "monitoring" && !phone) {
      this.toastService.error("\u8ACB\u9078\u64C7\u52A0\u5165\u5E33\u865F");
      return;
    }
    this.isJoiningResource.set(true);
    const keywordSetIds = this.joinMonitorSelectedKeywordSetIds();
    const payload = {
      resourceId: resource.id || 0,
      phone,
      keywordSetIds,
      // 新版：關鍵詞集 IDs
      keywords: this.joinMonitorKeywords(),
      // 保留向後兼容
      autoEnableMonitor: this.joinMonitorAutoEnable()
    };
    if (!resource.id || resource.id === 0) {
      let link = resource.link || resource.invite_link || "";
      let username = resource.username || "";
      if (username && username.toLowerCase().endsWith("bot")) {
        console.log(`[Frontend] \u904E\u6FFE bot username: ${username}`);
        username = "";
      }
      if (link && /t\.me\/[^/]+\/\d+/.test(link)) {
        console.log(`[Frontend] \u904E\u6FFE\u6D88\u606F\u93C8\u63A5: ${link}`);
        link = "";
      }
      if (!link && !username) {
        const title = resource.title || "\u6B64\u7FA4\u7D44";
        this.toastService.error(`\u7121\u6CD5\u52A0\u5165\u300C${title}\u300D\uFF1A
\u2022 \u6B64\u641C\u7D22\u7D50\u679C\u6C92\u6709\u63D0\u4F9B\u7FA4\u7D44\u7684\u9080\u8ACB\u93C8\u63A5
\u2022 \u8ACB\u5728 Telegram \u4E2D\u9EDE\u64CA\u641C\u7D22\u6A5F\u5668\u4EBA\u7684\u7D50\u679C
\u2022 \u624B\u52D5\u7372\u53D6\u7FA4\u7D44\u93C8\u63A5\u5F8C\u518D\u8A66`);
        this.isJoiningResource.set(false);
        return;
      }
      let validTelegramId = "";
      if (resource.telegram_id && resource.telegram_id !== resource.title && !resource.telegram_id.toLowerCase().endsWith("bot")) {
        validTelegramId = resource.telegram_id;
      } else if (username) {
        validTelegramId = username;
      }
      payload.resourceInfo = {
        username,
        telegram_id: validTelegramId,
        title: resource.title || username || "\u672A\u547D\u540D\u7FA4\u7D44",
        description: resource.description || "",
        member_count: resource.member_count || 0,
        resource_type: resource.resource_type || "supergroup",
        // 🔑 確保 link 正確傳遞
        link: link || (username ? `https://t.me/${username}` : "")
      };
      console.log("[Frontend] Sending resourceInfo:", payload.resourceInfo);
    }
    this.ipcService.send("join-and-monitor-with-account", payload);
    if (resource.status === "joined" || resource.status === "monitoring") {
      const url = resource.username ? `@${resource.username}` : resource.telegram_id;
      this.ipcService.send("add-group", {
        url,
        keywordSetIds
      });
    }
  }
  // 打開監控設置（已加入的群組）
  openMonitorSettings(resource) {
    this.openJoinAndMonitorDialog(resource);
  }
  // ==================== 批量加入並監控 ====================
  // 打開批量加入並監控對話框
  openBatchJoinMonitorDialog() {
    const selectedIds = this.selectedResourceIds();
    if (selectedIds.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");
      return;
    }
    const resources = this.discoveredResources().filter((r) => selectedIds.includes(r.id));
    this.batchJoinResources.set(resources);
    this.joinMonitorSelectedPhones.set([]);
    this.joinMonitorKeywords.set([]);
    this.joinMonitorSelectedKeywordSetIds.set([]);
    this.joinMonitorBatchMode.set(true);
    this.joinMonitorBatchInterval.set(45);
    this.loadAccountQuotas();
    this.showBatchJoinMonitorDialog.set(true);
  }
  // 計算批量加入群組的總成員數
  getBatchJoinTotalMembers() {
    return this.batchJoinResources().reduce((sum, r) => sum + (r.member_count || 0), 0);
  }
  // 關閉批量加入對話框
  closeBatchJoinMonitorDialog() {
    this.showBatchJoinMonitorDialog.set(false);
    this.batchJoinResources.set([]);
  }
  // 切換帳號選擇（多選）
  toggleAccountSelection(phone) {
    const current = this.joinMonitorSelectedPhones();
    if (current.includes(phone)) {
      this.joinMonitorSelectedPhones.set(current.filter((p) => p !== phone));
    } else {
      this.joinMonitorSelectedPhones.set([...current, phone]);
    }
  }
  // 全選帳號
  selectAllAccounts() {
    const allPhones = this.accountQuotas().map((a) => a.phone);
    this.joinMonitorSelectedPhones.set(allPhones);
  }
  // 執行批量加入並監控
  executeBatchJoinMonitor() {
    const resources = this.batchJoinResources();
    const phones = this.joinMonitorSelectedPhones();
    if (resources.length === 0) {
      this.toastService.error("\u6C92\u6709\u9078\u64C7\u7FA4\u7D44");
      return;
    }
    if (phones.length === 0) {
      this.toastService.error("\u8ACB\u9078\u64C7\u81F3\u5C11\u4E00\u500B\u5E33\u865F");
      return;
    }
    this.isJoiningResource.set(true);
    this.batchJoinProgress.set({ current: 0, total: resources.length, status: "\u6E96\u5099\u4E2D..." });
    const keywordSetIds = this.joinMonitorSelectedKeywordSetIds();
    this.ipcService.send("batch-join-and-monitor", {
      resourceIds: resources.map((r) => r.id),
      phones,
      keywordSetIds,
      // 新版：關鍵詞集 IDs
      keywords: this.joinMonitorKeywords(),
      // 保留向後兼容
      autoEnableMonitor: this.joinMonitorAutoEnable(),
      batchMode: this.joinMonitorBatchMode(),
      batchInterval: this.joinMonitorBatchInterval()
    });
    this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u52A0\u5165 ${resources.length} \u500B\u7FA4\u7D44\uFF0C\u4F7F\u7528 ${phones.length} \u500B\u5E33\u865F`);
  }
  // ==================== 成員列表對話框 ====================
  // 打開成員列表對話框
  openMemberListDialog(resource) {
    this.memberListResource.set(resource);
    this.memberListData.set([]);
    this.memberListLoading.set(false);
    this.memberListProgress.set({ extracted: 0, total: resource.member_count || 0, status: "" });
    this.selectedMemberIds.set([]);
    this.memberExtractStarted.set(false);
    this.memberListFilter.set("all");
    this.memberExtractConfig.set({
      limit: 500,
      customLimit: 1e3,
      backgroundMode: false,
      userTypes: {
        chinese: false,
        overseas: false
      },
      activityFilters: {
        onlineNow: false,
        within3Days: false,
        within7Days: false,
        within30Days: false,
        longOffline: false
      },
      accountFeatures: {
        premium: false,
        hasUsername: false,
        hasPhoto: false,
        newAccount: false,
        activeAccount: false,
        verified: false
      },
      excludeFilters: {
        bots: true,
        scam: true,
        deleted: true
      }
    });
    this.showMemberListDialog.set(true);
  }
  // 關閉成員列表對話框
  closeMemberListDialog() {
    this.showMemberListDialog.set(false);
    this.memberListResource.set(null);
    this.memberListData.set([]);
  }
  // 加載成員列表
  loadMemberList(resource) {
    if (!resource || !resource.telegram_id) {
      this.toastService.error("\u7121\u6548\u7684\u7FA4\u7D44\u4FE1\u606F");
      return;
    }
    this.memberListLoading.set(true);
    this.memberListProgress.update((p) => __spreadProps(__spreadValues({}, p), { status: "\u6B63\u5728\u63D0\u53D6\u6210\u54E1..." }));
    this.ipcService.send("extract-members", {
      resourceId: resource.id,
      telegramId: resource.telegram_id,
      username: resource.username,
      // 🔧 FIX: 傳遞已加入群組的帳號
      phone: resource.joined_phone || resource.joined_by_phone || null,
      limit: 200,
      // 首次加載 200 個
      offset: 0
    });
  }
  // 繼續提取更多成員
  extractMoreMembers() {
    const resource = this.memberListResource();
    const currentCount = this.memberListData().length;
    if (!resource)
      return;
    this.memberListLoading.set(true);
    this.memberListProgress.update((p) => __spreadProps(__spreadValues({}, p), { status: "\u6B63\u5728\u63D0\u53D6\u66F4\u591A\u6210\u54E1..." }));
    this.ipcService.send("extract-members", {
      resourceId: resource.id,
      telegramId: resource.telegram_id,
      username: resource.username,
      // 🔧 FIX: 傳遞已加入群組的帳號
      phone: resource.joined_phone || resource.joined_by_phone || null,
      limit: 200,
      offset: currentCount
    });
  }
  // 切換成員選擇
  toggleMemberIdSelection(memberId) {
    const current = this.selectedMemberIds();
    if (current.includes(memberId)) {
      this.selectedMemberIds.set(current.filter((id) => id !== memberId));
    } else {
      this.selectedMemberIds.set([...current, memberId]);
    }
  }
  // 全選成員
  selectAllMembers() {
    const allIds = this.memberListData().map((m) => m.user_id);
    this.selectedMemberIds.set(allIds);
  }
  // 導出成員為 CSV（包含所有欄位）
  exportMembersToCSV() {
    const members = this.getFilteredMembers();
    if (members.length === 0) {
      this.toastService.warning("\u6C92\u6709\u53EF\u5C0E\u51FA\u7684\u6210\u54E1");
      return;
    }
    const resource = this.memberListResource();
    const filename = `members_${resource?.username || resource?.telegram_id}_${(/* @__PURE__ */ new Date()).toISOString().slice(0, 10)}.csv`;
    const headers = [
      "\u7528\u6236ID",
      "\u7528\u6236\u540D",
      "\u540D\u5B57",
      "\u59D3\u6C0F",
      "\u5168\u540D",
      "\u96FB\u8A71\u865F\u78BC",
      "\u500B\u4EBA\u7C21\u4ECB",
      "\u8A9E\u8A00",
      "DC",
      "\u5728\u7DDA\u72C0\u614B",
      "\u6700\u5F8C\u4E0A\u7DDA",
      "\u89D2\u8272",
      "\u52A0\u5165\u65E5\u671F",
      "Premium",
      "\u5DF2\u8A8D\u8B49",
      "Bot",
      "\u6709\u982D\u50CF",
      "\u8A50\u9A19",
      "\u5047\u5E33\u865F",
      "\u53D7\u9650\u5236",
      "\u5DF2\u522A\u9664",
      "\u83EF\u4EBA",
      "\u6D3B\u8E8D\u5EA6",
      "\u50F9\u503C\u7B49\u7D1A",
      "\u4F86\u6E90\u7FA4\u7D44",
      "\u63D0\u53D6\u6642\u9593"
    ];
    const escapeCSV = (val) => {
      if (val === null || val === void 0)
        return "";
      const str = String(val);
      if (str.includes(",") || str.includes('"') || str.includes("\n")) {
        return `"${str.replace(/"/g, '""')}"`;
      }
      return str;
    };
    const rows = members.map((m) => [
      m.user_id,
      m.username || "",
      m.first_name || "",
      m.last_name || "",
      m.full_name || `${m.first_name || ""} ${m.last_name || ""}`.trim(),
      m.phone || "",
      escapeCSV(m.bio || ""),
      m.language_code || "",
      m.dc_id || "",
      m.online_status || "",
      m.last_online || "",
      m.chat_member_status || "member",
      m.joined_date || "",
      m.is_premium ? "\u662F" : "\u5426",
      m.is_verified ? "\u662F" : "\u5426",
      m.is_bot ? "\u662F" : "\u5426",
      m.has_photo ? "\u662F" : "\u5426",
      m.is_scam ? "\u662F" : "\u5426",
      m.is_fake ? "\u662F" : "\u5426",
      m.is_restricted ? "\u662F" : "\u5426",
      m.is_deleted ? "\u662F" : "\u5426",
      this.isChineseMember(m) ? "\u662F" : "\u5426",
      m.activity_score ? (m.activity_score * 100).toFixed(0) + "%" : "",
      m.value_level || "",
      m.source_chat_title || "",
      m.extracted_at || ""
    ]);
    const csv = [headers, ...rows].map((row) => row.map(escapeCSV).join(",")).join("\n");
    const blob = new Blob(["\uFEFF" + csv], { type: "text/csv;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
    this.toastService.success(`\u2705 \u5DF2\u5C0E\u51FA ${members.length} \u500B\u6210\u54E1`);
  }
  // 設置提取數量限制
  setMemberExtractLimit(limit) {
    this.memberExtractConfig.update((c) => __spreadProps(__spreadValues({}, c), { limit }));
  }
  // 🆕 應用快捷預設
  applyExtractPreset(presetId) {
    this.selectedPreset.set(presetId);
    const preset = this.extractPresets.find((p) => p.id === presetId);
    if (!preset)
      return;
    this.memberExtractConfig.update((c) => __spreadProps(__spreadValues({}, c), {
      userTypes: { chinese: false, overseas: false },
      activityFilters: { onlineNow: false, within3Days: false, within7Days: false, within30Days: false, longOffline: false },
      accountFeatures: { premium: false, hasUsername: false, hasPhoto: false, newAccount: false, activeAccount: false, verified: false }
    }));
    if (preset.config.userTypes) {
      this.memberExtractConfig.update((c) => __spreadProps(__spreadValues({}, c), {
        userTypes: __spreadValues(__spreadValues({}, c.userTypes), preset.config.userTypes)
      }));
    }
    if (preset.config.activityFilters) {
      this.memberExtractConfig.update((c) => __spreadProps(__spreadValues({}, c), {
        activityFilters: __spreadValues(__spreadValues({}, c.activityFilters), preset.config.activityFilters)
      }));
    }
    if (preset.config.accountFeatures) {
      this.memberExtractConfig.update((c) => __spreadProps(__spreadValues({}, c), {
        accountFeatures: __spreadValues(__spreadValues({}, c.accountFeatures), preset.config.accountFeatures)
      }));
    }
    this.toastService.info(`\u5DF2\u61C9\u7528\u300C${preset.name}\u300D\u9810\u8A2D`);
  }
  // 🆕 切換用戶類型篩選
  toggleUserType(type) {
    this.selectedPreset.set("");
    this.memberExtractConfig.update((c) => __spreadProps(__spreadValues({}, c), {
      userTypes: __spreadProps(__spreadValues({}, c.userTypes), { [type]: !c.userTypes[type] })
    }));
  }
  // 🆕 切換活躍度篩選
  toggleActivityFilter(filter) {
    this.selectedPreset.set("");
    this.memberExtractConfig.update((c) => __spreadProps(__spreadValues({}, c), {
      activityFilters: __spreadProps(__spreadValues({}, c.activityFilters), { [filter]: !c.activityFilters[filter] })
    }));
  }
  // 🆕 切換帳號特徵篩選
  toggleAccountFeature(feature) {
    this.selectedPreset.set("");
    this.memberExtractConfig.update((c) => __spreadProps(__spreadValues({}, c), {
      accountFeatures: __spreadProps(__spreadValues({}, c.accountFeatures), { [feature]: !c.accountFeatures[feature] })
    }));
  }
  // 🆕 切換排除項
  toggleExcludeFilter(filter) {
    this.memberExtractConfig.update((c) => __spreadProps(__spreadValues({}, c), {
      excludeFilters: __spreadProps(__spreadValues({}, c.excludeFilters), { [filter]: !c.excludeFilters[filter] })
    }));
  }
  // 🆕 獲取當前篩選條件數量
  getActiveFilterCount() {
    const config = this.memberExtractConfig();
    let count = 0;
    Object.values(config.userTypes).forEach((v) => v && count++);
    Object.values(config.activityFilters).forEach((v) => v && count++);
    Object.values(config.accountFeatures).forEach((v) => v && count++);
    return count;
  }
  // 🆕 清除所有篩選
  clearAllFilters() {
    this.selectedPreset.set("");
    this.memberExtractConfig.update((c) => __spreadProps(__spreadValues({}, c), {
      userTypes: { chinese: false, overseas: false },
      activityFilters: { onlineNow: false, within3Days: false, within7Days: false, within30Days: false, longOffline: false },
      accountFeatures: { premium: false, hasUsername: false, hasPhoto: false, newAccount: false, activeAccount: false, verified: false }
    }));
    this.toastService.info("\u5DF2\u6E05\u9664\u6240\u6709\u7BE9\u9078\u689D\u4EF6");
  }
  // 開始成員提取
  startMemberExtraction() {
    console.log("[Frontend] startMemberExtraction called");
    const resource = this.memberListResource();
    console.log("[Frontend] Resource:", resource);
    if (!resource) {
      console.error("[Frontend] No resource selected");
      this.toastService.error("\u8ACB\u5148\u9078\u64C7\u4E00\u500B\u7FA4\u7D44");
      return;
    }
    this.memberExtractStarted.set(true);
    this.memberListLoading.set(true);
    this.memberListData.set([]);
    this.extractionStartTime.set(Date.now());
    const config = this.memberExtractConfig();
    const limit = config.limit === -1 ? config.customLimit : config.limit === 0 ? 99999 : config.limit;
    console.log("[Frontend] Extraction config:", { limit, config });
    this.memberListProgress.set({
      extracted: 0,
      total: resource.member_count || 0,
      status: "\u6B63\u5728\u63D0\u53D6\u6210\u54E1..."
    });
    const payload = {
      resourceId: resource.id,
      telegramId: resource.telegram_id,
      username: resource.username,
      // 🔧 FIX: 傳遞已加入群組的帳號
      phone: resource.joined_phone || resource.joined_by_phone || null,
      limit,
      offset: 0,
      filters: {
        onlineOnly: config.activityFilters.onlineNow,
        chineseOnly: config.userTypes.chinese,
        premiumOnly: config.accountFeatures.premium,
        hasUsername: config.accountFeatures.hasUsername,
        excludeBots: config.excludeFilters.bots
      }
    };
    console.log("[Frontend] Sending extract-members IPC:", payload);
    this.toastService.info("\u{1F4E4} \u6B63\u5728\u767C\u9001\u63D0\u53D6\u8ACB\u6C42...");
    this.ipcService.send("extract-members", payload);
    if (config.backgroundMode) {
      this.toastService.info("\u{1F4E4} \u6210\u54E1\u63D0\u53D6\u5DF2\u8F49\u70BA\u5F8C\u53F0\u904B\u884C");
      this.closeMemberListDialog();
    }
  }
  // 暫停成員提取
  pauseMemberExtraction() {
    this.memberListLoading.set(false);
    this.memberListProgress.update((p) => __spreadProps(__spreadValues({}, p), { status: "\u5DF2\u66AB\u505C" }));
    this.toastService.info("\u23F8\uFE0F \u6210\u54E1\u63D0\u53D6\u5DF2\u66AB\u505C");
  }
  // 停止成員提取
  stopMemberExtraction() {
    this.memberListLoading.set(false);
    this.memberListProgress.update((p) => __spreadProps(__spreadValues({}, p), { status: "\u5DF2\u505C\u6B62" }));
    this.toastService.info("\u23F9\uFE0F \u6210\u54E1\u63D0\u53D6\u5DF2\u505C\u6B62");
  }
  // 切換後台運行
  toggleMemberExtractBackground() {
    this.toastService.info("\u{1F4E4} \u6210\u54E1\u63D0\u53D6\u5DF2\u8F49\u70BA\u5F8C\u53F0\u904B\u884C\uFF0C\u5B8C\u6210\u5F8C\u6703\u901A\u77E5\u60A8");
    this.closeMemberListDialog();
  }
  // 處理成員提取錯誤
  handleMemberExtractionError(data) {
    const errorCode = data.error_code || "UNKNOWN";
    const details = data.error_details || {};
    this.memberListProgress.update((p) => __spreadProps(__spreadValues({}, p), { status: "\u63D0\u53D6\u5931\u6557" }));
    switch (errorCode) {
      case "PEER_ID_INVALID":
      case "NOT_PARTICIPANT":
      case "CHANNEL_PRIVATE":
        const attempts = details.attempts || 0;
        const hasRetried = attempts > 1;
        if (hasRetried) {
          this.showExtractionErrorWithAction(
            "\u26A0\uFE0F \u7FA4\u7D44\u540C\u6B65\u672A\u5B8C\u6210",
            details.reason || `\u5DF2\u5617\u8A66 ${attempts} \u6B21\uFF0CTelegram \u670D\u52D9\u5668\u5C1A\u672A\u540C\u6B65`,
            details.suggestion || "\u8ACB\u7B49\u5F85 30 \u79D2\u5F8C\u518D\u8A66\uFF0C\u6216\u91CD\u65B0\u52A0\u5165\u7FA4\u7D44",
            void 0
            // 不提供自動加入，因為可能已經加入了
          );
        } else {
          this.showExtractionErrorWithAction("\u26A0\uFE0F \u7121\u6CD5\u63D0\u53D6\u6210\u54E1", details.reason || "\u5E33\u865F\u5C1A\u672A\u52A0\u5165\u6B64\u7FA4\u7D44", details.suggestion || "\u8ACB\u5148\u52A0\u5165\u7FA4\u7D44\u518D\u5617\u8A66\u63D0\u53D6", details.can_auto_join ? "join" : void 0);
        }
        break;
      case "ADMIN_REQUIRED":
        this.showExtractionErrorWithAction("\u{1F512} \u6210\u54E1\u5217\u8868\u53D7\u9650", details.reason || "\u7FA4\u7D44\u8A2D\u7F6E\u9650\u5236\u4E86\u6210\u54E1\u5217\u8868\u8A2A\u554F", details.suggestion || "\u53EF\u5617\u8A66\u76E3\u63A7\u7FA4\u7D44\u6D88\u606F\u6536\u96C6\u6D3B\u8E8D\u7528\u6236", details.alternative === "monitor_messages" ? "monitor" : void 0);
        break;
      case "FLOOD_WAIT":
        this.toastService.warning(`\u23F3 ${data.error}

${details.suggestion || "\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}`);
        break;
      case "CHANNEL_INVALID":
        this.toastService.error(`\u274C ${data.error}

${details.suggestion || "\u8ACB\u5237\u65B0\u8CC7\u6E90\u5217\u8868"}`);
        break;
      default:
        this.toastService.error(`\u274C \u63D0\u53D6\u5931\u6557: ${data.error}`);
    }
  }
  // 顯示帶有操作按鈕的錯誤提示
  showExtractionErrorWithAction(title, reason, suggestion, action) {
    const resource = this.memberListResource();
    let message = `${title}

\u539F\u56E0\uFF1A${reason}

\u{1F4A1} ${suggestion}`;
    if (action === "join" && resource) {
      message += "\n\n\u9EDE\u64CA\u300C\u52A0\u5165\u7FA4\u7D44\u300D\u6309\u9215\u5F8C\u91CD\u8A66";
      this.toastService.warning(message);
      this.memberListProgress.update((p) => __spreadProps(__spreadValues({}, p), {
        status: "\u9700\u8981\u5148\u52A0\u5165\u7FA4\u7D44"
      }));
    } else if (action === "monitor" && resource) {
      message += "\n\n\u5EFA\u8B70\uFF1A\u555F\u52D5\u6D88\u606F\u76E3\u63A7\u4F86\u6536\u96C6\u6D3B\u8E8D\u7528\u6236";
      this.toastService.warning(message);
      this.memberListProgress.update((p) => __spreadProps(__spreadValues({}, p), {
        status: "\u5EFA\u8B70\u4F7F\u7528\u6D88\u606F\u76E3\u63A7"
      }));
    } else {
      this.toastService.error(message);
    }
  }
  // 嘗試自動加入群組並重新提取
  async autoJoinAndExtract() {
    const resource = this.memberListResource();
    if (!resource)
      return;
    this.toastService.info("\u{1F680} \u6B63\u5728\u5617\u8A66\u52A0\u5165\u7FA4\u7D44...");
    const firstAccount = this.accounts().find((a) => a.status === "Online");
    if (firstAccount) {
      this.ipcService.send("join-group", {
        phone: firstAccount.phone,
        groupUrl: resource.username ? `https://t.me/${resource.username}` : resource.invite_link
      });
      this.ipcService.once("group-join-result", (result) => {
        if (result.success) {
          this.toastService.success("\u2705 \u6210\u529F\u52A0\u5165\u7FA4\u7D44\uFF0C\u6B63\u5728\u91CD\u65B0\u63D0\u53D6...");
          setTimeout(() => {
            this.startMemberExtraction();
          }, 2e3);
        } else {
          this.toastService.error(`\u274C \u52A0\u5165\u7FA4\u7D44\u5931\u6557: ${result.error}`);
        }
      });
    } else {
      this.toastService.error("\u6C92\u6709\u53EF\u7528\u7684\u5728\u7DDA\u5E33\u865F");
    }
  }
  // 獲取第一個在線帳號
  getFirstOnlineAccount() {
    return this.accounts().find((a) => a.status === "Online");
  }
  // 🆕 計算並顯示提取結果摘要
  calculateAndShowExtractionSummary(members) {
    const resource = this.memberListResource();
    const startTime = this.extractionStartTime();
    const duration = startTime > 0 ? Math.round((Date.now() - startTime) / 1e3) : 0;
    let onlineCount = 0;
    let recentlyCount = 0;
    let premiumCount = 0;
    let chineseCount = 0;
    let hasUsernameCount = 0;
    let botCount = 0;
    const valueLevelDistribution = { S: 0, A: 0, B: 0, C: 0, D: 0 };
    for (const member of members) {
      if (member.online_status === "online") {
        onlineCount++;
      } else if (member.online_status === "recently") {
        recentlyCount++;
      }
      if (member.is_premium) {
        premiumCount++;
      }
      if (this.isChineseMember(member)) {
        chineseCount++;
      }
      if (member.username) {
        hasUsernameCount++;
      }
      if (member.is_bot) {
        botCount++;
      }
      const level = member.value_level || this.calculateMemberValueLevel(member);
      if (level && valueLevelDistribution.hasOwnProperty(level)) {
        valueLevelDistribution[level]++;
      }
    }
    this.extractionSummary.set({
      groupName: resource?.title || resource?.name || "\u672A\u77E5\u7FA4\u7D44",
      groupUrl: resource?.username ? `t.me/${resource.username}` : resource?.url || "",
      totalExtracted: members.length,
      totalInGroup: resource?.member_count || 0,
      onlineCount,
      recentlyCount,
      premiumCount,
      chineseCount,
      hasUsernameCount,
      botCount,
      valueLevelDistribution,
      extractedAt: (/* @__PURE__ */ new Date()).toLocaleString("zh-TW"),
      duration
    });
    this.showExtractionSummaryDialog.set(true);
    this.toastService.success(`\u2705 \u6210\u529F\u63D0\u53D6 ${members.length} \u500B\u6210\u54E1`);
  }
  // 🆕 計算成員價值評級
  calculateMemberValueLevel(member) {
    let score = 0;
    if (member.is_premium)
      score += 30;
    if (member.online_status === "online")
      score += 25;
    else if (member.online_status === "recently")
      score += 20;
    else if (member.online_status === "last_week")
      score += 10;
    if (member.username)
      score += 15;
    if (this.isChineseMember(member))
      score += 10;
    if (member.is_bot)
      score -= 50;
    if (member.activity_score) {
      score += Math.min(member.activity_score, 20);
    }
    if (score >= 70)
      return "S";
    if (score >= 50)
      return "A";
    if (score >= 30)
      return "B";
    if (score >= 10)
      return "C";
    return "D";
  }
  // 🆕 關閉提取結果摘要對話框
  closeExtractionSummaryDialog() {
    this.showExtractionSummaryDialog.set(false);
  }
  // 🆕 從摘要頁面跳轉到成員資料庫
  goToMemberDatabaseFromSummary() {
    this.closeExtractionSummaryDialog();
    this.closeMemberListDialog();
    this.currentView.set("member-database");
  }
  // 🆕 從摘要頁面發起批量營銷
  startBatchMarketingFromSummary() {
    this.closeExtractionSummaryDialog();
    this.toastService.info("\u{1F4A1} \u8ACB\u5728\u6210\u54E1\u5217\u8868\u4E2D\u9078\u64C7\u8981\u71DF\u92B7\u7684\u7528\u6236\uFF0C\u7136\u5F8C\u9EDE\u64CA\u300C\u6279\u91CF\u767C\u9001\u300D");
  }
  // 🆕 獲取價值等級的百分比
  getValueLevelPercent(level) {
    const summary = this.extractionSummary();
    const total = summary.totalExtracted;
    if (total === 0)
      return 0;
    const count = summary.valueLevelDistribution[level] || 0;
    return Math.round(count / total * 100);
  }
  // 設置成員列表篩選
  setMemberFilter(filter) {
    this.memberListFilter.set(filter);
  }
  // 獲取篩選後的成員列表
  getFilteredMembers() {
    const members = this.memberListData();
    const filter = this.memberListFilter();
    switch (filter) {
      case "chinese":
        return members.filter((m) => this.isChineseMember(m));
      case "online":
        return members.filter((m) => m.online_status === "online" || m.online_status === "recently");
      case "premium":
        return members.filter((m) => m.is_premium);
      case "hasUsername":
        return members.filter((m) => !!m.username);
      default:
        return members;
    }
  }
  // 判斷是否為華人用戶（中文字符檢測）
  isChineseMember(member) {
    const chineseRegex = /[\u4e00-\u9fa5]/;
    const name = (member.first_name || "") + (member.last_name || "");
    return chineseRegex.test(name);
  }
  // 獲取華人成員數量
  getChineseMemberCount() {
    return this.memberListData().filter((m) => this.isChineseMember(m)).length;
  }
  // 獲取在線成員數量
  getOnlineMemberCount() {
    return this.memberListData().filter((m) => m.online_status === "online" || m.online_status === "recently").length;
  }
  // 獲取 Premium 成員數量
  getPremiumMemberCount() {
    return this.memberListData().filter((m) => m.is_premium).length;
  }
  // 獲取提取進度百分比
  getMemberExtractPercent() {
    const progress = this.memberListProgress();
    if (progress.total === 0)
      return 0;
    return Math.min(100, Math.round(this.memberListData().length / progress.total * 100));
  }
  // 是否全選成員
  isAllMembersSelected() {
    const filtered = this.getFilteredMembers();
    return filtered.length > 0 && filtered.every((m) => this.selectedMemberIds().includes(m.user_id));
  }
  // 切換全選成員（成員列表對話框用）
  toggleSelectAllMembersList() {
    const filtered = this.getFilteredMembers();
    if (this.isAllMembersSelected()) {
      this.selectedMemberIds.set([]);
    } else {
      this.selectedMemberIds.set(filtered.map((m) => m.user_id));
    }
  }
  // 發送私信
  sendPrivateMessage(member) {
    if (!member.username) {
      this.toastService.warning("\u8A72\u7528\u6236\u6C92\u6709\u7528\u6236\u540D\uFF0C\u7121\u6CD5\u767C\u9001\u79C1\u4FE1");
      return;
    }
    this.toastService.info(`\u{1F4E8} \u6E96\u5099\u767C\u9001\u79C1\u4FE1\u7D66 @${member.username}`);
  }
  // 批量發送私信
  batchSendPrivateMessage() {
    const count = this.selectedMemberIds().length;
    this.toastService.info(`\u{1F4E8} \u6E96\u5099\u6279\u91CF\u767C\u9001\u79C1\u4FE1\u7D66 ${count} \u500B\u6210\u54E1`);
  }
  // 批量添加好友
  batchAddFriend() {
    const count = this.selectedMemberIds().length;
    this.toastService.info(`\u2795 \u6E96\u5099\u6279\u91CF\u6DFB\u52A0 ${count} \u500B\u597D\u53CB`);
  }
  // 🆕 將成員加入營銷漏斗
  addMemberToFunnel(member) {
    const leadData = {
      userId: member.user_id,
      username: member.username || "",
      firstName: member.first_name || "",
      lastName: member.last_name || "",
      sourceGroup: this.memberListResource()?.title || "",
      triggeredKeyword: "\u624B\u52D5\u6DFB\u52A0",
      onlineStatus: member.online_status || "unknown"
    };
    this.ipcService.send("add-lead", leadData);
    this.toastService.success(`\u{1F3AF} \u5DF2\u5C07 ${member.first_name || member.username || "ID:" + member.user_id} \u52A0\u5165\u71DF\u92B7\u6F0F\u6597`);
  }
  // 🆕 批量加入漏斗
  batchAddToFunnel() {
    const selectedIds = this.selectedMemberIds();
    const members = this.memberListData().filter((m) => selectedIds.includes(m.user_id));
    if (members.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");
      return;
    }
    let count = 0;
    for (const member of members) {
      const leadData = {
        userId: member.user_id,
        username: member.username || "",
        firstName: member.first_name || "",
        lastName: member.last_name || "",
        sourceGroup: this.memberListResource()?.title || "",
        triggeredKeyword: "\u6279\u91CF\u6DFB\u52A0",
        onlineStatus: member.online_status || "unknown"
      };
      this.ipcService.send("add-lead", leadData);
      count++;
    }
    this.toastService.success(`\u{1F3AF} \u5DF2\u5C07 ${count} \u500B\u6210\u54E1\u52A0\u5165\u71DF\u92B7\u6F0F\u6597`);
    this.clearMemberSelection();
  }
  // 🆕 清除成員選擇
  clearMemberSelection() {
    this.selectedMemberIds.set([]);
  }
  // 🆕 導出選中的成員
  exportSelectedMembersToCSV() {
    const selectedIds = this.selectedMemberIds();
    const members = this.memberListData().filter((m) => selectedIds.includes(m.user_id));
    if (members.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");
      return;
    }
    const headers = ["\u7528\u6236ID", "\u7528\u6236\u540D", "\u540D\u5B57", "\u59D3\u6C0F", "\u8A55\u7D1A", "\u5728\u7DDA\u72C0\u614B", "Premium", "\u4F86\u6E90\u7FA4\u7D44"];
    const rows = members.map((m) => [
      m.user_id,
      m.username || "",
      m.first_name || "",
      m.last_name || "",
      this.calculateMemberValueLevel(m),
      m.online_status || "unknown",
      m.is_premium ? "\u662F" : "\u5426",
      this.memberListResource()?.title || ""
    ]);
    const csv = [headers.join(","), ...rows.map((r) => r.join(","))].join("\n");
    const blob = new Blob(["\uFEFF" + csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `selected-members-${(/* @__PURE__ */ new Date()).toISOString().split("T")[0]}.csv`;
    link.click();
    this.toastService.success(`\u{1F4E5} \u5DF2\u5C0E\u51FA ${members.length} \u500B\u6210\u54E1`);
  }
  // 🆕 選擇高價值成員（S/A 級）
  selectHighValueMembers() {
    const members = this.memberListData();
    const highValueIds = members.filter((m) => {
      const level = this.calculateMemberValueLevel(m);
      return level === "S" || level === "A";
    }).map((m) => m.user_id);
    this.selectedMemberIds.set(highValueIds);
    this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${highValueIds.length} \u500B S/A \u7D1A\u6210\u54E1`);
  }
  // 🆕 選擇在線成員
  selectOnlineMembers() {
    const members = this.memberListData();
    const onlineIds = members.filter((m) => m.online_status === "online" || m.online_status === "recently").map((m) => m.user_id);
    this.selectedMemberIds.set(onlineIds);
    this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${onlineIds.length} \u500B\u5728\u7DDA/\u6700\u8FD1\u6D3B\u8E8D\u6210\u54E1`);
  }
  // 🆕 選擇所有成員
  selectAllMembersInList() {
    const filtered = this.getFilteredMembers();
    this.selectedMemberIds.set(filtered.map((m) => m.user_id));
    this.toastService.info(`\u2713 \u5DF2\u9078\u64C7 ${filtered.length} \u500B\u6210\u54E1`);
  }
  // 批量提取成員（多個群組）
  openBatchMemberExtractDialog() {
    const selectedIds = this.selectedResourceIds();
    if (selectedIds.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7FA4\u7D44");
      return;
    }
    this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u63D0\u53D6 ${selectedIds.length} \u500B\u7FA4\u7D44\u7684\u6210\u54E1`);
    this.ipcService.send("batch-extract-members", {
      resourceIds: selectedIds,
      limit: 100,
      // 每個群組提取 100 個
      safeMode: true
      // 安全模式：分批分時提取
    });
  }
  // ==================== 單個群組發消息 ====================
  // 打開單個群組發消息對話框
  openSingleMessageDialog(resource) {
    this.singleMessageResource.set(resource);
    this.singleMessageContent = "";
    this.singleMessageScheduled.set(false);
    this.singleMessageScheduleTime = "";
    this.singleMessageAccountId.set("");
    this.loadAccountQuotas();
    this.showSingleMessageDialog.set(true);
  }
  // 關閉單個群組發消息對話框
  closeSingleMessageDialog() {
    this.showSingleMessageDialog.set(false);
    this.singleMessageResource.set(null);
  }
  // 發送單個群組消息
  executeSingleMessage() {
    const resource = this.singleMessageResource();
    const content = this.singleMessageContent.trim();
    if (!resource) {
      this.toastService.error("\u7121\u6548\u7684\u7FA4\u7D44");
      return;
    }
    if (!content) {
      this.toastService.error("\u8ACB\u8F38\u5165\u6D88\u606F\u5167\u5BB9");
      return;
    }
    const accountId = this.singleMessageAccountId();
    if (!accountId) {
      this.toastService.error("\u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F");
      return;
    }
    if (this.singleMessageScheduled() && this.singleMessageScheduleTime) {
      this.ipcService.send("schedule-message", {
        resourceId: resource.id,
        telegramId: resource.telegram_id,
        content,
        accountPhone: accountId,
        scheduledTime: this.singleMessageScheduleTime
      });
      this.toastService.success(`\u23F0 \u6D88\u606F\u5DF2\u6392\u7A0B\uFF0C\u5C07\u65BC ${this.singleMessageScheduleTime} \u767C\u9001`);
    } else {
      this.ipcService.send("send-group-message", {
        resourceId: resource.id,
        telegramId: resource.telegram_id,
        content,
        accountPhone: accountId
      });
      this.toastService.info("\u{1F4E8} \u6B63\u5728\u767C\u9001\u6D88\u606F...");
    }
    this.closeSingleMessageDialog();
  }
  // 刷新全部資源數據
  refreshAllResources() {
    this.isRefreshing.set(true);
    this.toastService.info("\u6B63\u5728\u5237\u65B0\u8CC7\u6E90\u6578\u64DA...");
    this.refreshResourceStats();
    this.loadResources();
    this.loadDiscoveryKeywords();
    setTimeout(() => {
      this.isRefreshing.set(false);
      this.toastService.success("\u5237\u65B0\u5B8C\u6210");
    }, 2e3);
  }
  // 清空搜索結果（清空前端顯示 + 刪除數據庫中的所有資源）
  clearSearchResults() {
    const resourceCount = this.discoveredResources().length;
    if (resourceCount === 0) {
      this.toastService.warning("\u6C92\u6709\u53EF\u6E05\u7A7A\u7684\u8CC7\u6E90");
      return;
    }
    if (!confirm(`\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709 ${resourceCount} \u689D\u641C\u7D22\u7D50\u679C\u55CE\uFF1F

\u6B64\u64CD\u4F5C\u5C07\u522A\u9664\u6578\u64DA\u5EAB\u4E2D\u7684\u6240\u6709\u8CC7\u6E90\u8A18\u9304\uFF0C\u4E0D\u53EF\u6062\u5FA9\u3002`)) {
      return;
    }
    this.ngZone.run(() => {
      this.ipcService.send("clear-all-resources", {});
      this.discoveredResources.set([]);
      this.selectedResourceIds.set([]);
      this.refreshResourceStats();
      this.cdr.detectChanges();
    });
  }
  // 刪除所有未處理的資源（從數據庫）
  deleteAllDiscoveredResources() {
    const discoveredIds = this.discoveredResources().filter((r) => r.status === "discovered").map((r) => r.id);
    if (discoveredIds.length === 0) {
      this.toastService.info("\u6C92\u6709\u53EF\u522A\u9664\u7684\u672A\u8655\u7406\u8CC7\u6E90");
      return;
    }
    if (confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6240\u6709\u672A\u8655\u7406\u7684\u8CC7\u6E90\u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u5FA9\u3002")) {
      this.ipcService.send("delete-resources-batch", { resourceIds: discoveredIds });
      this.toastService.success(`\u{1F5D1}\uFE0F \u5DF2\u522A\u9664 ${discoveredIds.length} \u500B\u8CC7\u6E90`);
      setTimeout(() => this.loadResources(), 500);
    }
  }
  /**
   * 清空當前搜索結果（僅前端）
   */
  clearDiscoveredResources() {
    this.discoveredResources.set([]);
    this.selectedResourceIds.set([]);
    this.currentSearchSessionId.set("");
    this.currentSearchKeyword.set("");
    this.toastService.info("\u5DF2\u6E05\u7A7A\u7576\u524D\u641C\u7D22\u7D50\u679C");
  }
  /**
   * 🆕 一鍵清理歷史數據
   */
  clearHistoryData(type = "all") {
    const typeNames = {
      "all": "\u6240\u6709\u8CC7\u6E90\u6578\u64DA",
      "old_data": "\u820A\u6578\u64DA",
      "search_history": "\u641C\u7D22\u6B77\u53F2\uFF08\u4FDD\u7559\u6536\u85CF\uFF09"
    };
    if (confirm(`\u78BA\u5B9A\u8981\u6E05\u7406 ${typeNames[type]} \u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u5FA9\u3002`)) {
      this.toastService.info("\u{1F9F9} \u6B63\u5728\u6E05\u7406...");
      this.ipcService.send("clear-resources", {
        type,
        daysToKeep: type === "old_data" ? 7 : 0
      });
    }
  }
  /**
   * 清空所有搜索歷史（前端 + 數據庫）
   */
  clearAllSearchHistory() {
    if (confirm("\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u641C\u7D22\u6B77\u53F2\u55CE\uFF1F\u6B64\u64CD\u4F5C\u6703\u522A\u9664\u6578\u64DA\u5EAB\u4E2D\u7684\u6240\u6709\u641C\u7D22\u7D50\u679C\u3002")) {
      this.ipcService.send("clear-all-resources", {});
      this.discoveredResources.set([]);
      this.selectedResourceIds.set([]);
      this.searchHistoryKeywords.set([]);
      this.currentSearchSessionId.set("");
      this.currentSearchKeyword.set("");
      this.showSearchHistory.set(false);
      this.toastService.success("\u5DF2\u6E05\u7A7A\u6240\u6709\u641C\u7D22\u6B77\u53F2");
    }
  }
  /**
   * 切換顯示模式（當前搜索 / 歷史記錄）
   */
  toggleSearchHistoryMode() {
    const showHistory = !this.showSearchHistory();
    this.showSearchHistory.set(showHistory);
    if (showHistory) {
      this.loadResources();
      this.toastService.info("\u6B63\u5728\u8F09\u5165\u6B77\u53F2\u641C\u7D22\u7D50\u679C...");
    } else {
      if (!this.currentSearchKeyword()) {
        this.discoveredResources.set([]);
      }
    }
  }
  /**
   * 從歷史記錄中搜索
   */
  searchFromHistory(keyword) {
    this.resourceSearchQuery = keyword;
    this.showSearchHistory.set(false);
    this.searchResources();
  }
  /**
   * 🆕 處理搜索發現組件的搜索事件
   */
  handleSearchDiscoverySearch(event) {
    this.resourceSearchQuery = event.query;
    this.selectedSearchSources.set(event.sources);
    this.searchResources();
  }
  /**
   * 🆕 處理搜索發現組件的帳號選擇事件
   */
  handleSearchDiscoverySelectAccount(account) {
    this.selectResourceAccount(account.id);
  }
  /**
   * 🆕 处理引导组件的导航事件
   */
  handleOnboardingNavigate(target) {
    console.log("[Onboarding] \u5BFC\u822A\u5230:", target);
    this.changeView(target);
  }
  /**
   * 🆕 打开新手引导
   */
  openOnboarding() {
    if (this.onboardingComponent) {
      this.onboardingComponent.open();
    }
  }
  /**
   * 🆕 重置新手引导（清除历史记录）
   */
  resetOnboarding() {
    if (this.onboardingComponent) {
      this.onboardingComponent.reset();
      this.onboardingComponent.open();
    }
  }
  /**
   * 🆕 C方案：收藏資源（保存到數據庫）
   */
  saveResource(resource) {
    if (!resource.telegram_id) {
      this.toastService.error("\u7121\u6CD5\u6536\u85CF\uFF1A\u7F3A\u5C11\u8CC7\u6E90 ID");
      return;
    }
    this.ipcService.send("save-resource", {
      telegram_id: resource.telegram_id,
      username: resource.username,
      title: resource.title,
      description: resource.description,
      member_count: resource.member_count,
      resource_type: resource.resource_type,
      overall_score: resource.overall_score,
      discovery_keyword: this.currentSearchKeyword()
    });
    const saved = new Set(this.savedResources());
    saved.add(resource.telegram_id);
    this.savedResources.set(saved);
    const resources = this.discoveredResources();
    const updated = resources.map((r) => r.telegram_id === resource.telegram_id ? __spreadProps(__spreadValues({}, r), { is_saved: true }) : r);
    this.discoveredResources.set(updated);
    this.toastService.success(`\u2B50 \u5DF2\u6536\u85CF\u300C${resource.title}\u300D`);
  }
  /**
   * 🆕 C方案：取消收藏
   */
  unsaveResource(resource) {
    if (!resource.telegram_id)
      return;
    this.ipcService.send("unsave-resource", {
      telegram_id: resource.telegram_id
    });
    const saved = new Set(this.savedResources());
    saved.delete(resource.telegram_id);
    this.savedResources.set(saved);
    const resources = this.discoveredResources();
    const updated = resources.map((r) => r.telegram_id === resource.telegram_id ? __spreadProps(__spreadValues({}, r), { is_saved: false }) : r);
    this.discoveredResources.set(updated);
    this.toastService.info(`\u5DF2\u53D6\u6D88\u6536\u85CF\u300C${resource.title}\u300D`);
  }
  /**
   * 🆕 C方案：批量收藏選中的資源
   */
  batchSaveResources() {
    const selectedIds = this.selectedResourceIds();
    if (selectedIds.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u6536\u85CF\u7684\u8CC7\u6E90");
      return;
    }
    const resources = this.discoveredResources().filter((r) => selectedIds.includes(r.id) || selectedIds.some((id) => String(id) === r.telegram_id));
    resources.forEach((r) => this.saveResource(r));
    this.toastService.success(`\u2B50 \u5DF2\u6536\u85CF ${resources.length} \u500B\u8CC7\u6E90`);
  }
  /**
   * 🆕 C方案：檢查資源是否已收藏
   */
  isResourceSaved(resource) {
    return resource.is_saved || this.savedResources().has(resource.telegram_id);
  }
  /**
   * 同步聯繫人數據
   */
  syncContactsData() {
    this.contactsService.syncFromSources();
    this.toastService.info("\u6B63\u5728\u540C\u6B65\u6578\u64DA...", 2e3);
  }
  // 加入群組並添加到監控
  joinAndMonitor(resourceId) {
    const resource = this.discoveredResources().find((r) => r.id === resourceId);
    if (!resource) {
      this.toastService.error("\u627E\u4E0D\u5230\u8A72\u8CC7\u6E90");
      return;
    }
    this.toastService.info(`\u6B63\u5728\u52A0\u5165\u4E26\u76E3\u63A7: ${resource.title}`);
    this.ipcService.send("join-and-monitor-resource", {
      resourceId,
      username: resource.username,
      telegramId: resource.telegram_id,
      title: resource.title
    });
  }
  // 批量加入並監控
  batchJoinAndMonitor() {
    const selectedIds = this.selectedResourceIds();
    if (selectedIds.length === 0) {
      this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8981\u52A0\u5165\u7684\u7FA4\u7D44");
      return;
    }
    this.toastService.info(`\u6B63\u5728\u6279\u91CF\u52A0\u5165\u4E26\u76E3\u63A7 ${selectedIds.length} \u500B\u7FA4\u7D44...`);
    this.ipcService.send("batch-join-and-monitor", {
      resourceIds: selectedIds
    });
  }
  // 加載搜索關鍵詞
  loadDiscoveryKeywords() {
    this.ipcService.send("get-discovery-keywords", {});
  }
  // 添加搜索關鍵詞
  addDiscoveryKeyword() {
    if (!this.newResourceKeyword.trim()) {
      this.toastService.error("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E");
      return;
    }
    this.ipcService.send("add-discovery-keyword", {
      keyword: this.newResourceKeyword.trim(),
      category: "general",
      priority: 5
    });
  }
  // 使用關鍵詞搜索
  searchWithKeyword(keyword) {
    this.resourceSearchQuery = keyword;
    this.searchResources();
  }
  // 切換資源選擇
  toggleResourceSelection(resourceId) {
    const current = this.selectedResourceIds();
    if (current.includes(resourceId)) {
      this.selectedResourceIds.set(current.filter((id) => id !== resourceId));
    } else {
      this.selectedResourceIds.set([...current, resourceId]);
    }
  }
  // 全選/取消全選
  toggleSelectAllResources() {
    const resources = this.discoveredResources();
    const currentSelected = this.selectedResourceIds();
    if (currentSelected.length === resources.length) {
      this.selectedResourceIds.set([]);
    } else {
      this.selectedResourceIds.set(resources.map((r) => r.id));
    }
  }
  // 添加選中資源到加入隊列
  addSelectedToJoinQueue() {
    const ids = this.selectedResourceIds();
    if (ids.length === 0) {
      this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8CC7\u6E90");
      return;
    }
    this.ipcService.send("add-to-join-queue", {
      resourceIds: ids,
      priority: 5
    });
  }
  // 處理加入隊列
  processJoinQueue() {
    this.isProcessingJoinQueue.set(true);
    this.ipcService.send("process-join-queue", {
      limit: 5
    });
  }
  // 批量加入選中資源
  // 🔍 多渠道選擇方法（新增）
  toggleSearchSource(source) {
    const current = this.selectedSearchSources();
    if (current.includes(source)) {
      this.selectedSearchSources.set(current.filter((s) => s !== source));
    } else {
      this.selectedSearchSources.set([...current, source]);
    }
  }
  selectAllSearchSources() {
    this.selectedSearchSources.set(["telegram", "jiso", "tgstat", "local"]);
  }
  // 👥 進入群組（新增）
  enterGroup(resource) {
    this.changeView("resources");
    this.toastService.info(`\u6E96\u5099\u9032\u5165\u7FA4\u7D44\uFF1A${resource.title}`);
  }
  batchEnterGroups() {
    const ids = this.selectedResourceIds();
    if (ids.length === 0) {
      this.toastService.error("\u8ACB\u5148\u9078\u64C7\u7FA4\u7D44");
      return;
    }
    const resources = this.discoveredResources().filter((r) => ids.includes(r.id));
    this.toastService.info(`\u6E96\u5099\u9032\u5165 ${resources.length} \u500B\u7FA4\u7D44\u67E5\u770B\u6210\u54E1`);
  }
  // 📨 批量群發（新增）
  sendGroupMessage(resource) {
    this.selectedResourceIds.set([resource.id]);
    this.showBatchMessageDialog.set(true);
  }
  executeBatchMessage() {
    const ids = this.selectedResourceIds();
    if (ids.length === 0 || !this.batchMessageContent.trim()) {
      this.toastService.error("\u8ACB\u9078\u64C7\u7FA4\u7D44\u4E26\u8F38\u5165\u6D88\u606F\u5167\u5BB9");
      return;
    }
    const resources = this.discoveredResources().filter((r) => ids.includes(r.id));
    this.toastService.success(`\u958B\u59CB\u5411 ${resources.length} \u500B\u7FA4\u7D44\u767C\u9001\u6D88\u606F`);
    this.showBatchMessageDialog.set(false);
  }
  // ➕ 批量拉群（新增）
  inviteMembersToGroup(resource) {
    this.selectedResourceIds.set([resource.id]);
    this.loadAvailableMembers();
    this.showBatchInviteDialog.set(true);
  }
  executeBatchInvite() {
    const groupIds = this.selectedResourceIds();
    const memberIds = this.batchInviteConfig.selectedMemberIds;
    if (groupIds.length === 0 || memberIds.length === 0) {
      this.toastService.error("\u8ACB\u9078\u64C7\u7FA4\u7D44\u548C\u6210\u54E1");
      return;
    }
    this.toastService.success(`\u958B\u59CB\u9080\u8ACB ${memberIds.length} \u4F4D\u6210\u54E1\u52A0\u5165 ${groupIds.length} \u500B\u7FA4\u7D44`);
    this.showBatchInviteDialog.set(false);
  }
  loadAvailableMembers() {
    this.availableMembersForInvite.set([
      { id: "1", name: "\u793A\u4F8B\u6210\u54E11", username: "member1" },
      { id: "2", name: "\u793A\u4F8B\u6210\u54E12", username: "member2" }
    ]);
  }
  toggleSelectAllMembers(event) {
    const checked = event.target.checked;
    if (checked) {
      this.batchInviteConfig.selectedMemberIds = this.availableMembersForInvite().map((m) => m.id);
      this.batchInviteConfig.selectAll = true;
    } else {
      this.batchInviteConfig.selectedMemberIds = [];
      this.batchInviteConfig.selectAll = false;
    }
  }
  toggleMemberSelection(memberId, event) {
    const checked = event.target.checked;
    const current = this.batchInviteConfig.selectedMemberIds;
    if (checked) {
      this.batchInviteConfig.selectedMemberIds = [...current, memberId];
    } else {
      this.batchInviteConfig.selectedMemberIds = current.filter((id) => id !== memberId);
    }
    this.batchInviteConfig.selectAll = this.batchInviteConfig.selectedMemberIds.length === this.availableMembersForInvite().length;
  }
  batchJoinSelected() {
    const ids = this.selectedResourceIds();
    if (ids.length === 0) {
      this.toastService.error("\u8ACB\u5148\u9078\u64C7\u8CC7\u6E90");
      return;
    }
    this.ipcService.send("batch-join-resources", {
      resourceIds: ids,
      delayMin: 30,
      delayMax: 60
    });
  }
  // 📋 資源操作菜單控制
  toggleResourceMenu(resourceId, event) {
    if (event) {
      event.stopPropagation();
    }
    if (this.openResourceMenuId() === resourceId) {
      this.openResourceMenuId.set(null);
    } else {
      this.openResourceMenuId.set(resourceId);
    }
  }
  closeResourceMenu() {
    this.openResourceMenuId.set(null);
  }
  // 獲取狀態顏色
  getResourceStatusColor(status) {
    const colors = {
      "discovered": "bg-blue-500",
      "queued": "bg-yellow-500",
      "joining": "bg-orange-500",
      "joined": "bg-green-500",
      "monitoring": "bg-emerald-500",
      "left": "bg-gray-500",
      "blocked": "bg-red-500",
      "invalid": "bg-slate-500"
    };
    return colors[status] || "bg-gray-500";
  }
  // 基於成員數獲取規模等級 (S/A/B/C/D)
  getSizeGrade(memberCount) {
    if (memberCount >= 1e5) {
      return { grade: "S", color: "text-amber-400", bgColor: "bg-amber-500/20 border-amber-500/50", label: "\u8D85\u5927\u578B" };
    } else if (memberCount >= 1e4) {
      return { grade: "A", color: "text-green-400", bgColor: "bg-green-500/20 border-green-500/50", label: "\u5927\u578B" };
    } else if (memberCount >= 1e3) {
      return { grade: "B", color: "text-blue-400", bgColor: "bg-blue-500/20 border-blue-500/50", label: "\u4E2D\u578B" };
    } else if (memberCount >= 100) {
      return { grade: "C", color: "text-slate-400", bgColor: "bg-slate-500/20 border-slate-500/50", label: "\u5C0F\u578B" };
    } else {
      return { grade: "D", color: "text-red-400", bgColor: "bg-red-500/20 border-red-500/50", label: "\u5FAE\u578B" };
    }
  }
  // 舊方法保留相容性
  getScoreGrade(score) {
    const percent = score * 100;
    if (percent >= 90) {
      return { grade: "S", color: "text-amber-400", bgColor: "bg-amber-500/20 border-amber-500/50", icon: "\u{1F3C6}" };
    } else if (percent >= 75) {
      return { grade: "A", color: "text-green-400", bgColor: "bg-green-500/20 border-green-500/50", icon: "\u2B50" };
    } else if (percent >= 60) {
      return { grade: "B", color: "text-blue-400", bgColor: "bg-blue-500/20 border-blue-500/50", icon: "\u{1F44D}" };
    } else if (percent >= 40) {
      return { grade: "C", color: "text-slate-400", bgColor: "bg-slate-500/20 border-slate-500/50", icon: "\u{1F44C}" };
    } else {
      return { grade: "D", color: "text-red-400", bgColor: "bg-red-500/20 border-red-500/50", icon: "\u26A0\uFE0F" };
    }
  }
  // 獲取評分進度條顏色
  getScoreBarColor(score) {
    const percent = score * 100;
    if (percent >= 90)
      return "bg-amber-400";
    if (percent >= 75)
      return "bg-green-400";
    if (percent >= 60)
      return "bg-blue-400";
    if (percent >= 40)
      return "bg-slate-400";
    return "bg-red-400";
  }
  // 獲取狀態顯示名稱
  getResourceStatusName(status) {
    const names = {
      "discovered": "\u5DF2\u767C\u73FE",
      "queued": "\u968A\u5217\u4E2D",
      "joining": "\u52A0\u5165\u4E2D",
      "joined": "\u5DF2\u52A0\u5165",
      "monitoring": "\u76E3\u63A7\u4E2D",
      "left": "\u5DF2\u9000\u51FA",
      "blocked": "\u88AB\u5C01\u7981",
      "invalid": "\u7121\u6548"
    };
    return names[status] || status;
  }
  // 獲取類型顯示名稱
  getResourceTypeName(type) {
    const names = {
      "group": "\u7FA4\u7D44",
      "supergroup": "\u8D85\u7D1A\u7FA4\u7D44",
      "channel": "\u983B\u9053",
      "bot": "\u6A5F\u5668\u4EBA"
    };
    return names[type] || type;
  }
  // 獲取資源類型圖標和樣式
  getResourceTypeStyle(type) {
    const styles = {
      "channel": { icon: "\u{1F4E2}", label: "\u983B\u9053", bgClass: "bg-purple-500/20", textClass: "text-purple-400", canMessage: false, canExtract: false },
      "supergroup": { icon: "\u{1F465}", label: "\u8D85\u7D1A\u7FA4\u7D44", bgClass: "bg-blue-500/20", textClass: "text-blue-400", canMessage: true, canExtract: true },
      "group": { icon: "\u{1F4AC}", label: "\u7FA4\u7D44", bgClass: "bg-green-500/20", textClass: "text-green-400", canMessage: true, canExtract: true },
      "bot": { icon: "\u{1F916}", label: "\u6A5F\u5668\u4EBA", bgClass: "bg-orange-500/20", textClass: "text-orange-400", canMessage: true, canExtract: false }
    };
    return styles[type] || { icon: "\u{1F4CC}", label: "\u672A\u77E5", bgClass: "bg-slate-500/20", textClass: "text-slate-400", canMessage: false, canExtract: false };
  }
  // 判斷資源是否為頻道
  isChannel(resource) {
    return resource?.resource_type === "channel";
  }
  // 判斷資源是否可以發送消息（用於資源發現頁面）
  canSendMessageToResource(resource) {
    if (this.isChannel(resource))
      return false;
    return true;
  }
  // 判斷資源是否可以提取成員
  canExtractMembers(resource) {
    if (this.isChannel(resource))
      return false;
    return true;
  }
  // 顯示頻道無法提取成員的警告
  showChannelMemberWarning() {
    this.toastService.warning("\u{1F4E2} \u983B\u9053\u7121\u6CD5\u63D0\u53D6\u6210\u54E1\u5217\u8868\n\nTelegram \u4E0D\u5141\u8A31\u67E5\u770B\u983B\u9053\u7684\u8A02\u95B1\u8005\u5217\u8868\u3002\n\n\u{1F4A1} \u5EFA\u8B70\uFF1A\u5C0B\u627E\u8A72\u983B\u9053\u7684\u95DC\u806F\u8A0E\u8AD6\u7FA4\u7D44");
  }
  // 顯示頻道無法發送消息的警告
  showChannelMessageWarning() {
    this.toastService.warning("\u{1F4E2} \u983B\u9053\u7121\u6CD5\u767C\u9001\u6D88\u606F\n\n\u53EA\u6709\u983B\u9053\u7BA1\u7406\u54E1\u53EF\u4EE5\u767C\u5E03\u5167\u5BB9\u3002\n\n\u{1F4A1} \u5EFA\u8B70\uFF1A\u95DC\u6CE8\u983B\u9053\u7372\u53D6\u8CC7\u8A0A\uFF0C\u6216\u5C0B\u627E\u8A0E\u8AD6\u7FA4\u7D44");
  }
  // 驗證資源類型（通過 Telegram API）
  verifyResourceType(resource) {
    if (!resource?.id) {
      this.toastService.error("\u7121\u6548\u7684\u8CC7\u6E90");
      return;
    }
    this.toastService.info(`\u{1F50D} \u6B63\u5728\u9A57\u8B49: ${resource.title || resource.username}...`);
    this.ipcService.send("verify-resource-type", { resourceId: resource.id });
  }
  // 獲取資源的權限狀態描述
  getResourcePermissionStatus(resource) {
    if (this.isChannel(resource)) {
      return { icon: "\u{1F4E2}", text: "\u50C5\u8A02\u95B1", class: "text-purple-400" };
    }
    return { icon: "\u2705", text: "\u53EF\u4E92\u52D5", class: "text-green-400" };
  }
  // 獲取選中的頻道數量
  getSelectedChannelCount() {
    const selectedIds = this.selectedResourceIds();
    const resources = this.discoveredResources();
    return resources.filter((r) => selectedIds.includes(r.id) && r.resource_type === "channel").length;
  }
  // 獲取選中的群組數量（非頻道）
  getSelectedGroupCount() {
    const selectedIds = this.selectedResourceIds();
    const resources = this.discoveredResources();
    return resources.filter((r) => selectedIds.includes(r.id) && r.resource_type !== "channel").length;
  }
  // 獲取可發消息的選中資源
  getSelectedMessageableResources() {
    const selectedIds = this.selectedResourceIds();
    const resources = this.discoveredResources();
    return resources.filter((r) => selectedIds.includes(r.id) && r.resource_type !== "channel");
  }
  // 獲取可提取成員的選中資源
  getSelectedExtractableResources() {
    const selectedIds = this.selectedResourceIds();
    const resources = this.discoveredResources();
    return resources.filter((r) => selectedIds.includes(r.id) && r.resource_type !== "channel");
  }
  // 打開批量群發（自動過濾頻道）
  openBatchMessageWithFilter() {
    const channels = this.getSelectedChannelCount();
    if (channels > 0) {
      this.toastService.info(`\u{1F4E2} \u5DF2\u81EA\u52D5\u6392\u9664 ${channels} \u500B\u983B\u9053\uFF0C\u5C07\u5C0D ${this.getSelectedGroupCount()} \u500B\u7FA4\u7D44\u767C\u9001\u6D88\u606F`);
    }
    this.showBatchMessageDialog.set(true);
  }
  // ==================== Discussion Watcher Methods ====================
  // 初始化討論組監控
  initDiscussionWatcher() {
    this.ipcService.send("init-discussion-watcher", {});
  }
  // 發現頻道的討論組
  discoverDiscussion() {
    if (!this.discoverChannelId.trim()) {
      this.toastService.error("\u8ACB\u8F38\u5165\u983B\u9053 ID \u6216 username");
      return;
    }
    this.ipcService.send("discover-discussion", {
      channelId: this.discoverChannelId.trim()
    });
    this.discoverChannelId = "";
  }
  // 從已發現的資源中發現討論組
  discoverDiscussionsFromResources() {
    this.ipcService.send("discover-discussions-from-resources", {});
  }
  // 加載頻道-討論組列表
  loadChannelDiscussions() {
    this.ipcService.send("get-channel-discussions", { activeOnly: true });
  }
  // 刷新討論組統計
  refreshDiscussionStats() {
    this.ipcService.send("get-discussion-stats", {});
  }
  // 開始監控討論組
  startDiscussionMonitoring(discussionId) {
    this.ipcService.send("start-discussion-monitoring", {
      discussionId
    });
  }
  // 停止監控討論組
  stopDiscussionMonitoring(discussionId) {
    this.ipcService.send("stop-discussion-monitoring", {
      discussionId
    });
  }
  // 加載討論組消息
  loadDiscussionMessages(discussionId) {
    this.selectedDiscussionId.set(discussionId);
    this.isLoadingDiscussionMessages.set(true);
    this.ipcService.send("get-discussion-messages", {
      discussionId,
      limit: 50,
      matchedOnly: false
    });
  }
  // 回復討論組消息
  replyToDiscussion(messageId, discussionId, replyText) {
    if (!replyText || !replyText.trim()) {
      this.toastService.error("\u8ACB\u8F38\u5165\u56DE\u5FA9\u5167\u5BB9");
      return;
    }
    this.ipcService.send("reply-to-discussion", {
      discussionId,
      messageId,
      replyText: replyText.trim()
    });
    this.discussionReplyText.set("");
  }
  // ==================== Knowledge Base Methods ====================
  // 初始化知識庫
  initKnowledgeBase() {
    this.ipcService.send("init-knowledge-base", {});
  }
  // 加載知識庫數據
  loadKnowledgeData() {
    this.isLoadingKnowledge.set(true);
    this.ipcService.send("get-knowledge-stats", {});
    this.refreshCurrentKnowledgeTab();
  }
  // 刷新當前知識庫標籤
  refreshCurrentKnowledgeTab() {
    const tab = this.knowledgeTab();
    switch (tab) {
      case "documents":
        this.ipcService.send("get-documents", {});
        break;
      case "images":
        this.ipcService.send("get-media", { mediaType: "image" });
        break;
      case "videos":
        this.ipcService.send("get-media", { mediaType: "video" });
        break;
      case "qa":
        this.ipcService.send("get-qa-pairs", {});
        break;
    }
  }
  // 切換知識庫標籤
  switchKnowledgeTab(tab) {
    this.knowledgeTab.set(tab);
    this.refreshCurrentKnowledgeTab();
  }
  // 添加文檔
  addDocument() {
    const doc = this.newDocument();
    if (!doc.title && !doc.content) {
      this.toastService.error(this.t("documentTitle") + " required", 2e3);
      return;
    }
    this.ipcService.send("add-document", {
      title: doc.title,
      content: doc.content,
      category: doc.category,
      tags: doc.tags.split(",").map((t) => t.trim()).filter((t) => t)
    });
    this.showAddDocumentDialog.set(false);
    this.newDocument.set({ title: "", category: "general", tags: "", content: "" });
  }
  // 上傳文檔文件
  async uploadDocumentFile(event) {
    const input2 = event.target;
    if (!input2.files || input2.files.length === 0)
      return;
    const file = input2.files[0];
    const doc = this.newDocument();
    const reader = new FileReader();
    reader.onload = () => {
      const content = reader.result;
      this.ipcService.send("add-document", {
        title: doc.title || file.name.replace(/\.[^/.]+$/, ""),
        content,
        category: doc.category,
        tags: doc.tags.split(",").map((t) => t.trim()).filter((t) => t)
      });
      this.showAddDocumentDialog.set(false);
      this.newDocument.set({ title: "", category: "general", tags: "", content: "" });
    };
    if (file.type === "application/pdf") {
      this.toastService.info("PDF \u6587\u4EF6\u5C07\u7531\u5F8C\u7AEF\u8655\u7406", 2e3);
    } else {
      reader.readAsText(file);
    }
    input2.value = "";
  }
  // 刪除文檔
  deleteDocument(id) {
    this.ipcService.send("delete-document", { id });
    this.knowledgeDocuments.update((docs) => docs.filter((d) => d.id !== id));
  }
  // 上傳媒體文件
  async uploadMediaFile(event) {
    const input2 = event.target;
    if (!input2.files || input2.files.length === 0)
      return;
    const file = input2.files[0];
    const media = this.newMedia();
    const isVideo2 = file.type.startsWith("video/");
    const mediaType = isVideo2 ? "video" : "image";
    const reader = new FileReader();
    reader.onload = () => {
      const base64 = reader.result.split(",")[1];
      this.ipcService.send("add-media", {
        base64Data: base64,
        name: media.name || file.name.replace(/\.[^/.]+$/, ""),
        category: media.category,
        description: media.description,
        mediaType
      });
      this.showAddMediaDialog.set(false);
      this.newMedia.set({ name: "", category: "general", description: "", mediaType: "image" });
    };
    reader.readAsDataURL(file);
    input2.value = "";
  }
  // 刪除媒體
  deleteMedia(id, mediaType) {
    this.ipcService.send("delete-media", { id });
    if (mediaType === "image") {
      this.knowledgeImages.update((imgs) => imgs.filter((i) => i.id !== id));
    } else {
      this.knowledgeVideos.update((vids) => vids.filter((v) => v.id !== id));
    }
  }
  // 添加問答對
  addQaPair() {
    const qa = this.newQaPair();
    if (!qa.question || !qa.answer) {
      this.toastService.error(this.t("question") + " & " + this.t("answer") + " required", 2e3);
      return;
    }
    this.ipcService.send("add-qa-pair", {
      question: qa.question,
      answer: qa.answer,
      category: qa.category,
      keywords: qa.keywords.split(",").map((k) => k.trim()).filter((k) => k)
    });
    this.showAddQaDialog.set(false);
    this.newQaPair.set({ question: "", answer: "", category: "general", keywords: "" });
  }
  // 刪除問答對
  deleteQaPair(id) {
    this.knowledgeQaPairs.update((qas) => qas.filter((q) => q.id !== id));
  }
  // 打開添加圖片對話框
  openAddImageDialog() {
    this.newMedia.set({ name: "", category: "general", description: "", mediaType: "image" });
    this.showAddMediaDialog.set(true);
  }
  // 打開添加視頻對話框
  openAddVideoDialog() {
    this.newMedia.set({ name: "", category: "general", description: "", mediaType: "video" });
    this.showAddMediaDialog.set(true);
  }
  // 更新新文檔字段
  updateNewDocumentField(field, value) {
    const current = this.newDocument();
    this.newDocument.set(__spreadProps(__spreadValues({}, current), { [field]: value }));
  }
  // 更新新媒體字段
  updateNewMediaField(field, value) {
    const current = this.newMedia();
    this.newMedia.set(__spreadProps(__spreadValues({}, current), { [field]: value }));
  }
  // 更新新問答對字段
  updateNewQaPairField(field, value) {
    const current = this.newQaPair();
    this.newQaPair.set(__spreadProps(__spreadValues({}, current), { [field]: value }));
  }
  // 搜索知識庫
  searchKnowledge(query) {
    if (!query.trim())
      return;
    this.ipcService.send("search-knowledge", {
      query,
      includeDocs: true,
      includeImages: true,
      includeVideos: true,
      limit: 20
    });
  }
  // 發送 AI 問候建議
  sendAiGreeting() {
    const suggestion = this.aiGreetingSuggestion();
    if (!suggestion)
      return;
    this.ipcService.send("send-message", {
      phone: suggestion.accountPhone,
      recipientId: suggestion.userId,
      text: suggestion.suggestedGreeting,
      leadId: suggestion.leadId
    });
    this.showAiGreetingDialog.set(false);
    this.aiGreetingSuggestion.set(null);
    this.toastService.success(`\u2713 \u554F\u5019\u6D88\u606F\u5DF2\u767C\u9001\u7D66 @${suggestion.username || suggestion.firstName}`);
  }
  // 編輯 AI 問候
  editAiGreeting(newText) {
    const suggestion = this.aiGreetingSuggestion();
    if (suggestion) {
      this.aiGreetingSuggestion.set(__spreadProps(__spreadValues({}, suggestion), { suggestedGreeting: newText }));
    }
  }
  // 拒絕 AI 問候
  dismissAiGreeting() {
    this.showAiGreetingDialog.set(false);
    this.aiGreetingSuggestion.set(null);
  }
  // 格式化文件大小
  formatFileSize(bytes) {
    if (!bytes)
      return "0 B";
    const k = 1024;
    const sizes = ["B", "KB", "MB", "GB"];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
  }
  // ==================== Voice Clone Methods ====================
  // 上傳聲音樣本用於克隆
  async uploadVoiceSample(event) {
    const input2 = event.target;
    if (!input2.files || input2.files.length === 0)
      return;
    const file = input2.files[0];
    const allowedTypes = ["audio/wav", "audio/mp3", "audio/mpeg", "audio/ogg", "audio/flac"];
    if (!allowedTypes.includes(file.type)) {
      this.voiceCloneError.set(this.t("invalidAudioFormat"));
      return;
    }
    if (file.size > 50 * 1024 * 1024) {
      this.voiceCloneError.set(this.t("audioFileTooLarge"));
      return;
    }
    this.isUploadingVoice.set(true);
    this.voiceUploadProgress.set(0);
    this.voiceCloneError.set("");
    try {
      const reader = new FileReader();
      reader.onprogress = (e) => {
        if (e.lengthComputable) {
          this.voiceUploadProgress.set(Math.round(e.loaded / e.total * 50));
        }
      };
      reader.onload = async () => {
        const base64Data = reader.result.split(",")[1];
        const voiceName = file.name.replace(/\.[^/.]+$/, "");
        this.ipcService.send("upload-voice-sample", {
          name: voiceName,
          audioData: base64Data,
          fileName: file.name,
          fileType: file.type
        });
        this.voiceUploadProgress.set(100);
        setTimeout(() => {
          const newVoice = {
            id: Date.now().toString(),
            name: voiceName,
            audioPath: file.name,
            promptText: "",
            // 文件上傳沒有提示詞
            createdAt: /* @__PURE__ */ new Date()
          };
          this.clonedVoices.update((voices) => [...voices, newVoice]);
          this.saveClonedVoicesToStorage();
          this.isUploadingVoice.set(false);
          this.toastService.success(this.t("voiceUploadSuccess"), 2e3);
        }, 500);
      };
      reader.onerror = () => {
        this.voiceCloneError.set(this.t("voiceUploadFailed"));
        this.isUploadingVoice.set(false);
      };
      reader.readAsDataURL(file);
    } catch (error) {
      this.voiceCloneError.set(error.message);
      this.isUploadingVoice.set(false);
    }
    input2.value = "";
  }
  // 選擇克隆的聲音
  selectClonedVoice(voiceId) {
    this.selectedClonedVoice.set(voiceId);
    const voice = this.clonedVoices().find((v) => v.id === voiceId);
    if (voice) {
      this.ttsVoice.set(voice.audioPath);
    }
  }
  // 刪除克隆的聲音
  deleteClonedVoice(voiceId) {
    this.clonedVoices.update((voices) => voices.filter((v) => v.id !== voiceId));
    if (this.selectedClonedVoice() === voiceId) {
      this.selectedClonedVoice.set("");
      this.ttsVoice.set("");
    }
    this.saveClonedVoicesToStorage();
    this.ipcService.send("delete-voice-sample", { voiceId });
    this.toastService.success(this.t("voiceDeleted"), 2e3);
  }
  // 預覽克隆的聲音
  async previewClonedVoice(voiceId) {
    const voice = this.clonedVoices().find((v) => v.id === voiceId);
    if (!voice)
      return;
    this.ipcService.send("preview-voice-sample", {
      voiceId,
      audioPath: voice.audioPath
    });
  }
  // 使用克隆聲音生成語音
  async generateWithClonedVoice(text) {
    const endpoint = this.ttsEndpoint();
    const voiceId = this.selectedClonedVoice();
    if (!endpoint) {
      this.toastService.error(this.t("ttsEndpointRequired"), 2e3);
      return;
    }
    if (!voiceId) {
      this.toastService.error(this.t("selectVoiceFirst"), 2e3);
      return;
    }
    const voice = this.clonedVoices().find((v) => v.id === voiceId);
    if (!voice)
      return;
    this.ipcService.send("generate-cloned-voice", {
      endpoint,
      text,
      voiceId,
      audioPath: voice.audioPath
    });
  }
  // 保存克隆聲音列表到 localStorage
  saveClonedVoicesToStorage() {
    const voices = this.clonedVoices().map((v) => __spreadProps(__spreadValues({}, v), {
      createdAt: v.createdAt.toISOString()
    }));
    localStorage.setItem("cloned_voices", JSON.stringify(voices));
  }
  // 從 localStorage 加載克隆聲音列表
  loadClonedVoicesFromStorage() {
    const saved = localStorage.getItem("cloned_voices");
    if (saved) {
      try {
        const voices = JSON.parse(saved).map((v) => __spreadProps(__spreadValues({}, v), {
          createdAt: new Date(v.createdAt)
        }));
        this.clonedVoices.set(voices);
      } catch (e) {
        console.error("Failed to load cloned voices:", e);
      }
    }
  }
  // ==================== Voice Recording Methods ====================
  // 打開錄音對話框
  openRecordingDialog() {
    this.showRecordingDialog.set(true);
    this.voiceName.set("");
    this.voicePromptText.set("");
    this.recordedAudioBlob.set(null);
    this.recordedAudioUrl.set("");
    this.voiceCloneError.set("");
    this.recordingTime.set(0);
  }
  // 關閉錄音對話框
  closeRecordingDialog() {
    this.stopRecording();
    this.showRecordingDialog.set(false);
    if (this.recordedAudioUrl()) {
      URL.revokeObjectURL(this.recordedAudioUrl());
    }
  }
  // 開始錄音
  async startRecording() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        audio: {
          sampleRate: 44100,
          channelCount: 1,
          echoCancellation: true,
          noiseSuppression: true
        }
      });
      this.audioChunks = [];
      this.mediaRecorder = new MediaRecorder(stream, {
        mimeType: "audio/webm;codecs=opus"
      });
      this.mediaRecorder.ondataavailable = (event) => {
        if (event.data.size > 0) {
          this.audioChunks.push(event.data);
        }
      };
      this.mediaRecorder.onstop = () => {
        const audioBlob = new Blob(this.audioChunks, { type: "audio/webm" });
        this.recordedAudioBlob.set(audioBlob);
        if (this.recordedAudioUrl()) {
          URL.revokeObjectURL(this.recordedAudioUrl());
        }
        this.recordedAudioUrl.set(URL.createObjectURL(audioBlob));
        stream.getTracks().forEach((track) => track.stop());
      };
      this.mediaRecorder.start(100);
      this.isRecording.set(true);
      this.recordingTime.set(0);
      this.recordingTimer = setInterval(() => {
        this.recordingTime.update((t) => t + 1);
        if (this.recordingTime() >= 10) {
          this.stopRecording();
        }
      }, 1e3);
    } catch (error) {
      console.error("Recording error:", error);
      this.voiceCloneError.set(this.t("microphoneAccessDenied"));
    }
  }
  // 停止錄音
  stopRecording() {
    if (this.mediaRecorder && this.isRecording()) {
      this.mediaRecorder.stop();
      this.isRecording.set(false);
      if (this.recordingTimer) {
        clearInterval(this.recordingTimer);
        this.recordingTimer = null;
      }
    }
  }
  // 確認並上傳錄音
  async confirmAndUploadRecording() {
    const audioBlob = this.recordedAudioBlob();
    const name = this.voiceName().trim();
    const promptText = this.voicePromptText().trim();
    if (!name) {
      this.voiceCloneError.set(this.t("voiceNameRequired"));
      return;
    }
    if (!audioBlob) {
      this.voiceCloneError.set(this.t("noRecordingToUpload"));
      return;
    }
    const duration = this.recordingTime();
    if (duration < 3) {
      this.voiceCloneError.set(this.t("recordingTooShort"));
      return;
    }
    this.isUploadingVoice.set(true);
    this.voiceUploadProgress.set(0);
    try {
      const reader = new FileReader();
      reader.onprogress = (e) => {
        if (e.lengthComputable) {
          this.voiceUploadProgress.set(Math.round(e.loaded / e.total * 50));
        }
      };
      reader.onload = async () => {
        const base64Data = reader.result.split(",")[1];
        this.ipcService.send("upload-voice-sample", {
          name,
          audioData: base64Data,
          fileName: `${name}.webm`,
          fileType: "audio/webm",
          promptText,
          duration
        });
        this.voiceUploadProgress.set(100);
        const newVoice = {
          id: Date.now().toString(),
          name,
          audioPath: `${name}.webm`,
          promptText,
          createdAt: /* @__PURE__ */ new Date()
        };
        this.clonedVoices.update((voices) => [...voices, newVoice]);
        this.saveClonedVoicesToStorage();
        this.isUploadingVoice.set(false);
        this.toastService.success(this.t("voiceUploadSuccess"), 2e3);
        this.closeRecordingDialog();
      };
      reader.onerror = () => {
        this.voiceCloneError.set(this.t("voiceUploadFailed"));
        this.isUploadingVoice.set(false);
      };
      reader.readAsDataURL(audioBlob);
    } catch (error) {
      this.voiceCloneError.set(error.message);
      this.isUploadingVoice.set(false);
    }
  }
  // 重新錄音
  resetRecording() {
    if (this.recordedAudioUrl()) {
      URL.revokeObjectURL(this.recordedAudioUrl());
    }
    this.recordedAudioBlob.set(null);
    this.recordedAudioUrl.set("");
    this.recordingTime.set(0);
    this.voiceCloneError.set("");
  }
  loadAiSettings() {
    const savedKey = localStorage.getItem("ai_api_key");
    const savedType = localStorage.getItem("ai_api_type");
    const savedEndpoint = localStorage.getItem("ai_custom_endpoint");
    if (savedKey) {
      this.aiApiKey.set(savedKey);
    }
    if (savedType) {
      this.aiApiType.set(savedType);
    }
    if (savedEndpoint) {
      this.customApiEndpoint.set(savedEndpoint);
    }
    const localAiEndpoint = localStorage.getItem("local_ai_endpoint");
    const localAiModel = localStorage.getItem("local_ai_model");
    if (localAiEndpoint) {
      this.localAiEndpoint.set(localAiEndpoint);
    }
    if (localAiModel) {
      this.localAiModel.set(localAiModel);
    }
    const ttsEndpoint = localStorage.getItem("tts_endpoint");
    const ttsEnabled = localStorage.getItem("tts_enabled");
    const ttsVoice = localStorage.getItem("tts_voice");
    const sttEndpoint = localStorage.getItem("stt_endpoint");
    const sttEnabled = localStorage.getItem("stt_enabled");
    if (ttsEndpoint)
      this.ttsEndpoint.set(ttsEndpoint);
    if (ttsEnabled)
      this.ttsEnabled.set(ttsEnabled === "true");
    if (ttsVoice)
      this.ttsVoice.set(ttsVoice);
    if (sttEndpoint)
      this.sttEndpoint.set(sttEndpoint);
    if (sttEnabled)
      this.sttEnabled.set(sttEnabled === "true");
    this.loadClonedVoicesFromStorage();
    this.loadAiChatSettings();
  }
  // 檢查正則表達式是否有效
  isRegexValid(keyword) {
    if (!keyword)
      return true;
    try {
      new RegExp(keyword);
      return true;
    } catch {
      return false;
    }
  }
  // 獲取正則表達式錯誤信息
  getRegexError(keyword) {
    if (!keyword)
      return null;
    try {
      new RegExp(keyword);
      return null;
    } catch (e) {
      return e.message;
    }
  }
  // 獲取監控號列表（用於快速引導面板）
  getListenerAccounts() {
    return this.accounts().filter((a) => a.role === "Listener" && a.status === "Online");
  }
  // 獲取發送號列表（用於快速引導面板）
  getSenderAccounts() {
    return this.accounts().filter((a) => a.role === "Sender" && (a.status === "Online" || a.status === "Warming Up"));
  }
  // 獲取在線帳號數量（用於模板，避免在模板中使用箭頭函數）
  getOnlineAccountsCount() {
    return this.accounts().filter((a) => a.status === "Online").length;
  }
  // 導航到指定視圖（用於模板，避免在 @if 區塊中直接賦值）
  navigateToView(viewName) {
    this.changeView(viewName);
  }
  // 導航到自動化中心的指定標籤頁
  navigateToAutomationTab(tab) {
    this.currentView.set("automation");
    this.automationTab.set(tab);
  }
  // 🆕 知識大腦菜單方法
  toggleKnowledgeMenu() {
    this.knowledgeMenuExpanded.set(!this.knowledgeMenuExpanded());
  }
  isKnowledgeView() {
    const view = this.currentView();
    return view === "knowledge-brain" || view === "knowledge-manage" || view === "knowledge-gaps";
  }
  // 根據狀態獲取 Lead 列表（用於模板）
  leadsByStatus(status) {
    return this.leadsByStatusMap().get(status) || [];
  }
  // 今日新 Lead 數量
  todayNewLeads() {
    const today = /* @__PURE__ */ new Date();
    today.setHours(0, 0, 0, 0);
    return this.leads().filter((lead) => {
      const leadDate = new Date(lead.timestamp);
      return leadDate >= today;
    }).length;
  }
  // 計算轉化率
  getConversionRate() {
    const total = this.leads().length;
    if (total === 0)
      return "0.0";
    const converted = this.leadsByStatus("Closed-Won").length;
    return (converted / total * 100).toFixed(1);
  }
  // 🆕 計算聯繫率（已聯繫 / 總數）
  getContactRate() {
    const total = this.leads().length;
    if (total === 0)
      return "0.0";
    const newLeads = this.leadsByStatus("New").length;
    const contacted = total - newLeads;
    return (contacted / total * 100).toFixed(1);
  }
  // 🆕 計算回覆率（已回覆 / 已聯繫）
  getReplyRate() {
    const contacted = this.leads().length - this.leadsByStatus("New").length;
    if (contacted === 0)
      return "0.0";
    const replied = this.leadsByStatus("Replied").length + this.leadsByStatus("Follow-up").length + this.leadsByStatus("Closed-Won").length + this.leadsByStatus("Closed-Lost").length;
    return (replied / contacted * 100).toFixed(1);
  }
  loadFunnelStats() {
    this.ipcService.send("get-funnel-stats", {});
  }
  // ==================== Funnel Visualization Methods (Phase 4) ====================
  loadFunnelOverview() {
    this.isLoadingFunnel.set(true);
    this.ipcService.send("get-funnel-overview", {});
  }
  loadUserJourney(userId) {
    if (!userId)
      return;
    this.isLoadingJourney.set(true);
    this.selectedJourneyUserId.set(userId);
    this.ipcService.send("get-user-journey", { userId });
  }
  transitionFunnelStage(userId, newStage, reason) {
    this.ipcService.send("transition-funnel-stage", {
      userId,
      stage: newStage,
      reason: reason || "\u624B\u52D5\u8F49\u63DB"
    });
  }
  // ==================== Marketing Campaign Methods (Phase 4) ====================
  loadMarketingStats() {
    this.isLoadingMarketing.set(true);
    this.ipcService.send("get-marketing-stats", {});
  }
  loadMarketingCampaigns() {
    this.ipcService.send("get-marketing-campaigns", {});
  }
  createMarketingCampaign() {
    if (!this.newMarketingCampaign.name.trim()) {
      this.toastService.error("\u8ACB\u8F38\u5165\u6D3B\u52D5\u540D\u7A31");
      return;
    }
    this.ipcService.send("create-marketing-campaign", {
      name: this.newMarketingCampaign.name,
      type: this.newMarketingCampaign.type,
      targetGroup: this.newMarketingCampaign.targetGroup,
      messageTemplate: this.newMarketingCampaign.messageTemplate
    });
  }
  startMarketingCampaign(campaignId) {
    this.ipcService.send("start-marketing-campaign", { campaignId });
  }
  // ==================== Account Warmup Methods (Phase 4) ====================
  loadWarmupDetails(accountId) {
    this.ipcService.send("get-warmup-progress", { accountId });
  }
  loadAllWarmupDetails() {
    const accounts = this.accounts();
    accounts.forEach((account) => {
      if (account.id) {
        this.loadWarmupDetails(account.id);
      }
    });
  }
  toggleWarmup(accountId, enabled) {
    this.ipcService.send("update-account", {
      id: accountId,
      warmupEnabled: enabled
    });
    this.toastService.info(enabled ? "\u5DF2\u555F\u7528\u9810\u71B1" : "\u5DF2\u505C\u7528\u9810\u71B1");
  }
  getWarmupStageColor(stage) {
    const colors = {
      1: "text-blue-400",
      2: "text-cyan-400",
      3: "text-yellow-400",
      4: "text-green-400"
    };
    return colors[stage] || "text-slate-400";
  }
  getWarmupStageIcon(stage) {
    const icons = {
      1: "\u{1F507}",
      2: "\u{1F4AC}",
      3: "\u{1F4C8}",
      4: "\u2705"
    };
    return icons[stage] || "\u2753";
  }
  // ==================== Phase 5: System Management Methods ====================
  // --- Database Migration Methods ---
  loadMigrationStatus() {
    this.isLoadingMigration.set(true);
    this.ipcService.send("migration-status", {});
  }
  runMigration(targetVersion) {
    this.isRunningMigration.set(true);
    this.ipcService.send("migrate", { targetVersion });
  }
  rollbackMigration(targetVersion) {
    if (!confirm(`\u78BA\u5B9A\u8981\u56DE\u6EFE\u5230\u7248\u672C ${targetVersion} \u55CE\uFF1F\u9019\u53EF\u80FD\u6703\u5C0E\u81F4\u6578\u64DA\u4E1F\u5931\uFF01`))
      return;
    this.isRunningMigration.set(true);
    this.ipcService.send("rollback-migration", { targetVersion });
  }
  // --- Task Scheduler Methods ---
  loadSchedulerStatus() {
    this.ipcService.send("get-scheduler-status", {});
  }
  startScheduler() {
    this.ipcService.send("start-scheduler", {});
  }
  stopScheduler() {
    this.ipcService.send("stop-scheduler", {});
  }
  runSchedulerTask(taskName) {
    this.ipcService.send("run-scheduler-task", { taskName });
  }
  updateSchedulerInterval(taskName, interval) {
    this.ipcService.send("update-scheduler-interval", { taskName, interval });
  }
  // --- Log File Management Methods ---
  loadLogFiles() {
    this.isLoadingLogs.set(true);
    this.ipcService.send("list-log-files", {});
  }
  loadLogStats() {
    this.ipcService.send("get-log-stats", {});
  }
  rotateLogs() {
    this.isRotatingLogs.set(true);
    this.ipcService.send("rotate-logs", {});
  }
  viewLogFile(filename) {
    this.selectedLogFile.set(filename);
    this.ipcService.send("read-log-file", { filename });
  }
  downloadLogFile(filename) {
    this.ipcService.send("download-log-file", { filename });
  }
  deleteLogFile(filename) {
    if (!confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u65E5\u8A8C\u6587\u4EF6 ${filename} \u55CE\uFF1F`))
      return;
    this.ipcService.send("delete-log-file", { filename });
  }
  // --- Resource Discovery Batch Methods (Phase 5 Enhanced) ---
  hasSelectedResources() {
    return this.selectedResourceIds().length > 0;
  }
  selectedResourceCount() {
    return this.selectedResourceIds().length;
  }
  batchApproveResources() {
    const ids = this.selectedResourceIds();
    this.ipcService.send("batch-update-resources", {
      resourceIds: ids,
      status: "approved"
    });
    this.selectedResourceIds.set([]);
    this.showResourceBatchMenu.set(false);
  }
  batchRejectResources() {
    const ids = this.selectedResourceIds();
    this.ipcService.send("batch-update-resources", {
      resourceIds: ids,
      status: "rejected"
    });
    this.selectedResourceIds.set([]);
    this.showResourceBatchMenu.set(false);
  }
  batchSetResourcePriority(priority) {
    const ids = this.selectedResourceIds();
    this.ipcService.send("batch-update-resources", {
      resourceIds: ids,
      priority
    });
    this.selectedResourceIds.set([]);
    this.showResourceBatchMenu.set(false);
  }
  batchDeleteResources() {
    if (!confirm(`\u78BA\u5B9A\u8981\u522A\u9664 ${this.selectedResourceCount()} \u500B\u8CC7\u6E90\u55CE\uFF1F`))
      return;
    const ids = this.selectedResourceIds();
    this.ipcService.send("batch-delete-resources", { resourceIds: ids });
    this.selectedResourceIds.set([]);
    this.showResourceBatchMenu.set(false);
  }
  loadUsersWithProfiles() {
    this.ipcService.send("get-users-with-profiles", {
      stage: this.userFilterStage() || void 0,
      tags: this.userFilterTags() || void 0,
      search: this.userFilterSearch() || void 0,
      limit: 50,
      offset: 0
    });
  }
  toggleUserSelection(userId) {
    const current = this.selectedUserIds();
    if (current.includes(userId)) {
      this.selectedUserIds.set(current.filter((id) => id !== userId));
    } else {
      this.selectedUserIds.set([...current, userId]);
    }
  }
  selectAllUsers() {
    const allIds = this.usersWithProfiles().users.map((u) => u.user_id);
    this.selectedUserIds.set(allIds);
  }
  deselectAllUsers() {
    this.selectedUserIds.set([]);
  }
  bulkUpdateTags(tags, action) {
    const userIds = this.selectedUserIds();
    if (userIds.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7528\u6236");
      return;
    }
    this.ipcService.send("bulk-update-user-tags", { userIds, tags, action });
  }
  bulkUpdateStage(stage) {
    const userIds = this.selectedUserIds();
    if (userIds.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u7528\u6236");
      return;
    }
    this.ipcService.send("bulk-update-user-stage", { userIds, stage });
  }
  getStageName(stage) {
    const found = this.funnelStages.find((s) => s.key === stage);
    return found ? found.name : stage;
  }
  getStageColor(stage) {
    const found = this.funnelStages.find((s) => s.key === stage);
    return found ? found.color : "bg-gray-500";
  }
  constructor() {
    this.router = inject(Router);
    this.geminiService = inject(GeminiService);
    this.translationService = inject(TranslationService);
    this.accountLoaderService = inject(AccountLoaderService);
    this.ipcService = inject(ElectronIpcService);
    this.offlineCache = inject(OfflineCacheService);
    this.swManager = inject(SwManagerService);
    this.toastService = inject(ToastService);
    this.membershipService = inject(MembershipService);
    this.securityService = inject(SecurityService);
    this.loadingService = inject(LoadingService);
    this.contactsService = inject(UnifiedContactsService);
    this.backupService = inject(BackupService);
    this.i18n = inject(I18nService);
    this.authService = inject(AuthService);
    this.navBridge = inject(NavBridgeService);
    this.navShortcuts = inject(NavShortcutsService);
    this.unifiedNav = inject(UnifiedNavService);
    this.navigationService = inject(NavigationService);
    this.monitoringMgmt = inject(MonitoringManagementService);
    this.leadMgmt = inject(LeadManagementService);
    this.campaignMgmt = inject(CampaignManagementService);
    this.templateMgmt = inject(TemplateManagementService);
    this.groupMgmt = inject(GroupManagementService);
    this.messageMgmt = inject(MessageQueueService);
    this.facade = inject(AppFacadeService);
    this.animationConfig = inject(AnimationConfigService);
    this.settingsService = inject(SettingsService);
    this.aiChatService = inject(AiChatService);
    this.resourceService = inject(ResourceService);
    this.exportService = inject(ExportService);
    this.ragService = inject(RagService);
    this.ragBrainService = inject(RAGBrainService);
    this.vectorMemoryService = inject(VectorMemoryService);
    this.schedulerService = inject(SchedulerService);
    this.dialogService = inject(DialogService);
    this.document = inject(DOCUMENT);
    this.cdr = inject(ChangeDetectorRef);
    this.ngZone = inject(NgZone);
    this.membershipUpdateHandler = null;
    this.Math = Math;
    this.isAuthenticated = computed(() => this.authService.isAuthenticated(), ...ngDevMode ? [{ debugName: "isAuthenticated" }] : []);
    this.currentUser = computed(() => this.authService.user(), ...ngDevMode ? [{ debugName: "currentUser" }] : []);
    this.userMembershipLevel = computed(() => this.authService.membershipLevel(), ...ngDevMode ? [{ debugName: "userMembershipLevel" }] : []);
    this.t = (key, params) => this.i18n.t(key, params);
    this.theme = signal("dark", ...ngDevMode ? [{ debugName: "theme" }] : []);
    this.currentView = signal("dashboard", ...ngDevMode ? [{ debugName: "currentView" }] : []);
    this.dashboardMode = signal("smart", ...ngDevMode ? [{ debugName: "dashboardMode" }] : []);
    this.useRouterMode = signal(true, ...ngDevMode ? [{ debugName: "useRouterMode" }] : []);
    this.navMode = signal("classic", ...ngDevMode ? [{ debugName: "navMode" }] : []);
    this.leadDetailView = signal("sendMessage", ...ngDevMode ? [{ debugName: "leadDetailView" }] : []);
    this.leadsViewMode = signal("kanban", ...ngDevMode ? [{ debugName: "leadsViewMode" }] : []);
    this.leadStatusFilter = signal("all", ...ngDevMode ? [{ debugName: "leadStatusFilter" }] : []);
    this.leadSourceFilter = signal("all", ...ngDevMode ? [{ debugName: "leadSourceFilter" }] : []);
    this.leadSortBy = signal("time", ...ngDevMode ? [{ debugName: "leadSortBy" }] : []);
    this.showLeadsViewMenu = signal(false, ...ngDevMode ? [{ debugName: "showLeadsViewMenu" }] : []);
    this.showLeadsActionMenu = signal(false, ...ngDevMode ? [{ debugName: "showLeadsActionMenu" }] : []);
    this.aiCenterTab = signal("config", ...ngDevMode ? [{ debugName: "aiCenterTab" }] : []);
    this.automationTab = signal("targets", ...ngDevMode ? [{ debugName: "automationTab" }] : []);
    this.knowledgeMenuExpanded = signal(true, ...ngDevMode ? [{ debugName: "knowledgeMenuExpanded" }] : []);
    this.sidebarGroups = signal({
      manual: true,
      // 手動操作 - 默認展開
      monitoring: true,
      // 監控中心 - 默認展開
      marketing: true,
      // 智能營銷 - 默認展開
      analytics: false,
      // 數據分析 - 默認折疊
      advanced: false,
      // 進階設置 - 默認折疊
      ai: true,
      // AI 智能 - 默認展開
      system: false
      // 系統監控 - 默認折疊
    }, ...ngDevMode ? [{ debugName: "sidebarGroups" }] : []);
    this.sidebarCollapsed = signal(false, ...ngDevMode ? [{ debugName: "sidebarCollapsed" }] : []);
    this.aiTeamIncomingStrategy = signal(null, ...ngDevMode ? [{ debugName: "aiTeamIncomingStrategy" }] : []);
    this.showBatchMessageDialogState = signal(false, ...ngDevMode ? [{ debugName: "showBatchMessageDialogState" }] : []);
    this.batchSelectedLeads = signal([], ...ngDevMode ? [{ debugName: "batchSelectedLeads" }] : []);
    this.batchSendTargets = signal([], ...ngDevMode ? [{ debugName: "batchSendTargets" }] : []);
    this.showBatchInviteDialogState = signal(false, ...ngDevMode ? [{ debugName: "showBatchInviteDialogState" }] : []);
    this.batchInviteTargets = signal([], ...ngDevMode ? [{ debugName: "batchInviteTargets" }] : []);
    this.migrationStatus = signal({
      currentVersion: 0,
      latestVersion: 0,
      appliedCount: 0,
      pendingCount: 0,
      appliedMigrations: [],
      pendingMigrations: []
    }, ...ngDevMode ? [{ debugName: "migrationStatus" }] : []);
    this.isLoadingMigration = signal(false, ...ngDevMode ? [{ debugName: "isLoadingMigration" }] : []);
    this.isRunningMigration = signal(false, ...ngDevMode ? [{ debugName: "isRunningMigration" }] : []);
    this.schedulerStatus = signal({
      isRunning: false,
      tasks: []
    }, ...ngDevMode ? [{ debugName: "schedulerStatus" }] : []);
    this.schedulerTab = signal("tasks", ...ngDevMode ? [{ debugName: "schedulerTab" }] : []);
    this.logFiles = signal([], ...ngDevMode ? [{ debugName: "logFiles" }] : []);
    this.logStats = signal({
      totalFiles: 0,
      totalSize: 0,
      totalSizeFormatted: "0 B",
      compressedFiles: 0,
      oldestFile: null,
      newestFile: null
    }, ...ngDevMode ? [{ debugName: "logStats" }] : []);
    this.isLoadingLogs = signal(false, ...ngDevMode ? [{ debugName: "isLoadingLogs" }] : []);
    this.isRotatingLogs = signal(false, ...ngDevMode ? [{ debugName: "isRotatingLogs" }] : []);
    this.selectedLogFile = signal(null, ...ngDevMode ? [{ debugName: "selectedLogFile" }] : []);
    this.logFileContent = signal("", ...ngDevMode ? [{ debugName: "logFileContent" }] : []);
    this.showResourceBatchMenu = signal(false, ...ngDevMode ? [{ debugName: "showResourceBatchMenu" }] : []);
    this.resourceBatchAction = signal(null, ...ngDevMode ? [{ debugName: "resourceBatchAction" }] : []);
    this.showMembershipDialog = signal(false, ...ngDevMode ? [{ debugName: "showMembershipDialog" }] : []);
    this.settingsTab = signal("backup", ...ngDevMode ? [{ debugName: "settingsTab" }] : []);
    this.vectorMemoryStats = signal({ totalMemories: 0, byType: {}, totalUsers: 0, avgImportance: 0 }, ...ngDevMode ? [{ debugName: "vectorMemoryStats" }] : []);
    this.vectorMemorySearchQuery = "";
    this.vectorMemorySearchResults = signal([], ...ngDevMode ? [{ debugName: "vectorMemorySearchResults" }] : []);
    this.isSearchingMemory = signal(false, ...ngDevMode ? [{ debugName: "isSearchingMemory" }] : []);
    this.isAddingMemory = signal(false, ...ngDevMode ? [{ debugName: "isAddingMemory" }] : []);
    this.showAddMemoryDialog = signal(false, ...ngDevMode ? [{ debugName: "showAddMemoryDialog" }] : []);
    this.newMemory = { userId: "", content: "", type: "conversation", importance: 0.5 };
    this.selectedMemoryUserId = signal("", ...ngDevMode ? [{ debugName: "selectedMemoryUserId" }] : []);
    this.memoryUserList = signal([], ...ngDevMode ? [{ debugName: "memoryUserList" }] : []);
    this.showVoiceRecordingDialog = signal(false, ...ngDevMode ? [{ debugName: "showVoiceRecordingDialog" }] : []);
    this.voiceCloneTab = signal("manage", ...ngDevMode ? [{ debugName: "voiceCloneTab" }] : []);
    this.messageMode = signal("manual", ...ngDevMode ? [{ debugName: "messageMode" }] : []);
    this.editableMessage = signal("", ...ngDevMode ? [{ debugName: "editableMessage" }] : []);
    this.selectedSenderId = signal(null, ...ngDevMode ? [{ debugName: "selectedSenderId" }] : []);
    this.aiApiKey = signal("", ...ngDevMode ? [{ debugName: "aiApiKey" }] : []);
    this.aiApiType = signal("gemini", ...ngDevMode ? [{ debugName: "aiApiType" }] : []);
    this.customApiEndpoint = signal("", ...ngDevMode ? [{ debugName: "customApiEndpoint" }] : []);
    this.showApiKey = signal(false, ...ngDevMode ? [{ debugName: "showApiKey" }] : []);
    this.isTestingAi = signal(false, ...ngDevMode ? [{ debugName: "isTestingAi" }] : []);
    this.aiConnectionStatus = signal(null, ...ngDevMode ? [{ debugName: "aiConnectionStatus" }] : []);
    this.aiConnectionError = signal("", ...ngDevMode ? [{ debugName: "aiConnectionError" }] : []);
    this.localAiEndpoint = signal("http://localhost:11434", ...ngDevMode ? [{ debugName: "localAiEndpoint" }] : []);
    this.localAiModel = signal("qwen2:7b", ...ngDevMode ? [{ debugName: "localAiModel" }] : []);
    this.localAiProvider = signal("ollama", ...ngDevMode ? [{ debugName: "localAiProvider" }] : []);
    this.isTestingLocalAi = signal(false, ...ngDevMode ? [{ debugName: "isTestingLocalAi" }] : []);
    this.localAiStatus = signal(null, ...ngDevMode ? [{ debugName: "localAiStatus" }] : []);
    this.localAiError = signal("", ...ngDevMode ? [{ debugName: "localAiError" }] : []);
    this.availableOllamaModels = signal([], ...ngDevMode ? [{ debugName: "availableOllamaModels" }] : []);
    this.aiAutoFallback = signal(true, ...ngDevMode ? [{ debugName: "aiAutoFallback" }] : []);
    this.aiBackupProvider = signal("gemini", ...ngDevMode ? [{ debugName: "aiBackupProvider" }] : []);
    this.aiShowProviderLabel = signal(true, ...ngDevMode ? [{ debugName: "aiShowProviderLabel" }] : []);
    this.isFirstRun = signal(false, ...ngDevMode ? [{ debugName: "isFirstRun" }] : []);
    this.showWelcomeDialog = signal(false, ...ngDevMode ? [{ debugName: "showWelcomeDialog" }] : []);
    this.welcomeStep = signal(1, ...ngDevMode ? [{ debugName: "welcomeStep" }] : []);
    this.isDetectingOllama = signal(false, ...ngDevMode ? [{ debugName: "isDetectingOllama" }] : []);
    this.ollamaDetected = signal(false, ...ngDevMode ? [{ debugName: "ollamaDetected" }] : []);
    this.detectedOllamaModels = signal([], ...ngDevMode ? [{ debugName: "detectedOllamaModels" }] : []);
    this.autoSelectedModel = signal("", ...ngDevMode ? [{ debugName: "autoSelectedModel" }] : []);
    this.backendRunning = signal(true, ...ngDevMode ? [{ debugName: "backendRunning" }] : []);
    this.backendError = signal("", ...ngDevMode ? [{ debugName: "backendError" }] : []);
    this.showBackendErrorDialog = signal(false, ...ngDevMode ? [{ debugName: "showBackendErrorDialog" }] : []);
    this.showOrphanSessionDialog = signal(false, ...ngDevMode ? [{ debugName: "showOrphanSessionDialog" }] : []);
    this.orphanSessions = signal([], ...ngDevMode ? [{ debugName: "orphanSessions" }] : []);
    this.isRecoveringOrphanSessions = signal(false, ...ngDevMode ? [{ debugName: "isRecoveringOrphanSessions" }] : []);
    this.showMembershipStats = signal(false, ...ngDevMode ? [{ debugName: "showMembershipStats" }] : []);
    this.ttsEndpoint = signal("", ...ngDevMode ? [{ debugName: "ttsEndpoint" }] : []);
    this.ttsEnabled = signal(false, ...ngDevMode ? [{ debugName: "ttsEnabled" }] : []);
    this.ttsVoice = signal("", ...ngDevMode ? [{ debugName: "ttsVoice" }] : []);
    this.isTestingTts = signal(false, ...ngDevMode ? [{ debugName: "isTestingTts" }] : []);
    this.ttsStatus = signal(null, ...ngDevMode ? [{ debugName: "ttsStatus" }] : []);
    this.ttsError = signal("", ...ngDevMode ? [{ debugName: "ttsError" }] : []);
    this.sttEndpoint = signal("", ...ngDevMode ? [{ debugName: "sttEndpoint" }] : []);
    this.sttEnabled = signal(false, ...ngDevMode ? [{ debugName: "sttEnabled" }] : []);
    this.isTestingStt = signal(false, ...ngDevMode ? [{ debugName: "isTestingStt" }] : []);
    this.sttStatus = signal(null, ...ngDevMode ? [{ debugName: "sttStatus" }] : []);
    this.sttError = signal("", ...ngDevMode ? [{ debugName: "sttError" }] : []);
    this.aiAutoChatEnabled = signal(false, ...ngDevMode ? [{ debugName: "aiAutoChatEnabled" }] : []);
    this.aiAutoChatMode = signal("semi", ...ngDevMode ? [{ debugName: "aiAutoChatMode" }] : []);
    this.aiTypingSpeed = signal(50, ...ngDevMode ? [{ debugName: "aiTypingSpeed" }] : []);
    this.aiReplyDelay = signal([2, 8], ...ngDevMode ? [{ debugName: "aiReplyDelay" }] : []);
    this.aiSystemPrompt = signal("", ...ngDevMode ? [{ debugName: "aiSystemPrompt" }] : []);
    this.aiMaxContextMessages = signal(20, ...ngDevMode ? [{ debugName: "aiMaxContextMessages" }] : []);
    this.aiEnableMemory = signal(true, ...ngDevMode ? [{ debugName: "aiEnableMemory" }] : []);
    this.aiAutoGreeting = signal(false, ...ngDevMode ? [{ debugName: "aiAutoGreeting" }] : []);
    this.aiGreetingMessage = signal("", ...ngDevMode ? [{ debugName: "aiGreetingMessage" }] : []);
    this.ragEnabled = signal(true, ...ngDevMode ? [{ debugName: "ragEnabled" }] : []);
    this.aiGreetingSuggestion = signal(null, ...ngDevMode ? [{ debugName: "aiGreetingSuggestion" }] : []);
    this.showAiGreetingDialog = signal(false, ...ngDevMode ? [{ debugName: "showAiGreetingDialog" }] : []);
    this.knowledgeStats = signal({
      documents: 0,
      images: 0,
      videos: 0,
      qa_pairs: 0
    }, ...ngDevMode ? [{ debugName: "knowledgeStats" }] : []);
    this.knowledgeDocuments = signal([], ...ngDevMode ? [{ debugName: "knowledgeDocuments" }] : []);
    this.knowledgeImages = signal([], ...ngDevMode ? [{ debugName: "knowledgeImages" }] : []);
    this.knowledgeVideos = signal([], ...ngDevMode ? [{ debugName: "knowledgeVideos" }] : []);
    this.knowledgeQaPairs = signal([], ...ngDevMode ? [{ debugName: "knowledgeQaPairs" }] : []);
    this.knowledgeTab = signal("documents", ...ngDevMode ? [{ debugName: "knowledgeTab" }] : []);
    this.isLoadingKnowledge = signal(false, ...ngDevMode ? [{ debugName: "isLoadingKnowledge" }] : []);
    this.showAddDocumentDialog = signal(false, ...ngDevMode ? [{ debugName: "showAddDocumentDialog" }] : []);
    this.showAddMediaDialog = signal(false, ...ngDevMode ? [{ debugName: "showAddMediaDialog" }] : []);
    this.showAddQaDialog = signal(false, ...ngDevMode ? [{ debugName: "showAddQaDialog" }] : []);
    this.newDocument = signal({ title: "", category: "general", tags: "", content: "" }, ...ngDevMode ? [{ debugName: "newDocument" }] : []);
    this.newMedia = signal({ name: "", category: "general", description: "", mediaType: "image" }, ...ngDevMode ? [{ debugName: "newMedia" }] : []);
    this.newQaPair = signal({ question: "", answer: "", category: "general", keywords: "" }, ...ngDevMode ? [{ debugName: "newQaPair" }] : []);
    this.ragSystemInitialized = signal(false, ...ngDevMode ? [{ debugName: "ragSystemInitialized" }] : []);
    this.isInitializingRag = signal(false, ...ngDevMode ? [{ debugName: "isInitializingRag" }] : []);
    this.isRagLearning = signal(false, ...ngDevMode ? [{ debugName: "isRagLearning" }] : []);
    this.isReindexing = signal(false, ...ngDevMode ? [{ debugName: "isReindexing" }] : []);
    this.isCleaningRag = signal(false, ...ngDevMode ? [{ debugName: "isCleaningRag" }] : []);
    this.isSearchingRag = signal(false, ...ngDevMode ? [{ debugName: "isSearchingRag" }] : []);
    this.ragSearchQuery = "";
    this.ragSearchResults = signal([], ...ngDevMode ? [{ debugName: "ragSearchResults" }] : []);
    this.ragStats = signal({
      total_knowledge: 0,
      qa_count: 0,
      scripts_count: 0,
      total_uses: 0,
      avg_score: 0,
      chromadb_enabled: false,
      neural_embedding: false,
      by_type: {}
    }, ...ngDevMode ? [{ debugName: "ragStats" }] : []);
    this.showAddRagKnowledgeDialog = signal(false, ...ngDevMode ? [{ debugName: "showAddRagKnowledgeDialog" }] : []);
    this.newRagKnowledge = { type: "qa", question: "", answer: "", context: "" };
    this.ragTypeKeys = computed(() => Object.keys(this.ragStats().by_type), ...ngDevMode ? [{ debugName: "ragTypeKeys" }] : []);
    this.resourceDiscoveryInitialized = signal(false, ...ngDevMode ? [{ debugName: "resourceDiscoveryInitialized" }] : []);
    this.isSearchingResources = signal(false, ...ngDevMode ? [{ debugName: "isSearchingResources" }] : []);
    this.isProcessingJoinQueue = signal(false, ...ngDevMode ? [{ debugName: "isProcessingJoinQueue" }] : []);
    this.resourceSearchQuery = "";
    this.pendingSearchQuery = "";
    this.resourceSearchType = signal("all", ...ngDevMode ? [{ debugName: "resourceSearchType" }] : []);
    this.searchError = signal({ hasError: false, message: "", details: "", suggestions: [] }, ...ngDevMode ? [{ debugName: "searchError" }] : []);
    this.currentSearchSessionId = signal("", ...ngDevMode ? [{ debugName: "currentSearchSessionId" }] : []);
    this.currentSearchKeyword = signal("", ...ngDevMode ? [{ debugName: "currentSearchKeyword" }] : []);
    this.showSearchHistory = signal(false, ...ngDevMode ? [{ debugName: "showSearchHistory" }] : []);
    this.searchHistoryKeywords = signal([], ...ngDevMode ? [{ debugName: "searchHistoryKeywords" }] : []);
    this.savedResources = signal(/* @__PURE__ */ new Set(), ...ngDevMode ? [{ debugName: "savedResources" }] : []);
    this.showSearchSuggestions = signal(false, ...ngDevMode ? [{ debugName: "showSearchSuggestions" }] : []);
    this.hotSearchKeywords = signal(["\u652F\u4ED8", "USDT", "\u4EA4\u6613", "\u62DB\u8058", "\u4EE3\u8CFC", "\u52A0\u5BC6\u8CA8\u5E63", "\u96FB\u5F71", "\u97F3\u6A02", "\u8CC7\u6E90\u5206\u4EAB", "\u4EA4\u6D41\u7FA4"], ...ngDevMode ? [{ debugName: "hotSearchKeywords" }] : []);
    this.resourceAccountId = signal(null, ...ngDevMode ? [{ debugName: "resourceAccountId" }] : []);
    this.showResourceAccountSelector = signal(false, ...ngDevMode ? [{ debugName: "showResourceAccountSelector" }] : []);
    this.resourceMinMembers = signal(0, ...ngDevMode ? [{ debugName: "resourceMinMembers" }] : []);
    this.showSearchOptions = signal(false, ...ngDevMode ? [{ debugName: "showSearchOptions" }] : []);
    this.searchReplaceMode = signal(true, ...ngDevMode ? [{ debugName: "searchReplaceMode" }] : []);
    this.isRefreshing = signal(false, ...ngDevMode ? [{ debugName: "isRefreshing" }] : []);
    this.linkAnalysisInput = "";
    this.isAnalyzingLink = signal(false, ...ngDevMode ? [{ debugName: "isAnalyzingLink" }] : []);
    this.discoveredResources = signal([], ...ngDevMode ? [{ debugName: "discoveredResources" }] : []);
    this.resourceStats = signal({
      total_resources: 0,
      by_status: {},
      by_type: {},
      today_discovered: 0,
      pending_joins: 0,
      joined_count: 0,
      avg_score: 0
    }, ...ngDevMode ? [{ debugName: "resourceStats" }] : []);
    this.discoveryKeywords = signal([], ...ngDevMode ? [{ debugName: "discoveryKeywords" }] : []);
    this.showAddResourceDialog = signal(false, ...ngDevMode ? [{ debugName: "showAddResourceDialog" }] : []);
    this.showAddKeywordDialog = signal(false, ...ngDevMode ? [{ debugName: "showAddKeywordDialog" }] : []);
    this.showChannelManageDialog = signal(false, ...ngDevMode ? [{ debugName: "showChannelManageDialog" }] : []);
    this.showAddChannelDialog = signal(false, ...ngDevMode ? [{ debugName: "showAddChannelDialog" }] : []);
    this.newResourceKeyword = "";
    this.systemChannels = signal([], ...ngDevMode ? [{ debugName: "systemChannels" }] : []);
    this.customChannels = signal([], ...ngDevMode ? [{ debugName: "customChannels" }] : []);
    this.newChannelUsername = "";
    this.newChannelDisplayName = "";
    this.newChannelQueryFormat = "{keyword}";
    this.newChannelPriority = "backup";
    this.showJoinMonitorDialog = signal(false, ...ngDevMode ? [{ debugName: "showJoinMonitorDialog" }] : []);
    this.joinMonitorResource = signal(null, ...ngDevMode ? [{ debugName: "joinMonitorResource" }] : []);
    this.joinMonitorSelectedPhone = signal("", ...ngDevMode ? [{ debugName: "joinMonitorSelectedPhone" }] : []);
    this.joinMonitorSelectedPhones = signal([], ...ngDevMode ? [{ debugName: "joinMonitorSelectedPhones" }] : []);
    this.joinMonitorKeywords = signal([], ...ngDevMode ? [{ debugName: "joinMonitorKeywords" }] : []);
    this.joinMonitorSelectedKeywordSetIds = signal([], ...ngDevMode ? [{ debugName: "joinMonitorSelectedKeywordSetIds" }] : []);
    this.joinMonitorNewKeyword = "";
    this.joinMonitorAutoEnable = signal(true, ...ngDevMode ? [{ debugName: "joinMonitorAutoEnable" }] : []);
    this.joinMonitorBatchMode = signal(true, ...ngDevMode ? [{ debugName: "joinMonitorBatchMode" }] : []);
    this.joinMonitorBatchInterval = signal(45, ...ngDevMode ? [{ debugName: "joinMonitorBatchInterval" }] : []);
    this.isJoiningResource = signal(false, ...ngDevMode ? [{ debugName: "isJoiningResource" }] : []);
    this.showQuickCreateKeywordSet = signal(false, ...ngDevMode ? [{ debugName: "showQuickCreateKeywordSet" }] : []);
    this.quickCreateKeywordSetName = "";
    this.showChangeMonitorAccount = signal(false, ...ngDevMode ? [{ debugName: "showChangeMonitorAccount" }] : []);
    this.openResourceMenuId = signal(null, ...ngDevMode ? [{ debugName: "openResourceMenuId" }] : []);
    this.quickCreateKeywordSetKeywords = signal([], ...ngDevMode ? [{ debugName: "quickCreateKeywordSetKeywords" }] : []);
    this.quickCreateKeywordSetNewKeyword = "";
    this.showBatchJoinMonitorDialog = signal(false, ...ngDevMode ? [{ debugName: "showBatchJoinMonitorDialog" }] : []);
    this.batchJoinResources = signal([], ...ngDevMode ? [{ debugName: "batchJoinResources" }] : []);
    this.batchJoinProgress = signal({ current: 0, total: 0, status: "" }, ...ngDevMode ? [{ debugName: "batchJoinProgress" }] : []);
    this.showMemberListDialog = signal(false, ...ngDevMode ? [{ debugName: "showMemberListDialog" }] : []);
    this.memberListResource = signal(null, ...ngDevMode ? [{ debugName: "memberListResource" }] : []);
    this.memberListData = signal([], ...ngDevMode ? [{ debugName: "memberListData" }] : []);
    this.memberListLoading = signal(false, ...ngDevMode ? [{ debugName: "memberListLoading" }] : []);
    this.memberListProgress = signal({ extracted: 0, total: 0, status: "" }, ...ngDevMode ? [{ debugName: "memberListProgress" }] : []);
    this.selectedMemberIds = signal([], ...ngDevMode ? [{ debugName: "selectedMemberIds" }] : []);
    this.memberExtractStarted = signal(false, ...ngDevMode ? [{ debugName: "memberExtractStarted" }] : []);
    this.memberListFilter = signal("all", ...ngDevMode ? [{ debugName: "memberListFilter" }] : []);
    this.memberExtractConfig = signal({
      limit: 500,
      customLimit: 1e3,
      backgroundMode: false,
      // 用戶類型
      userTypes: {
        chinese: false,
        // 華人用戶
        overseas: false
        // 海外用戶
      },
      // 活躍度篩選
      activityFilters: {
        onlineNow: false,
        // 現在在線
        within3Days: false,
        // 3天內上線
        within7Days: false,
        // 7天內上線
        within30Days: false,
        // 30天內上線
        longOffline: false
        // 長期離線（>30天）
      },
      // 帳號特徵
      accountFeatures: {
        premium: false,
        // Premium 用戶
        hasUsername: false,
        // 有用戶名
        hasPhoto: false,
        // 有頭像
        newAccount: false,
        // 新號
        activeAccount: false,
        // 活躍號
        verified: false
        // 已認證
      },
      // 排除項
      excludeFilters: {
        bots: true,
        // 排除 Bot
        scam: true,
        // 排除詐騙標記
        deleted: true
        // 排除已刪除
      }
    }, ...ngDevMode ? [{ debugName: "memberExtractConfig" }] : []);
    this.extractPresets = [
      {
        id: "precise",
        name: "\u{1F3AF} \u7CBE\u6E96\u6D3B\u8E8D",
        desc: "\u73FE\u5728\u5728\u7DDA+\u6709\u7528\u6236\u540D",
        config: {
          activityFilters: { onlineNow: true, within3Days: true },
          accountFeatures: { hasUsername: true }
        }
      },
      {
        id: "chinese",
        name: "\u{1F1E8}\u{1F1F3} \u83EF\u4EBA\u512A\u5148",
        desc: "\u83EF\u4EBA+7\u5929\u5167\u6D3B\u8E8D",
        config: {
          userTypes: { chinese: true },
          activityFilters: { within7Days: true }
        }
      },
      {
        id: "premium",
        name: "\u{1F48E} \u9AD8\u50F9\u503C",
        desc: "Premium+\u6D3B\u8E8D\u7528\u6236",
        config: {
          accountFeatures: { premium: true },
          activityFilters: { within7Days: true }
        }
      },
      {
        id: "all",
        name: "\u{1F4E6} \u5168\u90E8\u63D0\u53D6",
        desc: "\u4E0D\u7BE9\u9078\uFF0C\u63D0\u53D6\u6240\u6709",
        config: {}
      }
    ];
    this.selectedPreset = signal("", ...ngDevMode ? [{ debugName: "selectedPreset" }] : []);
    this.showExtractionSummaryDialog = signal(false, ...ngDevMode ? [{ debugName: "showExtractionSummaryDialog" }] : []);
    this.extractionSummary = signal({
      groupName: "",
      groupUrl: "",
      totalExtracted: 0,
      totalInGroup: 0,
      onlineCount: 0,
      recentlyCount: 0,
      premiumCount: 0,
      chineseCount: 0,
      hasUsernameCount: 0,
      botCount: 0,
      valueLevelDistribution: { S: 0, A: 0, B: 0, C: 0, D: 0 },
      extractedAt: "",
      duration: 0
    }, ...ngDevMode ? [{ debugName: "extractionSummary" }] : []);
    this.extractionStartTime = signal(0, ...ngDevMode ? [{ debugName: "extractionStartTime" }] : []);
    this.showMemberExtractionDialog = signal(false, ...ngDevMode ? [{ debugName: "showMemberExtractionDialog" }] : []);
    this.memberExtractionGroup = signal(null, ...ngDevMode ? [{ debugName: "memberExtractionGroup" }] : []);
    this.showSingleMessageDialog = signal(false, ...ngDevMode ? [{ debugName: "showSingleMessageDialog" }] : []);
    this.singleMessageResource = signal(null, ...ngDevMode ? [{ debugName: "singleMessageResource" }] : []);
    this.singleMessageContent = "";
    this.singleMessageScheduled = signal(false, ...ngDevMode ? [{ debugName: "singleMessageScheduled" }] : []);
    this.singleMessageScheduleTime = "";
    this.singleMessageAccountId = signal("", ...ngDevMode ? [{ debugName: "singleMessageAccountId" }] : []);
    this.accountQuotas = signal([], ...ngDevMode ? [{ debugName: "accountQuotas" }] : []);
    this.newChannelNotes = "";
    this.isTestingChannel = signal(false, ...ngDevMode ? [{ debugName: "isTestingChannel" }] : []);
    this.selectedResourceIds = signal([], ...ngDevMode ? [{ debugName: "selectedResourceIds" }] : []);
    this.resourceFilterStatus = signal("", ...ngDevMode ? [{ debugName: "resourceFilterStatus" }] : []);
    this.resourceFilterType = signal("", ...ngDevMode ? [{ debugName: "resourceFilterType" }] : []);
    this.resourceFilterLink = signal("", ...ngDevMode ? [{ debugName: "resourceFilterLink" }] : []);
    this.selectedSearchSources = signal(["telegram", "jiso"], ...ngDevMode ? [{ debugName: "selectedSearchSources" }] : []);
    this.showBatchJoinMenu = signal(false, ...ngDevMode ? [{ debugName: "showBatchJoinMenu" }] : []);
    this.searchResultsCache = /* @__PURE__ */ new Map();
    this.CACHE_EXPIRY_MS = 5 * 60 * 1e3;
    this.showBatchMessageDialog = signal(false, ...ngDevMode ? [{ debugName: "showBatchMessageDialog" }] : []);
    this.showBatchInviteDialog = signal(false, ...ngDevMode ? [{ debugName: "showBatchInviteDialog" }] : []);
    this.batchMessageContent = "";
    this.batchMessageTargets = [];
    this.batchMessageConfig = {
      delayMin: 60,
      delayMax: 120,
      dailyLimit: 50,
      smartAntiBlock: true,
      accountMode: "rotate",
      // 'rotate' 或特定帳號 phone
      scheduled: false,
      scheduleTime: ""
    };
    this.batchInviteConfig = {
      selectedMemberIds: [],
      selectAll: false,
      delayMin: 120,
      delayMax: 300,
      perGroupLimit: 10,
      smartAntiBlock: true
    };
    this.availableMembersForInvite = signal([], ...ngDevMode ? [{ debugName: "availableMembersForInvite" }] : []);
    this.discussionWatcherInitialized = signal(false, ...ngDevMode ? [{ debugName: "discussionWatcherInitialized" }] : []);
    this.channelDiscussions = signal([], ...ngDevMode ? [{ debugName: "channelDiscussions" }] : []);
    this.discussionMessages = signal([], ...ngDevMode ? [{ debugName: "discussionMessages" }] : []);
    this.discussionStats = signal({
      total_discussions: 0,
      monitoring_count: 0,
      total_messages: 0,
      matched_messages: 0,
      leads_from_discussions: 0,
      today_messages: 0,
      today_leads: 0
    }, ...ngDevMode ? [{ debugName: "discussionStats" }] : []);
    this.selectedDiscussionId = signal("", ...ngDevMode ? [{ debugName: "selectedDiscussionId" }] : []);
    this.discoverChannelId = "";
    this.resourcesTab = signal("resources", ...ngDevMode ? [{ debugName: "resourcesTab" }] : []);
    this.resourceCenterTab = signal("manage", ...ngDevMode ? [{ debugName: "resourceCenterTab" }] : []);
    this.isLoadingDiscussionMessages = signal(false, ...ngDevMode ? [{ debugName: "isLoadingDiscussionMessages" }] : []);
    this.discussionReplyText = signal("", ...ngDevMode ? [{ debugName: "discussionReplyText" }] : []);
    this.clonedVoices = signal([], ...ngDevMode ? [{ debugName: "clonedVoices" }] : []);
    this.selectedClonedVoice = signal("", ...ngDevMode ? [{ debugName: "selectedClonedVoice" }] : []);
    this.isUploadingVoice = signal(false, ...ngDevMode ? [{ debugName: "isUploadingVoice" }] : []);
    this.voiceUploadProgress = signal(0, ...ngDevMode ? [{ debugName: "voiceUploadProgress" }] : []);
    this.voiceCloneError = signal("", ...ngDevMode ? [{ debugName: "voiceCloneError" }] : []);
    this.isRecording = signal(false, ...ngDevMode ? [{ debugName: "isRecording" }] : []);
    this.recordingTime = signal(0, ...ngDevMode ? [{ debugName: "recordingTime" }] : []);
    this.recordingTimer = null;
    this.mediaRecorder = null;
    this.audioChunks = [];
    this.voicePromptText = signal("", ...ngDevMode ? [{ debugName: "voicePromptText" }] : []);
    this.voiceName = signal("", ...ngDevMode ? [{ debugName: "voiceName" }] : []);
    this.showRecordingDialog = signal(false, ...ngDevMode ? [{ debugName: "showRecordingDialog" }] : []);
    this.recordedAudioBlob = signal(null, ...ngDevMode ? [{ debugName: "recordedAudioBlob" }] : []);
    this.recordedAudioUrl = signal("", ...ngDevMode ? [{ debugName: "recordedAudioUrl" }] : []);
    this.accounts = signal([], ...ngDevMode ? [{ debugName: "accounts" }] : []);
    this.keywordSets = signal([], ...ngDevMode ? [{ debugName: "keywordSets" }] : []);
    this.monitoredGroups = signal([], ...ngDevMode ? [{ debugName: "monitoredGroups" }] : []);
    this.leads = signal([], ...ngDevMode ? [{ debugName: "leads" }] : []);
    this.leadsTotal = signal(0, ...ngDevMode ? [{ debugName: "leadsTotal" }] : []);
    this.leadsHasMore = signal(false, ...ngDevMode ? [{ debugName: "leadsHasMore" }] : []);
    this.leadsLoading = signal(false, ...ngDevMode ? [{ debugName: "leadsLoading" }] : []);
    this.logs = signal([], ...ngDevMode ? [{ debugName: "logs" }] : []);
    this.selectedLeadForInvite = signal(null, ...ngDevMode ? [{ debugName: "selectedLeadForInvite" }] : []);
    this.showInviteGroupDialog = signal(false, ...ngDevMode ? [{ debugName: "showInviteGroupDialog" }] : []);
    this.realtimeMatches = signal([], ...ngDevMode ? [{ debugName: "realtimeMatches" }] : []);
    this.todayStats = signal({
      matchCount: 0,
      newLeads: 0,
      messagesSent: 0,
      conversions: 0
    }, ...ngDevMode ? [{ debugName: "todayStats" }] : []);
    this.chatList = signal([], ...ngDevMode ? [{ debugName: "chatList" }] : []);
    this.chatHistory = signal([], ...ngDevMode ? [{ debugName: "chatHistory" }] : []);
    this.selectedChatUserId = signal(null, ...ngDevMode ? [{ debugName: "selectedChatUserId" }] : []);
    this.isLoadingChatHistory = signal(false, ...ngDevMode ? [{ debugName: "isLoadingChatHistory" }] : []);
    this.chatListSearch = signal("", ...ngDevMode ? [{ debugName: "chatListSearch" }] : []);
    this.chatListFunnelFilter = signal("", ...ngDevMode ? [{ debugName: "chatListFunnelFilter" }] : []);
    this.chatHistoryPage = signal(0, ...ngDevMode ? [{ debugName: "chatHistoryPage" }] : []);
    this.chatHistoryPageSize = signal(50, ...ngDevMode ? [{ debugName: "chatHistoryPageSize" }] : []);
    this.chatHistoryHasMore = signal(false, ...ngDevMode ? [{ debugName: "chatHistoryHasMore" }] : []);
    this.chatHistoryLoadingMore = signal(false, ...ngDevMode ? [{ debugName: "chatHistoryLoadingMore" }] : []);
    this.chatHistoryAllMessages = signal([], ...ngDevMode ? [{ debugName: "chatHistoryAllMessages" }] : []);
    this.lastQueueStatusRefresh = 0;
    this.queueStatuses = signal({}, ...ngDevMode ? [{ debugName: "queueStatuses" }] : []);
    this.queueMessages = signal([], ...ngDevMode ? [{ debugName: "queueMessages" }] : []);
    this.selectedQueuePhone = signal(null, ...ngDevMode ? [{ debugName: "selectedQueuePhone" }] : []);
    this.queueStats = signal({
      pending: 0,
      sending: 0,
      sent: 0,
      failed: 0,
      retrying: 0,
      totalToday: 0,
      successRate: 0,
      avgSendTime: 0
    }, ...ngDevMode ? [{ debugName: "queueStats" }] : []);
    this.sendingStatsData = signal(null, ...ngDevMode ? [{ debugName: "sendingStatsData" }] : []);
    this.queueLengthHistoryData = signal(null, ...ngDevMode ? [{ debugName: "queueLengthHistoryData" }] : []);
    this.accountComparisonData = signal(null, ...ngDevMode ? [{ debugName: "accountComparisonData" }] : []);
    this.campaignPerformanceData = signal(null, ...ngDevMode ? [{ debugName: "campaignPerformanceData" }] : []);
    this.alerts = signal([], ...ngDevMode ? [{ debugName: "alerts" }] : []);
    this.unacknowledgedAlertsCount = computed(() => this.alerts().filter((a) => !a.acknowledged && !a.resolved).length, ...ngDevMode ? [{ debugName: "unacknowledgedAlertsCount" }] : []);
    this.selectedLeadIds = signal(/* @__PURE__ */ new Set(), ...ngDevMode ? [{ debugName: "selectedLeadIds" }] : []);
    this.isSelectAllLeads = signal(false, ...ngDevMode ? [{ debugName: "isSelectAllLeads" }] : []);
    this.showBatchOperationMenu = signal(false, ...ngDevMode ? [{ debugName: "showBatchOperationMenu" }] : []);
    this.showFloatingMoreMenu = signal(false, ...ngDevMode ? [{ debugName: "showFloatingMoreMenu" }] : []);
    this.batchOperationInProgress = signal(false, ...ngDevMode ? [{ debugName: "batchOperationInProgress" }] : []);
    this.batchOperationHistory = signal([], ...ngDevMode ? [{ debugName: "batchOperationHistory" }] : []);
    this.showBatchOperationHistory = signal(false, ...ngDevMode ? [{ debugName: "showBatchOperationHistory" }] : []);
    this.allTags = signal([], ...ngDevMode ? [{ debugName: "allTags" }] : []);
    this.newTagName = signal("", ...ngDevMode ? [{ debugName: "newTagName" }] : []);
    this.newTagColor = signal("#3B82F6", ...ngDevMode ? [{ debugName: "newTagColor" }] : []);
    this.showAddTagDialog = signal(false, ...ngDevMode ? [{ debugName: "showAddTagDialog" }] : []);
    this.batchTagInput = signal("", ...ngDevMode ? [{ debugName: "batchTagInput" }] : []);
    this.showBatchTagSelector = signal(false, ...ngDevMode ? [{ debugName: "showBatchTagSelector" }] : []);
    this.showBatchRemoveTagSelector = signal(false, ...ngDevMode ? [{ debugName: "showBatchRemoveTagSelector" }] : []);
    this.leadSearchQuery = signal("", ...ngDevMode ? [{ debugName: "leadSearchQuery" }] : []);
    this.leadSearchResults = signal([], ...ngDevMode ? [{ debugName: "leadSearchResults" }] : []);
    this.isSearchingLeads = signal(false, ...ngDevMode ? [{ debugName: "isSearchingLeads" }] : []);
    this.leadSearchTimeout = null;
    this.backups = signal([], ...ngDevMode ? [{ debugName: "backups" }] : []);
    this.isCreatingBackup = signal(false, ...ngDevMode ? [{ debugName: "isCreatingBackup" }] : []);
    this.isRestoringBackup = signal(false, ...ngDevMode ? [{ debugName: "isRestoringBackup" }] : []);
    this.selectedLeadsCount = computed(() => this.selectedLeadIds().size, ...ngDevMode ? [{ debugName: "selectedLeadsCount" }] : []);
    this.hasSelectedLeads = computed(() => this.selectedLeadIds().size > 0, ...ngDevMode ? [{ debugName: "hasSelectedLeads" }] : []);
    this.adTemplates = signal([], ...ngDevMode ? [{ debugName: "adTemplates" }] : []);
    this.adSchedules = signal([], ...ngDevMode ? [{ debugName: "adSchedules" }] : []);
    this.adSendLogs = signal([], ...ngDevMode ? [{ debugName: "adSendLogs" }] : []);
    this.adOverviewStats = signal(null, ...ngDevMode ? [{ debugName: "adOverviewStats" }] : []);
    this.showAdTemplateForm = signal(false, ...ngDevMode ? [{ debugName: "showAdTemplateForm" }] : []);
    this.showAdScheduleForm = signal(false, ...ngDevMode ? [{ debugName: "showAdScheduleForm" }] : []);
    this.editingAdTemplate = signal(null, ...ngDevMode ? [{ debugName: "editingAdTemplate" }] : []);
    this.editingAdSchedule = signal(null, ...ngDevMode ? [{ debugName: "editingAdSchedule" }] : []);
    this.newAdTemplate = signal({ name: "", content: "", mediaType: "text" }, ...ngDevMode ? [{ debugName: "newAdTemplate" }] : []);
    this.newAdSchedule = signal({
      name: "",
      templateId: 0,
      targetGroups: [],
      sendMode: "scheduled",
      scheduleType: "once",
      scheduleTime: "",
      intervalMinutes: 60,
      triggerKeywords: [],
      accountStrategy: "rotate",
      assignedAccounts: []
    }, ...ngDevMode ? [{ debugName: "newAdSchedule" }] : []);
    this.spintaxPreview = signal([], ...ngDevMode ? [{ debugName: "spintaxPreview" }] : []);
    this.isPreviewingSpintax = signal(false, ...ngDevMode ? [{ debugName: "isPreviewingSpintax" }] : []);
    this.adSystemTab = signal("templates", ...ngDevMode ? [{ debugName: "adSystemTab" }] : []);
    this.trackedUsers = signal([], ...ngDevMode ? [{ debugName: "trackedUsers" }] : []);
    this.userGroups = signal([], ...ngDevMode ? [{ debugName: "userGroups" }] : []);
    this.highValueGroups = signal([], ...ngDevMode ? [{ debugName: "highValueGroups" }] : []);
    this.trackingStats = signal(null, ...ngDevMode ? [{ debugName: "trackingStats" }] : []);
    this.showAddUserForm = signal(false, ...ngDevMode ? [{ debugName: "showAddUserForm" }] : []);
    this.newTrackedUser = signal({ userId: "", username: "", notes: "" }, ...ngDevMode ? [{ debugName: "newTrackedUser" }] : []);
    this.selectedTrackedUser = signal(null, ...ngDevMode ? [{ debugName: "selectedTrackedUser" }] : []);
    this.isTrackingUser = signal(false, ...ngDevMode ? [{ debugName: "isTrackingUser" }] : []);
    this.userTrackingTab = signal("users", ...ngDevMode ? [{ debugName: "userTrackingTab" }] : []);
    this.userValueFilter = signal("", ...ngDevMode ? [{ debugName: "userValueFilter" }] : []);
    this.selectedCampaign = signal(null, ...ngDevMode ? [{ debugName: "selectedCampaign" }] : []);
    this.unifiedOverview = signal(null, ...ngDevMode ? [{ debugName: "unifiedOverview" }] : []);
    this.funnelAnalysis = signal(null, ...ngDevMode ? [{ debugName: "funnelAnalysis" }] : []);
    this.showCampaignForm = signal(false, ...ngDevMode ? [{ debugName: "showCampaignForm" }] : []);
    this.campaignKeywordInput = signal("", ...ngDevMode ? [{ debugName: "campaignKeywordInput" }] : []);
    this.campaignFormData = signal({
      name: "",
      description: "",
      phases: ["discovery", "monitoring", "outreach"],
      keywords: [],
      targetGroups: [],
      assignedAccounts: []
    }, ...ngDevMode ? [{ debugName: "campaignFormData" }] : []);
    this.roleTemplates = signal({}, ...ngDevMode ? [{ debugName: "roleTemplates" }] : []);
    this.allRoles = signal([], ...ngDevMode ? [{ debugName: "allRoles" }] : []);
    this.scriptTemplates = signal([], ...ngDevMode ? [{ debugName: "scriptTemplates" }] : []);
    this.collabGroups = signal([], ...ngDevMode ? [{ debugName: "collabGroups" }] : []);
    this.collabStats = signal(null, ...ngDevMode ? [{ debugName: "collabStats" }] : []);
    this.roleStats = signal(null, ...ngDevMode ? [{ debugName: "roleStats" }] : []);
    this.showRoleAssignForm = signal(false, ...ngDevMode ? [{ debugName: "showRoleAssignForm" }] : []);
    this.multiRoleTab = signal("roles", ...ngDevMode ? [{ debugName: "multiRoleTab" }] : []);
    this.newRoleAssign = signal({
      accountPhone: "",
      roleType: "seller",
      roleName: ""
    }, ...ngDevMode ? [{ debugName: "newRoleAssign" }] : []);
    this.validationErrors = signal({}, ...ngDevMode ? [{ debugName: "validationErrors" }] : []);
    this.progressDialog = signal({
      show: false,
      title: "\u5904\u7406\u4E2D...",
      progress: { current: 0, total: 0 },
      cancellable: false
    }, ...ngDevMode ? [{ debugName: "progressDialog" }] : []);
    this.logFilterType = signal("", ...ngDevMode ? [{ debugName: "logFilterType" }] : []);
    this.logFilterStartDate = signal("", ...ngDevMode ? [{ debugName: "logFilterStartDate" }] : []);
    this.logFilterEndDate = signal("", ...ngDevMode ? [{ debugName: "logFilterEndDate" }] : []);
    this.logFilterSearch = signal("", ...ngDevMode ? [{ debugName: "logFilterSearch" }] : []);
    this.filteredLogs = computed(() => {
      const allLogs = this.logs();
      const type = this.logFilterType();
      const startDate = this.logFilterStartDate();
      const endDate = this.logFilterEndDate();
      const search = this.logFilterSearch();
      return allLogs.filter((log) => {
        if (type && log.type !== type) {
          return false;
        }
        if (startDate) {
          const start = new Date(startDate);
          if (log.timestamp < start) {
            return false;
          }
        }
        if (endDate) {
          const end = new Date(endDate);
          end.setHours(23, 59, 59, 999);
          if (log.timestamp > end) {
            return false;
          }
        }
        if (search) {
          const searchLower = search.toLowerCase();
          if (!log.message.toLowerCase().includes(searchLower)) {
            return false;
          }
        }
        return true;
      });
    }, ...ngDevMode ? [{ debugName: "filteredLogs" }] : []);
    this.generationState = signal({ status: "idle", lead: null, generatedMessage: "", error: null, customPrompt: "", attachment: null, attachments: [] }, ...ngDevMode ? [{ debugName: "generationState" }] : []);
    this.messageTemplates = signal([], ...ngDevMode ? [{ debugName: "messageTemplates" }] : []);
    this.doNotContactList = signal(/* @__PURE__ */ new Set(), ...ngDevMode ? [{ debugName: "doNotContactList" }] : []);
    this.campaigns = signal([], ...ngDevMode ? [{ debugName: "campaigns" }] : []);
    this.spintaxEnabled = signal(true, ...ngDevMode ? [{ debugName: "spintaxEnabled" }] : []);
    this.autoReplyEnabled = signal(false, ...ngDevMode ? [{ debugName: "autoReplyEnabled" }] : []);
    this.autoReplyMessage = signal("Thanks for getting back to me! I'll read your message and respond shortly.", ...ngDevMode ? [{ debugName: "autoReplyMessage" }] : []);
    this.smartSendingEnabled = signal(true, ...ngDevMode ? [{ debugName: "smartSendingEnabled" }] : []);
    this.saveSettingsTimer = null;
    this.searchTimeout = null;
    this.showPostJoinDialog = signal(false, ...ngDevMode ? [{ debugName: "showPostJoinDialog" }] : []);
    this.postJoinResource = signal(null, ...ngDevMode ? [{ debugName: "postJoinResource" }] : []);
    this.postJoinPhone = signal("", ...ngDevMode ? [{ debugName: "postJoinPhone" }] : []);
    this.showSuccessOverlay = signal(false, ...ngDevMode ? [{ debugName: "showSuccessOverlay" }] : []);
    this.successOverlayConfig = signal(null, ...ngDevMode ? [{ debugName: "successOverlayConfig" }] : []);
    this.newAccount = signal({ phone: "", proxy: "", apiId: "", apiHash: "", enableWarmup: true, twoFactorPassword: "", group: "" }, ...ngDevMode ? [{ debugName: "newAccount" }] : []);
    this.newKeyword = signal({ setId: null, keyword: "", isRegex: false }, ...ngDevMode ? [{ debugName: "newKeyword" }] : []);
    this.testKeywordText = signal("", ...ngDevMode ? [{ debugName: "testKeywordText" }] : []);
    this.keywordTestResult = signal(null, ...ngDevMode ? [{ debugName: "keywordTestResult" }] : []);
    this.newKeywordSet = signal({ name: "" }, ...ngDevMode ? [{ debugName: "newKeywordSet" }] : []);
    this.newGroup = signal({ url: "", keywordSetIds: [] }, ...ngDevMode ? [{ debugName: "newGroup" }] : []);
    this.newTemplate = signal({ name: "", prompt: "" }, ...ngDevMode ? [{ debugName: "newTemplate" }] : []);
    this.showTemplateCreator = signal(false, ...ngDevMode ? [{ debugName: "showTemplateCreator" }] : []);
    this.showKeywordSetCreator = signal(false, ...ngDevMode ? [{ debugName: "showKeywordSetCreator" }] : []);
    this.newCampaign = signal(this.getEmptyCampaignForm(), ...ngDevMode ? [{ debugName: "newCampaign" }] : []);
    this.loginState = signal({
      accountId: null,
      phone: "",
      requiresCode: false,
      requires2FA: false,
      phoneCodeHash: null,
      isSubmittingCode: false
    }, ...ngDevMode ? [{ debugName: "loginState" }] : []);
    this.loginCode = signal("", ...ngDevMode ? [{ debugName: "loginCode" }] : []);
    this.login2FAPassword = signal("", ...ngDevMode ? [{ debugName: "login2FAPassword" }] : []);
    this.accountRoles = ["Listener", "Sender", "Unassigned"];
    this.selectedAccountGroup = signal("All", ...ngDevMode ? [{ debugName: "selectedAccountGroup" }] : []);
    this.accountGroups = computed(() => ["All", ...new Set(this.accounts().map((a) => a.group).filter(Boolean))], ...ngDevMode ? [{ debugName: "accountGroups" }] : []);
    this.filteredAccounts = computed(() => {
      const accounts = this.accounts();
      const selectedGroup = this.selectedAccountGroup();
      if (selectedGroup === "All") {
        return accounts;
      }
      return accounts.filter((a) => a.group === selectedGroup);
    }, ...ngDevMode ? [{ debugName: "filteredAccounts" }] : []);
    this.selectedAccounts = computed(() => this.accounts().filter((a) => a.selected), ...ngDevMode ? [{ debugName: "selectedAccounts" }] : []);
    this.isAllAccountsSelected = computed(() => {
      const filtered = this.filteredAccounts();
      return filtered.length > 0 && filtered.every((a) => a.selected);
    }, ...ngDevMode ? [{ debugName: "isAllAccountsSelected" }] : []);
    this.listenerAccounts = computed(() => this.accounts().filter((a) => a.role === "Listener" && a.status === "Online"), ...ngDevMode ? [{ debugName: "listenerAccounts" }] : []);
    this.senderAccounts = computed(() => this.accounts().filter((a) => a.role === "Sender" && (a.status === "Online" || a.status === "Warming Up")), ...ngDevMode ? [{ debugName: "senderAccounts" }] : []);
    this.leadStatuses = ["New", "Contacted", "Replied", "Follow-up", "Closed-Won", "Closed-Lost"];
    this.openLeadMenuId = signal(null, ...ngDevMode ? [{ debugName: "openLeadMenuId" }] : []);
    this.displayLeads = computed(() => {
      const searchQuery = this.leadSearchQuery().trim();
      if (searchQuery && this.leadSearchResults().length > 0) {
        return this.leadSearchResults();
      }
      return this.leads();
    }, ...ngDevMode ? [{ debugName: "displayLeads" }] : []);
    this.leadsByStatusMap = computed(() => {
      const leads = this.displayLeads();
      const statusMap = /* @__PURE__ */ new Map();
      this.leadStatuses.forEach((status) => statusMap.set(status, []));
      leads.forEach((lead) => {
        if (statusMap.has(lead.status)) {
          statusMap.get(lead.status).push(lead);
        }
      });
      return statusMap;
    }, ...ngDevMode ? [{ debugName: "leadsByStatusMap" }] : []);
    this.filteredLeads = computed(() => {
      const statusFilter = this.leadStatusFilter();
      const sourceFilter = this.leadSourceFilter();
      const sortBy = this.leadSortBy();
      let result = this.displayLeads();
      if (statusFilter !== "all") {
        result = result.filter((lead) => lead.status === statusFilter);
      }
      if (sourceFilter !== "all") {
        result = result.filter((lead) => lead.sourceType === sourceFilter);
      }
      return result.sort((a, b) => {
        if (sortBy === "intent") {
          return (b.intentScore || 0) - (a.intentScore || 0);
        } else if (sortBy === "time") {
          return new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime();
        } else {
          return (a.username || "").localeCompare(b.username || "");
        }
      });
    }, ...ngDevMode ? [{ debugName: "filteredLeads" }] : []);
    this.leadsBySource = computed(() => {
      const leads = this.leads();
      return {
        group_extract: leads.filter((l) => l.sourceType === "group_extract").length,
        keyword_trigger: leads.filter((l) => l.sourceType === "keyword_trigger").length,
        import: leads.filter((l) => l.sourceType === "import").length,
        unknown: leads.filter((l) => !l.sourceType || l.sourceType === "unknown").length
      };
    }, ...ngDevMode ? [{ debugName: "leadsBySource" }] : []);
    this.funnelStats = signal({
      stages: {},
      tags: [],
      interest_distribution: {},
      today_new: 0,
      week_converted: 0
    }, ...ngDevMode ? [{ debugName: "funnelStats" }] : []);
    this.funnelOverview = signal({
      stages: [],
      totalLeads: 0,
      convertedLeads: 0,
      averageConversionDays: 0,
      conversionRate: 0
    }, ...ngDevMode ? [{ debugName: "funnelOverview" }] : []);
    this.showFunnelVisualization = signal(false, ...ngDevMode ? [{ debugName: "showFunnelVisualization" }] : []);
    this.isLoadingFunnel = signal(false, ...ngDevMode ? [{ debugName: "isLoadingFunnel" }] : []);
    this.selectedJourneyUserId = signal("", ...ngDevMode ? [{ debugName: "selectedJourneyUserId" }] : []);
    this.userJourneyData = signal(null, ...ngDevMode ? [{ debugName: "userJourneyData" }] : []);
    this.isLoadingJourney = signal(false, ...ngDevMode ? [{ debugName: "isLoadingJourney" }] : []);
    this.leadsTab = signal("kanban", ...ngDevMode ? [{ debugName: "leadsTab" }] : []);
    this.marketingCampaigns = signal([], ...ngDevMode ? [{ debugName: "marketingCampaigns" }] : []);
    this.marketingStats = signal({
      totalCampaigns: 0,
      running: 0,
      completed: 0,
      totalMessages: 0,
      totalInvites: 0,
      successRate: 0
    }, ...ngDevMode ? [{ debugName: "marketingStats" }] : []);
    this.showCreateCampaignDialog = signal(false, ...ngDevMode ? [{ debugName: "showCreateCampaignDialog" }] : []);
    this.newMarketingCampaign = { name: "", type: "pm", targetGroup: "", messageTemplate: "" };
    this.isLoadingMarketing = signal(false, ...ngDevMode ? [{ debugName: "isLoadingMarketing" }] : []);
    this.warmupDetails = signal({}, ...ngDevMode ? [{ debugName: "warmupDetails" }] : []);
    this.showWarmupConfig = signal(false, ...ngDevMode ? [{ debugName: "showWarmupConfig" }] : []);
    this.selectedWarmupAccountId = signal(null, ...ngDevMode ? [{ debugName: "selectedWarmupAccountId" }] : []);
    this.usersWithProfiles = signal({ users: [], total: 0, limit: 50, offset: 0 }, ...ngDevMode ? [{ debugName: "usersWithProfiles" }] : []);
    this.userFilterStage = signal("", ...ngDevMode ? [{ debugName: "userFilterStage" }] : []);
    this.userFilterTags = signal("", ...ngDevMode ? [{ debugName: "userFilterTags" }] : []);
    this.userFilterSearch = signal("", ...ngDevMode ? [{ debugName: "userFilterSearch" }] : []);
    this.selectedUserIds = signal([], ...ngDevMode ? [{ debugName: "selectedUserIds" }] : []);
    this.funnelStages = [
      { key: "new", name: "\u65B0\u5BA2\u6236", color: "bg-blue-500" },
      { key: "contacted", name: "\u5DF2\u806F\u7E6B", color: "bg-cyan-500" },
      { key: "replied", name: "\u5DF2\u56DE\u5FA9", color: "bg-green-500" },
      { key: "interested", name: "\u6709\u8208\u8DA3", color: "bg-yellow-500" },
      { key: "negotiating", name: "\u6D3D\u8AC7\u4E2D", color: "bg-orange-500" },
      { key: "follow_up", name: "\u9700\u8DDF\u9032", color: "bg-purple-500" },
      { key: "converted", name: "\u5DF2\u6210\u4EA4", color: "bg-emerald-500" },
      { key: "churned", name: "\u5DF2\u6D41\u5931", color: "bg-red-500" }
    ];
    this.dashboardStats = computed(() => {
      const accounts = this.accounts();
      const leads = this.leads();
      const onlineAccounts = accounts.filter((a) => a.status === "Online").length;
      const today = /* @__PURE__ */ new Date();
      today.setHours(0, 0, 0, 0);
      const leadsToday = leads.filter((l) => new Date(l.timestamp) >= today).length;
      const messagesSentToday = accounts.reduce((sum, acc) => sum + acc.dailySendCount, 0);
      return {
        totalAccounts: accounts.length,
        onlineAccounts,
        totalLeads: leads.length,
        leadsToday,
        messagesSentToday
      };
    }, ...ngDevMode ? [{ debugName: "dashboardStats" }] : []);
    this.selectedAnalyticsCampaignId = signal("all", ...ngDevMode ? [{ debugName: "selectedAnalyticsCampaignId" }] : []);
    this.filteredAnalyticsLeads = computed(() => {
      const leads = this.leads();
      const selectedId = this.selectedAnalyticsCampaignId();
      if (selectedId === "all") {
        return leads;
      }
      return leads.filter((l) => l.campaignId === selectedId);
    }, ...ngDevMode ? [{ debugName: "filteredAnalyticsLeads" }] : []);
    this.analyticsData = computed(() => {
      const leads = this.filteredAnalyticsLeads();
      const today = /* @__PURE__ */ new Date();
      today.setHours(0, 0, 0, 0);
      const leadsByDay = [];
      for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        const count = leads.filter((l) => {
          const leadDate = new Date(l.timestamp);
          leadDate.setHours(0, 0, 0, 0);
          return leadDate.getTime() === date.getTime();
        }).length;
        leadsByDay.push({ date, count });
      }
      const maxLeadsInPeriod = Math.max(...leadsByDay.map((d) => d.count), 1);
      const funnel = {
        new: leads.length,
        contacted: leads.filter((l) => l.status !== "New").length,
        replied: leads.filter((l) => ["Replied", "Follow-up", "Closed-Won", "Closed-Lost"].includes(l.status)).length
      };
      return { leadsByDay, maxLeadsInPeriod, funnel };
    }, ...ngDevMode ? [{ debugName: "analyticsData" }] : []);
    this.campaignPerformance = computed(() => {
      const leads = this.leads();
      return this.campaigns().map((campaign) => {
        const campaignLeads = leads.filter((l) => l.campaignId === campaign.id);
        const contactedCount = campaignLeads.filter((l) => l.status !== "New").length;
        const repliedCount = campaignLeads.filter((l) => ["Replied", "Follow-up", "Closed-Won", "Closed-Lost"].includes(l.status)).length;
        const replyRate = contactedCount > 0 ? repliedCount / contactedCount * 100 : 0;
        return {
          id: campaign.id,
          name: campaign.name,
          isActive: campaign.isActive,
          leads: campaignLeads.length,
          contacted: contactedCount,
          replied: repliedCount,
          replyRate
        };
      });
    }, ...ngDevMode ? [{ debugName: "campaignPerformance" }] : []);
    this.isMonitoring = signal(false, ...ngDevMode ? [{ debugName: "isMonitoring" }] : []);
    this.coreDataLoaded = signal(false, ...ngDevMode ? [{ debugName: "coreDataLoaded" }] : []);
    this.senderRoundRobinIndex = signal(0, ...ngDevMode ? [{ debugName: "senderRoundRobinIndex" }] : []);
    this.oneClickStarting = signal(false, ...ngDevMode ? [{ debugName: "oneClickStarting" }] : []);
    this.oneClickProgress = signal(0, ...ngDevMode ? [{ debugName: "oneClickProgress" }] : []);
    this.oneClickMessage = signal("", ...ngDevMode ? [{ debugName: "oneClickMessage" }] : []);
    this.oneClickStartReport = signal(null, ...ngDevMode ? [{ debugName: "oneClickStartReport" }] : []);
    this.showStartReport = signal(false, ...ngDevMode ? [{ debugName: "showStartReport" }] : []);
    this.systemStatus = signal({
      accounts: { total: 0, online: 0, offline: 0 },
      monitoring: { active: false, groups: 0 },
      ai: { enabled: false, mode: "semi", endpoint: "" },
      keywords: { sets: 0, total: 0 },
      campaigns: { total: 0, active: 0 },
      templates: { total: 0, active: 0 },
      poller: { running: false }
    }, ...ngDevMode ? [{ debugName: "systemStatus" }] : []);
    this.lastInitialStateTime = 0;
    this.isPageVisible = true;
    this.backendConnectionState = signal("connecting", ...ngDevMode ? [{ debugName: "backendConnectionState" }] : []);
    this.backendConnectionMessage = signal("\u6B63\u5728\u9023\u63A5\u5F8C\u7AEF\u670D\u52D9...", ...ngDevMode ? [{ debugName: "backendConnectionMessage" }] : []);
    this.backendConnectionProgress = signal(0, ...ngDevMode ? [{ debugName: "backendConnectionProgress" }] : []);
    this.connectionStartTime = 0;
    this.connectionTimeoutId = null;
    this.isStartingMonitoring = signal(false, ...ngDevMode ? [{ debugName: "isStartingMonitoring" }] : []);
    this.lastConfigCheck = signal(null, ...ngDevMode ? [{ debugName: "lastConfigCheck" }] : []);
    this.errorNavigationMap = {
      "NO_LISTENER": { view: "accounts", elementId: "accounts-section" },
      "LISTENER_OFFLINE": { view: "accounts", elementId: "accounts-section" },
      "NO_SENDER": { view: "accounts", elementId: "accounts-section" },
      "SENDER_OFFLINE": { view: "accounts", elementId: "accounts-section" },
      "SENDER_LIMIT_REACHED": { view: "accounts", elementId: "accounts-section" },
      "NO_GROUPS": { view: "automation", elementId: "monitored-groups-section" },
      "NO_KEYWORDS": { view: "automation", elementId: "keyword-sets-section" },
      "EMPTY_KEYWORDS": { view: "automation", elementId: "keyword-sets-section" },
      "GROUP_NO_KEYWORD": { view: "automation", elementId: "monitored-groups-section" },
      "NO_CAMPAIGN": { view: "trigger-rules", elementId: "trigger-rules-section" },
      "NO_ACTIVE_CAMPAIGN": { view: "trigger-rules", elementId: "trigger-rules-section" },
      "CAMPAIGN_INCOMPLETE": { view: "trigger-rules", elementId: "trigger-rules-section" },
      "NO_TEMPLATE": { view: "automation", elementId: "templates-section" },
      "AI_NOT_ENABLED": { view: "ai-center", elementId: "ai-settings-section" }
    };
    this.selectedDays = signal(7, ...ngDevMode ? [{ debugName: "selectedDays" }] : []);
    this.alertManagementTab = signal("alerts", ...ngDevMode ? [{ debugName: "alertManagementTab" }] : []);
    this.alertRules = signal([], ...ngDevMode ? [{ debugName: "alertRules" }] : []);
    this.alertHistory = signal([], ...ngDevMode ? [{ debugName: "alertHistory" }] : []);
    this.showAddAlertRuleDialog = signal(false, ...ngDevMode ? [{ debugName: "showAddAlertRuleDialog" }] : []);
    this.deleteConfirmDialog = signal({ show: false, type: "single" }, ...ngDevMode ? [{ debugName: "deleteConfirmDialog" }] : []);
    this.isSubmittingCampaign = signal(false, ...ngDevMode ? [{ debugName: "isSubmittingCampaign" }] : []);
    const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
    this.theme.set(prefersDark ? "dark" : "light");
    effect(() => {
      this.document.documentElement.className = this.theme();
    });
    effect(() => {
      const navView = this.navBridge.currentView();
      const localView = this.currentView();
      if (navView && navView !== localView) {
        console.log("[AppComponent] \u540C\u6B65\u5C0E\u822A:", navView, "\u2190 from NavBridge");
        this.currentView.set(navView);
      }
    });
  }
  // 點擊頁面其他地方時關閉資源菜單
  onDocumentClick(event) {
    if (this.openResourceMenuId() !== null) {
      this.openResourceMenuId.set(null);
    }
  }
  ngOnInit() {
    console.log("[App] ngOnInit called, coreDataLoaded:", this.coreDataLoaded());
    console.log("[App] Current URL:", window.location.href);
    console.log("[App] Router URL:", this.router.url);
    setTimeout(() => {
      window.dispatchEvent(new CustomEvent("angular-ready"));
      console.log("[App] Angular ready event dispatched");
    }, 100);
    this.translationService.setLanguage("zh");
    this.loadAiSettings();
    this.loadSidebarGroupsState();
    window.addEventListener("changeView", (event) => {
      const customEvent = event;
      if (customEvent.detail) {
        this.changeView(customEvent.detail);
      }
    });
    this.setupVisibilityListener();
    this.setupIpcListeners();
    this.checkFirstRun();
    this.connectionStartTime = Date.now();
    this.startConnectionTimeout();
    this.loadCachedStateIfAvailable();
    window.addEventListener("page-became-visible", () => {
      console.log("[App] Page became visible, refreshing data...");
      this.ipcService.send("get-initial-state");
    });
    window.addEventListener("sync-offline-operations", ((event) => {
      this.syncOfflineOperations(event.detail.operations);
    }));
    console.log("[App] Current URL:", window.location.href);
    this.ipcService.send("get-initial-state");
    this.queueRefreshInterval = setInterval(() => {
      this.refreshQueueStatusThrottled();
    }, 6e4);
    setTimeout(() => {
      this.refreshQueueStatusThrottled();
    }, 2e3);
    this.watchViewChanges();
    this.setupKeyboardShortcuts();
    this.membershipUpdateHandler = (event) => {
      const customEvent = event;
      console.log("[AppComponent] \u6536\u5230\u6703\u54E1\u72C0\u614B\u66F4\u65B0\u4E8B\u4EF6:", customEvent.detail);
      this.cdr.detectChanges();
    };
    window.addEventListener("membership-updated", this.membershipUpdateHandler);
    window.addEventListener("save-ai-settings", ((event) => {
      const settings = event.detail;
      console.log("[AppComponent] \u6536\u5230 AI \u8A2D\u7F6E\u4FDD\u5B58\u4E8B\u4EF6:", settings);
      if (settings.auto_chat_enabled !== void 0) {
        this.aiAutoChatEnabled.set(settings.auto_chat_enabled === 1);
      }
      if (settings.auto_chat_mode) {
        this.aiAutoChatMode.set(settings.auto_chat_mode);
      }
      if (settings.auto_greeting !== void 0) {
        this.aiAutoGreeting.set(settings.auto_greeting === 1);
      }
      this.ipcService.send("update-ai-chat-settings", { settings });
      this.toastService.success("AI \u8A2D\u7F6E\u5DF2\u4FDD\u5B58", 2e3);
    }));
    window.addEventListener("get-sender-accounts", (() => {
      const accounts = this.accounts();
      const senderAccounts = accounts.filter((a) => a.role === "Sender" && a.status === "Online").map((a) => ({
        phone: a.phone,
        username: a.username || a.first_name || a.phone,
        avatar: a.avatar,
        sentToday: a.sentToday || a.dailySendCount || 0,
        dailyLimit: a.dailySendLimit || 50
      }));
      window.dispatchEvent(new CustomEvent("sender-accounts-loaded", { detail: senderAccounts }));
    }));
  }
  // 檢查是否首次運行
  checkFirstRun() {
    this.ipcService.send("check-first-run", {});
  }
  // 檢測 Ollama
  detectOllama() {
    this.isDetectingOllama.set(true);
    this.ipcService.send("detect-ollama", {});
  }
  // 完成首次設置
  completeFirstRunSetup() {
    const settings = {
      aiConfig: {
        primaryProvider: this.ollamaDetected() ? "local" : "cloud",
        localAi: {
          provider: "ollama",
          endpoint: this.localAiEndpoint(),
          model: this.autoSelectedModel() || this.localAiModel(),
          autoDetect: true
        },
        cloudAi: {
          enabled: !this.ollamaDetected(),
          provider: this.aiApiType(),
          apiKey: this.aiApiKey()
        },
        autoFallback: {
          enabled: this.aiAutoFallback(),
          fallbackProvider: this.aiBackupProvider()
        }
      },
      settings: {
        language: "zh",
        theme: this.theme(),
        firstRun: {
          completed: true,
          completedAt: (/* @__PURE__ */ new Date()).toISOString()
        }
      }
    };
    this.ipcService.send("save-first-run-settings", settings);
    this.showWelcomeDialog.set(false);
    this.isFirstRun.set(false);
    this.toastService.success("\u{1F389} \u8A2D\u7F6E\u5B8C\u6210\uFF01\u6B61\u8FCE\u4F7F\u7528 TG-Matrix");
  }
  // 跳過首次設置
  skipFirstRunSetup() {
    this.showWelcomeDialog.set(false);
    this.isFirstRun.set(false);
    this.toastService.info("\u60A8\u53EF\u4EE5\u7A0D\u5F8C\u5728\u8A2D\u7F6E\u4E2D\u914D\u7F6E AI");
  }
  watchViewChanges() {
    let lastView = null;
    const checkView = () => {
      const currentView = this.currentView();
      if (currentView !== lastView) {
        lastView = currentView;
        if (currentView === "leads") {
          this.loadFunnelStats();
          this.loadUsersWithProfiles();
        } else if (currentView === "resources") {
          this.refreshResourceStats();
          if (!this.isInSearchResultMode()) {
            this.loadResources();
          }
          this.loadDiscoveryKeywords();
        } else if (currentView === "ai-center") {
          this.refreshRagStats();
        }
      }
    };
    checkView();
    this.viewCheckInterval = setInterval(checkView, 2e3);
  }
  /**
   * 🆕 性能優化：設置頁面可見性監聽
   * 當用戶切換到其他 Tab 時暫停定時刷新，減少 CPU 消耗
   */
  setupVisibilityListener() {
    this.visibilityChangeHandler = () => {
      this.isPageVisible = !document.hidden;
      if (this.isPageVisible) {
        console.log("[Performance] \u9801\u9762\u8B8A\u70BA\u53EF\u898B\uFF0C\u6062\u5FA9\u5237\u65B0");
        this.resumeRefreshIntervals();
      } else {
        console.log("[Performance] \u9801\u9762\u8B8A\u70BA\u96B1\u85CF\uFF0C\u66AB\u505C\u5237\u65B0");
        this.pauseRefreshIntervals();
      }
    };
    document.addEventListener("visibilitychange", this.visibilityChangeHandler);
  }
  /**
   * 🆕 暫停所有定時刷新
   */
  pauseRefreshIntervals() {
    if (this.viewCheckInterval) {
      clearInterval(this.viewCheckInterval);
      this.viewCheckInterval = void 0;
    }
    if (this.queueRefreshInterval) {
      clearInterval(this.queueRefreshInterval);
      this.queueRefreshInterval = void 0;
    }
  }
  /**
   * 🆕 恢復定時刷新
   */
  resumeRefreshIntervals() {
    if (!this.viewCheckInterval) {
      let lastView = "";
      const checkView = () => {
        const currentView = this.currentView();
        if (currentView !== lastView) {
          lastView = currentView;
        }
      };
      this.viewCheckInterval = setInterval(checkView, 2e3);
    }
    if (!this.queueRefreshInterval) {
      this.queueRefreshInterval = setInterval(() => {
        this.refreshQueueStatusThrottled();
      }, 6e4);
    }
  }
  setupKeyboardShortcuts() {
    document.addEventListener("keydown", (event) => {
      if ((event.ctrlKey || event.metaKey) && event.key === "k") {
        event.preventDefault();
      }
      if ((event.ctrlKey || event.metaKey) && event.key === "n") {
        if (this.currentView() === "accounts") {
          event.preventDefault();
          setTimeout(() => {
            const form = document.querySelector('[name="phone"]');
            if (form) {
              form.focus();
            }
          }, 100);
        }
      }
      if (event.key === "Escape") {
        if (this.selectedQueuePhone()) {
          this.closeQueueDetails();
        }
        if (this.progressDialog().show && this.progressDialog().cancellable) {
          this.progressDialog.set(__spreadProps(__spreadValues({}, this.progressDialog()), { show: false }));
        }
      }
      if (!(event.target instanceof HTMLInputElement) && !(event.target instanceof HTMLTextAreaElement)) {
        if (event.key === "1" && (event.ctrlKey || event.metaKey)) {
          event.preventDefault();
          this.changeView("dashboard");
        } else if (event.key === "2" && (event.ctrlKey || event.metaKey)) {
          event.preventDefault();
          this.changeView("accounts");
        } else if (event.key === "3" && (event.ctrlKey || event.metaKey)) {
          event.preventDefault();
          this.changeView("automation");
        } else if (event.key === "4" && (event.ctrlKey || event.metaKey)) {
          event.preventDefault();
          this.changeView("leads");
        } else if (event.key === "5" && (event.ctrlKey || event.metaKey)) {
          event.preventDefault();
          this.changeView("ads");
        } else if (event.key === "6" && (event.ctrlKey || event.metaKey)) {
          event.preventDefault();
          this.changeView("campaigns");
        } else if (event.key === "7" && (event.ctrlKey || event.metaKey)) {
          event.preventDefault();
          this.changeView("settings");
        }
      }
    });
  }
  ngOnDestroy() {
    if (this.visibilityChangeHandler) {
      document.removeEventListener("visibilitychange", this.visibilityChangeHandler);
    }
    if (this.membershipUpdateHandler) {
      window.removeEventListener("membership-updated", this.membershipUpdateHandler);
    }
    this.ipcService.cleanup("log-entry");
    this.ipcService.cleanup("monitoring-status-changed");
    this.ipcService.cleanup("monitoring-status-report");
    this.ipcService.cleanup("monitoring-start-failed");
    this.ipcService.cleanup("monitoring-config-check");
    this.ipcService.cleanup("initial-state");
    this.ipcService.cleanup("accounts-updated");
    this.ipcService.cleanup("new-lead-captured");
    this.ipcService.cleanup("queue-status");
    this.ipcService.cleanup("queue-messages");
    this.ipcService.cleanup("sending-stats");
    this.ipcService.cleanup("queue-length-history");
    this.ipcService.cleanup("account-sending-comparison");
    this.ipcService.cleanup("campaign-performance-stats");
    this.ipcService.cleanup("alert-triggered");
    this.ipcService.cleanup("alerts-loaded");
    this.ipcService.cleanup("account-validation-error");
    this.ipcService.cleanup("keyword-set-validation-error");
    this.ipcService.cleanup("keyword-validation-error");
    this.ipcService.cleanup("group-validation-error");
    this.ipcService.cleanup("group-membership-status");
    this.ipcService.cleanup("group-join-result");
    this.ipcService.cleanup("template-validation-error");
    this.ipcService.cleanup("campaign-validation-error");
    this.ipcService.cleanup("keyword-sets-updated");
    this.ipcService.cleanup("groups-updated");
    this.ipcService.cleanup("templates-updated");
    this.ipcService.cleanup("campaigns-updated");
    this.ipcService.cleanup("leads-updated");
    this.ipcService.cleanup("funnel-stats");
    this.ipcService.cleanup("users-with-profiles");
    this.ipcService.cleanup("bulk-update-complete");
    this.ipcService.cleanup("login-requires-code");
    this.ipcService.cleanup("login-requires-2fa");
    this.ipcService.cleanup("account-login-error");
    this.ipcService.cleanup("session-files-cleaned");
    this.ipcService.cleanup("session-files-cleanup-error");
    this.ipcService.cleanup("session-import-result");
    this.ipcService.cleanup("session-import-needs-credentials");
    this.ipcService.cleanup("orphan-sessions-detected");
    this.ipcService.cleanup("orphan-sessions-scanned");
    this.ipcService.cleanup("orphan-sessions-recovered");
    if (this.queueRefreshInterval) {
      clearInterval(this.queueRefreshInterval);
      this.queueRefreshInterval = void 0;
    }
    if (this.viewCheckInterval) {
      clearInterval(this.viewCheckInterval);
      this.viewCheckInterval = void 0;
    }
    if (this.initialStateDebounceTimer) {
      clearTimeout(this.initialStateDebounceTimer);
      this.initialStateDebounceTimer = void 0;
    }
    if (this.keywordSetsUpdateDebounceTimer) {
      clearTimeout(this.keywordSetsUpdateDebounceTimer);
      this.keywordSetsUpdateDebounceTimer = void 0;
    }
    if (this.saveSettingsTimer) {
      clearTimeout(this.saveSettingsTimer);
      this.saveSettingsTimer = null;
    }
    if (this.queueStatusRefreshThrottleTimer) {
      clearTimeout(this.queueStatusRefreshThrottleTimer);
      this.queueStatusRefreshThrottleTimer = void 0;
    }
    if (this.chatListSearchDebounceTimer) {
      clearTimeout(this.chatListSearchDebounceTimer);
      this.chatListSearchDebounceTimer = void 0;
    }
    if (this.logFilterDebounceTimer) {
      clearTimeout(this.logFilterDebounceTimer);
      this.logFilterDebounceTimer = void 0;
    }
  }
  // 🆕 P0 優化：簡化連接檢測（移除硬超時）
  startConnectionTimeout() {
    setTimeout(() => {
      if (this.backendConnectionState() === "connecting") {
        this.backendConnectionMessage.set("\u6B63\u5728\u9023\u63A5...");
        this.backendConnectionProgress.set(50);
      }
    }, 3e3);
  }
  // 🆕 P0: 連接成功後自動隱藏提示
  hideConnectionIndicator() {
    setTimeout(() => {
      if (this.backendConnectionState() === "connected") {
      }
    }, 2e3);
  }
  // 🆕 P2-1: 載入緩存狀態（快速啟動）
  async loadCachedStateIfAvailable() {
    try {
      const cached = await this.offlineCache.loadCachedState();
      if (cached && this.offlineCache.isCacheValid()) {
        console.log("[App] \u{1F680} Loading cached state for fast startup");
        if (cached.accounts?.length > 0) {
          this.accounts.set(cached.accounts);
        }
        if (cached.keywordSets?.length > 0) {
          this.keywordSets.set(cached.keywordSets);
        }
        if (cached.leads?.length > 0) {
          this.leads.set(cached.leads.map((l) => this.mapLeadFromBackend(l)));
        }
        if (cached.settings) {
          this.spintaxEnabled.set(cached.settings.spintaxEnabled ?? true);
        }
        console.log("[App] \u2705 Cached state applied, waiting for fresh data...");
      }
    } catch (error) {
      console.warn("[App] Failed to load cached state:", error);
    }
  }
  // 🆕 P2-4: 同步離線操作
  async syncOfflineOperations(operations) {
    if (!this.offlineCache.isOnline()) {
      console.log("[App] Still offline, skipping sync");
      return;
    }
    console.log("[App] \u{1F504} Syncing", operations.length, "offline operations");
    for (const op of operations) {
      try {
        this.ipcService.send(op.command, op.payload);
        await this.offlineCache.removeOperation(op.id);
        console.log("[App] \u2705 Synced operation:", op.command);
      } catch (error) {
        console.error("[App] Failed to sync operation:", op.command, error);
      }
    }
    if (operations.length > 0) {
      this.toastService.success(`\u2705 \u5DF2\u540C\u6B65 ${operations.length} \u500B\u96E2\u7DDA\u64CD\u4F5C`);
    }
  }
  // 🆕 P2 優化：重試連接
  retryConnection() {
    this.backendConnectionState.set("connecting");
    this.backendConnectionMessage.set("\u6B63\u5728\u91CD\u65B0\u9023\u63A5...");
    this.backendConnectionProgress.set(0);
    this.connectionStartTime = Date.now();
    this.startConnectionTimeout();
    this.ipcService.send("get-initial-state");
  }
  setupIpcListeners() {
    this.ipcService.on("connection-confirmed", (data) => {
      console.log("[Frontend] \u2705 Connection confirmed:", data);
      this.backendConnectionState.set("connected");
      this.backendConnectionProgress.set(100);
      this.backendConnectionMessage.set("\u9023\u63A5\u6210\u529F");
      if (this.connectionTimeoutId) {
        clearTimeout(this.connectionTimeoutId);
        this.connectionTimeoutId = null;
      }
      this.hideConnectionIndicator();
    });
    this.ipcService.on("connection-error", (data) => {
      console.log("[Frontend] \u274C Connection error:", data);
      if (this.backendConnectionState() === "connecting") {
        this.backendConnectionState.set("error");
        this.backendConnectionMessage.set(data.message || "\u9023\u63A5\u5931\u6557");
      }
    });
    this.ipcService.on("connection-mode-changed", (data) => {
      console.log("[Frontend] Connection mode changed:", data.mode);
      if (data.mode === "polling") {
        console.log("[Frontend] \u26A0\uFE0F Running in degraded mode (HTTP polling)");
      } else if (data.mode === "websocket") {
        console.log("[Frontend] \u2705 WebSocket connection restored");
      }
    });
    this.ipcService.on("loading-progress", (data) => {
      console.log("[Frontend] Loading progress:", data);
      this.backendConnectionProgress.set(data.progress);
      this.backendConnectionMessage.set(data.message);
      if (data.step === "complete") {
        this.backendConnectionState.set("connected");
        if (this.connectionTimeoutId) {
          clearTimeout(this.connectionTimeoutId);
          this.connectionTimeoutId = null;
        }
        this.hideConnectionIndicator();
      }
    });
    this.ipcService.on("log-entry", (log) => {
      log.timestamp = new Date(log.timestamp);
      this.logs.update((logs) => [log, ...logs].slice(0, 100));
    });
    this.ipcService.on("log-entries-batch", (data) => {
      if (data.entries && data.entries.length > 0) {
        const processedEntries = data.entries.map((log) => __spreadProps(__spreadValues({}, log), {
          timestamp: new Date(log.timestamp)
        }));
        this.logs.update((logs) => [...processedEntries.reverse(), ...logs].slice(0, 100));
      }
    });
    this.ipcService.on("monitoring-status-changed", (status) => {
      this.isMonitoring.set(status);
      this.isStartingMonitoring.set(false);
    });
    this.ipcService.on("monitoring-start-failed", (data) => {
      console.log("[Frontend] Monitoring start failed:", data);
      this.isStartingMonitoring.set(false);
      if (data.reason === "config_check_failed") {
        const issues = data.issues || [];
        const warnings = data.warnings || [];
        const hasOfflineIssue = issues.some((i) => i.message?.includes("\u96E2\u7DDA") || i.message?.includes("offline") || i.code === "no_online_accounts");
        if (issues.length > 0) {
          const issueMessages = issues.map((i) => `\u2022 ${i.message}`).join("\n");
          if (hasOfflineIssue) {
            this.toastService.withActions("error", `\u914D\u7F6E\u6AA2\u67E5\u5931\u6557\uFF1A
${issueMessages}`, [
              {
                label: "\u{1F4F1} \u524D\u5F80\u5E33\u865F\u7BA1\u7406",
                variant: "primary",
                handler: () => this.navigateToView("manageAccounts")
              },
              {
                label: "\u95DC\u9589",
                variant: "secondary",
                handler: () => {
                }
              }
            ], 15e3);
          } else {
            this.toastService.error(`\u914D\u7F6E\u6AA2\u67E5\u5931\u6557\uFF1A
${issueMessages}`, 1e4);
          }
        }
        if (warnings.length > 0) {
          setTimeout(() => {
            const warnMessages = warnings.slice(0, 3).map((w) => w.message).join("\uFF1B");
            this.toastService.warning(`\u26A0 \u5176\u4ED6\u554F\u984C\uFF1A${warnMessages}`, 8e3);
          }, 1e3);
        }
      } else if (data.reason === "no_online_listeners") {
        this.toastService.withActions("error", "\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u5728\u7DDA\u7684\u76E3\u807D\u8CEC\u6236", [
          {
            label: "\u{1F4F1} \u524D\u5F80\u5E33\u865F\u7BA1\u7406",
            variant: "primary",
            handler: () => this.navigateToView("manageAccounts")
          },
          {
            label: "\u95DC\u9589",
            variant: "secondary",
            handler: () => {
            }
          }
        ], 1e4);
      } else if (data.reason === "no_groups") {
        this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u76E3\u63A7\u7FA4\u7D44\u3002\u8ACB\u5148\u6DFB\u52A0\u8981\u76E3\u63A7\u7684\u7FA4\u7D44\u3002", 5e3);
      } else if (data.reason === "no_accessible_groups") {
        const cannotJoinList = data.cannot_join_list || [];
        if (cannotJoinList.length > 0) {
          const details = cannotJoinList.map((g) => `\u2022 ${g.url}: ${g.reason || "\u672A\u77E5\u539F\u56E0"}`).join("\n");
          this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u63A7\u865F\u7121\u6CD5\u8A2A\u554F\u4EFB\u4F55\u7FA4\u7D44\u3002
${details}`, 12e3);
        } else {
          this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u63A7\u865F\u7121\u6CD5\u8A2A\u554F\u4EFB\u4F55\u7FA4\u7D44\u3002\u8ACB\u78BA\u4FDD\u76E3\u63A7\u865F\u5DF2\u52A0\u5165\u8981\u76E3\u63A7\u7684\u7FA4\u7D44\u3002", 8e3);
        }
      } else if (data.reason === "exception") {
        this.toastService.error(data.message || "\u555F\u52D5\u76E3\u63A7\u6642\u767C\u751F\u932F\u8AA4", 8e3);
      } else {
        this.toastService.error(data.message || "\u555F\u52D5\u76E3\u63A7\u5931\u6557", 5e3);
      }
    });
    this.ipcService.on("monitoring-config-check", (data) => {
      console.log("[Frontend] Monitoring config check:", data);
      this.lastConfigCheck.set(data);
      if (data.passed && data.warnings.length > 0) {
        const mainWarnings = data.warnings.slice(0, 2);
        for (const warning of mainWarnings) {
          const warningCode = warning.code || "";
          const nav = this.errorNavigationMap[warningCode];
          if (nav) {
            this.toastService.warningWithAction(`\u26A0 ${warning.message}`, "\u53BB\u8A2D\u7F6E", () => this.navigateToError(warningCode));
          } else {
            this.toastService.warning(`\u26A0 ${warning.message}
\u4FEE\u5FA9: ${warning.fix}`, 8e3);
          }
        }
        if (!data.summary.can_send_messages) {
          setTimeout(() => {
            this.toastService.warningWithAction("\u76E3\u63A7\u5C07\u904B\u884C\uFF0C\u4F46 Lead \u4E0D\u6703\u81EA\u52D5\u767C\u9001\u6D88\u606F\u3002", "\u914D\u7F6E\u898F\u5247", () => this.navigateToError("NO_CAMPAIGN"));
          }, 2e3);
        }
      }
    });
    this.ipcService.on("monitoring-status-report", (data) => {
      console.log("[Frontend] Monitoring status report:", data);
      if (data.accessible_groups > 0) {
        const accessibleNames = data.accessible_list.slice(0, 3).map((g) => g.title || g.url).join(", ");
        const moreText = data.accessible_groups > 3 ? `\u7B49 ${data.accessible_groups} \u500B\u7FA4\u7D44` : "";
        this.toastService.success(`\u2713 \u53EF\u76E3\u63A7\u7FA4\u7D44: ${accessibleNames}${moreText}`, 4e3);
      }
      if (data.groups_needing_join > 0) {
        const needingNames = data.needing_join_list.slice(0, 2).map((g) => g.url).join(", ");
        const moreText = data.groups_needing_join > 2 ? `\u7B49 ${data.groups_needing_join} \u500B` : "";
        this.toastService.warning(`\u26A0 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u7FA4\u7D44: ${needingNames}${moreText}\u3002\u6B63\u5728\u5617\u8A66\u81EA\u52D5\u52A0\u5165...`, 6e3);
      }
      if (data.accessible_groups === 0 && data.groups_needing_join > 0) {
        this.toastService.warning(`\u76E3\u63A7\u865F\u5C1A\u672A\u52A0\u5165\u4EFB\u4F55\u76E3\u63A7\u7FA4\u7D44\u3002\u7CFB\u7D71\u5C07\u5617\u8A66\u81EA\u52D5\u52A0\u5165\u516C\u958B\u7FA4\u7D44\u3002`, 5e3);
      }
    });
    this.ipcService.on("template-already-exists", (data) => {
      console.log("[Frontend] Template already exists:", data);
      this.toastService.warning(data.message || `\u6A21\u677F "${data.name}" \u5DF2\u5B58\u5728`, 3e3);
    });
    this.ipcService.on("accounts-updated", (accounts) => {
      console.log("[Frontend] Received accounts-updated event:", accounts.length, "accounts");
      const previousCount = this.accounts().length;
      const oldAccounts = this.accounts();
      this.accounts.set(accounts);
      accounts.forEach((newAccount) => {
        const oldAccount = oldAccounts.find((a) => a.id === newAccount.id);
        if (oldAccount && oldAccount.status !== newAccount.status) {
          console.log(`[Frontend] Account ${newAccount.phone} status changed: ${oldAccount.status} -> ${newAccount.status}`);
          if (newAccount.status === "Online") {
            this.toastService.success(`\u8D26\u6237 ${newAccount.phone} \u767B\u5F55\u6210\u529F`);
            this.cancelLogin();
          } else if (newAccount.status === "Logging in...") {
            this.toastService.info(`\u8D26\u6237 ${newAccount.phone} \u6B63\u5728\u767B\u5F55...`);
          } else if (newAccount.status === "Waiting Code") {
            const currentState = this.loginState();
            if (currentState.accountId === newAccount.id && !currentState.requiresCode) {
              this.toastService.info(`\u8D26\u6237 ${newAccount.phone} \u7B49\u5F85\u9A8C\u8BC1\u7801`);
            }
          } else if (newAccount.status === "Waiting 2FA") {
            const currentState = this.loginState();
            if (currentState.accountId === newAccount.id && !currentState.requires2FA) {
              this.loginState.set({
                accountId: newAccount.id,
                phone: newAccount.phone,
                requiresCode: false,
                requires2FA: true,
                phoneCodeHash: null,
                isSubmittingCode: false
              });
              this.login2FAPassword.set("");
              this.toastService.info(`\u8D26\u6237 ${newAccount.phone} \u7B49\u5F85 2FA \u5BC6\u7801`);
            }
          } else if (newAccount.status.includes("Error") || newAccount.status === "Error") {
            this.toastService.error(`\u8D26\u6237 ${newAccount.phone} \u767B\u5F55\u5931\u8D25`);
            this.cancelLogin();
          }
        }
      });
      if (accounts.length > previousCount) {
        this.toastService.success(`\u8D26\u6237\u5217\u8868\u5DF2\u66F4\u65B0\uFF08${accounts.length} \u4E2A\u8D26\u6237\uFF09`);
      }
    });
    this.ipcService.on("account-validation-error", (data) => {
      console.error("Account validation error:", data);
      const errorMessages = Array.isArray(data.errors) ? data.errors : [data.errors || "\u9A8C\u8BC1\u5931\u8D25"];
      const errorType = data.error_type || "validation";
      const isDuplicateError = errorType === "duplicate" || errorMessages.some((msg) => msg.includes("\u5DF2\u5B58\u5728") || msg.includes("already exists"));
      if (isDuplicateError) {
        this.validationErrors.set({ "account": errorMessages });
        this.toastService.error(errorMessages.join("; "));
        return;
      }
      const currentAccountCount = this.accounts().length;
      if (currentAccountCount === 0) {
        this.validationErrors.set({ "account": errorMessages });
        this.toastService.error(`\u6DFB\u52A0\u8D26\u6237\u5931\u8D25: ${errorMessages.join("; ")}`);
      } else {
        console.warn("Validation error received but accounts already exist, ignoring:", errorMessages);
      }
    });
    this.ipcService.on("new-lead-captured", (lead) => {
      lead.timestamp = new Date(lead.timestamp);
      lead.interactionHistory.forEach((h) => h.timestamp = new Date(h.timestamp));
      this.leads.update((leads) => [lead, ...leads]);
    });
    this.ipcService.on("keyword-matched", (data) => {
      console.log("[Frontend] Keyword matched event:", data);
      this.realtimeMatches.update((matches) => {
        const newMatches = [data, ...matches];
        return newMatches.slice(0, 50);
      });
      this.todayStats.update((s) => __spreadProps(__spreadValues({}, s), {
        matchCount: s.matchCount + 1
      }));
    });
    this.ipcService.on("lead-captured", (lead) => {
      console.log("[Frontend] Lead captured event received:", lead);
      this.todayStats.update((s) => __spreadProps(__spreadValues({}, s), {
        newLeads: s.newLeads + 1
      }));
      this.showNotification("\u65B0\u6F5B\u5728\u5BA2\u6236\u5DF2\u6355\u7372", `@${lead.username || lead.firstName || "\u7528\u6236"} \u5DF2\u6355\u7372`, { requireInteraction: true });
      if (!lead.interactionHistory) {
        lead.interactionHistory = [];
      }
      if (!lead.status) {
        lead.status = "New";
      }
      if (lead.doNotContact === void 0) {
        lead.doNotContact = false;
      }
      lead.timestamp = new Date(lead.timestamp || /* @__PURE__ */ new Date());
      if (lead.interactionHistory) {
        lead.interactionHistory.forEach((h) => h.timestamp = new Date(h.timestamp));
      }
      this.leads.update((leads) => {
        const existingIndex = leads.findIndex((l) => l.userId === lead.userId);
        if (existingIndex >= 0) {
          leads[existingIndex] = lead;
          return [...leads];
        }
        return [lead, ...leads];
      });
      const displayName = lead.username ? `@${lead.username}` : lead.firstName || lead.userId;
      this.toastService.success(`\u{1F3AF} ${this.t("newLeadCaptured")}: ${displayName}`, 4e3);
    });
    this.ipcService.on("session-files-cleaned", (data) => {
      this.toastService.success(`\u6E05\u7406\u5B8C\u6210\uFF1A\u5220\u9664\u4E86 ${data.deleted_count} \u4E2A\u5B64\u7ACB\u6587\u4EF6\uFF0C\u4FDD\u7559\u4E86 ${data.kept_count} \u4E2A\u6709\u6548\u6587\u4EF6`);
      console.log("[Frontend] Session files cleaned:", data);
    });
    this.ipcService.on("session-files-cleanup-error", (data) => {
      this.toastService.error(`\u6E05\u7406\u5931\u8D25\uFF1A${data.error}`);
      console.error("[Frontend] Session files cleanup error:", data);
    });
    this.ipcService.on("session-import-result", (data) => {
      console.log("[Frontend] Session import result:", data);
      if (data.success) {
        this.toastService.success(data.phone ? `\u2705 Session \u5C0E\u5165\u6210\u529F: ${data.phone}` : `\u2705 \u5C0E\u5165\u5B8C\u6210: ${data.count || 1} \u500B\u5E33\u865F`, 3e3);
        this.ipcService.send("get-initial-state");
      } else {
        this.toastService.error(`\u5C0E\u5165\u5931\u6557: ${data.message}`, 4e3);
      }
    });
    this.ipcService.on("session-import-needs-credentials", (data) => {
      console.log("[Frontend] Session import needs credentials:", data);
      this.toastService.warning(`\u26A0\uFE0F \u5C0E\u5165 ${data.phoneNumber} \u9700\u8981 API \u6191\u64DA`, 4e3);
      this.toastService.info("\u8ACB\u5148\u5728\u300CAPI \u6191\u64DA\u6C60\u300D\u9801\u9762\u6DFB\u52A0 API \u6191\u64DA\uFF0C\u7136\u5F8C\u91CD\u8A66\u5C0E\u5165", 5e3);
    });
    this.ipcService.on("orphan-sessions-detected", (data) => {
      console.log("[Frontend] Orphan sessions detected:", data);
      if (data.count > 0) {
        this.orphanSessions.set(data.sessions);
        this.showOrphanSessionDialog.set(true);
        this.toastService.warning(`\u767C\u73FE ${data.count} \u500B\u9700\u8981\u624B\u52D5\u6062\u5FA9\u7684 Session \u6587\u4EF6`, 5e3);
      }
    });
    this.ipcService.on("orphan-sessions-scanned", (data) => {
      console.log("[Frontend] Orphan sessions scanned:", data);
      if (data.success && data.orphan_sessions.length > 0) {
        this.orphanSessions.set(data.orphan_sessions);
      }
    });
    this.ipcService.on("orphan-sessions-recovered", (data) => {
      console.log("[Frontend] Orphan sessions recovered:", data);
      this.isRecoveringOrphanSessions.set(false);
      if (data.success) {
        this.toastService.success(`\u6210\u529F\u6062\u5FA9 ${data.recovered_count} \u500B\u5E33\u865F`, 3e3);
        this.showOrphanSessionDialog.set(false);
        this.orphanSessions.set([]);
        this.ipcService.send("get-accounts");
      } else {
        this.toastService.error(`\u6062\u5FA9\u5931\u6557: ${data.message}`, 4e3);
      }
    });
    this.ipcService.on("keyword-set-validation-error", (data) => {
      console.error("[Frontend] Keyword set validation error:", data);
      const errorMsg = data.errors?.join("; ") || "\u6DFB\u52A0\u5173\u952E\u8BCD\u96C6\u5931\u8D25";
      this.toastService.error(`\u5173\u952E\u8BCD\u96C6\u9519\u8BEF: ${errorMsg}`);
    });
    this.ipcService.on("keyword-set-error", (data) => {
      console.log("[Frontend] Keyword set error event:", data);
      if (data.success) {
        if (data.message) {
          this.toastService.success(data.message);
        }
        this.newKeywordSet.set({ name: "" });
      } else {
        const errorMsg = data.error || "\u6DFB\u52A0\u5173\u952E\u8BCD\u96C6\u5931\u8D25";
        console.warn("[Frontend] Keyword set error:", errorMsg, data.details);
        if (errorMsg.includes("\u5DF2\u5B58\u5728") || errorMsg.includes("already exists")) {
          this.toastService.warning(`\u5173\u952E\u8BCD\u96C6\u5DF2\u5B58\u5728`, 3e3);
        } else if (errorMsg.includes("\u4E0D\u5B58\u5728") || errorMsg.includes("not found")) {
          console.log("[Frontend] Keyword set already deleted, ignoring");
        } else if (errorMsg.includes("\u6570\u636E\u5EAB") || errorMsg.includes("\u6570\u636E\u5E93") || errorMsg.includes("\u640D\u58DE") || errorMsg.includes("\u635F\u574F")) {
          this.toastService.error(`\u6570\u636E\u5E93\u9519\u8BEF: ${errorMsg}\u3002\u8BF7\u4F7F\u7528 rebuild_database.py \u91CD\u5EFA\u6570\u636E\u5E93\u3002`, 1e4);
        } else {
          this.toastService.error(`\u5173\u952E\u8BCD\u96C6\u9519\u8BEF: ${errorMsg}`);
        }
      }
    });
    this.ipcService.on("keyword-validation-error", (data) => {
      console.error("[Frontend] Keyword validation error:", data);
      const errorMsg = data.errors?.join("; ") || "\u6DFB\u52A0\u5173\u952E\u8BCD\u5931\u8D25";
      this.toastService.error(`\u5173\u952E\u8BCD\u9519\u8BEF: ${errorMsg}`);
    });
    this.ipcService.on("group-validation-error", (data) => {
      console.error("[Frontend] Group validation error:", data);
      const errorMsg = data.errors?.join("; ") || "\u6DFB\u52A0\u7FA4\u7EC4\u5931\u8D25";
      this.toastService.error(`\u7FA4\u7EC4\u9519\u8BEF: ${errorMsg}`);
    });
    this.ipcService.on("group-membership-status", (data) => {
      console.log("[Frontend] Group membership status:", data);
      if (data.status.is_member) {
        this.toastService.success(`\u2713 \u76E3\u63A7\u865F\u5DF2\u5728\u7FA4\u7D44\u4E2D: ${data.status.chat_title || data.url}`, 3e3);
      } else if (data.status.can_join) {
        if (data.status.is_private) {
          this.toastService.warning(`\u26A0 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u6B64\u79C1\u6709\u7FA4\u7D44\uFF0C\u9700\u8981\u624B\u52D5\u5C07\u76E3\u63A7\u865F\u52A0\u5165\u7FA4\u7D44`, 5e3);
        } else {
          this.toastService.info(`\u2139 \u76E3\u63A7\u865F\u672A\u52A0\u5165\u6B64\u7FA4\u7D44\uFF0C\u555F\u52D5\u76E3\u63A7\u6642\u5C07\u81EA\u52D5\u52A0\u5165`, 4e3);
        }
      }
    });
    this.ipcService.on("group-join-result", (data) => {
      console.log("[Frontend] Group join result:", data);
      if (data.success) {
        if (data.alreadyMember) {
          this.toastService.success(`${data.phone} \u5DF2\u7D93\u5728\u7FA4\u7D44 ${data.chatTitle || data.groupUrl} \u4E2D`, 3e3);
        } else {
          this.toastService.success(`${data.phone} \u6210\u529F\u52A0\u5165\u7FA4\u7D44 ${data.chatTitle || data.groupUrl}`, 4e3);
        }
      } else {
        this.toastService.error(`\u52A0\u5165\u7FA4\u7D44\u5931\u6557: ${data.error}`, 5e3);
      }
    });
    this.ipcService.on("template-validation-error", (data) => {
      console.error("[Frontend] Template validation error:", data);
      const errorMsg = data.errors?.join("; ") || "\u6DFB\u52A0\u6A21\u677F\u5931\u8D25";
      this.toastService.error(`\u6A21\u677F\u9519\u8BEF: ${errorMsg}`);
    });
    this.ipcService.on("campaign-validation-error", (data) => {
      console.error("[Frontend] Campaign validation error:", data);
      const errorMsg = data.errors?.join("; ") || "\u521B\u5EFA\u6D3B\u52A8\u5931\u8D25";
      this.toastService.error(`\u6D3B\u52A8\u9519\u8BEF: ${errorMsg}`);
    });
    this.ipcService.on("login-requires-code", (data) => {
      console.log("[Frontend] Received login-requires-code event:", data);
      console.log("[Frontend] Current loginState before update:", this.loginState());
      this.loginState.set({
        accountId: data.accountId,
        phone: data.phone,
        requiresCode: true,
        requires2FA: false,
        phoneCodeHash: data.phoneCodeHash,
        isSubmittingCode: false,
        // Reset submitting state
        canRetrySMS: data.canRetrySMS || false,
        waitSeconds: data.waitSeconds
      });
      console.log("[Frontend] Updated loginState:", this.loginState());
      console.log("[Frontend] requiresCode value:", this.loginState().requiresCode);
      this.loginCode.set("");
      if (data.message) {
        if (data.sendType === "app") {
          this.toastService.info(data.message, 8e3);
        } else {
          this.toastService.info(data.message);
        }
      } else if (data.sendType === "app") {
        this.toastService.info("\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230\u60A8\u7684 Telegram \u5E94\u7528\u3002\u8BF7\u68C0\u67E5\u60A8\u624B\u673A\u4E0A\u5DF2\u767B\u5F55\u7684 Telegram \u5E94\u7528\uFF0C\u67E5\u770B\u9A8C\u8BC1\u7801\u6D88\u606F\u3002", 8e3);
      } else if (data.sendType === "sms") {
        this.toastService.info(`\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230 ${data.phone} \u7684\u77ED\u4FE1\uFF0C\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801`);
      } else {
        this.toastService.info(`\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230 ${data.phone}\uFF0C\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801`);
      }
    });
    this.ipcService.on("login-requires-2fa", (data) => {
      console.log("[Frontend] Received login-requires-2fa event:", data);
      this.loginState.set({
        accountId: data.accountId,
        phone: data.phone,
        requiresCode: false,
        requires2FA: true,
        phoneCodeHash: null,
        isSubmittingCode: false
        // Reset submitting state
      });
      this.login2FAPassword.set("");
      this.toastService.info("\u8BF7\u8F93\u5165 2FA \u5BC6\u7801");
    });
    this.ipcService.on("account-login-error", (data) => {
      console.error("[Frontend] Account login error:", data);
      if (data.floodWait) {
        const waitSeconds = data.floodWait;
        const hours = Math.floor(waitSeconds / 3600);
        const minutes = Math.floor(waitSeconds % 3600 / 60);
        const seconds = waitSeconds % 60;
        let timeStr = "";
        if (hours > 0) {
          timeStr = `${hours} \u5C0F\u65F6`;
          if (minutes > 0) {
            timeStr += ` ${minutes} \u5206\u949F`;
          }
        } else if (minutes > 0) {
          timeStr = `${minutes} \u5206\u949F`;
          if (seconds > 0) {
            timeStr += ` ${seconds} \u79D2`;
          }
        } else {
          timeStr = `${seconds} \u79D2`;
        }
        const floodWaitMsg = `\u8BF7\u6C42\u8FC7\u4E8E\u9891\u7E41\uFF0C\u8BF7\u7B49\u5F85 ${timeStr} \u540E\u518D\u8BD5\u3002\u9A8C\u8BC1\u7801\u672A\u53D1\u9001\u3002`;
        this.toastService.error(floodWaitMsg);
        console.error("FloodWait error:", { waitSeconds, timeStr });
      } else {
        this.toastService.error(data.friendlyMessage || data.message);
      }
      console.error("Login error details:", {
        accountId: data.accountId,
        phone: data.phone,
        status: data.status,
        message: data.message,
        codeExpired: data.codeExpired,
        floodWait: data.floodWait
      });
      const state = this.loginState();
      this.loginState.set({
        accountId: state.accountId,
        phone: state.phone,
        requiresCode: state.requiresCode,
        requires2FA: state.requires2FA,
        phoneCodeHash: state.phoneCodeHash,
        isSubmittingCode: false
      });
      if (data.floodWait) {
        this.cancelLogin();
        return;
      }
      if (data.codeExpired) {
        this.loginState.set({
          accountId: state.accountId,
          phone: state.phone,
          requiresCode: false,
          // Reset to allow resending
          requires2FA: false,
          phoneCodeHash: null,
          isSubmittingCode: false
        });
        this.loginCode.set("");
      } else {
        if (data.message && (data.message.includes("banned") || data.message.includes("invalid phone"))) {
          this.cancelLogin();
        } else if (data.message && data.message.includes("Invalid verification code")) {
          this.loginState.set({
            accountId: state.accountId,
            phone: state.phone,
            requiresCode: true,
            // Show code dialog again
            requires2FA: false,
            phoneCodeHash: state.phoneCodeHash,
            isSubmittingCode: false
          });
        }
      }
    });
    this.ipcService.on("account-status-updated", (data) => {
    });
    this.ipcService.on("initial-state-core", (state) => {
      console.log("[Frontend] \u{1F680} Received initial-state-core (accounts + settings)");
      if (state?.accounts) {
        this.accounts.set(state.accounts);
        console.log("[Frontend] Accounts loaded:", state.accounts.length);
      }
      if (state?.settings) {
        this.spintaxEnabled.set(state.settings.spintaxEnabled ?? true);
        this.autoReplyEnabled.set(state.settings.autoReplyEnabled ?? false);
        this.autoReplyMessage.set(state.settings.autoReplyMessage || "Thanks for getting back to me! I'll read your message and respond shortly.");
        this.smartSendingEnabled.set(state.settings.smartSendingEnabled ?? true);
      }
      if (state?.isMonitoring !== void 0) {
        this.isMonitoring.set(state.isMonitoring);
      }
      console.log("[App] Setting coreDataLoaded to true");
      this.coreDataLoaded.set(true);
      console.log("[App] coreDataLoaded is now:", this.coreDataLoaded());
    });
    this.ipcService.on("initial-state-config", (state) => {
      console.log("[Frontend] \u{1F4CB} Received initial-state-config");
      if (state?.keywordSets) {
        this.keywordSets.set(state.keywordSets);
      }
      if (state?.monitoredGroups) {
        this.monitoredGroups.set(state.monitoredGroups);
      }
      if (state?.campaigns) {
        this.campaigns.set(state.campaigns);
      }
      if (state?.messageTemplates) {
        this.messageTemplates.set(state.messageTemplates);
      }
    });
    this.ipcService.on("initial-state-data", (state) => {
      console.log("[Frontend] \u{1F4CA} Received initial-state-data (leads + logs)");
      console.log("[Frontend] leads count:", state?.leads?.length, "total:", state?.leadsTotal, "hasMore:", state?.leadsHasMore);
      if (state?.leads) {
        const mappedLeads = (state.leads || []).map((l) => this.mapLeadFromBackend(l));
        this.leads.set(mappedLeads);
        this.contactsService.importLeadsDirectly(mappedLeads);
        console.log("[Frontend] Initial leads synced to resource center:", mappedLeads.length);
      }
      if (state?.leadsTotal !== void 0) {
        this.leadsTotal.set(state.leadsTotal);
      }
      if (state?.leadsHasMore !== void 0) {
        this.leadsHasMore.set(state.leadsHasMore);
      }
      if (state?.leads && state?.leadsTotal && state.leads.length < state.leadsTotal) {
        console.log("[Frontend] \u{1F504} Auto-loading remaining leads...");
        this.leadsHasMore.set(true);
        this.leadsLoading.set(false);
        setTimeout(() => this.loadRemainingLeads(), 500);
      }
      if (state?.logs) {
        this.logs.set(state.logs);
      }
    });
    this.ipcService.on("initial-state", (state) => {
      console.log("[Frontend] \u2605\u2605\u2605 Received initial-state event \u2605\u2605\u2605");
      console.log("[Frontend] initial-state payload:", state);
      console.log("[Frontend] accounts in payload:", state?.accounts?.length || 0);
      const now = Date.now();
      if (now - this.lastInitialStateTime < 500) {
        if (this.initialStateDebounceTimer) {
          clearTimeout(this.initialStateDebounceTimer);
        }
        this.initialStateDebounceTimer = setTimeout(() => {
          try {
            this.applyInitialState(state);
          } catch (error) {
            console.error("[Frontend] Error applying initial state:", error);
          } finally {
            this.initialStateDebounceTimer = void 0;
          }
        }, 500);
        return;
      }
      this.lastInitialStateTime = now;
      try {
        this.applyInitialState(state);
      } catch (error) {
        console.error("[Frontend] Error applying initial state:", error);
      }
    });
    this.ipcService.on("keyword-sets-updated", (data) => {
      if (typeof console !== "undefined" && console.log) {
        console.log("[Frontend] Received keyword-sets-updated:", data.keywordSets?.length || 0);
      }
      if (this.keywordSetsUpdateDebounceTimer) {
        clearTimeout(this.keywordSetsUpdateDebounceTimer);
        this.keywordSetsUpdateDebounceTimer = void 0;
      }
      if (data.keywordSets && Array.isArray(data.keywordSets)) {
        this.keywordSetsUpdateDebounceTimer = setTimeout(() => {
          try {
            const seenSetIds = /* @__PURE__ */ new Set();
            const deduplicatedSets = data.keywordSets.filter((set) => {
              if (!set || typeof set.id !== "number") {
                return false;
              }
              if (seenSetIds.has(set.id)) {
                return false;
              }
              seenSetIds.add(set.id);
              return true;
            }).map((set) => {
              const keywords = Array.isArray(set.keywords) ? set.keywords : [];
              const seenKeywords = /* @__PURE__ */ new Set();
              const uniqueKeywords = keywords.filter((k) => {
                if (!k || typeof k.keyword !== "string") {
                  return false;
                }
                const key = `${k.keyword}_${k.isRegex}`;
                if (seenKeywords.has(key)) {
                  return false;
                }
                seenKeywords.add(key);
                return true;
              });
              return __spreadProps(__spreadValues({}, set), {
                keywords: uniqueKeywords
              });
            });
            const currentSets = this.keywordSets();
            const hasChanged = JSON.stringify(currentSets) !== JSON.stringify(deduplicatedSets);
            if (hasChanged) {
              this.keywordSets.set(deduplicatedSets);
            }
          } catch (error) {
            console.error("[Frontend] Error processing keyword-sets-updated:", error);
          } finally {
            this.keywordSetsUpdateDebounceTimer = void 0;
          }
        }, 150);
      } else {
        const currentSets = this.keywordSets();
        if (currentSets.length > 0) {
          this.keywordSets.set([]);
        }
      }
    });
    this.ipcService.on("keyword-validation-error", (data) => {
      console.log("[Frontend] Keyword validation error:", data);
      if (data.errors && data.errors.length > 0) {
        this.toastService.error(`\u95DC\u9375\u8A5E\u9A57\u8B49\u5931\u6557: ${data.errors.join(", ")}`, 4e3);
        setTimeout(() => {
        }, 1e3);
      }
    });
    this.ipcService.on("groups-updated", (data) => {
      console.log("[Frontend] Received groups-updated:", data.monitoredGroups?.length || 0);
      this.monitoredGroups.set(data.monitoredGroups || []);
    });
    this.ipcService.on("templates-updated", (data) => {
      console.log("[Frontend] Received templates-updated:", data.messageTemplates?.length || 0);
      this.messageTemplates.set(data.messageTemplates || []);
    });
    this.ipcService.on("campaigns-updated", (data) => {
      console.log("[Frontend] Received campaigns-updated:", data.campaigns?.length || 0);
      this.campaigns.set(data.campaigns || []);
      this.isSubmittingCampaign.set(false);
    });
    this.ipcService.on("campaign-already-exists", (data) => {
      console.log("[Frontend] Campaign already exists:", data);
      this.toastService.warning(data.message || `\u6D3B\u52D5 "${data.name}" \u5DF2\u5B58\u5728`, 4e3);
      this.isSubmittingCampaign.set(false);
    });
    this.ipcService.on("campaign-validation-error", (data) => {
      console.log("[Frontend] Campaign validation error:", data);
      if (data.errors && data.errors.length > 0) {
        this.toastService.error(`\u6D3B\u52D5\u9A57\u8B49\u5931\u6557: ${data.errors.join(", ")}`, 4e3);
      }
      this.isSubmittingCampaign.set(false);
    });
    this.ipcService.on("search-leads-result", (data) => {
      this.isSearchingLeads.set(false);
      if (data.success && data.results) {
        this.leadSearchResults.set(data.results);
        if (data.results.length === 0) {
          this.toastService.info("\u672A\u627E\u5230\u5339\u914D\u7684\u6F5C\u5728\u5BA2\u6237");
        }
      } else {
        this.toastService.error(data.error || "\u641C\u7D22\u5931\u8D25");
        this.leadSearchResults.set([]);
      }
    });
    this.ipcService.on("backup-created", (data) => {
      this.isCreatingBackup.set(false);
      if (data.success) {
        this.toastService.success("\u5907\u4EFD\u521B\u5EFA\u6210\u529F");
        this.loadBackups();
      } else {
        this.toastService.error(data.error || "\u5907\u4EFD\u521B\u5EFA\u5931\u8D25");
      }
    });
    this.ipcService.on("backups-list", (data) => {
      if (data.success && data.backups) {
        this.backups.set(data.backups);
      }
    });
    this.ipcService.on("backup-restored", (data) => {
      this.isRestoringBackup.set(false);
      if (data.success) {
        this.toastService.success("\u5907\u4EFD\u6062\u590D\u6210\u529F\uFF0C\u8BF7\u5237\u65B0\u9875\u9762");
      } else {
        this.toastService.error(data.error || "\u5907\u4EFD\u6062\u590D\u5931\u8D25");
      }
    });
    this.ipcService.on("backup-deleted", (data) => {
      if (data.success) {
        this.toastService.success("\u5907\u4EFD\u5DF2\u5220\u9664");
        this.loadBackups();
      } else {
        this.toastService.error(data.error || "\u5220\u9664\u5907\u4EFD\u5931\u8D25");
      }
    });
    this.ipcService.on("leads-updated", (data) => {
      const total = data.total ?? data.leads?.length ?? 0;
      console.log("[Frontend] Received leads-updated:", data.leads?.length || 0, "total:", total);
      const mappedLeads = (data.leads || []).map((l) => this.mapLeadFromBackend(l));
      this.leads.set(mappedLeads);
      this.leadsTotal.set(total);
      this.contactsService.importLeadsDirectly(mappedLeads);
    });
    this.ipcService.on("leads-paginated", (data) => {
      console.log("[Frontend] Received leads-paginated:", data.leads?.length || 0, "total:", data.total);
      this.leadsLoading.set(false);
      if (data.leads && data.leads.length > 0) {
        const mappedLeads = data.leads.map((l) => this.mapLeadFromBackend(l));
        this.leads.set(mappedLeads);
        this.leadsTotal.set(data.total);
        this.leadsHasMore.set(data.hasMore);
        this.contactsService.importLeadsDirectly(mappedLeads);
        console.log("[Frontend] \u2705 Synced to resource center:", mappedLeads.length, "leads");
        if (!data.hasMore) {
          this.toastService.success(`\u6578\u64DA\u52A0\u8F09\u5B8C\u6210\uFF1A\u5171 ${mappedLeads.length} \u689D`);
        }
      }
    });
    this.ipcService.on("funnel-stats", (data) => {
      console.log("[Frontend] Received funnel-stats:", data);
      if (!data.error) {
        this.funnelStats.set(data);
      }
    });
    this.ipcService.on("funnel-overview", (data) => {
      this.isLoadingFunnel.set(false);
      if (data.success) {
        this.funnelOverview.set({
          stages: data.stages || [],
          totalLeads: data.total_leads || 0,
          convertedLeads: data.converted_leads || 0,
          averageConversionDays: data.average_days || 0,
          conversionRate: data.conversion_rate || 0
        });
      }
    });
    this.ipcService.on("user-journey", (data) => {
      this.isLoadingJourney.set(false);
      if (data.success && data.journey) {
        this.userJourneyData.set({
          userId: data.userId,
          stages: data.journey.transitions || [],
          currentStage: data.journey.current_stage || "new",
          totalDays: data.journey.total_days || 0,
          isConverted: data.journey.is_converted || false
        });
      }
    });
    this.ipcService.on("funnel-stage-transitioned", (data) => {
      if (data.success) {
        this.toastService.success(`\u2705 \u6F0F\u6597\u968E\u6BB5\u5DF2\u66F4\u65B0: ${data.stage}`);
        this.loadFunnelOverview();
        this.loadFunnelStats();
      } else {
        this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("marketing-stats", (data) => {
      this.isLoadingMarketing.set(false);
      if (data.success !== false) {
        this.marketingStats.set({
          totalCampaigns: data.total_campaigns || 0,
          running: data.running || 0,
          completed: data.completed || 0,
          totalMessages: data.total_messages || 0,
          totalInvites: data.total_invites || 0,
          successRate: data.success_rate || 0
        });
      }
    });
    this.ipcService.on("marketing-campaigns", (data) => {
      if (data.success && data.campaigns) {
        this.marketingCampaigns.set(data.campaigns);
      }
    });
    this.ipcService.on("campaign-created", (data) => {
      if (data.success) {
        this.toastService.success("\u2705 \u71DF\u92B7\u6D3B\u52D5\u5DF2\u5275\u5EFA");
        this.showCreateCampaignDialog.set(false);
        this.newMarketingCampaign = { name: "", type: "pm", targetGroup: "", messageTemplate: "" };
        this.loadMarketingCampaigns();
      } else {
        this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("campaign-started", (data) => {
      if (data.success) {
        this.toastService.info("\u{1F680} \u71DF\u92B7\u6D3B\u52D5\u5DF2\u555F\u52D5");
        this.loadMarketingCampaigns();
      }
    });
    this.ipcService.on("campaign-complete", (data) => {
      if (data.success) {
        this.toastService.success(`\u2705 \u6D3B\u52D5\u5B8C\u6210\uFF01\u6210\u529F: ${data.stats?.success || 0}, \u5931\u6557: ${data.stats?.failed || 0}`);
        this.loadMarketingStats();
        this.loadMarketingCampaigns();
      }
    });
    this.ipcService.on("warmup-progress", (data) => {
      if (data.success && data.accountId) {
        this.warmupDetails.update((details) => __spreadProps(__spreadValues({}, details), {
          [data.accountId]: {
            enabled: data.enabled || false,
            startDate: data.start_date || null,
            stage: data.stage?.stage || 0,
            stageName: data.stage?.stage_name || "",
            daysCompleted: data.days_completed || 0,
            totalDays: data.total_days || 14,
            progressPercent: data.progress_percentage || 0,
            dailyLimit: data.stage?.daily_limit || 0,
            allowedActions: data.stage?.allowed_actions || []
          }
        }));
      }
    });
    this.ipcService.on("migration-status", (data) => {
      this.isLoadingMigration.set(false);
      if (!data.error) {
        this.migrationStatus.set({
          currentVersion: data.current_version || 0,
          latestVersion: data.latest_version || 0,
          appliedCount: data.applied_count || 0,
          pendingCount: data.pending_count || 0,
          appliedMigrations: data.applied_migrations || [],
          pendingMigrations: data.pending_migrations || []
        });
      }
    });
    this.ipcService.on("migration-completed", (data) => {
      this.isRunningMigration.set(false);
      if (data.error) {
        this.toastService.error(`\u9077\u79FB\u5931\u6557: ${data.error}`);
      } else {
        this.toastService.success("\u2705 \u6578\u64DA\u5EAB\u9077\u79FB\u5B8C\u6210");
        this.loadMigrationStatus();
      }
    });
    this.ipcService.on("rollback-completed", (data) => {
      this.isRunningMigration.set(false);
      if (data.error) {
        this.toastService.error(`\u56DE\u6EFE\u5931\u6557: ${data.error}`);
      } else {
        this.toastService.success("\u2705 \u6578\u64DA\u5EAB\u56DE\u6EFE\u5B8C\u6210");
        this.loadMigrationStatus();
      }
    });
    this.ipcService.on("scheduler-status", (data) => {
      if (data.success !== false) {
        this.schedulerStatus.set({
          isRunning: data.is_running || false,
          tasks: data.tasks || []
        });
      }
    });
    this.ipcService.on("scheduler-started", (data) => {
      if (data.success) {
        this.toastService.success("\u2705 \u8ABF\u5EA6\u5668\u5DF2\u555F\u52D5");
        this.loadSchedulerStatus();
      }
    });
    this.ipcService.on("scheduler-stopped", (data) => {
      if (data.success) {
        this.toastService.info("\u8ABF\u5EA6\u5668\u5DF2\u505C\u6B62");
        this.loadSchedulerStatus();
      }
    });
    this.ipcService.on("scheduler-task-result", (data) => {
      if (data.success) {
        this.toastService.success(`\u2705 \u4EFB\u52D9 ${data.taskName} \u57F7\u884C\u5B8C\u6210`);
      } else {
        this.toastService.error(`\u4EFB\u52D9\u57F7\u884C\u5931\u6557: ${data.error}`);
      }
      this.loadSchedulerStatus();
    });
    this.ipcService.on("log-files", (data) => {
      this.isLoadingLogs.set(false);
      if (data.files) {
        this.logFiles.set(data.files.map((f) => ({
          name: f.name,
          size: f.size,
          sizeFormatted: this.formatFileSize(f.size),
          modifiedAt: f.modified_at,
          isCompressed: f.name.endsWith(".gz")
        })));
      }
    });
    this.ipcService.on("log-stats", (data) => {
      if (!data.error) {
        this.logStats.set({
          totalFiles: data.total_files || 0,
          totalSize: data.total_size || 0,
          totalSizeFormatted: this.formatFileSize(data.total_size || 0),
          compressedFiles: data.compressed_files || 0,
          oldestFile: data.oldest_file,
          newestFile: data.newest_file
        });
      }
    });
    this.ipcService.on("logs-rotated", (data) => {
      this.isRotatingLogs.set(false);
      if (data.success) {
        this.toastService.success(`\u2705 \u65E5\u8A8C\u8F2A\u8F49\u5B8C\u6210\uFF0C\u8F2A\u8F49\u4E86 ${data.rotated_count || 0} \u500B\u6587\u4EF6`);
        this.loadLogFiles();
        this.loadLogStats();
      } else {
        this.toastService.error(`\u65E5\u8A8C\u8F2A\u8F49\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("log-file-content", (data) => {
      if (data.content) {
        this.logFileContent.set(data.content);
      }
    });
    this.ipcService.on("log-file-deleted", (data) => {
      if (data.success) {
        this.toastService.success("\u2705 \u65E5\u8A8C\u6587\u4EF6\u5DF2\u522A\u9664");
        this.loadLogFiles();
        this.loadLogStats();
      }
    });
    this.ipcService.on("resources-batch-updated", (data) => {
      if (data.success) {
        this.toastService.success(`\u2705 \u5DF2\u66F4\u65B0 ${data.count || 0} \u500B\u8CC7\u6E90`);
        this.loadResources();
      }
    });
    this.ipcService.on("resources-batch-deleted", (data) => {
      if (data.success) {
        this.toastService.success(`\u2705 \u5DF2\u522A\u9664 ${data.count || 0} \u500B\u8CC7\u6E90`);
        this.loadResources();
      }
    });
    this.ipcService.on("resources-cleared", (data) => {
      if (data.success) {
        this.toastService.success(`\u{1F5D1}\uFE0F \u5DF2\u6E05\u7A7A\u6240\u6709\u8CC7\u6E90\uFF0C\u5171 ${data.deletedCount || 0} \u689D`);
        this.refreshResourceStats();
      } else {
        this.toastService.error(`\u6E05\u7A7A\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("clear-resources-complete", (data) => {
      if (data.success) {
        this.toastService.success(`\u{1F9F9} \u6E05\u7406\u5B8C\u6210\uFF0C\u5DF2\u522A\u9664 ${data.deleted_count || 0} \u689D\u8A18\u9304`);
        this.discoveredResources.set([]);
        this.refreshResourceStats();
      } else {
        this.toastService.error(`\u6E05\u7406\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("users-with-profiles", (data) => {
      console.log("[Frontend] Received users-with-profiles:", data.users?.length || 0);
      if (!data.error) {
        this.usersWithProfiles.set(data);
      }
    });
    this.ipcService.on("one-click-start-progress", (data) => {
      console.log("[Frontend] One-click progress:", data);
      this.oneClickProgress.set(data.progress);
      this.oneClickMessage.set(data.message);
    });
    this.ipcService.on("group-join-progress", (data) => {
      const progressMsg = `\u{1F465} \u6B63\u5728\u6AA2\u67E5\u7FA4\u7D44 ${data.current}/${data.total}...`;
      this.oneClickMessage.set(progressMsg);
      const groupProgress = 42 + data.current / data.total * 6;
      this.oneClickProgress.set(Math.round(groupProgress));
    });
    this.ipcService.on("group-join-complete", (data) => {
      console.log("[Frontend] Group join complete:", data);
      const cachedInfo = data.skipped_cached ? ` (${data.skipped_cached} \u500B\u7DE9\u5B58\u547D\u4E2D)` : "";
      this.oneClickMessage.set(`\u2705 \u7FA4\u7D44\u52A0\u5165\u5B8C\u6210: ${data.success_count}/${data.total} \u6210\u529F${cachedInfo}`);
    });
    this.ipcService.on("one-click-start-result", (data) => {
      console.log("[Frontend] One-click result:", data);
      this.oneClickStarting.set(false);
      this.oneClickStartReport.set(data);
      this.showStartReport.set(true);
      if (data.overall_success) {
        this.toastService.success("\u{1F389} \u4E00\u9375\u555F\u52D5\u6210\u529F\uFF01\u7CFB\u7D71\u5DF2\u5C31\u7DD2", 5e3);
      } else {
        this.toastService.warning("\u26A0\uFE0F \u90E8\u5206\u529F\u80FD\u555F\u52D5\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u65E5\u8A8C", 5e3);
      }
      this.loadSystemStatus();
    });
    this.ipcService.on("one-click-stop-result", (data) => {
      console.log("[Frontend] One-click stop result:", data);
      if (data.success) {
        this.toastService.info("\u{1F6D1} \u6240\u6709\u670D\u52D9\u5DF2\u505C\u6B62", 3e3);
      }
      this.loadSystemStatus();
    });
    this.ipcService.on("system-status", (data) => {
      console.log("[Frontend] System status:", data);
      if (!data.error) {
        this.systemStatus.set(data);
      }
    });
    this.ipcService.on("trigger-rules-result", (data) => {
      if (data.success) {
        setTimeout(() => this.loadSystemStatus(), 100);
      }
    });
    this.ipcService.on("ai-settings-updated", (data) => {
      console.log("[Frontend] AI settings updated:", data);
      if (data.auto_chat_enabled !== void 0) {
        this.aiAutoChatEnabled.set(data.auto_chat_enabled);
      }
      if (data.auto_chat_mode) {
        this.aiAutoChatMode.set(data.auto_chat_mode);
      }
    });
    this.ipcService.on("bulk-update-complete", (data) => {
      console.log("[Frontend] Bulk update complete:", data);
      if (data.success) {
        this.toastService.success(`\u5DF2\u66F4\u65B0 ${data.count} \u500B\u7528\u6236`);
        this.selectedUserIds.set([]);
        this.loadUsersWithProfiles();
        this.loadFunnelStats();
      } else {
        this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("settings-updated", (settings) => {
      if (settings) {
        this.spintaxEnabled.set(settings.spintaxEnabled ?? true);
        this.autoReplyEnabled.set(settings.autoReplyEnabled ?? false);
        this.autoReplyMessage.set(settings.autoReplyMessage || "Thanks for getting back to me! I'll read your message and respond shortly.");
        this.smartSendingEnabled.set(settings.smartSendingEnabled ?? true);
      }
    });
    this.ipcService.on("queue-status", (status) => {
      if (typeof status === "object" && "phone" in status) {
        const singleStatus = status;
        this.queueStatuses.update((statuses) => __spreadProps(__spreadValues({}, statuses), {
          [singleStatus.phone]: singleStatus
        }));
      } else {
        const statuses = status;
        this.queueStatuses.set(statuses);
      }
      const allStatuses = Object.values(this.queueStatuses());
      const totalPending = allStatuses.reduce((sum, s) => sum + (s.pending || 0), 0);
      const totalSending = allStatuses.reduce((sum, s) => sum + (s.processing || 0), 0);
      const totalSent = allStatuses.reduce((sum, s) => sum + (s.stats?.completed || 0), 0);
      const totalFailed = allStatuses.reduce((sum, s) => sum + (s.failed || 0), 0);
      const total = totalSent + totalFailed;
      this.queueStats.set({
        pending: totalPending,
        sending: totalSending,
        sent: totalSent,
        failed: totalFailed,
        retrying: allStatuses.reduce((sum, s) => sum + (s.retrying || 0), 0),
        totalToday: total,
        successRate: total > 0 ? totalSent / total : 0,
        avgSendTime: allStatuses.reduce((sum, s) => sum + (s.stats?.avg_time || 0), 0) / (allStatuses.length || 1)
      });
    });
    this.ipcService.on("queue-messages", (data) => {
      this.queueMessages.set(data.messages);
    });
    this.ipcService.on("sending-stats", (data) => {
      const chartData = {
        labels: data.stats.map((s) => s.date),
        datasets: [{
          label: "\u6210\u529F\u53D1\u9001",
          data: data.stats.map((s) => s.successful || 0),
          borderColor: "rgb(34, 197, 94)",
          backgroundColor: "rgba(34, 197, 94, 0.1)",
          fill: true
        }, {
          label: "\u5931\u8D25",
          data: data.stats.map((s) => s.failed || 0),
          borderColor: "rgb(239, 68, 68)",
          backgroundColor: "rgba(239, 68, 68, 0.1)",
          fill: true
        }]
      };
      this.sendingStatsData.set(chartData);
    });
    this.ipcService.on("queue-length-history", (data) => {
      const chartData = {
        labels: data.history.map((h) => h.date),
        datasets: [{
          label: "\u961F\u5217\u957F\u5EA6",
          data: data.history.map((h) => h.queue_length || 0),
          borderColor: "rgb(59, 130, 246)",
          backgroundColor: "rgba(59, 130, 246, 0.1)",
          fill: true
        }]
      };
      this.queueLengthHistoryData.set(chartData);
    });
    this.ipcService.on("account-sending-comparison", (data) => {
      const chartData = {
        labels: data.comparison.map((c) => c.phone),
        datasets: [{
          label: "\u603B\u53D1\u9001",
          data: data.comparison.map((c) => c.total_sent || 0),
          backgroundColor: "rgba(59, 130, 246, 0.8)"
        }, {
          label: "\u6210\u529F",
          data: data.comparison.map((c) => c.successful || 0),
          backgroundColor: "rgba(34, 197, 94, 0.8)"
        }, {
          label: "\u5931\u8D25",
          data: data.comparison.map((c) => c.failed || 0),
          backgroundColor: "rgba(239, 68, 68, 0.8)"
        }]
      };
      this.accountComparisonData.set(chartData);
    });
    this.ipcService.on("campaign-performance-stats", (data) => {
      const chartData = {
        labels: data.stats.map((s) => s.campaign_name || "Unknown"),
        datasets: [{
          label: "\u6355\u83B7\u6F5C\u5728\u5BA2\u6237",
          data: data.stats.map((s) => s.leads_captured || 0),
          backgroundColor: "rgba(59, 130, 246, 0.8)"
        }, {
          label: "\u5DF2\u8054\u7CFB",
          data: data.stats.map((s) => s.leads_contacted || 0),
          backgroundColor: "rgba(34, 197, 94, 0.8)"
        }, {
          label: "\u5DF2\u56DE\u590D",
          data: data.stats.map((s) => s.leads_replied || 0),
          backgroundColor: "rgba(168, 85, 247, 0.8)"
        }]
      };
      this.campaignPerformanceData.set(chartData);
    });
    this.ipcService.on("ai-greeting-suggestion", (data) => {
      console.log("[AI] Received greeting suggestion:", data);
      this.aiGreetingSuggestion.set(data);
      this.showAiGreetingDialog.set(true);
      this.toastService.info(`\u{1F916} AI \u5DF2\u70BA @${data.username || data.firstName} \u751F\u6210\u554F\u5019\u5EFA\u8B70`, 5e3);
    });
    this.ipcService.on("alert-triggered", (alert) => {
      alert.timestamp = new Date(alert.timestamp).toISOString();
      this.alerts.update((alerts) => {
        const exists = alerts.some(
          (a) => a.alert_type === alert.alert_type && a.message === alert.message && Math.abs(new Date(a.timestamp).getTime() - new Date(alert.timestamp).getTime()) < 6e4
          // Within 1 minute
        );
        if (!exists) {
          return [alert, ...alerts].slice(0, 100);
        }
        return alerts;
      });
      this.showBrowserNotification(alert);
      this.showNotification(`\u544A\u8B66: ${alert.level.toUpperCase()}`, alert.message, { requireInteraction: alert.level === "critical" });
    });
    this.ipcService.on("alert-rules-loaded", (data) => {
      if (data.success && data.rules) {
        this.alertRules.set(data.rules);
      }
    });
    this.ipcService.on("alert-rule-updated", (data) => {
      if (data.success) {
        this.toastService.success("\u544A\u8B66\u89C4\u5219\u5DF2\u66F4\u65B0");
        this.loadAlertRules();
      } else {
        this.toastService.error(data.error || "\u66F4\u65B0\u5931\u8D25");
      }
    });
    this.ipcService.on("alert-history-loaded", (data) => {
      if (data.success && data.history) {
        this.alertHistory.set(data.history);
      }
    });
    this.ipcService.on("alerts-loaded", (data) => {
      this.alerts.set(data.alerts);
    });
    this.ipcService.on("rag-initialized", (data) => {
      this.isInitializingRag.set(false);
      if (data.success) {
        this.ragSystemInitialized.set(true);
        this.toastService.success("\u2705 RAG \u7CFB\u7D71\u521D\u59CB\u5316\u5B8C\u6210");
        this.refreshRagStats();
      } else {
        this.toastService.error(`RAG \u521D\u59CB\u5316\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("rag-stats", (data) => {
      if (data.success && data.rag) {
        const rag = data.rag;
        const byType = rag.by_type || {};
        let qaCount = 0;
        let scriptsCount = 0;
        for (const key of Object.keys(byType)) {
          if (key.toLowerCase().includes("qa") || key.toLowerCase().includes("\u554F\u7B54")) {
            qaCount += byType[key].count || 0;
          }
          if (key.toLowerCase().includes("script") || key.toLowerCase().includes("\u8A71\u8853")) {
            scriptsCount += byType[key].count || 0;
          }
        }
        this.ragStats.set({
          total_knowledge: rag.total_knowledge || 0,
          qa_count: qaCount,
          scripts_count: scriptsCount,
          total_uses: rag.total_uses || 0,
          avg_score: rag.avg_score || 0,
          chromadb_enabled: rag.chromadb_enabled || false,
          neural_embedding: rag.neural_embedding || false,
          by_type: byType
        });
        if (rag.total_knowledge > 0) {
          this.ragSystemInitialized.set(true);
        }
      }
    });
    this.ipcService.on("rag-search-result", (data) => {
      this.isSearchingRag.set(false);
      if (data.success && data.results) {
        this.ragSearchResults.set(data.results);
      } else if (data.error) {
        this.toastService.error(`\u641C\u7D22\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("rag-learning-triggered", (data) => {
      this.isRagLearning.set(false);
      if (data.success) {
        this.toastService.success(`\u{1F393} \u5B78\u7FD2\u5B8C\u6210\uFF01\u8655\u7406 ${data.conversationsProcessed || 0} \u500B\u5C0D\u8A71\uFF0C\u63D0\u53D6 ${data.knowledgeExtracted || 0} \u689D\u77E5\u8B58`);
        this.refreshRagStats();
      } else {
        this.toastService.error(`\u5B78\u7FD2\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("rag-reindex-complete", (data) => {
      this.isReindexing.set(false);
      if (data.success) {
        this.toastService.success(`\u{1F504} \u91CD\u65B0\u7D22\u5F15\u5B8C\u6210\uFF01\u8655\u7406 ${data.conversations_processed || 0} \u500B\u5C0D\u8A71`);
        this.refreshRagStats();
      } else {
        this.toastService.error(`\u91CD\u65B0\u7D22\u5F15\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("rag-cleanup-complete", (data) => {
      this.isCleaningRag.set(false);
      if (data.success) {
        this.toastService.success(`\u{1F9F9} \u6E05\u7406\u5B8C\u6210\uFF01\u522A\u9664 ${data.deleted || 0} \u689D\uFF0C\u5408\u4F75 ${data.merged || 0} \u689D`);
        this.refreshRagStats();
      } else {
        this.toastService.error(`\u6E05\u7406\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("rag-knowledge-added", (data) => {
      if (data.success) {
        this.toastService.success("\u2705 \u77E5\u8B58\u5DF2\u6DFB\u52A0");
        this.refreshRagStats();
      } else {
        this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("rag-feedback-recorded", (data) => {
      if (!data.success) {
        this.toastService.error(`\u53CD\u994B\u8A18\u9304\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("memories-searched", (data) => {
      this.isSearchingMemory.set(false);
      if (data.success && data.memories) {
        this.vectorMemorySearchResults.set(data.memories.map((m) => ({
          id: m.id,
          userId: m.user_id,
          content: m.content,
          memoryType: m.memory_type,
          importance: m.importance,
          similarity: m.similarity || 0,
          createdAt: m.created_at
        })));
      } else if (data.error) {
        this.toastService.error(`\u641C\u7D22\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("memory-added", (data) => {
      this.isAddingMemory.set(false);
      if (data.success) {
        this.toastService.success("\u2705 \u8A18\u61B6\u5DF2\u6DFB\u52A0");
        this.newMemory = { userId: "", content: "", type: "conversation", importance: 0.5 };
        this.showAddMemoryDialog.set(false);
        this.refreshMemoryStats();
      } else {
        this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("memory-stats", (data) => {
      if (data.success) {
        this.vectorMemoryStats.set({
          totalMemories: data.totalMemories || 0,
          byType: data.byType || {},
          totalUsers: data.totalUsers || 0,
          avgImportance: data.avgImportance || 0
        });
      }
    });
    this.ipcService.on("memory-user-list", (data) => {
      if (data.success && data.users) {
        this.memoryUserList.set(data.users);
      }
    });
    this.ipcService.on("memory-deleted", (data) => {
      if (data.success) {
        this.toastService.success("\u2705 \u8A18\u61B6\u5DF2\u522A\u9664");
        this.vectorMemorySearchResults.update((results) => results.filter((r) => r.id !== data.memoryId));
        this.refreshMemoryStats();
      } else {
        this.toastService.error(`\u522A\u9664\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("memories-merged", (data) => {
      if (data.success) {
        this.toastService.success(`\u2705 \u5408\u4F75\u5B8C\u6210\uFF01\u5408\u4F75\u4E86 ${data.mergedCount || 0} \u689D\u8A18\u61B6`);
        this.refreshMemoryStats();
      } else {
        this.toastService.error(`\u5408\u4F75\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("old-memories-cleaned", (data) => {
      if (data.success) {
        this.toastService.success(`\u2705 \u6E05\u7406\u5B8C\u6210\uFF01\u522A\u9664\u4E86 ${data.deletedCount || 0} \u689D\u820A\u8A18\u61B6`);
        this.refreshMemoryStats();
      } else {
        this.toastService.error(`\u6E05\u7406\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("batch-operation-result", (data) => {
      this.handleBatchOperationResult(data);
    });
    this.ipcService.on("batch-operation-progress", (data) => {
      this.handleBatchOperationProgress(data);
    });
    this.ipcService.on("batch-undo-result", (data) => {
      this.handleBatchUndoResult(data);
    });
    this.ipcService.on("batch-operation-history", (data) => {
      this.handleBatchOperationHistory(data);
    });
    this.ipcService.on("all-tags", (data) => {
      this.handleAllTags(data);
    });
    this.ipcService.on("tag-created", (data) => {
      this.handleTagCreated(data);
    });
    this.ipcService.on("tag-deleted", (data) => {
      this.handleTagDeleted(data);
    });
    this.ipcService.on("ad-templates", (data) => {
      this.handleAdTemplates(data);
    });
    this.ipcService.on("ad-schedules", (data) => {
      this.handleAdSchedules(data);
    });
    this.ipcService.on("ad-send-logs", (data) => {
      this.handleAdSendLogs(data);
    });
    this.ipcService.on("ad-overview-stats", (data) => {
      this.handleAdOverviewStats(data);
    });
    this.ipcService.on("ad-template-created", (data) => {
      this.handleAdTemplateCreated(data);
    });
    this.ipcService.on("ad-template-deleted", (data) => {
      this.handleAdTemplateDeleted(data);
    });
    this.ipcService.on("ad-template-toggled", (data) => {
      if (data.success) {
        this.loadAdTemplates();
      }
    });
    this.ipcService.on("ad-schedule-created", (data) => {
      this.handleAdScheduleCreated(data);
    });
    this.ipcService.on("ad-schedule-deleted", (data) => {
      this.handleAdScheduleDeleted(data);
    });
    this.ipcService.on("ad-schedule-toggled", (data) => {
      if (data.success) {
        this.loadAdSchedules();
      }
    });
    this.ipcService.on("ad-schedule-run-result", (data) => {
      this.handleAdScheduleRunResult(data);
    });
    this.ipcService.on("spintax-validated", (data) => {
      this.handleSpintaxValidated(data);
    });
    this.ipcService.on("ad-sent", (data) => {
      this.toastService.success(`\u5EE3\u544A\u5DF2\u767C\u9001\u5230 ${data.groupTitle || data.groupId}`);
    });
    this.ipcService.on("ad-send-failed", (data) => {
      this.toastService.error(`\u767C\u9001\u5931\u6557: ${data.error}`);
    });
    this.ipcService.on("broadcast-progress", (data) => {
      this.progressDialog.set({
        show: true,
        title: "\u5EE3\u544A\u767C\u9001\u4E2D...",
        progress: {
          current: data.current,
          total: data.total,
          message: `\u5DF2\u767C\u9001 ${data.sent}\uFF0C\u5931\u6557 ${data.failed}`
        },
        cancellable: false
      });
    });
    this.ipcService.on("broadcast-completed", (data) => {
      this.progressDialog.update((p) => __spreadProps(__spreadValues({}, p), { show: false }));
      this.toastService.success(`\u5EE3\u544A\u767C\u9001\u5B8C\u6210: ${data.sent} \u6210\u529F, ${data.failed} \u5931\u6557`);
      this.loadAdSendLogs();
      this.loadAdOverviewStats();
    });
    this.ipcService.on("tracked-users", (data) => {
      this.handleTrackedUsers(data);
    });
    this.ipcService.on("user-groups", (data) => {
      this.handleUserGroups(data);
    });
    this.ipcService.on("high-value-groups", (data) => {
      this.handleHighValueGroups(data);
    });
    this.ipcService.on("tracking-stats", (data) => {
      this.handleTrackingStats(data);
    });
    this.ipcService.on("user-added-to-track", (data) => {
      this.handleUserAddedToTrack(data);
    });
    this.ipcService.on("user-added-from-lead", (data) => {
      if (data.success) {
        this.toastService.success("Lead \u5DF2\u6DFB\u52A0\u5230\u8FFD\u8E64\u5217\u8868");
      } else {
        this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("user-removed", (data) => {
      this.handleUserRemoved(data);
    });
    this.ipcService.on("user-tracking-started", (data) => {
      this.isTrackingUser.set(true);
    });
    this.ipcService.on("user-tracking-completed", (data) => {
      this.handleUserTrackingCompleted(data);
    });
    this.ipcService.on("user-tracking-failed", (data) => {
      this.handleUserTrackingFailed(data);
    });
    this.ipcService.on("user-value-updated", (data) => {
      if (data.success) {
        this.loadTrackedUsers();
      }
    });
    this.ipcService.on("batch-tracking-progress", (data) => {
      this.progressDialog.set({
        show: true,
        title: "\u6279\u91CF\u8FFD\u8E64\u4E2D...",
        progress: {
          current: data.current,
          total: data.total,
          message: `\u6B63\u5728\u8FFD\u8E64\u7528\u6236 ${data.userId}`
        },
        cancellable: false
      });
    });
    this.ipcService.on("batch-tracking-completed", (data) => {
      this.progressDialog.update((p) => __spreadProps(__spreadValues({}, p), { show: false }));
      this.toastService.success(`\u6279\u91CF\u8FFD\u8E64\u5B8C\u6210: ${data.completed} \u6210\u529F, ${data.failed} \u5931\u6557`);
      this.loadTrackedUsers();
      this.loadTrackingStats();
    });
    this.ipcService.on("campaigns", (data) => {
      this.handleCampaigns(data);
    });
    this.ipcService.on("campaign-created", (data) => {
      this.handleCampaignCreated(data);
    });
    this.ipcService.on("campaign-deleted", (data) => {
      this.handleCampaignDeleted(data);
    });
    this.ipcService.on("campaign-started", (data) => {
      if (data.success !== false) {
        this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u555F\u52D5");
        this.loadCampaigns();
      }
    });
    this.ipcService.on("campaign-paused", (data) => {
      if (data.success) {
        this.toastService.info("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u66AB\u505C");
        this.loadCampaigns();
      }
    });
    this.ipcService.on("campaign-stopped", (data) => {
      if (data.success !== false) {
        this.toastService.info("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u505C\u6B62");
        this.loadCampaigns();
      }
    });
    this.ipcService.on("campaign-completed", (data) => {
      this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u57F7\u884C\u5B8C\u6210");
      this.loadCampaigns();
      this.loadUnifiedOverview();
    });
    this.ipcService.on("campaign-step-started", (data) => {
      this.progressDialog.set({
        show: true,
        title: "\u57F7\u884C\u71DF\u92B7\u6D3B\u52D5...",
        progress: {
          current: 0,
          total: 0,
          message: `\u57F7\u884C\u6B65\u9A5F: ${data.actionType}`
        },
        cancellable: false
      });
    });
    this.ipcService.on("campaign-step-completed", (data) => {
      this.progressDialog.update((p) => __spreadProps(__spreadValues({}, p), { show: false }));
    });
    this.ipcService.on("unified-overview", (data) => {
      this.handleUnifiedOverview(data);
    });
    this.ipcService.on("funnel-analysis", (data) => {
      this.handleFunnelAnalysis(data);
    });
    this.ipcService.on("role-templates", (data) => {
      this.handleRoleTemplates(data);
    });
    this.ipcService.on("all-roles", (data) => {
      this.handleAllRoles(data);
    });
    this.ipcService.on("role-assigned", (data) => {
      if (data.success) {
        this.toastService.success("\u89D2\u8272\u5DF2\u5206\u914D");
        this.loadAllRoles();
        this.loadRoleStats();
      } else {
        this.toastService.error(`\u5206\u914D\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("role-removed", (data) => {
      if (data.success) {
        this.toastService.success("\u89D2\u8272\u5DF2\u79FB\u9664");
        this.loadAllRoles();
        this.loadRoleStats();
      }
    });
    this.ipcService.on("role-stats", (data) => {
      this.handleRoleStats(data);
    });
    this.ipcService.on("script-templates", (data) => {
      this.handleScriptTemplates(data);
    });
    this.ipcService.on("collab-groups", (data) => {
      this.handleCollabGroups(data);
    });
    this.ipcService.on("collab-stats", (data) => {
      this.handleCollabStats(data);
    });
    this.ipcService.on("collab-group-created", (data) => {
      if (data.success !== false) {
        this.toastService.success("\u5354\u4F5C\u7FA4\u7D44\u5DF2\u5275\u5EFA");
        this.loadCollabGroups();
      }
    });
    this.ipcService.on("resource-discovery-initialized", (data) => {
      if (data.success) {
        this.resourceDiscoveryInitialized.set(true);
        this.toastService.success("\u2705 \u8CC7\u6E90\u767C\u73FE\u7CFB\u7D71\u5DF2\u521D\u59CB\u5316");
        this.refreshResourceStats();
        this.loadDiscoveryKeywords();
        if (this.pendingSearchQuery) {
          const query = this.pendingSearchQuery;
          this.pendingSearchQuery = "";
          this.toastService.info(`\u6B63\u5728\u641C\u7D22 "${query}"...`);
          setTimeout(() => this.searchResources(), 500);
        }
      } else {
        this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("search-results-direct", (data) => {
      if (this.searchTimeout) {
        clearTimeout(this.searchTimeout);
        this.searchTimeout = null;
      }
      this.isSearchingResources.set(false);
      if (data.success && data.results) {
        const results = data.results;
        const query = data.query?.toLowerCase() || "";
        const sortedResults = results.sort((a, b) => {
          const aTitle = (a.title || "").toLowerCase();
          const bTitle = (b.title || "").toLowerCase();
          const aContains = aTitle.includes(query) ? 1 : 0;
          const bContains = bTitle.includes(query) ? 1 : 0;
          if (aContains !== bContains)
            return bContains - aContains;
          return (b.overall_score || 0) - (a.overall_score || 0);
        });
        const seen = /* @__PURE__ */ new Set();
        const uniqueResults = sortedResults.filter((r) => {
          if (seen.has(r.telegram_id))
            return false;
          seen.add(r.telegram_id);
          return true;
        });
        this.discoveredResources.set(uniqueResults);
        this.currentSearchKeyword.set(query);
        if (uniqueResults.length > 0) {
          const cacheKey = this.generateSearchCacheKey(data.query || "", this.selectedSearchSources());
          this.setSearchCache(cacheKey, uniqueResults);
        }
        if (uniqueResults.length === 0) {
          console.log(`[Search] \u672A\u627E\u5230\u8207\u300C${data.query}\u300D\u76F8\u95DC\u7684\u7D50\u679C`);
        } else {
          console.log(`[Search] \u627E\u5230 ${uniqueResults.length} \u500B\u8207\u300C${data.query}\u300D\u76F8\u95DC\u7684\u7D50\u679C`);
        }
      } else if (data.error) {
        this.toastService.error(`\u641C\u7D22\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("search-resources-complete", (data) => {
      if (this.searchTimeout) {
        clearTimeout(this.searchTimeout);
        this.searchTimeout = null;
      }
      this.isSearchingResources.set(false);
      if (data.success) {
        if (data.found === 0) {
          console.log(`[Search] \u641C\u7D22\u5B8C\u6210\uFF1A\u6CA1\u6709\u627E\u5230\u76F8\u5173\u7ED3\u679C`);
        } else {
          console.log(`[Search] \u641C\u7D22\u5B8C\u6210\uFF1A\u627E\u5230 ${data.found} \u4E2A`);
        }
        this.refreshResourceStats();
      } else {
        this.toastService.error(`\u641C\u7D22\u5931\u8D25: ${data.error}`);
      }
    });
    this.ipcService.on("search-jiso-complete", (data) => {
      if (data.success && data.results) {
        const resultCount = data.results.length;
        if (resultCount === 0) {
          console.log("[Search] \u6781\u641C\uFF1A\u6CA1\u6709\u627E\u5230\u76F8\u5173\u7ED3\u679C");
        } else {
          const cacheTag = data.cached ? "\uFF08\u7F13\u5B58\uFF09" : "";
          const botTag = data.bot ? `\uFF08\u4F86\u81EA @${data.bot}\uFF09` : "";
          console.log(`[Search] \u6781\u641C\u5B8C\u6210${cacheTag}\uFF1A\u627E\u5230 ${resultCount} \u4E2A\u7FA4\u7EC4${botTag}`);
          const existingResources = this.discoveredResources();
          const existingIds = new Set(existingResources.map((r) => r.telegram_id || r.username));
          const newResults = data.results.filter((r) => !existingIds.has(r.telegram_id) && !existingIds.has(r.username)).map((r) => {
            let validUsername = r.username || "";
            if (validUsername && validUsername.toLowerCase().endsWith("bot")) {
              validUsername = "";
            }
            let validLink = r.link || "";
            if (validLink && /t\.me\/[^/]+\/\d+/.test(validLink)) {
              validLink = "";
            }
            const numericId = r.telegram_id && /^-?\d+$/.test(String(r.telegram_id)) ? String(r.telegram_id) : "";
            return {
              id: 0,
              // 未保存到數據庫
              telegram_id: numericId,
              // 只保存真正的數字 ID
              username: validUsername,
              title: r.title || "",
              description: r.description || "",
              member_count: r.member_count || 0,
              // 🔧 修復：使用後端傳來的類型，而不是硬編碼
              resource_type: r.chat_type || r.resource_type || "group",
              activity_score: 0.5,
              relevance_score: 0.6,
              overall_score: 0.6,
              // 極搜結果默認評分
              status: "discovered",
              discovery_source: "jiso",
              discovery_keyword: this.currentSearchKeyword(),
              created_at: (/* @__PURE__ */ new Date()).toISOString(),
              invite_link: validLink,
              // 🆕 只有有效的 username 才生成鏈接
              link: validLink || (validUsername ? `https://t.me/${validUsername}` : ""),
              is_saved: false,
              // 🆕 標記是否可直接加入
              can_join: !!(validLink || validUsername)
            };
          });
          if (newResults.length > 0) {
            const mergedResults = [...existingResources, ...newResults];
            this.discoveredResources.set(mergedResults);
            console.log(`[Search] \u5DF2\u5408\u4F75 ${newResults.length} \u500B\u65B0\u7D50\u679C`);
            const currentKeyword = this.currentSearchKeyword();
            if (currentKeyword && mergedResults.length > 0) {
              const cacheKey = this.generateSearchCacheKey(currentKeyword, this.selectedSearchSources());
              this.setSearchCache(cacheKey, mergedResults);
            }
          }
        }
        this.refreshResourceStats();
      } else if (data.error) {
        const errorMsg = data.error;
        let suggestions = [];
        let details = "";
        if (errorMsg.includes("Username not found") || errorMsg.includes("\u4E0D\u53EF\u7528")) {
          suggestions = [
            "\u641C\u7D22\u6A5F\u5668\u4EBA\u9996\u6B21\u4F7F\u7528\u9700\u8981\u6FC0\u6D3B",
            "\u8ACB\u5728 Telegram \u4E2D\u6253\u958B @smss \u4E26\u767C\u9001 /start",
            "\u6216\u8005\u6253\u958B @jisou3 \u4E26\u767C\u9001 /start",
            "\u6FC0\u6D3B\u5F8C\u91CD\u65B0\u641C\u7D22"
          ];
          details = "\u641C\u7D22\u6A5F\u5668\u4EBA\u5C1A\u672A\u6FC0\u6D3B";
        } else if (errorMsg.includes("FloodWait") || errorMsg.includes("\u9650\u5236")) {
          suggestions = [
            "\u7B49\u5F85\u5E7E\u5206\u9418\u5F8C\u91CD\u8A66",
            "\u6E1B\u5C11\u641C\u7D22\u983B\u7387",
            "\u4F7F\u7528\u5176\u4ED6\u5E33\u865F\u641C\u7D22"
          ];
          details = "Telegram \u8ACB\u6C42\u983B\u7387\u9650\u5236";
        } else if (errorMsg.includes("\u6CA1\u6709\u53EF\u7528")) {
          suggestions = [
            "\u6AA2\u67E5\u5E33\u865F\u662F\u5426\u5DF2\u767B\u9304",
            "\u78BA\u4FDD\u81F3\u5C11\u6709\u4E00\u500B\u5E33\u865F\u5728\u7DDA"
          ];
          details = "\u6C92\u6709\u53EF\u7528\u5E33\u865F";
        } else {
          suggestions = ["\u91CD\u8A66\u641C\u7D22", "\u4F7F\u7528\u4E0D\u540C\u95DC\u9375\u8A5E"];
        }
        this.searchError.set({
          hasError: true,
          message: errorMsg,
          details,
          suggestions
        });
        this.toastService.error(`\u6781\u641C\u5931\u6557: ${details || errorMsg}`);
      }
      const sources = this.selectedSearchSources();
      if (sources.length === 1 && sources[0] === "jiso") {
        this.isSearchingResources.set(false);
        if (this.searchTimeout) {
          clearTimeout(this.searchTimeout);
          this.searchTimeout = null;
        }
      }
    });
    this.ipcService.on("jiso-search-progress", (data) => {
      if (data.status === "searching") {
        console.log(`[Search] \u6781\u641C\uFF1A${data.message}`);
      } else if (data.status === "waiting") {
        console.log(`[Search] \u6781\u641C\u7B49\u5F85\uFF1A${data.message}`);
      }
    });
    this.ipcService.on("search-channels-list", (data) => {
      if (data.success) {
        this.systemChannels.set(data.system_channels || []);
        this.customChannels.set(data.custom_channels || []);
      }
    });
    this.ipcService.on("search-channel-added", (data) => {
      if (data.success) {
        this.toastService.success(`\u2705 \u5DF2\u6DFB\u52A0\u6E20\u9053 @${data.botUsername}`);
        this.showAddChannelDialog.set(false);
        this.loadSearchChannels();
      } else {
        this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("search-channel-updated", (data) => {
      if (data.success) {
        this.toastService.success("\u2705 \u6E20\u9053\u5DF2\u66F4\u65B0");
        this.loadSearchChannels();
      } else {
        this.toastService.error(`\u66F4\u65B0\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("search-channel-deleted", (data) => {
      if (data.success) {
        this.toastService.success("\u{1F5D1}\uFE0F \u6E20\u9053\u5DF2\u522A\u9664");
        this.loadSearchChannels();
      } else {
        this.toastService.error(`\u522A\u9664\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("search-channel-tested", (data) => {
      this.isTestingChannel.set(false);
      if (data.success) {
        this.toastService.success(`\u2705 @${data.botUsername} \u6E2C\u8A66\u6210\u529F (${data.responseTime?.toFixed(1)}s)`);
        this.loadSearchChannels();
      } else {
        this.toastService.warning(`\u274C @${data.botUsername} \u6E2C\u8A66\u5931\u6557: ${data.error}`);
        this.loadSearchChannels();
      }
    });
    this.ipcService.on("resources-list", (data) => {
      if (this.isInSearchResultMode()) {
        console.log("[\u8CC7\u6E90\u4E2D\u5FC3] \u5FFD\u7565 resources-list\uFF0C\u7576\u524D\u8655\u65BC\u641C\u7D22\u7D50\u679C\u6A21\u5F0F");
        return;
      }
      if (data.success && data.resources) {
        this.discoveredResources.set(data.resources);
        const unverifiedResources = data.resources.filter((r) => !r.type_verified && r.username);
        if (unverifiedResources.length > 0) {
          const toVerify = unverifiedResources.slice(0, 10);
          const resourceIds = toVerify.map((r) => r.id);
          this.ipcService.send("batch-verify-resource-types", { resourceIds });
        }
      }
    });
    this.ipcService.on("resource-stats", (data) => {
      if (data.success) {
        this.resourceStats.set({
          total_resources: data.total_resources || 0,
          by_status: data.by_status || {},
          by_type: data.by_type || {},
          today_discovered: data.today_discovered || 0,
          pending_joins: data.pending_joins || 0,
          joined_count: data.joined_count || 0,
          avg_score: data.avg_score || 0
        });
        if (data.total_resources && data.total_resources > 0) {
          this.resourceDiscoveryInitialized.set(true);
        }
      }
    });
    this.ipcService.on("resource-added", (data) => {
      if (data.success) {
        this.toastService.success("\u2705 \u8CC7\u6E90\u5DF2\u6DFB\u52A0");
        this.showAddResourceDialog.set(false);
        this.loadResources();
        this.refreshResourceStats();
      } else {
        this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("resource-type-verified", (data) => {
      if (data.success) {
        if (data.oldType !== data.newType) {
          this.toastService.success(`\u2705 \u985E\u578B\u5DF2\u66F4\u65B0: ${data.oldType} \u2192 ${data.newType}`);
        } else {
          this.toastService.info(`\u{1F4CB} \u985E\u578B\u78BA\u8A8D: ${data.newType}`);
        }
        this.loadResources();
      } else {
        this.toastService.error(`\u9A57\u8B49\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("resources-types-verified", (data) => {
      if (data.success && data.count && data.count > 0) {
        this.loadResources();
      }
    });
    this.ipcService.on("resource-deleted", (data) => {
      if (data.success) {
        this.toastService.success("\u{1F5D1}\uFE0F \u8CC7\u6E90\u5DF2\u522A\u9664");
        this.loadResources();
        this.refreshResourceStats();
      } else {
        this.toastService.error(`\u522A\u9664\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("leave-group-complete", (data) => {
      if (data.success) {
        this.toastService.success(`\u{1F6AA} \u5DF2\u9000\u51FA\u7FA4\u7D44`);
        this.loadResources();
        this.refreshResourceStats();
        this.ipcService.send("get-monitored-groups");
      } else {
        this.toastService.error(`\u9000\u51FA\u7FA4\u7D44\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("remove-group-result", (data) => {
      if (data.success) {
        this.toastService.success(`\u2705 \u5DF2\u505C\u6B62\u76E3\u63A7\u7FA4\u7D44`);
        this.loadResources();
        this.refreshResourceStats();
        this.ipcService.send("get-monitored-groups");
      } else {
        this.toastService.error(`\u505C\u6B62\u76E3\u63A7\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
        this.loadResources();
      }
    });
    this.ipcService.on("join-queue-updated", (data) => {
      if (data.success) {
        this.toastService.success(`\u{1F4CB} \u5DF2\u6DFB\u52A0 ${data.added} \u500B\u8CC7\u6E90\u5230\u52A0\u5165\u968A\u5217`);
        this.refreshResourceStats();
        this.selectedResourceIds.set([]);
      } else {
        this.toastService.error(`\u6DFB\u52A0\u5230\u968A\u5217\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("join-queue-processed", (data) => {
      this.isProcessingJoinQueue.set(false);
      if (data.success) {
        this.toastService.success(`\u{1F680} \u8655\u7406\u5B8C\u6210\uFF1A\u6210\u529F ${data.successCount}\uFF0C\u5931\u6557 ${data.failed}`);
        this.loadResources();
        this.refreshResourceStats();
      } else {
        this.toastService.error(`\u8655\u7406\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("batch-join-started", (data) => {
      if (data.success) {
        this.toastService.info(`\u{1F680} \u958B\u59CB\u6279\u91CF\u52A0\u5165 ${data.count} \u500B\u8CC7\u6E90`);
      }
    });
    this.ipcService.on("batch-join-complete", (data) => {
      if (data.success) {
        this.toastService.success(`\u2705 \u6279\u91CF\u52A0\u5165\u5B8C\u6210\uFF1A\u6210\u529F ${data.successCount}\uFF0C\u5931\u6557 ${data.failed}\uFF0C\u8DF3\u904E ${data.skipped}`);
        this.loadResources();
        this.refreshResourceStats();
      }
    });
    this.ipcService.on("join-and-monitor-complete", (data) => {
      this.isJoiningResource.set(false);
      if (data.success) {
        this.toastService.success("\u2705 \u5DF2\u52A0\u5165\u4E26\u6DFB\u52A0\u5230\u76E3\u63A7");
        this.showJoinMonitorDialog.set(false);
        this.loadResources();
        this.refreshResourceStats();
      } else {
        this.toastService.error(`\u52A0\u5165\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("join-and-monitor-with-account-complete", (data) => {
      this.isJoiningResource.set(false);
      if (data.success) {
        const keywordSetCount = this.joinMonitorSelectedKeywordSetIds().length;
        const currentResource = this.joinMonitorResource();
        const newStatus = data.status === "pending_approval" ? "pending_approval" : "joined";
        this.updateResourceStatusLocally(currentResource, newStatus, data.phone, data.memberCount);
        if (data.status === "pending_approval") {
          this.toastService.info(`\u{1F4E8} \u52A0\u5165\u8ACB\u6C42\u5DF2\u767C\u9001\uFF0C\u7B49\u5F85\u7BA1\u7406\u54E1\u6279\u51C6
\u5E33\u865F: ${data.phone}`, 5e3);
          this.showJoinMonitorDialog.set(false);
        } else {
          this.showPostJoinOptions(currentResource, data.phone, keywordSetCount);
        }
        this.loadResources();
        this.refreshResourceStats();
        this.ipcService.send("get-monitored-groups");
      } else {
        const errorMsg = data.error || "\u672A\u77E5\u932F\u8AA4";
        if (errorMsg.includes("\u7F3A\u5C11\u52A0\u5165\u65B9\u5F0F") || errorMsg.includes("username")) {
          this.toastService.error(`\u274C \u7121\u6CD5\u52A0\u5165\uFF1A\u6B64\u7FA4\u7D44\u6C92\u6709\u63D0\u4F9B\u6709\u6548\u7684\u52A0\u5165\u93C8\u63A5
\u8ACB\u5728 Telegram \u4E2D\u624B\u52D5\u7372\u53D6\u7FA4\u7D44\u93C8\u63A5`, 6e3);
        } else {
          this.toastService.error(`\u274C \u52A0\u5165\u5931\u6557: ${errorMsg}`, 5e3);
        }
      }
    });
    this.ipcService.on("batch-join-and-monitor-complete", (data) => {
      this.isJoiningResource.set(false);
      this.closeBatchJoinMonitorDialog();
      if (data.success) {
        const keywordSetCount = this.joinMonitorSelectedKeywordSetIds().length;
        const message = keywordSetCount > 0 ? `\u2705 \u6279\u91CF\u52A0\u5165\u76E3\u63A7\u5B8C\u6210\uFF1A\u6210\u529F ${data.successCount}\uFF0C\u5931\u6557 ${data.failed}\uFF0C\u5DF2\u7D81\u5B9A ${keywordSetCount} \u500B\u95DC\u9375\u8A5E\u96C6` : `\u2705 \u6279\u91CF\u52A0\u5165\u76E3\u63A7\u5B8C\u6210\uFF1A\u6210\u529F ${data.successCount}\uFF0C\u5931\u6557 ${data.failed}`;
        this.toastService.success(message);
        this.loadResources();
        this.refreshResourceStats();
        this.selectedResourceIds.set([]);
        this.ipcService.send("get-monitored-groups");
      } else {
        this.toastService.error(`\u6279\u91CF\u64CD\u4F5C\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("members-extraction-progress", (data) => {
      this.memberListProgress.set({
        extracted: data.extracted,
        total: data.total,
        status: data.status
      });
    });
    this.ipcService.on("members-extracted", (data) => {
      this.memberListLoading.set(false);
      if (data.success && data.members) {
        const existingIds = new Set(this.memberListData().map((m) => m.user_id));
        const newMembers = data.members.filter((m) => !existingIds.has(m.user_id));
        this.memberListData.update((current) => [...current, ...newMembers]);
        this.memberListProgress.update((p) => __spreadProps(__spreadValues({}, p), {
          extracted: this.memberListData().length,
          status: `\u5DF2\u63D0\u53D6 ${this.memberListData().length} \u500B\u6210\u54E1`
        }));
        if (newMembers.length > 0) {
          this.calculateAndShowExtractionSummary(newMembers);
        } else {
          this.toastService.info("\u6C92\u6709\u66F4\u591A\u65B0\u6210\u54E1");
        }
      } else if (data.error) {
        this.handleMemberExtractionError(data);
      }
    });
    this.ipcService.on("batch-members-extracted", (data) => {
      if (data.success) {
        this.toastService.success(`\u2705 \u6279\u91CF\u63D0\u53D6\u5B8C\u6210\uFF1A${data.totalGroups} \u500B\u7FA4\u7D44\uFF0C\u5171 ${data.totalMembers} \u500B\u6210\u54E1`);
      } else {
        this.toastService.error(`\u6279\u91CF\u63D0\u53D6\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("group-message-sent", (data) => {
      if (data.success) {
        this.toastService.success("\u2705 \u6D88\u606F\u5DF2\u6210\u529F\u767C\u9001\u5230\u7FA4\u7D44");
      } else {
        this.toastService.error(`\u274C \u767C\u9001\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
      }
    });
    this.ipcService.on("message-queued", (data) => {
      console.log("[Frontend] Message queued:", data);
      this.toastService.info(`\u{1F4E4} \u6D88\u606F\u5DF2\u52A0\u5165\u767C\u9001\u968A\u5217`);
    });
    this.ipcService.on("message-sent", (data) => {
      console.log("[Frontend] Message sent result:", data);
      if (data.success) {
        this.toastService.success(`\u2705 \u6D88\u606F\u5DF2\u6210\u529F\u767C\u9001`);
        this.closeLeadDetailModal();
        this.ipcService.send("get-leads", {});
      } else {
        this.toastService.error(`\u274C \u767C\u9001\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
      }
    });
    this.ipcService.on("link-analysis-complete", (data) => {
      this.isAnalyzingLink.set(false);
      if (data.success) {
        if (data.isPrivate) {
          this.toastService.warning(data.message || "\u9019\u662F\u79C1\u6709\u93C8\u63A5");
        } else {
          this.toastService.success("\u2705 \u5206\u6790\u5B8C\u6210");
          console.log("Link analysis result:", data);
        }
      } else {
        this.toastService.error(`\u5206\u6790\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("ollama-models", (data) => {
      if (data.success && data.models) {
        this.availableOllamaModels.set(data.models);
        this.toastService.success(`\u627E\u5230 ${data.models.length} \u500B\u6A21\u578B`);
      } else if (data.error) {
        this.toastService.error(`\u7372\u53D6\u6A21\u578B\u5217\u8868\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("local-ai-test-result", (data) => {
      this.isTestingLocalAi.set(false);
      if (data.success) {
        this.localAiStatus.set("success");
        this.aiConnectionStatus.set("success");
        this.toastService.success(data.message || "\u9023\u63A5\u6210\u529F");
      } else {
        this.localAiStatus.set("error");
        this.localAiError.set(data.error || "\u9023\u63A5\u5931\u6557");
        this.toastService.error(data.error || "\u9023\u63A5\u5931\u6557");
      }
    });
    this.ipcService.on("first-run-status", (data) => {
      this.isFirstRun.set(data.isFirstRun);
      if (data.isFirstRun) {
        console.log("[App] \u9996\u6B21\u904B\u884C\uFF0C\u5F8C\u53F0\u975C\u9ED8\u914D\u7F6E AI\uFF08\u4E0D\u5F37\u5236\u986F\u793A\u5411\u5C0E\uFF09");
        setTimeout(() => this.detectOllama(), 1e3);
      }
    });
    this.ipcService.on("backend-status", (data) => {
      console.log("[App] Backend status:", data);
      this.backendRunning.set(data.running);
      if (!data.running && data.error) {
        this.backendError.set(data.error);
        this.showBackendErrorDialog.set(true);
        this.toastService.error("\u274C Python \u5F8C\u7AEF\u672A\u904B\u884C\uFF0C\u90E8\u5206\u529F\u80FD\u7121\u6CD5\u4F7F\u7528");
      }
    });
    this.ipcService.on("ollama-detected", (data) => {
      this.isDetectingOllama.set(false);
      if (data.success) {
        this.ollamaDetected.set(data.available || false);
        if (data.models && data.models.length > 0) {
          this.detectedOllamaModels.set(data.models);
          const preferredModels = ["qwen2:7b", "qwen:7b", "llama3:8b", "mistral:7b"];
          const bestModel = preferredModels.find((m) => data.models.some((dm) => dm.includes(m.split(":")[0]))) || data.models[0];
          this.autoSelectedModel.set(bestModel);
          this.localAiModel.set(bestModel);
        }
      }
    });
    this.ipcService.on("first-run-settings-saved", (data) => {
      if (data.success) {
        console.log("[App] \u9996\u6B21\u8A2D\u7F6E\u5DF2\u4FDD\u5B58");
      } else {
        console.error("[App] \u9996\u6B21\u8A2D\u7F6E\u4FDD\u5B58\u5931\u6557:", data.error);
      }
    });
    this.ipcService.on("discovery-keywords", (data) => {
      if (data.success && data.keywords) {
        this.discoveryKeywords.set(data.keywords);
      }
    });
    this.ipcService.on("discovery-keyword-added", (data) => {
      if (data.success) {
        this.toastService.success(`\u2795 \u95DC\u9375\u8A5E\u5DF2\u6DFB\u52A0: ${data.keyword}`);
        this.showAddKeywordDialog.set(false);
        this.newResourceKeyword = "";
        this.loadDiscoveryKeywords();
      } else {
        this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("discussion-watcher-initialized", (data) => {
      if (data.success) {
        this.discussionWatcherInitialized.set(true);
        this.toastService.success("\u2705 \u8A0E\u8AD6\u7D44\u76E3\u63A7\u670D\u52D9\u5DF2\u521D\u59CB\u5316");
        this.loadChannelDiscussions();
        this.refreshDiscussionStats();
      } else {
        this.toastService.error(`\u521D\u59CB\u5316\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("discussion-discovered", (data) => {
      if (data.success && data.discussion) {
        this.toastService.success(`\u2705 \u767C\u73FE\u8A0E\u8AD6\u7D44: ${data.discussion.discussion_title}`);
        this.loadChannelDiscussions();
      } else {
        this.toastService.error(data.error || "\u672A\u627E\u5230\u8A0E\u8AD6\u7D44");
      }
    });
    this.ipcService.on("discussions-batch-discovered", (data) => {
      if (data.success) {
        this.toastService.success(`\u2705 \u767C\u73FE\u4E86 ${data.count} \u500B\u8A0E\u8AD6\u7D44`);
        this.loadChannelDiscussions();
      } else {
        this.toastService.error(`\u767C\u73FE\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("channel-discussions-list", (data) => {
      if (data.success && data.discussions) {
        this.channelDiscussions.set(data.discussions);
      }
    });
    this.ipcService.on("discussion-monitoring-status", (data) => {
      if (data.success) {
        this.toastService.success(`${data.status === "monitoring" ? "\u{1F7E2} \u958B\u59CB" : "\u{1F534} \u505C\u6B62"}\u76E3\u63A7\u8A0E\u8AD6\u7D44`);
        this.loadChannelDiscussions();
      } else {
        this.toastService.error(`\u64CD\u4F5C\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("discussion-messages", (data) => {
      this.isLoadingDiscussionMessages.set(false);
      if (data.success && data.messages) {
        this.discussionMessages.set(data.messages);
      } else {
        this.toastService.error(data.error || "\u52A0\u8F7D\u6D88\u606F\u5931\u8D25");
        this.discussionMessages.set([]);
      }
    });
    this.ipcService.on("discussion-message", (data) => {
      if (data.is_matched) {
        this.toastService.info(`\u{1F3AF} \u95DC\u9375\u8A5E\u5339\u914D: @${data.username} - ${data.keywords.join(", ")}`);
      }
    });
    this.ipcService.on("discussion-lead-captured", (data) => {
      this.toastService.success(`\u{1F464} \u65B0\u6F5B\u5728\u5BA2\u6236: @${data.username}`);
      this.refreshDiscussionStats();
    });
    this.ipcService.on("discussion-reply-result", (data) => {
      if (data.success) {
        this.toastService.success("\u2705 \u56DE\u5FA9\u5DF2\u767C\u9001");
        if (this.selectedDiscussionId()) {
          this.loadDiscussionMessages(this.selectedDiscussionId());
        }
      } else {
        this.toastService.error(`\u56DE\u5FA9\u5931\u6557: ${data.error}`);
      }
    });
    this.ipcService.on("discussion-stats", (data) => {
      if (data.success) {
        this.discussionStats.set({
          total_discussions: data.total_discussions || 0,
          monitoring_count: data.monitoring_count || 0,
          total_messages: data.total_messages || 0,
          matched_messages: data.matched_messages || 0,
          leads_from_discussions: data.leads_from_discussions || 0,
          today_messages: data.today_messages || 0,
          today_leads: data.today_leads || 0
        });
        if (data.total_discussions > 0) {
          this.discussionWatcherInitialized.set(true);
        }
      }
    });
    this.ipcService.on("chat-list", (data) => {
      if (data.success && data.chats) {
        this.chatList.set(data.chats);
      } else {
        console.error("[Frontend] Chat list error:", data.error);
      }
    });
    this.ipcService.on("chat-history-full", (data) => {
      console.log("[Frontend] Received chat-history-full event:", data);
      if (data.success && data.messages) {
        const page = this.chatHistoryPage();
        if (page === 0) {
          this.chatHistoryAllMessages.set(data.messages);
          this.chatHistory.set(data.messages);
          console.log("[Frontend] Loaded first page:", data.messages.length, "messages");
        } else {
          const existing = this.chatHistoryAllMessages();
          const combined = [...existing, ...data.messages];
          this.chatHistoryAllMessages.set(combined);
          this.chatHistory.set(combined);
          console.log("[Frontend] Loaded page", page, ":", data.messages.length, "messages, total:", combined.length);
        }
        this.chatHistoryHasMore.set(data.hasMore || false);
        this.isLoadingChatHistory.set(false);
        this.chatHistoryLoadingMore.set(false);
        console.log("[Frontend] Chat history loaded. Has more:", data.hasMore, "Total:", data.total);
      } else {
        console.error("[Frontend] Chat history error:", data.error);
        this.isLoadingChatHistory.set(false);
        this.chatHistoryLoadingMore.set(false);
      }
    });
    this.ipcService.on("chat-message-received", (data) => {
      if (this.selectedChatUserId() === data.userId) {
        this.loadChatHistory(data.userId);
      }
      this.loadChatList();
    });
    this.ipcService.on("ai-response-generated", (data) => {
      if (this.selectedChatUserId() === data.userId) {
        this.loadChatHistory(data.userId);
      }
    });
    this.ipcService.on("monitoring-status", (data) => {
      if (data.success) {
        console.log("[Frontend] Monitoring status:", data);
      }
    });
    this.ipcService.on("monitoring-health", (data) => {
      if (data.success) {
        if (data.issues && data.issues.length > 0) {
          console.warn("[Frontend] Monitoring issues:", data.issues);
        }
        if (data.warnings && data.warnings.length > 0) {
          console.warn("[Frontend] Monitoring warnings:", data.warnings);
        }
      }
    });
    this.ipcService.on("alerts-loaded", (data) => {
      const alerts = data.alerts.map((a) => __spreadProps(__spreadValues({}, a), {
        timestamp: new Date(a.timestamp).toISOString(),
        acknowledged_at: a.acknowledged_at ? new Date(a.acknowledged_at).toISOString() : void 0,
        resolved_at: a.resolved_at ? new Date(a.resolved_at).toISOString() : void 0
      }));
      this.alerts.set(alerts);
    });
  }
  applyInitialState(state) {
    console.log("Received initial state from backend:", state);
    this.backendConnectionState.set("connected");
    this.backendConnectionProgress.set(100);
    this.backendConnectionMessage.set("\u9023\u63A5\u6210\u529F");
    if (this.connectionTimeoutId) {
      clearTimeout(this.connectionTimeoutId);
      this.connectionTimeoutId = null;
    }
    this.accounts.set(state.accounts || []);
    this.keywordSets.set(state.keywordSets || []);
    this.monitoredGroups.set(state.monitoredGroups || []);
    this.campaigns.set(state.campaigns || []);
    this.messageTemplates.set(state.messageTemplates || []);
    if (state.isMonitoring !== void 0) {
      this.isMonitoring.set(state.isMonitoring);
    }
    const mappedLeads = (state.leads || []).map((l) => this.mapLeadFromBackend(l));
    this.leads.set(mappedLeads);
    this.leadsTotal.set(state.leadsTotal ?? state.leads?.length ?? 0);
    this.contactsService.importLeadsDirectly(mappedLeads);
    this.logs.set((state.logs || []).map((l) => __spreadProps(__spreadValues({}, l), { timestamp: new Date(l.timestamp) })));
    if (state.settings) {
      this.spintaxEnabled.set(state.settings.spintaxEnabled ?? true);
      this.autoReplyEnabled.set(state.settings.autoReplyEnabled ?? false);
      this.autoReplyMessage.set(state.settings.autoReplyMessage || "Thanks for getting back to me! I'll read your message and respond shortly.");
      this.smartSendingEnabled.set(state.settings.smartSendingEnabled ?? true);
    }
    this.offlineCache.cacheState({
      accounts: state.accounts || [],
      keywordSets: state.keywordSets || [],
      monitoredGroups: state.monitoredGroups || [],
      campaigns: state.campaigns || [],
      leads: state.leads || [],
      settings: state.settings || {}
    });
  }
  // --- View & Language ---
  setLanguage(lang) {
    this.translationService.setLanguage(lang);
  }
  changeView(view) {
    if (view === "ads" && !this.membershipService.hasFeature("adBroadcast")) {
      this.toastService.warning(`\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    if (view === "multi-role" && !this.membershipService.hasFeature("multiRole")) {
      this.toastService.warning(`\u{1F48E} \u591A\u89D2\u8272\u5354\u4F5C\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    if (view === "user-tracking" && !this.membershipService.hasFeature("advancedAnalytics")) {
      this.toastService.warning(`\u{1F48E} \u7528\u6236\u8FFD\u8E64\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    if (view === "campaigns" && !this.membershipService.hasFeature("aiSalesFunnel")) {
      this.toastService.warning(`\u{1F48E} \u71DF\u92B7\u6D3B\u52D5\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    if (view === "ai-team" && !this.membershipService.hasFeature("autoExecution")) {
      this.toastService.warning(`\u{1F48E} AI\u5718\u968A\u92B7\u552E\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    if (view === "ai-assistant" && !this.membershipService.hasFeature("strategyPlanning")) {
      this.toastService.warning(`\u{1F48E} AI\u7B56\u7565\u898F\u5283\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    if (view === "analytics" && !this.membershipService.hasFeature("dataInsightsBasic")) {
      this.toastService.warning(`\u{1F947} \u6578\u64DA\u6D1E\u5BDF\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    if (view === "analytics-center" && !this.membershipService.hasFeature("dataInsightsBasic")) {
      this.toastService.warning(`\u{1F947} \u6578\u64DA\u5206\u6790\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    if (view === "lead-nurturing" && !this.membershipService.hasFeature("dataInsightsBasic")) {
      this.toastService.warning(`\u{1F947} \u5BA2\u6236\u57F9\u80B2\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    if (view === "nurturing-analytics" && !this.membershipService.hasFeature("advancedAnalytics")) {
      this.toastService.warning(`\u{1F48E} \u57F9\u80B2\u5206\u6790\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    this.navBridge.navigateTo(view);
    this.currentView.set(view);
    if (view === "resources") {
      const currentLeads = this.leads();
      if (currentLeads.length > 0) {
        this.syncLeadsToResourceCenter(currentLeads);
        console.log("[changeView] Synced leads to resource center:", currentLeads.length);
      }
    }
  }
  // 智能模式切換權限檢查
  switchDashboardMode(mode) {
    if (mode === "smart" && !this.membershipService.hasFeature("smartMode")) {
      this.toastService.warning(`\u{1F947} \u667A\u80FD\u6A21\u5F0F\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    this.dashboardMode.set(mode);
  }
  // Dashboard 導航處理
  handleDashboardNavigation(page) {
    const viewMap = {
      "monitoring-accounts": "monitoring-accounts",
      "monitoring-groups": "monitoring-groups",
      "keyword-sets": "keyword-sets",
      "chat-templates": "chat-templates",
      "trigger-rules": "trigger-rules",
      // 觸發規則頁面
      "collected-users": "collected-users",
      // 收集用戶頁面（廣告識別）
      "automation-rules": "trigger-rules",
      // 觸發規則配置（新入口）
      "resources": "resources",
      "rules": "trigger-rules",
      // 自動化規則指向新的觸發規則頁面
      "send-settings": "leads",
      // 發送設置在發送控制台
      "analytics": "analytics"
    };
    const targetView = viewMap[page];
    if (targetView) {
      this.changeView(targetView);
    }
  }
  // Dashboard 配置動作處理
  handleDashboardConfigAction(action) {
    this.handleDashboardNavigation(action);
  }
  // 统一的批量操作权限检查辅助函数
  checkBatchOperationPermission() {
    if (!this.membershipService.hasFeature("batchOperations")) {
      this.toastService.warning(`\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return false;
    }
    return true;
  }
  // --- CORE LOGIC via IPC ---
  addAccount() {
    const accountCheck = this.membershipService.canAddAccount(this.accounts().length);
    if (!accountCheck.allowed) {
      this.toastService.warning(accountCheck.message || "\u5DF2\u9054\u5230\u8CEC\u6236\u6578\u91CF\u4E0A\u9650");
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    const form = this.newAccount();
    this.validationErrors.set({});
    const errors = [];
    const cleanedPhone = form.phone.trim().replace(/[\s\-\(\)]/g, "");
    if (!cleanedPhone) {
      errors.push("Phone number is required");
    } else if (!/^\+\d{1,15}$/.test(cleanedPhone)) {
      errors.push("Phone number must be in format +1234567890 (with country code)");
    }
    if (form.apiId && !/^\d+$/.test(form.apiId.trim())) {
      errors.push("API ID must be a positive integer");
    }
    if (form.apiHash && !/^[a-fA-F0-9]{32}$/.test(form.apiHash.trim())) {
      errors.push("API Hash must be a 32-character hexadecimal string");
    }
    if (form.proxy && !/^(socks5|http|https):\/\/([^:]+(:[^@]+)?@)?[^:]+(:\d+)?$/.test(form.proxy.trim())) {
      errors.push("Proxy must be in format: socks5://host:port or http://host:port");
    }
    if (errors.length > 0) {
      this.validationErrors.set({ "account": errors });
      this.toastService.error(`\u9A8C\u8BC1\u5931\u8D25: ${errors.join("; ")}`);
      console.error("Account validation errors:", errors);
      return;
    }
    const cleanedPhoneForSubmit = form.phone.trim().replace(/[\s\-\(\)]/g, "");
    const accountData = {
      phone: cleanedPhoneForSubmit,
      apiId: form.apiId.trim(),
      apiHash: form.apiHash.trim(),
      proxy: form.proxy.trim() || "",
      group: form.group.trim() || "",
      twoFactorPassword: form.twoFactorPassword.trim() || "",
      role: "Unassigned",
      // Default role
      enableWarmup: form.enableWarmup || false
    };
    console.log("Sending add-account command:", accountData);
    this.ipcService.send("add-account", accountData);
    this.newAccount.set({ phone: "", proxy: "", apiId: "", apiHash: "", enableWarmup: true, twoFactorPassword: "", group: "" });
    this.toastService.info("\u6B63\u5728\u6DFB\u52A0\u8D26\u6237\uFF0C\u8BF7\u7A0D\u5019...");
  }
  /**
   * 處理從添加帳戶頁面添加的帳戶
   */
  onAccountAdded(event) {
    console.log("[Frontend] Account added from add-account page:", event);
    this.toastService.success("\u5E33\u6236\u6DFB\u52A0\u6210\u529F\uFF01");
    this.changeView("accounts");
  }
  /**
   * 導航到添加帳戶頁面
   */
  goToAddAccount() {
    this.changeView("add-account");
  }
  loginAccount(accountId) {
    console.log("[Frontend] loginAccount called with accountId:", accountId);
    const account = this.accounts().find((a) => a.id === accountId);
    if (!account) {
      console.error("[Frontend] Account not found:", accountId);
      this.toastService.error("\u8D26\u6237\u672A\u627E\u5230");
      return;
    }
    console.log("[Frontend] Found account:", account.phone, "Status:", account.status);
    this.toastService.info("\u6B63\u5728\u767B\u5F55\u8D26\u6237...");
    this.loginState.set({
      accountId,
      phone: account.phone,
      requiresCode: false,
      requires2FA: false,
      phoneCodeHash: null,
      isSubmittingCode: false
    });
    this.loginCode.set("");
    this.login2FAPassword.set("");
    console.log("[Frontend] Sending login-account command to IPC");
    this.ipcService.send("login-account", accountId);
  }
  /**
   * 退出账户（断开连接但保留账户）
   */
  logoutAccount(accountId) {
    const account = this.accounts().find((a) => a.id === accountId);
    if (!account) {
      this.toastService.error("\u8D26\u6237\u672A\u627E\u5230");
      return;
    }
    if (confirm(`\u786E\u5B9A\u8981\u9000\u51FA\u8D26\u6237 ${account.phone} \u5417\uFF1F`)) {
      this.toastService.info("\u6B63\u5728\u9000\u51FA\u8D26\u6237...");
      this.ipcService.send("logout-account", accountId);
      this.ipcService.once("logout-account-result", (result) => {
        if (result.success) {
          this.toastService.success(`\u8D26\u6237 ${account.phone} \u5DF2\u9000\u51FA`);
        } else {
          this.toastService.error(`\u9000\u51FA\u5931\u8D25: ${result.error || "\u672A\u77E5\u9519\u8BEF"}`);
        }
      });
    }
  }
  /**
   * 編輯帳戶
   */
  editAccount(account) {
    this.toastService.info(`\u7DE8\u8F2F\u5E33\u6236: ${account.phone}`);
  }
  submitLoginCode() {
    const state = this.loginState();
    if (!state.accountId || !state.phoneCodeHash || !this.loginCode().trim()) {
      return;
    }
    this.loginState.set({
      accountId: state.accountId,
      phone: state.phone,
      requiresCode: false,
      // Close the code input dialog
      requires2FA: false,
      phoneCodeHash: state.phoneCodeHash,
      isSubmittingCode: true
      // Show loading state
    });
    this.toastService.info("\u6B63\u5728\u9A8C\u8BC1\u9A8C\u8BC1\u7801...");
    this.ipcService.send("login-account", {
      accountId: state.accountId,
      phoneCode: this.loginCode().trim(),
      phoneCodeHash: state.phoneCodeHash
    });
    this.loginCode.set("");
  }
  submitLogin2FA() {
    const state = this.loginState();
    if (!state.accountId || !this.login2FAPassword().trim()) {
      return;
    }
    this.ipcService.send("login-account", {
      accountId: state.accountId,
      twoFactorPassword: this.login2FAPassword().trim()
    });
    this.login2FAPassword.set("");
  }
  cancelLogin() {
    this.loginState.set({
      accountId: null,
      phone: "",
      requiresCode: false,
      requires2FA: false,
      phoneCodeHash: null,
      isSubmittingCode: false
    });
    this.loginCode.set("");
    this.login2FAPassword.set("");
  }
  resendVerificationCode() {
    const state = this.loginState();
    if (!state.accountId) {
      return;
    }
    this.loginState.set({
      accountId: state.accountId,
      phone: state.phone,
      requiresCode: false,
      requires2FA: false,
      phoneCodeHash: null,
      isSubmittingCode: false
    });
    this.loginCode.set("");
    this.toastService.info("\u6B63\u5728\u91CD\u65B0\u53D1\u9001\u9A8C\u8BC1\u7801\u5230\u60A8\u7684 Telegram \u5E94\u7528...", 5e3);
    this.ipcService.send("login-account", state.accountId);
  }
  checkAccountStatus(accountId) {
    this.ipcService.send("check-account-status", accountId);
  }
  // 導航到錯誤位置
  navigateToError(errorCode) {
    const nav = this.errorNavigationMap[errorCode];
    if (!nav) {
      console.log("[Frontend] No navigation defined for error:", errorCode);
      return;
    }
    this.changeView(nav.view);
    setTimeout(() => {
      if (nav.elementId) {
        const element = document.getElementById(nav.elementId);
        if (element) {
          element.scrollIntoView({ behavior: "smooth", block: "center" });
          element.classList.add("highlight-pulse");
          setTimeout(() => {
            element.classList.remove("highlight-pulse");
          }, 3e3);
        }
      }
      if (nav.action) {
        nav.action();
      }
    }, 300);
    this.toastService.info(`\u5DF2\u8DF3\u8F49\u5230\u76F8\u95DC\u8A2D\u7F6E\u5340\u57DF`, 2e3);
  }
  startMonitoring() {
    if (this.isStartingMonitoring()) {
      this.toastService.warning("\u6B63\u5728\u555F\u52D5\u76E3\u63A7\uFF0C\u8ACB\u7A0D\u5019...", 2e3);
      return;
    }
    const listeners = this.listenerAccounts();
    if (listeners.length === 0) {
      const allListeners = this.accounts().filter((a) => a.role === "Listener");
      if (allListeners.length > 0) {
        const offlineListeners = allListeners.filter((a) => a.status !== "Online");
        if (offlineListeners.length > 0) {
          this.toastService.error(`\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6709 ${allListeners.length} \u500B\u76E3\u807D\u8CEC\u6236\uFF0C\u4F46\u6C92\u6709\u5728\u7DDA\u7684\u8CEC\u6236\u3002

\u8ACB\u5148\u767B\u9304\u4EE5\u4E0B\u8CEC\u6236\u4F7F\u5176\u5728\u7DDA\uFF1A
` + offlineListeners.map((a) => `- ${a.phone} (${a.status})`).join("\n"), 8e3);
        } else {
          this.toastService.error("\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u76E3\u807D\u8CEC\u6236\u72C0\u614B\u7570\u5E38\uFF0C\u8ACB\u6AA2\u67E5\u8CEC\u6236\u72C0\u614B\u3002", 5e3);
        }
      } else {
        this.toastService.error('\u7121\u6CD5\u555F\u52D5\u76E3\u63A7\uFF1A\u6C92\u6709\u76E3\u807D\u8CEC\u6236\u3002\n\n\u8ACB\u5148\uFF1A\n1. \u5728"\u8CEC\u6236\u7BA1\u7406"\u4E2D\u6DFB\u52A0\u8CEC\u6236\n2. \u5C07\u8CEC\u6236\u89D2\u8272\u8A2D\u7F6E\u70BA"\u76E3\u807D"\n3. \u767B\u9304\u8CEC\u6236\u4F7F\u5176\u5728\u7DDA', 6e3);
      }
      return;
    }
    if (this.monitoredGroups().length === 0) {
      this.toastService.warning("\u6C92\u6709\u914D\u7F6E\u76E3\u63A7\u7FA4\u7D44\u3002\u8ACB\u5148\u6DFB\u52A0\u76E3\u63A7\u7FA4\u7D44\u3002", 4e3);
      return;
    }
    if (this.keywordSets().length === 0) {
      this.toastService.warning("\u6C92\u6709\u914D\u7F6E\u95DC\u9375\u8A5E\u96C6\u3002\u8ACB\u5148\u6DFB\u52A0\u95DC\u9375\u8A5E\u96C6\u3002", 4e3);
      return;
    }
    const recentlyOnline = listeners.filter((a) => {
      return a.status === "Online";
    });
    if (recentlyOnline.length === 0) {
      this.toastService.warning("\u76E3\u807D\u8CEC\u6236\u72C0\u614B\u4E0D\u7A69\u5B9A\uFF0C\u8ACB\u7B49\u5F85\u8CEC\u6236\u5B8C\u5168\u4E0A\u7DDA\u5F8C\u518D\u8A66\u3002", 4e3);
      return;
    }
    this.isStartingMonitoring.set(true);
    this.ipcService.send("start-monitoring");
    setTimeout(() => {
      this.isStartingMonitoring.set(false);
    }, 5e3);
  }
  stopMonitoring() {
    this.ipcService.send("stop-monitoring");
  }
  // === 一鍵啟動控制 ===
  // 🔧 P0 v2: 不在前端阻止，讓後端處理帳號連接
  oneClickStart() {
    if (this.oneClickStarting()) {
      this.toastService.warning("\u6B63\u5728\u555F\u52D5\u4E2D\uFF0C\u8ACB\u7A0D\u5019...", 2e3);
      return;
    }
    const totalAccounts = this.accounts().length;
    if (totalAccounts === 0) {
      this.toastService.error("\u274C \u6C92\u6709\u914D\u7F6E\u4EFB\u4F55\u5E33\u865F\uFF0C\u8ACB\u5148\u6DFB\u52A0\u5E33\u865F", 4e3);
      return;
    }
    this.oneClickStarting.set(true);
    this.oneClickProgress.set(0);
    this.oneClickMessage.set(`\u{1F680} \u958B\u59CB\u555F\u52D5 (${totalAccounts} \u500B\u5E33\u865F)...`);
    this.ipcService.send("one-click-start", { forceRefresh: true });
    this.toastService.info(`\u{1F680} \u958B\u59CB\u4E00\u9375\u555F\u52D5\uFF0C\u5F8C\u7AEF\u5C07\u81EA\u52D5\u9023\u63A5 ${totalAccounts} \u500B\u5E33\u865F`, 3e3);
  }
  oneClickStop() {
    if (confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u6240\u6709\u670D\u52D9\u55CE\uFF1F\u9019\u5C07\u505C\u6B62\u76E3\u63A7\u548C AI \u81EA\u52D5\u804A\u5929\u3002")) {
      this.ipcService.send("one-click-stop");
    }
  }
  loadSystemStatus() {
    this.ipcService.send("get-system-status");
  }
  clearLogs() {
    if (confirm("\u786E\u5B9A\u8981\u6E05\u9664\u6240\u6709\u65E5\u5FD7\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002")) {
      this.ipcService.send("clear-logs");
      this.logs.set([]);
      this.toastService.success("\u65E5\u5FD7\u5DF2\u6E05\u9664");
    }
  }
  // Queue management
  refreshQueueStatus(phone) {
    this.ipcService.send("get-queue-status", phone ? { phone } : {});
  }
  clearPendingQueue() {
    if (confirm("\u78BA\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u5F85\u767C\u9001\u6D88\u606F\u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u92B7\u3002")) {
      this.ipcService.send("clear-queue", { status: "pending" });
      this.toastService.success("\u5F85\u767C\u9001\u968A\u5217\u5DF2\u6E05\u7A7A");
    }
  }
  retryMessage(messageId) {
    this.ipcService.send("retry-message", { messageId });
    this.toastService.info("\u6B63\u5728\u91CD\u8A66\u767C\u9001...");
  }
  cancelMessage(messageId) {
    this.ipcService.send("cancel-message", { messageId });
    this.toastService.success("\u6D88\u606F\u5DF2\u53D6\u6D88");
    this.refreshQueueStatus();
  }
  clearQueue(phone, status) {
    if (confirm("\u786E\u5B9A\u8981\u6E05\u7A7A\u961F\u5217\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002")) {
      this.ipcService.send("clear-queue", { phone, status });
      this.toastService.info("\u6B63\u5728\u6E05\u7A7A\u961F\u5217...");
    }
  }
  pauseQueue(phone) {
    this.ipcService.send("pause-queue", { phone });
    this.toastService.info("\u6B63\u5728\u6682\u505C\u961F\u5217...");
  }
  resumeQueue(phone) {
    this.ipcService.send("resume-queue", { phone });
    this.toastService.info("\u6B63\u5728\u6062\u590D\u961F\u5217...");
  }
  deleteQueueMessage(phone, messageId) {
    if (confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u6761\u6D88\u606F\u5417\uFF1F")) {
      this.ipcService.send("delete-queue-message", { phone, messageId });
      this.toastService.info("\u6B63\u5728\u5220\u9664\u6D88\u606F...");
    }
  }
  updateQueueMessagePriority(phone, messageId, priority) {
    const validPriority = priority === "HIGH" || priority === "NORMAL" || priority === "LOW" ? priority : "NORMAL";
    this.ipcService.send("update-queue-message-priority", { phone, messageId, priority: validPriority });
  }
  getQueueMessages(phone, status, limit = 100) {
    this.ipcService.send("get-queue-messages", { phone, status, limit });
  }
  viewQueueDetails(phone) {
    this.selectedQueuePhone.set(phone);
    this.getQueueMessages(phone);
  }
  closeQueueDetails() {
    this.selectedQueuePhone.set(null);
    this.queueMessages.set([]);
  }
  // Analytics methods
  loadSendingStats(days = 7, phone) {
    this.ipcService.send("get-sending-stats", { days, phone });
  }
  loadQueueLengthHistory(days = 7) {
    this.ipcService.send("get-queue-length-history", { days });
  }
  loadAccountSendingComparison(days = 7) {
    this.ipcService.send("get-account-sending-comparison", { days });
  }
  loadCampaignPerformanceStats(days = 7) {
    this.ipcService.send("get-campaign-performance-stats", { days });
  }
  onDaysChange(days) {
    this.selectedDays.set(days);
    this.loadAllAnalytics(days);
  }
  loadAllAnalytics(days = 7) {
    this.loadSendingStats(days);
    this.loadQueueLengthHistory(days);
    this.loadAccountSendingComparison(days);
    this.loadCampaignPerformanceStats(days);
  }
  // Chart data functions for analytics page
  capturesChartData() {
    const leads = this.filteredAnalyticsLeads();
    const days = this.selectedDays();
    const today = /* @__PURE__ */ new Date();
    today.setHours(0, 0, 0, 0);
    const labels = [];
    const data = [];
    for (let i = days - 1; i >= 0; i--) {
      const date = new Date(today);
      date.setDate(today.getDate() - i);
      const dateStr = date.toLocaleDateString("zh-CN", { month: "short", day: "numeric" });
      labels.push(dateStr);
      const count = leads.filter((l) => {
        const leadDate = new Date(l.timestamp);
        leadDate.setHours(0, 0, 0, 0);
        return leadDate.getTime() === date.getTime();
      }).length;
      data.push(count);
    }
    return {
      labels,
      datasets: [{
        label: "\u6355\u83B7\u6F5C\u5728\u5BA2\u6237",
        data,
        borderColor: "rgb(59, 130, 246)",
        backgroundColor: "rgba(59, 130, 246, 0.1)",
        fill: true
      }]
    };
  }
  conversionsChartData() {
    const leads = this.filteredAnalyticsLeads();
    const days = this.selectedDays();
    const today = /* @__PURE__ */ new Date();
    today.setHours(0, 0, 0, 0);
    const labels = [];
    const contactedData = [];
    const repliedData = [];
    for (let i = days - 1; i >= 0; i--) {
      const date = new Date(today);
      date.setDate(today.getDate() - i);
      const dateStr = date.toLocaleDateString("zh-CN", { month: "short", day: "numeric" });
      labels.push(dateStr);
      const dayLeads = leads.filter((l) => {
        const leadDate = new Date(l.timestamp);
        leadDate.setHours(0, 0, 0, 0);
        return leadDate.getTime() === date.getTime();
      });
      contactedData.push(dayLeads.filter((l) => l.status !== "New").length);
      repliedData.push(dayLeads.filter((l) => ["Replied", "Follow-up", "Closed-Won", "Closed-Lost"].includes(l.status)).length);
    }
    return {
      labels,
      datasets: [{
        label: "\u5DF2\u8054\u7CFB",
        data: contactedData,
        borderColor: "rgb(34, 197, 94)",
        backgroundColor: "rgba(34, 197, 94, 0.1)",
        fill: true
      }, {
        label: "\u5DF2\u56DE\u590D",
        data: repliedData,
        borderColor: "rgb(168, 85, 247)",
        backgroundColor: "rgba(168, 85, 247, 0.1)",
        fill: true
      }]
    };
  }
  messagesChartData() {
    return this.sendingStatsData();
  }
  funnelChartData() {
    const funnel = this.funnelStats();
    if (!funnel || !funnel.stages || Object.keys(funnel.stages).length === 0) {
      return null;
    }
    const stages = this.funnelStages;
    const labels = stages.map((s) => s.name);
    const data = stages.map((s) => {
      const stageData = funnel.stages[s.key];
      return stageData ? stageData.count : 0;
    });
    return {
      labels,
      datasets: [{
        label: "\u6F0F\u6597\u6570\u636E",
        data,
        backgroundColor: [
          "rgba(59, 130, 246, 0.8)",
          "rgba(34, 197, 94, 0.8)",
          "rgba(168, 85, 247, 0.8)",
          "rgba(239, 68, 68, 0.8)",
          "rgba(245, 158, 11, 0.8)",
          "rgba(236, 72, 153, 0.8)",
          "rgba(16, 185, 129, 0.8)",
          "rgba(239, 68, 68, 0.8)"
        ],
        borderColor: [
          "rgb(59, 130, 246)",
          "rgb(34, 197, 94)",
          "rgb(168, 85, 247)",
          "rgb(239, 68, 68)",
          "rgb(245, 158, 11)",
          "rgb(236, 72, 153)",
          "rgb(16, 185, 129)",
          "rgb(239, 68, 68)"
        ],
        borderWidth: 1
      }]
    };
  }
  // Alert methods
  loadAlerts(unresolvedOnly = false, level) {
    this.ipcService.send("get-alerts", { limit: 50, unresolvedOnly, level });
  }
  acknowledgeAlert(alertId) {
    this.ipcService.send("acknowledge-alert", { alertId });
  }
  resolveAlert(alertId) {
    this.ipcService.send("resolve-alert", { alertId });
  }
  loadAlertHistory(days = 30) {
    this.ipcService.send("get-alert-history", { days });
  }
  loadAlertRules() {
    this.ipcService.send("get-alert-rules", {});
  }
  toggleAlertRule(ruleId) {
    this.ipcService.send("toggle-alert-rule", { ruleId });
  }
  editAlertRule(rule) {
    this.showAddAlertRuleDialog.set(true);
  }
  deleteAlertRule(ruleId) {
    if (confirm("\u786E\u5B9A\u8981\u5220\u9664\u6B64\u544A\u8B66\u89C4\u5219\u5417\uFF1F")) {
      this.ipcService.send("delete-alert-rule", { ruleId });
    }
  }
  async showNotification(title, body, options) {
    if ("Notification" in window) {
      if (Notification.permission === "granted") {
        new Notification(title, __spreadValues({
          body,
          icon: "/assets/icon.png",
          badge: "/assets/badge.png",
          tag: "tg-matrix-notification",
          requireInteraction: false
        }, options));
      } else if (Notification.permission !== "denied") {
        const permission = await Notification.requestPermission();
        if (permission === "granted") {
          this.showNotification(title, body, options);
        }
      }
    }
  }
  showBrowserNotification(alert) {
    if ("Notification" in window && Notification.permission === "granted") {
      new Notification(`\u544A\u8B66: ${alert.level.toUpperCase()}`, {
        body: alert.message,
        icon: "/assets/icon.ico",
        tag: `alert-${alert.id}`,
        requireInteraction: alert.level === "critical" || alert.level === "error"
      });
    }
  }
  async requestNotificationPermission() {
    if ("Notification" in window && Notification.permission === "default") {
      await Notification.requestPermission();
    }
  }
  formatDate(dateString) {
    return new Date(dateString).toLocaleString();
  }
  // 將後端數據映射為前端 Lead 格式（蛇形 -> 駝峰）
  mapLeadFromBackend(l) {
    let sourceType = "unknown";
    const notes = l.notes || "";
    const triggeredKeyword = l.triggered_keyword || l.triggeredKeyword || "";
    if (notes.includes("\u89F8\u767C\u8A5E") || triggeredKeyword) {
      sourceType = "keyword_trigger";
    } else if (l.extracted_by_phone || l.source_chat_id) {
      sourceType = "group_extract";
    } else if (notes.includes("\u5C0E\u5165") || notes.includes("import")) {
      sourceType = "import";
    }
    return {
      id: l.id,
      userId: l.user_id || l.userId || "",
      username: l.username || "",
      firstName: l.first_name || l.firstName || "",
      lastName: l.last_name || l.lastName || "",
      sourceGroup: l.source_chat_title || l.sourceGroup || l.source_group || "",
      triggeredKeyword: notes || triggeredKeyword || "",
      timestamp: new Date(l.created_at || l.timestamp || l.extracted_at || Date.now()),
      status: l.status || l.response_status || "New",
      onlineStatus: l.online_status || l.onlineStatus || "hidden",
      assignedTemplateId: l.assignedTemplateId || l.assigned_template_id,
      interactionHistory: l.interactionHistory || l.interaction_history || [],
      doNotContact: !!l.doNotContact || !!l.do_not_contact,
      campaignId: l.campaignId || l.campaign_id,
      intentScore: l.intent_score || l.intentScore || 0,
      intentLevel: l.intent_level || l.intentLevel || "none",
      sourceType: l.source_type || l.sourceType || sourceType
    };
  }
  // 🆕 同步 leads 到資源中心
  syncLeadsToResourceCenter(leads) {
    const mappedLeads = (leads || []).map((l) => this.mapLeadFromBackend(l));
    this.contactsService.importLeadsDirectly(mappedLeads);
    console.log("[Frontend] Synced", mappedLeads.length, "leads to resource center");
  }
  // 🆕 延遲加載剩餘的 leads 數據（後台靜默加載）
  loadRemainingLeads() {
    console.log("[Frontend] loadRemainingLeads called, loading:", this.leadsLoading(), "hasMore:", this.leadsHasMore());
    if (this.leadsLoading()) {
      console.log("[Frontend] \u23F3 Already loading, skipping...");
      return;
    }
    const currentCount = this.leads().length;
    const total = this.leadsTotal();
    if (currentCount >= total && total > 0) {
      console.log("[Frontend] \u2705 All data already loaded:", currentCount, "/", total);
      return;
    }
    console.log("[Frontend] \u{1F4E5} Loading remaining leads:", currentCount, "/", total);
    this.leadsLoading.set(true);
    this.ipcService.send("get-leads-paginated", {
      page: 1,
      pageSize: 500,
      // 加載全部
      status: null,
      search: null
    });
  }
  // 安全的日期格式化，處理 Invalid Date
  safeFormatDate(date, format = "MM/dd HH:mm") {
    if (!date)
      return "-";
    try {
      const d = date instanceof Date ? date : new Date(date);
      if (isNaN(d.getTime()))
        return "-";
      const pad = (n) => n.toString().padStart(2, "0");
      const month = pad(d.getMonth() + 1);
      const day = pad(d.getDate());
      const hours = pad(d.getHours());
      const mins = pad(d.getMinutes());
      const year = d.getFullYear();
      if (format === "MM/dd HH:mm")
        return `${month}/${day} ${hours}:${mins}`;
      if (format === "yyyy-MM-dd HH:mm")
        return `${year}-${month}-${day} ${hours}:${mins}`;
      if (format === "HH:mm:ss")
        return `${hours}:${mins}:${pad(d.getSeconds())}`;
      return `${month}/${day} ${hours}:${mins}`;
    } catch {
      return "-";
    }
  }
  getQueueStatusForAccount(phone) {
    return this.queueStatuses()[phone] || null;
  }
  getTotalQueueStats() {
    const statuses = this.queueStatuses();
    let totalPending = 0;
    let totalProcessing = 0;
    let totalRetrying = 0;
    let totalFailed = 0;
    let totalCompleted = 0;
    let totalFailedCount = 0;
    Object.values(statuses).forEach((status) => {
      totalPending += status.pending;
      totalProcessing += status.processing;
      totalRetrying += status.retrying;
      totalFailed += status.failed;
      totalCompleted += status.stats.completed;
      totalFailedCount += status.stats.failed;
    });
    return {
      pending: totalPending,
      processing: totalProcessing,
      retrying: totalRetrying,
      failed: totalFailed,
      completed: totalCompleted,
      failedCount: totalFailedCount,
      totalAccounts: Object.keys(statuses).length
    };
  }
  // Log filtering
  applyLogFilter() {
    this.ipcService.send("get-logs", {
      limit: 1e3,
      type: this.logFilterType() || void 0,
      startDate: this.logFilterStartDate() || void 0,
      endDate: this.logFilterEndDate() || void 0,
      search: this.logFilterSearch() || void 0
    });
  }
  resetLogFilter() {
    this.logFilterType.set("");
    this.logFilterStartDate.set("");
    this.logFilterEndDate.set("");
    this.logFilterSearch.set("");
    this.ipcService.send("get-logs", { limit: 100 });
  }
  exportLogs() {
    this.ipcService.send("export-logs", {
      type: this.logFilterType() || void 0,
      startDate: this.logFilterStartDate() || void 0,
      endDate: this.logFilterEndDate() || void 0,
      search: this.logFilterSearch() || void 0
    });
  }
  // File operations are now handled by AccountLoaderService which uses IPC
  onExcelFileSelected() {
    this.accountLoaderService.loadAccountsFromExcel();
  }
  onDownloadTemplate() {
    this.accountLoaderService.downloadExcelTemplate();
  }
  reloadSessionsAndAccounts() {
    this.accountLoaderService.reloadSessionsAndAccounts();
  }
  // QR 掃碼登入 - 使用 DialogService 統一管理
  openQrLogin() {
    this.dialogService.openQrLogin();
  }
  closeQrLogin() {
    this.dialogService.closeQrLogin();
  }
  onQrLoginSuccess(data) {
    this.dialogService.closeQrLogin();
    this.toastService.success(`\u5E33\u865F ${data.phone || ""} \u5DF2\u6210\u529F\u6DFB\u52A0\uFF01`);
    this.reloadSessionsAndAccounts();
  }
  exportLeads() {
    if (!this.membershipService.hasFeature("dataExport")) {
      this.toastService.warning(`\u{1F947} \u6578\u64DA\u5C0E\u51FA\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    this.accountLoaderService.exportLeadsToExcel(this.leads());
  }
  // Session file management
  importSession() {
    this.ipcService.send("import-session");
  }
  exportSession(phoneNumber) {
    this.ipcService.send("export-session", phoneNumber);
  }
  cleanupSessionFiles() {
    if (confirm("\u786E\u5B9A\u8981\u6E05\u7406\u6240\u6709\u5B64\u7ACB\u7684 session \u6587\u4EF6\u5417\uFF1F\u8FD9\u5C06\u5220\u9664\u6240\u6709\u5E26\u65F6\u95F4\u6233\u7684 session \u6587\u4EF6\u548C\u4E0D\u5728\u6570\u636E\u5E93\u4E2D\u7684 session \u6587\u4EF6\u3002")) {
      this.ipcService.send("cleanup-session-files");
      this.toastService.info("\u6B63\u5728\u6E05\u7406\u5B64\u7ACB\u7684 session \u6587\u4EF6...");
    }
  }
  // === 孤立 Session 恢復 ===
  scanOrphanSessions() {
    this.toastService.info("\u6B63\u5728\u6383\u63CF\u5B64\u7ACB\u7684 Session \u6587\u4EF6...", 2e3);
    this.ipcService.send("scan-orphan-sessions", {});
  }
  recoverOrphanSessions() {
    const sessions = this.orphanSessions();
    if (sessions.length === 0) {
      this.toastService.warning("\u6C92\u6709\u9700\u8981\u6062\u5FA9\u7684 Session \u6587\u4EF6");
      return;
    }
    this.isRecoveringOrphanSessions.set(true);
    this.toastService.info(`\u6B63\u5728\u6062\u5FA9 ${sessions.length} \u500B\u5E33\u865F...`, 2e3);
    this.ipcService.send("recover-orphan-sessions", { sessions });
  }
  dismissOrphanSessionDialog() {
    this.showOrphanSessionDialog.set(false);
    this.orphanSessions.set([]);
  }
  toggleAllAccountSelection(event) {
    const isChecked = event.target.checked;
    const filteredIds = new Set(this.filteredAccounts().map((a) => a.id));
    this.accounts.update((accs) => accs.map((a) => filteredIds.has(a.id) ? __spreadProps(__spreadValues({}, a), { selected: isChecked }) : a));
  }
  bulkAssignRole(role) {
    const selectedIds = this.selectedAccounts().map((a) => a.id);
    if (selectedIds.length === 0) {
      this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u8D26\u6237");
      return;
    }
    this.progressDialog.set({
      show: true,
      title: "\u6B63\u5728\u6279\u91CF\u5206\u914D\u89D2\u8272...",
      progress: { current: 0, total: selectedIds.length },
      cancellable: false
    });
    this.simulateBulkOperationProgress(selectedIds.length, () => {
      this.ipcService.send("bulk-assign-role", { accountIds: selectedIds, role });
      this.toastService.success(`\u5DF2\u4E3A ${selectedIds.length} \u4E2A\u8D26\u6237\u5206\u914D\u89D2\u8272`);
    });
  }
  bulkAssignGroup(group) {
    const groupName = group || window.prompt(this.t("enterGroupName"));
    if (groupName) {
      const selectedIds = this.selectedAccounts().map((a) => a.id);
      if (selectedIds.length === 0) {
        this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u8D26\u6237");
        return;
      }
      this.progressDialog.set({
        show: true,
        title: "\u6B63\u5728\u6279\u91CF\u5206\u914D\u5206\u7EC4...",
        progress: { current: 0, total: selectedIds.length },
        cancellable: false
      });
      this.simulateBulkOperationProgress(selectedIds.length, () => {
        this.ipcService.send("bulk-assign-group", { accountIds: selectedIds, group: groupName });
        this.toastService.success(`\u5DF2\u4E3A ${selectedIds.length} \u4E2A\u8D26\u6237\u5206\u914D\u5206\u7EC4`);
      });
    }
  }
  bulkDelete() {
    const selectedIds = this.selectedAccounts().map((a) => a.id);
    if (selectedIds.length === 0) {
      this.toastService.warning("\u8BF7\u5148\u9009\u62E9\u8981\u5220\u9664\u7684\u8D26\u6237");
      return;
    }
    if (window.confirm(`\u786E\u5B9A\u8981\u5220\u9664 ${selectedIds.length} \u4E2A\u8D26\u6237\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002`)) {
      this.progressDialog.set({
        show: true,
        title: "\u6B63\u5728\u6279\u91CF\u5220\u9664\u8D26\u6237...",
        progress: { current: 0, total: selectedIds.length },
        cancellable: false
      });
      this.simulateBulkOperationProgress(selectedIds.length, () => {
        this.ipcService.send("bulk-delete-accounts", { accountIds: selectedIds });
        this.toastService.success(`\u5DF2\u5220\u9664 ${selectedIds.length} \u4E2A\u8D26\u6237`);
      });
    }
  }
  simulateBulkOperationProgress(total, onComplete) {
    let current = 0;
    const interval = setInterval(() => {
      current += Math.max(1, Math.floor(total / 20));
      if (current >= total) {
        current = total;
        clearInterval(interval);
        setTimeout(() => {
          this.progressDialog.set(__spreadProps(__spreadValues({}, this.progressDialog()), { show: false }));
          onComplete();
        }, 300);
      }
      this.progressDialog.set(__spreadProps(__spreadValues({}, this.progressDialog()), {
        progress: {
          current,
          total,
          message: `\u5904\u7406\u4E2D ${current}/${total}`
        }
      }));
    }, 50);
  }
  updateAccountRole(accountId, role) {
    this.ipcService.send("update-account-data", { id: accountId, updates: { role } });
  }
  // 顯示添加群組對話框
  showAddGroupDialog() {
    this.toastService.info("\u8ACB\u5728\u76E3\u63A7\u7FA4\u7D44\u5340\u584A\u4E2D\u9EDE\u64CA\u300C+ \u6DFB\u52A0\u7FA4\u7D44\u300D");
  }
  // 顯示添加關鍵詞集對話框
  showAddKeywordSetDialog() {
    const quotas = this.membershipService.quotas();
    if (quotas.maxKeywordSets !== -1 && this.keywordSets().length >= quotas.maxKeywordSets) {
      this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${quotas.maxKeywordSets} \u500B\u95DC\u9375\u8A5E\u96C6\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    this.newKeywordSet.set({ name: "" });
    this.showKeywordSetCreator.set(true);
  }
  submitNewKeywordSet() {
    const form = this.newKeywordSet();
    const name = form.name.trim();
    if (name) {
      console.log("[Frontend] Sending add-keyword-set command:", name);
      this.ipcService.send("add-keyword-set", { name });
      this.toastService.success("\u6B63\u5728\u5275\u5EFA\u95DC\u9375\u8A5E\u96C6...", 2e3);
      this.showKeywordSetCreator.set(false);
      this.newKeywordSet.set({ name: "" });
    } else {
      this.toastService.warning("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E\u96C6\u540D\u7A31", 3e3);
    }
  }
  cancelNewKeywordSet() {
    this.showKeywordSetCreator.set(false);
    this.newKeywordSet.set({ name: "" });
  }
  addKeywordSet() {
    const quotas = this.membershipService.quotas();
    if (quotas.maxKeywordSets !== -1 && this.keywordSets().length >= quotas.maxKeywordSets) {
      this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${quotas.maxKeywordSets} \u500B\u95DC\u9375\u8A5E\u96C6\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    const form = this.newKeywordSet();
    const name = form.name.trim();
    if (name) {
      if (!name) {
        this.toastService.warning("\u95DC\u9375\u8A5E\u96C6\u540D\u7A31\u4E0D\u80FD\u70BA\u7A7A", 3e3);
        return;
      }
      console.log("[Frontend] Sending add-keyword-set command:", name);
      this.ipcService.send("add-keyword-set", { name });
    } else {
      this.toastService.warning("\u8ACB\u8F38\u5165\u95DC\u9375\u8A5E\u96C6\u540D\u7A31", 3e3);
    }
  }
  // 處理群組配置保存（從自動化中心發送）
  handleSaveGroupConfig(event) {
    console.log("[Frontend] Saving group config:", event);
    const group = this.monitoredGroups().find((g) => g.id === event.groupId);
    if (group) {
      this.ipcService.send("add-group", {
        url: group.url,
        keywordSetIds: event.keywordSetIds
      });
      this.toastService.success("\u7FA4\u7D44\u914D\u7F6E\u5DF2\u4FDD\u5B58", 2e3);
    } else {
      console.error("[Frontend] Group not found for config save:", event.groupId);
      this.toastService.error("\u627E\u4E0D\u5230\u7FA4\u7D44\uFF0C\u7121\u6CD5\u4FDD\u5B58\u914D\u7F6E");
    }
  }
  // 處理關鍵詞集配置保存（從自動化中心發送）
  handleSaveKeywordSetConfig(event) {
    console.log("[Frontend] Saving keyword set config:", event);
    const currentSet = this.keywordSets().find((s) => s.id === event.setId);
    const currentKeywords = currentSet?.keywords?.map((k) => k.keyword) || [];
    const newKeywords = event.keywords.filter((k) => !currentKeywords.includes(k));
    for (const keyword of newKeywords) {
      console.log("[Frontend] Adding keyword:", keyword, "to set:", event.setId);
      this.ipcService.send("add-keyword", {
        setId: event.setId,
        keyword,
        isRegex: false
      });
    }
    if (newKeywords.length > 0) {
      this.toastService.success(`\u5DF2\u6DFB\u52A0 ${newKeywords.length} \u500B\u95DC\u9375\u8A5E`, 2e3);
    } else {
      this.toastService.info("\u6C92\u6709\u65B0\u95DC\u9375\u8A5E\u9700\u8981\u6DFB\u52A0", 2e3);
    }
  }
  // 處理從自動化中心發起的成員提取請求
  handleExtractMembersFromAutomation(event) {
    console.log("[Frontend] Extract members from automation center:", event);
    try {
      let username = "";
      if (event.groupUrl) {
        username = event.groupUrl.replace("@", "").replace("https://t.me/", "").replace("http://t.me/", "").replace("t.me/", "").split("/")[0];
      }
      const monitoredGroup = this.monitoredGroups().find((g) => g.id === parseInt(event.groupId, 10) || g.url === event.groupUrl || g.url === `@${username}` || g.url === username);
      const discoveredResource = this.discoveredResources().find((r) => r.username === username || r.id === parseInt(event.groupId, 10));
      const resource = {
        id: discoveredResource?.id || parseInt(event.groupId, 10) || 0,
        title: event.groupName,
        username,
        telegram_id: discoveredResource?.telegram_id || monitoredGroup?.telegram_id || username || event.groupId,
        member_count: event.memberCount || monitoredGroup?.member_count || 0,
        resource_type: "group"
      };
      console.log("[Frontend] Opening member list dialog with resource:", resource);
      if (!resource.telegram_id && !resource.username) {
        this.toastService.error("\u7121\u6CD5\u7372\u53D6\u7FA4\u7D44\u4FE1\u606F\uFF0C\u8ACB\u5F9E\u8CC7\u6E90\u767C\u73FE\u9801\u9762\u63D0\u53D6\u6210\u54E1");
        return;
      }
      this.currentView.set("resources");
      setTimeout(() => {
        this.openMemberListDialog(resource);
      }, 100);
    } catch (error) {
      console.error("[Frontend] Error opening member list dialog:", error);
      this.toastService.error("\u6253\u958B\u6210\u54E1\u63D0\u53D6\u5C0D\u8A71\u6846\u5931\u6557");
    }
  }
  addKeyword() {
    const form = this.newKeyword();
    if (!form.setId) {
      this.toastService.warning(this.t("selectKeywordSetFirst"), 3e3);
      return;
    }
    if (!form.keyword.trim()) {
      this.toastService.warning(this.t("keywordEmpty"), 3e3);
      return;
    }
    if (form.isRegex) {
      try {
        new RegExp(form.keyword);
      } catch (e) {
        this.toastService.error(`${this.t("invalidRegex")}: ${e.message}`, 4e3);
        return;
      }
    }
    const trimmedKeyword = form.keyword.trim();
    const keywordSet = this.keywordSets().find((s) => s.id === form.setId);
    if (!keywordSet) {
      this.toastService.error("\u95DC\u9375\u8A5E\u96C6\u4E0D\u5B58\u5728", 3e3);
      return;
    }
    const exists = keywordSet.keywords.some((k) => k.keyword === trimmedKeyword && k.isRegex === form.isRegex);
    if (exists) {
      this.toastService.warning("\u8A72\u95DC\u9375\u8A5E\u5DF2\u5B58\u5728\u65BC\u6B64\u95DC\u9375\u8A5E\u96C6\u4E2D", 3e3);
      return;
    }
    const tempId = Date.now();
    const newKeyword = {
      id: tempId,
      keyword: trimmedKeyword,
      isRegex: form.isRegex
    };
    this.keywordSets.update((sets) => sets.map((set) => set.id === form.setId ? __spreadProps(__spreadValues({}, set), { keywords: [...set.keywords, newKeyword] }) : set));
    this.newKeyword.set({ setId: form.setId, keyword: "", isRegex: false });
    this.testKeywordText.set("");
    this.keywordTestResult.set(null);
    this.ipcService.send("add-keyword", { setId: form.setId, keyword: trimmedKeyword, isRegex: form.isRegex });
    this.toastService.success(this.t("keywordAdded"), 2e3);
  }
  onTestTextInput(event) {
    const input2 = event.target;
    const value = input2.value.trim();
    if (!value) {
      this.keywordTestResult.set(null);
    }
  }
  testKeyword() {
    const form = this.newKeyword();
    const testText = this.testKeywordText().trim();
    if (!form.keyword.trim()) {
      this.toastService.warning("\u8ACB\u5148\u8F38\u5165\u95DC\u9375\u8A5E", 2e3);
      this.keywordTestResult.set(null);
      return;
    }
    if (!testText) {
      this.keywordTestResult.set(null);
      return;
    }
    try {
      let matches = false;
      if (form.isRegex) {
        try {
          const regex = new RegExp(form.keyword, "i");
          matches = regex.test(testText);
        } catch (e) {
          this.keywordTestResult.set({ matches: false, error: e.message });
          this.toastService.error(`${this.t("invalidRegex")}: ${e.message}`, 4e3);
          return;
        }
      } else {
        matches = testText.toLowerCase().includes(form.keyword.toLowerCase());
      }
      this.keywordTestResult.set({ matches });
    } catch (e) {
      this.keywordTestResult.set({ matches: false, error: e.message });
      this.toastService.error(`\u6E2C\u8A66\u5931\u6557: ${e.message}`, 3e3);
    }
  }
  removeKeywordFromSet(setId, keywordId) {
    const keywordSet = this.keywordSets().find((s) => s.id === setId);
    const keywordToRemove = keywordSet?.keywords.find((k) => k.id === keywordId);
    if (keywordSet && keywordToRemove) {
      this.keywordSets.update((sets) => sets.map((set) => set.id === setId ? __spreadProps(__spreadValues({}, set), { keywords: set.keywords.filter((k) => k.id !== keywordId) }) : set));
      this.ipcService.send("remove-keyword", { setId, keywordId });
      this.toastService.success("\u95DC\u9375\u8A5E\u5DF2\u522A\u9664", 2e3);
    } else {
      this.toastService.warning("\u95DC\u9375\u8A5E\u4E0D\u5B58\u5728", 2e3);
    }
  }
  addGroup() {
    const quotas = this.membershipService.quotas();
    if (quotas.maxGroups !== -1 && this.monitoredGroups().length >= quotas.maxGroups) {
      this.toastService.warning(`${this.membershipService.levelIcon()} ${this.membershipService.levelName()} \u6700\u591A\u652F\u6301 ${quotas.maxGroups} \u500B\u7FA4\u7D44`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    const form = this.newGroup();
    if (form.url.trim()) {
      const exists = this.monitoredGroups().some((g) => g.url === form.url.trim());
      if (exists) {
        this.toastService.warning("\u8A72\u7FA4\u7D44\u5DF2\u5B58\u5728\uFF0C\u5C07\u66F4\u65B0\u95DC\u9375\u8A5E\u96C6\u914D\u7F6E", 3e3);
      }
      this.ipcService.send("add-group", { url: form.url.trim(), keywordSetIds: form.keywordSetIds });
      this.newGroup.set({ url: "", keywordSetIds: [] });
    }
  }
  // 讓監控號手動加入群組
  joinGroup(groupUrl) {
    console.log("[Frontend] joinGroup called with:", groupUrl);
    console.log("[Frontend] All accounts:", this.accounts());
    const allAccounts = this.accounts();
    let listenerAccounts = allAccounts.filter((a) => a.role === "Listener" && a.status === "Online");
    console.log("[Frontend] Listener accounts:", listenerAccounts);
    if (listenerAccounts.length === 0) {
      const onlineAccounts = allAccounts.filter((a) => a.status === "Online");
      console.log("[Frontend] Online accounts (any role):", onlineAccounts);
      if (onlineAccounts.length === 0) {
        this.toastService.error("\u6C92\u6709\u5728\u7DDA\u7684\u5E33\u865F\uFF0C\u7121\u6CD5\u52A0\u5165\u7FA4\u7D44", 3e3);
        return;
      }
      listenerAccounts = onlineAccounts;
      this.toastService.warning("\u6C92\u6709\u76E3\u63A7\u5E33\u865F\uFF0C\u4F7F\u7528\u5176\u4ED6\u5728\u7DDA\u5E33\u865F\u52A0\u5165", 3e3);
    }
    const phone = listenerAccounts[0].phone;
    console.log("[Frontend] Using phone to join:", phone);
    this.toastService.info(`\u6B63\u5728\u5617\u8A66\u8B93 ${phone} \u52A0\u5165\u7FA4\u7D44...`, 3e3);
    this.ipcService.send("join-group", { phone, groupUrl });
  }
  toggleArrayItem(array, item) {
    const newArray = [...array];
    const index = newArray.indexOf(item);
    if (index > -1) {
      newArray.splice(index, 1);
    } else {
      newArray.push(item);
    }
    return newArray;
  }
  toggleKeywordSetForNewGroup(setId) {
    this.newGroup.update((group) => {
      if (!group) {
        return { url: "", keywordSetIds: [setId] };
      }
      return __spreadProps(__spreadValues({}, group), { keywordSetIds: this.toggleArrayItem(group.keywordSetIds || [], setId) });
    });
  }
  toggleTriggerGroup(campaignId, groupId) {
    this.campaigns.update((campaigns) => campaigns.map((c) => c.id === campaignId ? __spreadProps(__spreadValues({}, c), { trigger: __spreadProps(__spreadValues({}, c.trigger), { sourceGroupIds: this.toggleArrayItem(c.trigger.sourceGroupIds, groupId) }) }) : c));
  }
  toggleTriggerKeywordSet(campaignId, setId) {
    this.campaigns.update((campaigns) => campaigns.map((c) => c.id === campaignId ? __spreadProps(__spreadValues({}, c), { trigger: __spreadProps(__spreadValues({}, c.trigger), { keywordSetIds: this.toggleArrayItem(c.trigger.keywordSetIds, setId) }) }) : c));
  }
  toggleNewCampaignSourceGroup(groupId) {
    this.newCampaign.update((c) => __spreadProps(__spreadValues({}, c), {
      trigger: __spreadProps(__spreadValues({}, c.trigger), {
        sourceGroupIds: this.toggleArrayItem(c.trigger.sourceGroupIds, groupId)
      })
    }));
  }
  toggleNewCampaignKeywordSet(setId) {
    this.newCampaign.update((c) => __spreadProps(__spreadValues({}, c), {
      trigger: __spreadProps(__spreadValues({}, c.trigger), {
        keywordSetIds: this.toggleArrayItem(c.trigger.keywordSetIds, setId)
      })
    }));
  }
  removeById(list, id, typeName) {
    console.log(`[Frontend] Removing ${typeName} with id: ${id}`);
    const currentList = list();
    const itemToRemove = currentList.find((item) => item.id === id);
    if (itemToRemove) {
      list.set(currentList.filter((item) => item.id !== id));
      console.log(`[Frontend] Optimistically removed ${typeName} ${id} from local list`);
      this.toastService.success(`${typeName === "keyword-set" ? "\u95DC\u9375\u8A5E\u96C6" : typeName} \u522A\u9664\u6210\u529F`, 2e3);
    } else {
      console.warn(`[Frontend] ${typeName} ${id} not found in local list`);
    }
    this.ipcService.send(`remove-${typeName.replace(" ", "-")}`, { id });
  }
  openLeadDetailModal(lead) {
    const template = this.messageTemplates().find((t) => t.id === lead.assignedTemplateId);
    this.generationState.set({
      status: "idle",
      lead,
      generatedMessage: "",
      error: null,
      customPrompt: template?.prompt || "",
      attachment: null,
      attachments: []
    });
    this.leadDetailView.set("sendMessage");
    this.messageMode.set("manual");
    this.editableMessage.set("");
    const senders = this.senderAccounts();
    if (senders.length > 0 && !this.selectedSenderId()) {
      this.selectedSenderId.set(senders[0].id);
    }
  }
  closeLeadDetailModal() {
    this.generationState.set({ status: "idle", lead: null, generatedMessage: "", error: null, customPrompt: "", attachment: null, attachments: [] });
    this.editableMessage.set("");
    this.messageMode.set("manual");
  }
  // 啟動 AI 聊天
  startAiChat(lead) {
    this.openLeadDetailModal(lead);
    this.messageMode.set("ai");
    this.toastService.info(`\u{1F916} \u5DF2\u958B\u555F AI \u804A\u5929\u6A21\u5F0F\uFF0C\u70BA @${lead.username || lead.userId} \u751F\u6210\u667A\u80FD\u56DE\u8986`);
  }
  // 邀請進群（整合多角色協作）
  inviteToGroup(lead) {
    const collabGroups = this.collabGroups();
    if (collabGroups.length === 0) {
      this.toastService.warning("\u26A0\uFE0F \u8ACB\u5148\u5728\u300C\u591A\u89D2\u8272\u5354\u4F5C\u300D\u4E2D\u5275\u5EFA\u5354\u4F5C\u7FA4\u7D44");
      this.currentView.set("multi-role");
      return;
    }
    this.selectedLeadForInvite.set(lead);
    this.showInviteGroupDialog.set(true);
    this.toastService.info(`\u{1F465} \u9078\u64C7\u8981\u9080\u8ACB @${lead.username || lead.userId} \u7684\u7FA4\u7D44`);
  }
  // 執行邀請進群
  executeInviteToGroup(groupId) {
    const lead = this.selectedLeadForInvite();
    if (!lead)
      return;
    this.ipcService.send("invite-lead-to-collab-group", {
      leadId: lead.id,
      userId: lead.userId,
      username: lead.username,
      groupId
    });
    this.showInviteGroupDialog.set(false);
    this.selectedLeadForInvite.set(null);
    this.toastService.success(`\u2713 \u5DF2\u767C\u9001\u9080\u8ACB\u8ACB\u6C42`);
  }
  // 添加到黑名單
  addToDnc(lead) {
    this.ipcService.send("add-to-dnc", { leadId: lead.id, userId: lead.userId });
    this.toastService.success(`\u{1F6AB} \u5DF2\u5C07 @${lead.username || lead.userId} \u52A0\u5165\u9ED1\u540D\u55AE`);
  }
  async generateMessage() {
    const aiCheck = this.membershipService.canUseAi();
    if (!aiCheck.allowed) {
      this.toastService.warning(aiCheck.message || "\u4ECA\u65E5 AI \u914D\u984D\u5DF2\u7528\u5B8C");
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    const state = this.generationState();
    if (!state.lead)
      return;
    this.generationState.update((s) => __spreadProps(__spreadValues({}, s), { status: "loading", error: null }));
    try {
      let prompt = state.customPrompt;
      if (this.spintaxEnabled()) {
        prompt = this.parseSpintax(prompt);
      }
      const apiType = this.aiApiType();
      let message = "";
      if (apiType === "local" || apiType === "custom") {
        message = await this.generateWithLocalAI(state.lead, prompt);
      } else if (apiType === "openai") {
        message = await this.generateWithOpenAI(state.lead, prompt);
      } else {
        message = await this.geminiService.generateOutreachMessage(state.lead, prompt);
      }
      this.membershipService.recordAiCall(1);
      this.generationState.update((s) => __spreadProps(__spreadValues({}, s), { status: "success", generatedMessage: message }));
      this.editableMessage.set(message);
    } catch (error) {
      this.generationState.update((s) => __spreadProps(__spreadValues({}, s), { status: "error", error: error.message }));
    }
  }
  // 使用本地 AI 生成消息
  async generateWithLocalAI(lead, customPrompt) {
    const endpoint = this.aiApiType() === "local" ? this.localAiEndpoint() : this.customApiEndpoint();
    const model = this.localAiModel() || "default";
    if (!endpoint) {
      throw new Error("\u672C\u5730 AI \u7AEF\u9EDE\u672A\u914D\u7F6E");
    }
    const systemPrompt = `\u4F60\u662F\u4E00\u500B\u53CB\u5584\u7684\u804A\u5929\u52A9\u624B\u3002\u751F\u6210\u7C21\u77ED\u81EA\u7136\u7684\u5C0D\u8A71\u6D88\u606F\u3002
\u898F\u5247\uFF1A
1. \u6D88\u606F\u5FC5\u9808\u7C21\u77ED\uFF0815-40\u5B57\u4EE5\u5167\uFF09
2. \u50CF\u670B\u53CB\u804A\u5929\u4E00\u6A23\u81EA\u7136\uFF0C\u4E0D\u8981\u592A\u6B63\u5F0F
3. \u4E0D\u8981\u4F7F\u7528"\u60A8\u597D"\u7B49\u904E\u65BC\u6B63\u5F0F\u7684\u958B\u982D
4. \u53EF\u4EE5\u7528"\u55E8"\u3001"\u54C8\u56C9"\u3001"hi"\u7B49\u8F15\u9B06\u554F\u5019
5. \u76F4\u63A5\u5207\u5165\u8A71\u984C\uFF0C\u4E0D\u8981\u56C9\u55E6
6. \u8A9E\u6C23\u8F15\u9B06\u53CB\u597D\uFF0C\u50CF\u662F\u5728\u5FAE\u4FE1\u804A\u5929`;
    const userPrompt = customPrompt || `\u7528\u6236 @${lead.username || "\u670B\u53CB"} \u5C0D\u300C${lead.triggerKeyword || "\u9019\u500B\u8A71\u984C"}\u300D\u611F\u8208\u8DA3\u3002
\u7528\u4E00\u53E5\u8A71\u6253\u500B\u62DB\u547C\uFF0C\u7C21\u77ED\u81EA\u7136\u5C31\u597D\u3002`;
    return new Promise((resolve, reject) => {
      const timeout = setTimeout(() => {
        reject(new Error("AI \u751F\u6210\u8D85\u6642\uFF0C\u8ACB\u6AA2\u67E5\u670D\u52D9\u9023\u63A5"));
      }, 6e4);
      this.ipcService.once("ai-response", (data) => {
        clearTimeout(timeout);
        console.log("[AI] Received ai-response:", data);
        if (data?.success && data?.response) {
          resolve(data.response);
        } else {
          reject(new Error(data?.error || "AI \u751F\u6210\u5931\u6557"));
        }
      });
      console.log("[AI] Sending generate-ai-response with endpoint:", endpoint);
      this.ipcService.send("generate-ai-response", {
        userId: lead.id || lead.username,
        message: userPrompt,
        systemPrompt,
        localAiEndpoint: endpoint,
        localAiModel: model
      });
    });
  }
  // 使用 OpenAI 生成消息
  async generateWithOpenAI(lead, customPrompt) {
    const apiKey = this.aiApiKey();
    if (!apiKey) {
      throw new Error("OpenAI API Key \u672A\u914D\u7F6E");
    }
    const systemPrompt = `\u4F60\u662F\u53CB\u5584\u7684\u804A\u5929\u52A9\u624B\u3002\u751F\u6210\u7C21\u77ED\u81EA\u7136\u7684\u5C0D\u8A71\uFF0815-40\u5B57\uFF09\uFF0C\u50CF\u670B\u53CB\u804A\u5929\uFF0C\u4E0D\u8981\u6B63\u5F0F\u3002`;
    const userPrompt = customPrompt || `\u7528\u6236 @${lead.username || "\u670B\u53CB"} \u5C0D\u300C${lead.triggerKeyword || "\u9019\u500B\u8A71\u984C"}\u300D\u611F\u8208\u8DA3\uFF0C\u7528\u4E00\u53E5\u8A71\u6253\u62DB\u547C\u3002`;
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${apiKey}`
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [
          { role: "system", content: systemPrompt },
          { role: "user", content: userPrompt }
        ],
        max_tokens: 500,
        temperature: 0.7
      })
    });
    if (!response.ok) {
      throw new Error(`OpenAI API \u932F\u8AA4: ${response.status}`);
    }
    const data = await response.json();
    return data.choices?.[0]?.message?.content || "\u751F\u6210\u5931\u6557";
  }
  updateCustomPrompt(value) {
    this.generationState.update((s) => __spreadProps(__spreadValues({}, s), { customPrompt: value }));
  }
  applyTemplate(event) {
    const select = event.target;
    const templateId = parseInt(select.value, 10);
    if (!templateId)
      return;
    const template = this.messageTemplates().find((t) => t.id === templateId);
    if (template) {
      let message = template.prompt;
      if (this.spintaxEnabled()) {
        message = this.parseSpintax(message);
      }
      this.editableMessage.set(message);
    }
  }
  isAiConfigured() {
    const apiType = this.aiApiType();
    if (apiType === "local") {
      return !!this.localAiEndpoint();
    }
    if (apiType === "custom") {
      return !!this.customApiEndpoint() && !!this.aiApiKey();
    }
    return this.geminiService.isConfigured() || !!this.aiApiKey();
  }
  canSendMessage() {
    const hasMessage = this.editableMessage().trim().length > 0;
    const state = this.generationState();
    const hasAttachment = state.attachment !== null || state.attachments.length > 0;
    const hasSender = this.selectedSenderId() !== null && this.senderAccounts().length > 0;
    return (hasMessage || hasAttachment) && hasSender;
  }
  sendMessageToLead() {
    const msgCheck = this.membershipService.canSendMessage();
    if (!msgCheck.allowed) {
      this.toastService.warning(msgCheck.message || "\u4ECA\u65E5\u6D88\u606F\u914D\u984D\u5DF2\u7528\u5B8C");
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    const state = this.generationState();
    const lead = state.lead;
    if (!lead)
      return;
    const message = this.editableMessage().trim();
    const hasAttachment = state.attachment !== null;
    if (!message && !hasAttachment) {
      this.toastService.error(this.t("messageRequired"), 3e3);
      return;
    }
    const senderId = this.selectedSenderId();
    if (!senderId) {
      this.toastService.error(this.t("selectSenderFirst"), 3e3);
      return;
    }
    const senderAccount = this.accounts().find((a) => a.id === senderId);
    if (!senderAccount) {
      this.toastService.error(this.t("senderAccountNotFound"), 3e3);
      return;
    }
    const attachments = state.attachments.length > 0 ? state.attachments : state.attachment ? [state.attachment] : [];
    if (attachments.length === 0) {
      this.ipcService.send("send-message", {
        leadId: lead.id,
        accountPhone: senderAccount.phone,
        userId: lead.userId,
        username: lead.username,
        sourceGroup: lead.sourceGroup,
        message,
        attachment: null
      });
    } else if (attachments.length === 1) {
      this.ipcService.send("send-message", {
        leadId: lead.id,
        accountPhone: senderAccount.phone,
        userId: lead.userId,
        username: lead.username,
        sourceGroup: lead.sourceGroup,
        message,
        attachment: attachments[0]
      });
    } else {
      attachments.forEach((attachment, index) => {
        this.ipcService.send("send-message", {
          leadId: lead.id,
          accountPhone: senderAccount.phone,
          userId: lead.userId,
          username: lead.username,
          sourceGroup: lead.sourceGroup,
          message: index === 0 ? message : "",
          // 只有第一個帶文字
          attachment
        });
      });
    }
    this.membershipService.recordMessageSent(1);
    this.toastService.success(this.t("messageQueued"), 2e3);
    this.closeLeadDetailModal();
  }
  // Keep old method for backward compatibility
  sendMessage() {
    this.sendMessageToLead();
  }
  // 舊方法：使用 HTML input 選擇文件（用於小文件，會轉成 base64）
  onFileAttached(event, type) {
    const input2 = event.target;
    if (!input2.files?.length)
      return;
    const file = input2.files[0];
    if (file.size > 10 * 1024 * 1024) {
      this.toastService.warning("\u5927\u6587\u4EF6\u5EFA\u8B70\u4F7F\u7528\u300C\u9078\u64C7\u6587\u4EF6\u300D\u6309\u9215\u4E0A\u50B3", 3e3);
    }
    const reader = new FileReader();
    reader.onload = () => {
      const attachment = {
        name: file.name,
        type,
        dataUrl: reader.result,
        fileSize: file.size
      };
      this.generationState.update((s) => __spreadProps(__spreadValues({}, s), { attachment }));
    };
    reader.readAsDataURL(file);
    input2.value = "";
  }
  // 新方法：使用 Electron 原生對話框選擇文件（支持大文件，直接傳路徑）
  // 支持多文件選擇
  async selectAttachment(type, multiple = false) {
    const result = await this.ipcService.selectFileForAttachment(type, multiple);
    if (!result.success) {
      if (!result.canceled) {
        this.toastService.error("\u9078\u64C7\u6587\u4EF6\u5931\u6557", 2e3);
      }
      return;
    }
    if (multiple && result.files) {
      const newAttachments = result.files.map((f) => ({
        name: f.fileName,
        type: f.fileType,
        filePath: f.filePath,
        fileSize: f.fileSize
      }));
      this.generationState.update((s) => __spreadProps(__spreadValues({}, s), {
        attachments: [...s.attachments, ...newAttachments],
        attachment: newAttachments[0]
        // 保持向後兼容
      }));
      const totalSize = newAttachments.reduce((sum, a) => sum + (a.fileSize || 0), 0);
      const sizeMB = (totalSize / (1024 * 1024)).toFixed(2);
      this.toastService.success(`\u5DF2\u9078\u64C7 ${newAttachments.length} \u500B\u6587\u4EF6 (\u5171 ${sizeMB} MB)`, 2e3);
    } else {
      const attachment = {
        name: result.fileName,
        type: result.fileType,
        filePath: result.filePath,
        fileSize: result.fileSize
      };
      this.generationState.update((s) => __spreadProps(__spreadValues({}, s), {
        attachment,
        attachments: [attachment]
        // 同時更新 attachments
      }));
      const sizeMB = (result.fileSize / (1024 * 1024)).toFixed(2);
      this.toastService.success(`\u5DF2\u9078\u64C7: ${result.fileName} (${sizeMB} MB)`, 2e3);
    }
  }
  // 添加更多附件（多文件模式）
  async addMoreAttachments(type) {
    const result = await this.ipcService.selectFileForAttachment(type, true);
    if (!result.success || !result.files) {
      if (!result.canceled) {
        this.toastService.error("\u9078\u64C7\u6587\u4EF6\u5931\u6557", 2e3);
      }
      return;
    }
    const newAttachments = result.files.map((f) => ({
      name: f.fileName,
      type: f.fileType,
      filePath: f.filePath,
      fileSize: f.fileSize
    }));
    this.generationState.update((s) => __spreadProps(__spreadValues({}, s), {
      attachments: [...s.attachments, ...newAttachments],
      attachment: s.attachment || newAttachments[0]
    }));
    this.toastService.success(`\u5DF2\u6DFB\u52A0 ${newAttachments.length} \u500B\u6587\u4EF6`, 2e3);
  }
  // 移除單個附件
  removeAttachmentByIndex(index) {
    this.generationState.update((s) => {
      const newAttachments = s.attachments.filter((_, i) => i !== index);
      return __spreadProps(__spreadValues({}, s), {
        attachments: newAttachments,
        attachment: newAttachments.length > 0 ? newAttachments[0] : null
      });
    });
  }
  // 清空所有附件
  clearAllAttachments() {
    this.generationState.update((s) => __spreadProps(__spreadValues({}, s), {
      attachments: [],
      attachment: null
    }));
  }
  // 獲取附件總大小（MB）
  getTotalAttachmentSize() {
    const attachments = this.generationState().attachments;
    const totalBytes = attachments.reduce((sum, a) => sum + (a.fileSize || 0), 0);
    return (totalBytes / 1024 / 1024).toFixed(2);
  }
  removeAttachment() {
    this.clearAllAttachments();
  }
  parseSpintax(text) {
    const spintaxRegex = /\{([^{}]+)\}/g;
    while (spintaxRegex.test(text)) {
      text = text.replace(spintaxRegex, (match, choices) => {
        const options = choices.split("|");
        return options[Math.floor(Math.random() * options.length)];
      });
    }
    return text;
  }
  addInteractionHistory(leadId, type, content, leadInstance) {
    const interaction = { id: Date.now(), timestamp: /* @__PURE__ */ new Date(), type, content };
    if (leadInstance && leadInstance.id === leadId) {
      leadInstance.interactionHistory.unshift(interaction);
      return;
    }
    this.leads.update((leads) => leads.map((l) => l.id === leadId ? __spreadProps(__spreadValues({}, l), { interactionHistory: [interaction, ...l.interactionHistory] }) : l));
  }
  updateLeadStatus(leadId, newStatus, addHistory = true) {
    this.ipcService.send("update-lead-status", { leadId, newStatus });
  }
  toggleLeadMenu(leadId) {
    if (this.openLeadMenuId() === leadId) {
      this.openLeadMenuId.set(null);
    } else {
      this.openLeadMenuId.set(leadId);
    }
  }
  closeLeadMenu() {
    this.openLeadMenuId.set(null);
  }
  addToDoNotContact(leadId) {
    const lead = this.leads().find((l) => l.id === leadId);
    if (lead) {
      this.ipcService.send("add-to-dnc", { userId: lead.userId });
      this.closeLeadDetailModal();
    }
  }
  // ==================== Batch Operations (批量操作) ====================
  toggleLeadSelection(leadId) {
    this.selectedLeadIds.update((ids) => {
      const newIds = new Set(ids);
      if (newIds.has(leadId)) {
        newIds.delete(leadId);
      } else {
        newIds.add(leadId);
      }
      return newIds;
    });
    this.isSelectAllLeads.set(this.selectedLeadIds().size === this.leads().length);
  }
  toggleSelectAllLeads() {
    if (this.isSelectAllLeads()) {
      this.selectedLeadIds.set(/* @__PURE__ */ new Set());
      this.isSelectAllLeads.set(false);
    } else {
      const currentLeads = this.leads();
      const allIds = new Set(currentLeads.map((l) => l.id));
      this.selectedLeadIds.set(allIds);
      this.isSelectAllLeads.set(true);
      if (allIds.size > 0) {
        this.toastService.success(`\u5DF2\u9078\u64C7 ${allIds.size} \u500B\u5BA2\u6236`);
      }
    }
  }
  clearLeadSelection() {
    this.selectedLeadIds.set(/* @__PURE__ */ new Set());
    this.isSelectAllLeads.set(false);
    this.showBatchOperationMenu.set(false);
  }
  isLeadSelected(leadId) {
    return this.selectedLeadIds().has(leadId);
  }
  // 全選當前篩選的 leads
  selectAllFilteredLeads() {
    const currentLeads = this.filteredLeads();
    const allIds = new Set(currentLeads.map((l) => l.id));
    this.selectedLeadIds.set(allIds);
    if (allIds.size > 0) {
      this.toastService.success(`\u5DF2\u9078\u64C7 ${allIds.size} \u500B\u5BA2\u6236`);
    }
  }
  // 確認刪除單個 lead
  confirmDeleteLead(lead) {
    this.deleteConfirmDialog.set({
      show: true,
      type: "single",
      lead
    });
  }
  // 確認批量刪除
  confirmBatchDeleteLeads() {
    const count = this.selectedLeadsCount();
    if (count === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u522A\u9664\u7684\u5BA2\u6236");
      return;
    }
    this.deleteConfirmDialog.set({
      show: true,
      type: "batch",
      count
    });
  }
  // 執行刪除
  executeDeleteLeads() {
    const dialog = this.deleteConfirmDialog();
    this.deleteConfirmDialog.set({ show: false, type: "single" });
    if (dialog.type === "single" && dialog.lead) {
      this.ipcService.send("delete-lead", { leadId: dialog.lead.id });
      this.leads.update((leads) => leads.filter((l) => l.id !== dialog.lead.id));
      this.toastService.success(`\u5DF2\u522A\u9664\u5BA2\u6236 @${dialog.lead.username || dialog.lead.userId}`);
    } else if (dialog.type === "batch") {
      const leadIds = Array.from(this.selectedLeadIds());
      if (leadIds.length === 0) {
        this.toastService.warning("\u6C92\u6709\u9078\u4E2D\u7684\u5BA2\u6236");
        return;
      }
      this.batchOperationInProgress.set(true);
      this.showBatchOperationMenu.set(false);
      this.ipcService.send("batch-delete-leads", { leadIds });
      this.leads.update((leads) => leads.filter((l) => !this.selectedLeadIds().has(l.id)));
      this.toastService.success(`\u6B63\u5728\u522A\u9664 ${leadIds.length} \u500B\u5BA2\u6236...`);
      this.clearLeadSelection();
    }
  }
  // 取消刪除
  cancelDeleteLeads() {
    this.deleteConfirmDialog.set({ show: false, type: "single" });
  }
  // 導出選中的 leads
  exportSelectedLeads() {
    const leadIds = Array.from(this.selectedLeadIds());
    if (leadIds.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u5C0E\u51FA\u7684\u5BA2\u6236");
      return;
    }
    const selectedLeads = this.leads().filter((l) => leadIds.includes(l.id));
    const headers = ["ID", "\u7528\u6236\u540D", "\u59D3\u540D", "\u72C0\u614B", "\u4F86\u6E90", "\u95DC\u9375\u8A5E", "\u6642\u9593"];
    const rows = selectedLeads.map((l) => [
      l.userId,
      l.username || "",
      `${l.firstName || ""} ${l.lastName || ""}`.trim(),
      l.status,
      l.sourceGroup,
      l.triggeredKeyword,
      new Date(l.timestamp).toLocaleString()
    ]);
    const csv = [headers.join(","), ...rows.map((r) => r.join(","))].join("\n");
    const blob = new Blob(["\uFEFF" + csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `leads_export_${(/* @__PURE__ */ new Date()).toISOString().slice(0, 10)}.csv`;
    a.click();
    URL.revokeObjectURL(url);
    this.toastService.success(`\u5DF2\u5C0E\u51FA ${selectedLeads.length} \u500B\u5BA2\u6236`);
  }
  // Batch update status
  batchUpdateLeadStatus(newStatus) {
    if (!this.membershipService.hasFeature("batchOperations")) {
      this.toastService.warning(`\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    const leadIds = Array.from(this.selectedLeadIds());
    if (leadIds.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");
      return;
    }
    this.batchOperationInProgress.set(true);
    this.showBatchOperationMenu.set(false);
    this.ipcService.send("batch-update-lead-status", {
      leadIds,
      newStatus
    });
  }
  // Batch add tag
  batchAddTag(tag) {
    if (!this.checkBatchOperationPermission())
      return;
    const leadIds = Array.from(this.selectedLeadIds());
    if (leadIds.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");
      return;
    }
    if (!tag || !tag.trim()) {
      this.toastService.warning("\u8ACB\u8F38\u5165\u6A19\u7C64\u540D\u7A31");
      return;
    }
    this.batchOperationInProgress.set(true);
    this.showBatchTagSelector.set(false);
    this.ipcService.send("batch-add-tag", {
      leadIds,
      tag: tag.trim()
    });
  }
  // Batch remove tag
  batchRemoveTag(tag) {
    if (!this.checkBatchOperationPermission())
      return;
    const leadIds = Array.from(this.selectedLeadIds());
    if (leadIds.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");
      return;
    }
    this.batchOperationInProgress.set(true);
    this.ipcService.send("batch-remove-tag", {
      leadIds,
      tag
    });
  }
  // Batch add to DNC
  batchAddToDnc() {
    if (!this.checkBatchOperationPermission())
      return;
    const leadIds = Array.from(this.selectedLeadIds());
    if (leadIds.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");
      return;
    }
    if (!confirm(`\u78BA\u5B9A\u8981\u5C07 ${leadIds.length} \u500B Lead \u6DFB\u52A0\u5230 DNC \u5217\u8868\u55CE\uFF1F`)) {
      return;
    }
    this.batchOperationInProgress.set(true);
    this.showBatchOperationMenu.set(false);
    this.ipcService.send("batch-add-to-dnc", { leadIds });
  }
  // Batch remove from DNC
  batchRemoveFromDnc() {
    if (!this.checkBatchOperationPermission())
      return;
    const leadIds = Array.from(this.selectedLeadIds());
    if (leadIds.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");
      return;
    }
    this.batchOperationInProgress.set(true);
    this.showBatchOperationMenu.set(false);
    this.ipcService.send("batch-remove-from-dnc", { leadIds });
  }
  // Batch update funnel stage
  batchUpdateFunnelStage(newStage) {
    if (!this.checkBatchOperationPermission())
      return;
    const leadIds = Array.from(this.selectedLeadIds());
    if (leadIds.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");
      return;
    }
    this.batchOperationInProgress.set(true);
    this.showBatchOperationMenu.set(false);
    this.ipcService.send("batch-update-funnel-stage", {
      leadIds,
      newStage
    });
  }
  // Batch delete leads - 使用統一的確認對話框
  batchDeleteLeads() {
    if (!this.checkBatchOperationPermission())
      return;
    const leadIds = Array.from(this.selectedLeadIds());
    if (leadIds.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7 Lead");
      return;
    }
    this.confirmBatchDeleteLeads();
  }
  // Undo batch operation
  undoBatchOperation(operationId) {
    if (!confirm("\u78BA\u5B9A\u8981\u64A4\u92B7\u6B64\u64CD\u4F5C\u55CE\uFF1F")) {
      return;
    }
    this.ipcService.send("undo-batch-operation", { operationId });
  }
  // Load batch operation history
  loadBatchOperationHistory() {
    this.ipcService.send("get-batch-operation-history", {
      limit: 50,
      offset: 0
    });
    this.showBatchOperationHistory.set(true);
  }
  // 打開批量操作菜單（帶權限檢查）
  openBatchOperationMenu() {
    if (!this.membershipService.hasFeature("batchOperations")) {
      this.toastService.warning(`\u{1F947} \u6279\u91CF\u64CD\u4F5C\u529F\u80FD\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u9EDE\u64CA\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      this.showLeadsActionMenu.set(false);
      return;
    }
    this.showBatchOperationMenu.set(!this.showBatchOperationMenu());
    this.loadAllTags();
    this.showLeadsActionMenu.set(false);
  }
  // Load all tags
  loadAllTags() {
    this.ipcService.send("get-all-tags", {});
  }
  // Create new tag
  createTag() {
    const name = this.newTagName().trim();
    if (!name) {
      this.toastService.warning("\u8ACB\u8F38\u5165\u6A19\u7C64\u540D\u7A31");
      return;
    }
    this.ipcService.send("create-tag", {
      name,
      color: this.newTagColor()
    });
    this.newTagName.set("");
    this.showAddTagDialog.set(false);
  }
  // Delete tag
  deleteTag(tagName) {
    if (!confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6A19\u7C64 "${tagName}" \u55CE\uFF1F\u6B64\u6A19\u7C64\u5C07\u5F9E\u6240\u6709 Lead \u4E2D\u79FB\u9664\u3002`)) {
      return;
    }
    this.ipcService.send("delete-tag", { name: tagName });
  }
  // Full-text search for leads
  onLeadSearchInput() {
    if (this.leadSearchTimeout) {
      clearTimeout(this.leadSearchTimeout);
    }
    const query = this.leadSearchQuery().trim();
    if (!query || query.length < 2) {
      this.leadSearchResults.set([]);
      return;
    }
    this.leadSearchTimeout = setTimeout(() => {
      this.searchLeads();
    }, 500);
  }
  searchLeads() {
    const query = this.leadSearchQuery().trim();
    if (!query || query.length < 2) {
      this.leadSearchResults.set([]);
      return;
    }
    this.isSearchingLeads.set(true);
    this.ipcService.send("search-leads", {
      query,
      limit: 100
    });
  }
  clearLeadSearch() {
    this.leadSearchQuery.set("");
    this.leadSearchResults.set([]);
    if (this.leadSearchTimeout) {
      clearTimeout(this.leadSearchTimeout);
      this.leadSearchTimeout = null;
    }
  }
  // Backup management functions
  createBackup() {
    this.isCreatingBackup.set(true);
    this.ipcService.send("create-backup", {
      name: `backup_${(/* @__PURE__ */ new Date()).toISOString().replace(/[:.]/g, "-")}`,
      description: "Manual backup"
    });
  }
  loadBackups() {
    this.ipcService.send("list-backups", {});
  }
  restoreBackup(backupId) {
    if (!confirm("\u786E\u5B9A\u8981\u6062\u590D\u6B64\u5907\u4EFD\u5417\uFF1F\u5F53\u524D\u6570\u636E\u5C06\u88AB\u8986\u76D6\uFF01")) {
      return;
    }
    this.isRestoringBackup.set(true);
    this.ipcService.send("restore-backup", {
      backupId
    });
  }
  deleteBackup(backupId) {
    if (!confirm("\u786E\u5B9A\u8981\u5220\u9664\u6B64\u5907\u4EFD\u5417\uFF1F\u6B64\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\uFF01")) {
      return;
    }
    this.ipcService.send("delete-backup", {
      backupId
    });
  }
  // Handle batch operation result
  handleBatchOperationResult(data) {
    this.batchOperationInProgress.set(false);
    if (data.success) {
      const successCount = data.successCount || 0;
      const failureCount = data.failureCount || 0;
      if (failureCount > 0) {
        this.toastService.warning(`\u6279\u91CF\u64CD\u4F5C\u5B8C\u6210: ${successCount} \u6210\u529F, ${failureCount} \u5931\u6557`);
      } else {
        this.toastService.success(`\u6279\u91CF\u64CD\u4F5C\u5B8C\u6210: ${successCount} \u9805\u5DF2\u8655\u7406`);
      }
      this.clearLeadSelection();
      this.ipcService.send("get-initial-state", {});
    } else {
      this.toastService.error(`\u6279\u91CF\u64CD\u4F5C\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
    }
  }
  // Handle batch operation progress
  handleBatchOperationProgress(data) {
    this.progressDialog.set({
      show: true,
      title: "\u6279\u91CF\u64CD\u4F5C\u9032\u884C\u4E2D...",
      progress: {
        current: data.current,
        total: data.total,
        message: data.message
      },
      cancellable: false
    });
    if (data.current >= data.total) {
      setTimeout(() => {
        this.progressDialog.update((p) => __spreadProps(__spreadValues({}, p), { show: false }));
      }, 500);
    }
  }
  // Handle batch undo result
  handleBatchUndoResult(data) {
    if (data.success) {
      this.toastService.success("\u64CD\u4F5C\u5DF2\u64A4\u92B7");
      this.ipcService.send("get-initial-state", {});
      this.loadBatchOperationHistory();
    } else {
      this.toastService.error(`\u64A4\u92B7\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
    }
  }
  // Handle batch operation history
  handleBatchOperationHistory(data) {
    if (data.success) {
      this.batchOperationHistory.set(data.operations || []);
    }
  }
  // Handle all tags response
  handleAllTags(data) {
    if (data.success) {
      this.allTags.set(data.tags || []);
    }
  }
  // Handle tag created
  handleTagCreated(data) {
    if (data.success) {
      this.toastService.success("\u6A19\u7C64\u5275\u5EFA\u6210\u529F");
      this.loadAllTags();
    } else {
      this.toastService.error(`\u5275\u5EFA\u6A19\u7C64\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
    }
  }
  // Handle tag deleted
  handleTagDeleted(data) {
    if (data.success) {
      this.toastService.success("\u6A19\u7C64\u5DF2\u522A\u9664");
      this.loadAllTags();
    } else {
      this.toastService.error(`\u522A\u9664\u6A19\u7C64\u5931\u6557: ${data.error || "\u672A\u77E5\u932F\u8AA4"}`);
    }
  }
  // Get operation type display name
  getOperationTypeName(type) {
    const names = {
      "update_status": "\u66F4\u65B0\u72C0\u614B",
      "add_tag": "\u6DFB\u52A0\u6A19\u7C64",
      "remove_tag": "\u79FB\u9664\u6A19\u7C64",
      "add_to_dnc": "\u6DFB\u52A0\u5230 DNC",
      "remove_from_dnc": "\u5F9E DNC \u79FB\u9664",
      "update_funnel_stage": "\u66F4\u65B0\u6F0F\u6597\u968E\u6BB5",
      "delete": "\u522A\u9664"
    };
    return names[type] || type;
  }
  // Format date for display
  formatBatchOperationDate(dateStr) {
    const date = new Date(dateStr);
    return date.toLocaleString("zh-TW", {
      month: "short",
      day: "numeric",
      hour: "2-digit",
      minute: "2-digit"
    });
  }
  // ==================== Ad System Methods (廣告發送系統) ====================
  loadAdTemplates() {
    this.ipcService.send("get-ad-templates", { activeOnly: false });
  }
  loadAdSchedules() {
    this.ipcService.send("get-ad-schedules", { activeOnly: false });
  }
  loadAdSendLogs() {
    this.ipcService.send("get-ad-send-logs", { limit: 100 });
  }
  loadAdOverviewStats() {
    this.ipcService.send("get-ad-overview-stats", { days: 7 });
  }
  loadAdSystemData() {
    this.loadAdTemplates();
    this.loadAdSchedules();
    this.loadAdOverviewStats();
  }
  createAdTemplate() {
    if (!this.membershipService.hasFeature("adBroadcast")) {
      this.toastService.warning(`\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    const form = this.newAdTemplate();
    if (!form.name.trim()) {
      this.toastService.warning("\u8ACB\u8F38\u5165\u6A21\u677F\u540D\u7A31");
      return;
    }
    if (!form.content.trim()) {
      this.toastService.warning("\u8ACB\u8F38\u5165\u6A21\u677F\u5167\u5BB9");
      return;
    }
    this.ipcService.send("create-ad-template", {
      name: form.name,
      content: form.content,
      mediaType: form.mediaType
    });
    this.newAdTemplate.set({ name: "", content: "", mediaType: "text" });
    this.showAdTemplateForm.set(false);
  }
  deleteAdTemplate(templateId) {
    if (!confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5EE3\u544A\u6A21\u677F\u55CE\uFF1F"))
      return;
    this.ipcService.send("delete-ad-template", { templateId });
  }
  toggleAdTemplateStatus(templateId) {
    this.ipcService.send("toggle-ad-template-status", { templateId });
  }
  previewSpintax(content) {
    if (!content.trim()) {
      this.spintaxPreview.set([]);
      return;
    }
    this.isPreviewingSpintax.set(true);
    this.ipcService.send("validate-spintax", { content });
  }
  createAdSchedule() {
    if (!this.membershipService.hasFeature("adBroadcast")) {
      this.toastService.warning(`\u{1F948} \u5EE3\u544A\u767C\u9001\u529F\u80FD\u9700\u8981 \u767D\u9280\u7CBE\u82F1 \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    const form = this.newAdSchedule();
    if (!form.name.trim()) {
      this.toastService.warning("\u8ACB\u8F38\u5165\u8A08\u5283\u540D\u7A31");
      return;
    }
    if (!form.templateId) {
      this.toastService.warning("\u8ACB\u9078\u64C7\u5EE3\u544A\u6A21\u677F");
      return;
    }
    if (form.targetGroups.length === 0) {
      this.toastService.warning("\u8ACB\u9078\u64C7\u76EE\u6A19\u7FA4\u7D44");
      return;
    }
    if (form.assignedAccounts.length === 0) {
      this.toastService.warning("\u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F");
      return;
    }
    this.ipcService.send("create-ad-schedule", form);
    this.newAdSchedule.set({
      name: "",
      templateId: 0,
      targetGroups: [],
      sendMode: "scheduled",
      scheduleType: "once",
      scheduleTime: "",
      intervalMinutes: 60,
      triggerKeywords: [],
      accountStrategy: "rotate",
      assignedAccounts: []
    });
    this.showAdScheduleForm.set(false);
  }
  deleteAdSchedule(scheduleId) {
    if (!confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u5EE3\u544A\u8A08\u5283\u55CE\uFF1F"))
      return;
    this.ipcService.send("delete-ad-schedule", { scheduleId });
  }
  toggleAdScheduleStatus(scheduleId) {
    this.ipcService.send("toggle-ad-schedule-status", { scheduleId });
  }
  runAdScheduleNow(scheduleId) {
    if (!confirm("\u78BA\u5B9A\u8981\u7ACB\u5373\u57F7\u884C\u6B64\u8A08\u5283\u55CE\uFF1F"))
      return;
    this.ipcService.send("run-ad-schedule-now", { scheduleId });
    this.toastService.info("\u6B63\u5728\u57F7\u884C...");
  }
  getSendModeLabel(mode) {
    const labels = {
      "scheduled": "\u5B9A\u6642\u767C\u9001",
      "triggered": "\u95DC\u9375\u8A5E\u89F8\u767C",
      "relay": "\u63A5\u529B\u767C\u9001",
      "interval": "\u9593\u9694\u5FAA\u74B0"
    };
    return labels[mode] || mode;
  }
  getScheduleTypeLabel(type) {
    const labels = {
      "once": "\u4E00\u6B21\u6027",
      "daily": "\u6BCF\u65E5",
      "interval": "\u9593\u9694",
      "cron": "Cron"
    };
    return labels[type] || type;
  }
  getAccountStrategyLabel(strategy) {
    const labels = {
      "single": "\u55AE\u4E00\u5E33\u865F",
      "rotate": "\u8F2A\u63DB\u5E33\u865F",
      "relay": "\u63A5\u529B\u767C\u9001",
      "random": "\u96A8\u6A5F\u9078\u64C7"
    };
    return labels[strategy] || strategy;
  }
  getAdStatusColor(status) {
    const colors = {
      "sent": "bg-green-500/20 text-green-400",
      "failed": "bg-red-500/20 text-red-400",
      "deleted": "bg-yellow-500/20 text-yellow-400",
      "banned": "bg-red-600/20 text-red-500"
    };
    return colors[status] || "bg-slate-500/20 text-slate-400";
  }
  toggleAccountForSchedule(phone) {
    this.newAdSchedule.update((s) => {
      const accounts = [...s.assignedAccounts];
      const idx = accounts.indexOf(phone);
      if (idx >= 0) {
        accounts.splice(idx, 1);
      } else {
        accounts.push(phone);
      }
      return __spreadProps(__spreadValues({}, s), { assignedAccounts: accounts });
    });
  }
  updateScheduleTargetGroups(value) {
    const groups = value.split("\n").map((g) => g.trim()).filter((g) => g.length > 0);
    this.newAdSchedule.update((s) => __spreadProps(__spreadValues({}, s), { targetGroups: groups }));
  }
  // Handle ad system events
  handleAdTemplates(data) {
    if (data.success) {
      this.adTemplates.set(data.templates || []);
    }
  }
  handleAdSchedules(data) {
    if (data.success) {
      this.adSchedules.set(data.schedules || []);
    }
  }
  handleAdSendLogs(data) {
    if (data.success) {
      this.adSendLogs.set(data.logs || []);
    }
  }
  handleAdOverviewStats(data) {
    if (data.success) {
      this.adOverviewStats.set(data.overview || null);
    }
  }
  handleAdTemplateCreated(data) {
    if (data.success) {
      this.toastService.success("\u5EE3\u544A\u6A21\u677F\u5DF2\u5275\u5EFA");
      this.loadAdTemplates();
    } else {
      this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${data.error}`);
    }
  }
  handleAdTemplateDeleted(data) {
    if (data.success) {
      this.toastService.success("\u5EE3\u544A\u6A21\u677F\u5DF2\u522A\u9664");
      this.loadAdTemplates();
    }
  }
  handleAdScheduleCreated(data) {
    if (data.success) {
      this.toastService.success("\u5EE3\u544A\u8A08\u5283\u5DF2\u5275\u5EFA");
      this.loadAdSchedules();
    } else {
      this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${data.error}`);
    }
  }
  handleAdScheduleDeleted(data) {
    if (data.success) {
      this.toastService.success("\u5EE3\u544A\u8A08\u5283\u5DF2\u522A\u9664");
      this.loadAdSchedules();
    }
  }
  handleSpintaxValidated(data) {
    this.isPreviewingSpintax.set(false);
    if (data.success || data.valid) {
      this.spintaxPreview.set(data.variants || []);
    } else {
      this.toastService.error(`Spintax \u8A9E\u6CD5\u932F\u8AA4: ${data.error}`);
      this.spintaxPreview.set([]);
    }
  }
  handleAdScheduleRunResult(data) {
    if (data.success) {
      this.toastService.success(`\u8A08\u5283\u57F7\u884C\u5B8C\u6210: ${data.sent || 0} \u6210\u529F, ${data.failed || 0} \u5931\u6557`);
      this.loadAdSendLogs();
      this.loadAdOverviewStats();
    } else {
      this.toastService.error(`\u57F7\u884C\u5931\u6557: ${data.error}`);
    }
  }
  // ==================== User Tracking Methods (用戶追蹤系統) ====================
  loadTrackedUsers() {
    this.ipcService.send("get-tracked-users", {
      limit: 100,
      valueLevel: this.userValueFilter() || void 0
    });
  }
  loadTrackingStats() {
    this.ipcService.send("get-tracking-stats", {});
  }
  loadHighValueGroups() {
    this.ipcService.send("get-high-value-groups", { limit: 50 });
  }
  loadUserTrackingData() {
    this.loadTrackedUsers();
    this.loadTrackingStats();
    this.loadHighValueGroups();
  }
  addUserToTrack() {
    const form = this.newTrackedUser();
    if (!form.userId.trim()) {
      this.toastService.warning("\u8ACB\u8F38\u5165\u7528\u6236 ID");
      return;
    }
    this.ipcService.send("add-user-to-track", {
      userId: form.userId.trim(),
      username: form.username.trim() || void 0,
      notes: form.notes.trim() || void 0,
      source: "manual"
    });
    this.newTrackedUser.set({ userId: "", username: "", notes: "" });
    this.showAddUserForm.set(false);
  }
  addLeadToTracking(leadId) {
    this.ipcService.send("add-user-from-lead", { leadId });
  }
  removeTrackedUser(userId) {
    if (!confirm("\u78BA\u5B9A\u8981\u79FB\u9664\u6B64\u7528\u6236\u8FFD\u8E64\u55CE\uFF1F"))
      return;
    this.ipcService.send("remove-tracked-user", { userId });
  }
  trackUserGroups(userId) {
    const onlineAccounts = this.accounts().filter((a) => a.status === "Online");
    if (onlineAccounts.length === 0) {
      this.toastService.warning("\u6C92\u6709\u5728\u7DDA\u5E33\u865F\u53EF\u7528\u65BC\u8FFD\u8E64");
      return;
    }
    this.isTrackingUser.set(true);
    this.ipcService.send("track-user-groups", {
      userId,
      accountPhone: onlineAccounts[0].phone
    });
  }
  viewUserGroups(user) {
    this.selectedTrackedUser.set(user);
    this.ipcService.send("get-user-groups", { userId: user.userId });
  }
  updateUserValueLevel(userId, valueLevel) {
    this.ipcService.send("update-user-value-level", { userId, valueLevel });
  }
  getValueLevelLabel(level) {
    const labels = {
      "vip": "VIP",
      "high": "\u9AD8\u50F9\u503C",
      "medium": "\u4E2D\u7B49",
      "low": "\u4F4E"
    };
    return labels[level] || level;
  }
  getValueLevelColor(level) {
    const colors = {
      "vip": "bg-purple-500/20 text-purple-400 border-purple-500/30",
      "high": "bg-orange-500/20 text-orange-400 border-orange-500/30",
      "medium": "bg-cyan-500/20 text-cyan-400 border-cyan-500/30",
      "low": "bg-slate-500/20 text-slate-400 border-slate-500/30"
    };
    return colors[level] || "bg-slate-500/20 text-slate-400";
  }
  getTrackingStatusLabel(status) {
    const labels = {
      "pending": "\u5F85\u8FFD\u8E64",
      "tracking": "\u8FFD\u8E64\u4E2D",
      "completed": "\u5DF2\u5B8C\u6210",
      "failed": "\u5931\u6557"
    };
    return labels[status] || status;
  }
  getTrackingStatusColor(status) {
    const colors = {
      "pending": "bg-yellow-500/20 text-yellow-400",
      "tracking": "bg-blue-500/20 text-blue-400",
      "completed": "bg-green-500/20 text-green-400",
      "failed": "bg-red-500/20 text-red-400"
    };
    return colors[status] || "bg-slate-500/20 text-slate-400";
  }
  // Handle user tracking events
  handleTrackedUsers(data) {
    if (data.success) {
      this.trackedUsers.set(data.users || []);
    }
  }
  handleUserGroups(data) {
    if (data.success) {
      this.userGroups.set(data.groups || []);
    }
  }
  handleHighValueGroups(data) {
    if (data.success) {
      this.highValueGroups.set(data.groups || []);
    }
  }
  handleTrackingStats(data) {
    if (data.success) {
      this.trackingStats.set(data.stats || null);
    }
  }
  handleUserAddedToTrack(data) {
    if (data.success) {
      this.toastService.success("\u7528\u6236\u5DF2\u6DFB\u52A0\u5230\u8FFD\u8E64\u5217\u8868");
      this.loadTrackedUsers();
    } else {
      this.toastService.error(`\u6DFB\u52A0\u5931\u6557: ${data.error}`);
    }
  }
  handleUserRemoved(data) {
    if (data.success) {
      this.toastService.success("\u7528\u6236\u5DF2\u79FB\u9664");
      this.loadTrackedUsers();
    }
  }
  handleUserTrackingCompleted(data) {
    this.isTrackingUser.set(false);
    if (data.success) {
      this.toastService.success(`\u8FFD\u8E64\u5B8C\u6210: \u767C\u73FE ${data.groupsFound} \u500B\u7FA4\u7D44, ${data.highValueGroups} \u500B\u9AD8\u50F9\u503C`);
      this.loadTrackedUsers();
      this.loadTrackingStats();
      this.loadHighValueGroups();
    }
  }
  handleUserTrackingFailed(data) {
    this.isTrackingUser.set(false);
    this.toastService.error(`\u8FFD\u8E64\u5931\u6557: ${data.error}`);
    this.loadTrackedUsers();
  }
  // ==================== Campaign Methods (營銷活動協調器) ====================
  loadCampaigns() {
    this.ipcService.send("get-campaigns", { limit: 50 });
  }
  loadUnifiedOverview() {
    this.ipcService.send("get-unified-overview", { days: 7 });
  }
  loadFunnelAnalysis() {
    this.ipcService.send("get-funnel-analysis", {});
  }
  loadCampaignData() {
    this.loadCampaigns();
    this.loadUnifiedOverview();
    this.loadFunnelAnalysis();
  }
  createCampaignFromForm() {
    if (!this.membershipService.hasFeature("aiSalesFunnel")) {
      this.toastService.warning(`\u{1F48E} \u71DF\u92B7\u6D3B\u52D5\u529F\u80FD\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1\uFF0C\u5347\u7D1A\u89E3\u9396\u66F4\u591A\u529F\u80FD`);
      window.dispatchEvent(new CustomEvent("open-membership-dialog"));
      return;
    }
    const form = this.campaignFormData();
    if (!form.name.trim()) {
      this.toastService.warning("\u8ACB\u8F38\u5165\u6D3B\u52D5\u540D\u7A31");
      return;
    }
    if (form.assignedAccounts.length === 0) {
      this.toastService.warning("\u8ACB\u9078\u64C7\u5E33\u865F");
      return;
    }
    this.ipcService.send("create-campaign", {
      name: form.name,
      description: form.description,
      phases: form.phases,
      keywords: form.keywords,
      targetGroups: form.targetGroups,
      assignedAccounts: form.assignedAccounts
    });
    this.campaignFormData.set({
      name: "",
      description: "",
      phases: ["discovery", "monitoring", "outreach"],
      keywords: [],
      targetGroups: [],
      assignedAccounts: []
    });
    this.showCampaignForm.set(false);
  }
  startCampaign(campaignId) {
    if (!confirm("\u78BA\u5B9A\u8981\u555F\u52D5\u6B64\u6D3B\u52D5\u55CE\uFF1F"))
      return;
    this.ipcService.send("start-campaign", { campaignId });
  }
  pauseCampaign(campaignId) {
    this.ipcService.send("pause-campaign", { campaignId });
  }
  resumeCampaign(campaignId) {
    this.ipcService.send("resume-campaign", { campaignId });
  }
  stopCampaign(campaignId) {
    if (!confirm("\u78BA\u5B9A\u8981\u505C\u6B62\u6B64\u6D3B\u52D5\u55CE\uFF1F"))
      return;
    this.ipcService.send("stop-campaign", { campaignId });
  }
  deleteCampaign(campaignId) {
    if (!confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u6D3B\u52D5\u55CE\uFF1F"))
      return;
    this.ipcService.send("delete-campaign", { campaignId });
  }
  viewCampaignDetails(campaign) {
    this.selectedCampaign.set(campaign);
    this.ipcService.send("get-campaign-logs", { campaignId: campaign.id });
  }
  getCampaignStatusLabel(status) {
    const labels = {
      "draft": "\u8349\u7A3F",
      "scheduled": "\u5DF2\u6392\u7A0B",
      "running": "\u904B\u884C\u4E2D",
      "paused": "\u5DF2\u66AB\u505C",
      "completed": "\u5DF2\u5B8C\u6210",
      "failed": "\u5931\u6557"
    };
    return labels[status] || status;
  }
  getCampaignStatusColor(status) {
    const colors = {
      "draft": "bg-slate-500/20 text-slate-400",
      "scheduled": "bg-blue-500/20 text-blue-400",
      "running": "bg-green-500/20 text-green-400",
      "paused": "bg-yellow-500/20 text-yellow-400",
      "completed": "bg-cyan-500/20 text-cyan-400",
      "failed": "bg-red-500/20 text-red-400"
    };
    return colors[status] || "bg-slate-500/20 text-slate-400";
  }
  getPhaseLabel(phase) {
    const labels = {
      "discovery": "\u8CC7\u6E90\u767C\u73FE",
      "monitoring": "\u76E3\u63A7\u7372\u5BA2",
      "outreach": "\u5EE3\u544A\u89F8\u9054",
      "tracking": "\u7528\u6236\u8FFD\u8E64",
      "conversion": "\u8F49\u5316\u6210\u4EA4"
    };
    return labels[phase] || phase;
  }
  toggleCampaignPhase(phase) {
    this.campaignFormData.update((c) => {
      const phases = [...c.phases];
      const idx = phases.indexOf(phase);
      if (idx >= 0) {
        phases.splice(idx, 1);
      } else {
        phases.push(phase);
      }
      return __spreadProps(__spreadValues({}, c), { phases });
    });
  }
  addCampaignKeyword() {
    const keyword = this.campaignKeywordInput().trim();
    if (!keyword)
      return;
    this.campaignFormData.update((c) => __spreadProps(__spreadValues({}, c), {
      keywords: [...c.keywords, keyword]
    }));
    this.campaignKeywordInput.set("");
  }
  removeCampaignKeyword(keyword) {
    this.campaignFormData.update((c) => __spreadProps(__spreadValues({}, c), {
      keywords: c.keywords.filter((k) => k !== keyword)
    }));
  }
  toggleCampaignAccount(phone) {
    this.campaignFormData.update((c) => {
      const accounts = [...c.assignedAccounts];
      const idx = accounts.indexOf(phone);
      if (idx >= 0) {
        accounts.splice(idx, 1);
      } else {
        accounts.push(phone);
      }
      return __spreadProps(__spreadValues({}, c), { assignedAccounts: accounts });
    });
  }
  // Handle campaign events
  handleCampaigns(data) {
    if (data.success) {
      this.campaigns.set(data.campaigns || []);
    }
  }
  handleCampaignCreated(data) {
    if (data.success) {
      this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u5275\u5EFA");
      this.loadCampaigns();
    } else {
      this.toastService.error(`\u5275\u5EFA\u5931\u6557: ${data.error}`);
    }
  }
  handleCampaignDeleted(data) {
    if (data.success) {
      this.toastService.success("\u71DF\u92B7\u6D3B\u52D5\u5DF2\u522A\u9664");
      this.loadCampaigns();
    }
  }
  handleUnifiedOverview(data) {
    if (data.success) {
      this.unifiedOverview.set(data);
    }
  }
  handleFunnelAnalysis(data) {
    if (data.success) {
      this.funnelAnalysis.set(data);
    }
  }
  // ==================== Multi-Role Methods (多角色協作) ====================
  loadRoleTemplates() {
    this.ipcService.send("get-role-templates", {});
  }
  loadAllRoles() {
    this.ipcService.send("get-all-roles", { activeOnly: true });
  }
  loadScriptTemplates() {
    this.ipcService.send("get-script-templates", { activeOnly: true });
  }
  loadCollabGroups() {
    this.ipcService.send("get-collab-groups", { limit: 50 });
  }
  loadCollabStats() {
    this.ipcService.send("get-collab-stats", {});
  }
  loadRoleStats() {
    this.ipcService.send("get-role-stats", {});
  }
  loadMultiRoleData() {
    this.loadRoleTemplates();
    this.loadAllRoles();
    this.loadScriptTemplates();
    this.loadCollabGroups();
    this.loadCollabStats();
    this.loadRoleStats();
  }
  assignRole() {
    const form = this.newRoleAssign();
    if (!form.accountPhone) {
      this.toastService.warning("\u8ACB\u9078\u64C7\u5E33\u865F");
      return;
    }
    if (!form.roleName.trim()) {
      this.toastService.warning("\u8ACB\u8F38\u5165\u89D2\u8272\u540D\u7A31");
      return;
    }
    this.ipcService.send("assign-role", {
      accountPhone: form.accountPhone,
      roleType: form.roleType,
      roleName: form.roleName
    });
    this.newRoleAssign.set({ accountPhone: "", roleType: "seller", roleName: "" });
    this.showRoleAssignForm.set(false);
  }
  removeRole(roleId) {
    if (!confirm("\u78BA\u5B9A\u8981\u79FB\u9664\u6B64\u89D2\u8272\u55CE\uFF1F"))
      return;
    this.ipcService.send("remove-role", { roleId });
  }
  getRoleIcon(roleType) {
    const icons = {
      "seller": "\u{1F9D1}\u200D\u{1F4BC}",
      "expert": "\u{1F468}\u200D\u{1F52C}",
      "satisfied": "\u{1F60A}",
      "hesitant": "\u{1F914}",
      "converted": "\u{1F389}",
      "curious": "\u2753",
      "manager": "\u{1F454}",
      "support": "\u{1F6E0}\uFE0F"
    };
    return icons[roleType] || "\u{1F464}";
  }
  getRoleLabel(roleType) {
    const labels = {
      "seller": "\u92B7\u552E\u9867\u554F",
      "expert": "\u5C08\u696D\u9867\u554F",
      "satisfied": "\u6EFF\u610F\u5BA2\u6236",
      "hesitant": "\u7336\u8C6B\u5BA2\u6236",
      "converted": "\u6210\u4EA4\u5BA2\u6236",
      "curious": "\u597D\u5947\u8005",
      "manager": "\u7D93\u7406\u4E3B\u7BA1",
      "support": "\u552E\u5F8C\u5BA2\u670D"
    };
    return labels[roleType] || roleType;
  }
  getScenarioLabel(scenario) {
    const labels = {
      "group_conversion": "\u7FA4\u804A\u8F49\u5316",
      "private_followup": "\u79C1\u804A\u8DDF\u9032",
      "objection_handling": "\u7570\u8B70\u8655\u7406",
      "product_intro": "\u7522\u54C1\u4ECB\u7D39",
      "trust_building": "\u5EFA\u7ACB\u4FE1\u4EFB",
      "urgency_creation": "\u88FD\u9020\u7DCA\u8FEB\u611F",
      "custom": "\u81EA\u5B9A\u7FA9"
    };
    return labels[scenario] || scenario;
  }
  getCollabStatusLabel(status) {
    const labels = {
      "warming": "\u9810\u71B1\u4E2D",
      "active": "\u6D3B\u8E8D\u4E2D",
      "completed": "\u5DF2\u5B8C\u6210",
      "archived": "\u5DF2\u6B78\u6A94"
    };
    return labels[status] || status;
  }
  getCollabStatusColor(status) {
    const colors = {
      "warming": "bg-yellow-500/20 text-yellow-400",
      "active": "bg-green-500/20 text-green-400",
      "completed": "bg-blue-500/20 text-blue-400",
      "archived": "bg-slate-500/20 text-slate-400"
    };
    return colors[status] || "bg-slate-500/20 text-slate-400";
  }
  // Handle multi-role events
  handleRoleTemplates(data) {
    if (data.success) {
      this.roleTemplates.set(data.templates || {});
    }
  }
  handleAllRoles(data) {
    if (data.success) {
      this.allRoles.set(data.roles || []);
    }
  }
  handleScriptTemplates(data) {
    if (data.success) {
      this.scriptTemplates.set(data.templates || []);
    }
  }
  handleCollabGroups(data) {
    if (data.success) {
      this.collabGroups.set(data.groups || []);
    }
  }
  handleCollabStats(data) {
    if (data.success) {
      this.collabStats.set(data);
    }
  }
  handleRoleStats(data) {
    if (data.success) {
      this.roleStats.set(data);
    }
  }
  // ==================== Form Update Helpers ====================
  updateAdTemplateName(value) {
    this.newAdTemplate.update((t) => __spreadProps(__spreadValues({}, t), { name: value }));
  }
  updateAdTemplateContent(value) {
    this.newAdTemplate.update((t) => __spreadProps(__spreadValues({}, t), { content: value }));
  }
  updateAdTemplateMediaType(value) {
    this.newAdTemplate.update((t) => __spreadProps(__spreadValues({}, t), { mediaType: value }));
  }
  updateAdScheduleName(value) {
    this.newAdSchedule.update((s) => __spreadProps(__spreadValues({}, s), { name: value }));
  }
  updateAdScheduleTemplateId(value) {
    this.newAdSchedule.update((s) => __spreadProps(__spreadValues({}, s), { templateId: value }));
  }
  updateAdScheduleSendMode(value) {
    this.newAdSchedule.update((s) => __spreadProps(__spreadValues({}, s), { sendMode: value }));
  }
  updateAdScheduleType(value) {
    this.newAdSchedule.update((s) => __spreadProps(__spreadValues({}, s), { scheduleType: value }));
  }
  updateAdScheduleTime(value) {
    this.newAdSchedule.update((s) => __spreadProps(__spreadValues({}, s), { scheduleTime: value }));
  }
  updateAdScheduleInterval(value) {
    this.newAdSchedule.update((s) => __spreadProps(__spreadValues({}, s), { intervalMinutes: value }));
  }
  updateAdScheduleStrategy(value) {
    this.newAdSchedule.update((s) => __spreadProps(__spreadValues({}, s), { accountStrategy: value }));
  }
  updateTrackedUserId(value) {
    this.newTrackedUser.update((u) => __spreadProps(__spreadValues({}, u), { userId: value }));
  }
  updateTrackedUserName(value) {
    this.newTrackedUser.update((u) => __spreadProps(__spreadValues({}, u), { username: value }));
  }
  updateTrackedUserNotes(value) {
    this.newTrackedUser.update((u) => __spreadProps(__spreadValues({}, u), { notes: value }));
  }
  updateCampaignFormName(value) {
    this.campaignFormData.update((c) => __spreadProps(__spreadValues({}, c), { name: value }));
  }
  updateCampaignFormDesc(value) {
    this.campaignFormData.update((c) => __spreadProps(__spreadValues({}, c), { description: value }));
  }
  updateRoleAssignPhone(value) {
    this.newRoleAssign.update((r) => __spreadProps(__spreadValues({}, r), { accountPhone: value }));
  }
  updateRoleAssignType(value) {
    this.newRoleAssign.update((r) => __spreadProps(__spreadValues({}, r), { roleType: value }));
  }
  updateRoleAssignName(value) {
    this.newRoleAssign.update((r) => __spreadProps(__spreadValues({}, r), { roleName: value }));
  }
  getRolesOfType(roleType) {
    return this.allRoles().filter((r) => r.roleType === roleType);
  }
  addTemplate() {
    const form = this.newTemplate();
    if (form.name.trim() && form.prompt.trim()) {
      this.ipcService.send("add-template", { name: form.name, prompt: form.prompt });
      this.newTemplate.set({ name: "", prompt: "" });
      this.toastService.success("\u6A21\u677F\u6DFB\u52A0\u6210\u529F");
    } else {
      this.toastService.error("\u8BF7\u586B\u5199\u6A21\u677F\u540D\u79F0\u548C\u6D88\u606F\u5185\u5BB9");
    }
  }
  addTemplateQuick(name, prompt) {
    if (name?.trim() && prompt?.trim()) {
      const exists = this.messageTemplates().some((t) => t.name === name.trim());
      if (exists) {
        this.toastService.warning("\u6A21\u677F\u540D\u7A31\u5DF2\u5B58\u5728\uFF0C\u7121\u6CD5\u5275\u5EFA\u91CD\u8907\u6A21\u677F", 3e3);
        return;
      }
      this.ipcService.send("add-template", { name: name.trim(), prompt: prompt.trim() });
      this.newTemplate.set({ name: "", prompt: "" });
      this.toastService.success("\u6A21\u677F\u6DFB\u52A0\u6210\u529F");
      if (this.messageTemplates().length > 0) {
        this.showTemplateCreator.set(false);
      }
    } else {
      this.toastService.error("\u8BF7\u586B\u5199\u6A21\u677F\u540D\u79F0\u548C\u6D88\u606F\u5185\u5BB9");
    }
  }
  updateTemplateName(value) {
    this.newTemplate.update((t) => __spreadProps(__spreadValues({}, t), { name: value }));
  }
  updateTemplatePrompt(value) {
    this.newTemplate.update((t) => __spreadProps(__spreadValues({}, t), { prompt: value }));
  }
  insertTemplateVariable(textarea, variable) {
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const text = textarea.value;
    const newText = text.substring(0, start) + variable + text.substring(end);
    textarea.value = newText;
    this.updateTemplatePrompt(newText);
    setTimeout(() => {
      textarea.focus();
      textarea.selectionStart = textarea.selectionEnd = start + variable.length;
    }, 0);
  }
  toggleTemplateStatus(templateId) {
    this.ipcService.send("toggle-template-status", { id: templateId });
  }
  removeTemplate(templateId) {
    const template = this.messageTemplates().find((t) => t.id === templateId);
    if (!template)
      return;
    const usingCampaigns = this.campaigns().filter((c) => c.actions.some((a) => a.templateId === templateId));
    if (usingCampaigns.length > 0) {
      const campaignNames = usingCampaigns.map((c) => c.name).join(", ");
      if (!confirm(`\u6A21\u677F "${template.name}" \u6B63\u5728\u88AB\u4EE5\u4E0B\u6D3B\u52D5\u4F7F\u7528\uFF1A${campaignNames}

\u522A\u9664\u6A21\u677F\u5F8C\uFF0C\u9019\u4E9B\u6D3B\u52D5\u5C07\u7121\u6CD5\u6B63\u5E38\u5DE5\u4F5C\u3002

\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F`)) {
        return;
      }
    } else {
      if (!confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6A21\u677F "${template.name}" \u55CE\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u92B7\u3002`)) {
        return;
      }
    }
    this.ipcService.send("remove-template", { id: templateId });
    this.toastService.success("\u6A21\u677F\u5DF2\u522A\u9664");
  }
  getTemplateName(id) {
    if (!id)
      return "N/A";
    return this.messageTemplates().find((t) => t.id === id)?.name || "Unknown Template";
  }
  getKeywordSetName(id) {
    return this.keywordSets().find((s) => s.id === id)?.name || "Unknown Set";
  }
  getGroupName(id) {
    return this.monitoredGroups().find((g) => g.id === id)?.name || "Unknown Group";
  }
  getCampaignName(id) {
    if (!id)
      return "N/A";
    return this.campaigns().find((c) => c.id === id)?.name || "Unknown Campaign";
  }
  getCampaignById(id) {
    if (id === void 0) {
      return void 0;
    }
    return this.campaigns().find((c) => c.id === id);
  }
  // --- Campaign Methods ---
  getEmptyCampaignForm() {
    return {
      name: "",
      trigger: { sourceGroupIds: [], keywordSetIds: [] },
      action: { templateId: 0, minDelaySeconds: 30, maxDelaySeconds: 120 }
    };
  }
  addCampaign() {
    if (this.isSubmittingCampaign()) {
      this.toastService.warning("\u6B63\u5728\u5275\u5EFA\u6D3B\u52D5\uFF0C\u8ACB\u7A0D\u5019...", 2e3);
      return;
    }
    const form = this.newCampaign();
    const errors = [];
    if (!form.name?.trim()) {
      errors.push("\u6D3B\u52A8\u540D\u79F0");
    }
    if (!form.action.templateId || form.action.templateId === 0) {
      errors.push("\u6D88\u606F\u6A21\u677F");
    }
    if (form.trigger.sourceGroupIds.length === 0) {
      errors.push("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u6765\u6E90\u7FA4\u7EC4");
    }
    if (form.trigger.keywordSetIds.length === 0) {
      errors.push("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5173\u952E\u8BCD\u96C6");
    }
    if (errors.length > 0) {
      this.toastService.error(`\u8BF7\u5B8C\u5584\u4EE5\u4E0B\u5185\u5BB9: ${errors.join(", ")}`);
      return;
    }
    const campaignName = form.name.trim();
    const existingCampaign = this.campaigns().find((c) => c.name === campaignName);
    if (existingCampaign) {
      this.toastService.warning(`\u6D3B\u52D5 "${campaignName}" \u5DF2\u5B58\u5728\uFF0C\u8ACB\u4F7F\u7528\u4E0D\u540C\u7684\u540D\u7A31`, 4e3);
      return;
    }
    this.isSubmittingCampaign.set(true);
    this.newCampaign.set(this.getEmptyCampaignForm());
    this.ipcService.send("add-campaign", __spreadValues({}, form));
    setTimeout(() => {
      this.isSubmittingCampaign.set(false);
    }, 3e3);
  }
  toggleCampaignStatus(id) {
    this.ipcService.send("toggle-campaign-status", { id });
  }
  getLogColor(type) {
    switch (type) {
      case "info":
        return "text-cyan-400";
      case "success":
        return "text-green-400";
      case "warning":
        return "text-yellow-400";
      case "error":
        return "text-red-400";
      default:
        return "text-slate-400";
    }
  }
  formatTimestamp(timestamp) {
    if (!timestamp)
      return "";
    try {
      const date = timestamp instanceof Date ? timestamp : new Date(timestamp);
      if (isNaN(date.getTime()))
        return "";
      return date.toLocaleDateString() + " " + date.toLocaleTimeString();
    } catch {
      return "";
    }
  }
  // ==================== Chat History Methods ====================
  async loadChatList() {
    try {
      const search = this.chatListSearch();
      const funnelStage = this.chatListFunnelFilter();
      this.ipcService.send("get-chat-list", {
        limit: 50,
        offset: 0,
        search: search || void 0,
        funnelStage: funnelStage || void 0
      });
    } catch (error) {
      console.error("[Frontend] Error loading chat list:", error);
    }
  }
  // 防抖版本的聊天列表搜索
  onChatListSearchChange(value) {
    this.chatListSearch.set(value);
    if (this.chatListSearchDebounceTimer) {
      clearTimeout(this.chatListSearchDebounceTimer);
    }
    this.chatListSearchDebounceTimer = setTimeout(() => {
      this.loadChatList();
      this.chatListSearchDebounceTimer = void 0;
    }, 300);
  }
  // 防抖版本的日誌過濾
  onLogFilterChange() {
    if (this.logFilterDebounceTimer) {
      clearTimeout(this.logFilterDebounceTimer);
    }
    this.logFilterDebounceTimer = setTimeout(() => {
      this.applyLogFilter();
      this.logFilterDebounceTimer = void 0;
    }, 500);
  }
  // 節流版本的隊列狀態刷新（最多每2秒刷新一次）
  refreshQueueStatusThrottled() {
    const now = Date.now();
    const timeSinceLastRefresh = now - this.lastQueueStatusRefresh;
    if (timeSinceLastRefresh >= 2e3) {
      this.lastQueueStatusRefresh = now;
      this.refreshQueueStatus();
    } else {
      if (this.queueStatusRefreshThrottleTimer) {
        clearTimeout(this.queueStatusRefreshThrottleTimer);
      }
      this.queueStatusRefreshThrottleTimer = setTimeout(() => {
        this.lastQueueStatusRefresh = Date.now();
        this.queueStatusRefreshThrottleTimer = void 0;
        this.refreshQueueStatus();
      }, 2e3 - timeSinceLastRefresh);
    }
  }
  // === Phase 1 優化：隊列進度組件支持方法 ===
  // 獲取帳號隊列狀態（轉換為組件需要的格式）
  getAccountQueueStatuses() {
    const statuses = this.queueStatuses();
    return Object.entries(statuses).map(([phone, status]) => {
      const account = this.accounts().find((a) => a.phone === phone);
      return {
        phone,
        displayName: phone,
        // 使用電話號碼作為顯示名稱
        status: status.processing > 0 ? "active" : status.pending > 0 ? "idle" : "idle",
        pending: status.pending,
        processing: status.processing,
        completed: status.stats.completed,
        failed: status.stats.failed,
        retrying: status.retrying,
        sendRate: status.processing > 0 ? 1.5 : 0,
        // 估算值
        avgResponseTime: 500,
        // 預設值
        dailyLimit: account?.dailySendLimit ?? 100,
        dailyUsed: account?.dailySendCount ?? 0,
        estimatedMinutes: status.pending > 0 ? Math.ceil(status.pending / 1.5) : 0,
        lastError: status.failed > 0 ? "\u90E8\u5206\u6D88\u606F\u767C\u9001\u5931\u6557" : void 0
      };
    });
  }
  // 暫停所有隊列
  pauseAllQueues() {
    this.ipcService.send("pause-all-queues", {});
    this.toastService.info("\u6B63\u5728\u66AB\u505C\u6240\u6709\u767C\u9001\u968A\u5217...", 2e3);
  }
  // 恢復所有隊列
  resumeAllQueues() {
    this.ipcService.send("resume-all-queues", {});
    this.toastService.info("\u6B63\u5728\u6062\u5FA9\u6240\u6709\u767C\u9001\u968A\u5217...", 2e3);
  }
  // 重試所有失敗項
  retryAllFailed() {
    this.ipcService.send("retry-all-failed", {});
    this.toastService.info("\u6B63\u5728\u91CD\u8A66\u6240\u6709\u5931\u6557\u7684\u6D88\u606F...", 2e3);
  }
  // === Phase 1 優化：配置診斷方法 ===
  // 運行配置診斷
  checkAutomationConfig() {
    this.toastService.info("\u6B63\u5728\u6AA2\u67E5\u914D\u7F6E...", 2e3);
    this.ipcService.send("check-automation-config", {
      accounts: this.accounts().map((a) => ({ phone: a.phone, role: a.role, status: a.status })),
      groups: this.monitoredGroups(),
      keywords: this.keywordSets(),
      campaigns: this.campaigns()
    });
  }
  // === Phase 1 優化：快速工作流支持方法 ===
  // 處理工作流導航
  handleWorkflowNavigation(event) {
    this.changeView(event.view);
    if (event.handler) {
      setTimeout(() => {
        switch (event.handler) {
          case "start-monitoring":
            this.startMonitoring();
            break;
          case "scan-sessions":
            this.scanOrphanSessions();
            break;
          case "new-campaign":
            break;
          case "export-leads":
            this.exportLeads();
            break;
          default:
            console.log("[Workflow] Unknown handler:", event.handler);
        }
      }, 300);
    }
  }
  // 工作流完成回調
  onWorkflowCompleted(workflow) {
    this.toastService.success(`\u{1F389} \u5DE5\u4F5C\u6D41\u300C${workflow.title}\u300D\u5DF2\u5B8C\u6210\uFF01`, 4e3);
    console.log("[Workflow] Completed:", workflow.id);
  }
  async loadChatHistory(userId, reset = true) {
    try {
      console.log("[Frontend] Loading chat history for user:", userId, "reset:", reset);
      if (reset) {
        this.isLoadingChatHistory.set(true);
        this.chatHistoryPage.set(0);
        this.chatHistoryAllMessages.set([]);
      } else {
        this.chatHistoryLoadingMore.set(true);
      }
      this.selectedChatUserId.set(userId);
      const page = this.chatHistoryPage();
      const pageSize = this.chatHistoryPageSize();
      const offset = page * pageSize;
      console.log("[Frontend] Sending get-chat-history-full:", { userId, limit: pageSize, offset });
      this.ipcService.send("get-chat-history-full", {
        userId,
        limit: pageSize,
        offset
      });
    } catch (error) {
      console.error("[Frontend] Error loading chat history:", error);
      this.isLoadingChatHistory.set(false);
      this.chatHistoryLoadingMore.set(false);
    }
  }
  async loadMoreChatHistory() {
    const userId = this.selectedChatUserId();
    if (!userId || this.chatHistoryLoadingMore() || !this.chatHistoryHasMore()) {
      return;
    }
    this.chatHistoryPage.update((page) => page + 1);
    await this.loadChatHistory(userId, false);
  }
  onChatHistoryScroll(event) {
    const element = event.target;
    if (!element)
      return;
    const scrollTop = element.scrollTop;
    const scrollHeight = element.scrollHeight;
    const clientHeight = element.clientHeight;
    const distanceFromBottom = scrollHeight - scrollTop - clientHeight;
    if (distanceFromBottom < 200 && this.chatHistoryHasMore() && !this.chatHistoryLoadingMore()) {
      this.loadMoreChatHistory();
    }
  }
  async sendAiResponse(userId, message) {
    try {
      const lead = this.generationState().lead;
      if (!lead)
        return;
      this.ipcService.send("send-ai-response", {
        userId,
        message,
        accountPhone: this.senderAccounts().find((a) => a.id === this.selectedSenderId())?.phone,
        sourceGroup: lead.sourceGroup,
        username: lead.username
      });
      setTimeout(() => {
        this.loadChatHistory(userId);
      }, 1e3);
    } catch (error) {
      console.error("[Frontend] Error sending AI response:", error);
    }
  }
  async checkMonitoringStatus() {
    try {
      this.ipcService.send("get-monitoring-status", {});
    } catch (error) {
      console.error("[Frontend] Error checking monitoring status:", error);
    }
  }
  async checkMonitoringHealth() {
    try {
      this.ipcService.send("check-monitoring-health", {});
    } catch (error) {
      console.error("[Frontend] Error checking monitoring health:", error);
    }
  }
  // TrackBy function for chat messages (fixes NG0955 error)
  trackByChatMessageId(index, message) {
    return message.id || index;
  }
  trackByChatId(index, chat) {
    return chat.userId || index;
  }
  trackByLogId(index, log) {
    let timeValue = 0;
    if (log.timestamp) {
      if (log.timestamp instanceof Date) {
        timeValue = log.timestamp.getTime();
      } else if (typeof log.timestamp === "number") {
        timeValue = log.timestamp;
      } else if (typeof log.timestamp === "string") {
        timeValue = new Date(log.timestamp).getTime() || 0;
      }
    }
    return `${log.id}-${timeValue}-${index}`;
  }
  // 檢查 alert.details 是否為有效的可顯示對象
  isValidAlertDetails(details) {
    if (!details)
      return false;
    if (typeof details !== "object")
      return false;
    if (details === null)
      return false;
    if (Array.isArray(details))
      return false;
    try {
      return Object.keys(details).length > 0;
    } catch {
      return false;
    }
  }
  // 安全地將對象轉換為 JSON 字符串
  safeStringify(obj) {
    try {
      return JSON.stringify(obj, null, 2);
    } catch {
      return "\u7121\u6CD5\u986F\u793A\u8A73\u60C5";
    }
  }
  getStatusColor(status) {
    switch (status) {
      case "Online":
        return "bg-green-500/10 text-green-400";
      case "Offline":
        return "bg-slate-500/10 text-slate-400";
      case "Banned":
        return "bg-red-500/10 text-red-400";
      case "Proxy Error":
        return "bg-orange-500/10 text-orange-400";
      case "Logging in...":
        return "bg-blue-500/10 text-blue-400 animate-pulse";
      case "Resting (Cooldown)":
        return "bg-yellow-500/10 text-yellow-400";
      case "Warming Up":
        return "bg-indigo-500/10 text-indigo-400 animate-pulse";
      case "New":
        return "bg-blue-500/10 text-blue-400";
      case "Contacted":
        return "bg-yellow-500/10 text-yellow-400";
      case "Replied":
        return "bg-green-500/10 text-green-400";
      case "Follow-up":
        return "bg-purple-500/10 text-purple-400";
      case "Closed-Won":
        return "bg-teal-500/10 text-teal-400";
      case "Closed-Lost":
        return "bg-red-500/10 text-red-400";
      default:
        return "bg-slate-700/20 text-slate-300";
    }
  }
  // 狀態頂部條顏色
  getStatusBarColor(status) {
    switch (status) {
      case "New":
        return "bg-amber-500";
      case "Contacted":
        return "bg-cyan-500";
      case "Replied":
        return "bg-purple-500";
      case "Follow-up":
        return "bg-orange-500";
      case "Closed-Won":
        return "bg-emerald-500";
      case "Closed-Lost":
        return "bg-red-500";
      default:
        return "bg-slate-500";
    }
  }
  getHealthColor(score) {
    if (score > 80)
      return "bg-green-500";
    if (score > 50)
      return "bg-yellow-500";
    return "bg-red-500";
  }
  getOnlineStatusColor(status) {
    switch (status) {
      case "Online":
        return "bg-green-500";
      case "Recently":
        return "bg-yellow-500";
      case "Offline":
        return "bg-slate-500";
      default:
        return "bg-slate-400";
    }
  }
  // 意向等級顏色
  getIntentLevelColor(level) {
    switch (level) {
      case "HOT":
        return "bg-red-500/20 text-red-400 border border-red-500/30";
      case "WARM":
        return "bg-orange-500/20 text-orange-400 border border-orange-500/30";
      case "NEUTRAL":
        return "bg-yellow-500/20 text-yellow-400 border border-yellow-500/30";
      case "COLD":
        return "bg-blue-500/20 text-blue-400 border border-blue-500/30";
      case "NONE":
        return "bg-slate-500/20 text-slate-400 border border-slate-500/30";
      default:
        return "bg-slate-500/20 text-slate-400 border border-slate-500/30";
    }
  }
  // 意向等級 Emoji
  getIntentLevelEmoji(level) {
    switch (level) {
      case "HOT":
        return "\u{1F525}";
      case "WARM":
        return "\u{1F321}\uFE0F";
      case "NEUTRAL":
        return "\u{1F610}";
      case "COLD":
        return "\u2744\uFE0F";
      case "NONE":
        return "\u26AA";
      default:
        return "\u26AA";
    }
  }
  // ==================== 成員資料庫事件處理 ====================
  /**
   * 處理從成員資料庫發送消息事件
   * 將 ExtractedMember 轉換為 CapturedLead 格式，並打開統一的發消息對話框
   */
  handleMemberSendMessage(member) {
    const lead = this.convertMemberToLead(member);
    this.openLeadDetailModal(lead);
    this.toastService.info(`\u{1F4AC} \u6E96\u5099\u767C\u9001\u6D88\u606F\u7D66 ${member.first_name || member.username || member.user_id}`);
  }
  /**
   * 處理從成員資料庫加入漏斗事件
   * 創建新的 Lead 並加入潛在客戶列表
   */
  handleMemberAddToFunnel(member) {
    const existingLead = this.leads().find((l) => l.userId === member.user_id);
    if (existingLead) {
      this.toastService.warning(`\u26A0\uFE0F ${member.first_name || member.username || member.user_id} \u5DF2\u5728\u92B7\u552E\u6F0F\u6597\u4E2D`);
      this.currentView.set("leads");
      setTimeout(() => this.openLeadDetailModal(existingLead), 100);
      return;
    }
    const newLead = this.convertMemberToLead(member);
    this.ipcService.send("add-lead", {
      user_id: member.user_id,
      username: member.username,
      first_name: member.first_name,
      last_name: member.last_name,
      source_chat_title: member.source_chat_title,
      source_chat_id: member.source_chat_id,
      notes: `\u5F9E\u6210\u54E1\u8CC7\u6599\u5EAB\u6DFB\u52A0 (${member.value_level}\u7D1A)`
    });
    this.leads.update((leads) => [newLead, ...leads]);
    this.toastService.success(`\u2705 \u5DF2\u5C07 ${member.first_name || member.username || member.user_id} \u52A0\u5165\u92B7\u552E\u6F0F\u6597`);
    this.currentView.set("leads");
  }
  /**
   * 處理從資源中心發送消息事件
   */
  handleResourceSendMessage(contact) {
    const lead = {
      id: 0,
      userId: contact.telegram_id,
      username: contact.username || "",
      firstName: contact.first_name,
      lastName: contact.last_name,
      sourceGroup: contact.source_name || "",
      triggeredKeyword: "",
      timestamp: new Date(contact.created_at),
      status: "New",
      onlineStatus: "Unknown",
      interactionHistory: [],
      doNotContact: false
    };
    this.openLeadDetailModal(lead);
    this.toastService.info(`\u{1F4AC} \u6E96\u5099\u767C\u9001\u6D88\u606F\u7D66 ${contact.display_name || contact.username || contact.telegram_id}`);
  }
  /**
   * 處理從資源中心查看詳情事件
   */
  handleResourceViewDetail(contact) {
    let leadStatus = "New";
    if (contact.status === "converted")
      leadStatus = "Closed-Won";
    else if (contact.status === "contacted")
      leadStatus = "Contacted";
    else if (contact.status === "interested")
      leadStatus = "Replied";
    const lead = {
      id: 0,
      userId: contact.telegram_id,
      username: contact.username || "",
      firstName: contact.first_name,
      lastName: contact.last_name,
      sourceGroup: contact.source_name || "",
      triggeredKeyword: "",
      timestamp: new Date(contact.created_at),
      status: leadStatus,
      onlineStatus: "Unknown",
      interactionHistory: [],
      doNotContact: false
    };
    this.openLeadDetailModal(lead);
  }
  /**
   * 處理從資源中心批量發送事件
   */
  handleResourceBatchSend(contacts) {
    if (contacts.length === 0)
      return;
    const targets = contacts.map((contact) => ({
      telegramId: contact.telegram_id,
      username: contact.username || "",
      firstName: contact.first_name,
      lastName: contact.last_name,
      displayName: contact.display_name || contact.first_name || contact.username || contact.telegram_id,
      // 來源信息
      groupName: contact.source_name || contact.source_chat_title || "",
      keyword: contact.triggered_keyword || "",
      source: contact.source_type || ""
    }));
    this.batchSendTargets.set(targets);
    this.showBatchMessageDialogState.set(true);
    this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${contacts.length} \u500B\u7528\u6236\u767C\u9001\u6279\u91CF\u6D88\u606F`);
  }
  /**
   * 處理批量發送完成
   */
  handleBatchSendComplete(result) {
    this.showBatchMessageDialogState.set(false);
    this.batchSendTargets.set([]);
    this.toastService.success(`\u2705 \u6279\u91CF\u767C\u9001\u5B8C\u6210\uFF1A\u6210\u529F ${result.success}\uFF0C\u5931\u6557 ${result.failed}`);
  }
  /**
   * 關閉批量發送對話框
   */
  closeBatchSendDialog() {
    this.showBatchMessageDialogState.set(false);
    this.batchSendTargets.set([]);
  }
  /**
   * 為選中的 Leads 打開批量發送對話框
   */
  openBatchSendForLeads() {
    const selectedLeads = this.leads().filter((l) => this.selectedLeadIds().has(l.id));
    if (selectedLeads.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u767C\u9001\u6D88\u606F\u7684\u5BA2\u6236");
      return;
    }
    const targets = selectedLeads.map((lead) => ({
      telegramId: lead.userId || String(lead.id),
      username: lead.username,
      firstName: lead.firstName,
      lastName: lead.lastName,
      displayName: lead.firstName || lead.username || "\u672A\u77E5",
      // 添加來源信息，用於變量替換
      groupName: lead.sourceGroup || "",
      keyword: lead.triggeredKeyword || "",
      source: lead.sourceType || ""
    }));
    this.batchSendTargets.set(targets);
    this.showBatchMessageDialogState.set(true);
    this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${selectedLeads.length} \u500B\u5BA2\u6236\u767C\u9001\u6279\u91CF\u6D88\u606F`);
  }
  /**
   * 為選中的 Leads 打開批量拉群對話框
   */
  openBatchInviteForLeads() {
    const selectedLeads = this.leads().filter((l) => this.selectedLeadIds().has(l.id));
    if (selectedLeads.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u8981\u62C9\u7FA4\u7684\u5BA2\u6236");
      return;
    }
    const targets = selectedLeads.map((lead) => ({
      telegramId: lead.userId || String(lead.id),
      username: lead.username,
      firstName: lead.firstName,
      displayName: lead.firstName || lead.username || "\u672A\u77E5"
    }));
    this.batchInviteTargets.set(targets);
    this.showBatchInviteDialogState.set(true);
    this.toastService.info(`\u{1F465} \u6E96\u5099\u5C07 ${selectedLeads.length} \u500B\u5BA2\u6236\u62C9\u5165\u7FA4\u7D44`);
  }
  /**
   * 關閉批量拉群對話框
   */
  closeBatchInviteDialog() {
    this.showBatchInviteDialogState.set(false);
    this.batchInviteTargets.set([]);
  }
  /**
   * 處理批量拉群完成
   */
  handleBatchInviteComplete(result) {
    this.showBatchInviteDialogState.set(false);
    this.batchInviteTargets.set([]);
    this.toastService.success(`\u2705 \u6279\u91CF\u62C9\u7FA4\u5B8C\u6210\uFF1A\u6210\u529F ${result.success}\uFF0C\u8DF3\u904E ${result.skipped}\uFF0C\u5931\u6557 ${result.failed}`);
  }
  // ==================== 成員提取配置對話框 ====================
  /**
   * 打開成員提取配置對話框
   * 由監控群組頁面調用
   */
  openMemberExtractionDialog(group) {
    const groupInfo = {
      id: String(group.id),
      name: group.name || group.title || "\u672A\u77E5\u7FA4\u7D44",
      url: group.url || "",
      telegramId: group.telegramId || group.telegram_id || "",
      // 🔧 添加 Telegram ID
      memberCount: group.memberCount || group.member_count || 0,
      accountPhone: group.accountPhone,
      resourceType: group.resourceType || group.resource_type || "group"
      // 🆕 資源類型
    };
    this.memberExtractionGroup.set(groupInfo);
    this.showMemberExtractionDialog.set(true);
  }
  /**
   * 關閉成員提取配置對話框
   */
  closeMemberExtractionDialog() {
    this.showMemberExtractionDialog.set(false);
    this.memberExtractionGroup.set(null);
  }
  /**
   * 🔧 P0: 統一關閉成員提取對話框（同時關閉 DialogService 和本地狀態）
   */
  closeMemberExtractionDialogUnified() {
    this.showMemberExtractionDialog.set(false);
    this.memberExtractionGroup.set(null);
    this.dialogService.closeMemberExtraction();
  }
  /**
   * 🆕 處理成員數刷新結果
   * 更新對話框和群組列表中的成員數
   */
  handleMemberCountRefreshed(event) {
    console.log("[Frontend] Member count refreshed:", event);
    const currentGroup = this.memberExtractionGroup();
    if (currentGroup && currentGroup.id === event.groupId) {
      this.memberExtractionGroup.set(__spreadProps(__spreadValues({}, currentGroup), {
        memberCount: event.memberCount
      }));
    }
    this.monitoredGroups.update((groups) => groups.map((g) => String(g.id) === event.groupId ? __spreadProps(__spreadValues({}, g), { memberCount: event.memberCount, member_count: event.memberCount }) : g));
  }
  /**
   * 處理成員提取開始
   * 從對話框接收配置並執行提取
   */
  handleMemberExtractionStart(event) {
    this.showMemberExtractionDialog.set(false);
    if (this.monitoringGroupsRef) {
      this.monitoringGroupsRef.executeExtraction({
        limit: event.config.limit,
        filters: event.config.filters,
        advanced: event.config.advanced
      });
    } else {
      const group = event.group;
      let chatId = "";
      if (group.url) {
        const match = group.url.match(/t\.me\/([+\w]+)/);
        if (match) {
          chatId = match[1];
        }
      }
      this.ipcService.send("extract-members", {
        chatId: chatId || group.url,
        username: chatId,
        telegramId: group.telegramId,
        // 🔧 添加 telegramId
        resourceId: group.id,
        groupName: group.name,
        // 🔧 P0 修復：傳遞已加入群組的帳號
        phone: event.config.accountPhone || group.accountPhone || null,
        limit: event.config.limit === -1 ? void 0 : event.config.limit,
        filters: {
          bots: !event.config.filters.excludeBots,
          // 🔧 修復：直接傳遞 onlineStatus 字符串，而不是布爾值
          onlineStatus: event.config.filters.onlineStatus,
          // 'all', 'online', 'recently', 'offline'
          offline: event.config.filters.onlineStatus === "offline",
          online: event.config.filters.onlineStatus === "online",
          chinese: event.config.filters.hasChinese,
          hasUsername: event.config.filters.hasUsername,
          isPremium: event.config.filters.isPremium,
          excludeAdmins: event.config.filters.excludeAdmins
        },
        autoSave: event.config.advanced.autoSaveToResources,
        skipDuplicates: event.config.advanced.skipDuplicates
      });
      this.toastService.info(`\u{1F504} \u6B63\u5728\u63D0\u53D6 ${group.name} \u7684\u6210\u54E1...`);
    }
  }
  /**
   * 處理監控群組配置動作
   */
  handleMonitoringConfigAction(action) {
    switch (action) {
      case "goto-resource-center":
        this.currentView.set("resource-center");
        break;
      case "goto-accounts":
        this.currentView.set("monitoring-accounts");
        break;
      case "goto-keywords":
        this.currentView.set("keyword-sets");
        break;
      case "goto-templates":
        this.currentView.set("chat-templates");
        break;
      case "goto-triggers":
        this.currentView.set("trigger-rules");
        break;
      default:
        console.log("[Frontend] Unknown config action:", action);
    }
  }
  /**
   * 處理從資源中心發送到 AI 銷售事件
   */
  handleResourceSendToAISales(contacts) {
    if (contacts.length === 0)
      return;
    this.ipcService.send("ai-team:add-targets", {
      targets: contacts.map((c) => ({
        telegramId: c.telegram_id,
        username: c.username,
        displayName: c.display_name,
        sourceType: c.source_type
      }))
    });
    this.currentView.set("ai-team");
    this.toastService.success(`\u{1F916} \u5DF2\u5C07 ${contacts.length} \u500B\u806F\u7E6B\u4EBA\u52A0\u5165 AI \u92B7\u552E\u968A\u5217`);
  }
  /**
   * 處理資源中心狀態變更事件
   * 同步狀態變更到發送控制台 (leads)
   */
  handleResourceStatusChanged(event) {
    if (!event.contacts.length)
      return;
    console.log("[Frontend] Syncing status change to leads:", event.contacts.length, "contacts, status:", event.status);
    const contactTelegramIds = new Set(event.contacts.map((c) => c.telegram_id));
    const statusMapping = {
      "new": "New",
      "contacted": "Contacted",
      "interested": "Interested",
      "negotiating": "Negotiating",
      "converted": "Closed-Won",
      "lost": "Closed-Lost",
      "blocked": "Unsubscribed"
    };
    const leadStatus = statusMapping[event.status] || event.status;
    this.leads.update((leads) => leads.map((lead) => {
      if (contactTelegramIds.has(String(lead.userId))) {
        return __spreadProps(__spreadValues({}, lead), { status: leadStatus });
      }
      return lead;
    }));
    this.ipcService.send("sync-resource-status-to-leads", {
      telegramIds: Array.from(contactTelegramIds),
      status: leadStatus
    });
    console.log("[Frontend] Status synced for", event.contacts.length, "contacts");
  }
  /**
   * 🆕 刷新 Leads 數據（資源中心請求刷新時調用）
   */
  refreshLeadsData() {
    console.log("[Frontend] Refreshing leads data for resource center...");
    const currentLeads = this.leads();
    if (currentLeads.length > 0) {
      this.syncLeadsToResourceCenter(currentLeads);
      console.log("[Frontend] Synced current leads to resource center:", currentLeads.length);
    }
    if (this.leadsHasMore() && !this.leadsLoading()) {
      this.loadRemainingLeads();
      this.toastService.info(`\u6B63\u5728\u52A0\u8F09\u66F4\u591A\u6578\u64DA... (\u7576\u524D ${currentLeads.length} / ${this.leadsTotal()} \u689D)`, 2e3);
    } else if (this.leadsLoading()) {
      this.toastService.info(`\u6B63\u5728\u52A0\u8F09\u4E2D... (\u7576\u524D ${currentLeads.length} / ${this.leadsTotal()} \u689D)`, 2e3);
    } else {
      this.toastService.success(`\u6578\u64DA\u5DF2\u540C\u6B65 (\u5171 ${currentLeads.length} \u689D)`);
    }
  }
  /**
   * 處理命令面板導航
   */
  handleCommandNavigation(target) {
    if (!target.startsWith("action:") && !target.startsWith("contact:")) {
      this.currentView.set(target);
      return;
    }
    if (target.startsWith("action:")) {
      const action = target.replace("action:", "");
      switch (action) {
        case "send-message":
          this.toastService.info("\u8ACB\u5148\u9078\u64C7\u806F\u7E6B\u4EBA");
          this.currentView.set("resource-center");
          break;
        case "extract-members":
          this.currentView.set("resource-center");
          break;
        case "search-groups":
          this.currentView.set("resource-center");
          break;
        case "start-monitor":
          this.startMonitoring();
          break;
        case "refresh":
          this.ipcService.send("get-initial-state");
          this.toastService.success("\u6578\u64DA\u5DF2\u5237\u65B0");
          break;
        case "open-docs":
          window.open("https://docs.tg-matrix.com", "_blank");
          break;
        case "show-shortcuts":
          this.toastService.info("\u2318K \u6253\u958B\u547D\u4EE4\u9762\u677F\n\u2318R \u5237\u65B0\u6578\u64DA\n\u2318N \u6DFB\u52A0\u5E33\u865F");
          break;
        case "open-feedback":
          this.toastService.info("\u8ACB\u767C\u9001\u90F5\u4EF6\u81F3 support@tg-matrix.com");
          break;
      }
      return;
    }
    if (target.startsWith("contact:")) {
      const contactId = target.replace("contact:", "");
      this.toastService.info(`\u6B63\u5728\u67E5\u770B\u806F\u7E6B\u4EBA ${contactId}`);
    }
  }
  /**
   * 處理批量發送消息事件
   */
  handleMemberBatchSendMessage(members) {
    if (members.length === 0) {
      this.toastService.warning("\u8ACB\u5148\u9078\u64C7\u6210\u54E1");
      return;
    }
    const validMembers = members.filter((m) => m.username);
    if (validMembers.length === 0) {
      this.toastService.warning("\u6240\u9078\u6210\u54E1\u90FD\u6C92\u6709\u7528\u6236\u540D\uFF0C\u7121\u6CD5\u767C\u9001\u6D88\u606F");
      return;
    }
    if (validMembers.length < members.length) {
      this.toastService.warning(`${members.length - validMembers.length} \u500B\u6210\u54E1\u6C92\u6709\u7528\u6236\u540D\uFF0C\u5C07\u88AB\u8DF3\u904E`);
    }
    this.batchMessageTargets = validMembers.map((m) => ({
      userId: m.user_id,
      username: m.username,
      firstName: m.first_name,
      lastName: m.last_name,
      displayName: `${m.first_name || ""} ${m.last_name || ""}`.trim() || m.username
    }));
    this.showBatchMessageDialog.set(true);
    this.toastService.info(`\u{1F4E8} \u6E96\u5099\u5411 ${validMembers.length} \u500B\u6210\u54E1\u767C\u9001\u6D88\u606F`);
  }
  /**
   * 處理導航請求
   */
  handleNavigate(viewName) {
    console.log("[Frontend] Navigate to:", viewName);
    this.currentView.set(viewName);
  }
  /**
   * 處理 AI 策略啟動
   */
  handleAIStrategyStart(strategy) {
    console.log("[Frontend] AI Strategy started:", strategy);
    this.ipcService.send("execute-ai-strategy", { strategy });
    this.currentView.set("automation");
    this.toastService.success(`\u{1F680} AI \u7B56\u7565\u5DF2\u555F\u52D5: ${strategy.industry}`);
  }
  /**
   * 處理 AI 營銷助手交給 AI 團隊的事件
   * 將策略傳遞給 AI 團隊銷售組件
   */
  handleAIStrategyHandover(strategy) {
    console.log("[Frontend] Handover strategy to AI Team:", strategy);
    this.aiTeamIncomingStrategy.set(strategy);
    this.currentView.set("ai-team");
    this.toastService.success(`\u{1F916} \u5DF2\u5C07\u7B56\u7565\u4EA4\u7D66 AI \u5718\u968A: ${strategy.industry}`);
  }
  /**
   * 將 ExtractedMember 轉換為 CapturedLead 格式
   */
  convertMemberToLead(member) {
    return {
      id: parseInt(member.user_id) || Date.now(),
      userId: member.user_id,
      username: member.username,
      firstName: member.first_name,
      lastName: member.last_name,
      sourceGroup: member.source_chat_title,
      triggeredKeyword: "",
      timestamp: new Date(member.extracted_at || /* @__PURE__ */ new Date()),
      status: member.contacted ? "Contacted" : "New",
      onlineStatus: this.mapOnlineStatus(member.online_status),
      interactionHistory: [],
      doNotContact: false,
      intentScore: this.mapValueLevelToScore(member.value_level),
      intentLevel: this.mapValueLevelToIntent(member.value_level),
      sourceType: "group_extract"
    };
  }
  /**
   * 將成員在線狀態映射到 Lead 在線狀態
   */
  mapOnlineStatus(status) {
    switch (status) {
      case "online":
        return "Online";
      case "recently":
        return "Recently";
      default:
        return "Offline";
    }
  }
  /**
   * 將價值等級映射到意圖分數
   */
  mapValueLevelToScore(level) {
    switch (level) {
      case "S":
        return 90;
      case "A":
        return 75;
      case "B":
        return 55;
      case "C":
        return 35;
      case "D":
        return 15;
      default:
        return 30;
    }
  }
  /**
   * 將價值等級映射到意圖等級
   */
  mapValueLevelToIntent(level) {
    switch (level) {
      case "S":
        return "HOT";
      case "A":
        return "WARM";
      case "B":
        return "NEUTRAL";
      case "C":
        return "COLD";
      case "D":
        return "NONE";
      default:
        return "NEUTRAL";
    }
  }
  // Dummy log method for UI feedback until backend sends log event
  log(message, type) {
    const newLog = { id: Date.now(), timestamp: /* @__PURE__ */ new Date(), message, type };
    this.logs.update((logs) => [newLog, ...logs].slice(0, 100));
  }
  static {
    this.\u0275fac = function AppComponent_Factory(__ngFactoryType__) {
      return new (__ngFactoryType__ || _AppComponent)();
    };
  }
  static {
    this.\u0275cmp = /* @__PURE__ */ \u0275\u0275defineComponent({ type: _AppComponent, selectors: [["app-root"]], viewQuery: function AppComponent_Query(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275viewQuery(_c04, 5)(_c12, 5);
      }
      if (rf & 2) {
        let _t;
        \u0275\u0275queryRefresh(_t = \u0275\u0275loadQuery()) && (ctx.onboardingComponent = _t.first);
        \u0275\u0275queryRefresh(_t = \u0275\u0275loadQuery()) && (ctx.monitoringGroupsRef = _t.first);
      }
    }, hostBindings: function AppComponent_HostBindings(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275listener("click", function AppComponent_click_HostBindingHandler($event) {
          return ctx.onDocumentClick($event);
        }, \u0275\u0275resolveDocument);
      }
    }, features: [\u0275\u0275ProvidersFeature([AccountLoaderService, ToastService])], decls: 17, vars: 11, consts: [["onboardingRef", ""], [1, "fixed", "bottom-4", "right-4", "z-50"], [1, "fixed", "inset-0", "z-[100]", "flex", "items-center", "justify-center", "pointer-events-none"], [3, "navigate"], [3, "closeDialog", "sendComplete", "isOpen", "targets"], [3, "closeDialog", "inviteComplete", "isOpen", "targets", "accounts"], [3, "closeDialog", "startExtractionEvent", "memberCountRefreshed", "isOpen", "group"], [1, "fixed", "inset-0", "z-50", "flex", "items-center", "justify-center"], [1, "flex", "h-screen", 2, "background-color", "var(--bg-primary)", "color", "var(--text-primary)"], [1, "auth-wrapper", 2, "min-height", "100vh", "background", "linear-gradient(to bottom right, #0f172a, #1e293b, #0f172a)"], [1, "group", "relative"], [1, "w-3", "h-3", "rounded-full", "bg-slate-500", "cursor-default"], [1, "absolute", "bottom-full", "right-0", "mb-2", "hidden", "group-hover:block"], [1, "bg-slate-800/95", "backdrop-blur-sm", "rounded-lg", "px-3", "py-2", "shadow-lg", "border", "border-slate-700", "whitespace-nowrap"], [1, "text-xs", "text-slate-400"], [1, "text-xs", "text-slate-500", "mt-1"], [1, "text-xs", "text-amber-400", "mt-1"], [1, "w-3", "h-3", "rounded-full", "bg-cyan-500", "animate-pulse", "cursor-default"], [1, "text-xs", "text-slate-300"], [1, "w-3", "h-3", "rounded-full", "bg-amber-500", "cursor-pointer", 3, "click"], [1, "text-xs", "text-amber-400"], [1, "w-3", "h-3", "rounded-full", "bg-red-500", "cursor-pointer", "animate-pulse", 3, "click"], [1, "text-xs", "text-red-400"], [1, "absolute", "inset-0", "bg-black/40", "animate-fade-in"], [1, "relative", "z-10", "animate-success-pop"], [1, "absolute", "inset-0", "-m-8", "rounded-full", "bg-gradient-to-r", "from-emerald-500/20", "to-cyan-500/20", "blur-xl", "animate-pulse"], [1, "relative", "bg-gradient-to-br", "from-slate-800", "to-slate-900", "rounded-2xl", "p-8", "shadow-2xl", "border", "border-emerald-500/30"], [1, "flex", "justify-center", "mb-4"], [1, "w-20", "h-20", "rounded-full", "bg-gradient-to-r", "from-emerald-500", "to-cyan-500", "flex", "items-center", "justify-center", "shadow-lg", "shadow-emerald-500/30"], [1, "text-4xl", "animate-bounce"], [1, "text-center"], [1, "text-xl", "font-bold", "text-white", "mb-1"], [1, "text-sm", "text-slate-400"], [1, "absolute", "-top-2", "-left-2", "w-4", "h-4", "bg-emerald-400", "rounded-full", "animate-ping"], [1, "absolute", "-top-1", "-right-3", "w-3", "h-3", "bg-cyan-400", "rounded-full", "animate-ping", 2, "animation-delay", "0.1s"], [1, "absolute", "-bottom-2", "-left-1", "w-2", "h-2", "bg-emerald-300", "rounded-full", "animate-ping", 2, "animation-delay", "0.2s"], [1, "absolute", "-bottom-1", "-right-2", "w-3", "h-3", "bg-cyan-300", "rounded-full", "animate-ping", 2, "animation-delay", "0.3s"], [1, "absolute", "inset-0", "bg-black/60", "backdrop-blur-sm", 3, "click"], [1, "relative", "z-10"], [3, "closed", "loginSuccess"], [3, "navigateEvent"], [3, "show", "title", "progress", "cancellable"], [1, "fixed", "inset-0", "bg-black/60", "backdrop-blur-sm", "z-[100]", "flex", "items-center", "justify-center"], [1, "backdrop-blur-sm", "flex-shrink-0", "flex", "flex-col", "sidebar", "h-screen", "transition-all", "duration-300", 2, "background-color", "var(--bg-sidebar)", "border-right", "1px solid var(--border-default)"], [1, "flex-shrink-0"], [1, "absolute", "top-3", "-right-3", "z-50", "w-6", "h-6", "rounded-full", "flex", "items-center", "justify-center", "transition-all", "duration-200", "hover:scale-110", 2, "background", "linear-gradient(135deg, #06b6d4, #8b5cf6)", "box-shadow", "0 2px 8px rgba(6, 182, 212, 0.4)", 3, "click", "title"], ["viewBox", "0 0 24 24", "fill", "none", "stroke", "currentColor", "stroke-width", "2", 1, "w-3.5", "h-3.5", "text-white", "transition-transform", "duration-200"], ["points", "15 18 9 12 15 6"], [1, "flex", "items-center", "gap-3", "p-4"], [1, "relative", "flex-shrink-0"], [1, "absolute", "inset-0", "rounded-xl", "blur-md", "opacity-50", 2, "background", "linear-gradient(135deg, #06b6d4, #8b5cf6)"], ["viewBox", "0 0 64 64", "fill", "none", 1, "h-10", "w-10", "relative", "z-10"], ["d", "M32 8L52 20V44L32 56L12 44V20L32 8Z", "fill", "url(#sidebarLogoGrad)", "stroke", "url(#sidebarLogoStroke)", "stroke-width", "1.5"], ["d", "M22 28L40 22L34 36L28 32L22 28Z", "fill", "white", "opacity", "0.95"], ["d", "M28 32L34 36L32 42L28 32Z", "fill", "white", "opacity", "0.8"], ["d", "M24 12L28 8L32 11L36 8L40 12L38 16H26L24 12Z", "fill", "#fbbf24"], ["cx", "32", "cy", "8", "r", "1.2", "fill", "#fef3c7"], ["id", "sidebarLogoGrad", "x1", "0%", "y1", "0%", "x2", "100%", "y2", "100%"], ["offset", "0%", "stop-color", "#0891b2"], ["offset", "100%", "stop-color", "#7c3aed"], ["id", "sidebarLogoStroke", "x1", "0%", "y1", "0%", "x2", "100%", "y2", "100%"], ["offset", "0%", "stop-color", "#22d3ee"], ["offset", "100%", "stop-color", "#a78bfa"], [1, "user-profile-card", "mx-3", "mb-4", "p-3", "rounded-xl", "cursor-pointer", "transition-all", "duration-300", "hover:scale-[1.02]", "group", 3, "click"], [1, "flex", "items-center", "gap-3"], [1, "avatar-wrapper", "relative"], [1, "avatar-glow", "absolute", "inset-0", "rounded-full", "opacity-0", "group-hover:opacity-100", "transition-opacity", "duration-300"], [1, "avatar-border", "w-12", "h-12", "rounded-full", "p-[2px]"], [1, "w-full", "h-full", "rounded-full", "flex", "items-center", "justify-center", "text-white", "font-bold", "text-lg", "avatar-inner"], [1, "vip-badge", "absolute", "-bottom-1", "-right-1", "w-5", "h-5", "rounded-full", "flex", "items-center", "justify-center", "text-[10px]", "shadow-lg", 3, "badge-silver", "badge-gold", "badge-diamond", "badge-star", "badge-king"], [1, "flex-1", "min-w-0"], [1, "text-sm", "font-semibold", "truncate", 2, "color", "var(--text-primary)"], [1, "flex", "items-center", "gap-1.5", "mt-0.5"], [1, "vip-tag", "vip-tag-silver"], [1, "vip-tag", "vip-tag-gold"], [1, "vip-tag", "vip-tag-diamond"], [1, "vip-tag", "vip-tag-star"], [1, "vip-tag", "vip-tag-king"], [1, "vip-tag", "vip-tag-bronze"], [1, "arrow-icon", "transition-transform", "duration-300", "group-hover:translate-x-1"], ["viewBox", "0 0 24 24", "fill", "none", "stroke", "currentColor", "stroke-width", "2", 1, "w-4", "h-4", 2, "color", "var(--text-muted)"], ["points", "9 18 15 12 9 6"], [1, "flex-1", "overflow-y-auto", "overflow-x-hidden", "sidebar-nav", "mt-2", "px-2", "pb-2"], [1, "sidebar-item", "flex", "items-center", "gap-3", "px-3", "py-2.5", "rounded-md", "transition-all", "duration-200", "cursor-pointer", "mb-1", 3, "click"], ["viewBox", "0 0 24 24", "fill", "none", "stroke", "currentColor", "stroke-width", "2", "stroke-linecap", "round", "stroke-linejoin", "round", 1, "h-5", "w-5", "sidebar-icon"], ["points", "12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"], ["x", "1", "y", "4", "width", "22", "height", "16", "rx", "2", "ry", "2"], ["x1", "1", "y1", "10", "x2", "23", "y2", "10"], ["x", "3", "y", "3", "width", "7", "height", "7"], ["x", "14", "y", "3", "width", "7", "height", "7"], ["x", "14", "y", "14", "width", "7", "height", "7"], ["x", "3", "y", "14", "width", "7", "height", "7"], [1, "sidebar-group"], [1, "w-full", "flex", "items-center", "justify-between", "px-3", "py-2", "mt-2", "rounded-md", "hover:bg-white/5", "transition-colors", "cursor-pointer", "group", 3, "click"], [1, "sidebar-group-title", "text-xs", "uppercase", "tracking-wider", "flex", "items-center", "gap-1", 2, "color", "var(--sidebar-group-title)"], ["viewBox", "0 0 24 24", "fill", "none", "stroke", "currentColor", "stroke-width", "2", 1, "w-3.5", "h-3.5", "transition-transform", "duration-200", 2, "color", "var(--sidebar-group-title)"], ["points", "6 9 12 15 18 9"], [1, "sidebar-group-content", "overflow-hidden"], [1, "sidebar-group-title", "text-xs", "uppercase", "tracking-wider", "font-semibold", "flex", "items-center", "gap-1", 2, "color", "var(--sidebar-group-title)"], [1, "inline-block", "w-5", "h-5", "rounded", "bg-gradient-to-br", "from-cyan-500", "to-blue-500", "text-center", "leading-5", "text-[10px]"], [1, "inline-block", "w-5", "h-5", "rounded", "bg-gradient-to-br", "from-violet-500", "to-fuchsia-500", "text-center", "leading-5", "text-[10px]"], [1, "flex-shrink-0", "p-4", "space-y-3", "border-t", 2, "border-color", "var(--border-default)", "background-color", "var(--bg-sidebar)"], [1, "w-full", "flex", "items-center", "justify-center", "gap-2", "px-4", "py-2.5", "bg-gradient-to-r", "from-cyan-500/10", "to-blue-500/10", "hover:from-cyan-500/20", "hover:to-blue-500/20", "border", "border-cyan-500/30", "hover:border-cyan-500/50", "text-cyan-400", "rounded-xl", "transition-all", "text-sm", "font-medium", "group", 3, "click"], [1, "text-lg", "group-hover:animate-bounce"], [1, "block", "text-sm", "font-medium", "mb-2", 2, "color", "var(--sidebar-group-title)"], [1, "flex", "rounded-md", "shadow-sm", "p-1", 2, "background-color", "var(--bg-tertiary)"], [1, "w-full", "text-sm", "py-1.5", "rounded", "transition-colors", "flex", "items-center", "justify-center", "gap-2", 3, "click"], ["xmlns", "http://www.w3.org/2000/svg", "fill", "none", "viewBox", "0 0 24 24", "stroke", "currentColor", 1, "h-4", "w-4"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"], ["stroke-linecap", "round", "stroke-linejoin", "round", "stroke-width", "2", "d", "M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"], [1, "flex-1", "p-8", "overflow-y-auto", 2, "background-color", "var(--bg-primary)"], [1, "h-full", "p-6", "overflow-auto"], [1, "h-full", "overflow-auto"], [1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-50"], [1, "fixed", "inset-0", "bg-black/70", "flex", "items-center", "justify-center", "z-50", "backdrop-blur-sm"], [1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-[100]"], [1, "fixed", "bottom-4", "right-4", "z-50", "bg-red-500/90", "text-white", "px-4", "py-2", "rounded-lg", "shadow-lg", "flex", "items-center", "gap-2", "cursor-pointer", "hover:bg-red-600"], [1, "fixed", "inset-0", "bg-black/60", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-[100]"], [1, "fixed", "inset-0", "bg-black/60", "backdrop-blur-sm", "z-[100]", "flex", "items-center", "justify-center", 3, "click"], [1, "bg-slate-900", "border", "border-slate-700", "rounded-2xl", "shadow-2xl", "w-full", "max-w-md", "mx-4", "overflow-hidden", 3, "click"], [1, "px-6", "py-4", "border-b", "border-slate-700", "flex", "items-center", "gap-3"], [1, "p-2", "bg-red-500/20", "rounded-lg"], ["viewBox", "0 0 24 24", "fill", "none", "stroke", "currentColor", "stroke-width", "2", 1, "h-6", "w-6", "text-red-400"], ["d", "M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"], ["x1", "10", "y1", "11", "x2", "10", "y2", "17"], ["x1", "14", "y1", "11", "x2", "14", "y2", "17"], [1, "text-lg", "font-bold", "text-white"], [1, "px-6", "py-6"], [1, "text-slate-300", "mb-4"], [1, "bg-red-500/10", "border", "border-red-500/20", "rounded-lg", "p-3", "text-sm", "text-red-300"], [1, "px-6", "py-4", "border-t", "border-slate-700", "flex", "justify-end", "gap-3"], [1, "px-4", "py-2", "bg-slate-700", "hover:bg-slate-600", "text-slate-300", "rounded-lg", "transition-colors", 3, "click"], [1, "px-4", "py-2", "bg-red-500", "hover:bg-red-600", "text-white", "rounded-lg", "transition-colors", "flex", "items-center", "gap-2", 3, "click"], ["viewBox", "0 0 24 24", "fill", "none", "stroke", "currentColor", "stroke-width", "2", 1, "h-4", "w-4"], [1, "font-bold", "text-cyan-400"], [1, "font-bold", "text-red-400"], [1, "p-2", "bg-emerald-500/20", "rounded-lg"], [1, "text-xl"], [1, "px-6", "py-4", "max-h-64", "overflow-y-auto"], [1, "text-center", "py-8", "text-slate-400"], [1, "space-y-2"], [1, "px-6", "py-4", "border-t", "border-slate-700"], [1, "w-full", "py-2", "bg-slate-700", "hover:bg-slate-600", "text-slate-300", "rounded-lg", "transition-colors", 3, "click"], [1, "mb-2"], [1, "text-cyan-400", "hover:underline", "text-sm", 3, "click"], [1, "w-full", "p-3", "bg-slate-800/50", "hover:bg-emerald-500/20", "border", "border-slate-700", "hover:border-emerald-500/50", "rounded-xl", "text-left", "transition-all", "group"], [1, "w-full", "p-3", "bg-slate-800/50", "hover:bg-emerald-500/20", "border", "border-slate-700", "hover:border-emerald-500/50", "rounded-xl", "text-left", "transition-all", "group", 3, "click"], [1, "flex", "items-center", "justify-between"], [1, "font-medium", "text-white", "group-hover:text-emerald-400"], [1, "text-xs", "text-slate-500"], [1, "text-emerald-400", "opacity-0", "group-hover:opacity-100", "transition-opacity"], [1, "text-xl", "font-bold", "bg-gradient-to-r", "from-cyan-400", "to-purple-400", "bg-clip-text", "text-transparent"], [1, "text-xs", 2, "color", "var(--text-muted)"], [1, "vip-badge", "absolute", "-bottom-1", "-right-1", "w-5", "h-5", "rounded-full", "flex", "items-center", "justify-center", "text-[10px]", "shadow-lg"], [1, "animate-pulse"], [1, "animate-bounce"], [1, "vip-icon"], [1, "vip-text"], ["data-tour", "accounts", 1, "sidebar-item", "flex", "items-center", "gap-3", "px-3", "py-2.5", "rounded-md", "transition-all", "duration-200", "cursor-pointer", "mb-1", 3, "click"], ["d", "M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"], ["cx", "9", "cy", "7", "r", "4"], ["d", "M23 21v-2a4 4 0 0 0-3-3.87"], ["d", "M16 3.13a4 4 0 0 1 0 7.75"], ["data-tour", "search-discovery", 1, "sidebar-item", "flex", "items-center", "gap-3", "px-3", "py-2.5", "rounded-md", "transition-all", "duration-200", "cursor-pointer", "mb-1", "relative", 3, "click"], ["cx", "11", "cy", "11", "r", "8"], ["d", "M21 21l-4.35-4.35"], [1, "absolute", "right-2", "px-1.5", "py-0.5", "text-[10px]", "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "text-white", "rounded-full", "font-bold"], [1, "sidebar-item", "flex", "items-center", "gap-3", "px-3", "py-2.5", "rounded-md", "transition-all", "duration-200", "cursor-pointer", "mb-1", "relative", 3, "click"], ["cx", "12", "cy", "5", "rx", "9", "ry", "3"], ["d", "M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"], ["d", "M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"], ["d", "M22 2L11 13"], ["d", "M22 2L15 22L11 13L2 9L22 2Z"], [1, "sidebar-item", "flex", "items-center", "gap-3", "px-3", "py-2.5", "rounded-lg", "transition-all", "duration-200", "cursor-pointer", "mb-1", "relative", "group", 3, "click"], [1, "w-8", "h-8", "rounded-lg", "flex", "items-center", "justify-center", "transition-all"], [1, "text-lg"], [1, "flex", "flex-col"], [1, "font-medium"], [1, "text-[10px]", "opacity-60"], [1, "sidebar-item", "flex", "items-center", "gap-3", "px-3", "py-2", "rounded-md", "transition-all", "duration-200", "cursor-pointer", "mb-1", 3, "click"], [1, "text-lg", "ml-1"], [1, "ml-auto", "text-xs", "px-1.5", "py-0.5", "bg-violet-500/20", "text-violet-400", "rounded"], ["data-tour", "ai-assistant", 1, "sidebar-item", "flex", "items-center", "gap-3", "px-3", "py-2.5", "rounded-lg", "transition-all", "duration-200", "cursor-pointer", "mb-1.5", "relative", "group", 3, "click", "title"], [1, "absolute", "right-2", "px-2", "py-0.5", "text-[9px]", "bg-gradient-to-r", "from-orange-500", "to-amber-500", "text-white", "rounded-full", "font-bold", "shadow-lg", "shadow-orange-500/20"], [1, "absolute", "right-2", "text-xs"], [1, "sidebar-item", "flex", "items-center", "gap-3", "px-3", "py-2.5", "rounded-lg", "transition-all", "duration-200", "cursor-pointer", "mb-1.5", "relative", "group", 3, "click", "title"], [1, "absolute", "right-2", "px-2", "py-0.5", "text-[9px]", "bg-gradient-to-r", "from-purple-500", "to-pink-500", "text-white", "rounded-full", "font-bold", "shadow-lg", "shadow-purple-500/20"], [1, "absolute", "right-2", "px-2", "py-0.5", "text-[9px]", "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "text-white", "rounded-full", "font-bold", "shadow-lg", "shadow-cyan-500/20"], ["d", "M18 20V10"], ["d", "M12 20V4"], ["d", "M6 20v-6"], ["d", "M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"], ["cx", "12", "cy", "12", "r", "4"], [1, "ml-auto", "px-1.5", "py-0.5", "text-xs", "bg-pink-500/20", "text-pink-400", "rounded"], [1, "sidebar-item", "flex", "items-center", "gap-3", "px-3", "py-2.5", "rounded-md", "transition-all", "duration-200", "cursor-pointer", "mb-1", 3, "click", "title"], [1, "ml-auto", "text-xs", "opacity-60"], [1, "knowledge-menu"], [1, "flex-1"], [1, "text-xs", "transition-transform", "duration-200"], [1, "pl-6", "space-y-1"], ["d", "M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m9 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"], [1, "sidebar-item", "flex", "items-center", "gap-2", "px-3", "py-2", "rounded-md", "transition-all", "duration-200", "cursor-pointer", "text-sm", 3, "click"], [1, "sidebar-item", "flex", "items-center", "gap-2", "px-3", "py-2", "rounded-md", "transition-all", "duration-200", "cursor-pointer", "text-sm", "relative", 3, "click"], [1, "ml-auto", "text-xs", "font-bold", "rounded-full", "px-1.5", "py-0.5", 2, "background-color", "rgba(239, 68, 68, 0.2)", "color", "#f87171"], ["cx", "12", "cy", "12", "r", "3"], ["d", "M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"], [3, "accountAdded", "back"], [1, "fixed", "inset-0", "bg-black/70", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-50", 3, "click"], [1, "bg-gradient-to-br", "from-slate-900", "via-slate-900", "to-slate-800", "border", "border-cyan-500/30", "rounded-2xl", "shadow-2xl", "shadow-cyan-500/10", "w-full", "max-w-2xl", "max-h-[90vh]", "overflow-hidden", "text-slate-200", 3, "click"], [1, "bg-gradient-to-r", "from-cyan-500/10", "via-blue-500/10", "to-purple-500/10", "border-b", "border-cyan-500/20", "p-5"], [1, "flex", "justify-between", "items-start"], [1, "flex", "items-center", "gap-4"], [1, "w-14", "h-14", "rounded-full", "bg-gradient-to-br", "from-cyan-500", "to-blue-600", "flex", "items-center", "justify-center", "text-white", "font-bold", "text-xl", "shadow-lg", "shadow-cyan-500/30"], [1, "flex", "items-center", "gap-2"], [1, "text-xl", "font-bold", "text-white"], [1, "h-2.5", "w-2.5", "rounded-full", "animate-pulse"], [1, "text-sm", "text-cyan-400"], [1, "flex", "items-center", "gap-2", "mt-1", "flex-wrap"], [1, "text-xs", "px-2", "py-0.5", "rounded-full", "bg-purple-500/20", "text-purple-400", "border", "border-purple-500/30"], [1, "text-xs", "px-2", "py-0.5", "rounded-full", "bg-cyan-500/20", "text-cyan-400", "border", "border-cyan-500/30"], [1, "text-xs", "px-2", "py-0.5", "rounded-full", 3, "class"], [1, "text-slate-400", "hover:text-white", "text-2xl", "leading-none", "transition-colors", "p-2", "hover:bg-white/10", "rounded-lg", 3, "click"], [1, "border-b", "border-cyan-500/20", "bg-slate-900/50"], ["aria-label", "Tabs", 1, "flex", "px-5"], [1, "whitespace-nowrap", "py-3", "px-4", "border-b-2", "border-transparent", "font-medium", "text-sm", "cursor-pointer", "text-slate-400", "hover:text-cyan-400", "hover:bg-cyan-500/5", "transition-all", "rounded-t-lg", "flex", "items-center", "gap-2", 3, "click"], [1, "overflow-y-auto", "max-h-[calc(90vh-220px)]", "p-5"], [1, "space-y-4"], [1, "py-4"], [1, "text-xs", "px-2", "py-0.5", "rounded-full"], [1, "bg-slate-800/50", "rounded-xl", "p-4", "border", "border-slate-700/50"], [1, "block", "text-sm", "font-medium", "text-cyan-400", "mb-2"], [1, "form-select", "w-full", "bg-slate-900/50", "border-cyan-500/30", "rounded-lg", "py-2.5", "px-3", "text-white", "focus:outline-none", "focus:ring-2", "focus:ring-cyan-500", "focus:border-cyan-500", 3, "ngModelChange", "ngModel"], ["value", ""], [1, "mt-2", "p-2", "bg-amber-500/10", "border", "border-amber-500/30", "rounded-lg"], [1, "grid", "grid-cols-3", "gap-3"], [1, "cursor-pointer", "p-3", "rounded-xl", "border-2", "transition-all", "text-center", 3, "click"], [1, "text-2xl", "mb-1"], [1, "text-sm", "font-medium"], [1, "space-y-3"], [1, "flex", "items-center", "justify-between", "mb-2"], [1, "text-sm", "font-medium", "text-cyan-400"], [1, "text-xs", "text-slate-500", "bg-slate-700/50", "px-2", "py-1", "rounded"], ["rows", "5", 1, "form-textarea", "w-full", "bg-slate-900/50", "border-cyan-500/30", "rounded-lg", "py-3", "px-3", "text-white", "focus:outline-none", "focus:ring-2", "focus:ring-cyan-500", "resize-none", "placeholder-slate-500", 3, "ngModelChange", "ngModel", "placeholder"], [1, "flex", "items-center", "gap-3", "flex-wrap"], [1, "flex", "items-center", "gap-2", "bg-slate-800/50", "hover:bg-cyan-500/20", "text-slate-300", "hover:text-cyan-400", "text-sm", "font-medium", "py-2", "px-4", "rounded-lg", "transition-all", "border", "border-slate-700/50", "hover:border-cyan-500/30", 3, "click"], [1, "p-3", "rounded-xl", "bg-cyan-500/10", "border", "border-cyan-500/30"], [1, "p-3", "bg-amber-500/10", "border", "border-amber-500/30", "rounded-xl"], [1, "p-3", "bg-red-500/10", "border", "border-red-500/30", "rounded-xl"], [1, "flex", "justify-between", "items-center", "pt-4", "border-t", "border-cyan-500/20"], [1, "text-sm", "text-red-400", "hover:text-red-300", "disabled:text-slate-500", "disabled:cursor-not-allowed", "flex", "items-center", "gap-1.5", "px-3", "py-2", "rounded-lg", "hover:bg-red-500/10", "transition-all", 3, "click", "disabled"], [1, "flex", "gap-3"], [1, "bg-slate-700/80", "hover:bg-slate-600", "text-slate-300", "font-medium", "py-2.5", "px-5", "rounded-xl", "transition-all", "border", "border-slate-600/50", "hover:border-slate-500", 3, "click"], [1, "bg-gradient-to-r", "from-cyan-500", "to-blue-500", "hover:from-cyan-400", "hover:to-blue-400", "text-white", "font-bold", "py-2.5", "px-6", "rounded-xl", "shadow-lg", "shadow-cyan-500/30", "disabled:from-slate-500", "disabled:to-slate-600", "disabled:shadow-none", "disabled:cursor-not-allowed", "flex", "items-center", "gap-2", "transition-all", 3, "click", "disabled"], [3, "value"], [1, "text-xs", "text-cyan-400", "hover:underline", "cursor-pointer", "mt-1", "inline-block", 3, "click"], [1, "flex", "items-center", "justify-between", "p-2", "bg-slate-200/30", "dark:bg-slate-800/30", "rounded-lg"], [1, "text-xs", "text-green-400"], [1, "text-xs", "bg-purple-500/20", "text-purple-400", "px-2", "py-1", "rounded"], [1, "p-2", "bg-cyan-500/10", "border", "border-cyan-500/20", "rounded-lg", "text-xs", "text-slate-400"], [1, "block", "text-sm", "font-medium", "text-slate-500", "dark:text-slate-400", "mb-1"], ["rows", "2", 1, "form-textarea", "w-full", "bg-slate-200/50", "dark:bg-slate-800/50", "border-slate-300", "dark:border-slate-700", "rounded-lg", "py-2", "px-3", "text-slate-800", "dark:text-white", "focus:outline-none", "focus:ring-2", "focus:ring-cyan-500", 3, "ngModelChange", "ngModel", "placeholder"], [1, "flex", "items-center", "justify-center", "gap-3"], [1, "bg-gradient-to-r", "from-purple-500", "to-cyan-500", "hover:from-purple-600", "hover:to-cyan-600", "text-white", "font-bold", "py-2", "px-6", "rounded-lg", "transition", "duration-200", "shadow-lg", "disabled:from-slate-400", "disabled:to-slate-500", "disabled:shadow-none", "disabled:cursor-not-allowed", "flex", "items-center", "gap-2", 3, "click", "disabled"], ["title", "\u91CD\u65B0\u751F\u6210", 1, "p-2", "bg-slate-600", "hover:bg-slate-500", "text-white", "rounded-lg"], [1, "p-3", "bg-amber-500/10", "border", "border-amber-500/20", "text-amber-400", "rounded-lg", "text-sm", "text-center"], [1, "p-3", "bg-red-500/10", "border", "border-red-500/20", "text-red-400", "rounded-lg", "text-sm"], [1, "p-3", "bg-green-500/10", "border", "border-green-500/20", "rounded-lg"], [1, "text-cyan-400"], [1, "animate-spin"], ["title", "\u91CD\u65B0\u751F\u6210", 1, "p-2", "bg-slate-600", "hover:bg-slate-500", "text-white", "rounded-lg", 3, "click"], [1, "text-cyan-400", "hover:underline", "cursor-pointer", "ml-1", 3, "click"], [1, "ml-2", "text-cyan-400", "hover:underline", 3, "click"], [1, "text-xs", "text-green-400", "mb-2"], [1, "form-select", "w-full", "bg-slate-900/50", "border-cyan-500/30", "rounded-lg", "py-2.5", "px-3", "text-white", "focus:outline-none", "focus:ring-2", "focus:ring-cyan-500", 3, "change"], [1, "flex", "items-center", "gap-2", "bg-green-500/20", "hover:bg-green-500/30", "text-green-400", "text-sm", "font-medium", "py-2", "px-3", "rounded-lg", "transition-all", "border", "border-green-500/30", 3, "click"], [1, "flex", "items-center", "gap-2", "bg-red-500/20", "hover:bg-red-500/30", "text-red-400", "text-sm", "font-medium", "py-2", "px-3", "rounded-lg", "transition-all", "border", "border-red-500/30", 3, "click"], [1, "text-sm", "text-cyan-400", "font-medium"], [1, "space-y-2", "max-h-40", "overflow-y-auto"], [1, "flex", "items-center", "justify-between", "text-sm", "bg-slate-800/50", "rounded-lg", "px-3", "py-2"], [1, "flex", "items-center", "gap-2", "truncate", "flex-1", "min-w-0"], [1, "text-green-400"], [1, "text-blue-400"], [1, "truncate", "text-white"], [1, "text-slate-500", "text-xs", "whitespace-nowrap"], [1, "text-green-500", "text-xs"], [1, "text-red-400", "hover:text-red-300", "text-lg", "font-bold", "p-1", "hover:bg-red-500/20", "rounded", "ml-2", 3, "click"], [1, "text-sm", "text-amber-400"], [1, "text-sm", "text-red-400"], [1, "mb-4", "flex", "items-center", "justify-between"], [1, "bg-cyan-500", "hover:bg-cyan-600", "text-white", "font-bold", "py-2", "px-4", "rounded-lg", "text-sm", "disabled:bg-slate-500", "disabled:cursor-not-allowed", "flex", "items-center", "gap-2", 3, "click", "disabled"], [1, "h-96", "overflow-y-auto", "space-y-3", "mb-4", "bg-slate-200/30", "dark:bg-slate-800/30", "rounded-lg", "p-4"], [1, "h-96", "overflow-y-auto"], [1, "space-y-3", "mb-4"], [1, "text-center", "py-8"], [1, "mt-4", "p-3", "bg-slate-800/50", "rounded-lg", "border", "border-cyan-500/20"], [1, "h-96", "overflow-y-auto", "space-y-3", "mb-4", "bg-slate-200/30", "dark:bg-slate-800/30", "rounded-lg", "p-4", 3, "scroll"], [1, "text-center", "py-4"], [1, "text-center", "py-2"], [1, "flex", "justify-start"], [1, "flex", "justify-end"], [1, "max-w-[75%]"], [1, "bg-slate-700", "text-white", "rounded-2xl", "rounded-bl-sm", "px-4", "py-2"], [1, "text-sm"], [1, "bg-gradient-to-r", "from-cyan-500", "to-purple-500", "text-white", "rounded-2xl", "rounded-br-sm", "px-4", "py-2", "shadow-lg"], [1, "flex", "items-center", "justify-end", "gap-2", "mt-1"], [1, "text-xs", "bg-purple-500/20", "text-purple-400", "px-1.5", "py-0.5", "rounded"], [1, "animate-spin", "text-cyan-400"], [1, "ml-2", "text-sm", "text-slate-500"], [1, "text-sm", "text-cyan-400", "hover:text-cyan-300", 3, "click"], [1, "flex", "justify-center"], [1, "bg-slate-800/50", "text-slate-400", "text-xs", "px-3", "py-1", "rounded-full"], [1, "text-4xl", "mb-2"], [1, "text-slate-500", "dark:text-slate-400"], [1, "text-xs", "text-slate-500", "mt-2"], [1, "text-sm", "font-medium", "text-cyan-400", "mb-2", "flex", "items-center", "gap-2"], [1, "grid", "grid-cols-3", "gap-2", "text-center", "text-xs"], [1, "p-2", "bg-slate-700/50", "rounded"], [1, "text-slate-400"], [1, "text-sm", "font-bold", "text-cyan-400"], [1, "fixed", "inset-0", "bg-black/70", "flex", "items-center", "justify-center", "z-50", "backdrop-blur-sm", 3, "click"], [1, "bg-slate-100", "dark:bg-slate-900", "rounded-2xl", "shadow-2xl", "border", "border-slate-300", "dark:border-slate-700", "w-full", "max-w-3xl", "max-h-[80vh]", "overflow-hidden", 3, "click"], [1, "p-4", "border-b", "border-slate-300", "dark:border-slate-700", "flex", "items-center", "justify-between", "bg-slate-200/50", "dark:bg-slate-800/50"], [1, "text-lg", "font-bold", "text-slate-900", "dark:text-white", "flex", "items-center", "gap-2"], ["viewBox", "0 0 24 24", "fill", "none", "stroke", "currentColor", "stroke-width", "2", 1, "h-5", "w-5", "text-purple-500"], ["d", "M3 3v5h5"], ["d", "M3.05 13A9 9 0 1 0 6 5.3L3 8"], ["d", "M12 7v5l4 2"], [1, "text-slate-500", "hover:text-slate-700", "dark:text-slate-400", "dark:hover:text-white", 3, "click"], ["viewBox", "0 0 24 24", "fill", "none", "stroke", "currentColor", "stroke-width", "2", 1, "h-5", "w-5"], ["x1", "18", "y1", "6", "x2", "6", "y2", "18"], ["x1", "6", "y1", "6", "x2", "18", "y2", "18"], [1, "p-4", "overflow-y-auto", "max-h-[60vh]"], [1, "text-center", "py-8", "text-slate-500"], [1, "p-4", "border-t", "border-slate-300", "dark:border-slate-700", "bg-slate-200/50", "dark:bg-slate-800/50", "flex", "justify-end"], [1, "px-4", "py-2", "bg-slate-300", "dark:bg-slate-700", "hover:bg-slate-400", "dark:hover:bg-slate-600", "rounded-lg", "text-sm", "font-medium", "transition-colors", 3, "click"], ["viewBox", "0 0 24 24", "fill", "none", "stroke", "currentColor", "stroke-width", "2", 1, "h-12", "w-12", "mx-auto", "mb-3", "text-slate-400"], ["cx", "12", "cy", "12", "r", "10"], ["d", "M12 8v4l3 3"], [1, "bg-slate-200/50", "dark:bg-slate-800/50", "rounded-lg", "p-3", "border", "border-slate-300", "dark:border-slate-700", 3, "opacity-50"], [1, "bg-slate-200/50", "dark:bg-slate-800/50", "rounded-lg", "p-3", "border", "border-slate-300", "dark:border-slate-700"], [1, "p-2", "rounded-lg"], [1, "font-medium", "text-slate-900", "dark:text-white"], [1, "text-yellow-500", "ml-2"], [1, "text-red-400", "ml-2"], [1, "text-xs", "bg-yellow-500/20", "hover:bg-yellow-500/30", "text-yellow-400", "px-2", "py-1", "rounded"], [1, "text-xs", "bg-yellow-500/20", "hover:bg-yellow-500/30", "text-yellow-400", "px-2", "py-1", "rounded", 3, "click"], [1, "bg-gradient-to-br", "from-slate-800", "to-slate-900", "rounded-2xl", "shadow-2xl", "w-full", "max-w-2xl", "mx-4", "overflow-hidden", "border", "border-cyan-500/30"], [1, "bg-gradient-to-r", "from-cyan-500", "to-purple-500", "p-6", "text-center"], [1, "text-3xl", "font-bold", "text-white", "mb-2"], [1, "text-cyan-100"], [1, "flex", "justify-center", "gap-2", "py-4", "bg-slate-800/50"], [1, "w-3", "h-3", "rounded-full", "transition-all"], [1, "p-6"], [1, "text-center", "space-y-6"], [1, "p-6", "bg-slate-800/50", "flex", "justify-between", "items-center"], [1, "text-sm", "text-slate-400", "hover:text-white", "transition-colors", 3, "click"], [1, "px-4", "py-2", "bg-slate-700", "hover:bg-slate-600", "text-white", "rounded-lg", "transition-colors"], [1, "px-6", "py-2", "bg-gradient-to-r", "from-cyan-500", "to-purple-500", "hover:from-cyan-600", "hover:to-purple-600", "text-white", "font-medium", "rounded-lg", "transition-all"], [1, "px-6", "py-2", "bg-gradient-to-r", "from-green-500", "to-emerald-500", "hover:from-green-600", "hover:to-emerald-600", "text-white", "font-medium", "rounded-lg", "transition-all"], [1, "grid", "grid-cols-3", "gap-4", "mb-6"], [1, "p-4", "bg-slate-700/50", "rounded-xl"], [1, "text-3xl", "mb-2"], [1, "text-sm", "font-medium", "text-white"], [1, "text-slate-300"], [1, "text-lg", "font-semibold", "text-white", "text-center", "mb-4"], [1, "p-4", "rounded-xl"], [1, "text-2xl"], [1, "font-medium", "text-white"], [1, "px-3", "py-1", "bg-slate-700", "hover:bg-slate-600", "rounded", "text-sm", "text-white", "disabled:opacity-50", 3, "click", "disabled"], [1, "block", "text-sm", "font-medium", "text-slate-300", "mb-2"], [1, "w-full", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "py-2", "px-3", "text-white", 3, "ngModel"], ["placeholder", "qwen2:7b", 1, "w-full", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "py-2", "px-3", "text-white", 3, "ngModel"], [1, "w-full", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "py-2", "px-3", "text-white", 3, "ngModelChange", "ngModel"], ["placeholder", "qwen2:7b", 1, "w-full", "bg-slate-800", "border", "border-slate-600", "rounded-lg", "py-2", "px-3", "text-white", 3, "ngModelChange", "ngModel"], [1, "text-sm", "text-slate-300", "space-y-2"], [1, "block", "bg-slate-800", "p-2", "rounded", "text-cyan-400", "text-xs"], [1, "flex", "items-center", "gap-2", "cursor-pointer"], ["type", "checkbox", 1, "w-4", "h-4", "text-cyan-500", "rounded", 3, "change", "checked"], [1, "text-sm", "text-slate-300"], [1, "mt-2"], [1, "w-full", "bg-slate-800", "border", "border-slate-600", "rounded", "py-1", "px-2", "text-sm", "text-white", 3, "ngModelChange", "ngModel"], ["value", "gemini"], ["value", "openai"], [1, "text-6xl", "mb-4"], [1, "text-2xl", "font-bold", "text-white"], [1, "p-4", "bg-cyan-500/10", "rounded-xl", "border", "border-cyan-500/30"], [1, "text-sm", "text-slate-300", "space-y-1"], [1, "px-4", "py-2", "bg-slate-700", "hover:bg-slate-600", "text-white", "rounded-lg", "transition-colors", 3, "click"], [1, "px-6", "py-2", "bg-gradient-to-r", "from-cyan-500", "to-purple-500", "hover:from-cyan-600", "hover:to-purple-600", "text-white", "font-medium", "rounded-lg", "transition-all", 3, "click"], [1, "px-6", "py-2", "bg-gradient-to-r", "from-green-500", "to-emerald-500", "hover:from-green-600", "hover:to-emerald-600", "text-white", "font-medium", "rounded-lg", "transition-all", 3, "click"], [1, "bg-slate-800", "rounded-2xl", "shadow-2xl", "w-full", "max-w-lg", "mx-4", "overflow-hidden", "border", "border-amber-500/50"], [1, "bg-amber-500/20", "p-6", "text-center", "border-b", "border-amber-500/30"], [1, "text-5xl", "mb-3"], [1, "text-xl", "font-bold", "text-amber-400"], [1, "text-slate-400", "text-sm", "mt-2"], [1, "p-6", "space-y-4"], [1, "text-slate-300", "text-sm"], [1, "bg-slate-700/50", "rounded-lg", "p-3", "max-h-48", "overflow-y-auto", "space-y-2"], [1, "flex", "items-center", "justify-between", "p-2", "bg-slate-600/50", "rounded-lg"], [1, "bg-blue-500/10", "border", "border-blue-500/30", "rounded-lg", "p-3"], [1, "text-blue-400", "text-sm"], [1, "p-4", "bg-slate-700/30", "flex", "justify-end", "gap-3"], [1, "px-4", "py-2", "bg-slate-600", "hover:bg-slate-500", "text-white", "rounded-lg", "transition-colors", 3, "click"], [1, "px-4", "py-2", "bg-amber-500", "hover:bg-amber-600", "disabled:opacity-50", "text-white", "rounded-lg", "transition-colors", "flex", "items-center", "gap-2", 3, "click", "disabled"], [1, "text-white", "font-medium"], [1, "text-green-400", "text-xs"], [1, "text-amber-400", "text-xs"], [1, "bg-slate-800", "rounded-2xl", "shadow-2xl", "w-full", "max-w-lg", "mx-4", "overflow-hidden", "border", "border-red-500/50"], [1, "bg-red-500/20", "p-6", "text-center", "border-b", "border-red-500/30"], [1, "text-xl", "font-bold", "text-red-400"], [1, "bg-slate-700/50", "rounded-lg", "p-4", "space-y-3"], [1, "flex", "items-start", "gap-3"], ["href", "https://www.python.org/downloads/", "target", "_blank", 1, "text-cyan-400", "text-sm", "hover:underline"], [1, "text-slate-400", "text-sm"], [1, "block", "bg-slate-800", "text-green-400", "text-sm", "p-2", "rounded", "mt-1"], [1, "bg-red-500/10", "border", "border-red-500/30", "rounded-lg", "p-3"], [1, "text-red-400", "text-sm"], [1, "fixed", "bottom-4", "right-4", "z-50", "bg-red-500/90", "text-white", "px-4", "py-2", "rounded-lg", "shadow-lg", "flex", "items-center", "gap-2", "cursor-pointer", "hover:bg-red-600", 3, "click"], [1, "fixed", "inset-0", "bg-black/60", "backdrop-blur-sm", "flex", "items-center", "justify-center", "z-[100]", 3, "click"], [1, "bg-slate-800", "rounded-2xl", "shadow-2xl", "w-full", "max-w-md", "mx-4", "overflow-hidden", "border", "border-cyan-500/30", 3, "click"], [1, "bg-gradient-to-r", "from-cyan-500/20", "to-blue-500/20", "p-4", "border-b", "border-slate-700/50"], [1, "text-lg", "font-bold", "text-white", "flex", "items-center", "gap-2"], [1, "block", "text-sm", "text-slate-400", "mb-2"], ["type", "text", "placeholder", "\u4F8B\u5982\uFF1A\u8CB7\u5BB6\u610F\u5411\u3001\u7522\u54C1\u8AEE\u8A62...", "autofocus", "", 1, "w-full", "bg-slate-900/50", "border", "border-slate-600", "rounded-lg", "px-4", "py-3", "text-white", "focus:border-cyan-500", "focus:ring-1", "focus:ring-cyan-500", "transition-colors", 3, "input", "keyup.enter", "value"], [1, "px-4", "py-2", "bg-cyan-500", "hover:bg-cyan-400", "text-white", "rounded-lg", "transition-colors", "font-medium", 3, "click"]], template: function AppComponent_Template(rf, ctx) {
      if (rf & 1) {
        \u0275\u0275element(0, "app-network-status")(1, "app-auth-transition")(2, "app-toast")(3, "app-global-confirm-dialog")(4, "app-global-input-dialog");
        \u0275\u0275conditionalCreate(5, AppComponent_Conditional_5_Template, 5, 1, "div", 1);
        \u0275\u0275conditionalCreate(6, AppComponent_Conditional_6_Template, 17, 3, "div", 2);
        \u0275\u0275elementStart(7, "app-command-palette", 3);
        \u0275\u0275listener("navigate", function AppComponent_Template_app_command_palette_navigate_7_listener($event) {
          return ctx.handleCommandNavigation($event);
        });
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(8, "app-batch-send-dialog", 4);
        \u0275\u0275listener("closeDialog", function AppComponent_Template_app_batch_send_dialog_closeDialog_8_listener() {
          return ctx.dialogService.closeBatchSend();
        })("sendComplete", function AppComponent_Template_app_batch_send_dialog_sendComplete_8_listener($event) {
          return ctx.handleBatchSendComplete($event);
        });
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(9, "app-batch-invite-dialog", 5);
        \u0275\u0275listener("closeDialog", function AppComponent_Template_app_batch_invite_dialog_closeDialog_9_listener() {
          return ctx.dialogService.closeBatchInvite();
        })("inviteComplete", function AppComponent_Template_app_batch_invite_dialog_inviteComplete_9_listener($event) {
          return ctx.handleBatchInviteComplete($event);
        });
        \u0275\u0275elementEnd();
        \u0275\u0275elementStart(10, "app-member-extraction-dialog", 6);
        \u0275\u0275listener("closeDialog", function AppComponent_Template_app_member_extraction_dialog_closeDialog_10_listener() {
          return ctx.closeMemberExtractionDialogUnified();
        })("startExtractionEvent", function AppComponent_Template_app_member_extraction_dialog_startExtractionEvent_10_listener($event) {
          return ctx.handleMemberExtractionStart($event);
        })("memberCountRefreshed", function AppComponent_Template_app_member_extraction_dialog_memberCountRefreshed_10_listener($event) {
          return ctx.handleMemberCountRefreshed($event);
        });
        \u0275\u0275elementEnd();
        \u0275\u0275element(11, "app-membership-dialog")(12, "app-payment")(13, "app-upgrade-prompt");
        \u0275\u0275conditionalCreate(14, AppComponent_Conditional_14_Template, 4, 0, "div", 7);
        \u0275\u0275conditionalCreate(15, AppComponent_Conditional_15_Template, 186, 130, "div", 8)(16, AppComponent_Conditional_16_Template, 2, 0, "div", 9);
      }
      if (rf & 2) {
        \u0275\u0275advance(5);
        \u0275\u0275conditional(ctx.backendConnectionState() !== "connected" || !ctx.offlineCache.isOnline() ? 5 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.showSuccessOverlay() ? 6 : -1);
        \u0275\u0275advance(2);
        \u0275\u0275property("isOpen", ctx.dialogService.showBatchMessageDialog())("targets", ctx.dialogService.batchSendTargets());
        \u0275\u0275advance();
        \u0275\u0275property("isOpen", ctx.dialogService.showBatchInviteDialog())("targets", ctx.dialogService.batchInviteTargets())("accounts", ctx.accounts());
        \u0275\u0275advance();
        \u0275\u0275property("isOpen", ctx.dialogService.showMemberExtractionDialog() || ctx.showMemberExtractionDialog())("group", ctx.dialogService.memberExtractionGroup() || ctx.memberExtractionGroup());
        \u0275\u0275advance(4);
        \u0275\u0275conditional(ctx.showQrLoginDialog() ? 14 : -1);
        \u0275\u0275advance();
        \u0275\u0275conditional(ctx.isAuthenticated() ? 15 : 16);
      }
    }, dependencies: [
      // 核心模組
      CommonModule,
      FormsModule,
      NgSelectOption,
      \u0275NgSelectMultipleOption,
      DefaultValueAccessor,
      SelectControlValueAccessor,
      NgControlStatus,
      NgModel,
      RouterOutlet,
      // 🆕 視圖組件（用於 @switch 視圖切換）
      DashboardViewComponent,
      AccountsViewComponent,
      SettingsViewComponent,
      LeadsViewComponent,
      AutomationViewComponent,
      ResourceDiscoveryViewComponent,
      AiCenterViewComponent,
      MultiRoleViewComponent,
      AnalyticsViewComponent,
      MonitoringViewComponent,
      // 🔧 P0: 添加帳號頁面組件
      AddAccountPageComponent,
      // 🆕 Phase P0: 補全缺失的視圖組件
      MembershipCenterComponent,
      ProfileComponent,
      ResourceCenterComponent,
      SearchDiscoveryComponent,
      AiMarketingAssistantComponent,
      AiTeamHubComponent,
      MemberDatabaseComponent,
      ApiCredentialsViewComponent,
      // 🆕 錢包視圖
      WalletViewComponent,
      // 🆕 知識大腦獨立組件
      AIBrainComponent,
      KnowledgeGapsComponent,
      KnowledgeManageComponent,
      // 🆕 P2: 營銷報表
      MarketingReportComponent,
      // 通用組件（模板中使用）
      ToastComponent,
      GlobalConfirmDialogComponent,
      GlobalInputDialogComponent,
      ProgressDialogComponent,
      // 會員相關（模板中使用）
      MembershipDialogComponent,
      UpgradePromptComponent,
      PaymentComponent,
      // 導航和佈局（模板中使用）
      OnboardingComponent,
      LanguageSwitcherCompactComponent,
      // 帳號管理（模板中使用）
      QrLoginComponent,
      // 對話框（模板中使用）
      BatchSendDialogComponent,
      BatchInviteDialogComponent,
      MemberExtractionDialogComponent,
      // 命令面板（模板中使用）
      CommandPaletteComponent,
      // 🆕 網絡狀態和認證過渡動畫
      NetworkStatusComponent,
      AuthTransitionComponent,
      SlicePipe
    ], styles: ['\n\n[_nghost-%COMP%]     .highlight-pulse {\n  animation: _ngcontent-%COMP%_highlight-pulse 1.5s ease-in-out 2;\n}\n@keyframes _ngcontent-%COMP%_highlight-pulse {\n  0%, 100% {\n    box-shadow: 0 0 0 0 rgba(6, 182, 212, 0);\n    border-color: inherit;\n  }\n  50% {\n    box-shadow: 0 0 20px 5px rgba(6, 182, 212, 0.5);\n    border-color: rgb(6, 182, 212);\n  }\n}\n@keyframes _ngcontent-%COMP%_fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n@keyframes _ngcontent-%COMP%_success-pop {\n  0% {\n    transform: scale(0.5);\n    opacity: 0;\n  }\n  50% {\n    transform: scale(1.1);\n  }\n  100% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n.animate-fade-in[_ngcontent-%COMP%] {\n  animation: _ngcontent-%COMP%_fade-in 0.3s ease-out forwards;\n}\n.animate-success-pop[_ngcontent-%COMP%] {\n  animation: _ngcontent-%COMP%_success-pop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;\n}\n[_nghost-%COMP%]     .page-content {\n  animation: _ngcontent-%COMP%_page-fade-in 0.3s ease-out;\n}\n@keyframes _ngcontent-%COMP%_page-fade-in {\n  from {\n    opacity: 0;\n    transform: translateY(10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n[_nghost-%COMP%]     .card-hover {\n  transition: all 0.2s ease;\n}\n[_nghost-%COMP%]     .card-hover:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.3);\n}\n[_nghost-%COMP%]     .sidebar-item {\n  position: relative;\n  overflow: hidden;\n}\n[_nghost-%COMP%]     .sidebar-item::before {\n  content: "";\n  position: absolute;\n  left: 0;\n  top: 50%;\n  width: 3px;\n  height: 0;\n  background:\n    linear-gradient(\n      to bottom,\n      #06b6d4,\n      #8b5cf6);\n  transition: height 0.2s ease;\n  transform: translateY(-50%);\n  border-radius: 0 2px 2px 0;\n}\n[_nghost-%COMP%]     .sidebar-item:hover::before, \n[_nghost-%COMP%]     .sidebar-item.active::before {\n  height: 60%;\n}\n[_nghost-%COMP%]     .btn-ripple {\n  position: relative;\n  overflow: hidden;\n}\n[_nghost-%COMP%]     .btn-ripple::after {\n  content: "";\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n  background-image:\n    radial-gradient(\n      circle,\n      #fff 10%,\n      transparent 10.01%);\n  background-repeat: no-repeat;\n  background-position: 50%;\n  transform: scale(10, 10);\n  opacity: 0;\n  transition: transform 0.5s, opacity 0.5s;\n}\n[_nghost-%COMP%]     .btn-ripple:active::after {\n  transform: scale(0, 0);\n  opacity: 0.3;\n  transition: 0s;\n}\n[_nghost-%COMP%]     .animate-number {\n  animation: _ngcontent-%COMP%_number-pop 0.3s ease-out;\n}\n@keyframes _ngcontent-%COMP%_number-pop {\n  0% {\n    transform: scale(1);\n  }\n  50% {\n    transform: scale(1.2);\n  }\n  100% {\n    transform: scale(1);\n  }\n}\n[_nghost-%COMP%]     .gradient-border {\n  position: relative;\n  background:\n    linear-gradient(var(--card-bg), var(--card-bg)) padding-box,\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #8b5cf6) border-box;\n  border: 1px solid transparent;\n}\n/*# sourceMappingURL=app.component.css.map */'], changeDetection: 0 });
  }
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(AppComponent, [{
    type: Component,
    args: [{ selector: "app-root", changeDetection: ChangeDetectionStrategy.OnPush, standalone: true, imports: [
      // 核心模組
      CommonModule,
      FormsModule,
      RouterOutlet,
      // 🆕 視圖組件（用於 @switch 視圖切換）
      DashboardViewComponent,
      AccountsViewComponent,
      SettingsViewComponent,
      LeadsViewComponent,
      AutomationViewComponent,
      ResourceDiscoveryViewComponent,
      AiCenterViewComponent,
      MultiRoleViewComponent,
      AnalyticsViewComponent,
      MonitoringViewComponent,
      // 🔧 P0: 添加帳號頁面組件
      AddAccountPageComponent,
      // 🆕 Phase P0: 補全缺失的視圖組件
      MembershipCenterComponent,
      ProfileComponent,
      ResourceCenterComponent,
      SearchDiscoveryComponent,
      AiMarketingAssistantComponent,
      AiTeamHubComponent,
      MemberDatabaseComponent,
      ApiCredentialsViewComponent,
      // 🆕 錢包視圖
      WalletViewComponent,
      // 🆕 知識大腦獨立組件
      AIBrainComponent,
      KnowledgeGapsComponent,
      KnowledgeManageComponent,
      KnowledgeManageComponent,
      // 🆕 P2: 營銷報表
      MarketingReportComponent,
      // 通用組件（模板中使用）
      ToastComponent,
      GlobalConfirmDialogComponent,
      GlobalInputDialogComponent,
      ProgressDialogComponent,
      // 會員相關（模板中使用）
      MembershipDialogComponent,
      UpgradePromptComponent,
      PaymentComponent,
      // 導航和佈局（模板中使用）
      OnboardingComponent,
      LanguageSwitcherCompactComponent,
      LoginComponent,
      // 帳號管理（模板中使用）
      QrLoginComponent,
      // 對話框（模板中使用）
      BatchSendDialogComponent,
      BatchInviteDialogComponent,
      MemberExtractionDialogComponent,
      // 命令面板（模板中使用）
      CommandPaletteComponent,
      // 🆕 網絡狀態和認證過渡動畫
      NetworkStatusComponent,
      AuthTransitionComponent
    ], providers: [AccountLoaderService, ToastService], template: `<!-- \u{1F195} \u5168\u5C40\u7DB2\u7D61\u72C0\u614B\u548C\u8A8D\u8B49\u904E\u6E21\u52D5\u756B -->
<app-network-status></app-network-status>
<app-auth-transition></app-auth-transition>

<!-- \u5168\u5C40\u901A\u77E5\u548C\u5C0D\u8A71\u6846 -->
<app-toast></app-toast>
<app-global-confirm-dialog></app-global-confirm-dialog>
<app-global-input-dialog></app-global-input-dialog>

<!-- \u{1F195} P2 \u512A\u5316\uFF1A\u667A\u80FD\u9023\u63A5\u72C0\u614B\u6307\u793A\u5668\uFF08\u652F\u6301\u96E2\u7DDA\u6A21\u5F0F\uFF09 -->
@if (backendConnectionState() !== 'connected' || !offlineCache.isOnline()) {
  <div class="fixed bottom-4 right-4 z-50">
    <!-- \u{1F195} P2-2: \u96E2\u7DDA\u6A21\u5F0F\uFF1A\u7070\u9EDE -->
    @if (!offlineCache.isOnline()) {
      <div class="group relative">
        <div class="w-3 h-3 rounded-full bg-slate-500 cursor-default"></div>
        <div class="absolute bottom-full right-0 mb-2 hidden group-hover:block">
          <div class="bg-slate-800/95 backdrop-blur-sm rounded-lg px-3 py-2 shadow-lg border border-slate-700 whitespace-nowrap">
            <p class="text-xs text-slate-400">\u{1F4F4} \u96E2\u7DDA\u6A21\u5F0F</p>
            @if (offlineCache.isCacheValid()) {
              <p class="text-xs text-slate-500 mt-1">\u4F7F\u7528\u7DE9\u5B58\u6578\u64DA</p>
            }
            @if (offlineCache.hasPendingOperations()) {
              <p class="text-xs text-amber-400 mt-1">{{ offlineCache.pendingOperations().length }} \u500B\u5F85\u540C\u6B65\u64CD\u4F5C</p>
            }
          </div>
        </div>
      </div>
    }
    
    <!-- \u9023\u63A5\u4E2D\uFF1A\u5C0F\u85CD\u9EDE -->
    @else if (backendConnectionState() === 'connecting') {
      <div class="group relative">
        <div class="w-3 h-3 rounded-full bg-cyan-500 animate-pulse cursor-default"></div>
        <div class="absolute bottom-full right-0 mb-2 hidden group-hover:block">
          <div class="bg-slate-800/95 backdrop-blur-sm rounded-lg px-3 py-2 shadow-lg border border-slate-700 whitespace-nowrap">
            <p class="text-xs text-slate-300">{{ backendConnectionMessage() }}</p>
          </div>
        </div>
      </div>
    }
    
    <!-- \u964D\u7D1A\u6A21\u5F0F\uFF1A\u5C0F\u9EC3\u9EDE -->
    @else if (backendConnectionState() === 'timeout') {
      <div class="group relative">
        <div class="w-3 h-3 rounded-full bg-amber-500 cursor-pointer" (click)="retryConnection()"></div>
        <div class="absolute bottom-full right-0 mb-2 hidden group-hover:block">
          <div class="bg-slate-800/95 backdrop-blur-sm rounded-lg px-3 py-2 shadow-lg border border-slate-700 whitespace-nowrap">
            <p class="text-xs text-amber-400">\u964D\u7D1A\u6A21\u5F0F\uFF08\u9EDE\u64CA\u91CD\u9023\uFF09</p>
          </div>
        </div>
      </div>
    }
    
    <!-- \u932F\u8AA4\uFF1A\u5C0F\u7D05\u9EDE -->
    @else if (backendConnectionState() === 'error') {
      <div class="group relative">
        <div class="w-3 h-3 rounded-full bg-red-500 cursor-pointer animate-pulse" (click)="retryConnection()"></div>
        <div class="absolute bottom-full right-0 mb-2 hidden group-hover:block">
          <div class="bg-slate-800/95 backdrop-blur-sm rounded-lg px-3 py-2 shadow-lg border border-slate-700 whitespace-nowrap">
            <p class="text-xs text-red-400">{{ backendConnectionMessage() }}</p>
            <p class="text-xs text-slate-500 mt-1">\u9EDE\u64CA\u91CD\u8A66</p>
          </div>
        </div>
      </div>
    }
  </div>
}

<!-- \u{1F195} \u6210\u529F\u52D5\u756B\u8986\u84CB\u5C64 -->
@if (showSuccessOverlay()) {
  <div class="fixed inset-0 z-[100] flex items-center justify-center pointer-events-none">
    <!-- \u80CC\u666F\u906E\u7F69 -->
    <div class="absolute inset-0 bg-black/40 animate-fade-in"></div>
    
    <!-- \u6210\u529F\u52D5\u756B\u5361\u7247 -->
    <div class="relative z-10 animate-success-pop">
      <!-- \u5149\u5708\u6548\u679C -->
      <div class="absolute inset-0 -m-8 rounded-full bg-gradient-to-r from-emerald-500/20 to-cyan-500/20 blur-xl animate-pulse"></div>
      
      <!-- \u4E3B\u5361\u7247 -->
      <div class="relative bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-8 shadow-2xl border border-emerald-500/30">
        <!-- \u6210\u529F\u5716\u6A19 -->
        <div class="flex justify-center mb-4">
          <div class="w-20 h-20 rounded-full bg-gradient-to-r from-emerald-500 to-cyan-500 flex items-center justify-center shadow-lg shadow-emerald-500/30">
            <span class="text-4xl animate-bounce">{{ successOverlayConfig()?.icon || '\u2705' }}</span>
          </div>
        </div>
        
        <!-- \u6A19\u984C -->
        <div class="text-center">
          <h3 class="text-xl font-bold text-white mb-1">{{ successOverlayConfig()?.title || '\u64CD\u4F5C\u6210\u529F' }}</h3>
          @if (successOverlayConfig()?.subtitle) {
            <p class="text-sm text-slate-400">{{ successOverlayConfig()?.subtitle }}</p>
          }
        </div>
        
        <!-- \u88DD\u98FE\u7C92\u5B50 -->
        <div class="absolute -top-2 -left-2 w-4 h-4 bg-emerald-400 rounded-full animate-ping"></div>
        <div class="absolute -top-1 -right-3 w-3 h-3 bg-cyan-400 rounded-full animate-ping" style="animation-delay: 0.1s"></div>
        <div class="absolute -bottom-2 -left-1 w-2 h-2 bg-emerald-300 rounded-full animate-ping" style="animation-delay: 0.2s"></div>
        <div class="absolute -bottom-1 -right-2 w-3 h-3 bg-cyan-300 rounded-full animate-ping" style="animation-delay: 0.3s"></div>
      </div>
    </div>
  </div>
}

<!-- \u5168\u5C40\u547D\u4EE4\u9762\u677F (Cmd+K) -->
<app-command-palette (navigate)="handleCommandNavigation($event)"></app-command-palette>

<!-- \u6279\u91CF\u767C\u9001\u5C0D\u8A71\u6846 - \u{1F527} P0: \u7D71\u4E00\u4F7F\u7528 DialogService \u72C0\u614B -->
<app-batch-send-dialog
  [isOpen]="dialogService.showBatchMessageDialog()"
  [targets]="dialogService.batchSendTargets()"
  (closeDialog)="dialogService.closeBatchSend()"
  (sendComplete)="handleBatchSendComplete($event)">
</app-batch-send-dialog>

<!-- \u6279\u91CF\u62C9\u7FA4\u5C0D\u8A71\u6846 - \u{1F527} P0: \u7D71\u4E00\u4F7F\u7528 DialogService \u72C0\u614B -->
<app-batch-invite-dialog
  [isOpen]="dialogService.showBatchInviteDialog()"
  [targets]="dialogService.batchInviteTargets()"
  [accounts]="accounts()"
  (closeDialog)="dialogService.closeBatchInvite()"
  (inviteComplete)="handleBatchInviteComplete($event)">
</app-batch-invite-dialog>

<!-- \u6210\u54E1\u63D0\u53D6\u914D\u7F6E\u5C0D\u8A71\u6846 - \u{1F527} P0: \u7D71\u4E00\u4F7F\u7528 DialogService \u72C0\u614B -->
<app-member-extraction-dialog
  [isOpen]="dialogService.showMemberExtractionDialog() || showMemberExtractionDialog()"
  [group]="dialogService.memberExtractionGroup() || memberExtractionGroup()"
  (closeDialog)="closeMemberExtractionDialogUnified()"
  (startExtractionEvent)="handleMemberExtractionStart($event)"
  (memberCountRefreshed)="handleMemberCountRefreshed($event)">
</app-member-extraction-dialog>

<app-membership-dialog></app-membership-dialog>
<app-payment></app-payment>
<app-upgrade-prompt></app-upgrade-prompt>

<!-- QR \u6383\u78BC\u767B\u5165\u5F48\u7A97 -->
@if (showQrLoginDialog()) {
  <div class="fixed inset-0 z-50 flex items-center justify-center">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" (click)="closeQrLogin()"></div>
    <div class="relative z-10">
      <app-qr-login 
        (closed)="closeQrLogin()" 
        (loginSuccess)="onQrLoginSuccess($event)">
      </app-qr-login>
    </div>
  </div>
}

<!-- \u4E3B\u61C9\u7528\u754C\u9762 -->
<!-- \u{1F195} P1.3: \u7D71\u4E00\u4F7F\u7528 Router \u8655\u7406\u767B\u5165/\u672A\u767B\u5165\u72C0\u614B -->
<!-- \u672A\u8A8D\u8B49\u7528\u6236\u6703\u88AB AuthGuard \u81EA\u52D5\u91CD\u5B9A\u5411\u5230 /auth/login -->
@if (isAuthenticated()) {
  <!-- \u5DF2\u8A8D\u8B49\u7528\u6236\u986F\u793A\u4E3B\u754C\u9762 -->
  <div class="flex h-screen" style="background-color: var(--bg-primary); color: var(--text-primary);">
    
    <!-- Onboarding \u65B0\u624B\u5F15\u5BFC -->
    <app-onboarding #onboardingRef
                    (navigateEvent)="handleOnboardingNavigate($event)">
    </app-onboarding>
    
    <!-- Progress Dialog -->
    <app-progress-dialog
      [show]="progressDialog().show"
      [title]="progressDialog().title"
      [progress]="progressDialog().progress"
      [cancellable]="progressDialog().cancellable">
    </app-progress-dialog>
    
    <!-- \u522A\u9664\u78BA\u8A8D\u5C0D\u8A71\u6846 -->
    @if(deleteConfirmDialog().show) {
      <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center" 
           (click)="cancelDeleteLeads()">
        <div class="bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden"
             (click)="$event.stopPropagation()">
          <!-- \u6A19\u984C -->
          <div class="px-6 py-4 border-b border-slate-700 flex items-center gap-3">
            <div class="p-2 bg-red-500/20 rounded-lg">
              <svg class="h-6 w-6 text-red-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
              </svg>
            </div>
            <h3 class="text-lg font-bold text-white">\u78BA\u8A8D\u522A\u9664</h3>
          </div>
          
          <!-- \u5167\u5BB9 -->
          <div class="px-6 py-6">
            @if(deleteConfirmDialog().type === 'single') {
              <p class="text-slate-300 mb-4">
                \u78BA\u5B9A\u8981\u522A\u9664\u5BA2\u6236 <span class="font-bold text-cyan-400">@{{ deleteConfirmDialog().lead?.username || deleteConfirmDialog().lead?.userId }}</span> \u55CE\uFF1F
              </p>
            } @else {
              <p class="text-slate-300 mb-4">
                \u78BA\u5B9A\u8981\u522A\u9664 <span class="font-bold text-red-400">{{ deleteConfirmDialog().count }}</span> \u500B\u9078\u4E2D\u7684\u5BA2\u6236\u55CE\uFF1F
              </p>
            }
            <div class="bg-red-500/10 border border-red-500/20 rounded-lg p-3 text-sm text-red-300">
              \u26A0\uFE0F \u6B64\u64CD\u4F5C\u7121\u6CD5\u64A4\u92B7\uFF0C\u6240\u6709\u76F8\u95DC\u8A18\u9304\u5C07\u88AB\u6C38\u4E45\u522A\u9664\u3002
            </div>
          </div>
          
          <!-- \u6309\u9215 -->
          <div class="px-6 py-4 border-t border-slate-700 flex justify-end gap-3">
            <button (click)="cancelDeleteLeads()" 
                    class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-lg transition-colors">
              \u53D6\u6D88
            </button>
            <button (click)="executeDeleteLeads()" 
                    class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors flex items-center gap-2">
              <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
              </svg>
              \u78BA\u8A8D\u522A\u9664
            </button>
          </div>
        </div>
      </div>
    }
    
    <!-- \u9080\u8ACB\u9032\u7FA4\u5C0D\u8A71\u6846 -->
    @if(showInviteGroupDialog()) {
      <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center" 
           (click)="showInviteGroupDialog.set(false)">
        <div class="bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden"
             (click)="$event.stopPropagation()">
          <!-- \u6A19\u984C -->
          <div class="px-6 py-4 border-b border-slate-700 flex items-center gap-3">
            <div class="p-2 bg-emerald-500/20 rounded-lg">
              <span class="text-xl">\u{1F465}</span>
            </div>
            <div>
              <h3 class="text-lg font-bold text-white">\u9080\u8ACB\u9032\u7FA4</h3>
              <p class="text-sm text-slate-400">\u9078\u64C7\u5354\u4F5C\u7FA4\u7D44</p>
            </div>
          </div>
          
          <!-- \u7FA4\u7D44\u5217\u8868 -->
          <div class="px-6 py-4 max-h-64 overflow-y-auto">
            @if(collabGroups().length === 0) {
              <div class="text-center py-8 text-slate-400">
                <p class="mb-2">\u66AB\u7121\u5354\u4F5C\u7FA4\u7D44</p>
                <button (click)="currentView.set('multi-role'); showInviteGroupDialog.set(false)" 
                        class="text-cyan-400 hover:underline text-sm">
                  \u53BB\u5275\u5EFA\u7FA4\u7D44 \u2192
                </button>
              </div>
            } @else {
              <div class="space-y-2">
                @for(group of collabGroups(); track group.id) {
                  <button (click)="executeInviteToGroup(group.id)"
                          class="w-full p-3 bg-slate-800/50 hover:bg-emerald-500/20 border border-slate-700 hover:border-emerald-500/50 rounded-xl text-left transition-all group">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="font-medium text-white group-hover:text-emerald-400">{{ group.name }}</p>
                        <p class="text-xs text-slate-500">{{ group.members?.length || 0 }} \u500B\u6210\u54E1</p>
                      </div>
                      <span class="text-emerald-400 opacity-0 group-hover:opacity-100 transition-opacity">\u2192</span>
                    </div>
                  </button>
                }
              </div>
            }
          </div>
          
          <!-- \u53D6\u6D88\u6309\u9215 -->
          <div class="px-6 py-4 border-t border-slate-700">
            <button (click)="showInviteGroupDialog.set(false)" 
                    class="w-full py-2 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-lg transition-colors">
              \u53D6\u6D88
            </button>
          </div>
        </div>
      </div>
    }
    
    <!-- Sidebar -->
    <aside class="backdrop-blur-sm flex-shrink-0 flex flex-col sidebar h-screen transition-all duration-300" 
           [class.w-64]="!sidebarCollapsed()"
           [class.w-16]="sidebarCollapsed()"
           style="background-color: var(--bg-sidebar); border-right: 1px solid var(--border-default);">
      <!-- \u9802\u90E8\u56FA\u5B9A\u5340\u57DF\uFF1ALogo + \u7528\u6236\u4FE1\u606F -->
      <div class="flex-shrink-0">
        <!-- \u6536\u7E2E/\u5C55\u958B\u6309\u9215 -->
        <button (click)="toggleSidebarCollapse()" 
                class="absolute top-3 -right-3 z-50 w-6 h-6 rounded-full flex items-center justify-center transition-all duration-200 hover:scale-110"
                style="background: linear-gradient(135deg, #06b6d4, #8b5cf6); box-shadow: 0 2px 8px rgba(6, 182, 212, 0.4);"
                [title]="sidebarCollapsed() ? '\u5C55\u958B\u5074\u908A\u6B04' : '\u6536\u7E2E\u5074\u908A\u6B04'">
          <svg class="w-3.5 h-3.5 text-white transition-transform duration-200" 
               [class.rotate-180]="sidebarCollapsed()"
               viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        
        <!-- Logo - TG-AI\u667A\u63A7\u738B -->
        <div class="flex items-center gap-3 p-4" [class.justify-center]="sidebarCollapsed()">
           <div class="relative flex-shrink-0">
             <!-- Logo \u767C\u5149\u6548\u679C -->
             <div class="absolute inset-0 rounded-xl blur-md opacity-50" 
                  style="background: linear-gradient(135deg, #06b6d4, #8b5cf6);"></div>
             <!-- Logo SVG -->
             <svg class="h-10 w-10 relative z-10" viewBox="0 0 64 64" fill="none">
               <!-- \u4E2D\u5FC3\u516D\u908A\u5F62 -->
               <path d="M32 8L52 20V44L32 56L12 44V20L32 8Z" fill="url(#sidebarLogoGrad)" stroke="url(#sidebarLogoStroke)" stroke-width="1.5"/>
               <!-- \u7D19\u98DB\u6A5F -->
               <path d="M22 28L40 22L34 36L28 32L22 28Z" fill="white" opacity="0.95"/>
               <path d="M28 32L34 36L32 42L28 32Z" fill="white" opacity="0.8"/>
               <!-- \u7687\u51A0 -->
               <path d="M24 12L28 8L32 11L36 8L40 12L38 16H26L24 12Z" fill="#fbbf24"/>
               <circle cx="32" cy="8" r="1.2" fill="#fef3c7"/>
               <!-- \u6F38\u8B8A -->
               <defs>
                 <linearGradient id="sidebarLogoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                   <stop offset="0%" stop-color="#0891b2"/>
                   <stop offset="100%" stop-color="#7c3aed"/>
                 </linearGradient>
                 <linearGradient id="sidebarLogoStroke" x1="0%" y1="0%" x2="100%" y2="100%">
                   <stop offset="0%" stop-color="#22d3ee"/>
                   <stop offset="100%" stop-color="#a78bfa"/>
                 </linearGradient>
               </defs>
             </svg>
           </div>
          @if (!sidebarCollapsed()) {
            <div>
              <h1 class="text-xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">{{ t('title') }}</h1>
              <p class="text-xs" style="color: var(--text-muted);">{{ t('subtitle') }}</p>
            </div>
          }
        </div>
        
        <!-- \u7528\u6236\u4FE1\u606F\u5340\u57DF\uFF08\u7F8E\u5316\u7248 - \u738B\u8005\u69AE\u8000\u98A8\u683C\uFF09 -->
        <div class="user-profile-card mx-3 mb-4 p-3 rounded-xl cursor-pointer transition-all duration-300 hover:scale-[1.02] group"
             [class.level-bronze]="userMembershipLevel() === 'bronze'"
             [class.level-silver]="userMembershipLevel() === 'silver'"
             [class.level-gold]="userMembershipLevel() === 'gold'"
             [class.level-diamond]="userMembershipLevel() === 'diamond'"
             [class.level-star]="userMembershipLevel() === 'star'"
             [class.level-king]="userMembershipLevel() === 'king'"
             (click)="changeView('profile')">
          <div class="flex items-center gap-3">
            <!-- \u982D\u50CF\u6846\uFF08\u5E36\u7B49\u7D1A\u908A\u6846\uFF09 -->
            <div class="avatar-wrapper relative">
              <!-- \u52D5\u614B\u5149\u74B0 -->
              <div class="avatar-glow absolute inset-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"
                   [class.glow-bronze]="userMembershipLevel() === 'bronze'"
                   [class.glow-silver]="userMembershipLevel() === 'silver'"
                   [class.glow-gold]="userMembershipLevel() === 'gold'"
                   [class.glow-diamond]="userMembershipLevel() === 'diamond'"
                   [class.glow-star]="userMembershipLevel() === 'star'"
                   [class.glow-king]="userMembershipLevel() === 'king'">
              </div>
              <!-- \u982D\u50CF\u908A\u6846 -->
              <div class="avatar-border w-12 h-12 rounded-full p-[2px]"
                   [class.border-bronze]="userMembershipLevel() === 'bronze'"
                   [class.border-silver]="userMembershipLevel() === 'silver'"
                   [class.border-gold]="userMembershipLevel() === 'gold'"
                   [class.border-diamond]="userMembershipLevel() === 'diamond'"
                   [class.border-star]="userMembershipLevel() === 'star'"
                   [class.border-king]="userMembershipLevel() === 'king'">
                <!-- \u982D\u50CF\u5167\u5BB9 -->
                <div class="w-full h-full rounded-full flex items-center justify-center text-white font-bold text-lg avatar-inner"
                     [class.avatar-bronze]="userMembershipLevel() === 'bronze'"
                     [class.avatar-silver]="userMembershipLevel() === 'silver'"
                     [class.avatar-gold]="userMembershipLevel() === 'gold'"
                     [class.avatar-diamond]="userMembershipLevel() === 'diamond'"
                     [class.avatar-star]="userMembershipLevel() === 'star'"
                     [class.avatar-king]="userMembershipLevel() === 'king'">
                  {{ currentUser()?.username?.charAt(0).toUpperCase() || '?' }}
                </div>
              </div>
              <!-- \u6703\u54E1\u5FBD\u7AE0\uFF08\u53F3\u4E0B\u89D2\uFF09 -->
              @if (userMembershipLevel() !== 'bronze') {
                <div class="vip-badge absolute -bottom-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center text-[10px] shadow-lg"
                     [class.badge-silver]="userMembershipLevel() === 'silver'"
                     [class.badge-gold]="userMembershipLevel() === 'gold'"
                     [class.badge-diamond]="userMembershipLevel() === 'diamond'"
                     [class.badge-star]="userMembershipLevel() === 'star'"
                     [class.badge-king]="userMembershipLevel() === 'king'">
                  @switch (userMembershipLevel()) {
                    @case ('silver') { <span class="animate-pulse">\u{1F948}</span> }
                    @case ('gold') { <span class="animate-pulse">\u{1F947}</span> }
                    @case ('diamond') { <span class="animate-pulse">\u{1F48E}</span> }
                    @case ('star') { <span class="animate-pulse">\u{1F31F}</span> }
                    @case ('king') { <span class="animate-bounce">\u{1F451}</span> }
                  }
                </div>
              }
            </div>
            
            <!-- \u7528\u6236\u4FE1\u606F -->
            <div class="flex-1 min-w-0">
              <div class="text-sm font-semibold truncate" style="color: var(--text-primary);">
                {{ currentUser()?.username || '\u7528\u6236' }}
              </div>
              <div class="flex items-center gap-1.5 mt-0.5">
                <!-- \u6703\u54E1\u6A19\u7C64\uFF08\u738B\u8005\u69AE\u8000\u98A8\u683C\uFF09 -->
                @switch (userMembershipLevel()) {
                  @case ('silver') {
                    <span class="vip-tag vip-tag-silver">
                      <span class="vip-icon">\u{1F948}</span>
                      <span class="vip-text">\u767D\u9280\u7CBE\u82F1</span>
                    </span>
                  }
                  @case ('gold') {
                    <span class="vip-tag vip-tag-gold">
                      <span class="vip-icon">\u{1F947}</span>
                      <span class="vip-text">\u9EC3\u91D1\u5927\u5E2B</span>
                    </span>
                  }
                  @case ('diamond') {
                    <span class="vip-tag vip-tag-diamond">
                      <span class="vip-icon">\u{1F48E}</span>
                      <span class="vip-text">\u947D\u77F3\u738B\u724C</span>
                    </span>
                  }
                  @case ('star') {
                    <span class="vip-tag vip-tag-star">
                      <span class="vip-icon">\u{1F31F}</span>
                      <span class="vip-text">\u661F\u8000\u50B3\u8AAA</span>
                    </span>
                  }
                  @case ('king') {
                    <span class="vip-tag vip-tag-king">
                      <span class="vip-icon">\u{1F451}</span>
                      <span class="vip-text">\u69AE\u8000\u738B\u8005</span>
                    </span>
                  }
                  @default {
                    <span class="vip-tag vip-tag-bronze">
                      <span class="vip-icon">\u2694\uFE0F</span>
                      <span class="vip-text">\u9752\u9285\u6230\u58EB</span>
                    </span>
                  }
                }
              </div>
            </div>
            
            <!-- \u7BAD\u982D -->
            <div class="arrow-icon transition-transform duration-300 group-hover:translate-x-1">
              <svg class="w-4 h-4" style="color: var(--text-muted);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
          </div>
        </div>
      </div>
      
      <!-- \u53EF\u6EFE\u52D5\u7684\u5C0E\u822A\u5340\u57DF -->
      <nav class="flex-1 overflow-y-auto overflow-x-hidden sidebar-nav mt-2 px-2 pb-2">
        @let view = currentView();
        
        <!-- \u6703\u54E1\u4E2D\u5FC3\uFF08\u79FB\u5230\u7B2C\u4E00\u500B\uFF09 -->
        <a (click)="changeView('membership-center')" 
           class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-md transition-all duration-200 cursor-pointer mb-1"
           [class.active]="view === 'membership-center'"
           [style.background-color]="view === 'membership-center' ? 'var(--sidebar-item-active)' : 'transparent'"
           [style.color]="view === 'membership-center' ? 'var(--sidebar-text-active)' : 'var(--sidebar-text)'">
           <svg class="h-5 w-5 sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
           <span>\u6703\u54E1\u4E2D\u5FC3</span>
        </a>
        
        <!-- \u6211\u7684\u9322\u5305 -->
        <a (click)="changeView('wallet')" 
           class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-md transition-all duration-200 cursor-pointer mb-1"
           [class.active]="view === 'wallet'"
           [style.background-color]="view === 'wallet' ? 'var(--sidebar-item-active)' : 'transparent'"
           [style.color]="view === 'wallet' ? 'var(--sidebar-text-active)' : 'var(--sidebar-text)'">
           <svg class="h-5 w-5 sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
           <span>\u6211\u7684\u9322\u5305</span>
        </a>
        
        <!-- \u5100\u8868\u76E4 -->
        <a (click)="changeView('dashboard')" 
           class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-md transition-all duration-200 cursor-pointer mb-1"
           [class.active]="view === 'dashboard'"
           [style.background-color]="view === 'dashboard' ? 'var(--sidebar-item-active)' : 'transparent'"
           [style.color]="view === 'dashboard' ? 'var(--sidebar-text-active)' : 'var(--sidebar-text)'">
          <svg class="h-5 w-5 sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
          <span>{{ t('dashboard') }}</span>
        </a>
        
        <!-- \u5206\u7D44\uFF1A\u{1F527} \u624B\u52D5\u64CD\u4F5C\uFF08\u53EF\u6298\u758A\uFF09 -->
        <div class="sidebar-group">
          <button (click)="toggleSidebarGroup('manual')" 
                  class="w-full flex items-center justify-between px-3 py-2 mt-2 rounded-md hover:bg-white/5 transition-colors cursor-pointer group">
            <span class="sidebar-group-title text-xs uppercase tracking-wider flex items-center gap-1" style="color: var(--sidebar-group-title);">
              \u{1F527} \u624B\u52D5\u64CD\u4F5C
            </span>
            <svg class="w-3.5 h-3.5 transition-transform duration-200" 
                 [class.rotate-180]="!isSidebarGroupExpanded('manual')"
                 style="color: var(--sidebar-group-title);" 
                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          
          @if (isSidebarGroupExpanded('manual')) {
            <div class="sidebar-group-content overflow-hidden">
              <!-- \u5E33\u865F\u7BA1\u7406 -->
              <a (click)="changeView('accounts')" 
                 data-tour="accounts"
                 class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-md transition-all duration-200 cursor-pointer mb-1"
                 [class.active]="view === 'accounts' || view === 'add-account' || view === 'api-credentials'"
                 [style.background-color]="(view === 'accounts' || view === 'add-account' || view === 'api-credentials') ? 'var(--sidebar-item-active)' : 'transparent'"
                 [style.color]="(view === 'accounts' || view === 'add-account' || view === 'api-credentials') ? 'var(--sidebar-text-active)' : 'var(--sidebar-text)'">
                 <svg class="h-5 w-5 sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                 <span>{{ t('accounts') }}</span>
              </a>
              
              <!-- \u{1F50D} \u641C\u7D22\u767C\u73FE (\u7368\u7ACB\u9801\u9762) -->
              <a (click)="changeView('search-discovery')" 
                 data-tour="search-discovery"
                 class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-md transition-all duration-200 cursor-pointer mb-1 relative"
                 [class.active]="view === 'search-discovery'"
                 [style.background-color]="view === 'search-discovery' ? 'rgba(6, 182, 212, 0.2)' : 'transparent'"
                 [style.color]="view === 'search-discovery' ? '#22d3ee' : 'var(--sidebar-text)'">
                 <svg class="h-5 w-5 sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                 <span>\u641C\u7D22\u767C\u73FE</span>
                 <span class="absolute right-2 px-1.5 py-0.5 text-[10px] bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-full font-bold">NEW</span>
              </a>
              
              <!-- \u{1F4E6} \u8CC7\u6E90\u4E2D\u5FC3 (\u6211\u7684\u8CC7\u6E90 + \u7D71\u8A08) -->
              <a (click)="changeView('resource-center')" 
                 class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-md transition-all duration-200 cursor-pointer mb-1 relative"
                 [class.active]="view === 'resource-center' || view === 'resources'"
                 [style.background-color]="(view === 'resource-center' || view === 'resources') ? 'rgba(6, 182, 212, 0.2)' : 'transparent'"
                 [style.color]="(view === 'resource-center' || view === 'resources') ? '#22d3ee' : 'var(--sidebar-text)'">
                 <svg class="h-5 w-5 sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>
                 <span>\u8CC7\u6E90\u4E2D\u5FC3</span>
              </a>
              
              <!-- \u{1F4E4} \u767C\u9001\u63A7\u5236\u53F0 -->
              <a (click)="changeView('leads')" 
                 class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-md transition-all duration-200 cursor-pointer mb-1"
                 [class.active]="view === 'leads'"
                 [style.background-color]="view === 'leads' ? 'var(--sidebar-item-active)' : 'transparent'"
                 [style.color]="view === 'leads' ? 'var(--sidebar-text-active)' : 'var(--sidebar-text)'">
                 <svg class="h-5 w-5 sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13"/><path d="M22 2L15 22L11 13L2 9L22 2Z"/></svg>
                 <span>\u767C\u9001\u63A7\u5236\u53F0</span>
              </a>
            </div>
          }
        </div>
        
        <!-- \u5206\u7D44\uFF1A\u{1F4E1} \u76E3\u63A7\u4E2D\u5FC3\uFF08\u53EF\u6298\u758A\uFF09 -->
        <div class="sidebar-group">
          <button (click)="toggleSidebarGroup('monitoring')" 
                  class="w-full flex items-center justify-between px-3 py-2 mt-2 rounded-md hover:bg-white/5 transition-colors cursor-pointer group">
            <span class="sidebar-group-title text-xs uppercase tracking-wider font-semibold flex items-center gap-1" style="color: var(--sidebar-group-title);">
              <span class="inline-block w-5 h-5 rounded bg-gradient-to-br from-cyan-500 to-blue-500 text-center leading-5 text-[10px]">\u{1F4E1}</span>
              \u76E3\u63A7\u4E2D\u5FC3
            </span>
            <svg class="w-3.5 h-3.5 transition-transform duration-200" 
                 [class.rotate-180]="!isSidebarGroupExpanded('monitoring')"
                 style="color: var(--sidebar-group-title);" 
                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          
          @if (isSidebarGroupExpanded('monitoring')) {
            <div class="sidebar-group-content overflow-hidden">
              <!-- \u2699\uFE0F \u81EA\u52D5\u5316\u7E3D\u89BD -->
              <a (click)="changeView('automation')" 
                 class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200 cursor-pointer mb-1 relative group"
                 [class.active]="view === 'automation'"
                 [style.background-color]="view === 'automation' ? 'rgba(6, 182, 212, 0.15)' : 'transparent'"
                 [style.color]="view === 'automation' ? '#22d3ee' : 'var(--sidebar-text)'">
                  <div class="w-8 h-8 rounded-lg flex items-center justify-center transition-all"
                       [class.bg-gradient-to-br]="view === 'automation'"
                       [class.from-cyan-500]="view === 'automation'"
                       [class.to-blue-500]="view === 'automation'"
                       [class.bg-slate-700/50]="view !== 'automation'"
                       [class.group-hover:bg-slate-700]="view !== 'automation'">
                     <span class="text-lg">\u{1F4CA}</span>
                  </div>
                  <div class="flex flex-col">
                     <span class="font-medium">\u81EA\u52D5\u5316\u7E3D\u89BD</span>
                     <span class="text-[10px] opacity-60">\u914D\u7F6E\u8207\u76E3\u63A7\u72C0\u614B</span>
                  </div>
              </a>
              
              <!-- \u{1F4F1} \u76E3\u63A7\u5E33\u865F -->
              <a (click)="changeView('monitoring-accounts')" 
                 class="sidebar-item flex items-center gap-3 px-3 py-2 rounded-md transition-all duration-200 cursor-pointer mb-1"
                 [class.active]="view === 'monitoring-accounts'"
                 [style.background-color]="view === 'monitoring-accounts' ? 'rgba(6, 182, 212, 0.1)' : 'transparent'"
                 [style.color]="view === 'monitoring-accounts' ? '#22d3ee' : 'var(--sidebar-text)'">
                 <span class="text-lg ml-1">\u{1F4F1}</span>
                 <span>\u76E3\u63A7\u5E33\u865F</span>
              </a>
              
              <!-- \u{1F4AC} \u76E3\u63A7\u7FA4\u7D44 -->
              <a (click)="changeView('monitoring-groups')" 
                 class="sidebar-item flex items-center gap-3 px-3 py-2 rounded-md transition-all duration-200 cursor-pointer mb-1"
                 [class.active]="view === 'monitoring-groups'"
                 [style.background-color]="view === 'monitoring-groups' ? 'rgba(16, 185, 129, 0.1)' : 'transparent'"
                 [style.color]="view === 'monitoring-groups' ? '#34d399' : 'var(--sidebar-text)'">
                 <span class="text-lg ml-1">\u{1F4AC}</span>
                 <span>\u76E3\u63A7\u7FA4\u7D44</span>
              </a>
              
              <!-- \u{1F511} \u95DC\u9375\u8A5E\u96C6 -->
              <a (click)="changeView('keyword-sets')" 
                 class="sidebar-item flex items-center gap-3 px-3 py-2 rounded-md transition-all duration-200 cursor-pointer mb-1"
                 [class.active]="view === 'keyword-sets'"
                 [style.background-color]="view === 'keyword-sets' ? 'rgba(139, 92, 246, 0.1)' : 'transparent'"
                 [style.color]="view === 'keyword-sets' ? '#a78bfa' : 'var(--sidebar-text)'">
                 <span class="text-lg ml-1">\u{1F511}</span>
                 <span>\u95DC\u9375\u8A5E\u96C6</span>
              </a>
              
              <!-- \u{1F4DD} \u804A\u5929\u6A21\u677F -->
              <a (click)="changeView('chat-templates')" 
                 class="sidebar-item flex items-center gap-3 px-3 py-2 rounded-md transition-all duration-200 cursor-pointer mb-1"
                 [class.active]="view === 'chat-templates'"
                 [style.background-color]="view === 'chat-templates' ? 'rgba(236, 72, 153, 0.1)' : 'transparent'"
                 [style.color]="view === 'chat-templates' ? '#f472b6' : 'var(--sidebar-text)'">
                 <span class="text-lg ml-1">\u{1F4DD}</span>
                 <span>\u804A\u5929\u6A21\u677F</span>
              </a>
              
              <!-- \u26A1 \u89F8\u767C\u898F\u5247 -->
              <a (click)="changeView('trigger-rules')" 
                 class="sidebar-item flex items-center gap-3 px-3 py-2 rounded-md transition-all duration-200 cursor-pointer mb-1"
                 [class.active]="view === 'trigger-rules'"
                 [style.background-color]="view === 'trigger-rules' ? 'rgba(251, 146, 60, 0.1)' : 'transparent'"
                 [style.color]="view === 'trigger-rules' ? '#fb923c' : 'var(--sidebar-text)'">
                 <span class="text-lg ml-1">\u26A1</span>
                 <span>\u89F8\u767C\u898F\u5247</span>
              </a>
              
              <!-- \u{1F465} \u6536\u96C6\u7528\u6236\uFF08\u5EE3\u544A\u8B58\u5225\uFF09 -->
              <a (click)="changeView('collected-users')" 
                 class="sidebar-item flex items-center gap-3 px-3 py-2 rounded-md transition-all duration-200 cursor-pointer mb-1"
                 [class.active]="view === 'collected-users'"
                 [style.background-color]="view === 'collected-users' ? 'rgba(139, 92, 246, 0.1)' : 'transparent'"
                 [style.color]="view === 'collected-users' ? '#a78bfa' : 'var(--sidebar-text)'">
                 <span class="text-lg ml-1">\u{1F465}</span>
                 <span>\u6536\u96C6\u7528\u6236</span>
                 <span class="ml-auto text-xs px-1.5 py-0.5 bg-violet-500/20 text-violet-400 rounded">NEW</span>
              </a>
            </div>
          }
        </div>
        
        <!-- \u5206\u7D44\uFF1AAI \u667A\u80FD\u71DF\u92B7\uFF08\u53EF\u6298\u758A\uFF09 -->
        <div class="sidebar-group">
          <button (click)="toggleSidebarGroup('marketing')" 
                  class="w-full flex items-center justify-between px-3 py-2 mt-2 rounded-md hover:bg-white/5 transition-colors cursor-pointer group">
            <span class="sidebar-group-title text-xs uppercase tracking-wider font-semibold flex items-center gap-1" style="color: var(--sidebar-group-title);">
              <span class="inline-block w-5 h-5 rounded bg-gradient-to-br from-violet-500 to-fuchsia-500 text-center leading-5 text-[10px]">AI</span>
              \u667A\u80FD\u71DF\u92B7
            </span>
            <svg class="w-3.5 h-3.5 transition-transform duration-200" 
                 [class.rotate-180]="!isSidebarGroupExpanded('marketing')"
                 style="color: var(--sidebar-group-title);" 
                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          
          @if (isSidebarGroupExpanded('marketing')) {
            <div class="sidebar-group-content overflow-hidden">
              <!-- 1\uFE0F\u20E3 AI \u71DF\u92B7\u52A9\u624B (\u7B2C\u4E00\u6B65\uFF1A\u7B56\u5283) - \u947D\u77F3\u529F\u80FD -->
              <a (click)="changeView('ai-assistant')" 
           data-tour="ai-assistant"
           class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200 cursor-pointer mb-1.5 relative group"
           [class.active]="view === 'ai-assistant'"
           [class.opacity-50]="!membershipService.hasFeature('strategyPlanning')"
           [style.background-color]="view === 'ai-assistant' ? 'rgba(249, 115, 22, 0.15)' : 'transparent'"
           [style.color]="view === 'ai-assistant' ? '#fb923c' : 'var(--sidebar-text)'"
           [title]="!membershipService.hasFeature('strategyPlanning') ? '\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1' : ''">
           <div class="w-8 h-8 rounded-lg flex items-center justify-center transition-all"
                [class.bg-gradient-to-br]="view === 'ai-assistant'"
                [class.from-orange-500]="view === 'ai-assistant'"
                [class.to-amber-500]="view === 'ai-assistant'"
                [class.bg-slate-700/50]="view !== 'ai-assistant'"
                [class.group-hover:bg-slate-700]="view !== 'ai-assistant'">
             <span class="text-lg">\u{1F3AF}</span>
           </div>
           <div class="flex flex-col">
             <span class="font-medium">\u7B56\u7565\u898F\u5283</span>
             <span class="text-[10px] opacity-60">AI \u71DF\u92B7\u52A9\u624B</span>
           </div>
           @if (membershipService.hasFeature('strategyPlanning')) {
             <span class="absolute right-2 px-2 py-0.5 text-[9px] bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-full font-bold shadow-lg shadow-orange-500/20">1</span>
           } @else {
             <span class="absolute right-2 text-xs">\u{1F48E}</span>
           }
        </a>
        
        <!-- 2\uFE0F\u20E3 AI \u5718\u968A\u92B7\u552E (\u7B2C\u4E8C\u6B65\uFF1A\u57F7\u884C) - \u947D\u77F3\u529F\u80FD -->
        <a (click)="changeView('ai-team')" 
           class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200 cursor-pointer mb-1.5 relative group"
           [class.active]="view === 'ai-team'"
           [class.opacity-50]="!membershipService.hasFeature('autoExecution')"
           [style.background-color]="view === 'ai-team' ? 'rgba(168, 85, 247, 0.15)' : 'transparent'"
           [style.color]="view === 'ai-team' ? '#c084fc' : 'var(--sidebar-text)'"
           [title]="!membershipService.hasFeature('autoExecution') ? '\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1' : ''">
           <div class="w-8 h-8 rounded-lg flex items-center justify-center transition-all"
                [class.bg-gradient-to-br]="view === 'ai-team'"
                [class.from-purple-500]="view === 'ai-team'"
                [class.to-pink-500]="view === 'ai-team'"
                [class.bg-slate-700/50]="view !== 'ai-team'"
                [class.group-hover:bg-slate-700]="view !== 'ai-team'">
             <span class="text-lg">\u{1F916}</span>
           </div>
           <div class="flex flex-col">
             <span class="font-medium">\u81EA\u52D5\u57F7\u884C</span>
             <span class="text-[10px] opacity-60">AI \u5718\u968A\u92B7\u552E</span>
           </div>
           @if (membershipService.hasFeature('autoExecution')) {
             <span class="absolute right-2 px-2 py-0.5 text-[9px] bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full font-bold shadow-lg shadow-purple-500/20">2</span>
           } @else {
             <span class="absolute right-2 text-xs">\u{1F48E}</span>
           }
        </a>
        
        <!-- 3\uFE0F\u20E3 \u667A\u80FD\u5206\u6790 (\u7B2C\u4E09\u6B65\uFF1A\u5206\u6790) - \u9EC3\u91D1\u529F\u80FD -->
        <a (click)="changeView('analytics')" 
           class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200 cursor-pointer mb-1.5 relative group"
           [class.active]="view === 'analytics'"
           [class.opacity-50]="!membershipService.hasFeature('dataInsightsBasic')"
           [style.background-color]="view === 'analytics' ? 'rgba(6, 182, 212, 0.15)' : 'transparent'"
           [style.color]="view === 'analytics' ? '#22d3ee' : 'var(--sidebar-text)'"
           [title]="!membershipService.hasFeature('dataInsightsBasic') ? '\u9700\u8981 \u9EC3\u91D1\u5927\u5E2B \u6216\u4EE5\u4E0A\u6703\u54E1' : ''">
           <div class="w-8 h-8 rounded-lg flex items-center justify-center transition-all"
                [class.bg-gradient-to-br]="view === 'analytics'"
                [class.from-cyan-500]="view === 'analytics'"
                [class.to-blue-500]="view === 'analytics'"
                [class.bg-slate-700/50]="view !== 'analytics'"
                [class.group-hover:bg-slate-700]="view !== 'analytics'">
             <span class="text-lg">\u{1F4CA}</span>
           </div>
           <div class="flex flex-col">
             <span class="font-medium">\u6578\u64DA\u6D1E\u5BDF</span>
             <span class="text-[10px] opacity-60">\u667A\u80FD\u5206\u6790\u5831\u544A</span>
           </div>
           @if (membershipService.hasFeature('dataInsightsBasic')) {
                 <span class="absolute right-2 px-2 py-0.5 text-[9px] bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-full font-bold shadow-lg shadow-cyan-500/20">3</span>
               } @else {
                 <span class="absolute right-2 text-xs">\u{1F947}</span>
               }
              </a>
            </div>
          }
        </div>
        
        <!-- \u5206\u7D44\uFF1A\u{1F4CA} \u6578\u64DA\u5206\u6790\uFF08\u53EF\u6298\u758A\uFF09 -->
        <div class="sidebar-group">
          <button (click)="toggleSidebarGroup('analytics')" 
                  class="w-full flex items-center justify-between px-3 py-2 mt-2 rounded-md hover:bg-white/5 transition-colors cursor-pointer group">
            <span class="sidebar-group-title text-xs uppercase tracking-wider flex items-center gap-1" style="color: var(--sidebar-group-title);">
              \u{1F4CA} \u6578\u64DA\u5206\u6790
            </span>
            <svg class="w-3.5 h-3.5 transition-transform duration-200" 
                 [class.rotate-180]="!isSidebarGroupExpanded('analytics')"
                 style="color: var(--sidebar-group-title);" 
                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          
          @if (isSidebarGroupExpanded('analytics')) {
            <div class="sidebar-group-content overflow-hidden">
              <!-- \u5206\u6790\u4E2D\u5FC3 (\u8A73\u7D30\u6578\u64DA) -->
              <a (click)="changeView('analytics-center')"
                 class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-md transition-all duration-200 cursor-pointer mb-1"
                 [class.active]="view === 'analytics-center' || view === 'nurturing-analytics'"
                 [style.background-color]="(view === 'analytics-center' || view === 'nurturing-analytics') ? 'rgba(6, 182, 212, 0.15)' : 'transparent'"
                 [style.color]="(view === 'analytics-center' || view === 'nurturing-analytics') ? '#22d3ee' : 'var(--sidebar-text)'">
                 <svg class="h-5 w-5 sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-6"/></svg>
                 <span>\u5206\u6790\u4E2D\u5FC3</span>
              </a>
              
              <!-- \u5BA2\u6236\u57F9\u80B2 (\u4FDD\u7559 AI \u8DDF\u9032\u529F\u80FD) -->
              <a (click)="changeView('lead-nurturing')"
                 class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-md transition-all duration-200 cursor-pointer mb-1"
                 [class.active]="view === 'lead-nurturing'"
                 [style.background-color]="view === 'lead-nurturing' ? 'rgba(236, 72, 153, 0.15)' : 'transparent'"
                 [style.color]="view === 'lead-nurturing' ? '#f472b6' : 'var(--sidebar-text)'">
                 <svg class="h-5 w-5 sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/><circle cx="12" cy="12" r="4"/></svg>
                 <span>\u5BA2\u6236\u57F9\u80B2</span>
                 <span class="ml-auto px-1.5 py-0.5 text-xs bg-pink-500/20 text-pink-400 rounded">AI</span>
              </a>
              
              <!-- \u591A\u89D2\u8272\u5354\u4F5C (\u9032\u968E\u8A2D\u7F6E) -->
              <a (click)="changeView('multi-role'); loadMultiRoleData()" 
                 class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-md transition-all duration-200 cursor-pointer mb-1"
                 [class.active]="view === 'multi-role'"
                 [class.opacity-50]="!membershipService.hasFeature('multiRole')"
                 [class.cursor-not-allowed]="!membershipService.hasFeature('multiRole')"
                 [style.background-color]="view === 'multi-role' ? 'rgba(99, 102, 241, 0.15)' : 'transparent'"
                 [style.color]="view === 'multi-role' ? '#a5b4fc' : (!membershipService.hasFeature('multiRole') ? 'var(--sidebar-text-muted)' : 'var(--sidebar-text)')"
                 [title]="!membershipService.hasFeature('multiRole') ? '\u9700\u8981 \u947D\u77F3\u738B\u724C \u6216\u4EE5\u4E0A\u6703\u54E1' : ''">
                 <svg class="h-5 w-5 sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                 <span>\u591A\u89D2\u8272\u5354\u4F5C</span>
                 @if (!membershipService.hasFeature('multiRole')) {
                   <span class="ml-auto text-xs opacity-60">\u{1F48E}</span>
                 }
              </a>
            </div>
          }
        </div>
        
        <!-- \u5206\u7D44\uFF1AAI \u667A\u80FD\uFF08\u53EF\u6298\u758A\uFF09 -->
        <div class="sidebar-group">
          <button (click)="toggleSidebarGroup('ai')" 
                  class="w-full flex items-center justify-between px-3 py-2 mt-2 rounded-md hover:bg-white/5 transition-colors cursor-pointer group">
            <span class="sidebar-group-title text-xs uppercase tracking-wider flex items-center gap-1" style="color: var(--sidebar-group-title);">
              \u{1F9E0} {{ t('aiIntelligence') }}
            </span>
            <svg class="w-3.5 h-3.5 transition-transform duration-200" 
                 [class.rotate-180]="!isSidebarGroupExpanded('ai')"
                 style="color: var(--sidebar-group-title);" 
                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          
          @if (isSidebarGroupExpanded('ai')) {
            <div class="sidebar-group-content overflow-hidden">
        
        <!-- \u{1F195} \u77E5\u8B58\u5927\u8166\uFF08\u53EF\u5C55\u958B\u83DC\u55AE\uFF09 -->
        <div class="knowledge-menu">
          <!-- \u4E3B\u83DC\u55AE\u9805 -->
          <a (click)="toggleKnowledgeMenu()" 
             class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-md transition-all duration-200 cursor-pointer mb-1"
             [class.active]="isKnowledgeView()"
             [style.background-color]="isKnowledgeView() ? 'rgba(236, 72, 153, 0.15)' : 'transparent'"
             [style.color]="isKnowledgeView() ? '#f472b6' : 'var(--sidebar-text)'">
             <span class="text-lg">\u{1F9E0}</span>
             <span class="flex-1">\u77E5\u8B58\u5927\u8166</span>
             <span class="text-xs transition-transform duration-200" [class.rotate-180]="knowledgeMenuExpanded()">\u25BC</span>
          </a>
          
          <!-- \u5B50\u83DC\u55AE\u9805 -->
          @if (knowledgeMenuExpanded()) {
            <div class="pl-6 space-y-1">
              <a (click)="changeView('knowledge-brain')" 
                 class="sidebar-item flex items-center gap-2 px-3 py-2 rounded-md transition-all duration-200 cursor-pointer text-sm"
                 [class.active]="view === 'knowledge-brain'"
                 [style.background-color]="view === 'knowledge-brain' ? 'rgba(236, 72, 153, 0.1)' : 'transparent'"
                 [style.color]="view === 'knowledge-brain' ? '#f472b6' : 'var(--sidebar-text-muted)'">
                 <span>\u{1F4CA}</span>
                 <span>\u7E3D\u89BD</span>
              </a>
              <a (click)="changeView('knowledge-manage')" 
                 class="sidebar-item flex items-center gap-2 px-3 py-2 rounded-md transition-all duration-200 cursor-pointer text-sm"
                 [class.active]="view === 'knowledge-manage'"
                 [style.background-color]="view === 'knowledge-manage' ? 'rgba(236, 72, 153, 0.1)' : 'transparent'"
                 [style.color]="view === 'knowledge-manage' ? '#f472b6' : 'var(--sidebar-text-muted)'">
                 <span>\u{1F4DD}</span>
                 <span>\u77E5\u8B58\u7BA1\u7406</span>
              </a>
              <a (click)="changeView('knowledge-gaps')" 
                 class="sidebar-item flex items-center gap-2 px-3 py-2 rounded-md transition-all duration-200 cursor-pointer text-sm relative"
                 [class.active]="view === 'knowledge-gaps'"
                 [style.background-color]="view === 'knowledge-gaps' ? 'rgba(236, 72, 153, 0.1)' : 'transparent'"
                 [style.color]="view === 'knowledge-gaps' ? '#f472b6' : 'var(--sidebar-text-muted)'">
                 <span>\u2753</span>
                 <span>\u77E5\u8B58\u7F3A\u53E3</span>
                 @if (ragBrainService.gapsCount() > 0) {
                   <span class="ml-auto text-xs font-bold rounded-full px-1.5 py-0.5" style="background-color: rgba(239, 68, 68, 0.2); color: #f87171;">{{ ragBrainService.gapsCount() }}</span>
                 }
              </a>
            </div>
          }
        </div>
        
              <!-- AI \u4E2D\u5FC3\uFF08\u6A21\u578B\u914D\u7F6E\uFF09 -->
              <a (click)="changeView('ai-center')" 
                 class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-md transition-all duration-200 cursor-pointer mb-1"
                 [class.active]="view === 'ai-center'"
                 [style.background-color]="view === 'ai-center' ? 'rgba(168, 85, 247, 0.15)' : 'transparent'"
                 [style.color]="view === 'ai-center' ? '#c084fc' : 'var(--sidebar-text)'">
                 <svg class="h-5 w-5 sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m9 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"></path></svg>
                 <span>{{ t('aiCenter') }}</span>
              </a>
            </div>
          }
        </div>
        
        <!-- \u5206\u7D44\uFF1A\u7CFB\u7D71\u76E3\u63A7\uFF08\u53EF\u6298\u758A\uFF09 -->
        <div class="sidebar-group">
          <button (click)="toggleSidebarGroup('system')" 
                  class="w-full flex items-center justify-between px-3 py-2 mt-2 rounded-md hover:bg-white/5 transition-colors cursor-pointer group">
            <span class="sidebar-group-title text-xs uppercase tracking-wider flex items-center gap-1" style="color: var(--sidebar-group-title);">
              \u2699\uFE0F {{ t('systemMonitor') }}
            </span>
            <svg class="w-3.5 h-3.5 transition-transform duration-200" 
                 [class.rotate-180]="!isSidebarGroupExpanded('system')"
                 style="color: var(--sidebar-group-title);" 
                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          
          @if (isSidebarGroupExpanded('system')) {
            <div class="sidebar-group-content overflow-hidden">
              <!-- \u8A2D\u7F6E -->
              <a (click)="changeView('settings')" 
                 class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-md transition-all duration-200 cursor-pointer mb-1"
                 [class.active]="view === 'settings'"
                 [style.background-color]="view === 'settings' ? 'var(--sidebar-item-active)' : 'transparent'"
                 [style.color]="view === 'settings' ? 'var(--sidebar-text-active)' : 'var(--sidebar-text)'">
                 <svg class="h-5 w-5 sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                 <span>{{ t('settings') }}</span>
              </a>
            </div>
          }
        </div>
      </nav>
    
    <!-- \u5074\u908A\u6B04\u5E95\u90E8\uFF08\u56FA\u5B9A\u5728\u5E95\u90E8\uFF09 -->
    <div class="flex-shrink-0 p-4 space-y-3 border-t" style="border-color: var(--border-default); background-color: var(--bg-sidebar);">
        <!-- \u{1F195} \u5E2E\u52A9\u6309\u94AE - \u6253\u5F00\u65B0\u624B\u5F15\u5BFC -->
        <button (click)="openOnboarding()"
                class="w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-cyan-500/10 to-blue-500/10 hover:from-cyan-500/20 hover:to-blue-500/20 border border-cyan-500/30 hover:border-cyan-500/50 text-cyan-400 rounded-xl transition-all text-sm font-medium group">
          <span class="text-lg group-hover:animate-bounce">\u2753</span>
          <span>\u4F7F\u7528\u5E2E\u52A9</span>
        </button>
        
        <div>
          <label class="block text-sm font-medium mb-2" style="color: var(--sidebar-group-title);">{{ t('language') }}</label>
          <app-language-switcher-compact></app-language-switcher-compact>
        </div>
        <div>
          <label class="block text-sm font-medium mb-2" style="color: var(--sidebar-group-title);">{{ t('appearance') }}</label>
          <div class="flex rounded-md shadow-sm p-1" style="background-color: var(--bg-tertiary);">
            <button (click)="theme.set('light')" 
                    class="w-full text-sm py-1.5 rounded transition-colors flex items-center justify-center gap-2"
                    [style.background-color]="theme() === 'light' ? 'var(--bg-card)' : 'transparent'"
                    [style.color]="theme() === 'light' ? 'var(--primary)' : 'var(--text-muted)'"
                    [style.box-shadow]="theme() === 'light' ? 'var(--shadow-sm)' : 'none'">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
              </svg>
            </button>
            <button (click)="theme.set('dark')" 
                    class="w-full text-sm py-1.5 rounded transition-colors flex items-center justify-center gap-2"
                    [style.background-color]="theme() === 'dark' ? 'var(--primary-bg)' : 'transparent'"
                    [style.color]="theme() === 'dark' ? 'var(--primary)' : 'var(--text-muted)'"
                    [style.box-shadow]="theme() === 'dark' ? 'var(--shadow-sm)' : 'none'">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
              </svg>
            </button>
          </div>
        </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-8 overflow-y-auto" style="background-color: var(--bg-primary);">
    <!-- \u4F7F\u7528 @switch \u63A7\u5236\u8996\u5716\uFF08\u66AB\u6642\u7981\u7528 Angular Router\uFF09 -->
    @switch (currentView()) {
      @case ('dashboard') {
        <app-dashboard-view></app-dashboard-view>
      }
      @case ('accounts') {
        <app-accounts-view></app-accounts-view>
      }
      @case ('add-account') {
        <app-add-account-page (accountAdded)="onAccountAdded($event)" (back)="changeView('accounts')"></app-add-account-page>
      }
      @case ('api-credentials') {
        <app-api-credentials-view></app-api-credentials-view>
      }
      @case ('settings') {
        <app-settings-view></app-settings-view>
      }
      @case ('leads') {
        <app-leads-view></app-leads-view>
      }
      @case ('automation') {
        <app-automation-view></app-automation-view>
      }
      @case ('resource-discovery') {
        <app-resource-discovery-view></app-resource-discovery-view>
      }
      @case ('resources') {
        <app-resource-discovery-view></app-resource-discovery-view>
      }
      @case ('ai-center') {
        <app-ai-center-view></app-ai-center-view>
      }
      @case ('knowledge-brain') {
        <!-- \u{1F195} \u77E5\u8B58\u5927\u8166\u7368\u7ACB\u9801\u9762 -->
        <div class="h-full p-6 overflow-auto">
          <app-ai-brain></app-ai-brain>
        </div>
      }
      @case ('knowledge-gaps') {
        <!-- \u{1F195} \u77E5\u8B58\u7F3A\u53E3\u7368\u7ACB\u9801\u9762 -->
        <div class="h-full overflow-auto">
          <app-knowledge-gaps></app-knowledge-gaps>
        </div>
      }
      @case ('knowledge-manage') {
        <!-- \u{1F195} \u77E5\u8B58\u7BA1\u7406\u9801\u9762 -->
        <div class="h-full overflow-auto">
          <app-knowledge-manage></app-knowledge-manage>
        </div>
      }
      @case ('multi-role') {
        <app-multi-role-view></app-multi-role-view>
      }
      @case ('analytics') {
        <app-analytics-view></app-analytics-view>
      }
      @case ('monitoring') {
        <app-monitoring-view></app-monitoring-view>
      }
      @case ('monitoring-accounts') {
        <app-monitoring-view></app-monitoring-view>
      }
      @case ('monitoring-groups') {
        <app-monitoring-view></app-monitoring-view>
      }
      @case ('keyword-sets') {
        <app-monitoring-view></app-monitoring-view>
      }
      @case ('chat-templates') {
        <app-monitoring-view></app-monitoring-view>
      }
      @case ('trigger-rules') {
        <app-monitoring-view></app-monitoring-view>
      }
      @case ('collected-users') {
        <app-monitoring-view></app-monitoring-view>
      }
      @case ('runtime-logs') {
        <app-runtime-logs-view></app-runtime-logs-view>
      }
      <!-- \u{1F195} Phase P0: \u88DC\u5168\u7F3A\u5931\u7684\u8996\u5716 -->
      @case ('membership-center') {
        <app-membership-center></app-membership-center>
      }
      @case ('wallet') {
        <app-wallet-view></app-wallet-view>
      }
      @case ('profile') {
        <app-profile></app-profile>
      }
      @case ('resource-center') {
        <app-resource-center></app-resource-center>
      }
      @case ('search-discovery') {
        <app-search-discovery></app-search-discovery>
      }
      @case ('ai-assistant') {
        <app-ai-marketing-assistant></app-ai-marketing-assistant>
      }
      @case ('ai-team') {
        <app-ai-team-hub></app-ai-team-hub>
      }
      @case ('member-database') {
        <app-member-database></app-member-database>
      }
      @case ('lead-nurturing') {
        <app-leads-view></app-leads-view>
      }
      @case ('nurturing-analytics') {
        <app-analytics-view></app-analytics-view>
      }
      @case ('user-tracking') {
        <app-analytics-view></app-analytics-view>
      }
      @case ('ads') {
        <app-automation-view></app-automation-view>
      }
      @case ('campaigns') {
        <app-automation-view></app-automation-view>
      }
      @case ('analytics-center') {
        <app-analytics-view></app-analytics-view>
      }
      @case ('marketing-report') {
        <app-marketing-report></app-marketing-report>
      }
      @case ('performance') {
        <app-runtime-logs-view></app-runtime-logs-view>
      }
      @case ('alerts') {
        <app-runtime-logs-view></app-runtime-logs-view>
      }
      @case ('logs') {
        <app-runtime-logs-view></app-runtime-logs-view>
      }
      @default {
        <app-dashboard-view></app-dashboard-view>
      }
    }
  </main>

  <!-- Lead Detail Modal - \u5BA2\u6236\u64CD\u4F5C\u4E2D\u5FC3 -->
  @if (generationState().lead; as lead) {
    <div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50" (click)="closeLeadDetailModal()">
      <div class="bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800 border border-cyan-500/30 rounded-2xl shadow-2xl shadow-cyan-500/10 w-full max-w-2xl max-h-[90vh] overflow-hidden text-slate-200" (click)="$event.stopPropagation()">
        
        <!-- \u5BA2\u6236\u4FE1\u606F\u982D\u90E8 -->
        <div class="bg-gradient-to-r from-cyan-500/10 via-blue-500/10 to-purple-500/10 border-b border-cyan-500/20 p-5">
          <div class="flex justify-between items-start">
            <div class="flex items-center gap-4">
              <!-- \u982D\u50CF -->
              <div class="w-14 h-14 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-cyan-500/30">
                {{ (lead.username || lead.firstName || lead.userId || '?')[0].toUpperCase() }}
              </div>
              <!-- \u7528\u6236\u4FE1\u606F -->
              <div>
                <div class="flex items-center gap-2">
                  <h3 class="text-xl font-bold text-white">
                    @if(lead.username) { @{{ lead.username }} }
                    @else if(lead.firstName) { {{ lead.firstName }} {{ lead.lastName || '' }} }
                    @else { ID: {{ lead.userId | slice:0:12 }} }
                  </h3>
                  <span class="h-2.5 w-2.5 rounded-full animate-pulse" [class]="getOnlineStatusColor(lead.onlineStatus)"></span>
                </div>
                @if(lead.phone) {
                  <p class="text-sm text-cyan-400">\u{1F4F1} {{ lead.phone }}</p>
                }
                <div class="flex items-center gap-2 mt-1 flex-wrap">
                  @if(lead.sourceGroup) {
                    <span class="text-xs px-2 py-0.5 rounded-full bg-purple-500/20 text-purple-400 border border-purple-500/30">\u{1F4CD} {{ lead.sourceGroup | slice:0:20 }}</span>
                  }
                  @if(lead.triggeredKeyword && lead.triggeredKeyword !== '\u7121') {
                    <span class="text-xs px-2 py-0.5 rounded-full bg-cyan-500/20 text-cyan-400 border border-cyan-500/30">\u{1F511} {{ lead.triggeredKeyword | slice:0:15 }}</span>
                  }
                  @if(lead.intentLevel) {
                    <span class="text-xs px-2 py-0.5 rounded-full" [class]="getIntentLevelColor(lead.intentLevel)">{{ getIntentLevelEmoji(lead.intentLevel) }} {{ t(lead.intentLevel) }}</span>
                  }
                </div>
              </div>
            </div>
            <button (click)="closeLeadDetailModal()" class="text-slate-400 hover:text-white text-2xl leading-none transition-colors p-2 hover:bg-white/10 rounded-lg">\u2715</button>
          </div>
        </div>

        <!-- Tab \u5C0E\u822A -->
        <div class="border-b border-cyan-500/20 bg-slate-900/50">
          <nav class="flex px-5" aria-label="Tabs">
            <a (click)="leadDetailView.set('sendMessage')" 
               [class.border-cyan-400]="leadDetailView() === 'sendMessage'" 
               [class.text-cyan-400]="leadDetailView() === 'sendMessage'" 
               [class.bg-cyan-500/10]="leadDetailView() === 'sendMessage'"
               class="whitespace-nowrap py-3 px-4 border-b-2 border-transparent font-medium text-sm cursor-pointer text-slate-400 hover:text-cyan-400 hover:bg-cyan-500/5 transition-all rounded-t-lg flex items-center gap-2">
              \u{1F4AC} {{ t('sendMessageTab') }}
            </a>
            <a (click)="leadDetailView.set('history')" 
               [class.border-cyan-400]="leadDetailView() === 'history'" 
               [class.text-cyan-400]="leadDetailView() === 'history'"
               [class.bg-cyan-500/10]="leadDetailView() === 'history'"
               class="whitespace-nowrap py-3 px-4 border-b-2 border-transparent font-medium text-sm cursor-pointer text-slate-400 hover:text-cyan-400 hover:bg-cyan-500/5 transition-all rounded-t-lg flex items-center gap-2">
              \u{1F4CB} {{ t('historyTab') }}
            </a>
          </nav>
        </div>
        
        <!-- \u5167\u5BB9\u5340\u57DF - \u53EF\u6EFE\u52D5 -->
        <div class="overflow-y-auto max-h-[calc(90vh-220px)] p-5">
        @if(leadDetailView() === 'sendMessage') {
            <div class="space-y-4">
              <!-- \u767C\u9001\u5E33\u865F\u9078\u64C7\u5668 -->
              <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700/50">
                <label class="block text-sm font-medium text-cyan-400 mb-2">\u{1F4E4} {{ t('selectSenderAccount') }}</label>
                <select 
                    [ngModel]="selectedSenderId()" 
                    (ngModelChange)="selectedSenderId.set($event)"
                    class="form-select w-full bg-slate-900/50 border-cyan-500/30 rounded-lg py-2.5 px-3 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                    @if(senderAccounts().length === 0) {
                        <option value="">{{ t('noSenderAccounts') }}</option>
                    } @else {
                        <option value="">\u9078\u64C7\u767C\u9001\u5E33\u865F...</option>
                        @for(account of senderAccounts(); track account.id) {
                            <option [value]="account.id">{{ account.phone }} ({{ account.username || t(account.status) }})</option>
                        }
                    }
                </select>
                @if(senderAccounts().length === 0) {
                    <div class="mt-2 p-2 bg-amber-500/10 border border-amber-500/30 rounded-lg">
                      <p class="text-xs text-amber-400">\u26A0\uFE0F {{ t('noSenderAccountsHint') }}</p>
                      <a (click)="currentView.set('accounts'); closeLeadDetailModal()" class="text-xs text-cyan-400 hover:underline cursor-pointer mt-1 inline-block">\u524D\u5F80\u5E33\u865F\u7BA1\u7406 \u2192</a>
                    </div>
                }
              </div>

              <!-- \u6D88\u606F\u8F38\u5165\u65B9\u5F0F\u9078\u64C7 - \u9752\u85CD\u8272\u4E3B\u984C\u5361\u7247\u5F0F -->
              <div class="grid grid-cols-3 gap-3">
                <label (click)="messageMode.set('manual')"
                       class="cursor-pointer p-3 rounded-xl border-2 transition-all text-center"
                       [class]="messageMode() === 'manual' ? 'bg-cyan-500/20 border-cyan-500 text-cyan-400' : 'bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30'">
                    <div class="text-2xl mb-1">\u{1F4DD}</div>
                    <span class="text-sm font-medium">{{ t('manualInput') }}</span>
                </label>
                <label (click)="messageMode.set('ai')"
                       class="cursor-pointer p-3 rounded-xl border-2 transition-all text-center"
                       [class]="messageMode() === 'ai' ? 'bg-gradient-to-br from-cyan-500/20 to-purple-500/20 border-cyan-500 text-cyan-400' : 'bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30'">
                    <div class="text-2xl mb-1">\u{1F916}</div>
                    <span class="text-sm font-medium">{{ t('aiGenerate') }}</span>
                </label>
                <label (click)="messageMode.set('template')"
                       class="cursor-pointer p-3 rounded-xl border-2 transition-all text-center"
                       [class]="messageMode() === 'template' ? 'bg-cyan-500/20 border-cyan-500 text-cyan-400' : 'bg-slate-800/50 border-slate-700/50 text-slate-400 hover:border-cyan-500/30'">
                    <div class="text-2xl mb-1">\u{1F4CB}</div>
                    <span class="text-sm font-medium">{{ t('useTemplate') }}</span>
                </label>
              </div>

              <!-- AI \u751F\u6210\u6A21\u5F0F -->
              @if(messageMode() === 'ai') {
                <div class="space-y-3">
                    <!-- AI \u914D\u7F6E\u72C0\u614B -->
                    <div class="flex items-center justify-between p-2 bg-slate-200/30 dark:bg-slate-800/30 rounded-lg">
                        <div class="flex items-center gap-2">
                            <span class="text-lg">\u{1F916}</span>
                            <span class="text-sm text-slate-400">
                                {{ aiApiType() === 'local' ? '\u672C\u5730 AI' : aiApiType() === 'openai' ? 'OpenAI' : aiApiType() === 'custom' ? '\u81EA\u5B9A\u7FA9 API' : 'Gemini' }}
                            </span>
                            @if(isAiConfigured()) {
                                <span class="text-xs text-green-400">\u2713 \u5DF2\u9023\u63A5</span>
                            }
                        </div>
                        @if(ragEnabled()) {
                            <span class="text-xs bg-purple-500/20 text-purple-400 px-2 py-1 rounded">\u{1F4DA} RAG \u5DF2\u555F\u7528</span>
                        }
                    </div>
                    
                    <!-- \u5BA2\u6236\u8CC7\u8A0A\u6458\u8981 -->
                    @if(generationState().lead) {
                        <div class="p-2 bg-cyan-500/10 border border-cyan-500/20 rounded-lg text-xs text-slate-400">
                            <strong class="text-cyan-400">\u5BA2\u6236\u8CC7\u8A0A\uFF1A</strong>
                            @{{ generationState().lead.username }} 
                            @if(generationState().lead.sourceGroup) { | \u4F86\u6E90: {{ generationState().lead.sourceGroup }} }
                            @if(generationState().lead.triggerKeyword) { | \u89F8\u767C\u8A5E: {{ generationState().lead.triggerKeyword }} }
                        </div>
                    }
                    
                    <!-- \u81EA\u5B9A\u7FA9\u63D0\u793A\u8A5E -->
                    <div>
                        <label class="block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1">{{ t('customizePrompt') }}</label>
                        <textarea 
                            [ngModel]="generationState().customPrompt" 
                            (ngModelChange)="updateCustomPrompt($event)"
                            rows="2" 
                            class="form-textarea w-full bg-slate-200/50 dark:bg-slate-800/50 border-slate-300 dark:border-slate-700 rounded-lg py-2 px-3 text-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"
                            [placeholder]="t('aiPromptPlaceholder')">
                        </textarea>
                    </div>
                    
                    <!-- \u751F\u6210\u6309\u9215 -->
                    <div class="flex items-center justify-center gap-3">
                        <button (click)="generateMessage()" [disabled]="generationState().status === 'loading' || !isAiConfigured()" class="bg-gradient-to-r from-purple-500 to-cyan-500 hover:from-purple-600 hover:to-cyan-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200 shadow-lg disabled:from-slate-400 disabled:to-slate-500 disabled:shadow-none disabled:cursor-not-allowed flex items-center gap-2">
                            @if(generationState().status === 'loading') { 
                                <span class="animate-spin">\u27F3</span> <span>{{ t('generating') }}</span> 
                            } @else { 
                                <span>\u2728</span> <span>{{ t('generateWithAi') }}</span> 
                            }
                        </button>
                        @if(generationState().status === 'success') {
                            <button (click)="generateMessage()" class="p-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg" title="\u91CD\u65B0\u751F\u6210">
                                \u{1F504}
                            </button>
                        }
                    </div>
                    
                    @if(!isAiConfigured()) {
                        <div class="p-3 bg-amber-500/10 border border-amber-500/20 text-amber-400 rounded-lg text-sm text-center">
                            \u26A0\uFE0F {{ t('aiNotConfigured') }} 
                            <a (click)="currentView.set('settings'); closeLeadDetailModal()" class="text-cyan-400 hover:underline cursor-pointer ml-1">{{ t('goToSettings') }}</a>
                        </div>
                    }
                    
                    @if(generationState().status === 'error') {
                        <div class="p-3 bg-red-500/10 border border-red-500/20 text-red-400 rounded-lg text-sm">
                            <strong>{{ t('error') }}:</strong> {{ generationState().error }}
                            <button (click)="generateMessage()" class="ml-2 text-cyan-400 hover:underline">\u91CD\u8A66</button>
                        </div>
                    }
                    
                    <!-- \u751F\u6210\u6210\u529F\u63D0\u793A -->
                    @if(generationState().status === 'success' && generationState().generatedMessage) {
                        <div class="p-3 bg-green-500/10 border border-green-500/20 rounded-lg">
                            <p class="text-xs text-green-400 mb-2">\u2713 AI \u5DF2\u751F\u6210\u6D88\u606F\uFF0C\u60A8\u53EF\u4EE5\u5728\u4E0B\u65B9\u7DE8\u8F2F\u5F8C\u767C\u9001</p>
                        </div>
                    }
                </div>
              }

              <!-- \u6A21\u677F\u9078\u64C7\u6A21\u5F0F -->
              @if(messageMode() === 'template') {
                <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700/50">
                    <label class="block text-sm font-medium text-cyan-400 mb-2">\u{1F4CB} {{ t('selectTemplate') }}</label>
                    <select 
                        (change)="applyTemplate($event)"
                        class="form-select w-full bg-slate-900/50 border-cyan-500/30 rounded-lg py-2.5 px-3 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500">
                        <option value="">{{ t('selectTemplatePlaceholder') }}</option>
                        @for(template of messageTemplates(); track template.id) {
                            <option [value]="template.id">{{ template.name }}</option>
                        }
                    </select>
                </div>
              }

              <!-- \u6D88\u606F\u5167\u5BB9\u7DE8\u8F2F\u5340 -->
              <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700/50">
                <div class="flex items-center justify-between mb-2">
                    <label class="text-sm font-medium text-cyan-400">\u270F\uFE0F {{ t('messageContent') }}</label>
                    <span class="text-xs text-slate-500 bg-slate-700/50 px-2 py-1 rounded">{{ editableMessage().length }} {{ t('characters') }}</span>
                </div>
                <textarea 
                    [ngModel]="editableMessage()" 
                    (ngModelChange)="editableMessage.set($event)"
                    rows="5" 
                    class="form-textarea w-full bg-slate-900/50 border-cyan-500/30 rounded-lg py-3 px-3 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 resize-none placeholder-slate-500"
                    [placeholder]="t('messageContentPlaceholder')">
                </textarea>
              </div>

              <!-- \u9644\u4EF6\u5340\u57DF - \u652F\u6301\u591A\u6587\u4EF6\u9078\u64C7 -->
              <div class="space-y-3">
                <div class="flex items-center gap-3 flex-wrap">
                  <button (click)="selectAttachment('image', true)" class="flex items-center gap-2 bg-slate-800/50 hover:bg-cyan-500/20 text-slate-300 hover:text-cyan-400 text-sm font-medium py-2 px-4 rounded-lg transition-all border border-slate-700/50 hover:border-cyan-500/30">
                      \u{1F5BC}\uFE0F {{ t('attachImage') }}
                  </button>
                  <button (click)="selectAttachment('file', true)" class="flex items-center gap-2 bg-slate-800/50 hover:bg-cyan-500/20 text-slate-300 hover:text-cyan-400 text-sm font-medium py-2 px-4 rounded-lg transition-all border border-slate-700/50 hover:border-cyan-500/30">
                      \u{1F4CE} {{ t('attachFile') }}
                  </button>
                  @if(generationState().attachments.length > 0) {
                    <button (click)="addMoreAttachments('file')" class="flex items-center gap-2 bg-green-500/20 hover:bg-green-500/30 text-green-400 text-sm font-medium py-2 px-3 rounded-lg transition-all border border-green-500/30">
                        \u2795 \u6DFB\u52A0\u66F4\u591A
                    </button>
                    <button (click)="clearAllAttachments()" class="flex items-center gap-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 text-sm font-medium py-2 px-3 rounded-lg transition-all border border-red-500/30">
                        \u{1F5D1}\uFE0F \u6E05\u7A7A
                    </button>
                  }
                </div>
                
                <!-- \u9644\u4EF6\u5217\u8868 -->
                @if(generationState().attachments.length > 0) {
                  <div class="p-3 rounded-xl bg-cyan-500/10 border border-cyan-500/30">
                    <div class="flex items-center justify-between mb-2">
                      <span class="text-sm text-cyan-400 font-medium">\u{1F4CE} \u9644\u4EF6\u5217\u8868 ({{ generationState().attachments.length }})</span>
                      <span class="text-xs text-slate-500">
                        \u7E3D\u5927\u5C0F: {{ getTotalAttachmentSize() }} MB
                      </span>
                    </div>
                    <div class="space-y-2 max-h-40 overflow-y-auto">
                      @for(attachment of generationState().attachments; track attachment.name; let i = $index) {
                        <div class="flex items-center justify-between text-sm bg-slate-800/50 rounded-lg px-3 py-2">
                          <div class="flex items-center gap-2 truncate flex-1 min-w-0">
                            @if(attachment.type === 'image') { <span class="text-green-400">\u{1F5BC}\uFE0F</span> }
                            @else { <span class="text-blue-400">\u{1F4C4}</span> }
                            <span class="truncate text-white">{{ attachment.name }}</span>
                            @if(attachment.fileSize) {
                              <span class="text-slate-500 text-xs whitespace-nowrap">
                                ({{ (attachment.fileSize / 1024 / 1024).toFixed(2) }} MB)
                              </span>
                            }
                            @if(attachment.filePath) {
                              <span class="text-green-500 text-xs">\u2713</span>
                            }
                          </div>
                          <button (click)="removeAttachmentByIndex(i)" class="text-red-400 hover:text-red-300 text-lg font-bold p-1 hover:bg-red-500/20 rounded ml-2">&times;</button>
                        </div>
                      }
                    </div>
                  </div>
                }
              </div>

              <!-- \u767C\u9001\u72C0\u614B\u63D0\u793A -->
              @if(!canSendMessage() && !lead.doNotContact) {
                <div class="p-3 bg-amber-500/10 border border-amber-500/30 rounded-xl">
                  <p class="text-sm text-amber-400">
                    @if(senderAccounts().length === 0) {
                      \u26A0\uFE0F \u7121\u53EF\u7528\u767C\u9001\u5E33\u865F
                    } @else if(!selectedSenderId()) {
                      \u26A0\uFE0F \u8ACB\u9078\u64C7\u767C\u9001\u5E33\u865F
                    } @else if(editableMessage().trim().length === 0 && !generationState().attachment && generationState().attachments.length === 0) {
                      \u26A0\uFE0F \u8ACB\u8F38\u5165\u8A0A\u606F\u5167\u5BB9\u6216\u6DFB\u52A0\u9644\u4EF6
                    }
                  </p>
                </div>
              }
              @if(lead.doNotContact) {
                <div class="p-3 bg-red-500/10 border border-red-500/30 rounded-xl">
                  <p class="text-sm text-red-400">\u{1F6AB} \u6B64\u5BA2\u6236\u5DF2\u52A0\u5165\u9ED1\u540D\u55AE\uFF0C\u7121\u6CD5\u767C\u9001\u8A0A\u606F</p>
                </div>
              }

              <!-- \u5E95\u90E8\u64CD\u4F5C\u6309\u9215 - \u9752\u85CD\u8272\u4E3B\u984C -->
              <div class="flex justify-between items-center pt-4 border-t border-cyan-500/20">
                <button (click)="addToDoNotContact(lead.id)" [disabled]="lead.doNotContact" class="text-sm text-red-400 hover:text-red-300 disabled:text-slate-500 disabled:cursor-not-allowed flex items-center gap-1.5 px-3 py-2 rounded-lg hover:bg-red-500/10 transition-all">
                    \u{1F6AB} {{ lead.doNotContact ? t('userOnDNC') : t('addToDNC') }}
                </button>
                <div class="flex gap-3">
                    <button (click)="closeLeadDetailModal()" class="bg-slate-700/80 hover:bg-slate-600 text-slate-300 font-medium py-2.5 px-5 rounded-xl transition-all border border-slate-600/50 hover:border-slate-500">
                        {{ t('cancel') }}
                    </button>
                    <button 
                        (click)="sendMessageToLead()" 
                        [disabled]="!canSendMessage() || lead.doNotContact" 
                        class="bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-400 hover:to-blue-400 text-white font-bold py-2.5 px-6 rounded-xl shadow-lg shadow-cyan-500/30 disabled:from-slate-500 disabled:to-slate-600 disabled:shadow-none disabled:cursor-not-allowed flex items-center gap-2 transition-all">
                        \u2708\uFE0F {{ t('sendMessage') }}
                    </button>
                </div>
              </div>
            </div>
        }
        @if(leadDetailView() === 'history') {
            <div class="py-4">
                <!-- \u52A0\u8F09\u5B8C\u6574\u804A\u5929\u8A18\u9304\u6309\u9215 -->
                <div class="mb-4 flex items-center justify-between">
                    <button 
                        (click)="loadChatHistory(lead.userId)" 
                        [disabled]="isLoadingChatHistory()"
                        class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg text-sm disabled:bg-slate-500 disabled:cursor-not-allowed flex items-center gap-2">
                        @if(isLoadingChatHistory()) {
                            <span class="animate-spin">\u27F3</span> <span>\u52A0\u8F09\u4E2D...</span>
                        } @else {
                            <span>\u{1F4AC}</span> <span>\u52A0\u8F09\u5B8C\u6574\u804A\u5929\u8A18\u9304</span>
                        }
                    </button>
                    @if(selectedChatUserId() === lead.userId && chatHistory().length > 0) {
                        <span class="text-xs text-slate-500">\u5171 {{ chatHistory().length }} \u689D\u6D88\u606F</span>
                    }
                </div>
                
                <!-- \u5B8C\u6574\u804A\u5929\u8A18\u9304\uFF08\u5982\u679C\u5DF2\u52A0\u8F09\uFF09 -->
                @if(selectedChatUserId() === lead.userId && chatHistory().length > 0) {
                    <div 
                        class="h-96 overflow-y-auto space-y-3 mb-4 bg-slate-200/30 dark:bg-slate-800/30 rounded-lg p-4"
                        (scroll)="onChatHistoryScroll($event)">
                        @for(message of chatHistory(); track trackByChatMessageId($index, message)) {
                            @if(message.role === 'user') {
                                <!-- \u7528\u6236\u6D88\u606F\uFF08\u5DE6\u5074\uFF09 -->
                                <div class="flex justify-start">
                                    <div class="max-w-[75%]">
                                        <div class="bg-slate-700 text-white rounded-2xl rounded-bl-sm px-4 py-2">
                                            <p class="text-sm">{{ message.content }}</p>
                                        </div>
                                        <p class="text-xs text-slate-500 mt-1">{{ formatTimestamp(message.timestamp) }}</p>
                                    </div>
                                </div>
                            } @else if(message.role === 'assistant') {
                                <!-- AI \u56DE\u5FA9\uFF08\u53F3\u5074\uFF09 -->
                                <div class="flex justify-end">
                                    <div class="max-w-[75%]">
                                        <div class="bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-2xl rounded-br-sm px-4 py-2 shadow-lg">
                                            <p class="text-sm">{{ message.content }}</p>
                                        </div>
                                        <div class="flex items-center justify-end gap-2 mt-1">
                                            <span class="text-xs text-slate-500">{{ formatTimestamp(message.timestamp) }}</span>
                                            <span class="text-xs bg-purple-500/20 text-purple-400 px-1.5 py-0.5 rounded">\u{1F916} AI</span>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                        
                        <!-- \u52A0\u8F09\u66F4\u591A\u6307\u793A\u5668 -->
                        @if(chatHistoryLoadingMore()) {
                            <div class="text-center py-4">
                                <span class="animate-spin text-cyan-400">\u27F3</span>
                                <span class="ml-2 text-sm text-slate-500">\u52A0\u8F09\u4E2D...</span>
                            </div>
                        }
                        
                        @if(chatHistoryHasMore() && !chatHistoryLoadingMore()) {
                            <div class="text-center py-2">
                                <button 
                                    (click)="loadMoreChatHistory()"
                                    class="text-sm text-cyan-400 hover:text-cyan-300">
                                    \u52A0\u8F09\u66F4\u591A\u6D88\u606F
                                </button>
                            </div>
                        }
                    </div>
                }
                
                <!-- \u4E92\u52D5\u6B77\u53F2\uFF08\u539F\u6709\u986F\u793A\uFF09 -->
                <div class="h-96 overflow-y-auto">
                    <div class="space-y-3 mb-4">
                        @for(item of lead.interactionHistory; track trackByChatMessageId($index, item)) {
                        @if(item.type.includes('Sent') || item.type.includes('Message')) {
                            <!-- \u6211\u65B9\u6D88\u606F\uFF08\u53F3\u5074\uFF09 -->
                            <div class="flex justify-end">
                                <div class="max-w-[75%]">
                                    <div class="bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-2xl rounded-br-sm px-4 py-2 shadow-lg">
                                        <p class="text-sm">{{ item.content }}</p>
                                    </div>
                                    <div class="flex items-center justify-end gap-2 mt-1">
                                        <span class="text-xs text-slate-500">{{ formatTimestamp(item.timestamp) }}</span>
                                        @if(item.type.includes('AI')) {
                                            <span class="text-xs bg-purple-500/20 text-purple-400 px-1.5 py-0.5 rounded">\u{1F916} AI</span>
                                        }
                                    </div>
                                </div>
                            </div>
                        } @else if(item.type.includes('Reply') || item.type.includes('Received')) {
                            <!-- \u5C0D\u65B9\u56DE\u5FA9\uFF08\u5DE6\u5074\uFF09 -->
                            <div class="flex justify-start">
                                <div class="max-w-[75%]">
                                    <div class="bg-slate-700 text-white rounded-2xl rounded-bl-sm px-4 py-2">
                                        <p class="text-sm">{{ item.content }}</p>
                                    </div>
                                    <p class="text-xs text-slate-500 mt-1">{{ formatTimestamp(item.timestamp) }}</p>
                                </div>
                            </div>
                        } @else {
                            <!-- \u7CFB\u7D71\u6D88\u606F\uFF08\u5C45\u4E2D\uFF09 -->
                            <div class="flex justify-center">
                                <div class="bg-slate-800/50 text-slate-400 text-xs px-3 py-1 rounded-full">
                                    {{ item.type }}: {{ item.content }} \xB7 {{ formatTimestamp(item.timestamp) }}
                                </div>
                            </div>
                        }
                    }
                </div>
                </div>
                
                @if(lead.interactionHistory.length === 0 && (!selectedChatUserId() || chatHistory().length === 0)) { 
                    <div class="text-center py-8">
                        <div class="text-4xl mb-2">\u{1F4AC}</div>
                        <p class="text-slate-500 dark:text-slate-400">{{ t('noHistoryFound') }}</p>
                        <p class="text-xs text-slate-500 mt-2">\u9EDE\u64CA\u300C\u52A0\u8F09\u5B8C\u6574\u804A\u5929\u8A18\u9304\u300D\u67E5\u770B\u6240\u6709\u5C0D\u8A71</p>
                    </div>
                }
                
                <!-- AI \u5206\u6790\u9762\u677F -->
                @if(lead.interactionHistory.length > 0) {
                    <div class="mt-4 p-3 bg-slate-800/50 rounded-lg border border-cyan-500/20">
                        <h4 class="text-sm font-medium text-cyan-400 mb-2 flex items-center gap-2">
                            <span>\u{1F4CA}</span> AI \u5C0D\u8A71\u5206\u6790
                        </h4>
                        <div class="grid grid-cols-3 gap-2 text-center text-xs">
                            <div class="p-2 bg-slate-700/50 rounded">
                                <p class="text-slate-400">\u7E3D\u4E92\u52D5</p>
                                <p class="text-lg font-bold text-white">{{ lead.interactionHistory.length }}</p>
                            </div>
                            <div class="p-2 bg-slate-700/50 rounded">
                                <p class="text-slate-400">\u5C0D\u8A71\u968E\u6BB5</p>
                                <p class="text-sm font-bold text-cyan-400">{{ lead.status || '\u521D\u6B21\u63A5\u89F8' }}</p>
                            </div>
                            <div class="p-2 bg-slate-700/50 rounded">
                                <p class="text-slate-400">\u8208\u8DA3\u7A0B\u5EA6</p>
                                <p class="text-lg">\u2B50\u2B50\u2B50</p>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        </div><!-- \u5167\u5BB9\u5340\u57DF\u7D50\u675F -->
      </div>
    </div>
  }

  <!-- \u6279\u91CF\u64CD\u4F5C\u6B77\u53F2\u5C0D\u8A71\u6846 -->
  @if(showBatchOperationHistory()) {
    <div class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 backdrop-blur-sm" (click)="showBatchOperationHistory.set(false)">
      <div class="bg-slate-100 dark:bg-slate-900 rounded-2xl shadow-2xl border border-slate-300 dark:border-slate-700 w-full max-w-3xl max-h-[80vh] overflow-hidden" (click)="$event.stopPropagation()">
        <!-- \u6A19\u984C -->
        <div class="p-4 border-b border-slate-300 dark:border-slate-700 flex items-center justify-between bg-slate-200/50 dark:bg-slate-800/50">
          <h3 class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2">
            <svg class="h-5 w-5 text-purple-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></svg>
            \u6279\u91CF\u64CD\u4F5C\u6B77\u53F2
          </h3>
          <button (click)="showBatchOperationHistory.set(false)" class="text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-white">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
        
        <!-- \u5167\u5BB9 -->
        <div class="p-4 overflow-y-auto max-h-[60vh]">
          @if(batchOperationHistory().length === 0) {
            <div class="text-center py-8 text-slate-500">
              <svg class="h-12 w-12 mx-auto mb-3 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v4l3 3"/></svg>
              <p>\u66AB\u7121\u64CD\u4F5C\u6B77\u53F2</p>
            </div>
          } @else {
            <div class="space-y-3">
              @for(op of batchOperationHistory(); track op.id) {
                <div class="bg-slate-200/50 dark:bg-slate-800/50 rounded-lg p-3 border border-slate-300 dark:border-slate-700"
                     [class.opacity-50]="op.reversed">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                      <div class="p-2 rounded-lg" 
                           [class.bg-cyan-500/20]="op.operationType === 'update_status'"
                           [class.bg-blue-500/20]="op.operationType === 'add_tag'"
                           [class.bg-red-500/20]="op.operationType === 'delete' || op.operationType === 'add_to_dnc'">
                        <svg class="h-4 w-4" 
                             [class.text-cyan-400]="op.operationType === 'update_status'"
                             [class.text-blue-400]="op.operationType === 'add_tag'"
                             [class.text-red-400]="op.operationType === 'delete' || op.operationType === 'add_to_dnc'"
                             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                      </div>
                      <div>
                        <p class="font-medium text-slate-900 dark:text-white">{{ getOperationTypeName(op.operationType) }}</p>
                        <p class="text-xs text-slate-500">
                          {{ op.itemCount }} \u9805 \xB7 {{ formatBatchOperationDate(op.createdAt) }}
                          @if(op.reversed) {
                            <span class="text-yellow-500 ml-2">\uFF08\u5DF2\u64A4\u92B7\uFF09</span>
                          }
                        </p>
                      </div>
                    </div>
                    <div class="flex items-center gap-3">
                      <div class="text-sm">
                        <span class="text-green-400">{{ op.successCount }} \u6210\u529F</span>
                        @if(op.failureCount > 0) {
                          <span class="text-red-400 ml-2">{{ op.failureCount }} \u5931\u6557</span>
                        }
                      </div>
                      @if(op.isReversible && !op.reversed) {
                        <button (click)="undoBatchOperation(op.id)" 
                                class="text-xs bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-400 px-2 py-1 rounded">
                          \u64A4\u92B7
                        </button>
                      }
                    </div>
                  </div>
                </div>
              }
            </div>
          }
        </div>
        
        <!-- \u5E95\u90E8 -->
        <div class="p-4 border-t border-slate-300 dark:border-slate-700 bg-slate-200/50 dark:bg-slate-800/50 flex justify-end">
          <button (click)="showBatchOperationHistory.set(false)" 
                  class="px-4 py-2 bg-slate-300 dark:bg-slate-700 hover:bg-slate-400 dark:hover:bg-slate-600 rounded-lg text-sm font-medium transition-colors">
            \u95DC\u9589
          </button>
        </div>
      </div>
    </div>
  }
  
  <!-- \u9996\u6B21\u555F\u52D5\u6B61\u8FCE\u5411\u5C0E -->
  @if (showWelcomeDialog()) {
    <div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[100]">
      <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl shadow-2xl w-full max-w-2xl mx-4 overflow-hidden border border-cyan-500/30">
        
        <!-- \u982D\u90E8 -->
        <div class="bg-gradient-to-r from-cyan-500 to-purple-500 p-6 text-center">
          <h1 class="text-3xl font-bold text-white mb-2">\u{1F680} \u6B61\u8FCE\u4F7F\u7528 TG-AI\u667A\u63A7\u738B</h1>
          <p class="text-cyan-100">AI \u9A45\u52D5\u7684 Telegram \u71DF\u92B7\u81EA\u52D5\u5316\u5E73\u53F0</p>
        </div>
        
        <!-- \u6B65\u9A5F\u6307\u793A\u5668 -->
        <div class="flex justify-center gap-2 py-4 bg-slate-800/50">
          <div class="w-3 h-3 rounded-full transition-all" 
               [class]="welcomeStep() >= 1 ? 'bg-cyan-500' : 'bg-slate-600'"></div>
          <div class="w-3 h-3 rounded-full transition-all" 
               [class]="welcomeStep() >= 2 ? 'bg-cyan-500' : 'bg-slate-600'"></div>
          <div class="w-3 h-3 rounded-full transition-all" 
               [class]="welcomeStep() >= 3 ? 'bg-cyan-500' : 'bg-slate-600'"></div>
        </div>
        
        <!-- \u5167\u5BB9\u5340\u57DF -->
        <div class="p-6">
          @switch (welcomeStep()) {
            @case (1) {
              <!-- \u6B65\u9A5F 1: \u6B61\u8FCE\u4ECB\u7D39 -->
              <div class="text-center space-y-6">
                <div class="grid grid-cols-3 gap-4 mb-6">
                  <div class="p-4 bg-slate-700/50 rounded-xl">
                    <div class="text-3xl mb-2">\u{1F916}</div>
                    <div class="text-sm font-medium text-white">AI \u81EA\u52D5\u56DE\u8986</div>
                    <div class="text-xs text-slate-400">\u667A\u80FD\u5BA2\u670D\u52A9\u624B</div>
                  </div>
                  <div class="p-4 bg-slate-700/50 rounded-xl">
                    <div class="text-3xl mb-2">\u{1F50D}</div>
                    <div class="text-sm font-medium text-white">\u8CC7\u6E90\u767C\u73FE</div>
                    <div class="text-xs text-slate-400">\u81EA\u52D5\u641C\u7D22\u7FA4\u7D44</div>
                  </div>
                  <div class="p-4 bg-slate-700/50 rounded-xl">
                    <div class="text-3xl mb-2">\u{1F4CA}</div>
                    <div class="text-sm font-medium text-white">\u6578\u64DA\u5206\u6790</div>
                    <div class="text-xs text-slate-400">\u8F49\u5316\u8FFD\u8E64\u5831\u8868</div>
                  </div>
                </div>
                
                <p class="text-slate-300">
                  TG-AI\u667A\u63A7\u738B \u5C07\u5E6B\u52A9\u60A8\u81EA\u52D5\u5316 Telegram \u71DF\u92B7\u6D41\u7A0B\uFF0C<br>
                  \u8B93\u60A8\u5C08\u6CE8\u65BC\u696D\u52D9\u589E\u9577\u800C\u975E\u91CD\u8907\u64CD\u4F5C\u3002
                </p>
              </div>
            }
            @case (2) {
              <!-- \u6B65\u9A5F 2: AI \u8A2D\u7F6E -->
              <div class="space-y-4">
                <h3 class="text-lg font-semibold text-white text-center mb-4">\u{1F999} AI \u670D\u52D9\u914D\u7F6E</h3>
                
                <!-- Ollama \u6AA2\u6E2C\u72C0\u614B -->
                <div class="p-4 rounded-xl" 
                     [class]="ollamaDetected() ? 'bg-green-500/20 border border-green-500/30' : 'bg-yellow-500/20 border border-yellow-500/30'">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                      <span class="text-2xl">{{ ollamaDetected() ? '\u2705' : '\u26A0\uFE0F' }}</span>
                      <div>
                        <div class="font-medium text-white">
                          {{ ollamaDetected() ? 'Ollama \u5DF2\u6AA2\u6E2C\u5230' : 'Ollama \u672A\u904B\u884C' }}
                        </div>
                        <div class="text-sm text-slate-400">
                          {{ ollamaDetected() ? '\u672C\u5730 AI \u670D\u52D9\u53EF\u7528' : '\u5EFA\u8B70\u5B89\u88DD Ollama \u7372\u5F97\u514D\u8CBB AI \u80FD\u529B' }}
                        </div>
                      </div>
                    </div>
                    <button (click)="detectOllama()" [disabled]="isDetectingOllama()"
                            class="px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-sm text-white disabled:opacity-50">
                      {{ isDetectingOllama() ? '\u6AA2\u6E2C\u4E2D...' : '\u91CD\u65B0\u6AA2\u6E2C' }}
                    </button>
                  </div>
                </div>
                
                @if (ollamaDetected()) {
                  <!-- \u6A21\u578B\u9078\u64C7 -->
                  <div class="p-4 bg-slate-700/50 rounded-xl">
                    <label class="block text-sm font-medium text-slate-300 mb-2">\u9078\u64C7 AI \u6A21\u578B</label>
                    @if (detectedOllamaModels().length > 0) {
                      <select [ngModel]="localAiModel()" (ngModelChange)="localAiModel.set($event)"
                              class="w-full bg-slate-800 border border-slate-600 rounded-lg py-2 px-3 text-white">
                        @for (model of detectedOllamaModels(); track model) {
                          <option [value]="model">{{ model }}</option>
                        }
                      </select>
                    } @else {
                      <input [ngModel]="localAiModel()" (ngModelChange)="localAiModel.set($event)"
                             class="w-full bg-slate-800 border border-slate-600 rounded-lg py-2 px-3 text-white"
                             placeholder="qwen2:7b">
                    }
                    <p class="text-xs text-slate-500 mt-1">\u63A8\u85A6\uFF1Aqwen2:7b\uFF08\u4E2D\u82F1\u6587\u901A\u7528\uFF09</p>
                  </div>
                } @else {
                  <!-- Ollama \u5B89\u88DD\u6307\u5357 -->
                  <div class="p-4 bg-slate-700/50 rounded-xl">
                    <div class="text-sm text-slate-300 space-y-2">
                      <p class="font-medium">\u{1F4E6} \u5B89\u88DD Ollama\uFF08\u514D\u8CBB\uFF09\uFF1A</p>
                      <code class="block bg-slate-800 p-2 rounded text-cyan-400 text-xs">
                        curl -fsSL https://ollama.com/install.sh | sh
                      </code>
                      <p class="text-xs text-slate-500">
                        \u5B89\u88DD\u5F8C\u904B\u884C <code class="text-cyan-400">ollama pull qwen2:7b</code> \u4E0B\u8F09\u6A21\u578B
                      </p>
                    </div>
                  </div>
                  
                  <!-- \u5099\u9078\uFF1A\u96F2\u7AEF AI -->
                  <div class="p-4 bg-slate-700/50 rounded-xl">
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="checkbox" [checked]="aiAutoFallback()" (change)="aiAutoFallback.set(!aiAutoFallback())"
                             class="w-4 h-4 text-cyan-500 rounded">
                      <span class="text-sm text-slate-300">\u4F7F\u7528\u96F2\u7AEF AI \u4F5C\u70BA\u5099\u9078</span>
                    </label>
                    @if (aiAutoFallback()) {
                      <div class="mt-2">
                        <select [ngModel]="aiBackupProvider()" (ngModelChange)="aiBackupProvider.set($event)"
                                class="w-full bg-slate-800 border border-slate-600 rounded py-1 px-2 text-sm text-white">
                          <option value="gemini">Google Gemini\uFF08\u514D\u8CBB\u984D\u5EA6\uFF09</option>
                          <option value="openai">OpenAI GPT</option>
                        </select>
                      </div>
                    }
                  </div>
                }
              </div>
            }
            @case (3) {
              <!-- \u6B65\u9A5F 3: \u5B8C\u6210 -->
              <div class="text-center space-y-6">
                <div class="text-6xl mb-4">\u{1F389}</div>
                <h3 class="text-2xl font-bold text-white">\u8A2D\u7F6E\u5B8C\u6210\uFF01</h3>
                <p class="text-slate-300">
                  \u60A8\u5DF2\u6E96\u5099\u597D\u958B\u59CB\u4F7F\u7528 TG-AI\u667A\u63A7\u738B\u3002<br>
                  \u63A5\u4E0B\u4F86\u8ACB\u6DFB\u52A0\u60A8\u7684\u7B2C\u4E00\u500B Telegram \u5E33\u865F\u3002
                </p>
                
                <div class="p-4 bg-cyan-500/10 rounded-xl border border-cyan-500/30">
                  <div class="text-sm text-slate-300 space-y-1">
                    <p>\u2705 AI \u670D\u52D9\uFF1A{{ ollamaDetected() ? 'Ollama \u672C\u5730 AI' : '\u96F2\u7AEF AI' }}</p>
                    @if (ollamaDetected()) {
                      <p>\u2705 \u6A21\u578B\uFF1A{{ localAiModel() }}</p>
                    }
                    <p>\u2705 \u81EA\u52D5\u964D\u7D1A\uFF1A{{ aiAutoFallback() ? '\u5DF2\u555F\u7528' : '\u5DF2\u7981\u7528' }}</p>
                  </div>
                </div>
              </div>
            }
          }
        </div>
        
        <!-- \u5E95\u90E8\u6309\u9215 -->
        <div class="p-6 bg-slate-800/50 flex justify-between items-center">
          <button (click)="skipFirstRunSetup()" class="text-sm text-slate-400 hover:text-white transition-colors">
            \u8DF3\u904E\u8A2D\u7F6E
          </button>
          
          <div class="flex gap-3">
            @if (welcomeStep() > 1) {
              <button (click)="welcomeStep.set(welcomeStep() - 1)"
                      class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">
                \u4E0A\u4E00\u6B65
              </button>
            }
            
            @if (welcomeStep() < 3) {
              <button (click)="welcomeStep.set(welcomeStep() + 1)"
                      class="px-6 py-2 bg-gradient-to-r from-cyan-500 to-purple-500 hover:from-cyan-600 hover:to-purple-600 text-white font-medium rounded-lg transition-all">
                \u4E0B\u4E00\u6B65
              </button>
            } @else {
              <button (click)="completeFirstRunSetup()"
                      class="px-6 py-2 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-medium rounded-lg transition-all">
                \u958B\u59CB\u4F7F\u7528 \u{1F680}
              </button>
            }
          </div>
        </div>
      </div>
    </div>
  }
  
  <!-- \u5B64\u7ACB Session \u6062\u5FA9\u5C0D\u8A71\u6846 -->
  @if (showOrphanSessionDialog()) {
    <div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[100]">
      <div class="bg-slate-800 rounded-2xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden border border-amber-500/50">
        
        <!-- \u982D\u90E8 -->
        <div class="bg-amber-500/20 p-6 text-center border-b border-amber-500/30">
          <div class="text-5xl mb-3">\u{1F504}</div>
          <h2 class="text-xl font-bold text-amber-400">\u767C\u73FE\u53EF\u6062\u5FA9\u7684\u5E33\u865F</h2>
          <p class="text-slate-400 text-sm mt-2">
            \u767C\u73FE {{ orphanSessions().length }} \u500B Session \u6587\u4EF6\u9700\u8981\u624B\u52D5\u6062\u5FA9
          </p>
        </div>
        
        <!-- \u5167\u5BB9 -->
        <div class="p-6 space-y-4">
          <p class="text-slate-300 text-sm">
            \u9019\u4E9B Session \u6587\u4EF6\u5B58\u5728\u65BC\u7CFB\u7D71\u4E2D\uFF0C\u4F46\u672A\u5728\u6578\u64DA\u5EAB\u4E2D\u627E\u5230\u5C0D\u61C9\u7684\u5E33\u865F\u8A18\u9304\u3002
            \u60A8\u53EF\u4EE5\u5617\u8A66\u6062\u5FA9\u9019\u4E9B\u5E33\u865F\uFF0C\u6216\u9078\u64C7\u5FFD\u7565\u3002
          </p>
          
          <!-- Session \u5217\u8868 -->
          <div class="bg-slate-700/50 rounded-lg p-3 max-h-48 overflow-y-auto space-y-2">
            @for (session of orphanSessions(); track session.phone) {
              <div class="flex items-center justify-between p-2 bg-slate-600/50 rounded-lg">
                <div class="flex items-center gap-3">
                  <span class="text-2xl">\u{1F4F1}</span>
                  <div>
                    <p class="text-white font-medium">+{{ session.phone }}</p>
                    @if (session.hasMetadata && session.metadata) {
                      <p class="text-green-400 text-xs">
                        \u2713 \u6709\u5143\u6578\u64DA: {{ session.metadata.firstName || '' }} {{ session.metadata.username ? '@' + session.metadata.username : '' }}
                      </p>
                    } @else {
                      <p class="text-amber-400 text-xs">\u26A0 \u7121\u5143\u6578\u64DA\uFF0C\u9700\u8981\u91CD\u65B0\u767B\u9304\u9A57\u8B49</p>
                    }
                  </div>
                </div>
              </div>
            }
          </div>
          
          <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-3">
            <p class="text-blue-400 text-sm">
              \u{1F4A1} <strong>\u63D0\u793A\uFF1A</strong> \u6062\u5FA9\u5F8C\uFF0C\u5E33\u865F\u5C07\u4EE5\u300C\u96E2\u7DDA\u300D\u72C0\u614B\u6DFB\u52A0\u5230\u5217\u8868\u4E2D\u3002
              \u60A8\u9700\u8981\u9EDE\u64CA\u300C\u767B\u9304\u300D\u4F86\u91CD\u65B0\u9023\u63A5\u5E33\u865F\u3002
            </p>
          </div>
        </div>
        
        <!-- \u5E95\u90E8\u6309\u9215 -->
        <div class="p-4 bg-slate-700/30 flex justify-end gap-3">
          <button (click)="dismissOrphanSessionDialog()" 
                  class="px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors">
            \u7A0D\u5F8C\u8655\u7406
          </button>
          <button (click)="recoverOrphanSessions()" 
                  [disabled]="isRecoveringOrphanSessions()"
                  class="px-4 py-2 bg-amber-500 hover:bg-amber-600 disabled:opacity-50 text-white rounded-lg transition-colors flex items-center gap-2">
            @if (isRecoveringOrphanSessions()) {
              <span class="animate-spin">\u23F3</span>
              <span>\u6062\u5FA9\u4E2D...</span>
            } @else {
              <span>\u{1F504}</span>
              <span>\u6062\u5FA9\u5E33\u865F</span>
            }
          </button>
        </div>
      </div>
    </div>
  }

  <!-- \u5F8C\u7AEF\u932F\u8AA4\u63D0\u793A\u5C0D\u8A71\u6846 -->
  @if (showBackendErrorDialog()) {
    <div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[100]">
      <div class="bg-slate-800 rounded-2xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden border border-red-500/50">
        
        <!-- \u982D\u90E8 -->
        <div class="bg-red-500/20 p-6 text-center border-b border-red-500/30">
          <div class="text-5xl mb-3">\u26A0\uFE0F</div>
          <h2 class="text-xl font-bold text-red-400">Python \u5F8C\u7AEF\u672A\u904B\u884C</h2>
        </div>
        
        <!-- \u5167\u5BB9 -->
        <div class="p-6 space-y-4">
          <p class="text-slate-300">
            \u7A0B\u5E8F\u9700\u8981 Python \u74B0\u5883\u624D\u80FD\u6B63\u5E38\u904B\u884C\u3002\u8ACB\u78BA\u4FDD\uFF1A
          </p>
          
          <div class="bg-slate-700/50 rounded-lg p-4 space-y-3">
            <div class="flex items-start gap-3">
              <span class="text-cyan-400">1.</span>
              <div>
                <p class="text-white font-medium">\u5B89\u88DD Python 3.9+</p>
                <a href="https://www.python.org/downloads/" target="_blank" 
                   class="text-cyan-400 text-sm hover:underline">
                  https://www.python.org/downloads/
                </a>
              </div>
            </div>
            
            <div class="flex items-start gap-3">
              <span class="text-cyan-400">2.</span>
              <div>
                <p class="text-white font-medium">\u5B89\u88DD\u6642\u52FE\u9078 "Add Python to PATH"</p>
                <p class="text-slate-400 text-sm">\u78BA\u4FDD Python \u6DFB\u52A0\u5230\u7CFB\u7D71\u74B0\u5883\u8B8A\u91CF</p>
              </div>
            </div>
            
            <div class="flex items-start gap-3">
              <span class="text-cyan-400">3.</span>
              <div>
                <p class="text-white font-medium">\u5B89\u88DD\u4F9D\u8CF4</p>
                <code class="block bg-slate-800 text-green-400 text-sm p-2 rounded mt-1">
                  pip install pyrogram tgcrypto aiosqlite
                </code>
              </div>
            </div>
            
            <div class="flex items-start gap-3">
              <span class="text-cyan-400">4.</span>
              <div>
                <p class="text-white font-medium">\u91CD\u65B0\u555F\u52D5\u7A0B\u5E8F</p>
              </div>
            </div>
          </div>
          
          @if (backendError()) {
            <div class="bg-red-500/10 border border-red-500/30 rounded-lg p-3">
              <p class="text-red-400 text-sm">
                <span class="font-medium">\u932F\u8AA4\u8A73\u60C5\uFF1A</span>
                {{ backendError() }}
              </p>
            </div>
          }
        </div>
        
        <!-- \u5E95\u90E8\u6309\u9215 -->
        <div class="p-4 bg-slate-700/30 flex justify-end gap-3">
          <button (click)="showBackendErrorDialog.set(false)" 
                  class="px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors">
            \u6211\u77E5\u9053\u4E86
          </button>
        </div>
      </div>
    </div>
  }
  
    <!-- \u5F8C\u7AEF\u72C0\u614B\u6307\u793A\u5668 -->
    @if (!backendRunning()) {
      <div class="fixed bottom-4 right-4 z-50 bg-red-500/90 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 cursor-pointer hover:bg-red-600"
           (click)="showBackendErrorDialog.set(true)">
        <span class="animate-pulse">\u26A0\uFE0F</span>
        <span class="text-sm font-medium">Python \u5F8C\u7AEF\u672A\u904B\u884C</span>
      </div>
    }
    
    <!-- \u5275\u5EFA\u95DC\u9375\u8A5E\u96C6\u5C0D\u8A71\u6846 -->
    @if (showKeywordSetCreator()) {
      <div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100]"
           (click)="cancelNewKeywordSet()">
        <div class="bg-slate-800 rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden border border-cyan-500/30"
             (click)="$event.stopPropagation()">
          
          <!-- \u982D\u90E8 -->
          <div class="bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-4 border-b border-slate-700/50">
            <h2 class="text-lg font-bold text-white flex items-center gap-2">
              <span>\u{1F511}</span> \u5275\u5EFA\u95DC\u9375\u8A5E\u96C6
            </h2>
          </div>
          
          <!-- \u5167\u5BB9 -->
          <div class="p-6">
            <label class="block text-sm text-slate-400 mb-2">\u95DC\u9375\u8A5E\u96C6\u540D\u7A31</label>
            <input type="text" 
                   class="w-full bg-slate-900/50 border border-slate-600 rounded-lg px-4 py-3 text-white 
                          focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 transition-colors"
                   placeholder="\u4F8B\u5982\uFF1A\u8CB7\u5BB6\u610F\u5411\u3001\u7522\u54C1\u8AEE\u8A62..."
                   [value]="newKeywordSet().name"
                   (input)="newKeywordSet.set({ name: $any($event.target).value })"
                   (keyup.enter)="submitNewKeywordSet()"
                   autofocus>
            <p class="text-xs text-slate-500 mt-2">
              \u{1F4A1} \u5275\u5EFA\u5F8C\u53EF\u5728\u8A5E\u96C6\u4E2D\u6DFB\u52A0\u591A\u500B\u95DC\u9375\u8A5E
            </p>
          </div>
          
          <!-- \u5E95\u90E8\u6309\u9215 -->
          <div class="p-4 bg-slate-700/30 flex justify-end gap-3">
            <button (click)="cancelNewKeywordSet()" 
                    class="px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors">
              \u53D6\u6D88
            </button>
            <button (click)="submitNewKeywordSet()" 
                    class="px-4 py-2 bg-cyan-500 hover:bg-cyan-400 text-white rounded-lg transition-colors font-medium">
              \u5275\u5EFA
            </button>
          </div>
        </div>
      </div>
    }
  </div>
} @else {
  <!-- \u672A\u8A8D\u8B49\u7528\u6236\uFF1A\u986F\u793A\u8DEF\u7531\u5167\u5BB9\uFF08\u767B\u5165\u9801\u9762\u7B49\uFF09 -->
  <div class="auth-wrapper" style="min-height: 100vh; background: linear-gradient(to bottom right, #0f172a, #1e293b, #0f172a);">
    <router-outlet></router-outlet>
  </div>
} <!-- \u7D50\u675F @if (isAuthenticated()) -->`, styles: ['/* angular:styles/component:css;43015d5c464d5eebacc9255a1a9f9f6e8529f7efe4e938701f1d59f35548ead6;D:/tgkz2026/src/app.component.ts */\n:host ::ng-deep .highlight-pulse {\n  animation: highlight-pulse 1.5s ease-in-out 2;\n}\n@keyframes highlight-pulse {\n  0%, 100% {\n    box-shadow: 0 0 0 0 rgba(6, 182, 212, 0);\n    border-color: inherit;\n  }\n  50% {\n    box-shadow: 0 0 20px 5px rgba(6, 182, 212, 0.5);\n    border-color: rgb(6, 182, 212);\n  }\n}\n@keyframes fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n@keyframes success-pop {\n  0% {\n    transform: scale(0.5);\n    opacity: 0;\n  }\n  50% {\n    transform: scale(1.1);\n  }\n  100% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n.animate-fade-in {\n  animation: fade-in 0.3s ease-out forwards;\n}\n.animate-success-pop {\n  animation: success-pop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;\n}\n:host ::ng-deep .page-content {\n  animation: page-fade-in 0.3s ease-out;\n}\n@keyframes page-fade-in {\n  from {\n    opacity: 0;\n    transform: translateY(10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n:host ::ng-deep .card-hover {\n  transition: all 0.2s ease;\n}\n:host ::ng-deep .card-hover:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.3);\n}\n:host ::ng-deep .sidebar-item {\n  position: relative;\n  overflow: hidden;\n}\n:host ::ng-deep .sidebar-item::before {\n  content: "";\n  position: absolute;\n  left: 0;\n  top: 50%;\n  width: 3px;\n  height: 0;\n  background:\n    linear-gradient(\n      to bottom,\n      #06b6d4,\n      #8b5cf6);\n  transition: height 0.2s ease;\n  transform: translateY(-50%);\n  border-radius: 0 2px 2px 0;\n}\n:host ::ng-deep .sidebar-item:hover::before,\n:host ::ng-deep .sidebar-item.active::before {\n  height: 60%;\n}\n:host ::ng-deep .btn-ripple {\n  position: relative;\n  overflow: hidden;\n}\n:host ::ng-deep .btn-ripple::after {\n  content: "";\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n  background-image:\n    radial-gradient(\n      circle,\n      #fff 10%,\n      transparent 10.01%);\n  background-repeat: no-repeat;\n  background-position: 50%;\n  transform: scale(10, 10);\n  opacity: 0;\n  transition: transform 0.5s, opacity 0.5s;\n}\n:host ::ng-deep .btn-ripple:active::after {\n  transform: scale(0, 0);\n  opacity: 0.3;\n  transition: 0s;\n}\n:host ::ng-deep .animate-number {\n  animation: number-pop 0.3s ease-out;\n}\n@keyframes number-pop {\n  0% {\n    transform: scale(1);\n  }\n  50% {\n    transform: scale(1.2);\n  }\n  100% {\n    transform: scale(1);\n  }\n}\n:host ::ng-deep .gradient-border {\n  position: relative;\n  background:\n    linear-gradient(var(--card-bg), var(--card-bg)) padding-box,\n    linear-gradient(\n      135deg,\n      #06b6d4,\n      #8b5cf6) border-box;\n  border: 1px solid transparent;\n}\n/*# sourceMappingURL=app.component.css.map */\n'] }]
  }], () => [], { onboardingComponent: [{
    type: ViewChild,
    args: ["onboardingRef"]
  }], monitoringGroupsRef: [{
    type: ViewChild,
    args: ["monitoringGroupsRef"]
  }], onDocumentClick: [{
    type: HostListener,
    args: ["document:click", ["$event"]]
  }] });
})();
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && \u0275setClassDebugInfo(AppComponent, { className: "AppComponent", filePath: "src/app.component.ts", lineNumber: 326 });
})();

// src/guards/auth.guard.ts
var ROUTE_PERMISSIONS = {
  // 核心功能 - 無限制
  "dashboard": {},
  "accounts": {},
  "settings": {},
  // 營銷功能 - 基礎會員
  "leads": {
    requiredFeature: "leadManagement",
    membershipLevel: "bronze",
    membershipMessage: "\u6F5B\u5728\u5BA2\u6236\u7BA1\u7406\u9700\u8981\u9752\u9285\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"
  },
  "automation": {
    requiredFeature: "automation",
    membershipLevel: "silver",
    membershipMessage: "\u81EA\u52D5\u5316\u4E2D\u5FC3\u9700\u8981\u767D\u9280\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"
  },
  "resource-discovery": {
    requiredFeature: "resourceDiscovery",
    membershipLevel: "bronze",
    membershipMessage: "\u8CC7\u6E90\u767C\u73FE\u9700\u8981\u9752\u9285\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"
  },
  // AI 功能 - 高級會員
  "ai-center": {
    requiredFeature: "aiCenter",
    membershipLevel: "gold",
    membershipMessage: "AI \u4E2D\u5FC3\u9700\u8981\u9EC3\u91D1\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"
  },
  "multi-role": {
    requiredFeature: "multiRole",
    membershipLevel: "diamond",
    membershipMessage: "\u591A\u89D2\u8272\u5354\u4F5C\u9700\u8981\u947D\u77F3\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"
  },
  // 數據分析 - 高級會員
  "analytics": {
    requiredFeature: "dataInsightsBasic",
    membershipLevel: "gold",
    membershipMessage: "\u6578\u64DA\u5206\u6790\u9700\u8981\u9EC3\u91D1\u6703\u54E1\u6216\u4EE5\u4E0A\u7B49\u7D1A"
  },
  // 系統功能 - 無限制
  "monitoring": {}
};
var MEMBERSHIP_PRIORITY = {
  "free": 0,
  "bronze": 1,
  "silver": 2,
  "gold": 3,
  "diamond": 4,
  "star": 5,
  "king": 6
};
function checkMembershipLevel(currentLevel, requiredLevel) {
  const current = MEMBERSHIP_PRIORITY[currentLevel] ?? 0;
  const required = MEMBERSHIP_PRIORITY[requiredLevel] ?? 0;
  return current >= required;
}
var membershipGuard = (route, state) => {
  const membershipService = inject(MembershipService);
  const toastService = inject(ToastService);
  const router = inject(Router);
  const currentLevel = membershipService.level();
  if (currentLevel === "king") {
    return true;
  }
  const path2 = route.routeConfig?.path || "";
  const permission = ROUTE_PERMISSIONS[path2];
  if (!permission || !permission.requiredFeature && !permission.membershipLevel) {
    return true;
  }
  if (permission.requiredFeature) {
    const hasFeature = membershipService.hasFeature(permission.requiredFeature);
    if (!hasFeature) {
      toastService.warning(permission.membershipMessage || "\u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u4E0D\u8DB3\u4EE5\u4F7F\u7528\u6B64\u529F\u80FD");
      router.navigate(["/dashboard"]);
      return false;
    }
  }
  if (permission.membershipLevel) {
    const memberLevel = membershipService.membership()?.level || "free";
    if (!checkMembershipLevel(memberLevel, permission.membershipLevel)) {
      toastService.warning(permission.membershipMessage || "\u60A8\u7684\u6703\u54E1\u7B49\u7D1A\u4E0D\u8DB3\u4EE5\u4F7F\u7528\u6B64\u529F\u80FD");
      router.navigate(["/dashboard"]);
      return false;
    }
  }
  return true;
};

// src/app.routes.ts
var routes = [
  // 認證路由（公開）
  {
    path: "auth",
    loadChildren: () => import("./chunk-AV65AVMD.js").then((m) => m.AUTH_ROUTES)
  },
  // 簡化路由
  {
    path: "login",
    redirectTo: "auth/login",
    pathMatch: "full"
  },
  {
    path: "register",
    redirectTo: "auth/register",
    pathMatch: "full"
  },
  {
    path: "",
    redirectTo: "dashboard",
    pathMatch: "full"
  },
  // 核心功能 - SaaS 模式需要登入
  {
    path: "dashboard",
    loadComponent: () => import("./chunk-SCVERDCC.js").then((m) => m.DashboardViewComponent),
    title: "\u5100\u8868\u677F",
    canActivate: [authGuard]
  },
  {
    path: "accounts",
    loadComponent: () => import("./chunk-MNOUWP3H.js").then((m) => m.AccountsViewComponent),
    title: "\u5E33\u865F\u7BA1\u7406",
    canActivate: [authGuard]
  },
  {
    path: "settings",
    loadComponent: () => import("./chunk-CUMVDTBZ.js").then((m) => m.SettingsViewComponent),
    title: "\u8A2D\u5B9A",
    canActivate: [authGuard]
  },
  // 用戶設置頁面
  {
    path: "user-settings",
    loadComponent: () => import("./chunk-2Y7VKGTH.js").then((m) => m.UserSettingsViewComponent),
    title: "\u7528\u6236\u8A2D\u7F6E",
    canActivate: [authGuard]
  },
  // 訂閱升級頁面
  {
    path: "upgrade",
    loadComponent: () => import("./chunk-46GAQ4U7.js").then((m) => m.UpgradeViewComponent),
    title: "\u5347\u7D1A\u65B9\u6848",
    canActivate: [authGuard]
  },
  // 配額管理儀表板
  {
    path: "quota",
    loadComponent: () => import("./chunk-6TB3IBLJ.js").then((m) => m.QuotaDashboardViewComponent),
    title: "\u914D\u984D\u7BA1\u7406",
    canActivate: [authGuard]
  },
  // 計費管理
  {
    path: "billing",
    loadComponent: () => import("./chunk-SP7VEJHP.js").then((m) => m.BillingViewComponent),
    title: "\u8A08\u8CBB\u7BA1\u7406",
    canActivate: [authGuard]
  },
  // 支付中心
  {
    path: "payment",
    loadComponent: () => import("./chunk-TN2WDBWG.js").then((m) => m.PaymentViewComponent),
    title: "\u652F\u4ED8\u4E2D\u5FC3",
    canActivate: [authGuard]
  },
  // 🆕 Phase 0: 錢包系統
  {
    path: "wallet",
    loadComponent: () => import("./chunk-3PGBHSQF.js").then((m) => m.WalletViewComponent),
    title: "\u6211\u7684\u9322\u5305",
    canActivate: [authGuard]
  },
  {
    path: "wallet/transactions",
    loadComponent: () => import("./chunk-AEHAXNJ2.js").then((m) => m.WalletTransactionsComponent),
    title: "\u4EA4\u6613\u8A18\u9304",
    canActivate: [authGuard]
  },
  {
    path: "wallet/recharge",
    loadComponent: () => import("./chunk-CGAGAHOF.js").then((m) => m.WalletRechargeComponent),
    title: "\u5145\u503C\u4E2D\u5FC3",
    canActivate: [authGuard]
  },
  // 🆕 Phase 3: 錢包高級功能
  {
    path: "wallet/orders",
    loadComponent: () => import("./chunk-6KFBTQIS.js").then((m) => m.WalletOrdersComponent),
    title: "\u5145\u503C\u8A02\u55AE",
    canActivate: [authGuard]
  },
  {
    path: "wallet/analytics",
    loadComponent: () => import("./chunk-XSVIHDNO.js").then((m) => m.WalletAnalyticsComponent),
    title: "\u6D88\u8CBB\u5206\u6790",
    canActivate: [authGuard]
  },
  // 🆕 Phase 4: 提現功能
  {
    path: "wallet/withdraw",
    loadComponent: () => import("./chunk-K6HEGIKH.js").then((m) => m.WalletWithdrawComponent),
    title: "\u63D0\u73FE",
    canActivate: [authGuard]
  },
  // 營銷功能 - 需要會員權限
  {
    path: "leads",
    loadComponent: () => import("./chunk-2HE35X3R.js").then((m) => m.LeadsViewComponent),
    title: "\u6F5B\u5728\u5BA2\u6236",
    canActivate: [membershipGuard]
  },
  {
    path: "automation",
    loadComponent: () => import("./chunk-AXQ2RNLY.js").then((m) => m.AutomationViewComponent),
    title: "\u81EA\u52D5\u5316\u4E2D\u5FC3",
    canActivate: [membershipGuard]
  },
  {
    path: "resource-discovery",
    loadComponent: () => import("./chunk-XMIBLV5E.js").then((m) => m.ResourceDiscoveryViewComponent),
    title: "\u8CC7\u6E90\u767C\u73FE",
    canActivate: [membershipGuard]
  },
  // ============ 🆕 重構後的核心模塊 ============
  // 營銷任務中心（核心入口）
  {
    path: "marketing-hub",
    loadComponent: () => import("./chunk-4S7TKFLO.js").then((m) => m.SmartMarketingViewComponent),
    title: "\u71DF\u92B7\u4EFB\u52D9\u4E2D\u5FC3",
    canActivate: [membershipGuard]
  },
  // 角色資源庫（原多角色協作的資產部分）
  {
    path: "role-library",
    loadComponent: () => import("./chunk-UXFDWNWG.js").then((m) => m.MultiRoleViewComponent),
    title: "\u89D2\u8272\u8CC7\u6E90\u5EAB",
    canActivate: [membershipGuard]
  },
  // 智能引擎（原 AI 中心的配置部分）
  {
    path: "ai-engine",
    loadComponent: () => import("./chunk-6LK3M3PG.js").then((m) => m.AiCenterViewComponent),
    title: "\u667A\u80FD\u5F15\u64CE",
    canActivate: [membershipGuard]
  },
  // ============ 舊路由（保持兼容，重定向到新模塊） ============
  {
    path: "ai-center",
    redirectTo: "ai-engine",
    pathMatch: "full"
  },
  {
    path: "multi-role",
    redirectTo: "role-library",
    pathMatch: "full"
  },
  {
    path: "smart-marketing",
    redirectTo: "marketing-hub",
    pathMatch: "full"
  },
  // 數據分析 - 需要高級會員
  {
    path: "analytics",
    loadComponent: () => import("./chunk-FL74WIPM.js").then((m) => m.AnalyticsViewComponent),
    title: "\u6578\u64DA\u5206\u6790",
    canActivate: [membershipGuard]
  },
  // 系統功能 - 無權限限制
  {
    path: "monitoring",
    loadComponent: () => import("./chunk-JOPGMT5L.js").then((m) => m.MonitoringViewComponent),
    title: "\u76E3\u63A7\u4E2D\u5FC3"
  },
  // 向下兼容舊路由（重定向到設置頁）
  {
    path: "performance",
    redirectTo: "settings",
    pathMatch: "full"
  },
  {
    path: "alerts",
    redirectTo: "settings",
    pathMatch: "full"
  },
  // 404 fallback
  {
    path: "**",
    redirectTo: "dashboard"
  }
];
var VIEW_ROUTE_MAP = {
  // 核心
  "dashboard": "/dashboard",
  "accounts": "/accounts",
  "settings": "/settings",
  // 🆕 錢包系統
  "wallet": "/wallet",
  "wallet-transactions": "/wallet/transactions",
  "wallet-recharge": "/wallet/recharge",
  "wallet-orders": "/wallet/orders",
  "wallet-analytics": "/wallet/analytics",
  "wallet-withdraw": "/wallet/withdraw",
  // 🆕 營銷任務中心（核心入口）
  "marketing-hub": "/marketing-hub",
  "marketing-tasks": "/marketing-hub",
  "marketing-monitor": "/marketing-hub",
  // 🆕 角色資源庫
  "role-library": "/role-library",
  "role-store": "/role-library",
  "my-roles": "/role-library",
  "scene-templates": "/role-library",
  "script-editor": "/role-library",
  // 🆕 智能引擎
  "ai-engine": "/ai-engine",
  "ai-models": "/ai-engine",
  "ai-brain": "/ai-engine",
  "ai-persona": "/ai-engine",
  // 觸發監控
  "automation": "/automation",
  "monitoring-groups": "/monitoring",
  "keyword-sets": "/monitoring",
  "trigger-rules": "/monitoring",
  "chat-templates": "/monitoring",
  "collected-users": "/monitoring",
  // 客戶管理
  "leads": "/leads",
  "lead-nurturing": "/leads",
  "member-database": "/leads",
  "user-tracking": "/leads",
  // 數據分析
  "analytics": "/analytics",
  "analytics-center": "/analytics",
  "search-discovery": "/resource-discovery",
  // 系統
  "monitoring": "/monitoring",
  "performance": "/settings",
  "alerts": "/settings",
  // 舊路由（兼容）
  "ai-center": "/ai-engine",
  "multi-role": "/role-library",
  "smart-marketing": "/marketing-hub"
};
var ROUTE_VIEW_MAP = Object.entries(VIEW_ROUTE_MAP).reduce((acc, [view, route]) => {
  acc[route] = view;
  return acc;
}, {});

// index.tsx
console.log("[Bootstrap] index.tsx loaded, starting Angular bootstrap...");
console.log("[Bootstrap] Angular imports completed");
console.log("[Bootstrap] AppComponent and routes imported, calling bootstrapApplication...");
bootstrapApplication(AppComponent, {
  providers: [
    provideZonelessChangeDetection(),
    provideHttpClient(),
    provideAnimations(),
    provideRouter(routes)
    // 🔧 關鍵：添加路由配置
  ]
}).then(() => {
  console.log("[TG-AI\u667A\u63A7\u738B] Application started successfully");
  setTimeout(() => {
    window.dispatchEvent(new CustomEvent("angular-ready"));
    console.log("[TG-AI\u667A\u63A7\u738B] angular-ready event dispatched");
  }, 50);
}).catch((err) => {
  console.error("[TG-AI\u667A\u63A7\u738B] Application failed to start:", err);
  const loading = document.getElementById("app-loading");
  const errorContainer = document.getElementById("error-container");
  const errorMessage = document.getElementById("error-message");
  const status = document.getElementById("loading-status");
  const progress = document.getElementById("loading-progress");
  if (status)
    status.textContent = "\u8F09\u5165\u5931\u6557";
  if (progress) {
    progress.style.background = "#ef4444";
    progress.style.width = "100%";
  }
  if (errorContainer)
    errorContainer.style.display = "block";
  if (errorMessage)
    errorMessage.textContent = "\u932F\u8AA4: " + (err?.message || err);
});
/*! Bundled license information:

@angular/animations/fesm2022/_util-chunk.mjs:
@angular/animations/fesm2022/browser.mjs:
@angular/platform-browser/fesm2022/animations.mjs:
  (**
   * @license Angular v21.0.6
   * (c) 2010-2025 Google LLC. https://angular.dev/
   * License: MIT
   *)

@google/genai/dist/web/index.mjs:
@google/genai/dist/web/index.mjs:
@google/genai/dist/web/index.mjs:
@google/genai/dist/web/index.mjs:
@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
//# sourceMappingURL=main.js.map
