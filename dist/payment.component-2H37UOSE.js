import{a as F,b as P}from"./chunk-7LTHB4NI.js";import{b as G,c as Z,f as z,t as K}from"./chunk-FZJM4IRN.js";import"./chunk-B2KG2WNU.js";import"./chunk-TMNXXRHZ.js";import"./chunk-K5SU4RX2.js";import{Aa as c,Bb as s,Cb as b,Db as C,Eb as j,Ib as L,Jb as $,Kb as H,M as E,Na as R,R as x,W as u,X as m,Y as M,Z as B,a as D,b as w,cb as f,da as I,db as _,ga as v,gb as U,hb as O,ib as T,jb as i,kb as a,lb as V,pb as y,rb as h,tb as d,uc as q,zb as S}from"./chunk-PDD6YQ47.js";var X="tgai-license-secret-2026",N=class o{constructor(){this.ngZone=x(I);this._machineId=v("");this._deviceFingerprint=v("");this.tokenRefreshInterval=null;this.lastTokenRefresh=v(null);this.initializeDeviceInfo(),this.startTokenRefreshTimer()}ngOnDestroy(){this.stopTokenRefreshTimer()}initializeDeviceInfo(){this._machineId.set(this.getMachineId()),this._deviceFingerprint.set(this.generateDeviceFingerprint())}getMachineId(){let t=localStorage.getItem("tgai-machine-id");return t||(t=this.generateMachineId(),localStorage.setItem("tgai-machine-id",t)),t}generateMachineId(){let t=[navigator.userAgent,navigator.language,screen.width,screen.height,screen.colorDepth,new Date().getTimezoneOffset(),navigator.hardwareConcurrency||0,navigator.deviceMemory||0];return`M-${this.hashString(t.join("|")).substring(0,16).toUpperCase()}`}generateDeviceFingerprint(){let t=[navigator.userAgent,navigator.platform,navigator.language,screen.width+"x"+screen.height,screen.colorDepth,new Date().getTimezoneOffset(),navigator.hardwareConcurrency||0,navigator.deviceMemory||0,navigator.maxTouchPoints||0,this.getCanvasFingerprint(),this.getWebGLFingerprint()];return this.hashString(t.join("::"))}getCanvasFingerprint(){try{let t=document.createElement("canvas"),e=t.getContext("2d");return e?(e.textBaseline="top",e.font="14px Arial",e.fillStyle="#f60",e.fillRect(125,1,62,20),e.fillStyle="#069",e.fillText("TG-AI\u667A\u63A7\u738B",2,15),e.fillStyle="rgba(102, 204, 0, 0.7)",e.fillText("TG-AI\u667A\u63A7\u738B",4,17),t.toDataURL().substring(0,100)):""}catch{return""}}getWebGLFingerprint(){try{let t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");if(!e)return"";let r=e.getExtension("WEBGL_debug_renderer_info");if(r){let n=e.getParameter(r.UNMASKED_VENDOR_WEBGL),l=e.getParameter(r.UNMASKED_RENDERER_WEBGL);return`${n}|${l}`}return""}catch{return""}}generateRequestSignature(t,e,r){let n=`${t}:${e}:${r}:${X}`;return this.hashString(n)}generateNonce(){let t=new Uint8Array(16);return crypto.getRandomValues(t),Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}createSecureHeaders(){let t=Math.floor(Date.now()/1e3),e=this.generateNonce(),r=this._machineId();return{"X-Signature":this.generateRequestSignature(t,e,r),"X-Timestamp":t.toString(),"X-Nonce":e,"X-Machine-Id":r}}createSignedRequestBody(t){let e=Math.floor(Date.now()/1e3),r=this.generateNonce();return w(D({},t),{timestamp:e,nonce:r,machine_id:this._machineId(),device_fingerprint:this._deviceFingerprint()})}startTokenRefreshTimer(){this.tokenRefreshInterval=setInterval(()=>{this.ngZone.run(()=>{window.dispatchEvent(new CustomEvent("refresh-token"))})},1200*60*1e3)}stopTokenRefreshTimer(){this.tokenRefreshInterval&&(clearInterval(this.tokenRefreshInterval),this.tokenRefreshInterval=null)}shouldRefreshToken(t){return t?(t.getTime()-Date.now())/(1e3*60*60)<4:!1}hashString(t){return this.sha256(t)}sha256(t){let r=new TextEncoder().encode(t),n=0;for(let g=0;g<t.length;g++){let p=t.charCodeAt(g);n=(n<<5)-n+p,n=n&n}let l=Math.abs(n).toString(16).padStart(8,"0");return(l+l+l+l+l+l+l+l).substring(0,64)}async sha256Async(t){let e=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(r)).map(l=>l.toString(16).padStart(2,"0")).join("")}get machineId(){return this._machineId()}get deviceFingerprint(){return this._deviceFingerprint()}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=E({token:o,factory:o.\u0275fac,providedIn:"root"})}};var A=class o{constructor(){this.membershipService=x(F);this.toastService=x(P);this.securityService=x(N);this.ngZone=x(I);this.serverUrl=v("");this.token=v(null);this.heartbeatInterval=null;this.tokenRefreshInterval=null;this.isOnline=v(!0);this.lastHeartbeat=v(null);this.offlineGracePeriod=10080*60*1e3;this.products=[{id:"silver_week",level:"silver",levelName:"\u767D\u9280\u7CBE\u82F1",levelIcon:"\u{1F948}",duration:"week",durationName:"\u5468\u5361",price:1.99},{id:"silver_month",level:"silver",levelName:"\u767D\u9280\u7CBE\u82F1",levelIcon:"\u{1F948}",duration:"month",durationName:"\u6708\u5361",price:4.99},{id:"silver_quarter",level:"silver",levelName:"\u767D\u9280\u7CBE\u82F1",levelIcon:"\u{1F948}",duration:"quarter",durationName:"\u5B63\u5361",price:12.99},{id:"silver_year",level:"silver",levelName:"\u767D\u9280\u7CBE\u82F1",levelIcon:"\u{1F948}",duration:"year",durationName:"\u5E74\u5361",price:49.9},{id:"gold_week",level:"gold",levelName:"\u9EC3\u91D1\u5927\u5E2B",levelIcon:"\u{1F947}",duration:"week",durationName:"\u5468\u5361",price:6.99},{id:"gold_month",level:"gold",levelName:"\u9EC3\u91D1\u5927\u5E2B",levelIcon:"\u{1F947}",duration:"month",durationName:"\u6708\u5361",price:19.9},{id:"gold_quarter",level:"gold",levelName:"\u9EC3\u91D1\u5927\u5E2B",levelIcon:"\u{1F947}",duration:"quarter",durationName:"\u5B63\u5361",price:49.9},{id:"gold_year",level:"gold",levelName:"\u9EC3\u91D1\u5927\u5E2B",levelIcon:"\u{1F947}",duration:"year",durationName:"\u5E74\u5361",price:199},{id:"diamond_week",level:"diamond",levelName:"\u947D\u77F3\u738B\u724C",levelIcon:"\u{1F48E}",duration:"week",durationName:"\u5468\u5361",price:19.9},{id:"diamond_month",level:"diamond",levelName:"\u947D\u77F3\u738B\u724C",levelIcon:"\u{1F48E}",duration:"month",durationName:"\u6708\u5361",price:59.9},{id:"diamond_quarter",level:"diamond",levelName:"\u947D\u77F3\u738B\u724C",levelIcon:"\u{1F48E}",duration:"quarter",durationName:"\u5B63\u5361",price:149},{id:"diamond_year",level:"diamond",levelName:"\u947D\u77F3\u738B\u724C",levelIcon:"\u{1F48E}",duration:"year",durationName:"\u5E74\u5361",price:599},{id:"star_week",level:"star",levelName:"\u661F\u8000\u50B3\u8AAA",levelIcon:"\u{1F31F}",duration:"week",durationName:"\u5468\u5361",price:59.9},{id:"star_month",level:"star",levelName:"\u661F\u8000\u50B3\u8AAA",levelIcon:"\u{1F31F}",duration:"month",durationName:"\u6708\u5361",price:199},{id:"star_quarter",level:"star",levelName:"\u661F\u8000\u50B3\u8AAA",levelIcon:"\u{1F31F}",duration:"quarter",durationName:"\u5B63\u5361",price:499},{id:"star_year",level:"star",levelName:"\u661F\u8000\u50B3\u8AAA",levelIcon:"\u{1F31F}",duration:"year",durationName:"\u5E74\u5361",price:1999},{id:"king_week",level:"king",levelName:"\u69AE\u8000\u738B\u8005",levelIcon:"\u{1F451}",duration:"week",durationName:"\u5468\u5361",price:199},{id:"king_month",level:"king",levelName:"\u69AE\u8000\u738B\u8005",levelIcon:"\u{1F451}",duration:"month",durationName:"\u6708\u5361",price:599},{id:"king_quarter",level:"king",levelName:"\u69AE\u8000\u738B\u8005",levelIcon:"\u{1F451}",duration:"quarter",durationName:"\u5B63\u5361",price:1499},{id:"king_year",level:"king",levelName:"\u69AE\u8000\u738B\u8005",levelIcon:"\u{1F451}",duration:"year",durationName:"\u5E74\u5361",price:5999},{id:"king_lifetime",level:"king",levelName:"\u69AE\u8000\u738B\u8005",levelIcon:"\u{1F451}",duration:"lifetime",durationName:"\u7D42\u8EAB",price:14999}];this.loadToken(),this.loadServerUrl(),this.startHeartbeat(),this.startTokenRefresh(),this.listenForTokenRefresh()}ngOnDestroy(){this.stopHeartbeat(),this.stopTokenRefresh()}loadToken(){let t=localStorage.getItem("tgai-license-token");t&&this.token.set(t)}loadServerUrl(){let t=localStorage.getItem("tgai-license-server");t&&this.serverUrl.set(t)}saveToken(t){this.token.set(t),localStorage.setItem("tgai-license-token",t)}clearToken(){this.token.set(null),localStorage.removeItem("tgai-license-token")}startTokenRefresh(){this.tokenRefreshInterval=setInterval(()=>{this.ngZone.run(()=>{this.refreshToken()})},1200*60*1e3)}stopTokenRefresh(){this.tokenRefreshInterval&&(clearInterval(this.tokenRefreshInterval),this.tokenRefreshInterval=null)}listenForTokenRefresh(){window.addEventListener("refresh-token",()=>{this.refreshToken()})}async refreshToken(){if(!this.isServerConfigured()||!this.token())return{success:!1,message:"\u672A\u914D\u7F6E\u670D\u52D9\u5668\u6216\u7121 Token"};try{let t=this.securityService.createSignedRequestBody({token:this.token(),machine_id:this.securityService.machineId,device_fingerprint:this.securityService.deviceFingerprint}),e=this.securityService.createSecureHeaders(),n=await(await fetch(`${this.serverUrl()}/api/token/refresh`,{method:"POST",headers:D({"Content-Type":"application/json"},e),body:JSON.stringify(t)})).json();return n.success&&n.data?.token?(this.saveToken(n.data.token),{success:!0,message:"Token \u5237\u65B0\u6210\u529F"}):{success:!1,message:n.message||"Token \u5237\u65B0\u5931\u6557"}}catch{return{success:!1,message:"\u7DB2\u7D61\u932F\u8AA4"}}}setServerUrl(t){this.serverUrl.set(t.replace(/\/$/,"")),localStorage.setItem("tgai-license-server",t)}getServerUrl(){return this.serverUrl()}isServerConfigured(){return!!this.serverUrl()}async validateLicense(t){if(!this.isServerConfigured())return this.localValidate(t);try{let r=await(await fetch(`${this.serverUrl()}/api/license/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({license_key:t})})).json();return this.isOnline.set(!0),{success:r.success,message:r.message,data:r.data}}catch{return this.isOnline.set(!1),this.localValidate(t)}}async activateLicense(t,e="",r=""){let n=this.getMachineId(),l=this.getDeviceId();if(!this.isServerConfigured()){let g=await this.membershipService.activateMembership(t,e);return{success:g.success,message:g.message}}try{let p=await(await fetch(`${this.serverUrl()}/api/license/activate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({license_key:t,machine_id:n,device_id:l,email:e,invite_code:r})})).json();if(this.isOnline.set(!0),p.success){p.data?.token&&this.saveToken(p.data.token);let de=await this.membershipService.activateMembership(t,e);if(!p.data?.level||!p.data?.expiresAt){let k=this.membershipService.membership();k&&(p.data=w(D({},p.data),{level:k.level,levelName:k.levelName,levelIcon:k.levelIcon,expiresAt:k.expiresAt?.toISOString()||"",durationDays:30}))}}return{success:p.success,message:p.message,data:p.data}}catch{this.isOnline.set(!1);let p=await this.membershipService.activateMembership(t,e);return{success:p.success,message:p.message+" (\u96E2\u7DDA\u6A21\u5F0F)"}}}async sendHeartbeat(){if(!this.isServerConfigured()||!this.token())return{success:!0,message:"\u96E2\u7DDA\u6A21\u5F0F"};try{let t=this.membershipService.usage(),r=await(await fetch(`${this.serverUrl()}/api/license/heartbeat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:this.token(),machine_id:this.getMachineId(),usage:t})})).json();return this.ngZone.run(()=>{this.isOnline.set(!0),this.lastHeartbeat.set(new Date),localStorage.setItem("tgai-last-online",Date.now().toString()),r.success&&r.data?.token&&this.saveToken(r.data.token),r.data?.isExpired&&this.toastService.warning("\u60A8\u7684\u6703\u54E1\u5DF2\u904E\u671F\uFF0C\u8ACB\u7E8C\u8CBB\u7E7C\u7E8C\u4F7F\u7528")}),{success:r.success,message:r.message,data:r.data}}catch{this.ngZone.run(()=>{this.isOnline.set(!1)});let e=localStorage.getItem("tgai-last-online");return e&&Date.now()-parseInt(e)>this.offlineGracePeriod?{success:!1,message:"\u96E2\u7DDA\u6642\u9593\u904E\u9577\uFF0C\u8ACB\u9023\u63A5\u7DB2\u7D61\u9A57\u8B49"}:{success:!0,message:"\u96E2\u7DDA\u6A21\u5F0F"}}}async getUserProfile(){if(!this.isServerConfigured()||!this.token())return{success:!1};try{let e=await(await fetch(`${this.serverUrl()}/api/user/profile`,{headers:{Authorization:`Bearer ${this.token()}`,"Content-Type":"application/json"}})).json();return{success:e.success,data:e.data}}catch{return{success:!1}}}async getActivationHistory(t=50,e=0){if(!this.isServerConfigured())return{success:!1};try{let r=this.getMachineId(),n=`${this.serverUrl()}/api/user/activation-history?machine_id=${r}&limit=${t}&offset=${e}`,l={"Content-Type":"application/json"};this.token()&&(l.Authorization=`Bearer ${this.token()}`);let p=await(await fetch(n,{headers:l})).json();return{success:p.success,data:p.data||[]}}catch{return{success:!1,data:[]}}}async getUserQuota(){if(!this.isServerConfigured()||!this.token())return{success:!1};try{let e=await(await fetch(`${this.serverUrl()}/api/user/quota`,{headers:{Authorization:`Bearer ${this.token()}`,"Content-Type":"application/json"}})).json();return{success:e.success,data:e.data}}catch{return{success:!1}}}async getUsageStats(){if(!this.isServerConfigured())return{success:!1};try{let t=this.getMachineId(),e=`${this.serverUrl()}/api/user/usage-stats?machine_id=${t}`,r={"Content-Type":"application/json"};this.token()&&(r.Authorization=`Bearer ${this.token()}`);let l=await(await fetch(e,{headers:r})).json();return{success:l.success,stats:l.stats}}catch{return{success:!1}}}async getInviteInfo(){if(!this.isServerConfigured()||!this.token())return{success:!1};try{let e=await(await fetch(`${this.serverUrl()}/api/invite/info`,{headers:{Authorization:`Bearer ${this.token()}`,"Content-Type":"application/json"}})).json();return{success:e.success,data:e.data}}catch{return{success:!1}}}async getInviteList(){if(!this.isServerConfigured()||!this.token())return{success:!1};try{let e=await(await fetch(`${this.serverUrl()}/api/invite/list`,{headers:{Authorization:`Bearer ${this.token()}`,"Content-Type":"application/json"}})).json();return{success:e.success,data:e.data}}catch{return{success:!1}}}async fetchProducts(){if(!this.isServerConfigured())return{success:!0,data:this.products};try{let e=await(await fetch(`${this.serverUrl()}/api/products`)).json();return{success:e.success,data:e.data}}catch{return{success:!0,data:this.products}}}async createPayment(t,e="usdt"){if(!this.isServerConfigured())return{success:!1,message:"\u8ACB\u806F\u7E6B\u5BA2\u670D\u8CFC\u8CB7\u5361\u5BC6"};try{let n=await(await fetch(`${this.serverUrl()}/api/payment/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:t,machine_id:this.getMachineId(),payment_method:e})})).json();return n.success?{success:!0,message:"\u8A02\u55AE\u5275\u5EFA\u6210\u529F",order:n.data}:{success:!1,message:n.message}}catch{return{success:!1,message:"\u5275\u5EFA\u8A02\u55AE\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66"}}}async checkPaymentStatus(t){if(!this.isServerConfigured())return{success:!1,paid:!1,message:"\u670D\u52D9\u5668\u672A\u914D\u7F6E"};try{let r=await(await fetch(`${this.serverUrl()}/api/payment/status/${t}`)).json();return{success:r.success,paid:r.data?.status==="paid",licenseKey:r.data?.license_key,message:r.message}}catch{return{success:!1,paid:!1,message:"\u67E5\u8A62\u652F\u4ED8\u72C0\u614B\u5931\u6557"}}}startHeartbeat(){this.heartbeatInterval=setInterval(()=>{this.sendHeartbeat()},300*1e3),setTimeout(()=>this.sendHeartbeat(),5e3),window.addEventListener("online",()=>{this.isOnline.set(!0),localStorage.setItem("tgai-last-online",Date.now().toString()),this.sendHeartbeat()}),window.addEventListener("offline",()=>{this.isOnline.set(!1)})}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}getMachineId(){let t=localStorage.getItem("tgai-machine-id");return t||(t="mid-"+this.generateId(),localStorage.setItem("tgai-machine-id",t)),t}getDeviceId(){let t=localStorage.getItem("tgai-device-id");return t||(t="dev-"+this.generateId().substring(0,12),localStorage.setItem("tgai-device-id",t)),t}generateId(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}localValidate(t){let e=/^TGAI-([BGDSK][123YL]|EXT)-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/i;if(!t.toUpperCase().match(e)){let n=/^TGM-([BGDSK][123Y])-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/i;if(!t.toUpperCase().match(n))return{success:!1,message:"\u5361\u5BC6\u683C\u5F0F\u4E0D\u6B63\u78BA"}}return{success:!0,message:"\u5361\u5BC6\u683C\u5F0F\u6709\u6548 (\u96E2\u7DDA\u9A57\u8B49)",data:{level:"gold",levelName:"\u9EC3\u91D1\u5927\u5E2B",levelIcon:"\u{1F947}",expiresAt:"",durationDays:30}}}getProductsByLevel(){let t={bronze:[],silver:[],gold:[],diamond:[],star:[],king:[]};for(let e of this.products)t[e.level]&&t[e.level].push(e);return t}getRecommendedProducts(){return[this.products.find(t=>t.id==="gold_month"),this.products.find(t=>t.id==="diamond_month"),this.products.find(t=>t.id==="star_year")].filter(Boolean)}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=E({token:o,factory:o.\u0275fac,providedIn:"root"})}};var Y=(o,t)=>t.id;function Q(o,t){o&1&&(i(0,"div",21),s(1," \u63A8\u85A6 "),a())}function ee(o,t){o&1&&(i(0,"div",22),s(1," \u71B1\u9580 "),a())}function te(o,t){if(o&1){let e=y();i(0,"div",20),h("click",function(){let n=u(e).$implicit,l=d(3);return m(l.selectProduct(n))}),f(1,Q,2,0,"div",21),f(2,ee,2,0,"div",22),i(3,"div",23)(4,"div",24),s(5),a(),i(6,"div",25),s(7),a(),i(8,"div",26)(9,"span",27),s(10),a()(),i(11,"div",28),s(12,"TRC20 \u7DB2\u7D61"),a()()()}if(o&2){let e,r,n,l=t.$implicit,g=d(3);S("border-cyan-500",((e=g.selectedProduct())==null?null:e.id)===l.id)("bg-cyan-500/10",((r=g.selectedProduct())==null?null:r.id)===l.id)("border-slate-600",((n=g.selectedProduct())==null?null:n.id)!==l.id),c(),_(l.recommended?1:-1),c(),_(l.popular?2:-1),c(3),b(l.levelName),c(2),b(l.durationName),c(3),C("",l.price," USDT")}}function ne(o,t){if(o&1){let e=y();i(0,"div",15),U(1,te,13,11,"div",16,Y),a(),i(3,"div",17)(4,"button",18),h("click",function(){u(e);let n=d(2);return m(n.close())}),s(5," \u53D6\u6D88 "),a(),i(6,"button",19),h("click",function(){u(e);let n=d(2);return m(n.proceedToPayment())}),s(7," \u4E0B\u4E00\u6B65 "),a()()}if(o&2){let e=d(2);c(),O(e.products),c(5),T("disabled",!e.selectedProduct())}}function ie(o,t){if(o&1&&(i(0,"div",41)(1,"div",43)(2,"span"),s(3,"\u{1F48E}"),a(),i(4,"span",44),s(5,"USDT-TRC20 \u652F\u4ED8\uFF08\u63A8\u85A6\uFF09"),a()(),i(6,"div",45)(7,"div",46)(8,"div",47),s(9,"\u652F\u4ED8\u91D1\u984D"),a(),i(10,"div",48),s(11),a()(),i(12,"div",46)(13,"div",47),s(14,"\u7DB2\u7D61"),a(),i(15,"div",49),s(16,"TRC20"),a()()(),i(17,"div",50),s(18," \u26A0\uFE0F \u50C5\u652F\u6301 TRC20 \u7DB2\u7D61\uFF0C\u5176\u4ED6\u7DB2\u7D61\u8F49\u8CEC\u5C07\u7121\u6CD5\u5230\u8CEC "),a()()),o&2){let e,r=d(3);c(11),C("",(e=r.selectedProduct())==null?null:e.price," USDT")}}function re(o,t){if(o&1){let e=y();i(0,"div",29)(1,"div",30),s(2),a(),i(3,"div",31),s(4),a(),i(5,"div",32),s(6,"TRC20 \u7DB2\u7D61"),a()(),i(7,"div",33)(8,"label",34),s(9,"\u90F5\u7BB1 (\u7528\u65BC\u63A5\u6536\u8A02\u55AE\u901A\u77E5)"),a(),i(10,"input",35),H("ngModelChange",function(n){u(e);let l=d(2);return $(l.email,n)||(l.email=n),m(n)}),a()(),i(11,"div",36)(12,"label",34),s(13,"\u9078\u64C7\u652F\u4ED8\u65B9\u5F0F"),a(),i(14,"div",37)(15,"button",38),h("click",function(){u(e);let n=d(2);return m(n.paymentMethod.set("alipay"))}),i(16,"span",39),s(17,"\u{1F499}"),a(),i(18,"span",40),s(19,"\u652F\u4ED8\u5BF6"),a()(),i(20,"button",38),h("click",function(){u(e);let n=d(2);return m(n.paymentMethod.set("wechat"))}),i(21,"span",39),s(22,"\u{1F49A}"),a(),i(23,"span",40),s(24,"\u5FAE\u4FE1\u652F\u4ED8"),a()(),i(25,"button",38),h("click",function(){u(e);let n=d(2);return m(n.paymentMethod.set("stripe"))}),i(26,"span",39),s(27,"\u{1F4B3}"),a(),i(28,"span",40),s(29,"\u570B\u969B\u5361"),a()(),i(30,"button",38),h("click",function(){u(e);let n=d(2);return m(n.paymentMethod.set("usdt"))}),i(31,"span",39),s(32,"\u{1F48E}"),a(),i(33,"span",40),s(34,"USDT"),a()()(),f(35,ie,19,1,"div",41),a(),i(36,"div",42)(37,"button",18),h("click",function(){u(e);let n=d(2);return m(n.step.set("select"))}),s(38," \u8FD4\u56DE "),a(),i(39,"button",19),h("click",function(){u(e);let n=d(2);return m(n.createOrder())}),s(40),a()()}if(o&2){let e,r,n=d(2);c(2),j("",(e=n.selectedProduct())==null?null:e.levelName," - ",(e=n.selectedProduct())==null?null:e.durationName),c(2),C("",(r=n.selectedProduct())==null?null:r.price," USDT"),c(6),L("ngModel",n.email),c(5),S("border-cyan-500",n.paymentMethod()==="alipay")("bg-cyan-500/10",n.paymentMethod()==="alipay")("border-slate-600",n.paymentMethod()!=="alipay"),c(5),S("border-cyan-500",n.paymentMethod()==="wechat")("bg-cyan-500/10",n.paymentMethod()==="wechat")("border-slate-600",n.paymentMethod()!=="wechat"),c(5),S("border-cyan-500",n.paymentMethod()==="stripe")("bg-cyan-500/10",n.paymentMethod()==="stripe")("border-slate-600",n.paymentMethod()!=="stripe"),c(5),S("border-cyan-500",n.paymentMethod()==="usdt")("bg-cyan-500/10",n.paymentMethod()==="usdt")("border-slate-600",n.paymentMethod()!=="usdt"),c(5),_(n.paymentMethod()==="usdt"?35:-1),c(4),T("disabled",n.isProcessing()),c(),C(" ",n.isProcessing()?"\u8655\u7406\u4E2D...":"\u7ACB\u5373\u652F\u4ED8"," ")}}function se(o,t){if(o&1){let e=y();i(0,"div",57)(1,"div",60)(2,"div",27),s(3),a(),i(4,"div",61),s(5,"TRC20 \u7DB2\u7D61\uFF08TRON\uFF09"),a()(),i(6,"div",33)(7,"div",62),s(8,"\u6536\u6B3E\u5730\u5740\uFF08TRC20\uFF09"),a(),i(9,"div",63)(10,"div",64)(11,"code",65),s(12),a(),i(13,"button",66),h("click",function(){u(e);let n=d(3);return m(n.copyUsdtAddress())}),s(14," \u{1F4CB} \u8907\u88FD "),a()()()(),i(15,"div",67)(16,"div",68)(17,"div",39),s(18,"\u{1F4DD}"),a(),i(19,"div")(20,"div",69),s(21,"\u8F49\u8CEC\u6B65\u9A5F"),a(),i(22,"ol",70)(23,"li"),s(24,"1. \u6253\u958B\u60A8\u7684\u52A0\u5BC6\u8CA8\u5E63\u9322\u5305\uFF08\u5982 Trust Wallet\u3001TokenPocket\uFF09"),a(),i(25,"li"),s(26,"2. \u9078\u64C7 USDT \u8CC7\u7522\uFF0C\u9EDE\u64CA\u300C\u767C\u9001\u300D"),a(),i(27,"li"),s(28,"3. \u7C98\u8CBC\u4E0A\u65B9\u5730\u5740\uFF0C\u9078\u64C7 "),i(29,"span",71),s(30,"TRC20"),a(),s(31," \u7DB2\u7D61"),a(),i(32,"li"),s(33,"4. \u8F38\u5165\u91D1\u984D "),i(34,"span",71),s(35),a()(),i(36,"li"),s(37,"5. \u78BA\u8A8D\u8F49\u8CEC\uFF0C\u7B49\u5F85\u5340\u584A\u78BA\u8A8D"),a()()()()(),i(38,"div",72)(39,"span"),s(40,"\u26A0\uFE0F"),a(),i(41,"div")(42,"strong"),s(43,"\u91CD\u8981\u63D0\u9192\uFF1A"),a(),i(44,"ul",73)(45,"li"),s(46,"\u2022 \u50C5\u652F\u6301 "),i(47,"strong"),s(48,"TRC20"),a(),s(49," \u7DB2\u7D61\uFF0C\u5176\u4ED6\u7DB2\u7D61\u8F49\u8CEC\u5C07\u7121\u6CD5\u5230\u8CEC"),a(),i(50,"li"),s(51,"\u2022 \u8ACB\u78BA\u4FDD\u8F49\u8CEC\u91D1\u984D\u6B63\u78BA\uFF1A"),i(52,"strong"),s(53),a()(),i(54,"li"),s(55,"\u2022 \u8F49\u8CEC\u5F8C\u901A\u5E38 1-5 \u5206\u9418\u5167\u5230\u8CEC"),a()()()()()}if(o&2){let e,r,n,l=d(3);c(3),C("",(e=l.selectedProduct())==null?null:e.price," USDT"),c(9),b(l.USDT_CONFIG.walletAddress),c(23),C("",(r=l.selectedProduct())==null?null:r.price," USDT"),c(18),C("",(n=l.selectedProduct())==null?null:n.price," USDT")}}function ae(o,t){if(o&1){let e=y();i(0,"div",11)(1,"div",51),s(2),a(),i(3,"h3",52),s(4,"\u7B49\u5F85\u652F\u4ED8"),a(),i(5,"p",53),s(6),a(),i(7,"div",54)(8,"div",55),s(9,"\u8A02\u55AE\u865F"),a(),i(10,"div",56),s(11),a()(),f(12,se,56,4,"div",57),i(13,"div",58),s(14),a(),i(15,"div",42)(16,"button",18),h("click",function(){u(e);let n=d(2);return m(n.cancelPayment())}),s(17," \u53D6\u6D88\u652F\u4ED8 "),a(),i(18,"button",59),h("click",function(){u(e);let n=d(2);return m(n.checkPaymentStatus())}),s(19),a()()()}if(o&2){let e,r=d(2);c(2),b(r.paymentMethod()==="usdt"?"\u{1F48E}":"\u23F3"),c(4),C(" ",r.paymentMethod()==="usdt"?"\u8ACB\u5411\u4EE5\u4E0B\u5730\u5740\u8F49\u8CEC USDT":"\u8ACB\u5728\u65B0\u7A97\u53E3\u5B8C\u6210\u652F\u4ED8"," "),c(5),b((e=r.currentOrder())==null?null:e.order_id),c(),_(r.paymentMethod()==="usdt"?12:-1),c(2),C(" ",r.paymentMethod()==="usdt"?"\u8F49\u8CEC\u6210\u529F\u5F8C\u9EDE\u64CA\u300C\u6211\u5DF2\u652F\u4ED8\u300D":"\u652F\u4ED8\u5B8C\u6210\u5F8C\u5C07\u81EA\u52D5\u6FC0\u6D3B\u6703\u54E1"," "),c(4),T("disabled",r.isChecking()),c(),C(" ",r.isChecking()?"\u6AA2\u67E5\u4E2D...":"\u6211\u5DF2\u652F\u4ED8"," ")}}function oe(o,t){if(o&1){let e=y();i(0,"div",74)(1,"div",55),s(2,"\u60A8\u7684\u5361\u5BC6"),a(),i(3,"div",56),s(4),a(),i(5,"button",76),h("click",function(){u(e);let n=d(3);return m(n.copyLicenseKey())}),s(6," \u{1F4CB} \u8907\u88FD\u5361\u5BC6 "),a()()}if(o&2){let e=d(3);c(4),b(e.activatedLicenseKey())}}function le(o,t){if(o&1){let e=y();i(0,"div",11)(1,"div",51),s(2,"\u{1F389}"),a(),i(3,"h3",52),s(4,"\u652F\u4ED8\u6210\u529F\uFF01"),a(),i(5,"p",53),s(6,"\u60A8\u7684\u6703\u54E1\u5DF2\u6FC0\u6D3B"),a(),f(7,oe,7,1,"div",74),i(8,"button",75),h("click",function(){u(e);let n=d(2);return m(n.close())}),s(9," \u958B\u59CB\u4F7F\u7528 "),a()()}if(o&2){let e=d(2);c(7),_(e.activatedLicenseKey()?7:-1)}}function ce(o,t){if(o&1){let e=y();i(0,"div",1),h("click",function(){u(e);let n=d();return m(n.close())}),i(1,"div",2),h("click",function(n){return u(e),m(n.stopPropagation())}),i(2,"div",3)(3,"div",4)(4,"div")(5,"h2",5),s(6," \u{1F4B3} \u5347\u7D1A\u6703\u54E1 "),a(),i(7,"p",6),s(8,"\u9078\u64C7\u9069\u5408\u60A8\u7684\u65B9\u6848"),a()(),i(9,"button",7),h("click",function(){u(e);let n=d();return m(n.close())}),M(),i(10,"svg",8),V(11,"path",9),a()()()(),B(),i(12,"div",10),f(13,ne,8,1),f(14,re,41,31),f(15,ae,20,7,"div",11),f(16,le,10,1,"div",11),i(17,"div",12)(18,"p",13),s(19," \u9047\u5230\u554F\u984C\uFF1F "),i(20,"a",14),s(21,"\u806F\u7E6B\u5BA2\u670D"),a(),s(22," \u6216 "),i(23,"a",14),s(24,"\u67E5\u770B\u5E6B\u52A9"),a()()()()()()}if(o&2){let e=d();c(13),_(e.step()==="select"?13:-1),c(),_(e.step()==="payment"?14:-1),c(),_(e.step()==="pending"?15:-1),c(),_(e.step()==="success"?16:-1)}}var J=class o{constructor(){this.licenseClient=x(A);this.membershipService=x(F);this.toastService=x(P);this.show=v(!1);this.step=v("select");this.products=this.licenseClient.products;this.selectedProduct=v(null);this.paymentMethod=v("usdt");this.USDT_CONFIG={network:"TRC20",walletAddress:"TYourTRC20WalletAddressHere",minAmount:1};this.email="";this.isProcessing=v(!1);this.isChecking=v(!1);this.currentOrder=v(null);this.activatedLicenseKey=v(null);this.checkInterval=null;window.addEventListener("open-payment-dialog",()=>{this.open()})}ngOnDestroy(){this.stopCheckInterval()}open(){this.show.set(!0),this.step.set("select"),this.selectedProduct.set(null),this.currentOrder.set(null),this.activatedLicenseKey.set(null)}close(){this.show.set(!1),this.stopCheckInterval()}selectProduct(t){this.selectedProduct.set(t)}proceedToPayment(){this.selectedProduct()&&this.step.set("payment")}async createOrder(){let t=this.selectedProduct();if(t){this.isProcessing.set(!0);try{let e=await this.licenseClient.createPayment(t.id,this.paymentMethod());e.success&&e.order?(this.currentOrder.set(e.order),this.step.set("pending"),window.open(e.order.payment_url,"_blank"),this.startCheckInterval()):this.toastService.error(e.message)}catch{this.toastService.error("\u5275\u5EFA\u8A02\u55AE\u5931\u6557")}finally{this.isProcessing.set(!1)}}}async checkPaymentStatus(){let t=this.currentOrder();if(t){this.isChecking.set(!0);try{let e=await this.licenseClient.checkPaymentStatus(t.orderId);e.paid?(this.stopCheckInterval(),this.activatedLicenseKey.set(e.licenseKey||null),this.step.set("success"),this.toastService.success("\u{1F389} \u652F\u4ED8\u6210\u529F\uFF0C\u6703\u54E1\u5DF2\u6FC0\u6D3B\uFF01"),e.licenseKey&&await this.membershipService.activateMembership(e.licenseKey,this.email)):this.toastService.info("\u652F\u4ED8\u5C1A\u672A\u5B8C\u6210\uFF0C\u8ACB\u7E7C\u7E8C\u652F\u4ED8")}catch{this.toastService.error("\u6AA2\u67E5\u652F\u4ED8\u72C0\u614B\u5931\u6557")}finally{this.isChecking.set(!1)}}}cancelPayment(){this.stopCheckInterval(),this.step.set("select"),this.currentOrder.set(null)}copyLicenseKey(){let t=this.activatedLicenseKey();t&&(navigator.clipboard.writeText(t),this.toastService.success("\u5361\u5BC6\u5DF2\u8907\u88FD"))}copyUsdtAddress(){navigator.clipboard.writeText(this.USDT_CONFIG.walletAddress),this.toastService.success("USDT TRC20 \u5730\u5740\u5DF2\u8907\u88FD")}startCheckInterval(){this.checkInterval=setInterval(()=>{this.checkPaymentStatus()},5e3)}stopCheckInterval(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=R({type:o,selectors:[["app-payment"]],decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4"],[1,"fixed","inset-0","bg-black/70","backdrop-blur-sm","z-50","flex","items-center","justify-center","p-4",3,"click"],[1,"bg-gradient-to-br","from-slate-900","to-slate-800","rounded-2xl","shadow-2xl","border","border-slate-700","w-full","max-w-2xl","max-h-[90vh]","overflow-hidden",3,"click"],[1,"bg-gradient-to-r","from-cyan-500","via-purple-500","to-pink-500","p-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-white","flex","items-center","gap-2"],[1,"text-white/80","mt-1"],[1,"text-white/80","hover:text-white","p-2","rounded-full","hover:bg-white/10",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6","overflow-y-auto","max-h-[70vh]"],[1,"text-center","py-8"],[1,"mt-6","pt-4","border-t","border-slate-700","text-center"],[1,"text-sm","text-slate-500"],["href","#",1,"text-cyan-400","hover:underline"],[1,"grid","grid-cols-2","gap-4"],[1,"relative","rounded-xl","border-2","p-4","cursor-pointer","transition-all","hover:scale-[1.02]",3,"border-cyan-500","bg-cyan-500/10","border-slate-600"],[1,"mt-6","flex","gap-4"],[1,"flex-1","py-3","rounded-xl","bg-slate-700","text-slate-300","hover:bg-slate-600","transition-colors",3,"click"],[1,"flex-1","py-3","rounded-xl","bg-gradient-to-r","from-cyan-500","to-purple-500","text-white","font-bold","hover:opacity-90","transition-opacity","disabled:opacity-50",3,"click","disabled"],[1,"relative","rounded-xl","border-2","p-4","cursor-pointer","transition-all","hover:scale-[1.02]",3,"click"],[1,"absolute","-top-3","left-1/2","-translate-x-1/2","bg-gradient-to-r","from-pink-500","to-purple-500","text-white","text-xs","px-3","py-1","rounded-full","font-medium"],[1,"absolute","-top-3","right-2","bg-orange-500","text-white","text-xs","px-2","py-1","rounded-full"],[1,"text-center"],[1,"text-lg","font-bold","text-white"],[1,"text-xs","text-slate-400"],[1,"mt-2"],[1,"text-3xl","font-bold","text-emerald-400"],[1,"text-xs","text-slate-500","mt-1"],[1,"text-center","mb-6"],[1,"text-lg","text-slate-300"],[1,"text-4xl","font-bold","text-emerald-400","mt-2"],[1,"text-sm","text-slate-500","mt-1"],[1,"mb-4"],[1,"block","text-sm","text-slate-400","mb-2"],["type","email","placeholder","your@email.com",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","px-4","py-3","text-white","placeholder-slate-500","focus:border-cyan-500","focus:outline-none",3,"ngModelChange","ngModel"],[1,"space-y-3","mb-6"],[1,"grid","grid-cols-2","gap-3"],[1,"flex","items-center","justify-center","gap-2","p-4","rounded-xl","border-2","transition-all",3,"click"],[1,"text-2xl"],[1,"text-white","font-medium"],[1,"mt-3","p-4","bg-emerald-500/10","border","border-emerald-500/30","rounded-lg"],[1,"flex","gap-4"],[1,"flex","items-center","gap-2","text-emerald-400","text-sm","mb-3"],[1,"font-medium"],[1,"flex","items-center","gap-3","mb-3"],[1,"flex-1","p-2","bg-slate-800","rounded-lg"],[1,"text-xs","text-slate-500","mb-1"],[1,"text-2xl","font-bold","text-emerald-400"],[1,"text-lg","font-bold","text-cyan-400"],[1,"text-xs","text-orange-400","bg-orange-500/10","rounded-lg","p-2"],[1,"text-6xl","mb-4"],[1,"text-xl","font-bold","text-white","mb-2"],[1,"text-slate-400","mb-4"],[1,"bg-slate-700/50","rounded-xl","p-4","mb-4"],[1,"text-sm","text-slate-400"],[1,"text-lg","font-mono","text-cyan-400"],[1,"bg-emerald-500/10","border","border-emerald-500/30","rounded-xl","p-5","mb-4","text-left"],[1,"text-sm","text-slate-500","mb-6"],[1,"flex-1","py-3","rounded-xl","bg-cyan-500","text-white","font-bold","hover:bg-cyan-600","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"text-center","mb-4"],[1,"text-sm","text-slate-400","mt-1"],[1,"text-xs","text-slate-400","mb-2"],[1,"bg-slate-800","rounded-lg","p-3"],[1,"flex","items-center","justify-between","gap-2"],[1,"text-sm","text-emerald-400","break-all","font-mono"],[1,"flex-shrink-0","bg-emerald-500/20","hover:bg-emerald-500/30","text-emerald-400","px-3","py-1.5","rounded-lg","text-sm","transition-colors",3,"click"],[1,"bg-slate-800/50","rounded-lg","p-3","mb-4"],[1,"flex","items-start","gap-3"],[1,"text-sm","text-white","font-medium","mb-1"],[1,"text-xs","text-slate-400","space-y-1"],[1,"text-emerald-400","font-medium"],[1,"text-xs","text-orange-400","bg-orange-500/10","rounded-lg","p-3","flex","items-start","gap-2"],[1,"mt-1","space-y-0.5"],[1,"bg-gradient-to-r","from-cyan-500/20","to-purple-500/20","rounded-xl","p-4","mb-6"],[1,"w-full","py-3","rounded-xl","bg-gradient-to-r","from-cyan-500","to-purple-500","text-white","font-bold","hover:opacity-90","transition-opacity",3,"click"],[1,"mt-2","text-sm","text-cyan-400","hover:underline",3,"click"]],template:function(e,r){e&1&&f(0,ce,25,4,"div",0),e&2&&_(r.show()?0:-1)},dependencies:[q,K,G,Z,z],encapsulation:2})}};export{J as PaymentComponent};
