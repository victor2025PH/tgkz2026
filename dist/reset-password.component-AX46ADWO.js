import{b as R,c as T,d as A,e as V,f as L,g as N,p as z,r as I,t as W}from"./chunk-FZJM4IRN.js";import{b as j}from"./chunk-XQJ2QBL4.js";import{b as q}from"./chunk-B2KG2WNU.js";import"./chunk-TMNXXRHZ.js";import{f as O,h as E,i as k,k as F}from"./chunk-K5SU4RX2.js";import{Aa as a,Ab as D,Bb as i,Cb as b,Db as x,Ib as P,Jb as M,Kb as v,Na as y,R as C,W as m,X as c,cb as f,db as w,ga as l,ib as p,jb as t,kb as n,lb as h,pb as B,rb as _,tb as d,uc as S}from"./chunk-PDD6YQ47.js";function G(r,o){r&1&&(t(0,"div",1)(1,"div",3),i(2,"\u2705"),n(),t(3,"h2"),i(4,"\u5BC6\u78BC\u91CD\u7F6E\u6210\u529F\uFF01"),n(),t(5,"p"),i(6,"\u60A8\u7684\u5BC6\u78BC\u5DF2\u66F4\u65B0\uFF0C\u8ACB\u4F7F\u7528\u65B0\u5BC6\u78BC\u767B\u5165"),n(),t(7,"button",4),i(8,"\u524D\u5F80\u767B\u5165"),n()())}function Y(r,o){r&1&&(t(0,"div",2)(1,"div",5),i(2,"\u274C"),n(),t(3,"h2"),i(4,"\u93C8\u63A5\u7121\u6548\u6216\u5DF2\u904E\u671F"),n(),t(5,"p"),i(6,"\u8ACB\u91CD\u65B0\u8ACB\u6C42\u5BC6\u78BC\u91CD\u7F6E"),n(),t(7,"button",6),i(8,"\u91CD\u65B0\u8ACB\u6C42"),n()())}function H(r,o){if(r&1&&(t(0,"div",9)(1,"span",26),i(2,"\u26A0\uFE0F"),n(),t(3,"span"),i(4),n()()),r&2){let e=d(2);a(4),b(e.error())}}function J(r,o){r&1&&(t(0,"span",22),i(1,"\u5BC6\u78BC\u4E0D\u5339\u914D"),n())}function K(r,o){r&1&&(h(0,"span",27),t(1,"span"),i(2,"\u91CD\u7F6E\u4E2D..."),n())}function Q(r,o){r&1&&(t(0,"span"),i(1,"\u91CD\u7F6E\u5BC6\u78BC"),n())}function U(r,o){if(r&1){let e=B();t(0,"h2",7),i(1,"\u8A2D\u7F6E\u65B0\u5BC6\u78BC"),n(),t(2,"p",8),i(3,"\u8ACB\u8F38\u5165\u60A8\u7684\u65B0\u5BC6\u78BC"),n(),f(4,H,5,1,"div",9),t(5,"form",10),_("ngSubmit",function(){m(e);let s=d();return c(s.onSubmit())}),t(6,"div",11)(7,"label",12),i(8,"\u65B0\u5BC6\u78BC"),n(),t(9,"div",13)(10,"span",14),i(11,"\u{1F512}"),n(),t(12,"input",15),v("ngModelChange",function(s){m(e);let g=d();return M(g.password,s)||(g.password=s),c(s)}),n(),t(13,"button",16),_("click",function(){m(e);let s=d();return c(s.showPassword.set(!s.showPassword()))}),i(14),n()(),t(15,"div",17),h(16,"div",18),t(17,"span",19),i(18),n()()(),t(19,"div",11)(20,"label",20),i(21,"\u78BA\u8A8D\u5BC6\u78BC"),n(),t(22,"div",13)(23,"span",14),i(24,"\u{1F512}"),n(),t(25,"input",21),v("ngModelChange",function(s){m(e);let g=d();return M(g.confirmPassword,s)||(g.confirmPassword=s),c(s)}),n(),t(26,"button",16),_("click",function(){m(e);let s=d();return c(s.showConfirmPassword.set(!s.showConfirmPassword()))}),i(27),n()(),f(28,J,2,0,"span",22),n(),t(29,"button",23),f(30,K,3,0)(31,Q,2,0,"span"),n()(),t(32,"p",24)(33,"a",25),i(34,"\u2190 \u8FD4\u56DE\u767B\u5165"),n()()}if(r&2){let e=d();a(4),w(e.error()?4:-1),a(8),p("type",e.showPassword()?"text":"password"),P("ngModel",e.password),p("disabled",e.isLoading()),a(2),x(" ",e.showPassword()?"\u{1F648}":"\u{1F441}\uFE0F"," "),a(2),D(e.passwordStrength()),a(2),b(e.passwordStrengthText()),a(7),p("type",e.showConfirmPassword()?"text":"password"),P("ngModel",e.confirmPassword),p("disabled",e.isLoading()),a(2),x(" ",e.showConfirmPassword()?"\u{1F648}":"\u{1F441}\uFE0F"," "),a(),w(e.confirmPassword&&e.password!==e.confirmPassword?28:-1),a(),p("disabled",e.isLoading()||!e.isFormValid()),a(),w(e.isLoading()?30:31)}}var Z=class r{constructor(){this.authService=C(q);this.router=C(E);this.route=C(O);this.i18n=C(j);this.token="";this.password="";this.confirmPassword="";this.showPassword=l(!1);this.showConfirmPassword=l(!1);this.isLoading=l(!1);this.success=l(!1);this.invalidToken=l(!1);this.error=l(null)}ngOnInit(){this.token=this.route.snapshot.queryParams.token||"",this.token||this.invalidToken.set(!0)}passwordStrength(){if(!this.password)return"";if(this.password.length<8)return"weak";let o=0;return this.password.length>=8&&o++,this.password.length>=12&&o++,/[a-z]/.test(this.password)&&/[A-Z]/.test(this.password)&&o++,/\d/.test(this.password)&&o++,/[^a-zA-Z0-9]/.test(this.password)&&o++,o>=4?"strong":o>=2?"medium":"weak"}passwordStrengthText(){switch(this.passwordStrength()){case"weak":return"\u5F31";case"medium":return"\u4E2D";case"strong":return"\u5F37";default:return""}}isFormValid(){return this.password.length>=8&&this.password===this.confirmPassword}async onSubmit(){if(this.isFormValid()){this.isLoading.set(!0),this.error.set(null);try{let o=await this.authService.resetPassword(this.token,this.password);o.success?this.success.set(!0):o.error?.includes("\u904E\u671F")||o.error?.includes("\u7121\u6548")?this.invalidToken.set(!0):this.error.set(o.error||"\u91CD\u7F6E\u5931\u6557")}catch(o){this.error.set(o.message||"\u91CD\u7F6E\u5931\u6557")}finally{this.isLoading.set(!1)}}}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275cmp=y({type:r,selectors:[["app-reset-password"]],decls:4,vars:1,consts:[[1,"reset-password-page"],[1,"success-state"],[1,"error-state"],[1,"success-icon"],["routerLink","/auth/login",1,"primary-btn"],[1,"error-icon"],["routerLink","/auth/forgot-password",1,"primary-btn"],[1,"page-title"],[1,"page-subtitle"],[1,"error-alert"],[1,"reset-form",3,"ngSubmit"],[1,"form-group"],["for","password"],[1,"input-wrapper"],[1,"input-icon"],["id","password","name","password","placeholder","\u8ACB\u8F38\u5165\u65B0\u5BC6\u78BC\uFF08\u81F3\u5C118\u500B\u5B57\u7B26\uFF09","required","","minlength","8","autocomplete","new-password",3,"ngModelChange","type","ngModel","disabled"],["type","button",1,"toggle-password",3,"click"],[1,"password-strength"],[1,"strength-bar"],[1,"strength-text"],["for","confirmPassword"],["id","confirmPassword","name","confirmPassword","placeholder","\u8ACB\u518D\u6B21\u8F38\u5165\u65B0\u5BC6\u78BC","required","","autocomplete","new-password",3,"ngModelChange","type","ngModel","disabled"],[1,"error-text"],["type","submit",1,"submit-btn",3,"disabled"],[1,"back-link"],["routerLink","/auth/login"],[1,"error-icon-small"],[1,"loading-spinner"]],template:function(e,u){e&1&&(t(0,"div",0),f(1,G,9,0,"div",1)(2,Y,9,0,"div",2)(3,U,35,15),n()),e&2&&(a(),w(u.success()?1:u.invalidToken()?2:3))},dependencies:[S,W,N,R,T,A,z,I,L,V,F,k],styles:['.reset-password-page[_ngcontent-%COMP%]{color:var(--text-primary, #fff)}.success-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{text-align:center;padding:2rem 0}.success-icon[_ngcontent-%COMP%], .error-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.page-title[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;margin-bottom:.5rem}.page-subtitle[_ngcontent-%COMP%]{color:var(--text-secondary, #888);margin-bottom:2rem}.error-alert[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.875rem 1rem;background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:8px;color:#f87171;margin-bottom:1.5rem}.reset-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--text-secondary, #aaa)}.input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.input-icon[_ngcontent-%COMP%]{position:absolute;left:1rem;font-size:1rem;opacity:.5}.input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.875rem 3rem .875rem 2.75rem;background:var(--bg-secondary, #1a1a1a);border:1px solid var(--border-color, #333);border-radius:8px;color:var(--text-primary, #fff);font-size:1rem;transition:all .2s ease}.input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary, #3b82f6);box-shadow:0 0 0 3px #3b82f61a}.toggle-password[_ngcontent-%COMP%]{position:absolute;right:1rem;background:none;border:none;cursor:pointer;font-size:1rem;opacity:.5}.toggle-password[_ngcontent-%COMP%]:hover{opacity:1}.password-strength[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-top:.25rem}.strength-bar[_ngcontent-%COMP%]{flex:1;height:4px;background:var(--bg-tertiary, #252525);border-radius:2px;position:relative;overflow:hidden}.strength-bar[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:0;height:100%;border-radius:2px;transition:all .3s}.strength-bar.weak[_ngcontent-%COMP%]:before{width:33%;background:#ef4444}.strength-bar.medium[_ngcontent-%COMP%]:before{width:66%;background:#f59e0b}.strength-bar.strong[_ngcontent-%COMP%]:before{width:100%;background:#22c55e}.strength-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted, #666)}.error-text[_ngcontent-%COMP%]{color:#f87171;font-size:.75rem}.submit-btn[_ngcontent-%COMP%], .primary-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.875rem 1.5rem;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border:none;border-radius:8px;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s ease;margin-top:.5rem}.submit-btn[_ngcontent-%COMP%]:hover:not(:disabled), .primary-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #3b82f64d}.submit-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.loading-spinner[_ngcontent-%COMP%]{width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.back-link[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem}.back-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary, #3b82f6);text-decoration:none}.back-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}'],changeDetection:0})}};export{Z as ResetPasswordComponent};
