import{b as A}from"./chunk-XQJ2QBL4.js";import{f as U,h as D}from"./chunk-K5SU4RX2.js";import{Aa as a,Bb as r,Cb as s,Db as v,Na as y,R as C,Rb as L,W as f,X as h,Y as E,Z as k,a as b,b as S,cb as m,db as g,ga as u,mb as e,nb as i,ob as p,pb as _,qb as M,sb as x,tb as d,uc as I,wa as w,zb as T}from"./chunk-PDD6YQ47.js";var j=o=>({seconds:o});function N(o,n){if(o&1&&(e(0,"div",4),p(1,"div",13),e(2,"p"),r(3),i()()),o&2){let t=d();a(3),s(t.t("scanLogin.verifying"))}}function G(o,n){if(o&1&&(e(0,"p",22),r(1),i()),o&2){let t=d(2);a(),v(" ",t.t("scanLogin.expiresIn",L(1,j,t.countdown()))," ")}}function F(o,n){if(o&1){let t=_();e(0,"div",5)(1,"div",14),r(2,"\u{1F4F1}"),i(),e(3,"h2"),r(4),i(),e(5,"p",15),r(6),i(),p(7,"div",16),e(8,"div",17)(9,"span"),r(10),i()(),e(11,"a",18),x("click",function(){f(t);let l=d();return h(l.onTelegramClick())}),e(12,"span",19),E(),e(13,"svg",20),p(14,"path",21),i()(),k(),e(15,"span"),r(16),i()(),m(17,G,2,3,"p",22),e(18,"div",23)(19,"div",24)(20,"span",25),r(21,"1"),i(),e(22,"span"),r(23),i()(),e(24,"div",24)(25,"span",25),r(26,"2"),i(),e(27,"span"),r(28),i()(),e(29,"div",24)(30,"span",25),r(31,"3"),i(),e(32,"span"),r(33),i()()()()}if(o&2){let t=d();a(4),s(t.t("scanLogin.confirmTitle")),a(2),s(t.t("scanLogin.authDesc")),a(4),s(t.t("scanLogin.or")),a(),M("href",t.tokenStatus().deepLinkUrl,w),a(5),s(t.t("scanLogin.openTelegramManual")),a(),g(t.countdown()>0?17:-1),a(6),s(t.t("scanLogin.stepAuth")),a(5),s(t.t("scanLogin.stepConfirm")),a(5),s(t.t("scanLogin.stepDone"))}}function B(o,n){if(o&1&&(e(0,"div",6),p(1,"div",13),e(2,"h2"),r(3),i(),e(4,"p"),r(5),i()()),o&2){let t=d();a(3),s(t.t("scanLogin.sendingTitle")),a(2),s(t.t("scanLogin.sendingDesc"))}}function R(o,n){if(o&1&&(e(0,"div",7)(1,"div",26),r(2,"\u23F3"),i(),e(3,"h2"),r(4),i(),e(5,"p"),r(6),i(),p(7,"div",27),i()),o&2){let t=d();a(4),s(t.t("scanLogin.waitingTitle")),a(2),s(t.t("scanLogin.waitingDesc"))}}function Y(o,n){if(o&1){let t=_();e(0,"div",8)(1,"div",28),r(2,"\u{1F916}"),i(),e(3,"h2"),r(4),i(),e(5,"p"),r(6),i(),e(7,"a",29)(8,"span",19),E(),e(9,"svg",20),p(10,"path",21),i()(),k(),e(11,"span"),r(12),i()(),e(13,"p",30),r(14),i(),e(15,"button",31),x("click",function(){f(t);let l=d();return h(l.retryAfterUnblock())}),r(16),i()()}if(o&2){let t=d();a(4),s(t.t("scanLogin.botBlockedTitle")),a(2),s(t.t("scanLogin.botBlockedDesc")),a(),M("href",t.tokenStatus().botLink,w),a(5),s(t.t("scanLogin.openBotFirst")),a(2),s(t.t("scanLogin.botBlockedHint")),a(2),v(" ",t.t("scanLogin.retryAfterUnblock")," ")}}function H(o,n){if(o&1&&(e(0,"div",32)(1,"div",33)(2,"div",34),E(),e(3,"svg",35),p(4,"circle",36)(5,"path",37),i()()(),k(),e(6,"h2"),r(7),i(),e(8,"p"),r(9),i(),e(10,"p",38),r(11),i()()),o&2){let t=d();T("animate",t.showSuccessAnimation()),a(7),s(t.t("scanLogin.successTitle")),a(2),s(t.t("scanLogin.successDesc")),a(2),s(t.t("scanLogin.redirecting"))}}function $(o,n){if(o&1){let t=_();e(0,"div",10)(1,"div",39),r(2,"\u23F0"),i(),e(3,"h2"),r(4),i(),e(5,"p"),r(6),i(),e(7,"button",31),x("click",function(){f(t);let l=d();return h(l.goToLogin())}),r(8),i()()}if(o&2){let t=d();a(4),s(t.t("scanLogin.expiredTitle")),a(2),s(t.t("scanLogin.expiredDesc")),a(2),v(" ",t.t("scanLogin.backToLogin")," ")}}function K(o,n){if(o&1){let t=_();e(0,"div",11)(1,"div",39),r(2,"\u274C"),i(),e(3,"h2"),r(4),i(),e(5,"p"),r(6),i(),e(7,"button",31),x("click",function(){f(t);let l=d();return h(l.goToLogin())}),r(8),i()()}if(o&2){let t=d();a(4),s(t.t("scanLogin.errorTitle")),a(2),s(t.tokenStatus().message||t.t("scanLogin.errorDesc")),a(2),v(" ",t.t("scanLogin.backToLogin")," ")}}function V(){let o=navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(o)?"ios":/android/.test(o)?"android":/windows|macintosh|linux/.test(o)&&!/mobile/.test(o)?"desktop":"unknown"}function J(){let o=V();return o==="ios"||o==="android"}var z=class o{constructor(){this.route=C(U);this.router=C(D);this.i18n=C(A);this.tokenStatus=u({status:"loading"});this.countdown=u(0);this.waitingConfirm=u(!1);this.telegramUser=u(null);this.showSuccessAnimation=u(!1);this.deviceType=u("unknown");this.token="";this.botUsername="";this.countdownInterval=null;this.pollInterval=null;this.widgetLoaded=!1;this.SAVED_TG_USER_KEY="tg_matrix_saved_user"}ngOnInit(){if(this.deviceType.set(V()),console.log("Device type:",this.deviceType()),this.token=this.route.snapshot.queryParams.token||"",!this.token){this.tokenStatus.set({status:"error",message:this.t("scanLogin.noToken")});return}window.onTelegramAuth=this.handleTelegramAuth.bind(this),this.verifyToken(),this.checkSavedUser()}checkSavedUser(){try{let n=localStorage.getItem(this.SAVED_TG_USER_KEY);if(n){let t=JSON.parse(n),c=t.auth_date*1e3;(Date.now()-c)/(1e3*60*60)<24?(console.log("Found saved user, auto-sending confirmation..."),this.telegramUser.set(t),setTimeout(()=>{this.tokenStatus().status==="valid"&&this.sendConfirmationToUser(t)},500)):localStorage.removeItem(this.SAVED_TG_USER_KEY)}}catch(n){console.error("Error checking saved user:",n)}}ngAfterViewInit(){}handleTelegramAuth(n){console.log("Telegram auth received:",n),this.telegramUser.set(n),this.tokenStatus.update(t=>S(b({},t),{status:"sending"})),this.sendConfirmationToUser(n)}async sendConfirmationToUser(n){try{let c=await(await fetch(`/api/v1/auth/login-token/${this.token}/send-confirmation`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({telegram_id:n.id,telegram_username:n.username,telegram_first_name:n.first_name,telegram_last_name:n.last_name,auth_date:n.auth_date,hash:n.hash})})).json();c.success?(this.saveUser(n),this.tokenStatus.update(l=>S(b({},l),{status:"valid"})),this.waitingConfirm.set(!0),this.startPolling(),J()&&setTimeout(()=>{window.location.href=`tg://resolve?domain=${this.botUsername}`},1e3)):c.need_start_bot?this.tokenStatus.set({status:"bot_blocked",message:c.error,botLink:c.bot_link||`https://t.me/${this.botUsername}`}):this.tokenStatus.set({status:"error",message:c.error||this.t("scanLogin.sendFailed")})}catch(t){console.error("Send confirmation error:",t),this.tokenStatus.set({status:"error",message:this.t("scanLogin.networkError")})}}saveUser(n){try{localStorage.setItem(this.SAVED_TG_USER_KEY,JSON.stringify(n))}catch(t){console.error("Error saving user:",t)}}retryAfterUnblock(){let n=this.telegramUser();n?(this.tokenStatus.set({status:"sending"}),this.sendConfirmationToUser(n)):window.location.reload()}loadTelegramWidget(){if(this.widgetLoaded||!this.botUsername)return;let n=document.getElementById("telegram-login-widget");if(!n)return;n.innerHTML="";let t=document.createElement("script");t.async=!0,t.src="https://telegram.org/js/telegram-widget.js?22",t.setAttribute("data-telegram-login",this.botUsername),t.setAttribute("data-size","large"),t.setAttribute("data-radius","10"),t.setAttribute("data-onauth","onTelegramAuth(user)"),t.setAttribute("data-request-access","write"),n.appendChild(t),this.widgetLoaded=!0}ngOnDestroy(){this.countdownInterval&&clearInterval(this.countdownInterval),this.pollInterval&&clearInterval(this.pollInterval)}t(n,t){return this.i18n.t(n,t)}async verifyToken(){try{let t=await(await fetch(`/api/v1/auth/login-token/${this.token}`)).json();if(!t.success){this.tokenStatus.set({status:"error",message:t.error||this.t("scanLogin.tokenInvalid")});return}let{status:c,expires_in:l,deep_link_url:O,bot_username:P}=t.data;if(c==="expired"){this.tokenStatus.set({status:"expired"});return}if(c==="confirmed"){this.tokenStatus.set({status:"confirmed"});return}this.botUsername=P||"tgzkw_bot",this.tokenStatus.set({status:"valid",deepLinkUrl:O,botUsername:P,expiresIn:l||300}),this.countdown.set(l||300),this.startCountdown(),setTimeout(()=>{this.loadTelegramWidget()},100)}catch(n){console.error("Token verification error:",n),this.tokenStatus.set({status:"error",message:this.t("scanLogin.networkError")})}}onTelegramClick(){this.waitingConfirm.set(!0),this.startPolling()}startCountdown(){this.countdownInterval=setInterval(()=>{let n=this.countdown();n<=0?(clearInterval(this.countdownInterval),this.tokenStatus.set({status:"expired"})):this.countdown.set(n-1)},1e3)}startPolling(){this.pollInterval=setInterval(async()=>{try{let t=await(await fetch(`/api/v1/auth/login-token/${this.token}`)).json();t.success&&t.data&&(t.data.status==="confirmed"?(clearInterval(this.pollInterval),this.waitingConfirm.set(!1),this.showSuccessAnimation.set(!0),this.tokenStatus.set({status:"confirmed"}),setTimeout(()=>{},2e3)):t.data.status==="expired"&&(clearInterval(this.pollInterval),this.waitingConfirm.set(!1),this.tokenStatus.set({status:"expired"})))}catch(n){console.error("Polling error:",n)}},2e3)}goToLogin(){window.location.href="https://tgw.usdt2026.cc/auth/login"}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=y({type:o,selectors:[["app-scan-login"]],decls:18,vars:8,consts:[[1,"scan-login-page"],[1,"scan-card"],[1,"logo"],[1,"logo-icon"],[1,"status-section","loading"],[1,"status-section","valid"],[1,"status-section","sending"],[1,"status-section","waiting"],[1,"status-section","bot-blocked"],[1,"status-section","confirmed",3,"animate"],[1,"status-section","expired"],[1,"status-section","error"],[1,"footer"],[1,"spinner"],[1,"info-icon"],[1,"description"],["id","telegram-login-widget",1,"telegram-widget-container"],[1,"divider"],[1,"telegram-btn","secondary",3,"click","href"],[1,"btn-icon"],["viewBox","0 0 24 24","fill","currentColor","width","24","height","24"],["d","M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"],[1,"countdown"],[1,"steps"],[1,"step"],[1,"step-num"],[1,"pulse-icon"],[1,"spinner","small"],[1,"warning-icon"],["target","_blank",1,"telegram-btn","primary",3,"href"],[1,"hint"],[1,"retry-btn",3,"click"],[1,"status-section","confirmed"],[1,"success-animation"],[1,"checkmark-circle"],["viewBox","0 0 52 52",1,"checkmark"],["cx","26","cy","26","r","25","fill","none",1,"checkmark-circle-bg"],["fill","none","d","M14.1 27.2l7.1 7.2 16.7-16.8",1,"checkmark-check"],[1,"redirect-hint"],[1,"error-icon"]],template:function(t,c){t&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),r(4,"\u{1F510}"),i(),e(5,"h1"),r(6,"TG-Matrix"),i()(),m(7,N,4,1,"div",4),m(8,F,34,9,"div",5),m(9,B,6,2,"div",6),m(10,R,8,2,"div",7),m(11,Y,17,6,"div",8),m(12,H,12,5,"div",9),m(13,$,9,3,"div",10),m(14,K,9,3,"div",11),e(15,"div",12)(16,"p"),r(17,"\xA9 2026 TG-Matrix. All rights reserved."),i()()()()),t&2&&(a(7),g(c.tokenStatus().status==="loading"?7:-1),a(),g(c.tokenStatus().status==="valid"?8:-1),a(),g(c.tokenStatus().status==="sending"?9:-1),a(),g(c.waitingConfirm()?10:-1),a(),g(c.tokenStatus().status==="bot_blocked"?11:-1),a(),g(c.tokenStatus().status==="confirmed"?12:-1),a(),g(c.tokenStatus().status==="expired"?13:-1),a(),g(c.tokenStatus().status==="error"?14:-1))},dependencies:[I],styles:['.scan-login-page[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0f172a,#1e293b);padding:1rem}.scan-card[_ngcontent-%COMP%]{background:#1e293be6;border-radius:20px;padding:2rem;max-width:400px;width:100%;text-align:center;box-shadow:0 20px 60px #0000004d;border:1px solid rgba(255,255,255,.1)}.logo[_ngcontent-%COMP%]{margin-bottom:2rem}.logo-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:.5rem}.logo[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#fff;margin:0}.status-section[_ngcontent-%COMP%]{padding:1rem 0}.info-icon[_ngcontent-%COMP%], .success-icon[_ngcontent-%COMP%], .error-icon[_ngcontent-%COMP%], .pulse-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.pulse-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.1)}}h2[_ngcontent-%COMP%]{color:#fff;font-size:1.25rem;margin:0 0 .5rem}.description[_ngcontent-%COMP%]{color:#94a3b8;font-size:.9rem;margin:0 0 1.5rem}.telegram-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:.75rem;padding:1rem 2rem;background:linear-gradient(135deg,#08c,#06a);border:none;border-radius:12px;color:#fff;font-size:1.1rem;font-weight:600;text-decoration:none;cursor:pointer;transition:all .3s ease;width:100%;box-shadow:0 4px 15px #08c6}.telegram-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #0088cc80}.telegram-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.telegram-btn.secondary[_ngcontent-%COMP%]{background:transparent;border:1px solid #0088cc;box-shadow:none}.telegram-btn.secondary[_ngcontent-%COMP%]:hover{background:#0088cc1a;box-shadow:none}.telegram-widget-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:1.5rem 0;min-height:48px}.divider[_ngcontent-%COMP%]{display:flex;align-items:center;margin:1.5rem 0;color:#64748b;font-size:.85rem}.divider[_ngcontent-%COMP%]:before, .divider[_ngcontent-%COMP%]:after{content:"";flex:1;height:1px;background:#ffffff1a}.divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding:0 1rem}.status-section.sending[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#60a5fa}.btn-icon[_ngcontent-%COMP%]{display:flex;align-items:center}.btn-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px}.countdown[_ngcontent-%COMP%]{color:#64748b;font-size:.85rem;margin:1rem 0 0}.steps[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1.5rem;border-top:1px solid rgba(255,255,255,.1)}.step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.5rem 0;color:#94a3b8;font-size:.9rem}.step-num[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:1.5rem;height:1.5rem;background:linear-gradient(135deg,#08c,#06a);border-radius:50%;color:#fff;font-size:.75rem;font-weight:600}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid rgba(255,255,255,.1);border-top-color:#08c;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:1rem auto}.spinner.small[_ngcontent-%COMP%]{width:24px;height:24px;border-width:2px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.retry-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:.75rem 1.5rem;background:transparent;border:1px solid #64748b;border-radius:8px;color:#94a3b8;font-size:.9rem;cursor:pointer;transition:all .2s ease;margin-top:1rem}.retry-btn[_ngcontent-%COMP%]:hover{background:#ffffff0d;border-color:#fff;color:#fff}.footer[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,.05)}.footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#475569;font-size:.75rem;margin:0}.status-section.loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#94a3b8}.status-section.waiting[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#fbbf24}.status-section.confirmed[_ngcontent-%COMP%]   .success-icon[_ngcontent-%COMP%], .status-section.confirmed[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#4ade80}.status-section.expired[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%], .status-section.error[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%], .status-section.expired[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .status-section.error[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#f87171}.status-section.bot-blocked[_ngcontent-%COMP%]   .warning-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.status-section.bot-blocked[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#fbbf24}.telegram-btn.primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#08c,#06a);box-shadow:0 4px 15px #08c6}.hint[_ngcontent-%COMP%]{color:#64748b;font-size:.8rem;margin:1rem 0}.success-animation[_ngcontent-%COMP%]{margin:1rem 0 2rem}.checkmark-circle[_ngcontent-%COMP%]{width:80px;height:80px;margin:0 auto}.checkmark[_ngcontent-%COMP%]{width:100%;height:100%}.checkmark-circle-bg[_ngcontent-%COMP%]{stroke:#4ade80;stroke-width:2;stroke-dasharray:157;stroke-dashoffset:157;animation:_ngcontent-%COMP%_circle-draw .6s ease-out forwards}.checkmark-check[_ngcontent-%COMP%]{stroke:#4ade80;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:48;stroke-dashoffset:48;animation:_ngcontent-%COMP%_check-draw .4s .4s ease-out forwards}@keyframes _ngcontent-%COMP%_circle-draw{to{stroke-dashoffset:0}}@keyframes _ngcontent-%COMP%_check-draw{to{stroke-dashoffset:0}}.status-section.confirmed.animate[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_success-scale .5s ease-out}@keyframes _ngcontent-%COMP%_success-scale{0%{transform:scale(.8);opacity:0}50%{transform:scale(1.05)}to{transform:scale(1);opacity:1}}.redirect-hint[_ngcontent-%COMP%]{color:#64748b;font-size:.85rem;margin-top:1rem;animation:_ngcontent-%COMP%_blink 1.5s infinite}@keyframes _ngcontent-%COMP%_blink{0%,to{opacity:1}50%{opacity:.5}}.device-hint[_ngcontent-%COMP%]{background:#0088cc1a;border:1px solid rgba(0,136,204,.3);border-radius:8px;padding:.75rem;margin:1rem 0;color:#60a5fa;font-size:.85rem}.device-hint[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:.5rem}']})}};export{z as ScanLoginComponent};
