import{a as $}from"./chunk-HNCHSWBM.js";import{b as W,c as z,f as N,h as U,n as V,o as q,t as j}from"./chunk-FZJM4IRN.js";import"./chunk-TMNXXRHZ.js";import{h as B}from"./chunk-K5SU4RX2.js";import{Aa as d,Bb as i,Cb as f,Db as x,Eb as D,Ia as M,Ib as A,Jb as R,Kb as F,Na as O,Sa as y,W as h,X as C,Zb as u,cb as b,db as v,ga as m,gb as E,hb as S,ib as p,jb as e,kb as t,lb as P,pb as k,qc as T,rb as c,tb as s,uc as I,wa as w,zb as g}from"./chunk-PDD6YQ47.js";var H=(r,n)=>n.id;function L(r,n){if(r&1&&(e(0,"div",36),i(1),t()),r&2){let o=s().$implicit;d(),x("",o.bonus_display," \u{1F381}")}}function Q(r,n){r&1&&(e(0,"div",37),i(1,"\u63A8\u85A6"),t())}function G(r,n){if(r&1){let o=k();e(0,"div",34),c("click",function(){let l=h(o).$implicit,_=s();return C(_.selectPackage(l))}),e(1,"div",35),i(2),t(),b(3,L,2,1,"div",36),b(4,Q,2,0,"div",37),t()}if(r&2){let o,a=n.$implicit,l=s();g("selected",((o=l.selectedPackage())==null?null:o.id)===a.id)("recommended",a.is_recommended),d(2),f(a.amount_display),d(),v(a.bonus_amount>0?3:-1),d(),v(a.is_recommended?4:-1)}}function J(r,n){if(r&1&&(e(0,"div",38)(1,"span",6),i(2,"\u8D08\u9001\u91D1\u984D"),t(),e(3,"span",26),i(4),t()()),r&2){let o=s();d(4),x("+",o.formatAmount(o.bonusAmount())," \u{1F381}")}}function K(r,n){if(r&1&&(e(0,"div",25)(1,"span",6),i(2,"\u624B\u7E8C\u8CBB"),t(),e(3,"span",26),i(4),t()()),r&2){let o=s();d(4),x("-",o.formatAmount(o.feeAmount()))}}function X(r,n){if(r&1&&P(0,"img",46),r&2){let o=s(2);p("src",o.qrCodeUrl(),w)}}function Z(r,n){r&1&&(e(0,"div",47)(1,"span"),i(2,"\u751F\u6210\u4E2D..."),t()())}function ee(r,n){if(r&1){let o=k();e(0,"div",39)(1,"div",40)(2,"div",41)(3,"h3"),i(4,"\u{1F48E} USDT \u5145\u503C"),t(),e(5,"button",42),c("click",function(){h(o);let l=s();return C(l.closeUsdtModal())}),i(6,"\xD7"),t()(),e(7,"div",43)(8,"div",44)(9,"p"),i(10,"\u8ACB\u8F49\u8CEC "),e(11,"strong"),i(12),t(),i(13," \u5230\u4EE5\u4E0B\u5730\u5740\uFF1A"),t(),e(14,"div",45),b(15,X,1,1,"img",46)(16,Z,3,0,"div",47),t(),e(17,"div",48)(18,"div",49),i(19),t(),e(20,"div",50),i(21),t(),e(22,"button",51),c("click",function(){h(o);let l=s();return C(l.copyAddress())}),i(23,"\u8907\u88FD\u5730\u5740"),t()(),e(24,"div",52)(25,"p"),i(26,"\u26A0\uFE0F \u6CE8\u610F\u4E8B\u9805\uFF1A"),t(),e(27,"ul")(28,"li"),i(29,"\u8ACB\u52D9\u5FC5\u9078\u64C7 TRC20 \u7DB2\u7D61"),t(),e(30,"li"),i(31,"\u6700\u5C0F\u8F49\u8CEC\u91D1\u984D\uFF1A5 USDT"),t(),e(32,"li"),i(33,"\u5230\u8CEC\u6642\u9593\uFF1A1-30 \u5206\u9418"),t(),e(34,"li"),i(35,"\u8A02\u55AE\u6709\u6548\u671F\uFF1A30 \u5206\u9418"),t()()()()(),e(36,"div",53)(37,"button",54),c("click",function(){h(o);let l=s();return C(l.confirmUsdtPayment())}),i(38," \u6211\u5DF2\u5B8C\u6210\u8F49\u8CEC "),t()()()()}if(r&2){let o=s();d(12),x("",o.usdtAmount()," USDT"),d(3),v(o.qrCodeUrl()?15:16),d(4),D("",o.usdtNetwork()," ",o.usdtNetwork()==="TRC20"?"(TRON)":"(Ethereum)"),d(2),f(o.usdtAddress())}}function te(r,n){r&1&&(e(0,"div",55),P(1,"div",56),e(2,"span"),i(3,"\u8655\u7406\u4E2D..."),t()())}var Y=class r{constructor(n,o){this.walletService=n;this.router=o;this.packages=m([]);this.selectedPackage=m(null);this.selectedMethod=m("usdt_trc20");this.customAmount=0;this.loading=m(!1);this.showUsdtModal=m(!1);this.currentOrder=m(null);this.paymentInfo=m(null);this.pollingStatus=m(!1);this.rechargeAmount=u(()=>{let n=this.selectedPackage();return n?n.amount:(this.customAmount||0)*100});this.bonusAmount=u(()=>this.selectedPackage()?.bonus_amount||0);this.feeAmount=u(()=>{let n=this.selectedMethod(),o=this.rechargeAmount();return Math.round(o*({usdt_trc20:0,alipay:.02,wechat:.02,bank:.01}[n]||0))});this.actualAmount=u(()=>this.rechargeAmount()+this.bonusAmount()-this.feeAmount());this.payAmount=u(()=>this.rechargeAmount());this.usdtAmount=u(()=>{let n=this.paymentInfo();return n?.usdt_amount?n.usdt_amount.toFixed(2):(this.payAmount()/100).toFixed(2)});this.usdtAddress=u(()=>this.paymentInfo()?.usdt_address||"TYourTRC20WalletAddressHere");this.usdtNetwork=u(()=>this.paymentInfo()?.usdt_network||"TRC20");this.qrCodeUrl=u(()=>{let n=this.usdtAddress();return!n||n==="TYourTRC20WalletAddressHere"?"":`https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=${encodeURIComponent(n)}&bgcolor=ffffff&color=000000&margin=10`});this.canProceed=u(()=>this.rechargeAmount()>=500)}ngOnInit(){this.loadPackages(),this.walletService.loadWallet()}async loadPackages(){let n=await this.walletService.loadRechargePackages();this.packages.set(n);let o=n.find(a=>a.is_recommended);o&&this.selectedPackage.set(o)}selectPackage(n){this.selectedPackage.set(n),this.customAmount=0}selectMethod(n){this.selectedMethod.set(n)}onCustomAmountChange(){this.customAmount>0&&this.selectedPackage.set(null)}formatAmount(n){return"$"+(n/100).toFixed(2)}goBack(){window.dispatchEvent(new CustomEvent("changeView",{detail:"wallet"}))}async proceed(){if(this.canProceed()){this.loading.set(!0);try{let n=await this.walletService.createRechargeOrder({amount:this.rechargeAmount(),paymentMethod:this.selectedMethod()});n.success&&n.order&&n.paymentInfo?(this.currentOrder.set(n.order),this.paymentInfo.set(n.paymentInfo),this.selectedMethod()==="usdt_trc20"?this.showUsdtModal.set(!0):alert("\u6B64\u652F\u4ED8\u65B9\u5F0F\u5373\u5C07\u4E0A\u7DDA")):alert(n.error||"\u5275\u5EFA\u8A02\u55AE\u5931\u6557")}catch(n){console.error("Create order error:",n),alert("\u5275\u5EFA\u8A02\u55AE\u5931\u6557")}finally{this.loading.set(!1)}}}closeUsdtModal(){this.showUsdtModal.set(!1),this.pollingStatus.set(!1)}copyAddress(){let n=this.usdtAddress();navigator.clipboard.writeText(n),alert("\u5730\u5740\u5DF2\u8907\u88FD")}async confirmUsdtPayment(){let n=this.currentOrder();if(!n){alert("\u8A02\u55AE\u4E0D\u5B58\u5728");return}this.loading.set(!0);try{let o=await this.walletService.markRechargeOrderPaid(n.order_no);if(!o.success){alert(o.error||"\u6A19\u8A18\u652F\u4ED8\u72C0\u614B\u5931\u6557"),this.loading.set(!1);return}this.pollingStatus.set(!0),this.showUsdtModal.set(!1),alert(`\u5DF2\u6536\u5230\u60A8\u7684\u652F\u4ED8\u78BA\u8A8D\uFF0C\u7CFB\u7D71\u6B63\u5728\u8655\u7406\u4E2D...
\u5230\u8CEC\u5F8C\u5C07\u81EA\u52D5\u66F4\u65B0\u9918\u984D\u3002`),this.pollOrderStatus(n.order_no),window.dispatchEvent(new CustomEvent("changeView",{detail:"wallet"}))}catch(o){console.error("Confirm payment error:",o),alert("\u78BA\u8A8D\u652F\u4ED8\u5931\u6557")}finally{this.loading.set(!1)}}async pollOrderStatus(n){(await this.walletService.pollRechargeOrderStatus(n,1e4,36)).confirmed&&(await this.walletService.loadWallet(),console.log("Recharge confirmed:",n)),this.pollingStatus.set(!1)}static{this.\u0275fac=function(o){return new(o||r)(M($),M(B))}}static{this.\u0275cmp=O({type:r,selectors:[["app-wallet-recharge"]],decls:87,vars:18,consts:[[1,"recharge-view"],[1,"view-header"],[1,"header-left"],[1,"back-btn",3,"click"],[1,"icon"],[1,"current-balance"],[1,"label"],[1,"amount"],[1,"section"],[1,"package-grid"],[1,"package-item",3,"selected","recommended"],[1,"custom-amount"],[1,"input-group"],[1,"currency"],["type","number","placeholder","5 - 1000","min","5","max","1000",3,"ngModelChange","input","ngModel"],[1,"hint"],[1,"payment-methods"],[1,"payment-method",3,"click"],[1,"method-icon"],[1,"method-info"],[1,"method-name"],[1,"method-desc"],[1,"method-badge","recommended"],[1,"section","payment-summary"],[1,"summary-rows"],[1,"summary-row"],[1,"value"],["class","summary-row bonus",4,"ngIf"],["class","summary-row",4,"ngIf"],[1,"summary-row","total"],[1,"action-bar"],[1,"confirm-btn",3,"click","disabled"],["class","modal-overlay",4,"ngIf"],["class","loading-overlay",4,"ngIf"],[1,"package-item",3,"click"],[1,"package-amount"],[1,"package-bonus"],[1,"recommended-badge"],[1,"summary-row","bonus"],[1,"modal-overlay"],[1,"modal","usdt-modal"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"modal-body"],[1,"usdt-info"],[1,"qr-code-container"],["alt","USDT Address QR Code",1,"qr-code-img",3,"src"],[1,"qr-loading"],[1,"address-box"],[1,"network-badge"],[1,"address"],[1,"copy-btn",3,"click"],[1,"usdt-notes"],[1,"modal-footer"],[1,"primary-btn",3,"click"],[1,"loading-overlay"],[1,"loading-spinner"]],template:function(o,a){o&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),c("click",function(){return a.goBack()}),e(4,"span",4),i(5,"\u2190"),t()(),e(6,"h1"),i(7,"\u{1F4B3} \u5145\u503C"),t()()(),e(8,"div",5)(9,"span",6),i(10,"\u7576\u524D\u9918\u984D"),t(),e(11,"span",7),i(12),t()(),e(13,"div",8)(14,"h2"),i(15,"\u9078\u64C7\u5145\u503C\u91D1\u984D"),t(),e(16,"div",9),E(17,G,5,7,"div",10,H),t(),e(19,"div",11)(20,"span",6),i(21,"\u6216\u8F38\u5165\u81EA\u5B9A\u7FA9\u91D1\u984D\uFF1A"),t(),e(22,"div",12)(23,"span",13),i(24,"$"),t(),e(25,"input",14),F("ngModelChange",function(_){return R(a.customAmount,_)||(a.customAmount=_),_}),c("input",function(){return a.onCustomAmountChange()}),t()(),e(26,"span",15),i(27,"\u81EA\u5B9A\u7FA9\u91D1\u984D\u7121\u8D08\u9001"),t()()(),e(28,"div",8)(29,"h2"),i(30,"\u9078\u64C7\u652F\u4ED8\u65B9\u5F0F"),t(),e(31,"div",16)(32,"div",17),c("click",function(){return a.selectMethod("usdt_trc20")}),e(33,"div",18),i(34,"\u{1F48E}"),t(),e(35,"div",19)(36,"div",20),i(37,"USDT (TRC20)"),t(),e(38,"div",21),i(39,"0% \u624B\u7E8C\u8CBB \xB7 \u63A8\u85A6"),t()(),e(40,"div",22),i(41,"\u63A8\u85A6"),t()(),e(42,"div",17),c("click",function(){return a.selectMethod("alipay")}),e(43,"div",18),i(44,"\u{1F499}"),t(),e(45,"div",19)(46,"div",20),i(47,"\u652F\u4ED8\u5BF6"),t(),e(48,"div",21),i(49,"2% \u624B\u7E8C\u8CBB"),t()()(),e(50,"div",17),c("click",function(){return a.selectMethod("wechat")}),e(51,"div",18),i(52,"\u{1F49A}"),t(),e(53,"div",19)(54,"div",20),i(55,"\u5FAE\u4FE1\u652F\u4ED8"),t(),e(56,"div",21),i(57,"2% \u624B\u7E8C\u8CBB"),t()()(),e(58,"div",17),c("click",function(){return a.selectMethod("bank")}),e(59,"div",18),i(60,"\u{1F3E6}"),t(),e(61,"div",19)(62,"div",20),i(63,"\u9280\u884C\u5361"),t(),e(64,"div",21),i(65,"1% \u624B\u7E8C\u8CBB"),t()()()()(),e(66,"div",23)(67,"h2"),i(68,"\u{1F4B0} \u652F\u4ED8\u660E\u7D30"),t(),e(69,"div",24)(70,"div",25)(71,"span",6),i(72,"\u5145\u503C\u91D1\u984D"),t(),e(73,"span",26),i(74),t()(),y(75,J,5,1,"div",27)(76,K,5,1,"div",28),e(77,"div",29)(78,"span",6),i(79,"\u5BE6\u969B\u5230\u8CEC"),t(),e(80,"span",26),i(81),t()()()(),e(82,"div",30)(83,"button",31),c("click",function(){return a.proceed()}),i(84),t()(),y(85,ee,39,5,"div",32)(86,te,4,0,"div",33),t()),o&2&&(d(12),f(a.walletService.balanceDisplay()),d(5),S(a.packages()),d(8),A("ngModel",a.customAmount),d(7),g("selected",a.selectedMethod()==="usdt_trc20"),d(10),g("selected",a.selectedMethod()==="alipay"),d(8),g("selected",a.selectedMethod()==="wechat"),d(8),g("selected",a.selectedMethod()==="bank"),d(16),f(a.formatAmount(a.rechargeAmount())),d(),p("ngIf",a.bonusAmount()>0),d(),p("ngIf",a.feeAmount()>0),d(5),f(a.formatAmount(a.actualAmount())),d(2),p("disabled",!a.canProceed()),d(),x(" \u78BA\u8A8D\u652F\u4ED8 ",a.formatAmount(a.payAmount())," "),d(),p("ngIf",a.showUsdtModal()),d(),p("ngIf",a.loading()))},dependencies:[I,T,j,W,U,z,q,V,N],styles:[".recharge-view[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,#1a1a2e,#16213e,#0f3460);padding:20px 20px 100px;color:#fff}.view-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.back-btn[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:12px;background:#ffffff1a;border:none;color:#fff;font-size:20px;cursor:pointer}h1[_ngcontent-%COMP%]{font-size:24px;font-weight:600;margin:0}.current-balance[_ngcontent-%COMP%]{text-align:center;padding:20px;background:#ffffff0d;border-radius:16px;margin-bottom:24px}.current-balance[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;font-size:14px;opacity:.7;margin-bottom:8px}.current-balance[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:#667eea}.section[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:16px;padding:20px;margin-bottom:20px}.section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin:0 0 16px}.package-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}.package-item[_ngcontent-%COMP%]{position:relative;padding:20px 12px;background:#ffffff0d;border:2px solid transparent;border-radius:12px;text-align:center;cursor:pointer;transition:all .2s}.package-item[_ngcontent-%COMP%]:hover{border-color:#667eea80}.package-item.selected[_ngcontent-%COMP%]{border-color:#667eea;background:#667eea1a}.package-item.recommended[_ngcontent-%COMP%]{border-color:#f59e0b80}.package-amount[_ngcontent-%COMP%]{font-size:20px;font-weight:700;margin-bottom:4px}.package-bonus[_ngcontent-%COMP%]{font-size:12px;color:#f59e0b}.recommended-badge[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;background:#f59e0b;color:#000;font-size:10px;padding:2px 8px;border-radius:10px;font-weight:600}.custom-amount[_ngcontent-%COMP%]{margin-top:16px;display:flex;align-items:center;gap:12px;flex-wrap:wrap}.custom-amount[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:14px;opacity:.7}.input-group[_ngcontent-%COMP%]{display:flex;align-items:center;background:#ffffff1a;border-radius:8px;padding:0 12px}.input-group[_ngcontent-%COMP%]   .currency[_ngcontent-%COMP%]{font-size:16px;opacity:.7}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100px;padding:10px 8px;background:transparent;border:none;color:#fff;font-size:16px}.custom-amount[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:12px;opacity:.5}.payment-methods[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.payment-method[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px;background:#ffffff0d;border:2px solid transparent;border-radius:12px;cursor:pointer;transition:all .2s}.payment-method[_ngcontent-%COMP%]:hover{border-color:#fff3}.payment-method.selected[_ngcontent-%COMP%]{border-color:#667eea;background:#667eea1a}.method-icon[_ngcontent-%COMP%]{font-size:24px}.method-info[_ngcontent-%COMP%]{flex:1}.method-name[_ngcontent-%COMP%]{font-size:14px;font-weight:500}.method-desc[_ngcontent-%COMP%]{font-size:12px;opacity:.6}.method-badge.recommended[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-size:11px;padding:4px 10px;border-radius:10px}.payment-summary[_ngcontent-%COMP%]   .summary-rows[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:14px}.summary-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{opacity:.7}.summary-row.bonus[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#f59e0b}.summary-row.total[_ngcontent-%COMP%]{padding-top:12px;border-top:1px solid rgba(255,255,255,.1);font-size:18px;font-weight:600}.summary-row.total[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#22c55e}.action-bar[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;padding:16px 20px;background:#1a1a2ef2;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.confirm-btn[_ngcontent-%COMP%]{width:100%;padding:16px;border-radius:12px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;color:#fff;font-size:16px;font-weight:600;cursor:pointer;transition:all .2s}.confirm-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.confirm-btn[_ngcontent-%COMP%]:not(:disabled):hover{transform:translateY(-2px);box-shadow:0 8px 20px #667eea66}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000c;display:flex;align-items:center;justify-content:center;z-index:100;padding:20px}.modal[_ngcontent-%COMP%]{background:#1a1a2e;border-radius:20px;max-width:400px;width:100%}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid rgba(255,255,255,.1)}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px}.close-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;background:#ffffff1a;border:none;color:#fff;font-size:20px;cursor:pointer}.modal-body[_ngcontent-%COMP%]{padding:20px}.usdt-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:16px}.qr-code-container[_ngcontent-%COMP%]{width:180px;height:180px;margin:0 auto 20px;background:#fff;border-radius:12px;display:flex;align-items:center;justify-content:center;overflow:hidden}.qr-code-img[_ngcontent-%COMP%]{width:160px;height:160px;object-fit:contain}.qr-loading[_ngcontent-%COMP%]{color:#666;font-size:14px;display:flex;align-items:center;justify-content:center;color:#333}.address-box[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:12px;padding:16px;margin-bottom:20px}.network-badge[_ngcontent-%COMP%]{display:inline-block;background:#22c55e;color:#fff;font-size:11px;padding:4px 10px;border-radius:10px;margin-bottom:8px}.address[_ngcontent-%COMP%]{font-family:monospace;font-size:12px;word-break:break-all;margin-bottom:12px;opacity:.9}.copy-btn[_ngcontent-%COMP%]{width:100%;padding:10px;background:#667eea33;border:1px solid #667eea;color:#667eea;border-radius:8px;cursor:pointer}.usdt-notes[_ngcontent-%COMP%]{font-size:13px;opacity:.7}.usdt-notes[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:8px 0 0 16px;padding:0}.usdt-notes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:4px}.modal-footer[_ngcontent-%COMP%]{padding:20px;border-top:1px solid rgba(255,255,255,.1)}.primary-btn[_ngcontent-%COMP%]{width:100%;padding:14px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:10px;color:#fff;font-size:15px;font-weight:600;cursor:pointer}.loading-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;z-index:200}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid rgba(255,255,255,.2);border-top-color:#667eea;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})}};export{Y as WalletRechargeComponent};
