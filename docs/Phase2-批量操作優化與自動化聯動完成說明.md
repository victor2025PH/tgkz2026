# Phase 2 - æ‰¹é‡æ“ä½œå„ªåŒ–èˆ‡è‡ªå‹•åŒ–ä¸­å¿ƒè¯å‹• å®Œæˆèªªæ˜

## âœ… å·²å®Œæˆé …ç›®

### 1. BatchOperator å¢å¼· (v2.0)

**æ–‡ä»¶**: `src/group-search/engines/batch-operator.ts`

#### æ–°å¢åŠŸèƒ½ï¼š
- âœ… **å¤šå¸³è™Ÿè¼ªæ›æ”¯æŒ**
  - æ”¯æ´å¤šå€‹ TG å®¢æˆ¶ç«¯åŒæ™‚ç®¡ç†
  - å››ç¨®è¼ªæ›ç­–ç•¥ï¼š`round_robin`ã€`health_based`ã€`random`ã€`least_used`
  - è‡ªå‹•å¸³è™Ÿåˆ‡æ›é–¾å€¼ï¼ˆé€£çºŒå¤±æ•— 3 æ¬¡åˆ‡æ›ï¼‰
  - å¸³è™Ÿå†·å»æ©Ÿåˆ¶ï¼ˆ30 åˆ†é˜å†·å»æœŸï¼‰

- âœ… **å„ªå…ˆç´šéšŠåˆ—ç®¡ç†**
  - æ”¯æ´ `high`ã€`normal`ã€`low` ä¸‰ç´šå„ªå…ˆç´š
  - æŒ‰å„ªå…ˆç´šè‡ªå‹•æ’åºå…¥éšŠ
  - æœ€å¤§éšŠåˆ—é•·åº¦é™åˆ¶ï¼ˆ100 å€‹æ“ä½œï¼‰

- âœ… **äº‹ä»¶ç³»çµ±**
  - æ”¯æ´äº‹ä»¶è¨‚é–±ï¼š`on(event, callback)`
  - äº‹ä»¶é¡å‹ï¼š`operation_started`ã€`operation_progress`ã€`operation_paused`ã€`operation_completed`ã€`account_switched` ç­‰

- âœ… **æ“´å±•é…ç½®**
  - `ExtendedBatchConfig` é¡å‹æ”¯æ´å®Œæ•´é…ç½®
  - é è¦½æ“ä½œåŠŸèƒ½ `previewOperation()`
  - éšŠåˆ—æ‘˜è¦ `getQueueSummary()`

- âœ… **å¸³è™Ÿä½¿ç”¨çµ±è¨ˆ**
  - è¿½è¹¤æ¯å€‹å¸³è™Ÿçš„ç™¼é€æ¬¡æ•¸ã€æˆåŠŸç‡
  - æ”¯æ´å¸³è™Ÿå¥åº·åº¦è©•ä¼°

### 2. TriggerSystem æ“´å±•

**æ–‡ä»¶**: `src/group-search/automation/trigger-system.ts`

#### æ–°å¢å‹•ä½œé¡å‹ï¼š
- âœ… `execute_batch` - åŸ·è¡Œé€šç”¨æ‰¹é‡æ“ä½œ
- âœ… `batch_message` - æ‰¹é‡ç™¼é€æ¶ˆæ¯
- âœ… `batch_invite` - æ‰¹é‡é‚€è«‹æˆå“¡

#### å‹•ä½œåƒæ•¸ï¼š
```typescript
// batch_message åƒæ•¸
{
  memberSource: 'context' | 'group' | 'list',
  groupId?: string,
  memberIds?: string[],
  messageTemplate: string,
  messageVariables?: Record<string, string>,
  priority?: 'high' | 'normal' | 'low',
  useAccountRotation?: boolean
}
```

### 3. WorkflowEngine æ“´å±•

**æ–‡ä»¶**: `src/group-search/automation/workflow-engine.ts`

#### æ–°å¢ç¯€é»é¡å‹ï¼š
- âœ… `batch_message` - æ‰¹é‡ç™¼é€æ¶ˆæ¯ç¯€é»
- âœ… `batch_invite` - æ‰¹é‡é‚€è«‹æˆå“¡ç¯€é»
- âœ… `batch_tag` - æ‰¹é‡æ¨™ç±¤æ“ä½œç¯€é»
- âœ… `member_extract` - æˆå“¡æå–ç¯€é»

#### ç¯€é»é…ç½®ç¤ºä¾‹ï¼š
```typescript
// batch_message ç¯€é»
{
  type: 'batch_message',
  config: {
    memberSource: 'context',
    messageTemplate: '{{greeting}} {{name}}...',
    priority: 'normal',
    useAccountRotation: true,
    maxAccountsToUse: 3
  }
}
```

### 4. BatchAutomationBridge æ•´åˆæœå‹™

**æ–‡ä»¶**: `src/group-search/automation/batch-automation-bridge.ts`

#### åŠŸèƒ½ï¼š
- âœ… é€£æ¥ BatchOperator èˆ‡ TriggerSystem
- âœ… é€£æ¥ BatchOperator èˆ‡ WorkflowEngine
- âœ… çµ±ä¸€çš„æ‰¹é‡ä½œæ¥­èª¿åº¦
- âœ… ä½œæ¥­ç‹€æ…‹åŒæ­¥
- âœ… äº‹ä»¶å‚³éèˆ‡è¿½è¹¤

#### ä¸»è¦ APIï¼š
```typescript
// å‰µå»ºä¸¦æ’éšŠæ‰¹é‡ä½œæ¥­
createAndQueueJob(config: BatchJobConfig): Promise<BatchJobStatus>

// å–æ¶ˆ/æš«åœ/æ¢å¾©ä½œæ¥­
cancelJob(jobId: string): boolean
pauseJob(jobId: string): boolean
resumeJob(jobId: string): Promise<boolean>

// ç²å–çµ±è¨ˆ
getStatsSummary(): BatchStats
```

### 5. æ‰¹é‡æ“ä½œé€²åº¦è¿½è¹¤ UI

**æ–‡ä»¶**: `src/group-search/ui/batch-operation-panel.component.ts`

#### åŠŸèƒ½ï¼š
- âœ… ç•¶å‰æ“ä½œé€²åº¦é¡¯ç¤ºï¼ˆæˆåŠŸ/å¤±æ•—/ç¸½è¨ˆï¼‰
- âœ… æ“ä½œæ§åˆ¶ï¼ˆæš«åœ/ç¹¼çºŒ/åœæ­¢ï¼‰
- âœ… æ“ä½œéšŠåˆ—ç®¡ç†ï¼ˆæ’åº/ç§»é™¤ï¼‰
- âœ… æ“ä½œæ­·å²è¨˜éŒ„
- âœ… çµ±è¨ˆæ‘˜è¦é¡¯ç¤º
- âœ… é è¨ˆå‰©é¤˜æ™‚é–“è¨ˆç®—
- âœ… ç•¶å‰å¸³è™Ÿé¡¯ç¤º
- âœ… ä¸‰ç¨®è¦–åœ–æ¨¡å¼ï¼š`compact`ã€`expanded`ã€`full`

### 6. Dashboard æ‰¹é‡æ“ä½œä¸­å¿ƒ

**æ–‡ä»¶**: `src/group-search/ui/dashboard.component.ts`

#### æ–°å¢ï¼š
- âœ… ã€Œæ‰¹é‡æ“ä½œã€æ¨™ç±¤é 
- âœ… æ“ä½œçµ±è¨ˆå¡ç‰‡
- âœ… ç•¶å‰æ“ä½œé€²åº¦é¢æ¿
- âœ… æ“ä½œéšŠåˆ—åˆ—è¡¨
- âœ… æ“ä½œæ­·å²è¨˜éŒ„
- âœ… è‡ªå‹•åŒ–è¯å‹•èªªæ˜

---

## ğŸ“‹ ä½¿ç”¨èªªæ˜

### 1. å¾è§¸ç™¼å™¨åŸ·è¡Œæ‰¹é‡æ“ä½œ

åœ¨è‡ªå‹•åŒ–ä¸­å¿ƒå‰µå»ºè§¸ç™¼å™¨æ™‚ï¼Œå¯ä»¥é¸æ“‡ä»¥ä¸‹å‹•ä½œï¼š

- **æ‰¹é‡ç™¼é€æ¶ˆæ¯** (`batch_message`)
  - è¨­ç½®æˆå“¡ä¾†æºï¼šä¸Šä¸‹æ–‡/ç¾¤çµ„/åˆ—è¡¨
  - è¨­ç½®æ¶ˆæ¯æ¨¡æ¿å’Œè®Šé‡
  - è¨­ç½®å„ªå…ˆç´šå’Œå¸³è™Ÿè¼ªæ›

- **æ‰¹é‡é‚€è«‹æˆå“¡** (`batch_invite`)
  - è¨­ç½®æˆå“¡ä¾†æº
  - è¨­ç½®ç›®æ¨™ç¾¤çµ„
  - è¨­ç½®å»¶é²å’Œå¸³è™Ÿè¼ªæ›

### 2. å¾å·¥ä½œæµåŸ·è¡Œæ‰¹é‡æ“ä½œ

åœ¨å·¥ä½œæµç·¨è¼¯å™¨ä¸­æ‹–å…¥ä»¥ä¸‹ç¯€é»ï¼š

- **batch_message** - æ‰¹é‡ç™¼é€æ¶ˆæ¯
- **batch_invite** - æ‰¹é‡é‚€è«‹æˆå“¡
- **batch_tag** - æ‰¹é‡æ¨™ç±¤æ“ä½œ
- **member_extract** - æˆå“¡æå–ï¼ˆå¯ä½œç‚ºæ‰¹é‡æ“ä½œçš„æ•¸æ“šä¾†æºï¼‰

### 3. å¤šå¸³è™Ÿè¼ªæ›é…ç½®

```typescript
// é…ç½®ç¤ºä¾‹
{
  enableAccountRotation: true,
  maxAccountsToUse: 3,
  rotationStrategy: 'health_based',  // å„ªå…ˆä½¿ç”¨å¥åº·åº¦é«˜çš„å¸³è™Ÿ
  accountIds: ['account1', 'account2', 'account3']  // å¯é¸ï¼ŒæŒ‡å®šä½¿ç”¨çš„å¸³è™Ÿ
}
```

### 4. å„ªå…ˆç´šè¨­ç½®

- **high** - é«˜å„ªå…ˆç´šï¼Œæ’å…¥éšŠåˆ—å‰ç«¯
- **normal** - æ­£å¸¸å„ªå…ˆç´šï¼ˆé»˜èªï¼‰
- **low** - ä½å„ªå…ˆç´šï¼Œæ’åœ¨éšŠåˆ—æœ«å°¾

---

## ğŸ”§ æŠ€è¡“æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Dashboard (UI Layer)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ BatchOperation  â”‚  â”‚   Automation    â”‚                   â”‚
â”‚  â”‚     Panel       â”‚  â”‚     Panel       â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚
            â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BatchAutomationBridge (æ©‹æ¥å±¤)                â”‚
â”‚  - çµ±ä¸€èª¿åº¦æ‰¹é‡ä½œæ¥­                                         â”‚
â”‚  - äº‹ä»¶å‚³éèˆ‡ç‹€æ…‹åŒæ­¥                                       â”‚
â”‚  - è§¸ç™¼å™¨/å·¥ä½œæµå‹•ä½œè™•ç†                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚
            â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BatchOperator   â”‚  â”‚  TriggerSystem /   â”‚
â”‚   (æ‰¹é‡æ“ä½œå¼•æ“)   â”‚â—„â”€â”¤  WorkflowEngine   â”‚
â”‚  - å¤šå¸³è™Ÿè¼ªæ›      â”‚  â”‚  (è‡ªå‹•åŒ–å¼•æ“)      â”‚
â”‚  - å„ªå…ˆç´šéšŠåˆ—      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  - é˜²å°ç­–ç•¥        â”‚
â”‚  - é€²åº¦è¿½è¹¤        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ–°å¢/ä¿®æ”¹æ–‡ä»¶æ¸…å–®

### æ–°å¢æ–‡ä»¶
- `src/group-search/automation/batch-automation-bridge.ts`
- `src/group-search/ui/batch-operation-panel.component.ts`

### ä¿®æ”¹æ–‡ä»¶
- `src/group-search/engines/batch-operator.ts` - å¤§å¹…å¢å¼·
- `src/group-search/engines/index.ts` - æ–°å¢å°å‡º
- `src/group-search/automation/trigger-system.ts` - æ–°å¢å‹•ä½œé¡å‹
- `src/group-search/automation/workflow-engine.ts` - æ–°å¢ç¯€é»é¡å‹
- `src/group-search/automation/index.ts` - æ–°å¢å°å‡º
- `src/group-search/ui/dashboard.component.ts` - æ–°å¢æ‰¹é‡æ“ä½œé é¢
- `src/group-search/ui/index.ts` - æ–°å¢å°å‡º

---

## âš ï¸ æ³¨æ„äº‹é …

1. **å¸³è™Ÿè¼ªæ›éœ€è¦é å…ˆè¨­ç½®å¤šå€‹ TG å®¢æˆ¶ç«¯**
   ```typescript
   batchOperator.setClient(client1, 'account1');
   batchOperator.setClient(client2, 'account2');
   ```

2. **è§¸ç™¼å™¨å‹•ä½œçš„å¯¦éš›åŸ·è¡Œéœ€è¦é…åˆå¾Œç«¯**
   - å‰ç«¯è™•ç†è§¸ç™¼é‚è¼¯å’Œåƒæ•¸è§£æ
   - å¯¦éš›ç™¼é€æ¶ˆæ¯/é‚€è«‹éœ€è¦é€šé IPC èª¿ç”¨å¾Œç«¯

3. **å»ºè­°çš„é˜²å°ç­–ç•¥**
   - å»¶é²ç¯„åœï¼š30-60 ç§’
   - æ¯å°æ™‚ä¸Šé™ï¼š20 æ¢
   - æ¯æ—¥ä¸Šé™ï¼š50 æ¢
   - å¸³è™Ÿè¼ªæ›é–“éš”ï¼š20 æ¢

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè­°

1. **Phase 3: å¾Œç«¯æ•´åˆ**
   - å¯¦ç¾ IPC é€šé“è™•ç†æ‰¹é‡æ“ä½œè«‹æ±‚
   - æ·»åŠ çœŸå¯¦çš„ Telegram API èª¿ç”¨

2. **å¢å¼·åŠŸèƒ½**
   - æ‰¹é‡æ“ä½œæ¨¡æ¿ä¿å­˜/è¼‰å…¥
   - æ“ä½œè¨ˆåŠƒæ’ç¨‹ï¼ˆå®šæ™‚åŸ·è¡Œï¼‰
   - æ›´è©³ç´°çš„å¤±æ•—åŸå› åˆ†æ

3. **æ¸¬è©¦é©—è­‰**
   - æ¸¬è©¦å¤šå¸³è™Ÿè¼ªæ›é‚è¼¯
   - æ¸¬è©¦å„ªå…ˆç´šéšŠåˆ—æ’åº
   - æ¸¬è©¦è§¸ç™¼å™¨/å·¥ä½œæµæ•´åˆ

---

**ç‹€æ…‹ï¼šé–‹ç™¼å®Œæˆï¼Œç­‰å¾…æ¸¬è©¦å’Œé©—è­‰**

å®Œæˆæ™‚é–“ï¼š2026-01-15
