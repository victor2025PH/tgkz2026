# TG-AIæ™ºæ§ç‹ åŠŸèƒ½æ¸¬è©¦èˆ‡å„ªåŒ–æ–¹æ¡ˆ

## é …ç›®æ¦‚è¿°

æœ¬é …ç›®æ˜¯ä¸€å€‹ Telegram è‡ªå‹•åŒ–ç‡ŸéŠ·ç³»çµ±ï¼ŒåŒ…å«ä»¥ä¸‹ä¸»è¦æ¨¡å¡Šï¼š

### æ¶æ§‹çµ„æˆ
- **å‰ç«¯**: Angular 21 + Electron 28 (æ¡Œé¢æ‡‰ç”¨)
- **å¾Œç«¯**: Python (Pyrogram/Telethon + SQLite)
- **é€šä¿¡**: IPC (JSON-RPC over stdin/stdout)

---

## ğŸ“Š åŠŸèƒ½æ¨¡å¡Šæ¸…å–®

### ä¸€ã€æ ¸å¿ƒåŠŸèƒ½æ¨¡å¡Š

| æ¨¡å¡Š | å‰ç«¯çµ„ä»¶ | å¾Œç«¯æœå‹™ | å„ªå…ˆç´š |
|------|----------|----------|--------|
| è³¬æˆ¶ç®¡ç† | `account-card-list.component.ts` | `telegram_client.py`, `database.py` | P0 |
| ç™»éŒ„ç³»çµ± | `login.component.ts`, `qr-login.component.ts` | `qr_auth_manager.py` | P0 |
| é—œéµè©ç›£æ§ | `app.component.ts` (automation) | `keyword_matcher.py`, `trie_keyword_matcher.py` | P1 |
| æ¶ˆæ¯ç™¼é€ | `app.component.ts` (leads/ads) | `message_queue.py`, `ad_broadcaster.py` | P1 |
| ç¾¤çµ„ç®¡ç† | `group-search/` | `group_search_service.py`, `group_join_service.py` | P1 |

### äºŒã€AI åŠŸèƒ½æ¨¡å¡Š

| æ¨¡å¡Š | å‰ç«¯çµ„ä»¶ | å¾Œç«¯æœå‹™ | å„ªå…ˆç´š |
|------|----------|----------|--------|
| AI è‡ªå‹•èŠå¤© | `app.component.ts` (ai-center) | `ai_auto_chat.py`, `ai_response_strategy.py` | P2 |
| RAG çŸ¥è­˜åº« | `app.component.ts` (rag) | `telegram_rag_system.py`, `knowledge_base/` | P2 |
| èªéŸ³æœå‹™ | `app.component.ts` (voice) | - | P3 |

### ä¸‰ã€ç‡ŸéŠ·è‡ªå‹•åŒ–æ¨¡å¡Š

| æ¨¡å¡Š | å‰ç«¯çµ„ä»¶ | å¾Œç«¯æœå‹™ | å„ªå…ˆç´š |
|------|----------|----------|--------|
| å»£å‘Šç³»çµ± | `app.component.ts` (ads) | `ad_manager.py`, `ad_scheduler.py`, `ad_analytics.py` | P1 |
| ç‡ŸéŠ·æ¼æ–— | `conversion-funnel.component.ts` | `auto_funnel_manager.py` | P2 |
| ç”¨æˆ¶è¿½è¹¤ | `app.component.ts` (user-tracking) | `user_tracker.py`, `user_analytics.py` | P2 |

### å››ã€ç³»çµ±ç®¡ç†æ¨¡å¡Š

| æ¨¡å¡Š | å‰ç«¯çµ„ä»¶ | å¾Œç«¯æœå‹™ | å„ªå…ˆç´š |
|------|----------|----------|--------|
| æœƒå“¡ç³»çµ± | `membership.service.ts`, `auth.service.ts` | `membership.py`, `license_server.py` | P1 |
| æ•¸æ“šå‚™ä»½ | `backup.service.ts` | `backup_manager.py` | P2 |
| æ—¥èªŒç³»çµ± | `app.component.ts` (logs) | `log_rotator.py` | P3 |
| æ€§èƒ½ç›£æ§ | `performance-monitor.component.ts` | `performance_monitor.py` | P3 |

---

## ğŸ§ª åˆ†éšæ®µæ¸¬è©¦è¨ˆåŠƒ

### ç¬¬ä¸€éšæ®µï¼šæ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦ (P0) - é è¨ˆ 3 å¤©

#### 1.1 è³¬æˆ¶ç®¡ç†æ¸¬è©¦

**æ¸¬è©¦é …ç›®ï¼š**
```
â–¡ æ·»åŠ è³¬æˆ¶ï¼ˆæ‰‹æ©Ÿè™Ÿ + API ID/Hashï¼‰
â–¡ QR ç¢¼ç™»éŒ„
â–¡ é©—è­‰ç¢¼è¼¸å…¥
â–¡ 2FA å¯†ç¢¼è¼¸å…¥
â–¡ è³¬æˆ¶åŒæ­¥ï¼ˆé ­åƒã€æ˜µç¨±ï¼‰
â–¡ è³¬æˆ¶é€€å‡º
â–¡ è³¬æˆ¶åˆªé™¤
â–¡ ä»£ç†è¨­ç½®å’Œæ¸¬è©¦
â–¡ æ‰¹é‡æ“ä½œï¼ˆé¸æ“‡ã€æ¨™ç±¤ï¼‰
```

**æ¸¬è©¦è…³æœ¬ï¼š**
```bash
# å¾Œç«¯å–®å…ƒæ¸¬è©¦
cd backend
python -m pytest tests/test_database.py -v
python -m pytest tests/test_integration.py -v
```

**å·²çŸ¥å•é¡Œæ¸…å–®ï¼š**
- [ ] QR ç™»éŒ„æœ‰æ™‚ä¸é¡¯ç¤º
- [ ] è³¬æˆ¶ç‹€æ…‹ä¸ä¸€è‡´ï¼ˆå·²ä¿®å¾©ï¼‰
- [ ] API æ†‘è­‰ä¿å­˜å•é¡Œï¼ˆå·²ä¿®å¾©ï¼‰

#### 1.2 IPC é€šä¿¡æ¸¬è©¦

**æ¸¬è©¦é …ç›®ï¼š**
```
â–¡ å‰å¾Œç«¯é€šä¿¡é€£æ¥
â–¡ å‘½ä»¤ç™¼é€å’ŒéŸ¿æ‡‰
â–¡ äº‹ä»¶æ¨é€
â–¡ éŒ¯èª¤è™•ç†
â–¡ è¶…æ™‚è™•ç†
```

**æª¢æŸ¥é»ï¼š**
```javascript
// electron.js - passThroughChannels å®Œæ•´æ€§
const passThroughChannels = [
  'get-initial-state', 'add-account', 'login-account', 
  'logout-account', 'update-account', 'sync-account-info',
  // ... æª¢æŸ¥æ‰€æœ‰éœ€è¦çš„å‘½ä»¤
];
```

---

### ç¬¬äºŒéšæ®µï¼šè‡ªå‹•åŒ–åŠŸèƒ½æ¸¬è©¦ (P1) - é è¨ˆ 5 å¤©

#### 2.1 é—œéµè©ç›£æ§æ¸¬è©¦

**æ¸¬è©¦é …ç›®ï¼š**
```
â–¡ æ·»åŠ é—œéµè©é›†
â–¡ æ·»åŠ é—œéµè©ï¼ˆæ™®é€š/æ­£å‰‡ï¼‰
â–¡ æ·»åŠ ç›£æ§ç¾¤çµ„
â–¡ å•Ÿå‹•ç›£æ§
â–¡ æ¶ˆæ¯åŒ¹é…
â–¡ æ½›åœ¨å®¢æˆ¶æ•ç²
â–¡ åœæ­¢ç›£æ§
```

**æ¸¬è©¦æ•¸æ“šï¼š**
```json
{
  "keywordSet": { "name": "æ¸¬è©¦é›†", "keywords": ["bitcoin", "BTC|ETH"] },
  "group": { "url": "@test_group" }
}
```

#### 2.2 æ¶ˆæ¯ç™¼é€æ¸¬è©¦

**æ¸¬è©¦é …ç›®ï¼š**
```
â–¡ å–®æ¢æ¶ˆæ¯ç™¼é€
â–¡ æ‰¹é‡æ¶ˆæ¯ç™¼é€
â–¡ æ¶ˆæ¯éšŠåˆ—
â–¡ ç™¼é€é™åˆ¶ï¼ˆæ¯æ—¥/æ¯å°æ™‚ï¼‰
â–¡ Spintax è™•ç†
â–¡ åª’é«”é™„ä»¶
â–¡ ç™¼é€å»¶é²
```

#### 2.3 å»£å‘Šç³»çµ±æ¸¬è©¦

**æ¸¬è©¦é …ç›®ï¼š**
```
â–¡ å‰µå»ºå»£å‘Šæ¨¡æ¿
â–¡ è¨­ç½®å»£å‘Šè¨ˆåŠƒ
â–¡ å»£å‘ŠæŠ•æ”¾
â–¡ å»£å‘Šçµ±è¨ˆ
â–¡ A/B æ¸¬è©¦
```

---

### ç¬¬ä¸‰éšæ®µï¼šAI åŠŸèƒ½æ¸¬è©¦ (P2) - é è¨ˆ 4 å¤©

#### 3.1 AI è‡ªå‹•èŠå¤©æ¸¬è©¦

**æ¸¬è©¦é …ç›®ï¼š**
```
â–¡ AI é…ç½®ï¼ˆAPI Key/æœ¬åœ°æ¨¡å‹ï¼‰
â–¡ é€£æ¥æ¸¬è©¦
â–¡ è‡ªå‹•å›è¦†é–‹é—œ
â–¡ å›è¦†æ¨¡å¼ï¼ˆåŠè‡ªå‹•/å…¨è‡ªå‹•ï¼‰
â–¡ ä¸Šä¸‹æ–‡è¨˜æ†¶
â–¡ å›è¦†è³ªé‡
```

#### 3.2 RAG çŸ¥è­˜åº«æ¸¬è©¦

**æ¸¬è©¦é …ç›®ï¼š**
```
â–¡ æ–‡æª”ä¸Šå‚³
â–¡ çŸ¥è­˜åº«ç´¢å¼•
â–¡ èªç¾©æœç´¢
â–¡ å•ç­”ç”Ÿæˆ
```

---

### ç¬¬å››éšæ®µï¼šæœƒå“¡èˆ‡å®‰å…¨æ¸¬è©¦ (P1-P2) - é è¨ˆ 2 å¤©

#### 4.1 æœƒå“¡ç³»çµ±æ¸¬è©¦

**æ¸¬è©¦é …ç›®ï¼š**
```
â–¡ å…ç™»éŒ„æ¨¡å¼ï¼ˆå·²å¯¦ç¾ï¼‰
â–¡ æœƒå“¡ç­‰ç´šé…é¡
â–¡ åŠŸèƒ½é™åˆ¶
â–¡ å¡å¯†æ¿€æ´»
```

#### 4.2 å®‰å…¨æ¸¬è©¦

**æ¸¬è©¦é …ç›®ï¼š**
```
â–¡ æ•¸æ“šåŠ å¯†
â–¡ Session æ–‡ä»¶ä¿è­·
â–¡ ä»£ç†å®‰å…¨
â–¡ éŒ¯èª¤ä¸æ´©éœ²æ•æ„Ÿä¿¡æ¯
```

---

### ç¬¬äº”éšæ®µï¼šæ€§èƒ½èˆ‡ç©©å®šæ€§æ¸¬è©¦ (P3) - é è¨ˆ 3 å¤©

#### 5.1 æ€§èƒ½æ¸¬è©¦

**æ¸¬è©¦é …ç›®ï¼š**
```
â–¡ å¤šè³¬æˆ¶ä¸¦ç™¼ï¼ˆ10/50/100ï¼‰
â–¡ å¤§é‡æ¶ˆæ¯è™•ç†
â–¡ å…§å­˜ä½¿ç”¨
â–¡ CPU ä½¿ç”¨
â–¡ æ•¸æ“šåº«æ€§èƒ½
```

#### 5.2 ç©©å®šæ€§æ¸¬è©¦

**æ¸¬è©¦é …ç›®ï¼š**
```
â–¡ é•·æ™‚é–“é‹è¡Œï¼ˆ24å°æ™‚ï¼‰
â–¡ æ–·ç¶²æ¢å¾©
â–¡ å´©æ½°æ¢å¾©
â–¡ æ—¥èªŒè¼ªè½‰
```

---

## ğŸ”§ å„ªåŒ–æ–¹æ¡ˆ

### ä¸€ã€ä»£ç¢¼å„ªåŒ–

#### 1.1 å‰ç«¯å„ªåŒ–

**å•é¡Œï¼š** `app.component.ts` éå¤§ï¼ˆ8000+ è¡Œï¼‰
**æ–¹æ¡ˆï¼š**
```
1. æ‹†åˆ†ç‚ºç¨ç«‹çµ„ä»¶ï¼š
   - DashboardComponent
   - AutomationCenterComponent  
   - AICenterComponent
   - LeadsManagerComponent
   - AdsManagerComponent

2. ä½¿ç”¨æ‡¶åŠ è¼‰ï¼š
   - è·¯ç”±æ‡¶åŠ è¼‰å„æ¨¡å¡Š
   - æ¸›å°‘åˆå§‹åŠ è¼‰æ™‚é–“

3. ç‹€æ…‹ç®¡ç†ï¼š
   - è€ƒæ…®å¼•å…¥ NgRx æˆ– SignalStore
   - çµ±ä¸€ç‹€æ…‹ç®¡ç†
```

#### 1.2 å¾Œç«¯å„ªåŒ–

**å•é¡Œï¼š** `main.py` å‘½ä»¤è™•ç†åˆ†æ•£
**æ–¹æ¡ˆï¼š**
```python
# å»ºè­°ï¼šä½¿ç”¨å‘½ä»¤æ¨¡å¼é‡æ§‹
class CommandHandler:
    handlers = {
        'add-account': AccountHandler.add,
        'login-account': AccountHandler.login,
        'sync-account-info': AccountHandler.sync,
        # ...
    }
    
    async def dispatch(self, command, payload):
        handler = self.handlers.get(command)
        if handler:
            return await handler(payload)
```

### äºŒã€æ¶æ§‹å„ªåŒ–

#### 2.1 æ•¸æ“šåº«å„ªåŒ–

```sql
-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_accounts_phone ON accounts(phone);
CREATE INDEX idx_accounts_status ON accounts(status);
CREATE INDEX idx_leads_status ON leads(status);
CREATE INDEX idx_leads_timestamp ON leads(timestamp);

-- åˆ†è¡¨ç­–ç•¥ï¼ˆå¤§æ•¸æ“šé‡æ™‚ï¼‰
-- messages_2026_01, messages_2026_02 ...
```

#### 2.2 ç·©å­˜å„ªåŒ–

```python
# backend/cache_manager.py å¢å¼·
class CacheManager:
    def __init__(self, ttl=300):
        self.cache = {}
        self.ttl = ttl
        
    async def get_or_fetch(self, key, fetch_func):
        if key in self.cache and not self.is_expired(key):
            return self.cache[key]['data']
        data = await fetch_func()
        self.cache[key] = {'data': data, 'time': time.time()}
        return data
```

### ä¸‰ã€ç”¨æˆ¶é«”é©—å„ªåŒ–

#### 3.1 ç•Œé¢å„ªåŒ–

```
1. æ·»åŠ åŠ è¼‰ç‹€æ…‹æŒ‡ç¤ºå™¨ï¼ˆå·²æœ‰ LoadingOverlayï¼‰
2. æ·»åŠ æ“ä½œç¢ºèªå°è©±æ¡†
3. æ·»åŠ éµç›¤å¿«æ·éµæç¤º
4. å„ªåŒ–éŒ¯èª¤æç¤ºä¿¡æ¯
5. æ·»åŠ æ–°æ‰‹å¼•å°ï¼ˆå·²æœ‰ Onboardingï¼‰
```

#### 3.2 åŠŸèƒ½æ•´åˆ

**å•é¡Œï¼š** åŠŸèƒ½åˆ†æ•£ï¼Œç”¨æˆ¶å­¸ç¿’æˆæœ¬é«˜
**æ–¹æ¡ˆï¼š**
```
åˆä½µç›¸ä¼¼åŠŸèƒ½ï¼š
1. ã€Œç›£æ§ä¸­å¿ƒã€+ã€Œå‘Šè­¦ã€â†’ã€Œé‹è¡Œæ—¥èªŒã€ï¼ˆå·²å¯¦ç¾ï¼‰
2. ã€Œå»£å‘Šç™¼é€ã€+ã€Œç‡ŸéŠ·æ¼æ–—ã€â†’ã€Œç‡ŸéŠ·ä¸­å¿ƒã€
3. ã€Œæ½›åœ¨å®¢æˆ¶ã€+ã€Œç”¨æˆ¶è¿½è¹¤ã€â†’ã€Œå®¢æˆ¶ç®¡ç†ã€
```

### å››ã€ç©©å®šæ€§å„ªåŒ–

#### 4.1 éŒ¯èª¤è™•ç†å¢å¼·

```typescript
// å‰ç«¯å…¨å±€éŒ¯èª¤è™•ç†
@Injectable()
export class GlobalErrorHandler implements ErrorHandler {
  handleError(error: any): void {
    // 1. è¨˜éŒ„éŒ¯èª¤
    console.error('[GlobalError]', error);
    
    // 2. ç”¨æˆ¶å‹å¥½æç¤º
    this.toastService.error('æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦');
    
    // 3. ä¸Šå ±éŒ¯èª¤ï¼ˆå¯é¸ï¼‰
    // this.errorReporter.report(error);
  }
}
```

#### 4.2 é‡è©¦æ©Ÿåˆ¶

```python
# backend/retry_config.py å¢å¼·
@retry(
    stop=stop_after_attempt(3),
    wait=wait_exponential(multiplier=1, min=4, max=10),
    retry=retry_if_exception_type((ConnectionError, TimeoutError))
)
async def send_message_with_retry(client, chat_id, text):
    return await client.send_message(chat_id, text)
```

---

## ğŸ“‹ åŸ·è¡Œè¨ˆåŠƒ

### ç¬¬ä¸€é€±ï¼šåŸºç¤æ¸¬è©¦
| æ—¥æœŸ | ä»»å‹™ | è² è²¬ |
|------|------|------|
| Day 1-2 | P0 è³¬æˆ¶ç®¡ç†æ¸¬è©¦ | - |
| Day 3 | P0 IPC é€šä¿¡æ¸¬è©¦ | - |
| Day 4-5 | P1 é—œéµè©ç›£æ§æ¸¬è©¦ | - |

### ç¬¬äºŒé€±ï¼šåŠŸèƒ½æ¸¬è©¦
| æ—¥æœŸ | ä»»å‹™ | è² è²¬ |
|------|------|------|
| Day 1-2 | P1 æ¶ˆæ¯ç™¼é€æ¸¬è©¦ | - |
| Day 3-4 | P1 å»£å‘Šç³»çµ±æ¸¬è©¦ | - |
| Day 5 | P2 AI åŠŸèƒ½æ¸¬è©¦ | - |

### ç¬¬ä¸‰é€±ï¼šå„ªåŒ–å¯¦æ–½
| æ—¥æœŸ | ä»»å‹™ | è² è²¬ |
|------|------|------|
| Day 1-2 | ä»£ç¢¼é‡æ§‹ | - |
| Day 3-4 | æ€§èƒ½å„ªåŒ– | - |
| Day 5 | ç©©å®šæ€§æ¸¬è©¦ | - |

---

## âœ… æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### å•Ÿå‹•å‰æª¢æŸ¥
- [ ] Node.js ç’°å¢ƒæ­£å¸¸
- [ ] Python ç’°å¢ƒæ­£å¸¸
- [ ] æ•¸æ“šåº«æ–‡ä»¶å­˜åœ¨
- [ ] é…ç½®æ–‡ä»¶æ­£ç¢º

### æ¯æ—¥æ¸¬è©¦è¨˜éŒ„
```markdown
## æ¸¬è©¦æ—¥æœŸ: YYYY-MM-DD

### æ¸¬è©¦æ¨¡å¡Š: [æ¨¡å¡Šå]

### æ¸¬è©¦çµæœ:
- [x] é€šéé …ç›® 1
- [ ] å¤±æ•—é …ç›® 2

### ç™¼ç¾å•é¡Œ:
1. å•é¡Œæè¿°...
   - å¾©ç¾æ­¥é©Ÿ
   - é æœŸçµæœ
   - å¯¦éš›çµæœ

### ä¿®å¾©ç‹€æ…‹:
- [ ] å¾…ä¿®å¾©
- [ ] ä¿®å¾©ä¸­
- [x] å·²ä¿®å¾©
```

---

## ğŸ¯ å„ªå…ˆä¿®å¾©æ¸…å–®

### P0 - é˜»å¡æ€§å•é¡Œ
1. [ ] ç™½å±å•é¡Œï¼ˆå…¶ä»–é›»è…¦ï¼‰â†’ å·²é€šéå…ç™»éŒ„æ¨¡å¼è§£æ±º
2. [ ] ç™»éŒ„æµç¨‹ä¸å®Œæ•´
3. [ ] æ•¸æ“šä¸Ÿå¤±é¢¨éšª

### P1 - é‡è¦åŠŸèƒ½
1. [ ] ç›£æ§åŠŸèƒ½ç©©å®šæ€§
2. [ ] æ¶ˆæ¯ç™¼é€å¯é æ€§
3. [ ] å»£å‘Šç³»çµ±å®Œæ•´æ€§

### P2 - é«”é©—å„ªåŒ–
1. [ ] ç•Œé¢éŸ¿æ‡‰é€Ÿåº¦
2. [ ] éŒ¯èª¤æç¤ºå‹å¥½åº¦
3. [ ] æ“ä½œæµç¨‹ç°¡åŒ–

---

## ğŸ“ å‚™è¨»

- æ¸¬è©¦ç’°å¢ƒï¼šWindows 10/11
- æ¸¬è©¦è³¬è™Ÿï¼šæº–å‚™ 3-5 å€‹æ¸¬è©¦ Telegram è³¬è™Ÿ
- æ¸¬è©¦ç¾¤çµ„ï¼šå‰µå»ºç§æœ‰æ¸¬è©¦ç¾¤çµ„
- æ•¸æ“šå‚™ä»½ï¼šæ¸¬è©¦å‰å‚™ä»½æ•¸æ“šåº«

**æ–‡æª”æ›´æ–°æ—¥æœŸï¼š2026-01-14**
