# TG-AI智控王 完整打包說明

## 📦 打包流程

完整打包會執行以下步驟：

1. **編譯 Python 後端為 exe** (約 5-10 分鐘)
   - 使用 PyInstaller 編譯
   - 輸出到 `backend-exe/tg-matrix-backend.exe`
   - 包含所有依賴和插件

2. **構建 Angular 前端** (約 2-5 分鐘)
   - 生產環境構建
   - 輸出到 `dist/` 目錄

3. **打包 Electron 安裝程序** (約 5-15 分鐘)
   - 使用 electron-builder
   - 生成 Windows 安裝程序（NSIS）
   - 輸出到 `release/` 目錄

## 🚀 執行打包

### 方法 1: 使用完整打包腳本（推薦）

```bash
npm run dist:full:win
```

此命令會自動執行所有步驟。

### 方法 2: 分步執行

如果您想分步執行或需要調試：

```bash
# 步驟 1: 編譯 Python 後端
python build-scripts/build-backend-exe.py

# 步驟 2: 構建前端
npm run build:prod

# 步驟 3: 打包安裝程序
npx electron-builder --config electron-builder.yml --win
```

## 📁 輸出文件

打包完成後，安裝程序位於：

```
release/TG-AI智控王-Setup-1.0.3.exe
```

## ✅ 打包內容

安裝程序包含：

- ✅ **Electron 運行時環境**
- ✅ **編譯後的 Angular 前端**
- ✅ **Python 後端 exe**（無需安裝 Python）
- ✅ **所有依賴和插件**
- ✅ **默認配置文件**
- ✅ **必要的系統庫**

## 📋 打包要求

### 系統要求

- Windows 10/11 (x64)
- Node.js 18+
- Python 3.8+ (僅打包時需要)
- 至少 8GB 可用磁盤空間

### 必需工具

打包前請確保已安裝：

```bash
# 檢查 Node.js
node --version

# 檢查 Python
python --version

# 安裝 Python 依賴
cd backend
pip install -r requirements.txt
pip install pyinstaller

# 安裝 Node.js 依賴
npm install
```

## 🔧 配置說明

### electron-builder.yml

主要配置項：

- **appId**: `com.tgai.smartking.app`
- **productName**: `TG-AI智控王`
- **輸出目錄**: `release/`
- **安裝程序類型**: NSIS（Windows 安裝程序）
- **後端位置**: `backend-exe/`（編譯後的 exe）

### 產品信息

- 應用名稱：TG-AI智控王
- 版本：1.0.3
- 版權：Copyright © 2026 TG-AI智控王

## 🐛 常見問題

### 1. PyInstaller 編譯失敗

**問題**: 缺少依賴或模塊

**解決**:
```bash
# 確保所有依賴已安裝
cd backend
pip install -r requirements.txt
pip install pyinstaller
```

### 2. 前端構建失敗

**問題**: Angular 構建錯誤

**解決**:
```bash
# 清理並重新安裝
rm -rf node_modules dist
npm install
npm run build:prod
```

### 3. 打包時間過長

**正常情況**: 完整打包需要 10-30 分鐘，這是正常的。

如果超過 1 小時，請檢查：
- 磁盤空間是否充足
- 是否在虛擬機中運行
- 是否有其他進程佔用資源

### 4. 安裝程序文件過大

**正常大小**: 約 100-200 MB

如果超過 500 MB，可能的原因：
- 包含了不必要的依賴
- PyInstaller 打包了過多文件
- 未使用 UPX 壓縮

## 📊 打包檢查清單

打包前確認：

- [ ] 已更新版本號（`package.json`）
- [ ] 已更新產品名稱（`electron-builder.yml`, `package.json`）
- [ ] 所有功能已測試
- [ ] 後端依賴已安裝
- [ ] 前端依賴已安裝
- [ ] 有足夠的磁盤空間（至少 8GB）
- [ ] 已關閉其他占用資源的程序

打包後檢查：

- [ ] 安裝程序已生成（`release/TG-AI智控王-Setup-1.0.3.exe`）
- [ ] 文件大小合理（100-200 MB）
- [ ] 可以正常安裝
- [ ] 應用可以正常啟動
- [ ] 後端 exe 可以正常運行
- [ ] 所有功能正常

## 🔄 更新打包配置

如果需要修改打包配置，編輯以下文件：

1. **electron-builder.yml** - Electron 打包配置
2. **build-scripts/build-backend-exe.py** - Python 後端編譯配置
3. **package.json** - 項目基本信息

## 📝 注意事項

1. **打包時間**: 完整打包需要較長時間，請耐心等待
2. **磁盤空間**: 確保有足夠空間（至少 8GB 可用空間）
3. **Python 環境**: 打包時需要 Python，但生成的安裝程序不依賴 Python
4. **測試**: 打包完成後，建議在不同環境測試安裝程序

## 🎯 快速打包（僅前端）

如果只需要打包前端（不編譯 Python 後端）：

```bash
npm run package:win
```

這會生成一個需要 Python 環境的版本（不推薦生產環境使用）。

---

*最後更新: 2026-01-12*
