# 本地 AI 配置与「全员可用」说明 + 智能引擎/模型配置页三视角优化方案

## 一、当前状态回答

### 1.1 现在是启动了吗？

**是，已经启动。** 从你提供的控制台输出可以确认：

- **ALL SERVICES STARTED!**：Ollama 与 Tailscale Funnel 均已就绪。
- **Ollama**：在 `[::]:11434` 监听，版本 0.13.5，使用 RTX 3060。
- **Funnel**：已提供公网访问地址，且说明 **Funnel URL is permanent（不会变）**。

只要保持 Ollama 与 Funnel 的窗口/进程不关闭，服务会持续可用。

---

### 1.2 应该怎么填写本地 AI？

在 SaaS 里进入 **智能引擎 → 模型配置 → + 添加本地 AI**，按下面填写（与当前控制台输出一致）：

| 字段 | 填写内容 | 说明 |
|------|----------|------|
| **API 端点 \*** | `https://ms-defysomwqybz.tai105a567.ts.net/api/chat` | 使用控制台 **PUBLIC ACCESS** 下的 **Chat** 地址（你截图中的 Funnel 地址；若实际是 `tail05a567` 等，以控制台显示为准）。 |
| **模型名称 \*** | `huihui_ai/qwen2.5-abliterate` | 与 Ollama 中一致，可在本机执行 `ollama list` 查看。 |
| **显示名称（可选）** | 如「我的本地 AI」或「平台共享 Ollama」 | 便于在列表中识别。 |

填写后点击 **测试连接**，通过后再点 **保存**。

---

### 1.3 怎么样填写可以让所有用户都可以使用？在后台可以设置让所有用户调用吗？

**可以。** 当前后端 AI 模型是「按实例全局」存储的（`ai_models` 表无 `user_id`/`tenant_id`），因此：

- **谁在「智能引擎 → 模型配置」里添加并保存了某个本地 AI**，**该实例下所有用户**在获取模型列表时都会看到它，并可以选择使用。
- **推荐做法（后台设置、全员可用）**：  
  由**管理员（或指定运维账号）**登录 SaaS → 进入 **智能引擎 → 模型配置** → **+ 添加本地 AI** → 填写上述 **API 端点** 与 **模型名称** → **测试连接** → **保存**。  
  保存后，无需每个用户再填一次，所有用户在使用智能营销、多角色、对话等需要选模型的场景中，都能在列表里看到并选用该「本地 AI」。

若未来改为多租户（按租户隔离数据），再通过「平台级/租户级共享模型」能力（见下文优化方案）区分「仅管理员可配置、全员可用」的模型与「用户私有」模型。

---

## 二、智能引擎/模型配置页：三视角优化方案（仅方案，无代码）

以下从**开发工程师、市场经理、用户**三个角度，对「智能引擎设置」页（含模型配置、添加本地 AI 弹窗）的 **UI/UX、功能、数据库** 提出优化方向，不涉及具体代码实现。

---

### 2.1 现状简述

| 维度 | 当前情况 | 问题/机会 |
|------|----------|-----------|
| **页面** | 智能引擎设置：引擎概览、模型配置、人格风格、知识大脑、使用统计；顶部「未配置 AI」/今日对话/转化率/今日成本 | 未配置时引导不够强；「全员可用」与「仅自己可用」无区分展示 |
| **模型配置** | 本地 AI / 云端 AI 两块，添加本地 AI 弹窗：API 端点、模型名称、显示名称、测试连接、保存 | 未说明「保存后是否对全员可见」；无平台级/共享模型标识 |
| **数据** | `ai_models` 全局表，无 `tenant_id`/`user_id`，无「可见范围」字段 | 多租户下无法区分「平台共享」与「用户私有」 |
| **权限** | 能进智能引擎即可添加/编辑/删除模型 | 无「仅管理员可配置共享模型」的管控 |

---

### 2.2 开发工程师视角

#### UI/UX

- **未配置态强化**：当 0 个可用模型时，首屏突出「添加第一个 AI 模型」引导（本地 AI + 云端 AI），并简短说明「保存后本实例下所有用户均可选用」。
- **模型卡片信息**：在每条模型上展示「默认」「本地/云端」外，可增加「全员可用」或「仅本人」标签（依赖后端可见范围字段），便于管理员与用户理解。
- **添加本地 AI 弹窗**：在 API 端点、模型名称旁保留现有 Tailscale Funnel 说明；可增加一行短文案：「保存后，本实例下所有用户均可选择此模型」（与当前全局存储行为一致）。
- **测试连接反馈**：测试成功/失败时，除 Toast 外可在弹窗内保留简短状态（如「连接正常」/「连接失败」），减少重复点击测试。

#### 功能

- **平台级/共享模型（为多租户预留）**：  
  - 数据层：增加 `visibility` 或 `scope`（如 `platform` / `tenant` / `user`），或 `is_platform_shared` 布尔。  
  - 业务层：仅管理员可创建/编辑/删除 `platform`（或 `is_platform_shared=true`）模型；普通用户仅能使用，不能改端点或删除。  
  - 当前若仍为单租户，可先不展示「可见范围」，仅在后台表增加字段，默认视为「平台共享」。
- **测试连接**：保持对公网 Funnel URL 的 GET/POST 测试；若后端有代理测试，可考虑对敏感端点做「仅管理员可测试」或限频，避免滥用。
- **默认模型**：保持「设为默认」逻辑；若存在平台共享模型，可建议管理员将「全员可用的本地 AI」设为默认，减少普通用户选择成本。

#### 数据库

- **ai_models 表**：  
  - 增加 `visibility`（如 `platform` / `user`）或 `is_platform_shared`（0/1），默认 1（与当前「全员可见」一致）。  
  - 若多租户：增加 `tenant_id`，查询时平台模型按租户过滤或全局可见（按产品定）。  
- **权限/审计**：可选增加 `created_by` / `updated_by`，便于审计「谁配置了全员可用的本地 AI」。

---

### 2.3 市场经理视角

#### 话术与引导

- **对外说明**：明确「管理员在智能引擎中配置一次本地 AI（填 Funnel 地址），全公司/全团队用户即可在智能营销、对话等场景中直接选用」，突出「一次配置、全员可用」。
- **添加本地 AI 弹窗**：在弹窗内或帮助链接中写一句：「使用 Tailscale Funnel 可将您本机的 Ollama 安全暴露到公网，供 SaaS 上的所有用户使用」，与现有「远程访问本地 Ollama」说明一致。
- **未配置态**：首屏可强调「免费、无限量、数据可留在本机」等卖点，引导先配置本地 AI，再使用云端模型作为补充。

#### 转化与留存

- **降低首次使用门槛**：在「未配置 AI」时提供「快速配置本地 AI」入口（与现有「快速配置本地 AI」按钮一致），并可在引导中提及「配置后全员可用」。
- **区分场景**：在智能营销、多角色等页的「选择模型」处，可对「平台共享的本地 AI」做轻量标识（如「推荐」「全员可用」），提高选用率。

#### 数据与迭代

- **埋点**：统计「添加本地 AI」的完成率、测试连接成功率、保存后该模型被选用的次数与用户数，用于判断「全员可用」是否达到预期。
- **反馈**：在设置或帮助中收集「是否希望区分仅自己可用 vs 全员可用」等反馈，为多租户与权限细化做准备。

---

### 2.4 用户视角

#### 使用预期

- **管理员**：「在智能引擎里填一次 Funnel 的 Chat 地址和模型名，保存后，希望所有人都能用」→ 当前行为已满足；优化后可在界面看到「全员可用」或「平台共享」的明确提示。
- **普通用户**：「不想填地址，只用现成的 AI」→ 在选模型时能看到管理员配置的「本地 AI」并选用即可；无需进入模型配置页即可使用。
- **未配置时**：用户希望清楚「要做什么、去哪配置、配置完谁能用」→ 通过首屏引导和弹窗内一句「保存后本实例下所有用户均可选择」即可满足。

#### 与「数据库」相关的无感优化

- **多端/多设备**：模型列表由后端统一返回，用户在不同设备登录同一实例，看到的模型一致。
- **性能**：模型列表与默认模型缓存合理，避免每次打开智能引擎都明显延迟。

---

## 三、实施顺序建议（仅顺序）

1. **文档与话术**：在帮助文档或产品说明中明确「管理员配置一次本地 AI 即全员可用」，并在「添加本地 AI」弹窗内增加一句「保存后本实例下所有用户均可选择此模型」。
2. **数据表扩展（为多租户预留）**：在 `ai_models` 增加 `visibility` 或 `is_platform_shared`，默认与当前行为一致（全员可见）。
3. **未配置态与引导**：优化 0 模型时的首屏文案与 CTA，突出「添加第一个 AI」和「全员可用」。
4. **模型卡片展示**：若有 `visibility`/`is_platform_shared`，在列表中展示「全员可用」或「平台共享」标签。
5. **权限与多租户（可选）**：若启用多租户，再实现「仅管理员可创建/编辑平台共享模型」及 `tenant_id` 过滤。

---

## 四、小结

| 问题 | 结论 |
|------|------|
| 现在是启动了吗？ | 是，Ollama 与 Funnel 已启动，控制台有 PUBLIC ACCESS 的 Chat/Tags 地址。 |
| 怎么填写本地 AI？ | API 端点 = Funnel 的 `/api/chat` 地址，模型名称 = `ollama list` 中的名称（如 `huihui_ai/qwen2.5-abliterate`）。 |
| 怎么让所有用户都用？ | 当前为全局模型列表；由管理员在智能引擎 → 模型配置中添加并保存该本地 AI 即可，所有用户即可选用。 |
| 三视角优化 | 开发：未配置引导、弹窗说明全员可用、数据表与权限预留；市场：话术与埋点；用户：明确「一次配置、全员可用」与选模型体验。 |

---

*文档版本：v1.0*
