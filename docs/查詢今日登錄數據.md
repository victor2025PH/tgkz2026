# 查詢「今天登錄」的數據位置與命令

## 一、三類數據的區別

| 數據 | 含義 | 存放位置 |
|------|------|----------|
| **網站登錄** | 你用郵箱/密碼登錄 TG-Matrix 網頁 | `data/auth.db` → 表 `users`（有 `last_login_at`） |
| **Telegram 帳號列表** | 已添加的 Telegram 號（如 +639277356118） | `data/tgmatrix.db` → 表 `accounts`（有 `created_at`、`updated_at`） |
| **登錄審計** | 掃碼/Token 等登錄行為記錄 | `data/auth.db` → 表 `login_audit`（有 `created_at`） |

你看到的「三個帳號」是 **Telegram 帳號**（`accounts` 表），不是「今天剛登錄網站」的記錄；只有 **+639277356118** 是你自己的，另外兩個是別人的或歷史數據。

---

## 二、在服務器上查「今天」的數據

在服務器上 `cd /opt/tg-matrix` 後執行（按需選一種方式）。

### 1. 今天有更新過的 Telegram 帳號（tgmatrix.db）

```bash
# 今天有更新的帳號（updated_at 為今天）
sqlite3 data/tgmatrix.db "
SELECT id, phone, status, owner_user_id,
       datetime(updated_at) AS updated_at,
       datetime(created_at) AS created_at
FROM accounts
WHERE date(updated_at) = date('now', 'localtime')
   OR date(created_at) = date('now', 'localtime')
ORDER BY updated_at DESC;
"
```

若沒有結果，說明**沒有**「今天創建或今天更新」的 Telegram 帳號記錄；那三條都是以前寫入的。

### 2. 今天網站登錄的用戶（auth.db）

```bash
# 今天登錄過網站的用戶（last_login_at 為今天）
sqlite3 data/auth.db "
SELECT id, email, datetime(last_login_at) AS last_login_at, datetime(created_at) AS created_at
FROM users
WHERE date(last_login_at) = date('now', 'localtime')
ORDER BY last_login_at DESC;
"
```

這裡能看到「剛才用郵箱登錄」的那條記錄（若是今天登錄的）。

### 3. 今天的登錄審計（auth.db，掃碼/Token 等）

```bash
# 今天的登錄審計記錄
sqlite3 data/auth.db "
SELECT id, telegram_id, success, ip_address, datetime(created_at) AS created_at
FROM login_audit
WHERE date(created_at) = date('now', 'localtime')
ORDER BY created_at DESC
LIMIT 20;
"
```

---

## 三、總結：今天登錄的最新數據在哪

- **「剛才登錄過的帳號」**（網站帳號）：在 **`data/auth.db`** 的 **`users`** 表，看 **`last_login_at`**。
- **「今天有被更新」的 Telegram 帳號**：在 **`data/tgmatrix.db`** 的 **`accounts`** 表，看 **`updated_at`** / **`created_at`**。
- **「今天發生的登錄行為」**（審計）：在 **`data/auth.db`** 的 **`login_audit`** 表，看 **`created_at`**。

若 `accounts` 表裡沒有「今天」的 `updated_at`，說明那三條帳號確實是很早以前寫入的，沒有在今天被更新；你今天做的只是**網站登錄**，網站登錄只會更新 **auth.db** 的 **users.last_login_at**，不會自動改 **tgmatrix.db** 的 **accounts**。
