# 菜單與用戶系統優化方案

## 一、當前問題分析

### 1.1 菜單重複問題

| 重複功能 | 出現位置 | 問題 |
|---------|---------|------|
| AI 配置 | 設置頁 + AI 中心 | 兩處都可配置，易混淆 |
| 語音服務 | 設置頁 + AI 中心 | 配置分散 |
| RAG 知識庫 | 設置頁 + AI 中心 | 功能重複 |
| 發送配置 | 設置頁 + 自動化中心 | 全局 vs 活動級別混淆 |
| A/B 測試 | 設置頁 + 自動化中心 | 應屬於營銷功能 |
| 會員統計 | 設置頁 + 新星徽章 | 分散在多處 |
| 監控配置 | 設置頁 + 監控中心 | 重複入口 |

### 1.2 用戶系統缺失

- ❌ 無用戶登入機制
- ❌ 無設備綁定
- ❌ 卡密管理分散
- ❌ 無個人中心
- ❌ 多用戶無法區分

### 1.3 會員功能分散

- 新星徽章在側邊欄底部
- 會員統計在設置頁
- 升級提示隨機彈出
- 無統一的會員管理入口

---

## 二、優化目標

1. **唯一性原則**：每個功能只在一個地方出現
2. **用戶系統**：建立完整的登入、認證、設備綁定機制
3. **會員獨立**：會員功能單獨成為一級菜單
4. **個人中心**：用戶相關的所有設置歸入個人中心
5. **清晰分類**：按業務邏輯重新組織菜單

---

## 三、新菜單結構設計

### 3.1 菜單層級圖

```
┌─────────────────────────────────────────────────────────────┐
│                        TG-Matrix                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  👤 [用戶頭像] 用戶名                    ← 登入後顯示       │
│     VIP 會員 | 到期：2026-12-31                             │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  📊 儀表板           ← 首頁總覽                             │
│                                                             │
│  ─── 資源管理 ───                                          │
│  👥 帳號管理         ← 所有 Telegram 帳號                   │
│  🔍 資源發現         ← 群組/頻道發現                        │
│                                                             │
│  ─── 營銷自動化 ───                                        │
│  🤖 自動化中心       ← 監控+規則+發送配置（整合）           │
│  👤 潛在客戶         ← 客戶漏斗管理                         │
│  📢 廣告發送         ← 批量發送                             │
│                                                             │
│  ─── AI 智能 ───                                           │
│  🧠 AI 中心          ← AI配置+自動聊天+RAG+語音（整合）     │
│                                                             │
│  ─── 系統監控 ───                                          │
│  📈 監控中心         ← 分析+日誌+性能（整合）               │
│  🔔 告警             ← 告警管理                             │
│                                                             │
│  ─── 會員服務 ───    ← 新增獨立分類                        │
│  ⭐ 會員中心         ← 等級+權益+統計+升級                  │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  👤 個人中心         ← 點擊頭像或底部入口                   │
│  ⚙️ 系統設置         ← 僅保留全局設置                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 各菜單功能職責（去重後）

| 菜單 | 包含功能 | 說明 |
|------|---------|------|
| **儀表板** | 總覽統計、快速操作、最近活動 | 只顯示摘要，不做配置 |
| **帳號管理** | 帳號列表、導入導出、角色分配 | 所有 TG 帳號操作 |
| **資源發現** | 群組搜索、加入隊列、資源庫 | 發現新資源 |
| **自動化中心** | 監控目標、自動化規則、發送配置、A/B測試 | 整合所有自動化相關 |
| **潛在客戶** | 客戶漏斗、標籤管理、批量操作 | 客戶關係管理 |
| **廣告發送** | 批量發送、定時發送、發送歷史 | 主動觸達 |
| **AI 中心** | AI配置、自動聊天、RAG知識庫、語音服務 | 整合所有 AI 功能 |
| **監控中心** | 分析報表、系統日誌、性能監控 | 整合所有監控功能 |
| **告警** | 告警規則、告警歷史、通知設置 | 異常處理 |
| **會員中心** | 等級權益、使用統計、升級購買、邀請獎勵 | **新增獨立菜單** |
| **個人中心** | 登入信息、設備管理、卡密激活、密碼修改 | **新增** |
| **系統設置** | 語言、主題、數據備份、快捷鍵 | 僅保留全局設置 |

---

## 四、用戶認證與設備綁定系統

### 4.1 用戶認證流程

```
┌─────────────────────────────────────────────────────────────┐
│                      應用啟動                               │
└─────────────────┬───────────────────────────────────────────┘
                  ▼
┌─────────────────────────────────────────────────────────────┐
│                 檢查本地登入狀態                            │
│         (localStorage / 加密存儲)                           │
└─────────────────┬───────────────────────────────────────────┘
                  ▼
          ┌───────┴───────┐
          │   已登入？    │
          └───────┬───────┘
                  │
        ┌─────────┴─────────┐
        ▼                   ▼
   [已登入]              [未登入]
        │                   │
        ▼                   ▼
┌───────────────┐   ┌───────────────┐
│ 驗證設備碼    │   │ 顯示登入頁面  │
│ + Token 有效性│   │               │
└───────┬───────┘   └───────┬───────┘
        │                   │
        ▼                   ▼
  ┌─────┴─────┐       ┌─────────────────┐
  │  驗證通過  │       │ 用戶選擇登入方式│
  └─────┬─────┘       └─────┬───────────┘
        │                   │
        ▼           ┌───────┼───────┐
┌───────────────┐   ▼       ▼       ▼
│ 進入主界面   │  [帳號]  [卡密]  [邀請碼]
│ 載入用戶數據 │  登入    激活    註冊
└───────────────┘   │       │       │
                    └───────┼───────┘
                            ▼
                    ┌───────────────┐
                    │ 驗證成功      │
                    │ + 綁定設備碼  │
                    │ + 記錄登入    │
                    └───────┬───────┘
                            ▼
                    ┌───────────────┐
                    │ 進入主界面    │
                    └───────────────┘
```

### 4.2 登入方式

| 登入方式 | 描述 | 適用場景 |
|---------|------|---------|
| **帳號密碼** | 用戶名 + 密碼 | 已註冊用戶 |
| **卡密激活** | 激活碼 | 新用戶購買後首次使用 |
| **邀請碼註冊** | 邀請碼 + 設置密碼 | 被邀請的新用戶 |
| **設備碼登入** | 已綁定設備自動登入 | 信任設備快速登入 |

### 4.3 設備綁定機制

```
┌─────────────────────────────────────────────────────────────┐
│                      設備碼生成                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  設備碼 = Hash(                                             │
│    CPU ID +                                                 │
│    主板序列號 +                                             │
│    硬盤序列號 +                                             │
│    MAC 地址 +                                               │
│    用戶名 +                                                 │
│    操作系統信息                                             │
│  )                                                          │
│                                                             │
│  示例：TGM-A1B2C3D4E5F6-2026                               │
│                                                             │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      設備綁定規則                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  會員等級        可綁定設備數      解綁規則                 │
│  ─────────────────────────────────────────────────         │
│  免費用戶        1 台              不可解綁                 │
│  VIP             2 台              每月可解綁 1 次          │
│  SVIP            3 台              每月可解綁 2 次          │
│  MVP             5 台              無限制解綁               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.4 卡密系統設計

```
┌─────────────────────────────────────────────────────────────┐
│                      卡密格式                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  格式：XXXX-XXXX-XXXX-XXXX                                 │
│  示例：TGM1-VIP7-2026-A8B9                                 │
│                                                             │
│  含義解析：                                                 │
│  - TGM1: 產品標識 + 批次                                   │
│  - VIP7: 會員等級 + 時長(7天/30天/365天)                   │
│  - 2026: 年份                                               │
│  - A8B9: 隨機驗證碼                                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      卡密狀態流轉                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [生成] → [未使用] → [已激活] → [已過期]                   │
│                ↓                                            │
│            [已作廢]                                         │
│                                                             │
│  狀態說明：                                                 │
│  - 未使用：可正常激活                                       │
│  - 已激活：綁定用戶，開始計時                               │
│  - 已過期：時間用完                                         │
│  - 已作廢：管理員手動作廢                                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 五、個人中心設計

### 5.1 個人中心結構

```
┌─────────────────────────────────────────────────────────────┐
│                      👤 個人中心                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  📷 頭像                                             │   │
│  │  用戶名：marketing_pro                              │   │
│  │  郵箱：user@example.com                             │   │
│  │  會員等級：⭐ VIP                                   │   │
│  │  到期時間：2026-12-31                               │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                                             │
│  📋 帳號信息                                                │
│  ├── 修改密碼                                              │
│  ├── 綁定郵箱                                              │
│  └── 兩步驗證                                              │
│                                                             │
│  🔑 卡密管理                                                │
│  ├── 激活新卡密                                            │
│  ├── 卡密使用記錄                                          │
│  └── 續費購買                                              │
│                                                             │
│  💻 設備管理                                                │
│  ├── 當前設備：TGM-A1B2... ✅ (本機)                       │
│  ├── 設備 2：TGM-C3D4... (2026-01-10 登入)                │
│  └── [解綁設備] [添加設備]                                 │
│                                                             │
│  📊 使用統計                                                │
│  ├── 本月 AI 調用：150 / 500 次                            │
│  ├── 本月消息發送：2,340 / 10,000 條                       │
│  └── 帳號配額：5 / 10 個                                   │
│                                                             │
│  🎁 邀請獎勵                                                │
│  ├── 我的邀請碼：INVITE-ABC123                             │
│  ├── 已邀請：5 人                                          │
│  └── 獲得獎勵：15 天 VIP                                   │
│                                                             │
│  🚪 登出                                                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 與舊「新星」功能的對應

| 舊功能（新星徽章） | 新位置 |
|------------------|--------|
| 會員等級顯示 | 個人中心 - 頂部 + 會員中心 |
| 升級提示 | 會員中心 - 升級頁面 |
| 使用配額 | 個人中心 - 使用統計 |
| 邀請獎勵 | 個人中心 - 邀請獎勵 |

---

## 六、會員中心設計

### 6.1 會員中心結構

```
┌─────────────────────────────────────────────────────────────┐
│                      ⭐ 會員中心                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [我的等級] [權益對比] [升級購買] [使用記錄]  ← 標籤頁     │
│                                                             │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                                             │
│  【我的等級】                                               │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  當前等級：⭐ VIP                                   │   │
│  │  有效期至：2026-12-31 (剩餘 354 天)                │   │
│  │  ─────────────────────────────────────────────────  │   │
│  │  本月權益使用情況：                                  │   │
│  │  ████████░░ 帳號：8/10                              │   │
│  │  ██████░░░░ AI 調用：300/500                        │   │
│  │  ████░░░░░░ 消息：4,000/10,000                      │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  【權益對比】                                               │
│                                                             │
│  ┌─────────┬─────────┬─────────┬─────────┬─────────┐       │
│  │ 功能    │ 免費    │ VIP     │ SVIP    │ MVP     │       │
│  ├─────────┼─────────┼─────────┼─────────┼─────────┤       │
│  │ 帳號數  │ 2       │ 10      │ 50      │ 無限    │       │
│  │ AI調用  │ 50/月   │ 500/月  │ 2000/月 │ 無限    │       │
│  │ 消息數  │ 100/天  │ 1000/天 │ 5000/天 │ 無限    │       │
│  │ 設備數  │ 1       │ 2       │ 3       │ 5       │       │
│  │ ...     │ ...     │ ...     │ ...     │ ...     │       │
│  └─────────┴─────────┴─────────┴─────────┴─────────┘       │
│                                                             │
│  【升級購買】                                               │
│                                                             │
│  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────┐   │
│  │ VIP 月卡        │ │ SVIP 月卡       │ │ MVP 年卡    │   │
│  │ ¥29/月         │ │ ¥99/月         │ │ ¥999/年    │   │
│  │ [立即購買]      │ │ [立即購買]      │ │ [立即購買]  │   │
│  └─────────────────┘ └─────────────────┘ └─────────────┘   │
│                                                             │
│  支付方式：[支付寶] [微信] [USDT] [卡密]                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 七、系統設置（精簡後）

### 7.1 只保留全局設置

```
┌─────────────────────────────────────────────────────────────┐
│                      ⚙️ 系統設置                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🌐 語言和區域                                              │
│  ├── 界面語言：[繁體中文 ▼]                                │
│  └── 時區：[UTC+8 台北 ▼]                                  │
│                                                             │
│  🎨 外觀                                                    │
│  ├── 主題：[深色 ▼] / [淺色] / [跟隨系統]                  │
│  └── 字體大小：[中 ▼]                                      │
│                                                             │
│  ⌨️ 快捷鍵                                                  │
│  ├── 命令面板：Ctrl + K                                    │
│  └── [自定義快捷鍵]                                        │
│                                                             │
│  💾 數據管理                                                │
│  ├── 自動備份：[開啟] 每日 02:00                           │
│  ├── [立即備份] [恢復備份]                                 │
│  └── [導出所有數據] [清除緩存]                             │
│                                                             │
│  🔔 通知設置                                                │
│  ├── 桌面通知：[開啟]                                      │
│  ├── 音效提醒：[開啟]                                      │
│  └── 勿擾模式：[關閉]                                      │
│                                                             │
│  ℹ️ 關於                                                    │
│  ├── 版本：1.0.3                                           │
│  ├── [檢查更新]                                            │
│  └── [開源許可] [隱私政策]                                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 7.2 移除的設置項（轉移去向）

| 移除的設置項 | 轉移到 |
|-------------|--------|
| AI 配置 | AI 中心 |
| 語音服務 | AI 中心 - 語音服務標籤 |
| RAG 知識庫 | AI 中心 - RAG 標籤 |
| A/B 測試 | 自動化中心 |
| 發送配置 | 自動化中心 - 全局配置 |
| 會員統計 | 會員中心 |
| 監控配置 | 監控中心 |

---

## 八、實施計劃

### 8.1 優先級排序

| 階段 | 內容 | 優先級 | 預估工時 |
|------|------|--------|---------|
| Phase 1 | 用戶登入系統 + 設備綁定 | 🔴 高 | 3-4 天 |
| Phase 2 | 菜單重組（去重） | 🔴 高 | 2-3 天 |
| Phase 3 | 個人中心開發 | 🟡 中 | 2 天 |
| Phase 4 | 會員中心獨立化 | 🟡 中 | 1-2 天 |
| Phase 5 | 系統設置精簡 | 🟢 低 | 1 天 |
| Phase 6 | 測試與優化 | 🔴 高 | 2 天 |

### 8.2 Phase 1 詳細步驟

```
用戶登入系統開發：

1. 登入頁面 UI
   ├── 帳號密碼表單
   ├── 卡密激活表單
   ├── 邀請碼註冊表單
   └── 設備碼顯示

2. 後端 API
   ├── POST /api/auth/login（帳號密碼登入）
   ├── POST /api/auth/activate（卡密激活）
   ├── POST /api/auth/register（邀請碼註冊）
   ├── POST /api/auth/verify-device（設備驗證）
   ├── POST /api/auth/bind-device（設備綁定）
   ├── POST /api/auth/unbind-device（設備解綁）
   └── GET /api/auth/me（獲取當前用戶信息）

3. 前端服務
   ├── AuthService（認證服務）
   ├── DeviceService（設備管理）
   ├── AuthGuard（路由守衛）
   └── TokenInterceptor（Token 攔截器）

4. 數據存儲
   ├── 用戶表 (users)
   ├── 設備表 (devices)
   ├── 卡密表 (licenses)
   └── 登入記錄表 (login_logs)
```

---

## 九、數據庫設計

### 9.1 用戶表 (users)

```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(256) NOT NULL,
    email VARCHAR(100),
    phone VARCHAR(20),
    membership_level VARCHAR(20) DEFAULT 'free',
    membership_expires DATETIME,
    invited_by INTEGER REFERENCES users(id),
    invite_code VARCHAR(20) UNIQUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    last_login DATETIME,
    status VARCHAR(20) DEFAULT 'active'
);
```

### 9.2 設備表 (devices)

```sql
CREATE TABLE devices (
    id INTEGER PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    device_code VARCHAR(100) NOT NULL,
    device_name VARCHAR(100),
    device_info JSON,
    bound_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    last_seen DATETIME,
    status VARCHAR(20) DEFAULT 'active'
);
```

### 9.3 卡密表 (licenses) - 擴展

```sql
ALTER TABLE licenses ADD COLUMN used_by INTEGER REFERENCES users(id);
ALTER TABLE licenses ADD COLUMN used_device VARCHAR(100);
ALTER TABLE licenses ADD COLUMN activated_at DATETIME;
```

---

## 十、安全考慮

### 10.1 認證安全

- ✅ 密碼使用 bcrypt 加密存儲
- ✅ 使用 JWT Token，設置合理過期時間
- ✅ 敏感操作需二次驗證
- ✅ 登入失敗次數限制（5次/小時）
- ✅ 異常設備登入通知

### 10.2 設備綁定安全

- ✅ 設備碼使用多維度信息生成，難以偽造
- ✅ 設備碼變更需驗證身份
- ✅ 解綁操作有冷卻時間
- ✅ 多設備登入有上限

### 10.3 卡密安全

- ✅ 卡密一次性使用
- ✅ 卡密與用戶+設備綁定
- ✅ 批量生成有記錄
- ✅ 可追溯激活來源

---

## 十一、預期效果

### 11.1 用戶體驗提升

| 改進點 | 改進前 | 改進後 |
|--------|--------|--------|
| 菜單清晰度 | 功能分散，難找 | 邏輯分組，一目了然 |
| 設置頁 | 臃腫，雜亂 | 精簡，只保留全局 |
| 會員管理 | 分散多處 | 統一入口 |
| 用戶身份 | 無登入概念 | 完整用戶系統 |
| 設備管理 | 無 | 可視化管理 |

### 11.2 商業價值提升

- 📈 用戶留存率提升（登入系統帶來的數據沉澱）
- 📈 付費轉化率提升（清晰的會員中心展示權益）
- 📈 用戶活躍度提升（設備綁定增加使用粘性）
- 📈 邀請裂變效果（個人中心突出邀請獎勵）

---

## 十二、總結

本方案通過以下核心改進，解決當前系統的菜單混亂和用戶管理缺失問題：

1. **菜單去重**：每個功能只在一個邏輯位置出現
2. **用戶系統**：建立完整的登入、認證、設備綁定機制
3. **會員獨立**：會員功能升級為一級菜單
4. **個人中心**：統一管理用戶相關的所有設置
5. **設置精簡**：系統設置只保留真正的全局配置

實施後，系統將具備更清晰的導航結構、更完善的用戶管理能力，以及更強的商業變現潛力。
