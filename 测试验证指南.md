# 测试验证指南

## ✅ 当前状态

根据你的截图，以下功能已确认工作：

1. ✅ **后端独立运行** - `python backend/main.py` 成功启动并输出日志事件
2. ✅ **Electron 应用启动** - `npm start` 成功启动

## 🔍 验证 Electron 与 Python 后端通信

### 步骤 1：检查 Electron 控制台

在 Electron 应用中：
1. 打开开发者工具（如果还没打开，按 `F12` 或 `Ctrl+Shift+I`）
2. 查看 Console 标签页
3. 应该看到以下日志：
   ```
   [Backend] Starting Python backend...
   [Backend] Python script: C:\tgkz2026\backend\main.py
   [Backend] Event: log-entry
   [Backend] Event: initial-state
   ```

### 步骤 2：验证前端接收数据

在 Electron 应用的开发者工具 Console 中，应该看到：
- `Received initial state from backend:` 以及初始状态数据
- 前端界面应该显示空的数据（因为数据库是新的）

### 步骤 3：测试添加账户

1. 在 Electron 应用中，点击左侧菜单的 "账户管理"（Accounts）
2. 尝试添加一个新账户：
   - 输入电话号码
   - 点击 "添加账户"
3. 检查：
   - 控制台应该显示：`[Backend] Sending command: add-account`
   - 账户应该出现在列表中
   - 控制台应该显示：`[Backend] Event: accounts-updated`

### 步骤 4：测试获取初始状态

前端在启动时会自动发送 `get-initial-state` 命令。检查：
- 控制台应该显示：`[Backend] Sending command: get-initial-state`
- 应该收到 `initial-state` 事件

## 🐛 常见问题排查

### 问题 1：看不到后端日志

**症状：** Electron 控制台没有 `[Backend]` 开头的日志

**可能原因：**
- Python 后端没有启动
- Python 路径不正确

**解决方法：**
1. 检查 Electron 主进程控制台（启动 `npm start` 的终端）
2. 应该看到 `[Backend] Starting Python backend...`
3. 如果看到错误，检查 Python 是否在 PATH 中

### 问题 2：前端没有收到数据

**症状：** 前端界面显示为空，控制台没有初始状态

**可能原因：**
- Python 后端没有响应
- JSON 解析错误
- 通信管道问题

**解决方法：**
1. 检查 Electron 主进程控制台的错误信息
2. 检查是否有 `[Backend] Error:` 开头的错误
3. 尝试手动测试后端（见下方）

### 问题 3：数据库错误

**症状：** 看到数据库相关的错误

**可能原因：**
- 数据库文件权限问题
- 数据库目录不存在

**解决方法：**
1. 检查 `backend/data/` 目录是否存在
2. 检查是否有写权限
3. 删除 `backend/data/tgmatrix.db` 让系统重新创建

## 🧪 手动测试后端

如果 Electron 集成有问题，可以手动测试后端：

1. **启动后端：**
   ```bash
   python backend/main.py
   ```

2. **输入测试命令：**
   ```json
   {"command": "get-initial-state", "payload": {}}
   ```
   按 Enter

3. **应该看到输出：**
   ```json
   {"event": "initial-state", "payload": {...}}
   {"event": "log-entry", "payload": {...}}
   ```

4. **测试添加账户：**
   ```json
   {"command": "add-account", "payload": {"phone": "+1234567890", "role": "Unassigned"}}
   ```

5. **按 `Ctrl+C` 退出**

## ✅ 成功标志

如果一切正常，你应该看到：

1. **Electron 主进程控制台：**
   - `[Backend] Starting Python backend...`
   - `[Backend] Event: log-entry`
   - `[Backend] Event: initial-state`

2. **Electron 应用界面：**
   - 仪表盘显示统计数据（都是 0，因为数据库是新的）
   - 可以正常添加账户、关键词集等

3. **数据库文件：**
   - `backend/data/tgmatrix.db` 文件已创建

## 📝 下一步

如果所有测试都通过，可以开始：

1. ✅ 测试添加账户功能
2. ✅ 测试添加关键词集
3. ✅ 测试添加监控群组
4. ⏳ 开始实现 Pyrogram 集成（Telegram API）

---

**提示：** 如果遇到任何问题，请检查：
- Electron 主进程控制台（启动 npm start 的终端）
- Electron 应用开发者工具控制台（F12）
- Python 后端输出（如果独立运行）

