# TG-Matrix 用户手册

## 📖 目录

1. [系统简介](#系统简介)
2. [快速开始](#快速开始)
3. [账户管理](#账户管理)
4. [监控配置](#监控配置)
5. [自动化活动](#自动化活动)
6. [潜在客户管理](#潜在客户管理)
7. [消息队列](#消息队列)
8. [数据分析](#数据分析)
9. [系统设置](#系统设置)
10. [常见问题](#常见问题)

---

## 系统简介

TG-Matrix 是一个基于 Telegram API 的自动化营销工具，可以帮助您：

- **批量管理账户**：管理多个 Telegram 账户，支持监听和发送两种角色
- **实时监控群组**：监控指定群组消息，自动匹配关键词
- **自动捕获潜在客户**：当群组消息匹配关键词时，自动捕获用户信息
- **自动化营销活动**：配置自动化活动，自动向潜在客户发送消息
- **消息队列管理**：智能的消息发送队列，支持延迟发送、重试、限流保护
- **数据分析**：查看发送统计、账户表现、活动效果等数据

---

## 快速开始

### 1. 启动应用

在项目根目录运行：

```bash
npm run start:build
```

应用启动后，您将看到主界面，包含以下视图：
- **仪表盘**：系统概览和统计数据
- **账户管理**：管理 Telegram 账户
- **自动化中心**：配置关键词、群组、模板和活动
- **潜在客户**：查看和管理捕获的潜在客户
- **分析**：查看数据统计和图表
- **日志**：查看系统日志
- **设置**：系统配置

### 2. 添加第一个账户

1. 点击左侧菜单的 **"账户管理"**
2. 点击 **"添加账户"** 按钮
3. 填写账户信息：
   - **电话号码**：格式如 `+1234567890`
   - **API ID**：从 [my.telegram.org](https://my.telegram.org) 获取
   - **API Hash**：从 [my.telegram.org](https://my.telegram.org) 获取
   - **代理**（可选）：格式如 `socks5://user:pass@host:port`
   - **角色**：选择 "监听" 或 "发送"
   - **分组**（可选）：用于组织账户
4. 点击 **"添加账户"** 完成

### 3. 登录账户

1. 在账户列表中，找到要登录的账户
2. 点击 **"登录"** 按钮
3. 如果账户需要验证码：
   - 系统会提示输入验证码
   - 输入收到的验证码
4. 如果账户需要 2FA 密码：
   - 系统会提示输入 2FA 密码
   - 输入您的 2FA 密码
5. 登录成功后，账户状态会显示为 "Online"

### 4. 配置监控

1. 点击左侧菜单的 **"自动化中心"**
2. **添加关键词集**：
   - 点击 "关键词集" 标签
   - 点击 "添加关键词集"
   - 输入名称，如 "产品关键词"
   - 添加关键词（支持普通关键词和正则表达式）
3. **添加监控群组**：
   - 点击 "监控群组" 标签
   - 点击 "添加群组"
   - 输入群组 URL（如 `https://t.me/groupname` 或 `t.me/groupname`）
   - 选择关联的关键词集
4. **启动监控**：
   - 返回仪表盘
   - 点击 "启动监控" 按钮

---

## 账户管理

### 添加账户

#### 方法 1：手动添加

1. 进入 **账户管理** 视图
2. 点击 **"添加账户"** 按钮
3. 填写表单并提交

#### 方法 2：从 Excel 导入

1. 点击 **"从 Excel 导入"** 按钮
2. 选择 Excel 文件
3. Excel 文件应包含以下列（列名支持中英文）：
   - `phone` / `电话号码`：电话号码
   - `api_id` / `API ID`：API ID
   - `api_hash` / `API Hash`：API Hash
   - `proxy` / `代理`：代理地址（可选）
   - `group` / `分组`：分组名称（可选）
   - `role` / `角色`：角色（Listener/Sender）
   - `two_factor_password` / `2FA密码`：2FA 密码（可选）

#### 方法 3：导入会话文件

1. 点击 **"导入会话文件"** 按钮
2. 选择 `.session` 文件
3. 系统会自动识别电话号码并创建账户
4. 如果账户不存在，需要手动填写 API ID 和 API Hash

### 登录账户

1. 在账户列表中找到要登录的账户
2. 点击 **"登录"** 按钮
3. 根据提示输入验证码或 2FA 密码

**注意事项：**
- 首次登录需要验证码（会发送到您的手机）
- 如果账户启用了 2FA，需要输入 2FA 密码
- 登录失败时，系统会显示具体的错误原因

### 检查账户状态

1. 在账户列表中，点击账户的 **"检查状态"** 按钮
2. 系统会检查账户的连接状态和在线状态
3. 状态包括：
   - **Online**：在线
   - **Offline**：离线
   - **Banned**：被封禁
   - **Error**：错误

### 批量操作

#### 批量分配角色

1. 在账户列表中，勾选要操作的账户
2. 点击 **"批量操作"** → **"分配角色"**
3. 选择角色（监听/发送）
4. 确认操作

#### 批量分配分组

1. 勾选要操作的账户
2. 点击 **"批量操作"** → **"分配分组"**
3. 输入分组名称
4. 确认操作

#### 批量删除

1. 勾选要删除的账户
2. 点击 **"批量操作"** → **"删除账户"**
3. 确认删除（此操作不可恢复）

### 导出会话文件

1. 在账户列表中，找到要导出的账户
2. 点击 **"导出会话"** 按钮
3. 选择保存位置
4. 会话文件会保存为 `.session` 格式

### 重新加载会话

如果您在 `backend/sessions/` 目录中放置了会话文件，可以：

1. 点击 **"重新加载会话"** 按钮
2. 系统会自动扫描会话文件
3. 为每个会话文件创建或更新对应的账户

---

## 监控配置

### 关键词管理

#### 添加关键词集

1. 进入 **自动化中心** → **关键词集** 标签
2. 点击 **"添加关键词集"**
3. 输入名称
4. 点击 **"保存"**

#### 添加关键词

1. 在关键词集列表中，点击要添加关键词的集合
2. 点击 **"添加关键词"**
3. 输入关键词
4. 选择类型：
   - **普通关键词**：精确匹配
   - **正则表达式**：使用正则表达式匹配
5. 点击 **"添加"**

**示例：**
- 普通关键词：`产品`、`服务`、`优惠`
- 正则表达式：`产品.*价格`、`[0-9]+元`

#### 删除关键词

1. 在关键词列表中，点击要删除的关键词
2. 点击 **"删除"** 按钮
3. 确认删除

### 监控群组管理

#### 添加监控群组

1. 进入 **自动化中心** → **监控群组** 标签
2. 点击 **"添加群组"**
3. 输入群组信息：
   - **群组 URL**：支持以下格式
     - `https://t.me/groupname`
     - `t.me/groupname`
     - `https://t.me/+invitelink`
     - `t.me/+invitelink`
   - **群组名称**（可选）：用于标识
   - **关联关键词集**：选择要在此群组中匹配的关键词集
4. 点击 **"添加"**

**注意事项：**
- 确保监听账户已加入该群组
- 群组 URL 必须是有效的 Telegram 群组链接
- 系统会自动将 URL 转换为群组 ID

#### 移除监控群组

1. 在群组列表中，找到要移除的群组
2. 点击 **"删除"** 按钮
3. 确认删除

### 启动/停止监控

#### 启动监控

1. 确保至少有一个 **"监听"** 角色的账户已登录（状态为 "Online"）
2. 确保至少配置了一个监控群组
3. 在仪表盘或自动化中心，点击 **"启动监控"** 按钮
4. 系统会开始监控所有配置的群组

#### 停止监控

1. 点击 **"停止监控"** 按钮
2. 系统会停止所有监控任务

**监控状态：**
- 监控启动后，系统会实时监听配置的群组
- 当消息匹配关键词时，会自动捕获潜在客户
- 捕获的潜在客户会显示在 **"潜在客户"** 视图中

---

## 自动化活动

### 消息模板

#### 添加模板

1. 进入 **自动化中心** → **消息模板** 标签
2. 点击 **"添加模板"**
3. 填写信息：
   - **模板名称**：用于标识
   - **消息内容**：支持变量替换
4. 点击 **"保存"**

#### 模板变量

消息模板支持以下变量（使用 `{变量名}` 格式）：

- `{username}`：用户名
- `{firstName}`：名字
- `{lastName}`：姓氏
- `{sourceGroup}`：来源群组
- `{triggeredKeyword}`：触发的关键词

**示例：**
```
你好 {firstName}！

我看到你在 {sourceGroup} 中提到了 {triggeredKeyword}。
我是 {username}，很高兴认识你！
```

#### 启用/禁用模板

1. 在模板列表中，找到要操作的模板
2. 点击 **"启用"** 或 **"禁用"** 按钮
3. 只有启用的模板才能被活动使用

### 自动化活动

#### 创建活动

1. 进入 **自动化中心** → **自动化活动** 标签
2. 点击 **"添加活动"**
3. 填写活动信息：

   **基本信息：**
   - **活动名称**：用于标识
   - **是否启用**：创建后是否立即启用

   **触发条件：**
   - **来源群组**：选择触发活动的群组（留空表示所有群组）
   - **关键词集**：选择触发活动的关键词集（留空表示所有关键词）

   **执行动作：**
   - **消息模板**：选择要发送的消息模板
   - **最小延迟**：发送前的最小延迟（秒）
   - **最大延迟**：发送前的最大延迟（秒）

4. 点击 **"保存"**

#### 活动工作原理

1. **监控触发**：当群组消息匹配关键词时，系统捕获潜在客户
2. **活动匹配**：系统检查是否有活动匹配该潜在客户
3. **延迟发送**：根据配置的延迟时间，在指定时间后发送消息
4. **消息发送**：使用配置的模板，通过发送账户发送消息

#### 启用/禁用活动

1. 在活动列表中，找到要操作的活动
2. 点击 **"启用"** 或 **"禁用"** 按钮
3. 只有启用的活动才会自动执行

---

## 潜在客户管理

### 查看潜在客户

1. 进入 **潜在客户** 视图
2. 潜在客户以看板形式显示，按状态分组：
   - **New**：新捕获的潜在客户
   - **Contacted**：已联系
   - **Interested**：感兴趣
   - **Not Interested**：不感兴趣
   - **Converted**：已转化

### 更新潜在客户状态

1. 在潜在客户列表中，找到要更新的客户
2. 点击客户卡片
3. 在详情面板中，选择新的状态
4. 状态会自动保存

### 发送消息

1. 在潜在客户详情中，点击 **"发送消息"** 标签
2. 选择要使用的消息模板
3. 预览消息内容（变量已替换）
4. 点击 **"发送"** 按钮
5. 消息会加入发送队列，根据配置的延迟时间发送

### 查看交互历史

1. 在潜在客户详情中，点击 **"历史记录"** 标签
2. 查看所有与该客户的交互记录：
   - 关键词匹配
   - 活动触发
   - 消息发送
   - 状态更新

### 添加到"请勿联系"列表

如果某个用户不希望被联系：

1. 在潜在客户详情中，点击 **"添加到 DNC"** 按钮
2. 确认操作
3. 该用户将被标记为 "请勿联系"
4. 系统不会再向该用户发送消息

### 导出潜在客户

1. 在潜在客户视图中，点击 **"导出到 Excel"** 按钮
2. 选择保存位置
3. Excel 文件包含以下列：
   - ID、User ID、Username、First Name、Last Name
   - Source Group、Triggered Keyword、Status
   - Online Status、Timestamp、Do Not Contact

---

## 消息队列

### 查看队列状态

1. 进入 **仪表盘** 或 **消息队列** 视图
2. 查看队列统计：
   - **总消息数**：队列中的消息总数
   - **待发送**：等待发送的消息数
   - **发送中**：正在发送的消息数
   - **已完成**：已成功发送的消息数
   - **失败**：发送失败的消息数

### 查看队列消息

1. 在队列视图中，选择要查看的账户
2. 查看该账户的队列消息列表
3. 每条消息显示：
   - 目标用户
   - 消息内容
   - 优先级
   - 状态
   - 创建时间
   - 计划发送时间

### 队列操作

#### 暂停队列

1. 在队列视图中，选择要暂停的账户
2. 点击 **"暂停"** 按钮
3. 该账户的队列将暂停处理

#### 恢复队列

1. 在队列视图中，选择要恢复的账户
2. 点击 **"恢复"** 按钮
3. 该账户的队列将恢复处理

#### 清空队列

1. 在队列视图中，选择要清空的账户
2. 点击 **"清空队列"** 按钮
3. 确认操作（此操作会删除所有待发送的消息）

#### 删除单个消息

1. 在消息列表中，找到要删除的消息
2. 点击 **"删除"** 按钮
3. 确认删除

#### 更新消息优先级

1. 在消息列表中，找到要更新的消息
2. 点击 **"优先级"** 下拉菜单
3. 选择新的优先级：
   - **高**：优先发送
   - **普通**：正常发送
   - **低**：最后发送

### 队列特性

- **自动重试**：发送失败的消息会自动重试（最多 3 次）
- **限流保护**：自动处理 Telegram 的 Flood Wait 限制
- **延迟发送**：支持计划发送时间
- **优先级排序**：高优先级消息优先发送

---

## 数据分析

### 仪表盘统计

在 **仪表盘** 视图中，您可以查看：

- **总账户数**：系统中所有账户的数量
- **在线账户数**：当前在线的账户数量
- **今日捕获潜在客户**：今天捕获的潜在客户数量
- **今日发送消息数**：今天发送的消息总数

### 分析图表

进入 **分析** 视图，查看详细的数据图表：

#### 消息发送趋势

- 显示过去 7 天的消息发送趋势
- 包括成功发送和失败的数量
- 支持按账户筛选

#### 队列长度趋势

- 显示队列长度的变化趋势
- 帮助了解系统负载

#### 账户表现

- 显示每个账户的发送统计
- 包括成功率、平均延迟等指标

#### 活动效果

- 显示每个活动的执行情况
- 包括触发次数、转化率等

### 性能监控

在 **性能监控** 视图中，您可以查看：

- **系统资源**：CPU、内存、磁盘使用率
- **连接状态**：活跃连接数
- **队列状态**：队列长度、处理速度
- **数据库性能**：查询时间、缓存命中率

---

## 系统设置

### 日志管理

#### 查看日志

1. 进入 **日志** 视图
2. 查看系统日志，包括：
   - **信息**：一般操作日志
   - **成功**：成功操作日志
   - **警告**：警告信息
   - **错误**：错误信息

#### 过滤日志

1. 使用日志类型过滤器
2. 使用时间范围选择器
3. 使用搜索框搜索特定内容

#### 导出日志

1. 点击 **"导出日志"** 按钮
2. 选择保存位置
3. 日志会导出为文本文件

#### 清除日志

1. 点击 **"清除日志"** 按钮
2. 确认操作
3. 所有日志将被清除（此操作不可恢复）

### 数据库备份

#### 创建备份

1. 进入 **设置** → **数据库备份**
2. 点击 **"创建备份"** 按钮
3. 系统会自动创建数据库备份
4. 备份文件保存在 `backend/data/backups/` 目录

#### 恢复备份

1. 在备份列表中，找到要恢复的备份
2. 点击 **"恢复"** 按钮
3. 确认操作（此操作会覆盖当前数据库）
4. 系统会自动恢复备份

#### 查看备份信息

1. 在备份列表中，点击备份文件
2. 查看备份信息：
   - 创建时间
   - 文件大小
   - 数据库版本

### 告警设置

系统会自动检测以下情况并发送告警：

- **错误率过高**：错误率超过阈值
- **队列积压**：队列长度超过阈值
- **账户健康**：账户健康分数低于阈值
- **连接问题**：连接失败或断开
- **性能问题**：系统资源使用率过高

告警会在以下位置显示：
- **告警视图**：查看所有告警
- **仪表盘**：显示重要告警
- **日志**：记录告警信息

### 配置管理

系统配置通过 `backend/config.yaml` 文件管理，包括：

- **数据库配置**：数据库路径、备份设置
- **Telegram 配置**：API ID、API Hash、会话目录
- **发送配置**：默认发送限制、延迟设置
- **监控配置**：检查间隔、并发账户数
- **日志配置**：日志级别、最大条目数

**注意：** 修改配置文件后需要重启应用才能生效。

---

## 常见问题

### Q1: 账户登录失败，显示"验证码错误"

**原因：** 输入的验证码不正确或已过期

**解决方法：**
1. 检查验证码是否正确
2. 验证码通常 5 分钟内有效
3. 如果验证码过期，重新点击"登录"获取新验证码

### Q2: 账户登录失败，显示"2FA密码错误"

**原因：** 输入的 2FA 密码不正确

**解决方法：**
1. 检查 2FA 密码是否正确
2. 确保账户已启用 2FA
3. 如果忘记密码，需要在 Telegram 应用中重置

### Q3: 监控启动失败，显示"未找到在线的监听账户"

**原因：** 没有已登录的监听账户

**解决方法：**
1. 确保至少有一个账户角色为"监听"
2. 确保该账户已登录（状态为 "Online"）
3. 如果账户未登录，先点击"登录"按钮

### Q4: 活动执行失败，显示"没有可用的在线发送账户"

**原因：** 没有已登录的发送账户

**解决方法：**
1. 确保至少有一个账户角色为"发送"
2. 确保该账户已登录（状态为 "Online"）
3. 如果账户未登录，先点击"登录"按钮

### Q5: 消息发送失败，显示"Flood wait"

**原因：** 触发 Telegram 的限流保护

**解决方法：**
1. 系统会自动处理 Flood Wait
2. 消息会在等待时间后自动重试
3. 建议降低发送频率，避免触发限流

### Q6: 群组监控不工作

**原因：** 可能的原因包括：
- 监听账户未加入群组
- 群组 URL 格式不正确
- 账户未登录

**解决方法：**
1. 确保监听账户已加入要监控的群组
2. 检查群组 URL 格式是否正确
3. 确保账户已登录（状态为 "Online"）
4. 检查日志查看具体错误信息

### Q7: 如何查看详细的错误信息？

**方法：**
1. 打开 Electron 开发者工具（F12 或 Ctrl+Shift+I）
2. 查看 Console 标签页
3. 查看主进程控制台（运行 `npm start` 的终端窗口）

### Q8: 数据库文件在哪里？

**位置：** `backend/data/tgmatrix.db`

**备份位置：** `backend/data/backups/`

### Q9: 会话文件在哪里？

**位置：** `backend/sessions/`

**格式：** `{电话号码}.session`

### Q10: 如何重置系统？

**方法：**
1. 停止应用
2. 删除 `backend/data/tgmatrix.db` 文件
3. 重新启动应用
4. 系统会自动创建新的数据库

**注意：** 此操作会删除所有数据，请谨慎操作！

---

## 快捷键

- **Ctrl + K**：显示快捷键帮助
- **Ctrl + S**：保存当前操作
- **Ctrl + F**：搜索/过滤
- **Esc**：关闭对话框

---

## 技术支持

如遇到问题，请：

1. 查看本文档的"常见问题"部分
2. 查看系统日志了解详细错误信息
3. 检查 Electron 控制台和主进程控制台
4. 查看 `backend/logs/` 目录中的日志文件

---

**版本：** 1.0.0  
**最后更新：** 2026-01-02

