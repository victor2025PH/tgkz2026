# 🔍 資源發現系統使用說明

## 系統概述

資源發現系統能夠自動搜索和管理 Telegram 群組/頻道資源，實現：

1. **關鍵詞搜索** - 通過關鍵詞搜索公開的群組和頻道
2. **資源評估** - 自動評估資源的活躍度、相關度和價值
3. **批量加入** - 支持批量加入群組，帶頻率控制和帳號輪換
4. **隊列管理** - 加入隊列管理，避免頻繁操作被封禁

---

## 核心功能

### 1. 資源搜索

通過 Telegram 的全局搜索 API，搜索公開的群組和頻道：

```javascript
// 發送命令
{
  "command": "search-resources",
  "payload": {
    "query": "加密货币",
    "limit": 50
  }
}

// 回應事件: search-resources-complete
{
  "success": true,
  "query": "加密货币",
  "found": 45,
  "new": 32,
  "updated": 13
}
```

### 2. 資源管理

```javascript
// 獲取資源列表
{
  "command": "get-resources",
  "payload": {
    "status": "discovered",  // 可選: discovered, joined, blocked
    "type": "group",         // 可選: group, supergroup, channel
    "limit": 50,
    "offset": 0
  }
}

// 獲取統計信息
{ "command": "get-resource-stats" }

// 手動添加資源
{
  "command": "add-resource-manually",
  "payload": {
    "username": "example_group",
    "type": "group"
  }
}

// 刪除資源
{
  "command": "delete-resource",
  "payload": { "resourceId": 123 }
}
```

### 3. 加入隊列

```javascript
// 添加到加入隊列
{
  "command": "add-to-join-queue",
  "payload": {
    "resourceIds": [1, 2, 3, 4, 5],
    "priority": 5
  }
}

// 處理加入隊列（每次處理 5 個）
{
  "command": "process-join-queue",
  "payload": { "limit": 5 }
}

// 批量加入（帶隨機延遲）
{
  "command": "batch-join-resources",
  "payload": {
    "resourceIds": [1, 2, 3],
    "delayMin": 30,
    "delayMax": 60
  }
}
```

### 4. 搜索關鍵詞管理

```javascript
// 獲取關鍵詞列表
{ "command": "get-discovery-keywords" }

// 添加關鍵詞
{
  "command": "add-discovery-keyword",
  "payload": {
    "keyword": "NFT",
    "category": "crypto",
    "priority": 8
  }
}
```

---

## 前端使用指南

### 訪問入口

在應用程序中，導航到 **設置** 頁面，找到 **🔍 資源發現** 區塊。

### 界面功能

#### 統計卡片
- **📊 總資源數** - 已發現的總資源數量
- **🆕 今日發現** - 今天新發現的資源
- **📋 待加入** - 在隊列中等待加入的資源
- **✅ 已加入** - 成功加入的資源數量

#### 操作按鈕
| 按鈕 | 功能 |
|------|------|
| 🚀 初始化 | 初始化資源發現系統 |
| 🚀 處理隊列 | 處理待加入的資源（每次 5 個）|
| 🔄 刷新統計 | 更新統計數據 |

#### 搜索功能
1. 在搜索框輸入關鍵詞
2. 點擊「🔍 搜索資源」
3. 等待搜索完成，結果會自動顯示在列表中

#### 關鍵詞管理
- 點擊「➕ 添加關鍵詞」可以保存常用關鍵詞
- 點擊已保存的關鍵詞可以快速搜索

#### 資源列表操作
1. **選擇資源** - 勾選想要操作的資源
2. **加入隊列** - 將選中的資源添加到加入隊列
3. **批量加入** - 直接批量加入選中的資源

---

## 評分機制

### 綜合評分計算

```
綜合評分 = 成員數評分 × 0.3 + 活躍度評分 × 0.3 + 相關度評分 × 0.25 + 時間評分 × 0.15
```

### 成員數評分
| 成員數 | 評分 |
|--------|------|
| 10萬+ | 1.0 |
| 5萬+ | 0.9 |
| 2萬+ | 0.8 |
| 1萬+ | 0.7 |
| 5000+ | 0.6 |
| 1000+ | 0.5 |
| 500+ | 0.4 |
| 100+ | 0.3 |

### 相關度評分
根據搜索關鍵詞在標題和描述中的匹配程度計算。

---

## 防封策略

### 加入限制
- 每個帳號每小時最多加入 **10** 個群組
- 每次加入之間間隔 **30-60** 秒（隨機）
- 自動輪換使用多個帳號

### 搜索限制
- 搜索間隔至少 **5** 秒
- 遇到 FloodWait 自動等待重試

---

## 資源狀態說明

| 狀態 | 說明 |
|------|------|
| `discovered` | 已發現，未嘗試加入 |
| `queued` | 在加入隊列中 |
| `joining` | 正在嘗試加入 |
| `joined` | 已成功加入 |
| `monitoring` | 已加入並正在監控 |
| `left` | 已退出 |
| `blocked` | 被封禁/無法加入 |
| `invalid` | 群組無效或已刪除 |

---

## 數據庫表結構

### discovered_resources
主要資源表，存儲所有發現的群組/頻道信息。

### discovery_logs
搜索日誌表，記錄每次搜索的結果。

### discovery_keywords
搜索關鍵詞配置表。

### resource_join_queue
加入隊列表，管理待加入的資源。

---

## 文件結構

```
backend/
├── resource_discovery.py      # 資源發現核心引擎
├── group_search_service.py    # 群組搜索服務
└── migrations/
    └── 0005_add_resource_discovery.py  # 數據庫遷移

src/
├── app.component.ts           # 前端邏輯
├── app.component.html         # 前端 UI
└── translation.service.ts     # 翻譯支持
```

---

## 使用流程

1. **初始化系統**
   - 進入設置頁面
   - 點擊「🚀 初始化」按鈕

2. **添加搜索關鍵詞**
   - 點擊「➕ 添加關鍵詞」
   - 輸入目標行業/主題的關鍵詞

3. **搜索資源**
   - 輸入關鍵詞或點擊已保存的關鍵詞
   - 等待搜索完成

4. **篩選高價值資源**
   - 查看評分和成員數
   - 選擇想要加入的資源

5. **批量加入**
   - 選中資源
   - 點擊「📋 加入隊列」或「🚀 批量加入」

6. **處理隊列**
   - 點擊「🚀 處理隊列」
   - 系統會自動輪換帳號加入

---

## 注意事項

1. **帳號安全** - 新號建議先預熱，避免立即大量加群
2. **頻率控制** - 系統已內建防封策略，請勿手動繞過
3. **資源質量** - 高評分不等於高價值，還需人工審核
4. **定期清理** - 定期刪除無效或低質量資源
