# 账户错误诊断工具

## 🔍 诊断步骤

### 步骤 1: 查看应用内日志

1. **打开应用**
2. **点击左侧菜单的"日志"**
3. **查找与账户相关的错误日志**
   - 查找包含账户电话号码的日志
   - 查找类型为 "error" 的日志
   - 查看最近的日志条目

### 步骤 2: 查看终端日志

在运行 `npm start` 的终端窗口中，查找：

```
[Backend] handle_login_account called with payload: <accountId>
[Backend] Found account: +639952947692, API ID: <ID>, API Hash: ***
[Backend] Calling telegram_manager.login_account for +639952947692
[Backend] login_account result: success=False, status=error, message=...
```

**关键信息：**
- `message` 字段会显示具体的错误原因

### 步骤 3: 查看开发者工具 Console

1. **在应用中按 F12 打开开发者工具**
2. **切换到 Console 标签页**
3. **查找错误信息：**
   - 查找 `[Backend]` 开头的日志
   - 查找 `Error` 或 `error` 相关的消息
   - 查找账户状态更新相关的日志

### 步骤 4: 检查账户信息

在"账户管理"页面，检查账户的：

1. **API ID**
   - 是否已填写？
   - 是否为有效的正整数？
   - 是否与 Telegram 账户匹配？

2. **API Hash**
   - 是否已填写？
   - 是否为 32 位十六进制字符串？
   - 是否与 API ID 匹配？

3. **电话号码**
   - 格式是否正确？（必须以 + 开头）
   - 是否与 Telegram 账户匹配？

4. **代理（如果使用）**
   - 格式是否正确？
   - 代理是否可用？

## 🛠️ 常见错误及解决方案

### 错误 1: "API ID and API Hash are required"

**原因：** 账户的 API ID 或 API Hash 未填写

**解决方案：**
1. 进入"账户管理"页面
2. 找到该账户
3. 检查 API ID 和 API Hash 是否已填写
4. 如果未填写，需要：
   - 访问 https://my.telegram.org/apps
   - 登录您的 Telegram 账户
   - 创建新应用或使用现有应用
   - 复制 API ID 和 API Hash
   - 更新账户信息

### 错误 2: "Invalid phone number"

**原因：** 电话号码格式不正确

**解决方案：**
1. 确保电话号码格式为：`+国家代码+号码`
2. 例如：`+639952947692`（菲律宾）
3. 不要包含空格、连字符或其他字符

### 错误 3: "Proxy connection error" 或 "Proxy Error"

**原因：** 代理配置错误或代理不可用

**解决方案：**
1. 检查代理格式：
   - SOCKS5: `socks5://host:port` 或 `socks5://user:pass@host:port`
   - HTTP: `http://host:port` 或 `http://user:pass@host:port`
2. 测试代理是否可用
3. 如果代理不可用，可以暂时移除代理配置

### 错误 4: "Connection Error"

**原因：** 网络连接问题

**解决方案：**
1. 检查网络连接
2. 检查防火墙设置
3. 检查是否可以使用代理访问 Telegram
4. 尝试使用 VPN

### 错误 5: "Invalid verification code"

**原因：** 验证码错误或已过期

**解决方案：**
1. 重新登录账户
2. 确保输入正确的验证码
3. 验证码通常在 5 分钟内有效

### 错误 6: "Invalid 2FA password"

**原因：** 2FA 密码错误

**解决方案：**
1. 检查 2FA 密码是否正确
2. 如果忘记密码，需要重置 2FA（通过 Telegram 官方流程）

### 错误 7: "Flood wait"

**原因：** 触发 Telegram 限流保护

**解决方案：**
1. 等待指定的时间（通常几分钟到几小时）
2. 避免频繁登录尝试
3. 使用不同的 IP 地址或代理

### 错误 8: "AuthKeyUnregistered" 或 "UserDeactivated"

**原因：** 账户已被封禁或注销

**解决方案：**
1. 检查账户是否在 Telegram 中正常
2. 如果账户被封禁，需要联系 Telegram 支持
3. 如果账户已注销，需要重新注册

## 🔧 诊断命令

### 检查账户详细信息

在开发者工具 Console 中运行：

```javascript
// 查看所有账户
console.log('Accounts:', window.accounts);

// 查看特定账户
const account = window.accounts?.find(a => a.phone === '+639952947692');
console.log('Account details:', account);
```

### 手动触发状态检查

在应用中：
1. 进入"账户管理"页面
2. 找到状态为 "Error" 的账户
3. 点击操作列中的"检查状态"按钮（蓝色刷新图标）

## 📝 收集诊断信息

在报告问题前，请收集以下信息：

1. **账户信息（隐藏敏感信息）：**
   - 电话号码：`+639952947692`
   - API ID：`123456`（示例）
   - API Hash：`***`（隐藏）
   - 是否有代理：是/否

2. **错误日志：**
   - 应用内日志页面的错误信息
   - 终端窗口的后端日志
   - 开发者工具 Console 的错误信息

3. **错误时间：**
   - 错误发生的时间
   - 是否在登录时发生？
   - 是否在运行一段时间后发生？

4. **网络环境：**
   - 是否使用代理？
   - 是否使用 VPN？
   - 网络连接是否正常？

## 🚀 快速修复尝试

### 方法 1: 重新登录

1. 在"账户管理"页面找到账户
2. 点击"登录"按钮（绿色图标）
3. 根据提示输入验证码或 2FA 密码
4. 查看状态是否变为 "Online"

### 方法 2: 更新账户信息

1. 检查并更新 API ID 和 API Hash
2. 检查电话号码格式
3. 检查代理配置（如果使用）
4. 重新登录

### 方法 3: 删除并重新添加账户

1. 删除状态为 "Error" 的账户
2. 重新添加账户，确保信息正确
3. 尝试登录

## 📞 获取帮助

如果问题仍然存在，请提供：

1. **完整的错误日志**（从应用内日志页面复制）
2. **终端输出**（特别是 `[Backend]` 开头的日志）
3. **开发者工具 Console 输出**（F12 → Console）
4. **账户信息**（隐藏敏感信息）

---

**最后更新：** 2026-01-02

