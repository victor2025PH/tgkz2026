# 🚀 Phase 7：全功能完善開發計劃

## 📋 項目概述

**開發週期**：5-7 個工作日  
**開發優先級**：A > B > C > D > E  
**開發原則**：
- 每個方向獨立可測試
- 先核心功能，後優化細節
- 每天完成後進行集成測試

---

## 📅 開發時間線

```
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│                                    開發時間線                                              │
├──────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                           │
│  Day 1-2      Day 2-3      Day 3-4      Day 4-5      Day 5-6      Day 6-7               │
│  方向 A       方向 B       方向 C       方向 D       方向 E       測試優化              │
│  AI真實執行   批量發送     智能分析     多角色協作   UI/UX        集成測試              │
│                                                                                           │
│  ████████    ██████       ██████       ████████     ████         ████                   │
│                                                                                           │
│  🤖 真正發送   📨 批量UI    📊 報告      🎭 劇本      🎨 美化      🧪 測試               │
│  消息到TG     消息編輯     數據圖表     建群執行     動畫主題     修復Bug               │
│                                                                                           │
└──────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 🅰️ 方向 A：AI 團隊真實執行（Day 1-2）

### 目標
讓 AI 團隊銷售真正連接到 Telegram 發送消息

### 任務清單

| ID | 任務 | 預計時間 | 優先級 | 依賴 |
|----|------|----------|--------|------|
| A-01 | 修改 `run_ai_team_execution` 連接 message_queue | 1.5h | 🔴 P0 | - |
| A-02 | 實現目標用戶選擇邏輯（從資源中心/潛在客戶） | 1h | 🔴 P0 | - |
| A-03 | 使用營銷模板生成個性化消息 | 1h | 🔴 P0 | A-02 |
| A-04 | 實現消息發送監聽和統計更新 | 1h | 🟡 P1 | A-01 |
| A-05 | 監聽用戶回覆並分析意圖 | 1.5h | 🟡 P1 | A-04 |
| A-06 | 根據回覆動態調整策略 | 1h | 🟡 P1 | A-05 |
| A-07 | 實現暫停/恢復/停止的完整後端邏輯 | 1h | 🟢 P2 | A-01 |
| A-08 | 執行日誌記錄和錯誤處理 | 0.5h | 🟢 P2 | A-01 |

### 修改文件

```
backend/
├── main.py                    # 修改 run_ai_team_execution
├── ai_team_executor.py        # 新增：AI 團隊執行引擎
└── message_queue.py           # 連接發送

src/multi-role/
├── dynamic-script-engine.service.ts  # 添加更多執行監聽
└── ai-team-hub.component.ts          # 顯示真實統計
```

### 數據流

```
[AI 團隊執行]
     │
     ├──▶ 選擇目標用戶 (unified_contacts / captured_leads)
     │
     ├──▶ 生成個性化消息 (使用 messageTemplates)
     │
     ├──▶ 加入消息隊列 (message_queue.add_message)
     │
     ├──▶ 監聽發送結果 (message-sent / message-failed)
     │
     ├──▶ 監聽用戶回覆 (new-message 事件)
     │
     └──▶ 分析回覆 → 動態調整 → 繼續發送
```

---

## 🅱️ 方向 B：批量發送對話框（Day 2-3）

### 目標
實現資源中心的完整批量發送功能

### 任務清單

| ID | 任務 | 預計時間 | 優先級 | 依賴 |
|----|------|----------|--------|------|
| B-01 | 創建 BatchSendDialogComponent | 1.5h | 🔴 P0 | - |
| B-02 | 消息內容編輯器（支持 Markdown） | 1h | 🔴 P0 | B-01 |
| B-03 | 變量替換功能（{name}, {username}） | 1h | 🔴 P0 | B-02 |
| B-04 | 附件選擇（多圖片/多文件） | 1h | 🟡 P1 | B-01 |
| B-05 | 發送進度顯示組件 | 1h | 🟡 P1 | B-01 |
| B-06 | 發送間隔和隨機延遲設置 | 0.5h | 🟡 P1 | B-01 |
| B-07 | 帳號選擇和輪換設置 | 0.5h | 🟢 P2 | B-01 |
| B-08 | 發送結果統計和導出 | 0.5h | 🟢 P2 | B-05 |

### 新增文件

```
src/dialogs/
└── batch-send-dialog.component.ts  # 批量發送對話框

src/components/
└── send-progress.component.ts      # 發送進度組件
```

### UI 設計

```
┌─────────────────────────────────────────────────────────────────┐
│  📨 批量發送消息                                         [✕]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  📝 消息內容                                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 您好 {first_name}！                                      │   │
│  │                                                          │   │
│  │ 我是XXX，看到您在群裡的發言，很高興認識您！               │   │
│  │                                                          │   │
│  │ 我們專注於...                                            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  📎 附件  [+ 添加圖片] [+ 添加文件]                             │
│  ┌──────┐ ┌──────┐                                             │
│  │ 🖼️   │ │ 📄   │                                             │
│  │img1  │ │doc.pdf│                                            │
│  └──────┘ └──────┘                                             │
│                                                                 │
│  ⚙️ 發送設置                                                    │
│  ├─ 發送間隔: [30] - [60] 秒 (隨機)                            │
│  ├─ 使用帳號: [▼ 全部可用帳號]                                  │
│  └─ 帳號輪換: [✓] 啟用                                         │
│                                                                 │
│  👥 發送目標: 15 個用戶                                         │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  [取消]                              [預覽] [開始發送 ▶️]        │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🅲️ 方向 C：智能分析報告（Day 3-4）

### 目標
創建數據分析和 AI 洞察頁面

### 任務清單

| ID | 任務 | 預計時間 | 優先級 | 依賴 |
|----|------|----------|--------|------|
| C-01 | 創建 SmartAnalyticsComponent | 1h | 🔴 P0 | - |
| C-02 | 統計數據聚合後端 API | 1.5h | 🔴 P0 | - |
| C-03 | 發送/回覆/成交折線圖 | 1h | 🔴 P0 | C-01, C-02 |
| C-04 | 用戶來源餅圖 | 0.5h | 🟡 P1 | C-01 |
| C-05 | 時間段熱力圖 | 1h | 🟡 P1 | C-01 |
| C-06 | AI 洞察卡片（調用 AI 分析數據） | 1.5h | 🟡 P1 | C-02 |
| C-07 | 對比分析（本週 vs 上週） | 1h | 🟢 P2 | C-02 |
| C-08 | 報告導出（PDF/Excel） | 1h | 🟢 P2 | C-01 |

### 新增文件

```
src/analytics/
├── smart-analytics.component.ts    # 智能分析主頁面
├── charts/
│   ├── line-chart.component.ts     # 折線圖
│   ├── pie-chart.component.ts      # 餅圖
│   └── heatmap.component.ts        # 熱力圖
└── ai-insights.component.ts        # AI 洞察卡片

backend/
└── analytics_aggregator.py         # 數據聚合服務
```

### 頁面佈局

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  📊 智能分析報告                                            [本週 ▼] [導出]  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐                   │
│  │ 📤 發送    │ │ 💬 回覆    │ │ ✅ 成交    │ │ 📈 轉化率  │                   │
│  │   1,234   │ │    456    │ │    89     │ │   7.2%    │                   │
│  │ ↑ 12.5%   │ │ ↑ 8.3%    │ │ ↑ 15.2%   │ │ ↑ 0.5%    │                   │
│  └───────────┘ └───────────┘ └───────────┘ └───────────┘                   │
│                                                                             │
│  ┌─────────────────────────────────┐ ┌─────────────────────────────────┐   │
│  │ 📈 發送與回覆趨勢               │ │ 🥧 用戶來源分布                  │   │
│  │                                 │ │                                 │   │
│  │    ∧                           │ │      ┌─────┐                    │   │
│  │   /  \    /\                   │ │     /  群組  \                   │   │
│  │  /    \  /  \                  │ │    │  45%   │                   │   │
│  │ /      \/    \                 │ │   關鍵詞 30% │ 手動 25%          │   │
│  │                                 │ │                                 │   │
│  └─────────────────────────────────┘ └─────────────────────────────────┘   │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │ 🤖 AI 洞察                                                            │ │
│  │                                                                       │ │
│  │ 💡 本週最佳發送時段：14:00-16:00，回覆率高達 42%                        │ │
│  │ 💡 「支付通道」關鍵詞轉化率最高 (12.5%)，建議增加監控                   │ │
│  │ 💡 週三的成交量比其他日期高 35%，可考慮重點運營                         │ │
│  │                                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 🅳️ 方向 D：多角色協作完善（Day 4-5）

### 目標
實現完整的多角色協作流程

### 任務清單

| ID | 任務 | 預計時間 | 優先級 | 依賴 |
|----|------|----------|--------|------|
| D-01 | 實現自動建群功能 (Telegram API) | 2h | 🔴 P0 | - |
| D-02 | 角色帳號自動分配和綁定 | 1h | 🔴 P0 | - |
| D-03 | 群組預熱消息自動發送 | 1h | 🔴 P0 | D-01 |
| D-04 | 目標用戶拉群邏輯 | 1h | 🟡 P1 | D-01 |
| D-05 | 劇本階段執行引擎 | 2h | 🟡 P1 | D-03 |
| D-06 | 實時對話協調（AI 決策下一步） | 2h | 🟡 P1 | D-05 |
| D-07 | 用戶回覆監聽和意圖分析 | 1h | 🟡 P1 | D-05 |
| D-08 | 成交追蹤和狀態更新 | 1h | 🟢 P2 | D-07 |
| D-09 | 協作群組管理界面完善 | 1h | 🟢 P2 | D-01 |

### 新增/修改文件

```
backend/
├── collab_group_service.py      # 協作群組服務
├── script_executor.py           # 劇本執行引擎
└── role_coordinator.py          # 角色協調器

src/multi-role/
├── collab-group-manager.component.ts  # 協作群組管理
└── script-execution-monitor.component.ts  # 執行監控
```

### 執行流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          多角色協作執行流程                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1️⃣ 創建協作群組                                                            │
│     │                                                                       │
│     ▼                                                                       │
│  2️⃣ 分配角色帳號                                                            │
│     ├─ 銷售帳號 → 主聊                                                       │
│     ├─ 專家帳號 → 解答                                                       │
│     ├─ 滿意客戶 → 背書                                                       │
│     └─ 猶豫客戶 → 引導                                                       │
│     │                                                                       │
│     ▼                                                                       │
│  3️⃣ 群組預熱（自動發送預熱消息）                                             │
│     │                                                                       │
│     ▼                                                                       │
│  4️⃣ 拉入目標用戶                                                            │
│     │                                                                       │
│     ▼                                                                       │
│  5️⃣ 執行劇本                                                                │
│     ├─ 監聽用戶發言                                                          │
│     ├─ AI 分析意圖                                                           │
│     ├─ 選擇最佳角色回覆                                                       │
│     └─ 循環直到成交/超時                                                     │
│     │                                                                       │
│     ▼                                                                       │
│  6️⃣ 成交 → 記錄 → 更新狀態                                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 🅴️ 方向 E：UI/UX 優化（Day 5-6）

### 目標
提升整體視覺效果和用戶體驗

### 任務清單

| ID | 任務 | 預計時間 | 優先級 | 依賴 |
|----|------|----------|--------|------|
| E-01 | 側邊欄圖標統一優化 | 0.5h | 🟡 P1 | - |
| E-02 | 頁面切換過渡動畫 | 0.5h | 🟡 P1 | - |
| E-03 | 按鈕 hover/active 效果增強 | 0.5h | 🟡 P1 | - |
| E-04 | 卡片陰影和邊框優化 | 0.5h | 🟡 P1 | - |
| E-05 | 亮色主題完善 | 1h | 🟢 P2 | - |
| E-06 | 響應式布局（平板適配） | 1h | 🟢 P2 | - |
| E-07 | 載入骨架屏動畫 | 0.5h | 🟢 P2 | - |
| E-08 | 空狀態插圖優化 | 0.5h | 🟢 P2 | - |
| E-09 | Toast 通知樣式美化 | 0.5h | 🟢 P2 | - |
| E-10 | 對話框動畫效果 | 0.5h | 🟢 P2 | - |

### 優化示例

```css
/* 頁面過渡動畫 */
.page-enter {
  animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* 卡片 hover 效果 */
.card {
  transition: all 0.2s ease;
}
.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

/* 按鈕波紋效果 */
.btn-ripple {
  position: relative;
  overflow: hidden;
}
.btn-ripple::after {
  content: '';
  position: absolute;
  /* ripple animation */
}
```

---

## 📊 完整工作量估算

| 方向 | 後端 | 前端 | 測試 | 總計 |
|------|------|------|------|------|
| A - AI 真實執行 | 5h | 2h | 1h | **8h** |
| B - 批量發送 | 1h | 5.5h | 0.5h | **7h** |
| C - 智能分析 | 3h | 5h | 1h | **9h** |
| D - 多角色協作 | 8h | 3h | 2h | **13h** |
| E - UI/UX 優化 | 0h | 5.5h | 0.5h | **6h** |
| 集成測試 | 2h | 2h | 3h | **7h** |
| **總計** | **19h** | **23h** | **8h** | **50h** |

### 預計日曆時間

| 階段 | 工作日 | 累計 |
|------|--------|------|
| 方向 A | 1-1.5 天 | Day 1-2 |
| 方向 B | 1 天 | Day 2-3 |
| 方向 C | 1-1.5 天 | Day 3-4 |
| 方向 D | 1.5-2 天 | Day 4-5 |
| 方向 E | 1 天 | Day 5-6 |
| 集成測試 | 1 天 | Day 6-7 |
| **總計** | **6-7 天** | - |

---

## ✅ 驗收標準

### 方向 A
- [ ] AI 團隊可向真實 Telegram 用戶發送消息
- [ ] 發送統計實時更新
- [ ] 可暫停/恢復/停止執行
- [ ] 回覆監聽正常工作

### 方向 B
- [ ] 批量發送對話框可正常打開
- [ ] 變量替換功能正確
- [ ] 附件發送支持多文件
- [ ] 發送進度實時顯示

### 方向 C
- [ ] 統計數據正確顯示
- [ ] 圖表可正常渲染
- [ ] AI 洞察內容有價值
- [ ] 可導出報告

### 方向 D
- [ ] 可自動創建 Telegram 群組
- [ ] 角色帳號正確分配
- [ ] 劇本可自動執行
- [ ] 成交數據正確記錄

### 方向 E
- [ ] 動畫流暢無卡頓
- [ ] 亮色主題可正常使用
- [ ] 平板設備佈局正常
- [ ] 整體視覺統一美觀

---

## 🚦 開發順序依賴圖

```
                    ┌─────────┐
                    │  開始   │
                    └────┬────┘
                         │
                         ▼
                  ┌──────────────┐
                  │   方向 A     │ ← 核心功能
                  │ AI 真實執行  │
                  └──────┬───────┘
                         │
              ┌──────────┴──────────┐
              ▼                     ▼
       ┌──────────────┐      ┌──────────────┐
       │   方向 B     │      │   方向 C     │ ← 可並行
       │  批量發送    │      │  智能分析    │
       └──────┬───────┘      └──────┬───────┘
              │                     │
              └──────────┬──────────┘
                         ▼
                  ┌──────────────┐
                  │   方向 D     │ ← 需要 A 完成
                  │  多角色協作  │
                  └──────┬───────┘
                         │
                         ▼
                  ┌──────────────┐
                  │   方向 E     │ ← 最後優化
                  │  UI/UX 優化  │
                  └──────┬───────┘
                         │
                         ▼
                  ┌──────────────┐
                  │  集成測試    │
                  └──────┬───────┘
                         │
                         ▼
                    ┌─────────┐
                    │  完成   │
                    └─────────┘
```

---

## 📝 每日計劃

### Day 1：方向 A（上半部分）
- [ ] A-01：連接 message_queue
- [ ] A-02：目標用戶選擇
- [ ] A-03：消息生成

### Day 2：方向 A（下半部分）+ 方向 B（開始）
- [ ] A-04：發送監聽
- [ ] A-05：回覆分析
- [ ] A-06：策略調整
- [ ] B-01：批量發送對話框

### Day 3：方向 B + 方向 C（開始）
- [ ] B-02～B-05：消息編輯、進度顯示
- [ ] C-01：智能分析頁面
- [ ] C-02：後端 API

### Day 4：方向 C + 方向 D（開始）
- [ ] C-03～C-06：圖表、AI 洞察
- [ ] D-01：自動建群
- [ ] D-02：角色分配

### Day 5：方向 D
- [ ] D-03～D-06：預熱、拉群、劇本執行
- [ ] D-07～D-09：成交追蹤

### Day 6：方向 E
- [ ] E-01～E-05：動畫、主題
- [ ] E-06～E-10：響應式、優化

### Day 7：集成測試 + 修復
- [ ] 全流程測試
- [ ] Bug 修復
- [ ] 文檔更新

---

*計劃創建時間：2026-01-19*  
*預計完成時間：2026-01-26*
