# 验证码对话框显示问题排查

## 🔍 问题描述

用户点击"登录"按钮后，没有看到验证码输入对话框。

## ✅ 代码检查结果

### 1. HTML 模板 ✅
- 验证码对话框代码已存在（`src/app.component.html` 第 449-481 行）
- 条件：`@if(loginState().requiresCode)`

### 2. TypeScript 代码 ✅
- `loginState` signal 已定义
- `login-requires-code` 事件监听器已存在
- `resendVerificationCode()` 方法已存在

### 3. 构建状态 ✅
- 前端已重新构建成功

## 🔍 可能的原因

### 原因 1：事件没有正确触发
- 后端可能没有发送 `login-requires-code` 事件
- 或者事件数据格式不正确

### 原因 2：loginState 没有正确更新
- `login-requires-code` 事件监听器可能没有正确执行
- Signal 更新可能没有触发 UI 更新

### 原因 3：对话框被其他元素遮挡
- z-index 可能不够高
- 或者有其他元素覆盖

## 🛠️ 排查步骤

### 步骤 1：检查浏览器控制台
1. 打开应用
2. 按 `F12` 打开开发者工具
3. 切换到 Console 标签
4. 点击"登录"按钮
5. 查看是否有以下日志：
   - `[Frontend] loginAccount called with accountId: ...`
   - `[Frontend] Received login-requires-code event: ...`

### 步骤 2：检查 loginState 的值
在浏览器控制台运行：
```javascript
// 检查 loginState 的值
// 需要访问 Angular 组件实例
```

### 步骤 3：检查后端日志
查看后端终端输出，应该看到：
```
[Backend] Sending verification code to {phone}...
[Backend] Verification code sent successfully
[Backend] Sending login-requires-code event
```

### 步骤 4：手动测试
在浏览器控制台手动触发：
```javascript
// 这需要在 Angular 组件上下文中执行
// 或者通过 IPC 直接发送事件
```

## 🔧 临时解决方案

如果事件没有正确触发，可以尝试：

1. **检查后端是否正确发送事件**
   - 查看 `backend/main.py` 的 `handle_login_account` 方法
   - 确认 `self.send_event("login-requires-code", ...)` 被调用

2. **检查前端事件监听器**
   - 确认 `this.ipcService.on('login-requires-code', ...)` 已注册
   - 确认在 `setupIpcListeners()` 中调用

3. **手动触发对话框（测试用）**
   - 可以在 `loginAccount` 方法中临时添加测试代码

## 📋 检查清单

- [ ] 浏览器控制台是否有错误？
- [ ] 点击"登录"后，控制台是否有 `loginAccount called` 日志？
- [ ] 后端终端是否有 `Sending verification code` 日志？
- [ ] 后端终端是否有 `Sending login-requires-code event` 日志？
- [ ] 前端控制台是否有 `Received login-requires-code event` 日志？
- [ ] `loginState().requiresCode` 是否为 `true`？

## 🎯 下一步

1. 请打开浏览器开发者工具（F12）
2. 点击"登录"按钮
3. 查看控制台输出
4. 告诉我看到了什么日志

这样我可以更准确地定位问题！

